<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>yejian's blog</title><link>https://jianye0428.github.io/</link><description>Lruihao's Note æç‘è±ªçš„åšå®¢ï¼šæ¢ç´¢ã€åˆ†äº«ã€è®°å½•è‡ªå·±åœ¨å·¥ä½œç”Ÿæ´»å­¦ä¹ åˆ°ä¸€äº›ä¸œè¥¿ã€‚äººçŸ¥é“å¾—è¶Šå¤šï¼Œå°±å°±ä¼šå‘ç°æ— çŸ¥çš„è¶Šå¤šã€‚æœ‰æ›´å¹¿è¢¤ä¸–ç•Œå¯ä»¥æ¢ç´¢ï¼ŒçœŸæ˜¯è«å¤§çš„å¿«ä¹å•Šï¼</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>18817571704@163.com (Jian YE)</managingEditor><webMaster>18817571704@163.com (Jian YE)</webMaster><lastBuildDate>Sat, 04 May 2024 17:42:03 +0800</lastBuildDate><atom:link href="https://jianye0428.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>å¼ºåŒ–å­¦ä¹  | æ·±åº¦è§£è¯»Soft Actor-Critic ç®—æ³•</title><link>https://jianye0428.github.io/posts/sac/</link><pubDate>Sat, 04 May 2024 17:42:03 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/sac/</guid><description><![CDATA[<h1 id="æ·±åº¦è§£è¯»soft-actor-critic-ç®—æ³•">æ·±åº¦è§£è¯»Soft Actor-Critic ç®—æ³•</h1>
<h2 id="1-å‰è¨€">1 å‰è¨€</h2>
<p>æœºå™¨äººå­¦ä¹ Robot Learningæ­£åœ¨å¿«é€Ÿçš„å‘å±•ï¼Œå…¶ä¸­æ·±åº¦å¼ºåŒ–å­¦ä¹ deep reinforcement learningï¼ˆDRLï¼‰ï¼Œç‰¹åˆ«æ˜¯é¢å‘è¿ç»­æ§åˆ¶continous controlçš„DRLç®—æ³•èµ·ç€é‡è¦çš„ä½œç”¨ã€‚åœ¨è¿™ä¸€é¢†åŸŸä¸­ï¼Œç›®å‰å¯ä»¥è¯´æœ‰ä¸‰ç±»è¡Œä¹‹æœ‰æ•ˆçš„model free DRLç®—æ³•ï¼š</p>
<ul>
<li>TRPO,PPO</li>
<li>DDPGåŠå…¶æ‹“å±•ï¼ˆ<a href="https://link.zhihu.com/?target=https%3A//arxiv.org/abs/1804.08617"target="_blank" rel="external nofollow noopener noreferrer">D4PG<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>,TD3ç­‰ï¼‰</li>
<li>Soft Q-Learning, Soft Actor-Critic</li>
</ul>
<p><strong><font color=red>PPO</font></strong> ç®—æ³•æ˜¯ç›®å‰æœ€ä¸»æµçš„DRLç®—æ³•ï¼ŒåŒæ—¶é¢å‘ç¦»æ•£æ§åˆ¶å’Œè¿ç»­æ§åˆ¶ï¼Œåœ¨<a href="https://en.wikipedia.org/wiki/OpenAI_Five"target="_blank" rel="external nofollow noopener noreferrer">OpenAI Five<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸Šå–å¾—äº†å·¨å¤§æˆåŠŸã€‚ä½†æ˜¯PPOæ˜¯ä¸€ç§on-policyçš„ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯PPOé¢ä¸´ç€ä¸¥é‡çš„sample inefficiencyï¼Œéœ€è¦å·¨é‡çš„é‡‡æ ·æ‰èƒ½å­¦ä¹ ï¼Œè¿™å¯¹äºçœŸå®çš„æœºå™¨äººè®­ç»ƒæ¥è¯´ï¼Œæ˜¯æ— æ³•æ¥å—çš„ã€‚</p>
<p><strong><font color=red>DDPG</font></strong> åŠå…¶æ‹“å±•åˆ™æ˜¯DeepMindå¼€å‘çš„é¢å‘è¿ç»­æ§åˆ¶çš„off policyç®—æ³•ï¼Œç›¸å¯¹PPO æ›´sample efficientã€‚<strong>DDPGè®­ç»ƒçš„æ˜¯ä¸€ç§ç¡®å®šæ€§ç­–ç•¥deterministic policyï¼Œå³æ¯ä¸€ä¸ªstateä¸‹éƒ½åªè€ƒè™‘æœ€ä¼˜çš„ä¸€ä¸ªåŠ¨ä½œ</strong>ã€‚DDPGçš„æ‹“å±•ç‰ˆD4PGä»paperä¸­çš„ç»“æœçœ‹å–å¾—äº†éå¸¸å¥½çš„æ•ˆæœï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¼€æºï¼Œç›®å‰githubä¸Šä¹Ÿæ²¡æœ‰äººèƒ½å¤Ÿå®Œå…¨å¤ç°Deepmindçš„æ•ˆæœã€‚</p>
<p><strong><font color=red>Soft Actor-Critic (SAC)</font></strong> æ˜¯é¢å‘Maximum Entropy Reinforcement learning å¼€å‘çš„ä¸€ç§off policyç®—æ³•ï¼Œå’ŒDDPGç›¸æ¯”ï¼ŒSoft Actor-Criticä½¿ç”¨çš„æ˜¯éšæœºç­–ç•¥stochastic policyï¼Œç›¸æ¯”ç¡®å®šæ€§ç­–ç•¥å…·æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼ˆå…·ä½“åé¢åˆ†æï¼‰ã€‚Soft Actor-Criticåœ¨å…¬å¼€çš„benchmarkä¸­å–å¾—äº†éå¸¸å¥½çš„æ•ˆæœï¼Œå¹¶ä¸”èƒ½ç›´æ¥åº”ç”¨åˆ°çœŸå®æœºå™¨äººä¸Šã€‚æœ€å…³é”®çš„æ˜¯ï¼ŒSoft Actor-Criticæ˜¯å®Œå…¨å¼€æºçš„ï¼Œå› æ­¤ï¼Œæ·±å…¥ç†è§£Soft Actor-Critic ç®—æ³•å…·æœ‰éå¸¸é‡è¦çš„æ„ä¹‰ï¼Œä¹Ÿæ˜¯æœ¬ç¯‡blogçš„ç›®çš„ã€‚</p>
<p>Soft Actor-Criticç®—æ³•ç›¸å…³é“¾æ¥ï¼š</p>
<p>Paperï¼š</p>
<ul>
<li><a href="https://link.zhihu.com/?target=https%3A//arxiv.org/abs/1801.01290"target="_blank" rel="external nofollow noopener noreferrer">Soft Actor-Critic: Off-Policy Maximum Entropy Deep Reinforcement Learning with a Stochastic Actor<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//arxiv.org/abs/1812.05905"target="_blank" rel="external nofollow noopener noreferrer">Soft Actor-Critic Algorithms and Applications<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//arxiv.org/abs/1702.08165"target="_blank" rel="external nofollow noopener noreferrer">Reinforcement Learning with Deep Energy-Based Policies<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a> (Soft Q-Learning)</li>
</ul>
<p>Codes:</p>
<ul>
<li><a href="https://link.zhihu.com/?target=https%3A//github.com/rail-berkeley/softlearning"target="_blank" rel="external nofollow noopener noreferrer">rail-berkeley/softlearning<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a> (åŸä½œè€…å®ç°ï¼‰</li>
<li><a href="https://link.zhihu.com/?target=https%3A//github.com/vitchyr/rlkit"target="_blank" rel="external nofollow noopener noreferrer">vitchyr/rlkit<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//github.com/openai/spinningup"target="_blank" rel="external nofollow noopener noreferrer">openai/spinningup<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//github.com/hill-a/stable-baselines"target="_blank" rel="external nofollow noopener noreferrer">hill-a/stable-baselines<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†è§£è¯»ä¸€ä¸‹SACçš„ç®—æ³•åŠå…¶å…·ä½“å®ç°ã€‚æœ¬æ–‡çš„é˜…è¯»éœ€è¦æœ‰åŸºæœ¬çš„DRLç®—æ³•åŸºç¡€çŸ¥è¯†ã€‚</p>
<h2 id="2-ä¸ºä»€ä¹ˆç ”ç©¶-maximum-entropy-reinforcement-learning">2 ä¸ºä»€ä¹ˆç ”ç©¶ Maximum Entropy Reinforcement Learningï¼Ÿ</h2>
<p>å¯¹äºä¸€èˆ¬çš„DRLï¼Œå­¦ä¹ ç›®æ ‡å¾ˆç›´æ¥ï¼Œå°±æ˜¯å­¦ä¹ ä¸€ä¸ªpolicyä½¿å¾—ç´¯åŠ çš„rewardæœŸæœ›å€¼æœ€å¤§ï¼š</p>
<p>$$\pi^*=\arg\max_\pi\mathbb{E}_{(s_t,a_t)\sim\rho_\pi}[\sum_tR(s_t,a_t)]\tag{1}$$</p>
<p>è€Œæœ€å¤§ç†µRLï¼Œé™¤äº†ä¸Šé¢çš„åŸºæœ¬ç›®æ ‡ï¼Œè¿˜è¦æ±‚policyçš„æ¯ä¸€æ¬¡è¾“å‡ºçš„action ç†µentropyæœ€å¤§ï¼š</p>
<p>$$\pi^*=\arg\max_\pi\mathbb{E}_{(s_t,a_t)\sim\rho_\pi}[\sum_t\underbrace{R(s_t,a_t)}_{reward}+\alpha\underbrace{H(\pi(\cdot|s_t))}_{entropy}]\tag{2}$$</p>
<p>è¿™æ ·åšçš„åŸºæœ¬ç›®çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè®©ç­–ç•¥éšæœºåŒ–ï¼Œå³è¾“å‡ºçš„æ¯ä¸€ä¸ªactionçš„æ¦‚ç‡å°½å¯èƒ½åˆ†æ•£ï¼Œè€Œä¸æ˜¯é›†ä¸­åœ¨ä¸€ä¸ªactionä¸Šã€‚ä¸äº†è§£entropyçš„åŒå­¦å¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%E7%86%B5_%28%E4%BF%A1%E6%81%AF%E8%AE%BA%29"target="_blank" rel="external nofollow noopener noreferrer">wiki-ä¿¡æ¯ç†µ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>æˆ‘ä»¬çŸ¥é“DDPGè®­ç»ƒå¾—åˆ°çš„æ˜¯ä¸€ä¸ªdeterministic policyç¡®å®šæ€§ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªç­–ç•¥å¯¹äºä¸€ç§çŠ¶æ€stateåªè€ƒè™‘ä¸€ä¸ªæœ€ä¼˜çš„åŠ¨ä½œã€‚æ‰€ä»¥ï¼Œstochastic policyç›¸å¯¹deterministic policyæœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ</p>
<p>Stochastic policyéšæœºç­–ç•¥åœ¨å®é™…æœºå™¨äººæ§åˆ¶ä¸Šå¾€å¾€æ˜¯æ›´å¥½çš„åšæ³•ã€‚æ¯”å¦‚æˆ‘ä»¬è®©æœºå™¨äººæŠ“å–ä¸€ä¸ªæ°´æ¯ï¼Œæœºå™¨äººæ˜¯æœ‰æ— æ•°æ¡è·¯å¾„å»å®ç°è¿™ä¸ªè¿‡ç¨‹çš„ï¼Œè€Œå¹¶ä¸æ˜¯åªæœ‰å”¯ä¸€çš„ä¸€ç§åšæ³•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°±éœ€è¦drlç®—æ³•èƒ½å¤Ÿç»™å‡ºä¸€ä¸ªéšæœºç­–ç•¥ï¼Œåœ¨æ¯ä¸€ä¸ªstateä¸Šéƒ½èƒ½è¾“å‡ºæ¯ä¸€ç§actionçš„æ¦‚ç‡ï¼Œæ¯”å¦‚æœ‰3ä¸ªactionéƒ½æ˜¯æœ€ä¼˜çš„ï¼Œæ¦‚ç‡ä¸€æ ·éƒ½æœ€å¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä»è¿™äº›actionä¸­éšæœºé€‰æ‹©ä¸€ä¸ªåšå‡ºactionè¾“å‡ºã€‚<strong>æœ€å¤§ç†µmaximum entropyçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä¸é—è½åˆ°ä»»æ„ä¸€ä¸ªæœ‰ç”¨çš„actionï¼Œæœ‰ç”¨çš„trajectory</strong>ã€‚å¯¹æ¯”DDPGçš„deterministic policyçš„åšæ³•ï¼Œçœ‹åˆ°ä¸€ä¸ªå¥½çš„å°±æ¡èµ·æ¥ï¼Œå·®ä¸€ç‚¹çš„å°±ä¸è¦äº†ï¼Œè€Œæœ€å¤§ç†µæ˜¯éƒ½è¦æ¡èµ·æ¥ï¼Œéƒ½è¦è€ƒè™‘ã€‚</p>
<p><strong>åŸºäºæœ€å¤§ç†µçš„RLç®—æ³•æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</strong></p>
<p>ä»¥å‰ç”¨deterministic policyçš„ç®—æ³•ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä¸€æ¡æœ€ä¼˜è·¯å¾„ï¼Œå­¦ä¹ è¿‡ç¨‹ä¹Ÿå°±ç»“æŸäº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¿˜è¦æ±‚ç†µæœ€å¤§ï¼Œå°±æ„å‘³ç€ç¥ç»ç½‘ç»œéœ€è¦å»exploreæ¢ç´¢æ‰€æœ‰å¯èƒ½çš„æœ€ä¼˜è·¯å¾„ï¼Œè¿™å¯ä»¥äº§ç”Ÿä»¥ä¸‹å¤šç§ä¼˜åŠ¿ï¼š</p>
<ul>
<li>
<p>1ï¼‰å­¦åˆ°policyå¯ä»¥ä½œä¸ºæ›´å¤æ‚å…·ä½“ä»»åŠ¡çš„åˆå§‹åŒ–ã€‚å› ä¸ºé€šè¿‡æœ€å¤§ç†µï¼Œpolicyä¸ä»…ä»…å­¦åˆ°ä¸€ç§è§£å†³ä»»åŠ¡çš„æ–¹æ³•ï¼Œè€Œæ˜¯æ‰€æœ‰allã€‚å› æ­¤è¿™æ ·çš„policyå°±æ›´æœ‰åˆ©äºå»å­¦ä¹ æ–°çš„ä»»åŠ¡ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸€å¼€å§‹æ˜¯å­¦èµ°ï¼Œç„¶åä¹‹åè¦å­¦æœæŸä¸€ä¸ªç‰¹å®šæ–¹å‘èµ°ã€‚</p>
</li>
<li>
<p>2ï¼‰æ›´å¼ºçš„explorationèƒ½åŠ›ï¼Œè¿™æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œèƒ½å¤Ÿæ›´å®¹æ˜“çš„åœ¨å¤šæ¨¡æ€reward ï¼ˆmultimodal rewardï¼‰ä¸‹æ‰¾åˆ°æ›´å¥½çš„æ¨¡å¼ã€‚æ¯”å¦‚æ—¢è¦æ±‚æœºå™¨äººèµ°çš„å¥½ï¼Œåˆè¦æ±‚æœºå™¨äººèŠ‚çº¦èƒ½æº</p>
</li>
<li>
<p>3ï¼‰æ›´robusté²æ£’ï¼Œæ›´å¼ºçš„generalizationã€‚å› ä¸ºè¦ä»ä¸åŒçš„æ–¹å¼æ¥æ¢ç´¢å„ç§æœ€ä¼˜çš„å¯èƒ½æ€§ï¼Œä¹Ÿå› æ­¤é¢å¯¹å¹²æ‰°çš„æ—¶å€™èƒ½å¤Ÿæ›´å®¹æ˜“åšå‡ºè°ƒæ•´ã€‚ï¼ˆå¹²æ‰°ä¼šæ˜¯ç¥ç»ç½‘ç»œå­¦ä¹ è¿‡ç¨‹ä¸­çœ‹åˆ°çš„ä¸€ç§stateï¼Œæ—¢ç„¶å·²ç»æ¢ç´¢åˆ°äº†ï¼Œå­¦åˆ°äº†å°±å¯ä»¥æ›´å¥½çš„åšå‡ºååº”ï¼Œç»§ç»­è·å–é«˜rewardï¼‰</p>
</li>
</ul>
<p>æ—¢ç„¶æœ€å¤§ç†µRLç®—æ³•è¿™ä¹ˆå¥½ï¼Œæˆ‘ä»¬å½“ç„¶åº”è¯¥ç ”ç©¶å®ƒäº†ã€‚è€Œå®é™…ä¸Šï¼Œåœ¨ä¹‹å‰çš„DRLç®—æ³•<a href="https://link.zhihu.com/?target=https%3A//arxiv.org/abs/1602.01783"target="_blank" rel="external nofollow noopener noreferrer">A3C<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬å…¶å®å·²ç»ç”¨äº†ä¸€ä¸‹æœ€å¤§ç†µï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>åœ¨è®­ç»ƒpolicyçš„æ—¶å€™ï¼ŒA3CåŠ äº†entropyé¡¹ï¼Œä½œä¸ºä¸€ä¸ªregularizerï¼Œè®©policyæ›´éšæœºã€‚ä¸è¿‡A3Cè¿™ä¹ˆåšä¸»è¦æ˜¯ä¸ºäº†æ›´å¥½åšexplorationï¼Œæ•´ä½“çš„è®­ç»ƒç›®æ ‡ä¾ç„¶åªè€ƒè™‘rewardã€‚è¿™å’ŒSoft Actor-Criticçš„è®¾å®šè¿˜æ˜¯ä¸ä¸€æ ·çš„ï¼ŒSoft Actor-Criticæ˜¯çœŸæ­£æœ€å¤§ç†µDRLç®—æ³•ã€‚</p>
<h2 id="3-maximum-entropy-reinforcement-learningçš„bellmanæ–¹ç¨‹">3 Maximum Entropy Reinforcement Learningçš„Bellmanæ–¹ç¨‹</h2>
<p>æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹dynamic programmingä¸­Bellman backup equationï¼Œå‚è€ƒ<a href="https://link.zhihu.com/?target=http%3A//www0.cs.ucl.ac.uk/staff/d.silver/web/Teaching_files/MDP.pdf"target="_blank" rel="external nofollow noopener noreferrer">http://www0.cs.ucl.ac.uk/staff/d.silver/web/Teaching_files/MDP.pdf<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>$$q_\pi(s,a)=r(s,a)+\gamma\sum_{s^{\prime}\in\mathcal{S}}\mathcal{P}_{ss^{\prime}}^a\sum_{a^{\prime}\in\mathcal{A}}\pi(a^{\prime}|s^{\prime})q_\pi(s^{\prime},a^{\prime})\tag{3}$$</p>
<p>é‚£ä¹ˆå¯¹äºæœ€å¤§ç†µï¼ˆMaxEnt)çš„ç›®æ ‡ï¼Œå…¶å®å¯ä»¥æŠŠç†µä¹Ÿä½œä¸ºrewardçš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬åœ¨è®¡ç®—qå€¼æ—¶ï¼ˆè®°ä½qæ˜¯ç´¯åŠ rewardçš„æœŸæœ›ï¼Œä¼ ç»Ÿrlçš„ç›®æ ‡ç­‰ä»·äºè®©qæœ€å¤§ï¼‰ï¼Œå°±éœ€è¦è®¡ç®—æ¯ä¸€ä¸ªstateçš„ç†µentropy (entropyçš„å…¬å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>å› æ­¤æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°Soft Bellman Backup equation (Entropyé¡¹)é¢å¤–ä¹˜ä¸Š $\alpha$ ç³»æ•°ï¼š</p>
<p>$$q_\pi(s,a)=r(s,a)+\gamma\sum_{s^{\prime}\in\mathcal{S}}\mathcal{P}_{ss^{\prime}}^a\sum_{a^{\prime}\in\mathcal{A}}\pi(a^{\prime}|s^{\prime})(q_\pi(s^{\prime},a^{\prime})-\alpha\log(\pi(a^{\prime}|s^{\prime}))\quad(4)$$</p>
<p>Recallä¸€ä¸‹<a href="https://link.zhihu.com/?target=http%3A//www0.cs.ucl.ac.uk/staff/d.silver/web/Teaching_files/MC-TD.pdf"target="_blank" rel="external nofollow noopener noreferrer">Dynamic Programming Backup<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
å¯¹åº”Qå€¼çš„å…¬å¼æ˜¯
<p>$$Q(s_t,a_t)=r(s_t,a_t)+\gamma\mathbb{E}_{s_{t+1},a_{t+1}}[Q(s_{t+1},a_{t+1})]\tag{5}$$</p>
<p>æ ¹æ®å…¬å¼ï¼ˆ4ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°Soft Bellman Backupçš„ æ›´æ–°å…¬å¼ï¼š</p>
<p>$$Q_{soft}(s_t,a_t)=r(s_t,a_t)+\gamma\mathbb{E}_{s_{t+1},a_{t+1}}[Q_{soft}(s_{t+1},a_{t+1})-\alpha\log(\pi(a_{t+1}|s_{t+1}))]\tag{6}$$</p>
<p>ä¸Šé¢å…¬å¼ï¼ˆ6ï¼‰æ˜¯ç›´æ¥ä½¿ç”¨dynamic programmingï¼Œå°†entropyåµŒå…¥è®¡ç®—å¾—åˆ°çš„ç»“æœã€‚æˆ‘ä»¬å¯ä»¥åè¿‡æ¥å…ˆç›´æ¥æŠŠentropyä½œä¸ºrewardçš„ä¸€éƒ¨åˆ†ï¼š</p>
<p>$$r_{soft}(s_t,a_t)=r(s_t,a_t)+\gamma\alpha\mathbb{E}_{s_{t+1}\sim\rho}H(\pi(\cdot|s_{t+1}))\tag{7}$$</p>
<p>æˆ‘ä»¬å°†ï¼ˆ7ï¼‰å¸¦å…¥åˆ°å…¬å¼ï¼ˆ5ï¼‰ï¼š</p>
<p>$$\begin{aligned}
{Q_{soft}(s_{t},a_{t})} &amp;=r(s_t,a_t)+\gamma\alpha\mathbb{E}_{s_{t+1}\sim\rho}H(\pi(\cdot|s_{t+1}))+\gamma\mathbb{E}_{s_{t+1},a_{t+1}}[Q_{soft}(s_{t+1},a_{t+1})]\\
&amp;=r(s_t,a_t)+\gamma\mathbb{E}_{s_{t+1}\sim\rho,a_{t+1}\sim\pi}[Q_{soft}(s_{t+1},a_{t+1})]+\gamma\alpha\mathbb{E}_{s_{t+1}\sim\rho}H(\pi(\cdot|s_{t+1}))\\
&amp;=r(s_t,a_t)+\gamma\mathbb{E}_{s_{t+1}\sim\rho,a_{t+1}\sim\pi}[Q_{soft}(s_{t+1},a_{t+1})]+\gamma\mathbb{E}_{s_{t+1}\sim\rho}\mathbb{E}_{a_{t+1}\sim\pi}[-\alpha\log\pi(a_{t+1}|s_{t+1})]\\
&amp;=r(s_t,a_t)+\gamma\mathbb{E}_{s_{t+1}\sim\rho}[\mathbb{E}_{a_{t+1}\sim\pi}[Q_{soft}(s_{t+1},a_{t+1})-\alpha\log(\pi(a_{t+1}|s_{t+1}))]]\\&amp;=r(s_t,a_t)+\gamma\mathbb{E}_{s_{t+1},a_{t+1}}[Q_{soft}(s_{t+1},a_{t+1})-\alpha\log(\pi(a_{t+1}|s_{t+1}))]\end{aligned}$$</p>
<p>å¯ä»¥å¾—åˆ°ä¸€æ ·çš„ç»“æœã€‚</p>
<p>ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬çŸ¥é“:</p>
<p>$$Q(s_t,a_t)=r(s_t,a_t)+\gamma\mathbb{E}_{s_{t+1}\sim\rho}[V(s_{t+1})]\tag{9}$$</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ï¼š</p>
<p>$$V_{soft}(s_t)=\mathbb{E}_{a_t\sim\pi}[Q_{soft}(s_t,a_t)-\alpha\log\pi(a_t|s_t)]\tag{10}$$</p>
<p>è‡³æ­¤æˆ‘ä»¬ç†æ¸…æ¥šäº†SAC paperåŸæ–‡ä¸­çš„å…¬å¼(2)å’Œ(3)ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>å¹¶ä¸”ï¼ˆ7ï¼‰çš„åšæ³•ç›´æ¥è¯æ˜äº†Lemma 1 Soft Policy Evaluation (<strong>è¿™ä¸ªlemmaä¸ºä¸‹ä¸€éƒ¨åˆ†çš„soft policy iterationæä¾›æ”¯æ’‘</strong>ï¼‰:</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ä¸Šé¢çš„æ•´ä¸ªæ¨å¯¼è¿‡ç¨‹éƒ½æ˜¯å›´ç»•maximum entropyï¼Œå’Œsoft å¥½åƒæ²¡æœ‰ä»€ä¹ˆç›´æ¥å…³ç³»ã€‚æ‰€ä»¥ï¼Œ</p>
<p><strong>ä¸ºä»€ä¹ˆç§°ä¸ºsoftï¼Ÿå“ªé‡Œsoftäº†ï¼Ÿä»¥åŠä¸ºä»€ä¹ˆsoft Q functionèƒ½å¤Ÿå®ç°maximum entropyï¼Ÿ</strong></p>
<p>ç†è§£æ¸…æ¥šè¿™ä¸ªé—®é¢˜æ˜¯ç†è§£æ˜ç™½soft q-learningåŠsacçš„å…³é”®ï¼</p>
<p>SACè¿™ç¯‡paperç›´æ¥è·³è¿‡äº†soft Q-functionçš„å®šä¹‰é—®é¢˜ï¼Œå› æ­¤ï¼Œè¦ææ¸…æ¥šä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä»Soft Q-Learningçš„paperæ¥å¯»æ‰¾ç­”æ¡ˆã€‚</p>
<p>å‚è€ƒ<a href="https://link.zhihu.com/?target=https%3A//bair.berkeley.edu/blog/2017/10/06/soft-q-learning/"target="_blank" rel="external nofollow noopener noreferrer">Learning Diverse Skills via Maximum Entropy Deep Reinforcement Learning<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ä¸Šé¢çš„æ›²çº¿å¾ˆæ˜æ˜¾çš„è¯´æ˜äº†stochastic policyçš„é‡è¦æ€§ï¼Œé¢å¯¹å¤šæ¨¡çš„ï¼ˆmultimodalï¼‰çš„Q functionï¼Œä¼ ç»Ÿçš„RLåªèƒ½æ”¶æ•›åˆ°ä¸€ä¸ªé€‰æ‹©ï¼ˆå·¦å›¾ï¼‰ï¼Œè€Œæ›´ä¼˜çš„åŠæ³•æ˜¯å³å›¾ï¼Œè®©policyä¹Ÿç›´æ¥ç¬¦åˆQçš„åˆ†å¸ƒã€‚è¿™é‡Œï¼Œæœ€ç›´æ¥çš„ä¸€ç§åŠæ³•å°±æ˜¯å®šä¹‰è¿™æ ·çš„energy-based policyï¼š</p>
<p>\pi(a_t|s_t)\propto exp(-\mathcal{E}(s_t,a_t)) ï¼ˆ11ï¼‰</p>
<p>å…¶ä¸­ \mathcal{E} æ˜¯èƒ½é‡å‡½æ•°ï¼Œä¸Šé¢çš„å½¢å¼å°±æ˜¯Boltzmann Distribution <a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%E7%8E%BB%E5%B0%94%E5%85%B9%E6%9B%BC%E5%88%86%E5%B8%83"target="_blank" rel="external nofollow noopener noreferrer">ç»å°”å…¹æ›¼åˆ†å¸ƒ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a> ã€‚ä¸‹å›¾çš„ -f(x)=\mathcal{E}</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p><a href="https://deepgenerativemodels.github.io/assets/slides/cs236_lecture13.pdf"target="_blank" rel="external nofollow noopener noreferrer">https://deepgenerativemodels.github.io/assets/slides/cs236_lecture13.pdf<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>ä¸ºäº†è¿æ¥soft Q functionï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®š</p>
<p>$$\mathcal{E}(s_t,a_t)=-\frac{1}{\alpha}Q_{soft}(s_t,a_t)\tag{12}$$</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æœ‰</p>
<p>$$\pi(a_t|s_t)\propto exp(Q_{soft}(s_t,a_t))\tag{13}$$</p>
<p>è¿™æ ·çš„policyèƒ½å¤Ÿä¸ºæ¯ä¸€ä¸ªactionèµ‹å€¼ä¸€ä¸ªç‰¹å®šçš„æ¦‚ç‡ç¬¦åˆQå€¼çš„åˆ†å¸ƒï¼Œä¹Ÿå°±æ»¡è¶³äº†stochastic policyçš„éœ€æ±‚ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬è¦<strong>å‘ç°(13)çš„å½¢å¼æ­£å¥½å°±æ˜¯æœ€å¤§ç†µRLçš„optimal policyæœ€ä¼˜ç­–ç•¥çš„å½¢å¼ï¼Œè€Œè¿™å®ç°äº†soft q functionå’Œmaximum entropyçš„è¿æ¥ã€‚</strong></p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>å®é™…ä¸Šæˆ‘ä»¬ç†è§£Soft Q-LearningåŠSoft Actor Criticï¼Œè¦æ¸…æ¥šä¸Šå›¾ä¸‰è€…çš„å…³ç³»ã€‚åœ¨Soft Q-Learningé‚£ç¯‡paperä¸­ï¼Œä»–æ˜¯ä»Soft Value Functionçš„å®šä¹‰å‡ºå‘å»è¿æ¥Energy-Based Policy å’ŒMaximum Entropy Objectiveçš„å…³ç³»ã€‚è€Œåœ¨æœ¬blogä¸­ï¼Œæˆ‘ä»¬ä»Maximum Entropy Objectiveå‡ºå‘ï¼Œæ¥è¿æ¥å…¶ä»–ä¸¤éƒ¨åˆ†ã€‚</p>
<p>å‰é¢æˆ‘ä»¬å·²ç»æ¨å¯¼å¾—åˆ°äº†å…¬å¼ï¼ˆ10ï¼‰ï¼Œé‚£ä¹ˆæ ¹æ®å…¬å¼ï¼ˆ10ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ¨å¯¼å¾—åˆ°policyçš„å½¢å¼ï¼š</p>
<p>$$\begin{aligned}\pi(s_{t},a_{t})&amp;=\exp(\frac1\alpha(Q_{soft}(s_t,a_t)-V_{soft}(s_t)))\\&amp;&amp;\text{(14)}\\&amp;=\frac{\exp(\frac1\alpha Q_{soft}(s_t,a_t))}{\exp(\frac1\alpha V_{soft}(s_t))}\end{aligned}$$</p>
<p>ï¼ˆ14ï¼‰ç¬¦åˆäº†ï¼ˆ13ï¼‰ï¼Œ $\frac{1}{\alpha}V_{soft}(s_t)$ å¯ä»¥çœ‹åšæ˜¯å¯¹åº”çš„log partition function. ç”±æ­¤ï¼Œå°±è¿æ¥äº†Maximum Entropy Objectiveå’ŒEnergy Based Policyçš„å…³ç³»ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬è¦è¿æ¥Soft Value Functionã€‚ä»ï¼ˆ14ï¼‰çš„ $\frac{1}{\alpha}V_{soft}(s_t)$ å·²ç»å¾ˆæ˜æ˜¾äº†ï¼š</p>
<p>$$\exp(\frac1\alpha V_{soft}(s_t))=\int\exp(\frac1\alpha Q_{soft}(s_t,a))d\mathbf{a} (15)$$</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ $V_{soft}(s_t)$ :</p>
<p>$$V_{soft}(s_t)\triangleq\alpha\log\int\exp(\frac1\alpha Q_{soft}(s_t,a))d\mathbf{a}\tag{16}$$</p>
<p>è¿™å’Œsoft æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ(16ï¼‰å…¶å®æ˜¯LogSumExpçš„ç§¯åˆ†å½¢å¼ï¼Œå°±æ˜¯smooth maximum/soft maximum (è½¯çš„æœ€å¤§ï¼‰ã€‚å‚è€ƒ<a href="https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/LogSumExp"target="_blank" rel="external nofollow noopener noreferrer">https://en.wikipedia.org/wiki/LogSumExp<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>æ‰€ä»¥å°±å¯ä»¥å®šä¹‰</p>
<p>$$\mathrm{soft}\max_af(a):=\log\int\exp f(a)da\tag{17}$$</p>
<p>å› æ­¤æˆ‘ä»¬ä¹Ÿå°±å¯ä»¥æ ¹æ®å…¬å¼ï¼ˆ9ï¼‰å®šä¹‰softçš„Q-functionï¼š</p>
<p>$$Q_{soft}(s_t,a_t)=\mathbb{E}\left[r_t+\gamma\text{ soft}\max_aQ(s_{t+1},a)\right]\text{(18)}$$</p>
<p>æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆç§°ä¸ºsoftæ˜¯ä»è¿™é‡Œæ¥çš„ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå¸¸è§çš„ç–‘é—®å°±æ˜¯è¿™é‡Œçš„soft maxå’Œæˆ‘ä»¬å¸¸è§çš„softmaxå¥½åƒä¸ä¸€æ ·å•Šã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬åœ¨ç¥ç»ç½‘ç»œä¸­å¸¸ç”¨çš„activation function softmax å®é™…ä¸Šæ˜¯soft argmaxï¼Œæ ¹æ®ä¸€å †logitsæ‰¾åˆ°å¯¹åº”çš„è½¯çš„æœ€å¤§å€¼å¯¹åº”çš„indexã€‚å…·ä½“å‚çœ‹ï¼š<a href="https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Softmax_function"target="_blank" rel="external nofollow noopener noreferrer">https://en.wikipedia.org/wiki/Softmax_function<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>ä¸Šé¢çš„æ¨å¯¼è¿˜åªæ˜¯é¢å‘policyçš„valueå’ŒQï¼Œæˆ‘ä»¬ä¸‹é¢è¦è¯´æ˜optimal policyä¹Ÿå¿…ç„¶æ˜¯energy-based policyçš„å½¢å¼ã€‚</p>
<p>è¿™ä¸€éƒ¨åˆ†çš„è¯æ˜ä¾é  Policy improvement theoremï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>å…·ä½“è¯æ˜è¿‡ç¨‹è§soft q-learningåŸæ–‡çš„A.1ã€‚</p>
<p>æœ‰äº†Theorem 4ï¼Œ</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°optimal policyå¿…ç„¶æ˜¯energy based policyï¼Œä¹Ÿå› æ­¤ï¼Œæˆ‘ä»¬æœ‰äº†soft q learning paperä¸­æœ€å¼€å§‹çš„å®šä¹‰ï¼š</p>
<p>$$\pi_{MaxEnt}^<em>(a_t|s_t)=\exp(\frac{1}{\alpha}(Q_{soft}^</em>(s_t,a_t)-V_{soft}^*(s_t)))\text{(19)}$$</p>
<h2 id="4-policy-iteration">4 Policy Iteration</h2>
<p>ç†æ¸…æ¥šäº†ä¸Šé¢çš„åŸºæœ¬å®šä¹‰å’Œè”ç³»ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç ”ç©¶æ€ä¹ˆæ›´æ–°policyäº†ï¼Œä¹Ÿå°±æ˜¯policy iterationã€‚</p>
<p>å›é¡¾ä¸€ä¸‹ä¸€èˆ¬çš„<a href="https://link.zhihu.com/?target=http%3A//www0.cs.ucl.ac.uk/staff/d.silver/web/Teaching_files/DP.pdf"target="_blank" rel="external nofollow noopener noreferrer">Policy Iteration<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>åœ¨ä¸¤æ­¥ä¸­è¿›è¡Œå¾ªç¯è¿­ä»£ï¼ˆæˆ‘ä»¬ç›´æ¥ä½¿ç”¨Qå€¼æ¥è¯´æ˜ï¼‰ï¼š</p>
<ol>
<li>Policy evaluationï¼šå›ºå®špolicyï¼Œä½¿ç”¨Bellmanæ–¹ç¨‹æ›´æ–°Qå€¼ç›´åˆ°æ”¶æ•›ï¼š</li>
</ol>
<p>$$Q_\pi(s,a)=r(s,a)+\lambda\mathbb{E}_{s^{\prime},a^{\prime}}Q_\pi(s^{\prime},a^{\prime})\tag{20}$$</p>
<ol start="2">
<li>Policy improvement: æ›´æ–°policyï¼š</li>
</ol>
<p>$$\pi^{\prime}(s)=\arg\max_aQ_\pi(s,a)\tag{21}$$</p>
<p>åŸºäºåŒæ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æœ‰Soft Policy Iterationï¼š</p>
<ol>
<li>Soft policy evaluation:å›ºå®špolicyï¼Œä½¿ç”¨Bellmanæ–¹ç¨‹æ›´æ–°Qå€¼ç›´åˆ°æ”¶æ•›:</li>
</ol>
<p>$$\begin{aligned}&amp;Q_{soft}^\pi(s_t,a_t)=r(s_t,a_t)+\lambda\mathbb{E}_{s_{t+1},a_{t+1}}\left[Q_{soft}^\pi(s_{t+1},a_{t+1})-\alpha\log(\pi(a_{t+1}|s_{t+1}))\right]\tag{22}\end{aligned}$$</p>
<ol start="2">
<li>Soft policy improvement: æ›´æ–°policyï¼š</li>
</ol>
<p>$$\pi^{\prime}=\arg\min_{\pi_k\in\Pi}D_{KL}(\pi_k(\cdot|s_t)||\frac{\exp(\frac{1}{\alpha}Q_{soft}^{\pi}(s_t,\cdot))}{Z_{soft}^{\pi}(s_t)}) \tag{23}$$</p>
<p>(22)åŸºäºä¸Šä¸€éƒ¨åˆ†è¯´çš„Lemma 1 Soft Policy Evaluation, å¯æ”¶æ•›ã€‚</p>
<p>(23)åˆ™åŸºäºä¸Šä¸€éƒ¨åˆ†çš„Theorem 4 Policy Improvement Theoremã€‚åªæ˜¯è¿™é‡Œçš„åšæ³•ä¸æ˜¯ç›´æ¥èµ‹å€¼ï¼Œè€Œæ˜¯é€šè¿‡KL divergenceæ¥è¶‹è¿‘ $\exp(Q^{\pi}_{soft}(s_t,\cdot))$ ã€‚åœ¨SACçš„paperåŸæ–‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¹ˆåšçš„åŸå› æ˜¯ä¸ºäº†é™åˆ¶policyåœ¨ä¸€å®šèŒƒå›´çš„policies $\Pi$ ä¸­ä»è€Œtractableï¼Œpolicyçš„åˆ†å¸ƒå¯ä»¥æ˜¯é«˜æ–¯åˆ†å¸ƒã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>åŒæ ·çš„ï¼Œä½œè€…ä¹Ÿä¸“é—¨è¯æ˜äº†é‡‡ç”¨KL divergenceçš„æ–¹æ³•ä¸€æ ·èƒ½å¤Ÿä¿è¯policy improvementï¼Œä¹Ÿå°±æ˜¯Lemma 2ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>æœ€åï¼Œå°±æ˜¯è¯æ˜ä¸Šé¢çš„Soft Policy Iterationè¿‡ç¨‹èƒ½ä¿è¯policyæ”¶æ•›åˆ°æœ€ä¼˜ï¼Œå³Theorem 1ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ç”±æ­¤ï¼ŒåŸºæœ¬çš„ç†è®ºå»ºè®¾ä¹Ÿå°±ç»“æŸäº†ï¼Œä¸‹é¢è¿›å…¥Soft Actor-Criticçš„ç®—æ³•è®¾è®¡ã€‚</p>
<h2 id="5-soft-actor-critic">5 Soft Actor-Critic</h2>
<p>SACç®—æ³•çš„æ„å»ºé¦–å…ˆæ˜¯ç¥ç»ç½‘ç»œåŒ–ï¼Œæˆ‘ä»¬ç”¨ç¥ç»ç½‘ç»œæ¥è¡¨ç¤ºQå’ŒPolicyï¼š $Q_{\theta}(s_t,a_t)$ å’Œ $\pi_{\phi}(a_t|s_t)$ ã€‚Qç½‘ç»œæ¯”è¾ƒç®€å•ï¼Œå‡ å±‚çš„MLPæœ€åè¾“å‡ºä¸€ä¸ªå•å€¼è¡¨ç¤ºQå°±å¯ä»¥äº†ï¼ŒPolicyç½‘ç»œéœ€è¦è¾“å‡ºä¸€ä¸ªåˆ†å¸ƒï¼Œä¸€èˆ¬æ˜¯è¾“å‡ºä¸€ä¸ªGaussian åŒ…å«meanå’Œcovarianceã€‚ä¸‹é¢å°±æ˜¯æ„å»ºç¥ç»ç½‘ç»œçš„æ›´æ–°å…¬å¼ã€‚</p>
<p>å¯¹äºQç½‘ç»œçš„æ›´æ–°ï¼Œæˆ‘ä»¬æ ¹æ®ï¼ˆ10ï¼‰å¯ä»¥å¾—åˆ°ï¼š</p>
<p>$$\begin{aligned}
J_{Q}(\theta)&amp; =\mathbb{E}_{(s_t,a_t,s_{t+1})\sim\mathcal{D}}[\frac{1}{2}(Q_\theta(s_t,a_t)-(r(s_t,a_t)+\gamma V_{\bar{\theta}}(s_{t+1})))^2] \\
&amp;=\mathbb{E}_{(s_t,a_t,s_{t+1})\sim\mathcal{D},a_{t+1}\sim\pi_\phi}[\frac12(Q_\theta(s_t,a_t)-(r(s_t,a_t)+\gamma(Q_{\bar{\theta}}(s_{t+1},a_{t+1})-\alpha\log(\pi_\phi(a_{t+1}|s_{t+1})))))^2] \tag{24}
\end{aligned}$$</p>
<p>è¿™é‡Œå’ŒDDPGä¸€æ ·ï¼Œæ„é€ äº†ä¸€ä¸ªtarget soft Q ç½‘ç»œå¸¦å‚æ•° $\overline{\theta}$ ï¼Œè¿™ä¸ªå‚æ•°é€šè¿‡exponentially moving average Qç½‘ç»œçš„å‚æ•° $\theta$ å¾—åˆ°ã€‚(ps:åœ¨ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„SACä¸­ï¼Œä»–ä»¬å•ç‹¬å®šä¹‰äº†Vç½‘ç»œè¿›è¡Œæ›´æ–°ï¼Œè¯´æ˜¯æ›´ç¨³å®šï¼Œåˆ°æ–°ç‰ˆçš„SACä¸­ï¼Œç”±äºè‡ªåŠ¨æ›´æ–°temperature $\alpha$ å°±ç›´æ¥ä½¿ç”¨Qç½‘ç»œæ›´æ–°ï¼‰</p>
<p>å¯¹äºPolicy ç½‘ç»œå‚æ•°çš„æ›´æ–°ï¼Œå°±æ˜¯æœ€å°åŒ–KL divergenceï¼š</p>
<p>$$\begin{aligned}
J_{\pi}(\phi)&amp; =D_{\mathrm{KL}}\left(\pi_\phi(.\left|s_t\right)|\exp(\frac1\alpha Q_\theta(s_t,.)-\log Z(s_t))\right) \\
&amp;=\mathbb{E}_{s_t\sim\mathcal{D},a_t\sim\pi_\phi}\Big[\log\big(\frac{\pi_\phi(a_t|s_t)}{\exp(\frac{1}{\alpha}Q_\theta(s_t,a_t)-\log Z(s_t))}\big)\Big] \\
&amp;=\mathbb{E}_{s_t\sim\mathcal{D},a_t\sim\pi_\phi}[\log\pi_\phi(a_t|s_t)-\frac1\alpha Q_\theta(s_t,a_t)+\log Z(s_t)] \tag{25}
\end{aligned}$$</p>
<p>è¿™é‡Œçš„actionæˆ‘ä»¬é‡‡ç”¨reparameterization trickæ¥å¾—åˆ°ï¼Œå³</p>
<p>$$a_t=f_\phi(\varepsilon_t;s_t)=f_\phi^\mu(s_t)+\varepsilon_t\odot f_\phi^\sigma(s_t)\tag{26}$$</p>
<p>få‡½æ•°è¾“å‡ºå¹³å‡å€¼å’Œæ–¹å·®ï¼Œç„¶å $\varepsilon$ æ˜¯noiseï¼Œä»æ ‡å‡†æ­£æ€åˆ†å¸ƒé‡‡æ ·ã€‚ä½¿ç”¨è¿™ä¸ªtrickï¼Œæ•´ä¸ªè¿‡ç¨‹å°±æ˜¯å®Œå…¨å¯å¾®çš„(loss ä¹˜ä»¥ $\alpha$ å¹¶å»æ‰ä¸å½±å“æ¢¯åº¦çš„å¸¸é‡log partition function Z(s_t)) ï¼š</p>
<p>$$J_\pi(\phi)=\mathbb{E}_{s_t\sim\mathcal{D},\varepsilon\sim\mathcal{N}}[\alpha\log\pi_\phi(f_\phi(\varepsilon_t;s_t)|s_t)-Q_\theta(s_t,f_\phi(\varepsilon_t;s_t))] \tag{27}$$</p>
<p>è¿™æ ·åŸºæœ¬çš„Soft Actor-Criticçš„æ›´æ–°æ–¹æ³•ä¹Ÿå°±å¾—åˆ°äº†ã€‚</p>
<h2 id="6-temperature-hyperparameter-auto-adjustment">6 Temperature Hyperparameter Auto-Adjustment</h2>
<p>å‰é¢çš„SACä¸­ï¼Œæˆ‘ä»¬åªæ˜¯äººä¸ºç»™å®šä¸€ä¸ªå›ºå®šçš„temperature $\alpha$ ä½œä¸ºentropyçš„æƒé‡ï¼Œä½†å®é™…ä¸Šç”±äºrewardçš„ä¸æ–­å˜åŒ–ï¼Œé‡‡ç”¨å›ºå®šçš„temperatureå¹¶ä¸åˆç†ï¼Œä¼šè®©æ•´ä¸ªè®­ç»ƒä¸ç¨³å®šï¼Œå› æ­¤ï¼Œæœ‰å¿…è¦èƒ½å¤Ÿè‡ªåŠ¨è°ƒèŠ‚è¿™ä¸ªtemperatureã€‚å½“policyæ¢ç´¢åˆ°æ–°çš„åŒºåŸŸæ—¶ï¼Œæœ€ä¼˜çš„actionè¿˜ä¸æ¸…æ¥šï¼Œåº”è¯¥è°ƒæ•´temperature $\alpha$ å»æ¢ç´¢æ›´å¤šçš„ç©ºé—´ã€‚å½“æŸä¸€ä¸ªåŒºåŸŸå·²ç»æ¢ç´¢å¾—å·®ä¸å¤šï¼Œæœ€ä¼˜çš„actionåŸºæœ¬ç¡®å®šäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªtemperatureå°±å¯ä»¥å‡å°ã€‚</p>
<p>è¿™é‡Œï¼ŒSACçš„ä½œè€…æ„é€ äº†ä¸€ä¸ªå¸¦çº¦æŸçš„ä¼˜åŒ–é—®é¢˜ï¼Œè®©å¹³å‡çš„entropyæƒé‡æ˜¯æœ‰é™åˆ¶çš„ï¼Œä½†æ˜¯åœ¨ä¸åŒçš„stateä¸‹entropyçš„æƒé‡æ˜¯å¯å˜çš„ï¼Œå³</p>
<p>$$\max_{\pi_0,\ldots,\pi_T}\mathbb{E}\bigg[\sum_{t=0}^Tr(s_t,a_t)\bigg]\mathrm{s.t.~}\forall t, \mathcal{H}(\pi_t)\geq\mathcal{H}_0\tag{28}$$</p>
<p>å¯¹äºè¿™éƒ¨åˆ†å†…å®¹ï¼Œ<a href="https://link.zhihu.com/?target=https%3A//lilianweng.github.io/lil-log/2018/04/08/policy-gradient-algorithms.html%23sac"target="_blank" rel="external nofollow noopener noreferrer">Policy Gradient Algorithms<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a> è¿™ä¸ªopenaiå°å§å§çš„blogä»‹ç»å¾—æå…¶æ¸…æ¥šï¼Œå¤§å®¶å¯ä»¥å‚è€ƒï¼Œæœ€åå¾—åˆ°temperatureçš„lossï¼š</p>
<p>$$J(\alpha)=\mathbb{E}_{a_t\sim\pi_t}[-\alpha\log\pi_t(a_t\mid\pi_t)-\alpha\mathcal{H}_0]\tag{29}$$</p>
<p>ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å®Œæ•´çš„Soft Actor-Criticç®—æ³•ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ä¸ºäº†æ›´å¿«é€Ÿç¨³å®šçš„è®­ç»ƒï¼Œä½œè€…å¼•å…¥äº†ä¸¤ä¸ªQç½‘ç»œï¼Œç„¶åæ¯æ¬¡é€‰æ‹©Qå€¼å°çš„ä¸€ä¸ªä½œä¸ºtarget Qå€¼ã€‚æ›´æ–°Qï¼ŒPolicyåŠ \alpha ä½¿ç”¨ä¸Šæ–‡çš„ï¼ˆ24ï¼‰ï¼ˆ27ï¼‰ï¼ˆ29ï¼‰ä¸‰ä¸ªå…¬å¼ã€‚</p>
<h2 id="7-ç¥ç»ç½‘ç»œç»“æ„">7 ç¥ç»ç½‘ç»œç»“æ„</h2>
<p>è™½ç„¶ä¸Šé¢æŠŠç®—æ³•æµç¨‹ç¡®å®šäº†ï¼Œä½†æ˜¯å¦‚ä½•æ„é€ policyçš„ç¥ç»ç½‘ç»œè¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚ä¸‹å›¾æ˜¯å¸¦Vç½‘ç»œçš„ç¥ç»ç½‘ç»œç»“æ„å›¾ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p><a href="https://nervanasystems.github.io/coach/components/agents/policy_optimization/sac.html"target="_blank" rel="external nofollow noopener noreferrer">https://nervanasystems.github.io/coach/components/agents/policy_optimization/sac.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>æˆ‘ä»¬ä¸»è¦æ¥æ¢ç©¶ä¸€ä¸‹Policyç½‘ç»œçš„è®¾è®¡ã€‚</p>
<p>è§ä¸Šå›¾å³ä¸Šè§’çš„Policyç½‘ç»œï¼Œå‰é¢çš„input embedderå’ŒMiddlewareä¸ç”¨è¯´ï¼Œå°±æ˜¯å‡ å±‚çš„MLPã€‚ç„¶åï¼Œæ¥ä¸‹æ¥ç¥ç»ç½‘ç»œåˆ†æˆä¸¤ä¸ªåˆ†æ”¯ï¼Œåˆ†åˆ«è¾“å‡ºå¹³å‡å€¼mean $\mu$ å’Œlog æ ‡å‡†å·® log std ã€‚ç„¶åä½¿ç”¨expå¾—åˆ°stdã€‚</p>
<p>$$\pi_\phi(s_t) = \mu_t,\log \sigma_t \tag{30}$$</p>
<p>$$\sigma_t = \exp(\log \sigma_t)$$</p>
<p>æ­£å¸¸è¾“å‡ºè¿™æ ·çš„é«˜æ–¯åˆ†å¸ƒä½œä¸ºaction çš„åˆ†å¸ƒdistributionæ˜¯OKçš„ï¼Œä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œè¿™ä¸ªactionéœ€è¦é™å®šåœ¨ä¸€å®šèŒƒå›´å†…ã€‚å› æ­¤ï¼Œè¿™é‡Œä½œè€…ä½¿ç”¨äº†squashing function tanhï¼Œå°†actioné™åˆ¶åœ¨ï¼ˆ-1,1ï¼‰ä¹‹é—´ï¼Œå³</p>
<p>$$\mathbf{u}_t =\mu_t + \varepsilon_t \odot \sigma_t $$</p>
<p>$$a_t = \tanh (\mathbf{u}) \tag{31}$$</p>
<p>è¿™é‡Œå’Œä¸Šæ–‡çš„å…¬å¼ï¼ˆ26ï¼‰å¯¹åº”ï¼Œå¤šäº†ä¸€ä¸ªtanhã€‚</p>
<p>é‚£ä¹ˆè¿™ä¼šå¯¼è‡´åˆ†å¸ƒçš„å˜åŒ–ï¼Œä»è€Œå½±å“log likelihoodçš„è®¡ç®—ï¼Œè€Œè¿™æ˜¯æˆ‘ä»¬è®¡ç®—SACçš„losså¿…é¡»çš„ã€‚ä½œè€…åœ¨paperä¸­ç»™å‡ºäº†è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<p>$$\log \pi(a|s)=\log \mu(\mathbf{u}|s)-\sum_{i=1}^{D}{\log(1-\tanh^2(u_i))} \tag{32}$$</p>
<p>å…¶ä¸­ u_i æ˜¯ $\mathbf{u}$ çš„ç¬¬iä¸ªå…ƒç´ ã€‚è¿™é‡Œçš„ $\mu(\mathbf{u}|s)$ æ˜¯æ²¡æœ‰åŠ é™åˆ¶æ—¶çš„likelihood functionä¹Ÿå°±æ˜¯é«˜æ–¯åˆ†å¸ƒçš„likelihood functionä¼¼ç„¶å‡½æ•°ã€‚é«˜æ–¯åˆ†å¸ƒçš„log likelihoodç›´æ¥ä½¿ç”¨pytorchçš„<a href="https://link.zhihu.com/?target=https%3A//pytorch.org/docs/stable/_modules/torch/distributions/normal.html"target="_blank" rel="external nofollow noopener noreferrer">Normal<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a> classå°±å¯ä»¥è·å¾—ã€‚</p>
<h2 id="8-å…¶ä»–ç»†èŠ‚">8 å…¶ä»–ç»†èŠ‚</h2>
<p>1ï¼‰SACé‡Œçš„target entropy è®¾è®¡ä¸º</p>
<p>$$\mathcal{H}_0 = -\dim (\mathcal{A}) \tag{33}$$</p>
<p>å³-åŠ¨ä½œæ•°é‡ã€‚</p>
<p>2ï¼‰SAC paperé‡Œå®Œå…¨æ²¡æœ‰è¯´æ˜çš„è®­ç»ƒæ—¶çš„episodeè®¾ç½®ã€‚SACè®¾ç½®ä¸ºæ¯ä¸€ä¸ªepisodeé‡‡æ ·1000æ¬¡ç„¶åè®­ç»ƒ1000æ¬¡ã€‚</p>
<p>3ï¼‰åœ¨ä»£ç ä¸­SACä½¿ç”¨ log alphaä½œä¸ºæ›´æ–°çš„å‚æ•°ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨alphaå¦‚å…¬å¼ï¼ˆ25ï¼‰ï¼Œè¿™å’Œè¾“å‡ºlog stdæ˜¯ä¸€æ ·çš„ï¼Œä½¿ç”¨logæœ‰å¾ˆå¤§çš„æ­£è´ŸèŒƒå›´ï¼Œæ›´æ–¹ä¾¿ç½‘ç»œè¾“å‡ºã€‚å¦åˆ™alphaæˆ–è€…stdéƒ½æ˜¯æ­£å€¼ã€‚</p>
<p>4ï¼‰SACæœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œå®ƒçš„policyçš„ç›®çš„æ˜¯è¶‹è¿‘äºç»å°”å…¹æ›¼åˆ†å¸ƒï¼Œä½†æ˜¯å®é™…å®ç°çš„æ—¶å€™ï¼Œä¸ºäº†èƒ½å¤Ÿtractableï¼Œé€‰æ‹©äº†è¾“å‡ºä¸€ä¸ªé«˜æ–¯ï¼Œä¹Ÿå°±æ˜¯è®©é«˜æ–¯è¶‹è¿‘äºç»å°”å…¹æ›¼åˆ†å¸ƒã€‚è¿™æ„å‘³ç€SACæœ¬è´¨ä¸Šè¿˜æ˜¯unimodalçš„ç®—æ³•ï¼Œè€Œä¸æ˜¯soft q-learningçš„multi-modalã€‚è¿™ä½¿å¾—SACçš„åˆ›æ–°æ€§æ‰“äº†å¾ˆå¤§çš„æŠ˜æ‰£ã€‚ä½†æ˜¯ç®—æ³•æ•ˆæœç¡®å®è¿˜æ˜¯ä¸é”™çš„ã€‚</p>
<h2 id="9-å°ç»“">9 å°ç»“</h2>
<p>æœ¬æ–‡ä»ç†è®ºåˆ°å…·ä½“å®ç°å±‚é¢å‰–æäº†Soft Actor-Criticè¿™ä¸€ç›®å‰æå¼ºçš„DRLç®—æ³•ï¼ŒåŸºæœ¬ä¸Šç†è§£äº†æœ¬æ–‡çš„åˆ†æï¼Œå¯¹äºä»£ç çš„å®ç°ä¹Ÿå°±å¯ä»¥äº†ç„¶ä¸€èƒ¸äº†ã€‚</p>
<p>ç”±äºæœ¬äººæ°´å¹³æœ‰é™ï¼Œå‰é¢çš„ç†è®ºåˆ†æææœ‰é”™è¯¯ï¼Œæœ›æ‰¹è¯„æŒ‡æ­£ï¼</p>
<p>ref:
[1]. <a href="https://zhuanlan.zhihu.com/p/70360272"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/70360272<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>ä¸€æ–‡è¯¦è§£ ChatGPT RLHF èƒŒåçš„ PPO å¼ºåŒ–å­¦ä¹ è®­ç»ƒ</title><link>https://jianye0428.github.io/posts/chatgpt_rlhf/</link><pubDate>Sat, 04 May 2024 17:00:35 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/chatgpt_rlhf/</guid><description><![CDATA[<h2 id="0-å¼•è¨€">0. å¼•è¨€</h2>
<p></p>
<p>æœ€è¿‘ç«å‡ºåœˆçš„ğŸš€ ChatGPT ä¸­ RLHF ä¸»è¦é‡‡ç”¨äº†å°±æ˜¯ PPO è¿›è¡Œå¼ºåŒ–å­¦ä¹ è®­ç»ƒ</p>
<blockquote>
<p>ä¸»è¦è¿ç”¨åœ¨å¾®è°ƒé˜¶æ®µï¼ˆå¾®è°ƒæ•´ä¸ª 10Bï½100B+ å‚æ•°çš„æˆæœ¬å…¶å®ä¹Ÿéå¸¸é«˜ ï¼‰ä½¿ç”¨<strong>ç­–ç•¥æ¢¯åº¦</strong>å¼ºåŒ–å­¦ä¹  (Policy Gradient RL) ç®—æ³•ã€è¿‘ç«¯ç­–ç•¥ä¼˜åŒ– (PPO) å¾®è°ƒåˆå§‹ LM çš„éƒ¨åˆ†æˆ–å…¨éƒ¨å‚æ•°ã€‚</p>
</blockquote>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<blockquote>
<p>ä»¥ä¸‹ä¸»è¦å‚è€ƒå°å¤§æå®æ¯…çš„æ¨å¯¼è¿‡ç¨‹</p>
</blockquote>
<h2 id="01-vanilla-policy-gradient">01. Vanilla policy gradient</h2>
<ul>
<li>åŠ¨ä½œ/ç¯å¢ƒ/å¥–åŠ±ä¹‹é—´çš„å…³ç³»ï¼š</li>
</ul>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>è½¨è¿¹å¯è¡¨ç¤ºä¸ºé›†åˆ</p>
<p>$$\begin{aligned}p_{\theta}(\tau)&amp;=p(s_1)p_\theta(a_1|s_1)p(s_2|s_1,a_1)p_\theta(a_1|s_1)p(s_3|s_2,a_2)\ldots\&amp;=p(s_1)\prod_{t=1}^Tp_\theta(a_t|s_t)p(s_{t+1}|s_t,a_t)\end{aligned}$$</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ä¸€ä¸ªè½¨è¿¹çš„å¥–åŠ±æ€»å’Œä¸ºï¼š</p>
<p>$$R(\tau)=\sum_{t=1}^Tr_t$$</p>
<p>åˆ™å¥–åŠ±çš„æœŸæœ›ä¸ºï¼š</p>
<p>$$\bar{R}<em>\theta=\sum</em>\tau R(\tau)p_\theta(\tau)=E_{\tau\sim p_\theta(\tau)}[R(\tau)]$$</p>
<p>å°† $R(\tau)$ çœ‹æˆå¸¸é‡ï¼Œå¯¹å…¶æ±‚å¾®åˆ†ï¼š</p>
<p>$$\begin{aligned}
\nabla\bar{R}<em>{\theta}&amp; =\sum</em>{\tau}R(\tau)\nabla p_{\theta}(\tau) \
&amp;=\sum_{\tau}R(\tau)p_{\theta}(\tau)\frac{\nabla p_{\theta}(\tau)}{p_{\theta}(\tau)} \
&amp;=\sum_{\tau}R(\tau)p_{\theta}(\tau)\nabla\log p_{\theta}(\tau)\quad\nabla f(x)=f(x)\nabla\log f(x) \
&amp;=E_{\tau\sim p_{\theta}(\tau)}[R(\tau)\nabla\log p_{\theta}(\tau)]&amp; \left(2\right) \
&amp;\approx\frac1N\sum_{n=1}^{N}R(\tau^{n})\nabla\log p_{\theta}(\tau^{n}) \
&amp;=\frac1N\sum_{n=1}^N\sum_{t=1}^{T_n}R(\tau^n)\nabla\log p_\theta(a_t^n|s_t^n)
\end{aligned}$$</p>
<p>ç­–ç•¥ç½‘ç»œæ¢¯åº¦æ›´æ–°ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>å¯ä»¥çœ‹æˆä¸€ä¸ªåˆ†ç±»é—®é¢˜ï¼ˆæ¸¸æˆä¸­é€šè¿‡é”®ç›˜è¾“å…¥æ¥äº’åŠ¨ï¼Œåˆ†ç±»ç±»åˆ«ä¸ºæ‰€æœ‰å¯æ“ä½œçš„é”®ä½ï¼‰ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<ul>
<li>ç†æƒ³æƒ…å†µä¸‹ï¼Œ å¹¶ä¸ä¸€ç›´ä¸ºæ­£æ•°ï¼Œå¢åŠ ä¸€ä¸ª baseline:</li>
</ul>
<p>$$\nabla\bar{R}<em>{\theta}=\frac{1}{N}\sum</em>{n=1}^{N}\sum_{t=1}^{{T_{n}}}(R(\tau^{n})-b)\nabla\log p_{\theta}(a_{t}^{n}|s_{t}^{n})b\approx E[R(\tau)]$$</p>
<blockquote>
<p>åœ¨ç”µå­æ¸¸æˆä¸­ï¼Œå¥–åŠ±å€¼å¸¸å¸¸ä¸ºæ­£ï¼ˆé€šå¸¸ä¸ºæ¸¸æˆåˆ†æ•°ï¼‰ã€‚è¿™æ—¶éœ€è¦å¢åŠ ä¸€ä¸ªåç½®æ¥ä¿è¯åŒæ—¶æœ‰æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬</p>
</blockquote>
<ul>
<li>åˆ†é…åˆé€‚çš„å­¦åˆ†</li>
</ul>
<p>ä¸€ä¸ªé«˜åˆ†çš„æ¸¸æˆè½¨è¿¹ä¸­ä¹Ÿå¯èƒ½å­˜åœ¨é”™è¯¯çš„åŠ¨ä½œï¼ŒåŒæ ·çš„ï¼Œä¸€ä¸ªä½åˆ†çš„æ¸¸æˆè½¨è¿¹ä¹Ÿå¯èƒ½å­˜åœ¨æ­£ç¡®çš„åŠ¨ä½œï¼Œè€Œä¸Šæ–‡ä¸­çš„è®¡ç®—å°†æœ€åçš„å¥–åŠ±å€¼ï¼ˆæœ€åçš„æ¸¸æˆåˆ†æ•°ï¼‰éƒ½ä¸€è§†åŒä»è§†ä¸ºè¯¥æ¸¸æˆè½¨è¿¹æ¯ä¸ªåŠ¨ä½œçš„å­¦åˆ†ã€‚</p>
<p>ä¸ºäº†æ›´å‡†ç¡®åœ°æè¿°æ¯ä¸ªåŠ¨ä½œæ‰€å¾—åˆ°çš„å­¦åˆ†ï¼Œå°†ä¸€ä¸ªåŠ¨ä½œæ‰§è¡Œåå¯¹åº”çš„å­¦åˆ†ä¸ºåç»­çš„æ‰€æœ‰å¥–åŠ±å€¼çš„æ€»å’Œ</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>$$\begin{aligned}
\nabla\bar{R}<em>\theta&amp; =\frac1N\sum</em>{n=1}^N\sum_{t=1}^{T_n}(R(\tau^n)-b)\nabla\log p_\theta(a_t^n|s_t^n) \Downarrow\nabla\bar{R}<em>\theta \
&amp;= \frac1N\sum</em>{n=1}^N\sum_{t=1}^{T_n}(\sum_{t^{\prime}=t}^{T_n}r_{t^{\prime}}^n-b)\nabla\log p_\theta(a_t^n|s_t^n)
\end{aligned}$$</p>
<p>å½“æŸä¸ªåŠ¨ä½œæ‰§è¡Œä»¥åï¼Œå…¶å¯¹åç»­çš„å¥–åŠ±åˆ†æ•°çš„å½±å“åœ¨æ…¢æ…¢å‡å°‘ï¼Œå†å¢åŠ ä¸€ä¸ªè¡°å‡å› å­ï¼š</p>
<p>$$\begin{aligned}
\nabla\bar{R}<em>\theta&amp; =\frac1N\sum</em>{n=1}^N\sum_{t=1}^{T_n}(\sum_{t^{\prime}=t}^{T_n}r_{t^{\prime}}^n)\nabla\log p_\theta(a_t^n|s_t^n)\Downarrow\nabla\bar{R}<em>\theta \
&amp; = \frac{1}{N}\sum</em>{n=1}^{N}\sum_{t=1}^{T_{n}}(\sum_{t^{\prime}=t}^{T_{n}}\gamma^{t^{\prime}-t}r_{t^{\prime}}^{n}-b)\nabla\log p_{\theta}(a_{t}^{n}|s_{t}^{n}),\gamma&lt;1
\end{aligned}$$</p>
<h2 id="02-ä»on-policyåˆ°off-policy">02. ä»on-policyåˆ°off-policy</h2>
<p>ä¸¤è€…åŒºåˆ«:</p>
<ul>
<li>On-policy: å­¦ä¹ åˆ°çš„ agent å’Œä¸ç¯å¢ƒäº¤äº’çš„ agent æ˜¯ç›¸åŒçš„ï¼Œæ¯ä¸€æ¬¡æ¢¯åº¦æ›´æ–°éƒ½éœ€è¦é‡æ–°é‡‡æ ·</li>
<li>Off-policy: å­¦ä¹ åˆ°çš„ agent å’Œä¸ç¯å¢ƒäº¤äº’çš„ agent æ˜¯ä¸åŒçš„ï¼Œæ¯æ¬¡æ¢¯åº¦æ›´æ–°ä¸éœ€è¦é‡æ–°é‡‡æ ·</li>
</ul>
<p>é‡æ–°çœ‹çœ‹ çš„è¡¨è¾¾å¼ï¼š
$$\nabla\bar{R}<em>\theta=E</em>{\tau\sim p_\theta(\tau)}[R(\tau)\nabla\log p_\theta(\tau)]$$</p>
<ul>
<li>ä½¿ç”¨ç­–ç•¥ç½‘ç»œ æ”¶é›†æ•°æ®ã€‚å½“ æ›´æ–°åï¼Œåˆ™éœ€è¦é‡æ–°æ”¶é›†è®­ç»ƒæ ·æœ¬</li>
<li>ç›®æ ‡ï¼šä½¿ç”¨ç›¸åŒçš„æ ·æœ¬ï¼ˆé€šè¿‡ é‡‡æ ·ï¼‰è®­ç»ƒ ã€‚å…¶ä¸­ ä¸ºå›ºå®šçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é‡å¤ä½¿ç”¨å…¶æ ·æœ¬æ•°æ®</li>
</ul>
<h3 id="21-é‡è¦æ€§é‡‡æ ·importance-sampling">2.1 é‡è¦æ€§é‡‡æ ·ï¼ˆImportance Samplingï¼‰</h3>
<p>è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œå‡å¦‚æ­£åœ¨å°è¯•è®¡ç®—å‡½æ•° $f(x)$ çš„æœŸæœ›å€¼ï¼Œå…¶ä¸­ $x \sim f(x)$ æœä»æŸç§åˆ†å¸ƒã€‚åˆ™å¯¹ $E(f(x))$ æœ‰ä»¥ä¸‹ä¼°è®¡ï¼š</p>
<p>$$E_{x\sim p}[f(x)]=\int f(x)p(x)dx\approx\frac{1}{n}\sum_{i}f(x_{i})$$</p>
<p>è’™ç‰¹å¡æ´›æŠ½æ ·æ–¹æ³•æ˜¯ç®€å•åœ°ä»åˆ†å¸ƒ $p(x)$ ä¸­æŠ½å‡º ï¼Œç„¶åå–æ‰€æœ‰æ ·æœ¬çš„å¹³å‡å€¼æ¥å¾—åˆ°æœŸæœ›å€¼çš„ä¼°è®¡ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœ  $p(x)$  éå¸¸éš¾å–æ ·æ€ä¹ˆåŠï¼Ÿæ˜¯å¦èƒ½å¤Ÿæ ¹æ®ä¸€äº›å·²çŸ¥çš„ã€å®¹æ˜“æŠ½æ ·çš„åˆ†å¸ƒæ¥ä¼°è®¡æœŸæœ›å€¼ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚å…¬å¼çš„ä¸€ä¸ªç®€å•è½¬æ¢å°±å¯ä»¥åšåˆ°</p>
<p>$$E_{x\sim p}[f(x)]=\int f(x)p(x)dx=\int f(x)\frac{p(x)}{q(x)}q(x)dx=E_{x\sim q}[f(x)\frac{p(x)}{q(x)}]$$</p>
<p>å…¶ä¸­$x$ä»åˆ†å¸ƒ$q(x)$ä¸­é‡‡æ ·ï¼Œ$q(x)$ä¸åº”ä¸º 0ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¼°è®¡æœŸæœ›èƒ½å¤Ÿä»å¦ä¸€ä¸ªåˆ†å¸ƒ$q(x)$ä¸­é‡‡æ ·ï¼Œ$p(x)/q(x)$æ˜¯ç§°ä¸ºé‡‡æ ·ç‡æˆ–é‡‡æ ·æƒé‡ï¼Œå®ƒä½œä¸ºæ ¡æ­£æƒé‡ä»¥æŠµæ¶ˆæ¥è‡ªä¸åŒåˆ†å¸ƒçš„æ¦‚ç‡é‡‡æ ·ã€‚</p>
<ul>
<li>é‡è¦æ€§é‡‡æ ·çš„ç¼ºé™·</li>
</ul>
<p>è™½ç„¶é‡è¦æ€§é‡‡æ ·ä¿è¯äº†æœŸæœ›çš„ä¸€è‡´ï¼Œä½†æ˜¯è¿™é‡Œæ¥è®¡ç®—ä¸€ä¸‹æ–¹å·®æ˜¯å¦ä¸€è‡´</p>
<p>æ–¹å·®çš„è®¡ç®—ï¼š</p>
<p>$$Var[X]=E[X^2]-(E[X])^2$$</p>
<p>åˆ†åˆ«è®¡ç®—æ–¹å·®ï¼š</p>
<p>$$\begin{aligned}Var_{x\sim p}[f(x)]&amp;=E_{x\sim p}[f(x)^2]-(E_{x\sim p}[f(x)])^2\Var_{x\sim q}[f(x)\frac{p(x)}{q(x)}]&amp;=E_{x\sim q}[(f(x)\frac{p(x)}{q(x)})^2]-(E_{x\sim q}[f(x)\frac{p(x)}{q(x)}])^2\&amp;=E_{x\sim p}[f(x)^2\frac{p(x)}{q(x)}]-(E_{x\sim p}[f(x)])^2\end{aligned}$$</p>
<p>å¯ä»¥å‘ç°ä¸¤è€…è™½ç„¶æœŸæœ›ç›¸ç­‰ä½†æ–¹å·®å¹¶ä¸ä¸€è‡´</p>
<h3 id="22-ä»-on-policy-åˆ°-off-policy">2.2 ä» on-policy åˆ° off-policy</h3>
<p>æˆ‘ä»¬ä½¿ç”¨é‡è¦æ€§é‡‡æ ·å°† on-policy è°ƒæ•´ä¸º off-policy</p>
<p>$$\nabla\bar{R}<em>\theta=E</em>{\tau\sim p_{\theta^{\prime}}(\tau)}[\frac{p_\theta(\tau)}{p_{\theta^{\prime}}(\tau)}R(\tau)\nabla\log p_\theta(\tau)]$$</p>
<ul>
<li>ä» $\theta&rsquo;$ é‡‡æ ·å¾—åˆ°æ•°æ®é›†</li>
<li>ä½¿ç”¨è¯¥ æ•°æ®é›†å¤šæ¬¡è®­ç»ƒ $\theta$</li>
</ul>
<p>æ¢¯åº¦æ›´æ–°è¿‡ç¨‹ï¼š</p>
<p>$$\begin{aligned}
&amp;=E_{(s_t,a_t)\sim\pi_\theta}[A^\theta(s_t,a_t)\nabla\log p_\theta(a_t^n|s_t^n)] \
&amp;=E_{(s_t,a_t)\sim\pi_{\theta^{\prime}}}[\frac{p_\theta(s_t,a_t)}{p_{\theta^{\prime}}(s_t,a_t)}A^{\theta^{\prime}}(s_t,a_t)\nabla\log p_\theta(a_t^n|s_t^n)] \
&amp;=E_{(s_t,a_t)\sim\pi_{\theta^{\prime}}}[\frac{p_\theta(a_t|s_t)}{p_{\theta^{\prime}}(a_t|s_t)}\frac{p_\theta(s_t)}{p_{\theta^{\prime}}(s_t)}A^{\theta^{\prime}}(s_t,a_t)\nabla\log p_\theta(a_t^n|s_t^n)]&amp; \text{(4)} \
&amp;=E_{(s_t,a_t)\sim\pi_{\theta^{\prime}}}[\frac{p_\theta(a_t|s_t)}{p_{\theta^{\prime}}(a_t|s_t)}A^{\theta^{\prime}}(s_t,a_t)\nabla\log p_\theta(a_t^n|s_t^n)]
\end{aligned}$$</p>
<ul>
<li>å…¶ä¸­ $A^\theta(s_t,a_t)$ æŒ‡çš„æ˜¯ advantage å‡½æ•°,å…¶è®¡ç®—æ–¹å¼ä¸ºåŠ ä¸Šè¡°å‡æœºåˆ¶åçš„å¥–åŠ±å€¼å¹¶å‡å»åŸºçº¿ã€‚</li>
<li>ç”±äº $\frac{p_\theta(s_t)}{p_{\theta&rsquo;}(s_t)}$ çš„å€¼éš¾ä»¥è®¡ç®—ï¼Œå°†å…¶è®¾ç½®ä¸º 1ï¼Œç®€åŒ–è®¡ç®—</li>
</ul>
<p>ç›®æ ‡å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<p>ç”±äº $\nabla f(x)=f(x)\nabla\log f(x)$ å†ç»“åˆä¸å®šç§¯åˆ†ï¼Œç›®æ ‡å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸º:</p>
<p>$$J^{\theta&rsquo;}(\theta)=E_{(s_t,a_t)\sim\pi_{\theta&rsquo;}}[\frac{p_\theta(a_t|s_t)}{p_{\theta&rsquo;}(a_t|s_t)}A^{\theta&rsquo;}(s_t,a_t)]$$</p>
<h2 id="03-ppotrpo">03. PPO/TRPO</h2>
<p>ä¸ºäº†æ¶ˆé™¤é‡è¦æ€§é‡‡æ ·çš„ç¼ºé™·çš„å½±å“ï¼Œä»¥ä¸‹ä¸ºä¸¤ç§æ–¹å¼</p>
<ul>
<li>PPOï¼ˆProximal Policy Optimizationï¼‰
<ul>
<li>åˆå§‹åŒ–ç­– ç•¥ç½‘ç»œå‚æ•°</li>
<li>åœ¨æ¯æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­:</li>
<li>ç›®æ ‡å‡½æ•°:</li>
<li>ä½¿ç”¨ ä¸ç¯å¢ƒäº’åŠ¨ä»¥æ”¶é›† ï¼Œå¹¶è®¡ç®—å‡º advantage å€¼</li>
<li>æ›´æ–° ä¼˜åŒ–</li>
<li>ç®—æ³•:</li>
</ul>
</li>
</ul>
<p>$$\begin{aligned}
PPO algorithm: \
J_{PPO}^{\theta^k}(\theta) &amp; = J^{\theta^k}(\theta)-\beta KL(\theta,\theta^k)J^{\theta^k}(\theta) \
&amp; = E_{(s_{t},a_{t})\sim\pi_{\theta^{k}}}[\frac{p_{\theta}(a_{t}|s_{t})}{p_{\theta^{k}}(a_{t}|s_{t})}A^{\theta^{k}}(s_{t},a_{t})] \
&amp; \approx \sum_{(s_{t},a_{t})}\frac{p_{\theta}(a_{t}|s_{t})}{p_{\theta^{k}}(a_{t}|s_{t})}A^{\theta^{k}}(s_{t},a_{t})
\end{aligned}$$</p>
<p>è‡ªé€‚åº” KL æƒ©ç½šï¼šå¦‚æœ $KL(\theta,\theta^k)&gt;KL_{\max}$ ,å¢å¤§ $\beta$; å¦‚æœ $KL(\theta,\theta^k) &lt;KL_{\min}$,å‡å° $\beta$ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<ul>
<li>TRPOï¼ˆTrust Region Policy Optimizatioï¼‰</li>
</ul>
<p>$$J_{TRPO}^{\theta&rsquo;}(\theta)=E_{(s_t,a_t)\sim\pi_{\theta&rsquo;}}[\frac{p_\theta(a_t|s_t)}{p_{\theta&rsquo;}(a_t|s_t)}A^{\theta&rsquo;}(s_t,a_t)]KL(\theta,\theta&rsquo;)&lt;\delta $$</p>
<p>TRPO å’Œ PPO åœ¨å„ä¸ªæµ‹è¯•ä¸Šæ€§èƒ½å·®ä¸å¤šã€‚ä½†ç›¸æ¯” PPO ï¼ŒTRPO è®¡ç®—è¦æ›´å¤æ‚</p>
<p><strong>å‚è€ƒæ–‡çŒ®</strong>:</p>
<p>[1] <a href="https://spinningup.openai.com/en/latest/algorithms/ppo.html"target="_blank" rel="external nofollow noopener noreferrer">https://spinningup.openai.com/en/latest/algorithms/ppo.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>[2] <a href="https://openai.com/research/openai-baselines-ppo"target="_blank" rel="external nofollow noopener noreferrer">https://openai.com/research/openai-baselines-ppo<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>[3] <a href="https://huggingface.co/blog/deep-rl-ppo"target="_blank" rel="external nofollow noopener noreferrer">https://huggingface.co/blog/deep-rl-ppo<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>[4] <a href="https://huggingface.co/blog/rlhf"target="_blank" rel="external nofollow noopener noreferrer">https://huggingface.co/blog/rlhf<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>[5] <a href="https://mp.weixin.qq.com/s/zhkNDNDEJV3BEdcgeuHkOA"target="_blank" rel="external nofollow noopener noreferrer">https://mp.weixin.qq.com/s/zhkNDNDEJV3BEdcgeuHkOA<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>LLMé¢„è®­ç»ƒä¹‹RLHFï¼ˆä¸€ï¼‰ï¼šRLHFåŠå…¶å˜ç§</title><link>https://jianye0428.github.io/posts/pretrain_rlhf_one/</link><pubDate>Sat, 04 May 2024 14:23:08 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/pretrain_rlhf_one/</guid><description><![CDATA[<h2 id="0-å¼•è¨€">0. å¼•è¨€</h2>
<p>åœ¨ChatGPTå¼•é¢†çš„å¤§å‹è¯­è¨€æ¨¡å‹æ—¶ä»£ï¼Œå›½å†…å¤–çš„å¤§æ¨¡å‹å‘ˆç°çˆ†å‘å¼å‘å±•ï¼Œå°¤å…¶æ˜¯ä»¥å¹´åˆçš„LLaMAæ¨¡å‹ä¸ºé¦–çš„å¼€æºå¤§æ¨¡å‹å’Œæœ€è¿‘ç™¾å·æ™ºèƒ½çš„baichuanæ¨¡å‹ï¼Œä½†æ— ä¸€ä¾‹å¤–ï¼Œéƒ½ä½¿ç”¨äº†ã€ŒåŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ ã€ï¼ˆRLHFï¼‰æ¥æå‡è¯­è¨€æ¨¡å‹çš„æ€§èƒ½ï¼Œå¹¶åœ¨æ¨¡å‹é‡æ³¨å…¥äº†äººç±»çš„åå¥½ï¼Œä»¥æé«˜æ¨¡å‹çš„æœ‰ç”¨æ€§å’Œå®‰å…¨æ€§ã€‚ä¸è¿‡RLHFä¹Ÿæ—©å·²æ›´æ–°æ¢ä»£ï¼Œæˆ‘ä»¬ä»¥å¦‚ä¸‹ç›®å½•è¿›è¡Œè¯¦ç»†è®²è¿°RLHFåŠå…¶å˜ç§ï¼š</p>
<ul>
<li>LLMçš„ç»å…¸é¢„è®­ç»ƒPipeline</li>
<li>Llama 2ä¸­çš„RLHF</li>
<li>RLHFæ›¿ä»£æ–¹æ¡ˆ</li>
</ul>
<h2 id="ä¸€llmçš„ç»å…¸é¢„è®­ç»ƒpipeline">ä¸€ã€LLMçš„ç»å…¸é¢„è®­ç»ƒPipeline</h2>
<p>â€‹  ç›®å‰åŸºäºTransformer decoderçš„LLMï¼Œæ¯”å¦‚ChatGPTã€LLaMAã€baichuanç­‰ï¼Œé€šå¸¸éƒ½ä¼šæœ‰åŸºäºé¢„è®­ç»ƒçš„baseæ¨¡å‹å’Œåœ¨baseæ¨¡å‹è‡³å°‘ä½¿ç”¨RLHFå¾®è°ƒçš„Chatæ¨¡å‹ï¼ŒChatæ¨¡å‹çš„è®­ç»ƒä¸€èˆ¬éƒ½åŒ…æ‹¬å¦‚ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼šé¢„è®­ç»ƒï¼Œæœ‰ç›‘ç£å¾®è°ƒå’Œå¯¹é½ã€‚</p>
<p>â€‹  åœ¨<strong>é¢„è®­ç»ƒ</strong>é˜¶æ®µï¼Œæ¨¡å‹ä¼šä»å¤§é‡æ— æ ‡æ³¨æ–‡æœ¬æ•°æ®é›†ä¸­å­¦ä¹ é€šç”¨çŸ¥è¯†ï¼Œç„¶åä½¿ç”¨ã€Œ<strong>æœ‰ç›‘ç£å¾®è°ƒã€ï¼ˆSFTï¼‰<strong>ä¼˜åŒ–æ¨¡å‹ä»¥æ›´å¥½åœ°éµå®ˆç‰¹å®šæŒ‡ä»¤ï¼Œæœ€åä½¿ç”¨</strong>å¯¹é½</strong>æŠ€æœ¯ä½¿LLMå¯ä»¥æ›´æœ‰ç”¨ä¸”æ›´å®‰å…¨åœ°å“åº”ç”¨æˆ·æç¤ºã€‚</p>
<h3 id="11-é¢„è®­ç»ƒpre-training">1.1 é¢„è®­ç»ƒï¼ˆPre-trainingï¼‰</h3>
<p>é¢„è®­ç»ƒé˜¶æ®µé€šå¸¸éœ€è¦åŒ…å«æ•°åäº¿åˆ°æ•°ä¸‡äº¿ä¸ªtokençš„åºå¤§æ–‡æœ¬è¯­æ–™åº“ï¼Œä½†è®­ç»ƒç›®æ ‡æ˜¯<strong>æ¨¡å‹éœ€è¦æ ¹æ®æä¾›çš„æ–‡æœ¬æ¥é¢„æµ‹ã€Œä¸‹ä¸€ä¸ªå•è¯ã€</strong>ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p><strong>1.2 æœ‰ç›‘ç£å¾®è°ƒï¼ˆSupervised Finetuningï¼‰</strong></p>
<p>â€‹SFTçš„è®­ç»ƒè¿‡ç¨‹ç±»ä¼¼Pre-trainingé˜¶æ®µï¼Œä¹Ÿæ˜¯é¢„æµ‹ã€Œä¸‹ä¸€ä¸ªå•è¯ã€ï¼Œä½†æ˜¯<strong>éœ€è¦äººå·¥æ ‡æ³¨çš„æŒ‡ä»¤æ•°æ®é›†</strong>ï¼Œå…¶ä¸­æ¨¡å‹çš„è¾“å…¥æ˜¯ä¸€ä¸ªæŒ‡ä»¤ï¼ˆæ ¹æ®ä»»åŠ¡çš„ä¸åŒï¼Œä¹Ÿå¯èƒ½åŒ…å«ä¸€æ®µè¾“å…¥æ–‡æœ¬ï¼‰ï¼Œè¾“å‡ºä¸ºæ¨¡å‹çš„é¢„æœŸå›å¤å†…å®¹ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>æ•°æ®å½¢å¼ç±»ä¼¼äºï¼š</p>
<blockquote>
<p>Instruction: &ldquo;Write a limerick about a pelican.&rdquo;</p>
<p>æŒ‡ä»¤ï¼šâ€œå†™ä¸€é¦–å…³äºé¹ˆé¹•çš„æ‰“æ²¹è¯—ã€‚â€œ</p>
<p>Output: &ldquo;There once was a pelican so fine&hellip;&rdquo;</p>
<p>è¾“å‡ºï¼šâ€œä»å‰æœ‰ä¸€åªé¹ˆé¹•å¾ˆå¥½&hellip;â€œ</p>
</blockquote>
<p>æ¨¡å‹ä¼šæŠŠâ€œWrite a limerick about a pelicanâ€ä½œä¸ºè¾“å…¥ï¼Œé€ä¸ªtokenè¿›è¡Œé¢„æµ‹ï¼Œè¾“å‡ºâ€œThere once was a pelican so fine&hellip;â€</p>
<p>è™½ç„¶ä¸¤ä¸ªé˜¶æ®µéƒ½é‡‡ç”¨ç±»ä¼¼çš„è®­ç»ƒç›®æ ‡ï¼Œä½†æœ‰ç›‘ç£å¾®è°ƒæ•°æ®é›†é€šå¸¸æ¯”é¢„è®­ç»ƒæ•°æ®å°å¾—å¤šï¼ŒæŒ‡ä»¤æ•°æ®é›†éœ€è¦äººç±»ï¼ˆæˆ–å…¶ä»–é«˜è´¨é‡çš„LLMï¼‰æä¾›æ ‡æ³¨ç»“æœï¼Œæ‰€ä»¥æ— æ³•å¤§è§„æ¨¡åº”ç”¨ã€‚</p>
<p><strong>1.3 å¯¹é½ï¼ˆAlignmentï¼‰</strong></p>
<p>ç¬¬ä¸‰é˜¶æ®µä¾ç„¶æ˜¯å¾®è°ƒï¼Œä¸è¿‡å…¶ä¸»è¦ç›®æ ‡åœ¨äºå°†è¯­è¨€æ¨¡å‹ä¸äººç±»çš„åå¥½ã€ä»·å€¼è§‚è¿›è¡Œå¯¹é½ï¼Œè¿™ä¹Ÿæ˜¯RLHFæœºåˆ¶å‘æŒ¥çš„åœ°æ–¹ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<h2 id="äºŒreinforcement-learning-with-human-feedback-rlhf">äºŒã€Reinforcement Learning with Human Feedback (RLHF)</h2>
<p>ä¸ŠèŠ‚ï¼Œæˆ‘ä»¬è®¨è®ºäº†ç°ä»£LLMçš„ä¸‰ä¸ªè®­ç»ƒè¿‡ç¨‹ï¼›æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬é‡ç‚¹è®¨è®ºã€Œä¸Šè¿°ä¸¤ä¸ªå¾®è°ƒé˜¶æ®µã€ï¼ˆSupervised Tinetuningå’ŒAlignmentï¼‰ä¸­ä½¿ç”¨çš„RLHFæŠ€æœ¯ã€‚</p>
<p>RLHFä¸»è¦åŒ…æ‹¬ä¸‰æ­¥ï¼š</p>
<ol>
<li>åœ¨é¢„è®­ç»ƒå¥½çš„æ¨¡å‹ä¸Šè¿›è¡Œã€Œæœ‰ç›‘ç£å¾®è°ƒã€ï¼ˆSFTï¼‰ï¼›</li>
<li>åœ¨æœ‰ç›‘ç£å¾®è°ƒæ¨¡å‹åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªreward modelï¼ˆRMï¼‰æ¨¡å‹ï¼›</li>
<li>åŸºäºRMæ¨¡å‹ä½¿ç”¨PPOç®—æ³•å¾®è°ƒSFTæ¨¡å‹ï¼›</li>
</ol>
<h3 id="21-åœ¨é¢„è®­ç»ƒå¥½çš„æ¨¡å‹ä¸Šè¿›è¡Œæœ‰ç›‘ç£å¾®è°ƒ">2.1 åœ¨é¢„è®­ç»ƒå¥½çš„æ¨¡å‹ä¸Šè¿›è¡Œæœ‰ç›‘ç£å¾®è°ƒ**</h3>
<p>å…ˆæ”¶é›†ä¸€ä¸ªPromptsé›†åˆï¼Œå¹¶è¦æ±‚æ ‡æ³¨äººå‘˜å†™å‡ºé«˜è´¨é‡çš„å›å¤ï¼Œç„¶åä½¿ç”¨è¯¥æ•°æ®é›†ä»¥ç›‘ç£çš„æ–¹å¼å¾®è°ƒé¢„è®­ç»ƒçš„åŸºç¡€æ¨¡å‹ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>â€‹è¯¥æ­¥éª¤ä¸ä¸Šå°èŠ‚çš„Supervised Finetuningç±»ä¼¼ï¼Œä½†è¿™æ˜¯RLHFä¸å¯æˆ–ç¼ºçš„ä¸€ä¸ªæ­¥éª¤ã€‚</p>
<h3 id="22-åœ¨æœ‰ç›‘ç£å¾®è°ƒæ¨¡å‹åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªrmæ¨¡å‹">2.2 åœ¨æœ‰ç›‘ç£å¾®è°ƒæ¨¡å‹åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªRMæ¨¡å‹</h3>
<p>å¯¹äºæ¯ä¸ªPromptï¼Œè¦æ±‚æœ‰ç›‘ç£å¾®è°ƒåçš„LLMç”Ÿæˆå››åˆ°ä¹ä¸ªå›å¤ï¼Œå†ç”±æ ‡æ³¨äººå‘˜æ ¹æ®ä¸ªäººåå¥½å¯¹æ‰€æœ‰å›å¤è¿›è¡Œæ’åºã€‚è™½ç„¶æ’åºè¿‡ç¨‹å¾ˆè€—æ—¶ï¼Œä½†å·¥ä½œé‡è¿˜æ˜¯æ¯”ç¬¬ä¸€æ­¥çš„æœ‰ç›‘ç£æ•°æ®é›†æ„å»ºè¦å°‘ä¸€äº›ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>åœ¨å¤„ç†æ’åºæ•°æ®æ—¶ï¼Œä½¿ç”¨äº†ä¸€ä¸ªå¥–åŠ±æ¨¡å‹RMï¼ŒRMæ¥è‡ªRLHFç¬¬ä¸€æ­¥çš„ã€Œæœ‰ç›‘ç£å¾®è°ƒè¯­è¨€æ¨¡å‹ã€ï¼ˆSFTï¼‰ï¼ŒSFTçš„è¾“å‡ºé€šè¿‡ä¸€ä¸ªå›å½’å±‚ï¼ˆå•ä¸ªè¾“å‡ºèŠ‚ç‚¹ï¼‰è½¬æ¢ä¸ºå¥–åŠ±åˆ†æ•°ï¼Œå³å¯ç§°ä¸º<strong>RMæ¨¡å‹</strong>ã€‚</p>
<h3 id="23-åŸºäºrmæ¨¡å‹ä½¿ç”¨ppoç®—æ³•å¾®è°ƒsftæ¨¡å‹">2.3 åŸºäºRMæ¨¡å‹ä½¿ç”¨PPOç®—æ³•å¾®è°ƒSFTæ¨¡å‹</h3>
<p>åŸºäºRMæ¨¡å‹ä½¿ç”¨proximal policy optimization (PPO)ç®—æ³•å¾®è°ƒSFTæ¨¡å‹</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>PPOçš„å…·ä½“æŠ€æœ¯ç»†èŠ‚å¯ä»¥å‚è€ƒInstructGPTæˆ–ä¸‹é¢çš„è®ºæ–‡åˆ—è¡¨ã€‚</p>
<ol>
<li>Asynchronous Methods for Deep Reinforcement Learning (2016) ï¼Œhttps://arxiv.org/abs/1602.01783</li>
<li>Proximal Policy Optimization Algorithms (2017)ï¼Œhttps://arxiv.org/abs/1707.06347</li>
<li>Fine-Tuning Language Models from Human Preferences (2020)ï¼Œhttps://arxiv.org/abs/1909.08593</li>
<li>Learning to Summarize from Human Feedback (2022) ï¼Œhttps://arxiv.org/abs/2009.01325</li>
</ol>
<h2 id="ä¸‰llama-2çš„rlhf">ä¸‰ã€LLaMA 2çš„RLHF**</h2>
<p>Meta AIåœ¨åˆ›å»ºLlama-2-chatæ¨¡å‹æ—¶ä¹Ÿä½¿ç”¨äº†RLHFæŠ€æœ¯ï¼Œä¸è¿‡ä¸ChatGPTç›¸æ¯”è¿˜æ˜¯æœ‰äº›ç»†å¾®åŒºåˆ«ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ç®€å•æ¥è¯´ï¼ŒLlama-2-chatåœ¨ç¬¬ä¸€æ­¥RLHFå¾®è°ƒä¸Šä½¿ç”¨ç›¸åŒçš„æŒ‡ä»¤æ•°æ®ï¼Œä½†åœ¨ç¬¬äºŒæ­¥ä½¿ç”¨äº†ä¸¤ä¸ªå¥–åŠ±æ¨¡å‹ï¼›é€šè¿‡å¤šä¸ªé˜¶æ®µçš„ä¸æ–­è¿›åŒ–ï¼Œå¥–åŠ±æ¨¡å‹ä¹Ÿä¼šæ ¹æ®Llama-2-chatæ¨¡å‹å‡ºç°çš„é”™è¯¯è¿›è¡Œæ›´æ–°ï¼›å¹¶ä¸”å¢åŠ äº†æ‹’ç»é‡‡æ ·ï¼ˆrejection samplingï¼‰æ­¥éª¤ã€‚</p>
<h3 id="31-margin-loss">3.1 Margin Loss</h3>
<p>â€‹åœ¨æ ‡å‡†InstructGPTä¸­ä½¿ç”¨çš„RLHF PPOæ–¹æ³•ï¼Œç ”ç©¶äººå‘˜éœ€è¦æ”¶é›†åŒä¸€ä¸ªæç¤ºä¸‹çš„4-9ä¸ªæ¨¡å‹è¾“å‡ºå¹¶è¿›è¡Œæ’åºï¼Œæ¯”å¦‚å››ä¸ªå›å¤çš„æ’åºç»“æœä¸ºA&lt;C&lt; D&lt;Bï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°å…­ä¸ªå¯¹æ¯”ç»“æœï¼šA &lt; Cï¼ŒA &lt; D ï¼ŒA &lt; Bï¼ŒC &lt; Dï¼ŒC &lt; Bï¼ŒD &lt; Bã€‚</p>
<p>â€‹Llama 2çš„æ•°æ®é›†ä¹Ÿé‡‡ç”¨ç±»ä¼¼çš„æ–¹å¼ï¼Œä¸è¿‡æ ‡æ³¨äººå‘˜æ¯æ¬¡åªèƒ½çœ‹åˆ°ä¸¤ä¸ªï¼ˆè€Œé4-9ä¸ªï¼‰å›å¤å¹¶è¿›è¡Œå¯¹æ¯”ï¼Œä½†æ–°å¢äº†ä¸€ä¸ªè¾¹é™…ï¼ˆmarginï¼‰æ ‡ç­¾ï¼Œå¯¹æ¯”ç»“æœå¯ä»¥ä¸ºã€Œæ˜¾è‘—æ›´å¥½ã€ï¼ˆsignificantly betterï¼‰å’Œã€Œå¥½çš„ä¸æ˜æ˜¾ã€ï¼ˆnegligibly betterï¼‰ã€‚</p>
<p>åœ¨æ’åºè®­ç»ƒæ—¶ä¸­ï¼ŒLlama 2ç›¸æ¯”InstructGPTå¢åŠ äº†è¾¹é™…æŸå¤±ï¼š</p>
<p>$$\mathcal{L}<em>{\mathrm{ranking}}=-\log\left(\sigma\left(r</em>\theta\left(x,y_c\right)-r_\theta\left(x,y_r\right)-m(r)\right)\right)$$</p>
<p>å…¶ä¸­ï¼Œ$r_Î¸(xï¼Œy)$æ˜¯æç¤ºxå’Œç”Ÿæˆçš„å›å¤yçš„æ ‡é‡åˆ†æ•°è¾“å‡º; Î¸ä¸ºæ¨¡å‹æƒé‡; Ïƒæ˜¯å°†å±‚è¾“å‡ºè½¬æ¢ä¸ºèŒƒå›´ä»0åˆ°1çš„åˆ†æ•°çš„é€»è¾‘Så½¢å‡½æ•°; $y_c$æ˜¯ç”±æ ‡æ³¨äººå‘˜é€‰æ‹©çš„æ›´ä¼˜å›å¤; $y_r$æ˜¯è¾ƒå·®çš„å›å¤ã€‚$m(r)$å¯ä»¥è°ƒèŠ‚ä¸¤ä¸ªå›å¤ä¹‹é—´çš„å·®å€¼ï¼Œå¦‚æœå¯¹æ¯”ç»“æœä¸ºã€Œæ˜¾è‘—æ›´å¥½ã€ï¼Œåˆ™ä¼šå¢åŠ æ¢¯åº¦å€¼ï¼ŒåŠ å¿«æ›´æ–°é€Ÿåº¦ã€‚</p>
<h3 id="32-ä¸¤ä¸ªrmæ¨¡å‹">3.2 ä¸¤ä¸ªRMæ¨¡å‹</h3>
<p>â€‹Llama 2ä¸­çš„ä¸¤ä¸ªå¥–åŠ±æ¨¡å‹åˆ†åˆ«ä¾§é‡ã€Œæœ‰ç”¨æ€§ã€ï¼ˆhelpfulnessï¼‰å’Œã€Œå®‰å…¨æ€§ã€ï¼ˆsafetyï¼‰ï¼Œç”¨äºæ¨¡å‹ä¼˜åŒ–çš„æœ€ç»ˆå¥–åŠ±å‡½æ•°ä¼šå°†ä¸¤ä¸ªåˆ†æ•°è¿›è¡Œçº¿æ€§ç»„åˆã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<h3 id="33-æ‹’ç»é‡‡æ ·">3.3 æ‹’ç»é‡‡æ ·</h3>
<p>â€‹Llama 2çš„ä½œè€…ä½¿ç”¨äº†ä¸€ä¸ªè®­ç»ƒæµæ°´çº¿ï¼Œ<strong>åŒæ—¶ä½¿ç”¨PPOå’Œæ‹’ç»é‡‡æ ·ç®—æ³•</strong>ï¼Œè¿­ä»£åœ°äº§ç”Ÿå¤šä¸ªRLHFæ¨¡å‹ï¼ˆä»RLHF-V1åˆ°RLHF-V5ï¼‰ï¼Œæ¨¡å‹åœ¨æ‹’ç»é‡‡æ ·æ—¶ä¼šå¾—åˆ°Kä¸ªè¾“å‡ºï¼Œå¹¶ä½¿ç”¨æœ€é«˜å¥–åŠ±çš„è¾“å‡ºæ›´æ–°æ¢¯åº¦ï¼Œè€ŒPPOæ¯æ¬¡åªåŸºäºå•æ ·æœ¬è¿›è¡Œæ›´æ–°ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>åœ¨ç›‘ç£å¾®è°ƒçš„åˆå§‹é˜¶æ®µä¹‹åï¼Œæ¨¡å‹åªä½¿ç”¨æ‹’ç»é‡‡æ ·è¿›è¡Œè®­ç»ƒï¼Œç„¶åå†ç»“åˆæ‹’ç»é‡‡æ ·å’ŒPPOã€‚</p>
<p>ä»å®éªŒç»“æœæ¥çœ‹ï¼ŒRLHFå¾®è°ƒæ¨¡å‹åœ¨æ— å®³æ€§å’Œæœ‰ç”¨æ€§ä¸Šéƒ½å¾—åˆ°äº†æ”¹å–„ï¼Œå¹¶ä¸”åœ¨æœ€åé˜¶æ®µRLHF-v5ä½¿ç”¨PPOç®—æ³•çš„æ€§èƒ½æœ€å¥½ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<h2 id="å››rlhfçš„æ›¿ä»£æ–¹æ¡ˆ">å››ã€RLHFçš„æ›¿ä»£æ–¹æ¡ˆ</h2>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>RLHFåœ¨InstructGPTå’ŒLlama 2è®ºæ–‡ä¸­è¢«è¯æ˜æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯RLHFçš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œä¸‹é¢å°†ä»‹ç»ä¸€ä¸‹æœ€è¿‘RLHFçš„æ›¿ä»£æ–¹æ¡ˆï¼š</p>
<h3 id="41-constitutional-ai-harmlessness-from-ai-feedback-dec-2022-httpsarxivorgabs221208073">4.1 Constitutional AI: Harmlessness from AI Feedback (Dec 2022, <a href="https://arxiv.org/abs/2212.08073"target="_blank" rel="external nofollow noopener noreferrer">https://arxiv.org/abs/2212.08073<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>)</h3>
<p>ç ”ç©¶äººå‘˜æå‡ºäº†ä¸€ç§ <strong><font color=red>åŸºäºäººç±»æä¾›çš„è§„åˆ™åˆ—è¡¨çš„è‡ªæˆ‘è®­ç»ƒæœºåˆ¶</font></strong>ã€‚ä¸å‰é¢æåˆ°çš„InstructGPTè®ºæ–‡ç±»ä¼¼ï¼Œä¹Ÿä½¿ç”¨äº†å¼ºåŒ–å­¦ä¹ æ–¹æ³•ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ä¸Šå›¾ä¸­çš„ã€Œçº¢é˜Ÿã€ï¼ˆRed Teamï¼‰æŒ‡çš„æ˜¯æµ‹è¯•ç›®æ ‡ç³»ç»Ÿçš„é˜²å¾¡èƒ½åŠ›ï¼Œå³å¤–éƒ¨æˆ–å†…éƒ¨ä¸“å®¶æ¨¡æ‹Ÿæ½œåœ¨å¯¹æ‰‹çš„è¿‡ç¨‹ï¼Œé€šè¿‡æ¨¡ä»¿ç°å®ä¸–ç•Œæ”»å‡»è€…çš„æˆ˜æœ¯ã€æŠ€æœ¯å’Œç¨‹åºæ¥æŒ‘æˆ˜ã€æµ‹è¯•å¹¶æœ€ç»ˆæ”¹è¿›ç³»ç»Ÿã€‚</p>
<h3 id="42-the-wisdom-of-hindsight-makes-language-models-better-instruction-followers-feb-2023-httpsarxivorgabs230205206">4.2 The Wisdom of Hindsight Makes Language Models Better Instruction Followers (Feb 2023, <a href="https://arxiv.org/abs/2302.05206"target="_blank" rel="external nofollow noopener noreferrer">https://arxiv.org/abs/2302.05206<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>)</h3>
<p>ç ”ç©¶äººå‘˜æå‡ºäº†ä¸€ç§**<font color=red>åŸºäºé‡æ–°æ ‡è®°çš„ç›‘ç£å¾®è°ƒæ–¹æ³•HIR</font>**ï¼Œè¯¥æ–¹æ³•åœ¨12ä¸ªBigBenchä»»åŠ¡ä¸Šä¼˜äºRLHFã€‚</p>
<p>â€‹HIRæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿç®€è€Œè¨€ä¹‹ï¼ŒHIRæ–¹æ³•åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼Œå³<strong>é‡‡æ ·</strong>å’Œ<strong>è®­ç»ƒ</strong>ã€‚åœ¨é‡‡æ ·æ­¥éª¤ä¸­ï¼ŒPromptå’ŒæŒ‡ä»¤è¾“å…¥ç»™LLMæ¥è·å–ç­”æ¡ˆï¼Œæ ¹æ®å¯¹é½å¾—åˆ†ï¼Œåœ¨è®­ç»ƒé˜¶æ®µé€‚å½“çš„åœ°æ–¹é‡æ–°æ ‡æ³¨æŒ‡ä»¤ï¼›ç„¶åï¼Œé‡æ–°æ ‡è®°çš„æŒ‡ä»¤å’ŒåŸå§‹çš„Promptç”¨äºå¾®è°ƒLLMã€‚ä½¿ç”¨è¿™ç§é‡æ–°æ ‡è®°çš„æ–¹æ³•ï¼Œç ”ç©¶äººå‘˜æœ‰æ•ˆåœ°å°†å¤±è´¥æ¡ˆä¾‹ï¼ˆLLMåˆ›å»ºçš„è¾“å‡ºä¸åŸå§‹æŒ‡ä»¤ä¸åŒ¹é…çš„æ¡ˆä¾‹ï¼‰è½¬åŒ–ä¸ºæœ‰ç”¨çš„è®­ç»ƒæ•°æ®ï¼Œç”¨äºç›‘ç£å­¦ä¹ ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<h3 id="43-direct-preference-optimization-your-language-model-is-secretly-a-reward-model-httpsarxivorgabs230518290-may-2023">4.3 Direct Preference Optimization: Your Language Model is Secretly a Reward Model (<a href="https://arxiv.org/abs/2305.18290"target="_blank" rel="external nofollow noopener noreferrer">https://arxiv.org/abs/2305.18290<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>, May 2023)</h3>
<p><strong><font color=red>ç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDPOï¼‰æ˜¯å…·æœ‰PPOçš„RLHFçš„æ›¿ä»£æ–¹æ¡ˆ</font></strong>ï¼Œå…¶ä¸­ç ”ç©¶äººå‘˜è¡¨æ˜ï¼Œåœ¨RLHFä¸­æ‹Ÿåˆå¥–åŠ±æ¨¡å‹çš„äº¤å‰ç†µæŸå¤±å¯ä»¥ç›´æ¥ç”¨äºå¾®è°ƒLLMã€‚æ ¹æ®ä»–ä»¬çš„åŸºå‡†ï¼Œä½¿ç”¨DPOæ›´æœ‰æ•ˆï¼Œè€Œä¸”åœ¨å“åº”è´¨é‡æ–¹é¢é€šå¸¸ä¹Ÿä¼˜äºRLHF/PPOã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<h3 id="44-reinforced-self-training-rest-for-language-modeling-aug-2023-httpsarxivorgabs230808998">4.4 Reinforced Self-Training (ReST) for Language Modeling (Aug 2023, <a href="https://arxiv.org/abs/2308.08998"target="_blank" rel="external nofollow noopener noreferrer">https://arxiv.org/abs/2308.08998<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>)</h3>
<p>ReSTæ˜¯äººç±»åé¦ˆå¼ºåŒ–å­¦ä¹ ï¼ˆRLHFï¼‰çš„ä¸€ç§æ›¿ä»£æ–¹æ¡ˆï¼Œå®ƒ<strong>ä½¿LLMä¸äººç±»åå¥½ä¿æŒä¸€è‡´</strong>ã€‚ <strong><font color=red>ReSTä½¿ç”¨é‡‡æ ·æ–¹æ³•åˆ›å»ºæ”¹è¿›çš„æ•°æ®é›†</font></strong>ï¼Œåœ¨è´¨é‡è¶Šæ¥è¶Šé«˜çš„å­é›†ä¸Šè¿­ä»£è®­ç»ƒï¼Œä»¥å®Œå–„å…¶å¥–åŠ±å‡½æ•°ã€‚æ ¹æ®ä½œè€…çš„è¯´æ³•ï¼Œä¸æ ‡å‡†çš„åœ¨çº¿RLHFæ–¹æ³•ï¼ˆå¦‚å…·æœ‰è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–çš„RLHFï¼ŒPPOï¼‰ç›¸æ¯”ï¼ŒReSTé€šè¿‡ç¦»çº¿ç”Ÿæˆè®­ç»ƒæ•°æ®é›†å®ç°äº†æ›´é«˜çš„æ•ˆç‡ï¼Œä½†ç¼ºå°‘ä¸InstructGPTæˆ–Llama 2ä¸­ä½¿ç”¨çš„æ ‡å‡†RLHF PPOæ–¹æ³•çš„å…¨é¢æ¯”è¾ƒã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<h3 id="45-rlaif-scaling-reinforcement-learning-from-human-feedback-with-ai-feedback-sep-2023-httpsarxivorgabs230900267">4.5 RLAIF: Scaling Reinforcement Learning from Human Feedback with AI Feedback (Sep 2023, <a href="https://arxiv.org/abs/2309.00267"target="_blank" rel="external nofollow noopener noreferrer">https://arxiv.org/abs/2309.00267<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>)</h3>
<p>æœ€è¿‘çš„äººå·¥æ™ºèƒ½åé¦ˆå¼ºåŒ–å­¦ä¹ ï¼ˆRLAIFï¼‰ç ”ç©¶è¡¨æ˜ï¼ŒRLHFä¸­å¥–åŠ±æ¨¡å‹è®­ç»ƒçš„è¯„çº§ä¸ä¸€å®šå¿…é¡»ç”±äººç±»æä¾›ï¼Œè€Œæ˜¯å¯ä»¥ç”±LLMç”Ÿæˆï¼ˆæ­¤å¤„ï¼šPaLM 2ï¼‰ã€‚æ ‡æ³¨äººå‘˜åœ¨ä¸€åŠçš„æ¡ˆä¾‹ä¸­æ›´å–œæ¬¢RLAIFæ¨¡å‹ï¼Œä¹Ÿå°±æ„å‘³ç€ä¸¤ä¸ªæ¨¡å‹çš„å·®è·å¹¶ä¸å¤§ï¼ŒRLHFå’ŒRLAIFéƒ½å¤§å¤§ä¼˜äºçº¯é€šè¿‡ç›‘ç£æŒ‡ä»¤å¾®è°ƒè®­ç»ƒçš„æ¨¡å‹ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>è¿™é¡¹ç ”ç©¶çš„ç»“æœéå¸¸æœ‰ç”¨å’Œæœ‰è¶£ï¼Œå› ä¸ºå®ƒåŸºæœ¬ä¸Šæ„å‘³ç€æˆ‘ä»¬å¯èƒ½èƒ½å¤Ÿä½¿åŸºäºRLHFçš„è®­ç»ƒæ›´åŠ é«˜æ•ˆå’Œå®¹æ˜“ã€‚ç„¶è€Œï¼Œè¿™äº›RLAIFæ¨¡å‹åœ¨ä¸“æ³¨äºä¿¡æ¯å†…å®¹çš„å®‰å…¨æ€§å’ŒçœŸå®æ€§çš„å®šæ€§ç ”ç©¶ä¸­çš„è¡¨ç°è¿˜æœ‰å¾…è§‚å¯Ÿï¼Œè€Œäººç±»åå¥½ç ”ç©¶ä»…éƒ¨åˆ†æ•æ‰åˆ°äº†è¿™ä¸€ç‚¹ã€‚</p>
<p><strong>å‚è€ƒæ–‡çŒ®ï¼š</strong></p>
<p>[1] <a href="https://magazine.sebastianraschka.com/p/llm-training-rlhf-and-its-alternatives"target="_blank" rel="external nofollow noopener noreferrer">https://magazine.sebastianraschka.com/p/llm-training-rlhf-and-its-alternatives<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a><br>
[2] <a href="https://mp.weixin.qq.com/s/3Ff6C5zT7fXggQ1FwxvWAQ"target="_blank" rel="external nofollow noopener noreferrer">https://mp.weixin.qq.com/s/3Ff6C5zT7fXggQ1FwxvWAQ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>å¤§æ¨¡å‹å­¦ä¹ ç¬”è®° | GPT ç³»åˆ—</title><link>https://jianye0428.github.io/posts/survey/</link><pubDate>Fri, 03 May 2024 16:33:37 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/survey/</guid><description><![CDATA[<h1 id="ä¸‡å­—é•¿æ–‡cver-è½¬-llm-å­¦ä¹ ç¬”è®°ä¹‹å¤§æ¨¡å‹gpt-ç³»åˆ—">ä¸‡å­—é•¿æ–‡ï¼ŒCVer è½¬ LLM å­¦ä¹ ç¬”è®°ä¹‹å¤§æ¨¡å‹GPT ç³»åˆ—</h1>
<h2 id="å¯¼è¯»">å¯¼è¯»</h2>
<p>æœ¬æ–‡æ˜¯ä½œè€…å¯¹ GPT ç³»åˆ—æ–‡ç« çš„å­¦ä¹ ç¬”è®°ï¼Œä»ä¸ªäººè§’åº¦æ¢³ç†äº† GPT ç³»åˆ—çš„è¿­ä»£é€»è¾‘ï¼Œä»æŠ€æœ¯çš„é€»è¾‘è¿ç»­æ€§å’Œå…³è”æ€§éƒ½æœ‰å¾ˆå¥½çš„è®²è§£ï¼Œç¯‡å¹…è¾ƒé•¿ï¼Œå»ºè®®å¤§å®¶ç‚¹èµæ”¶è—ã€‚</p>
<p>è¿™ä¸ªç³»åˆ—çš„ç¬”è®°ä¸»è¦é¢å‘åƒæˆ‘ä¸€æ ·å·²ç»å…·å¤‡ä¸€å®šçš„æ·±åº¦å­¦ä¹ åŸºç¡€ï¼Œä½†æ˜¯æ–°æ¥è§¦ NLP å’Œå¤§æ¨¡å‹é¢†åŸŸçš„è¯»è€…ï¼Œç›®çš„æ˜¯èƒ½æçº²æŒˆé¢†åœ°å¿«é€ŸæŠŠæ¡è¿™ä¸ªé¢†åŸŸçš„ä¸€ç³»åˆ—å…³é”®å·¥ä½œèŠ‚ç‚¹ã€‚</p>
<p>è¿™ç¯‡ç¬”è®°æ¶µç›–çš„å†…å®¹æœ‰ï¼š</p>
<ul>
<li>GPT-1 è®ºæ–‡</li>
<li>GPT-2 è®ºæ–‡</li>
<li>GPT-3 è®ºæ–‡</li>
<li>InstructGPT è®ºæ–‡ï¼ˆGPT-3.5 èƒŒåçš„æŠ€æœ¯ï¼‰</li>
<li>GPT-4 æŠ€æœ¯æŠ¥å‘Š</li>
<li>GPT-4 å¾®è½¯è¯„æµ‹æŠ¥å‘Š</li>
<li>GPT-4V å¾®è½¯è¯„æµ‹æŠ¥å‘Š</li>
</ul>
<p>ä½œä¸ºä¸€ä¸ªä» CV è½¬åˆ° LLM çš„æ–°äººï¼Œéš¾å…çŠ¯ä¸€äº›å¸¸è§æˆ–ä½çº§çš„é”™è¯¯ï¼Œæ¬¢è¿ä»»ä½•è¯»è€…åŠæ—¶æŒ‡å‡ºå’Œæ–§æ­£ï¼Œä¹Ÿæ¬¢è¿ä»»ä½•ç•™è¨€è®¨è®ºã€‚</p>
<h2 id="è¦ç‚¹-tldl">è¦ç‚¹ (TL;DL)</h2>
<ul>
<li><strong>æ³¨é‡èƒ½åŠ›ï¼Œè€Œéè¿‡ç¨‹</strong>ï¼šé¢„è®­ç»ƒä»»åŠ¡å…¶å®å½¢å¼ä¸é‡è¦ï¼Œå¯ä»¥æ˜¯ classificationï¼Œå¯ä»¥æ˜¯é¢„æµ‹ next tokenï¼ŒçœŸæ­£é‡è¦çš„æ˜¯ model å’Œ data çš„ scaling upï¼Œä»¥æ­¤å¿«é€Ÿé«˜æ•ˆåœ°å¾—åˆ°ä¸€ä¸ªæœ‰ä¼˜å¼‚æ³›åŒ–èƒ½åŠ›çš„ç‰¹å¾æå–å™¨:
<ul>
<li>data: æ‰¾åˆ°/è®¾è®¡ä¸€ä¸ªèƒ½æŠŠæµ·é‡çš„æ•°æ®ç”¨èµ·æ¥çš„ä»»åŠ¡ï¼Œèƒ½ç”¨çš„æ•°æ®è¶Šå¤šè¶Šå¥½ï¼Œè®­ç»ƒè¶Šå¿«è¶Šå¥½</li>
<li>model: <strong>æ¨¡å‹æ€§èƒ½</strong>å¯ä»¥éšç€å‚æ•°é‡å·¨é‡åœ°æå‡è€Œä¸ä¼šå¿«é€Ÿé¥±å’Œï¼Œä¸€ä¸ªä¼˜ç§€çš„æ¨¡å‹æ¶æ„æ˜¯ scaling up çš„åŸºç¡€ä¿éšœ</li>
</ul>
</li>
<li><strong>ä¸‰ç§èŒƒå¼</strong>ï¼š
<ul>
<li>æˆ‘ä»¬å¯ä»¥å°†ä¸“å±ä»»åŠ¡ä¸Šå¾®è°ƒå¾—åˆ°çš„æ¨¡å‹ï¼Œçœ‹æˆä¸€ç§ç”¨æˆ·è¾“å…¥ 0 ä¸ªç‰¹æ®Š tokenï¼Œè§£å†³ 1 ç§ä»»åŠ¡çš„èŒƒå¼ï¼Œæ‰€ä»¥<strong>ç¬¬ä¸€èŒƒå¼</strong>ä¸‹çš„æ¯ä¸ªæ¨¡å‹åªèƒ½ç”¨äºè§£å†³ä¸€ä¸ªä¸“å±ä»»åŠ¡ã€‚</li>
<li><strong>ç¬¬äºŒèŒƒå¼</strong>çš„æ¨¡å‹æ˜¯ä¸ºæ¯ä¸€ç§ä»»åŠ¡å‡†å¤‡ 1 ä¸ªç‰¹æ®Š tokenï¼Œå› æ­¤é€šè¿‡æ”¹å˜è¾“å…¥ tokenï¼Œå°±èƒ½ç”¨ä¸€ä¸ªæ¨¡å‹è§£å†³ä¸åŒçš„ä»»åŠ¡ã€‚</li>
<li><strong>ç¬¬ä¸‰èŒƒå¼</strong>çš„æ¨¡å‹æŠŠç‰¹æ®Š token æ›¿æ¢æˆäº†ç‰¹æ®Š token åºåˆ—ï¼Œè€Œè‡ªç„¶è¯­è¨€æ­£å¥½å°±æ˜¯ä¸€ç§æœ€ç¬¦åˆäººç±»ä¹ æƒ¯å’Œç›´è§‰çš„ç‰¹æ®Š token åºåˆ—ã€‚</li>
</ul>
</li>
<li><strong>RLHF</strong>ï¼š
<ul>
<li>SFT æ¨¡å‹(16 epoch)</li>
<li>RM</li>
<li>PPO ç»§ç»­è®­ç»ƒå‡ºæ¥çš„æœ€ç»ˆæ¨¡å‹</li>
<li>SFT æ•°æ®(13k æ¡): äººå·¥è®¾è®¡çš„é—®é¢˜ï¼Œäººå·¥æ ‡æ³¨ç­”æ¡ˆ</li>
<li>Feedback æ•°æ®(33k æ¡): é’ˆå¯¹ä¸Šé¢äººå·¥è®¾è®¡çš„é—®é¢˜ï¼Œæ¨¡å‹è¾“å‡ºçš„å‡ ä»½ç­”æ¡ˆçš„æ’åºï¼ˆæ‰“åˆ†ï¼‰</li>
<li>PPO ä½¿ç”¨çš„æ•°æ®(31k æ¡): äººå·¥è®¾è®¡çš„é—®é¢˜(ä¸Šé¢çš„æ¨¡å‹æ²¡è§è¿‡çš„æ–°é—®é¢˜)ï¼Œç”¨ RM çš„è¯„åˆ†æ¥ç»§ç»­è®­ç»ƒï¼Œè¿™ä»½æ•°æ®ä¸éœ€è¦äººå·¥æ ‡æ³¨ç­”æ¡ˆ</li>
</ul>
</li>
<li><strong>å¯¹ GPT-4 çš„å…¨é¢æ¢ç´¢</strong>ï¼š
<ul>
<li><strong>å¿ƒç†å­¦è§’åº¦</strong>ï¼šäººç±»æ€ç»´æ˜¯å¿«æ€è€ƒä¸æ…¢æ€è€ƒä¸¤ä¸ªç³»ç»Ÿçš„æ··åˆä½“ï¼Œè€Œ GPT-4 ç›®å‰æ›´ç±»ä¼¼äºå•çº¯çš„å¿«æ€è€ƒ</li>
<li>GPT-4 è¿˜æœ‰å“ªäº›<strong>å±€é™æ€§</strong>ï¼Œä»¥åŠå“ªäº›å¯ä»¥<strong>æ”¹è¿›çš„åœ°æ–¹</strong>ï¼ˆè§ GPT-4 å¾®è½¯æŠ¥å‘Šï¼‰</li>
</ul>
</li>
<li><strong>GPT-4V çš„å…¨é¢æ¢ç´¢</strong>ï¼š
<ul>
<li>æ”¯æŒå“ªäº›è¾“å…¥å’Œå·¥ä½œæ¨¡å¼</li>
<li>åœ¨ä¸åŒé¢†åŸŸå’Œä»»åŠ¡ä¸Šçš„èƒ½åŠ›è´¨é‡å’Œé€šç”¨æ€§å¦‚ä½•</li>
<li>æœ‰æ•ˆä½¿ç”¨å’Œæç¤ºæ–¹æ³•</li>
<li>æœªæ¥æ–¹å‘</li>
</ul>
</li>
</ul>
<h2 id="1-improving-language-understanding-by-generative-pre-training-201806">1. Improving Language Understanding by Generative Pre-Training (2018.06)</h2>
<p>GPT ç³»åˆ—çš„ç¬¬ä¸€ç¯‡è®ºæ–‡ï¼Œå®šä¸‹äº†çº¯ <strong><font color=red>Transformer-Decoder</font></strong> è·¯çº¿ã€‚</p>
<p>æ·±åº¦å­¦ä¹ çš„æ—©æœŸçªç ´å¾ˆå¤šæ¥è‡ªäº CV é¢†åŸŸï¼Œå…¶ä¸­å¾ˆé‡è¦çš„ä¸€ä¸ªåŸå› æ˜¯ CV æœ‰ ImageNet è¿™ä¸ªç™¾ä¸‡é‡çº§çš„æœ‰æ ‡æ³¨æ•°æ®é›†ï¼Œåœ¨ ImageNet ä¸Šè®­ç»ƒåˆ†ç±»ä»»åŠ¡å¾—åˆ°çš„æ¨¡å‹ Backbone å¤©ç„¶å°±æ˜¯ä¸€ä¸ªä¼˜ç§€çš„å›¾ç‰‡ç‰¹å¾æå–å™¨ï¼ŒåŸºäºè¿™ä¸ªç‰¹å¾æå–å™¨åœ¨ä»»æ„çš„å­ä»»åŠ¡ä¸Šåš fine-tuning æ•ˆæœéƒ½ä¸ä¼šå¤ªå·®ï¼ˆè‡³å°‘èƒ½å±•ç°å‡ºä¸€å®šçš„æ³›åŒ–èƒ½åŠ›ï¼‰ã€‚è€Œ NLP é¢†åŸŸç¼ºå°‘è¿™æ ·å¤§çš„æ•°æ®é›†ï¼Œå› æ­¤ï¼Œä¸€ç›´ä»¥æ¥ NLP æ¨¡å‹å‘åŠ›å¡åœ¨äº†ç‰¹å¾æå–å™¨çš„æ„ç­‘ä¸Šï¼Œ<font color=red>GPT æå‡ºç”¨è®­ç»ƒè¯­è¨€æ¨¡å‹çš„æ–¹å¼æ¥å¾—åˆ°è¿™ä¸ªç‰¹å¾æå–å™¨ï¼Œç„¶åç”¨å®ƒæ¥åšå­ä»»åŠ¡ä¸Šçš„å¾®è°ƒã€‚</font></p>
<p>è¯­è¨€æ¨¡å‹ç”±äºåšçš„æ˜¯â€œé¢„æµ‹ä¸‹ä¸€ä¸ªè¯â€è¿™æ ·çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå› æ­¤ä¸ä¾èµ–äºäººå·¥æ ‡æ³¨ï¼Œå¯ä»¥å®ç°æµ·é‡æ•°æ®çš„é¢„è®­ç»ƒå’Œæ³›åŒ–ã€‚</p>
<p>GPT å·¥ä½œæ˜¯åœ¨ BERT ä¹‹å‰çš„ï¼Œå¾ˆå¤šçš„ setting éƒ½è¢« BERT ç›´æ¥æ²¿ç”¨äº†ï¼Œæ¯”å¦‚ 12 å±‚ Transformerï¼Œ768 çš„ç»´åº¦ï¼Œ800M çš„ BookCorpus æ•°æ®é›† ç­‰ã€‚</p>
<p>æ–‡ç« å‰©ä½™éƒ¨åˆ†ä»‹ç»äº†å¦‚ä½•åœ¨ NLP å››å¤§ä¸»æµä»»åŠ¡ç±»å‹ä¸Šè¿ç”¨ GPTï¼Œå³å¦‚ä½•æŠŠä¸åŒå½¢å¼çš„ä»»åŠ¡éƒ½è¡¨ç¤ºæˆä¸€ä¸ªåºåˆ—+å¯¹åº”çš„æ ‡ç­¾çš„å½¢å¼ã€‚</p>
<p>å¯¹ç¬”è€…çš„å¯ç¤º:</p>
<ul>
<li><strong>æ³¨é‡èƒ½åŠ›ï¼Œè€Œéè¿‡ç¨‹</strong>ï¼šé¢„è®­ç»ƒä»»åŠ¡å…¶å®å½¢å¼ä¸é‡è¦ï¼Œå¯ä»¥æ˜¯ classificationï¼Œå¯ä»¥æ˜¯é¢„æµ‹ next tokenï¼ŒçœŸæ­£é‡è¦çš„æ˜¯ model å’Œ data çš„ scaling upï¼Œä»¥æ­¤å¿«é€Ÿé«˜æ•ˆåœ°å¾—åˆ°ä¸€ä¸ªæœ‰ä¼˜å¼‚æ³›åŒ–èƒ½åŠ›çš„ç‰¹å¾æå–å™¨:
<ul>
<li>data: æ‰¾åˆ°/è®¾è®¡ä¸€ä¸ªèƒ½æŠŠæµ·é‡çš„æ•°æ®ç”¨èµ·æ¥çš„ä»»åŠ¡ï¼Œèƒ½ç”¨çš„æ•°æ®è¶Šå¤šè¶Šå¥½ï¼Œè®­ç»ƒè¶Šå¿«è¶Šå¥½</li>
<li>model: æ¨¡å‹æ€§èƒ½å¯ä»¥éšç€å‚æ•°é‡å·¨é‡åœ°æå‡è€Œä¸ä¼šå¿«é€Ÿé¥±å’Œï¼Œä¸€ä¸ªä¼˜ç§€çš„æ¨¡å‹æ¶æ„æ˜¯ scaling up çš„åŸºç¡€ä¿éšœ</li>
</ul>
</li>
</ul>
<h2 id="2-language-models-are-unsupervised-multitask-learners-201902">2. Language Models are Unsupervised Multitask Learners (2019.02)</h2>
<p>GPT ç³»åˆ—çš„ç¬¬äºŒç¯‡å·¥ä½œã€‚</p>
<p>å‚æ•°é‡æå‡åˆ°äº† 1.5Bï¼Œä¹Ÿç”¨äº†æ›´å¤§é‡çš„æ•°æ®ã€‚GPT-2 æœ€å¤§çš„è´¡çŒ®æ˜¯æŠŠç ”ç©¶çš„é‡ç‚¹ä»å•ä¸ªä»»åŠ¡ä¸Šçš„é’ˆå¯¹æ€§è°ƒå‚åˆ·æ¦œï¼Œè½¬å‘äº† <strong>zero-shot</strong>ï¼Œå³ï¼Œ <font color=red>è®­ç»ƒå¥½çš„æ¨¡å‹ä¸å†éœ€è¦å¾®è°ƒå°±èƒ½å»åšä¸åŒä»»åŠ¡äº†ï¼Œå°½ç®¡æ€§èƒ½ä¸Šè·ç¦»æ¯ä¸ªä»»åŠ¡çš„ SOTA éƒ½è¿˜æœ‰è·ç¦»ï¼Œä½†æ–¹æ¡ˆçš„å¯è¡Œæ€§å·²ç»éªŒè¯äº†</font>ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼ŒåŸæ¥ä¸ºç‰¹æ®Šä»»åŠ¡å‡†å¤‡ç‰¹æ®Š token çš„åšæ³•å°±ä¸åˆé€‚äº†ï¼Œå› ä¸ºé¢„è®­ç»ƒé˜¶æ®µæ¨¡å‹æ˜¯æ²¡è§è¿‡è¿™äº› token çš„ï¼Œæ¯•ç«Ÿè¯­è¨€æ¨¡å‹é¢„è®­ç»ƒé˜¶æ®µåªè§è¿‡è‡ªç„¶è¯­è¨€ï¼Œæ‰€ä»¥éå¸¸è‡ªç„¶åœ°å°±å¼•å‡ºäº† prompt çš„æ¦‚å¿µï¼Œç”¨è‡ªç„¶è¯­è¨€æ¥æ›¿ä»£åŸæœ¬çš„ä»»åŠ¡ tokenï¼Œå®ç°ä¸åŒä»»åŠ¡çš„ zero-shotã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæ—¶å€™ GPT-2 å°±å·²ç»åˆå…· ChatGPT çš„é›å½¢äº†ï¼Œåªä¸è¿‡ç”¨æˆ·çš„è¾“å…¥è¿˜ä¸å®Œå…¨æ˜¯ä»»æ„è‡ªç„¶è¯­è¨€ï¼Œè€Œæ˜¯ç±»ä¼¼äºè¿™æ ·çš„æ¨¡æ¿è¾“å…¥ã€‚ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ç¿»è¯‘ä»»åŠ¡ï¼š
</span></span><span class="line"><span class="cl">(translate to
</span></span><span class="line"><span class="cl">french, english text, french text)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">QA ä»»åŠ¡ï¼š
</span></span><span class="line"><span class="cl">(answer the question, document,
</span></span><span class="line"><span class="cl">question, answer)</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3-language-models-are-few-shot-learners-200514165">3. Language Models are Few-Shot Learners (2005.14165)</h2>
<p>GPT ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡å·¥ä½œã€‚</p>
<p>GPT-3 çš„å‚æ•°é‡æ¥åˆ°äº† 175Bï¼Œè®­ç»ƒæ•°æ®ä»ä¸€å¼€å§‹ GPT-1 çš„å‡ åƒæœ¬ä¹¦çš„æ•°æ®é›†ï¼Œå¼€å§‹è¿›å…¥åˆ°äº†ç½‘ç«™çˆ¬è™«æ•°æ®å’Œæ¸…æ´—çš„æ¨¡å¼ã€‚</p>
<p>å…¶å®åœ¨ GPT-2 ä¸­å°±å·²ç»æåˆ°äº†ä¸€ä¸ªå« Common Crawl çš„å…¬å¼€ç½‘ç»œæ•°æ®ï¼Œä½†æ˜¯å› ä¸ºä»–ä»¬è§‰å¾—è¿™ä»½æ•°æ®å®åœ¨å¤ªè„äº†æ‰€ä»¥æ”¾å¼ƒäº†ï¼Œè€Œç°åœ¨ä¸ºäº†è®­ç»ƒæ›´å¤§çš„æ¨¡å‹ä¹Ÿä¸å¾—ä¸ç”¨èµ·æ¥ï¼Œå› æ­¤æ¸…æ´—æ•°æ®æ˜¯å…ä¸äº†çš„ã€‚</p>
<p>æ•°æ®æ¸…æ´—ç»å†äº†ä¸¤ä¸ªè¿‡ç¨‹ï¼š</p>
<ol>
<li><strong>è¿‡æ»¤</strong>ï¼šä»–ä»¬å°†åŸæ¥ GPT-2 è®­ç»ƒç”¨çš„æ•°æ®ä½œä¸ºæ­£æ ·æœ¬ï¼ŒCommon Crawl ä½œä¸ºè´Ÿæ ·æœ¬è®­ç»ƒäº†ä¸€ä¸ªäºŒåˆ†ç±»å™¨ï¼Œç„¶åç”¨è¿™ä¸ªåˆ†ç±»å™¨æ¥åšæ•°æ®ç­›é€‰ï¼Œè¿‡æ»¤æ‰ä¸€äº›ç‰¹åˆ«æ˜¾è‘—çš„è„æ•°æ®ã€‚</li>
<li><strong>å»é‡</strong>ï¼šç”¨ç»å…¸çš„ LSH ç®—æ³•è¿›è¡Œå»é‡</li>
</ol>
<p>å¦ä¸€æ–¹é¢ï¼ŒGPT-3 ä¹Ÿæ­£å¼æå‡ºäº†â€œin-context learningâ€çš„æ¦‚å¿µï¼Œåœ¨æ¨¡å‹å‚æ•°ä¸è¿›è¡Œæ›´æ–°çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡è¾“å…¥çš„ä¸Šä¸‹æ–‡æ¥å¸®åŠ©æ¨¡å‹æå‡è¡¨ç°ã€‚</p>
<p>å¯¹äºç¬”è€…è€Œè¨€ï¼Œè¿™å¼ å›¾ç›¸å½“å½¢è±¡:</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>è¿™æ­ç¤ºäº†æ¨¡å‹å­¦ä¹ çš„å¦ä¸€ä¸ªç»´åº¦ï¼Œæå‡æ¨¡å‹è¡¨ç°å¹¶ä¸åªæœ‰ SGD æ¢¯åº¦æ›´æ–°è¿™ä¸€ä¸ªä¼˜åŒ–æ–¹å‘ã€‚ç»“åˆ GPT-2 ä¸­ prompt çš„ç”±æ¥ï¼Œprompt çš„å‰èº«æ˜¯è¯­è¨€æ¨¡å‹åšå¤šä»»åŠ¡ zero-shot æ—¶ï¼Œé’ˆå¯¹ä¸åŒä»»åŠ¡ç»™çš„ç‰¹æ®Š tokenï¼Œå› æ­¤ä¸€ä¸ªæ›´åŠ å¯Œæœ‰ä¿¡æ¯é‡çš„â€œç‰¹æ®Š token åºåˆ—â€èƒ½æå‡æ¨¡å‹è¡¨ç°ä¼¼ä¹æ˜¯ä¸€ä»¶éå¸¸ç¬¦åˆç›´è§‰çš„äº‹æƒ…ã€‚</p>
<p>ç›¸æ¯”äºè¿‡å»ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Š token æ¥ä»£è¡¨æŸä¸€ç§ç‰¹å®šçš„ä»»åŠ¡ï¼ŒGPT-3 çš„ few-shot promptï¼Œæˆ–è€…è¯´ in-context learning å½¢å¼ï¼Œåœ¨ç¬”è€…çœ‹æ¥æ˜¯ä¸€ç§æ¨å¹¿ï¼Œç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€å’Œ few-shot æ ·ä¾‹å¯ä»¥çœ‹æˆæ˜¯ä¸€ç»„ç‰¹æ®Š token çš„åºåˆ—ï¼Œå› ä¸ºè‡ªç„¶è¯­è¨€çš„ token å…·æœ‰è¯­ä¹‰å’Œé€»è¾‘å…³è”æ€§ï¼Œä¸€ä¸ªå¼ºå¤§çš„é¢„è®­ç»ƒæ¨¡å‹åšåˆ°äº†â€œç‰¹æ®Š tokenâ€ä¹‹é—´çš„æ³›åŒ–ã€‚</p>
<p>é€šè¿‡å®éªŒæˆ‘ä»¬ä¹Ÿå¯ä»¥è§‚å¯Ÿåˆ°ï¼Œéšç€ç»™å‡ºçš„ç¤ºä¾‹æ ·æœ¬æ•°å˜å¤šï¼Œæ¨¡å‹çš„è¡¨ç°ä¹Ÿåœ¨æå‡ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ä»ç¬”è€…ä¸ªäººçš„è§’åº¦æ¥æ€»ç»“ï¼š</p>
<ul>
<li>æˆ‘ä»¬å¯ä»¥å°†ä¸“å±ä»»åŠ¡ä¸Šå¾®è°ƒå¾—åˆ°çš„æ¨¡å‹ï¼Œçœ‹æˆä¸€ç§ç”¨æˆ·è¾“å…¥ 0 ä¸ªç‰¹æ®Š tokenï¼Œè§£å†³ 1 ç§ä»»åŠ¡çš„èŒƒå¼ï¼Œæ‰€ä»¥<strong>ç¬¬ä¸€èŒƒå¼</strong>ä¸‹çš„æ¯ä¸ªæ¨¡å‹åªèƒ½ç”¨äºè§£å†³ä¸€ä¸ªä¸“å±ä»»åŠ¡ã€‚</li>
<li><strong>ç¬¬äºŒèŒƒå¼</strong>çš„æ¨¡å‹æ˜¯ä¸ºæ¯ä¸€ç§ä»»åŠ¡å‡†å¤‡ 1 ä¸ªç‰¹æ®Š tokenï¼Œå› æ­¤é€šè¿‡æ”¹å˜è¾“å…¥ tokenï¼Œå°±èƒ½ç”¨ä¸€ä¸ªæ¨¡å‹è§£å†³ä¸åŒçš„ä»»åŠ¡ã€‚</li>
<li><strong>ç¬¬ä¸‰èŒƒå¼</strong>çš„æ¨¡å‹æŠŠç‰¹æ®Š token æ›¿æ¢æˆäº†ç‰¹æ®Š token åºåˆ—ï¼Œè€Œè‡ªç„¶è¯­è¨€æ­£å¥½å°±æ˜¯ä¸€ç§æœ€ç¬¦åˆäººç±»ä¹ æƒ¯å’Œç›´è§‰çš„ç‰¹æ®Š token åºåˆ—ã€‚</li>
</ul>
<h2 id="4-training-language-models-to-follow-instructions-with-human-feedback-220302155">4. Training language models to follow instructions with human feedback (2203.02155)</h2>
<p>InstructGPT è¢«è®¤ä¸ºæ˜¯ ChatGPTï¼ˆGPT3.5ï¼‰ èƒŒåçš„æŠ€æœ¯ï¼Œæ ¸å¿ƒç‚¹æ˜¯æŠŠ RLHFï¼Œå³<strong>åŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ </strong>ï¼Œç”¨åˆ°äº†è¯­è¨€æ¨¡å‹ä¸Šæ¥<strong>è¿›è¡Œäººç±»å–œå¥½å¯¹é½</strong>ã€‚ç»è¿‡ RLHF çš„ 1.3B GPT æ¨¡å‹èƒ½åœ¨äººç±»ä¸»è§‚è¯„åˆ†ä¸Šè¶…è¿‡ 175B çš„ GPT-3.</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>è¿™ç¯‡å·¥ä½œé‡Œå°†æ¨¡å‹è¾“å‡ºä¸äººç±»æ„æ„¿ä¸ä¸€è‡´çš„è¿™ä¸ªç°è±¡ç§°ä¸ºâ€œmisalignedâ€ï¼Œå¹¶åˆ†æåŸå› åœ¨äºè¯­è¨€æ¨¡å‹çš„è®­ç»ƒç›®æ ‡åªæ˜¯é¢„æµ‹ä¸‹ä¸€ä¸ª tokenï¼Œè¿™è·Ÿæˆ‘ä»¬å¸Œæœ›æ¨¡å‹â€œfollow the user&rsquo;s instructions helpfully and safelyâ€çš„ç›®æ ‡ä¹‹é—´æ˜¾ç„¶æ˜¯å­˜åœ¨å·®è·çš„ã€‚</p>
<p>ç”¨ Anthropic çš„å·¥ä½œé‡Œçš„è¯æ¥è¯´ï¼Œå¤§æ¨¡å‹åº”è¯¥éµå¾ª 3H åŸåˆ™ï¼Œå³ï¼š</p>
<ul>
<li>helpfulï¼šå¸®åŠ©ç”¨æˆ·è§£å†³é—®é¢˜</li>
<li>honestï¼šä¸èƒ½ä¼ªé€ ä¿¡æ¯æˆ–è¯¯å¯¼ç”¨æˆ·</li>
<li>harmlessï¼šä¸èƒ½å¯¹äººæˆ–ç¯å¢ƒé€ æˆèº«ä½“ã€å¿ƒç†æˆ–ç¤¾ä¼šä¼¤å®³</li>
</ul>
<p>è¯­è¨€æ¨¡å‹ä¹‹æ‰€ä»¥å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼ŒåŸå› ä¹Ÿå¾ˆç®€å•ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯æ— ç›‘ç£å­¦ä¹ ï¼Œæœ¬èº«çš„å­¦ä¹ ç›®æ ‡é‡Œå°±æ²¡æœ‰äººä¸ºæ§åˆ¶ï¼Œæ‰€ä»¥å¾ˆç›´è§‚åœ°å¯ä»¥æƒ³åˆ°ç”¨**ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰**çš„æ–¹å¼æ¥æŠŠç¼ºå¤±çš„äººç±»ç›‘ç£ä¿¡å·åŠ è¿›æ¥ã€‚</p>
<p>ä½†æ˜¯å‰é¢ GPT ä¸‰ç¯‡å·¥ä½œå¥½ä¸å®¹æ˜“æ‰æŠŠæ¨¡å‹åšåˆ° 175B è¿™ä¹ˆå¤§ï¼Œç°åœ¨åˆé‡æ–°å¼€å§‹æ ‡æ•°æ®åšç›‘ç£å­¦ä¹ æ˜¾ç„¶æ˜¯æœ‰ç‚¹ä¸èªæ˜çš„ï¼Œè€Œä¸”æ¨¡å‹å¤§äº†ä»¥åä¹Ÿæ›´å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œå¯¹äºäººç±»åå¥½è¿™ä¸€ç±»çš„é—®é¢˜æ ‡æ³¨èµ·æ¥éš¾åº¦åˆå¾ˆå¤§ï¼Œç®€å•åœ°å…¨é  SFT è‚¯å®šæ˜¯è¡Œä¸é€šçš„ã€‚æ‰€ä»¥å¾ˆè‡ªç„¶åœ°ï¼ŒOpenAI æƒ³åˆ°äº†ç”¨ä»–ä»¬å®¶çš„æ‹¿æ‰‹å¥½æˆå¼ºåŒ–å­¦ä¹ ï¼Œè¦çŸ¥é“ OpenAI æœ¬èº«å°±æ˜¯åšå¼ºåŒ–å­¦ä¹ èµ·å®¶çš„ï¼Œæœ¬æ–‡ä½¿ç”¨çš„å¼ºåŒ–å­¦ä¹ æ–¹æ³• PPO ä¹Ÿå…¨æ˜¯ä¹‹å‰ä»–ä»¬å·²ç»æå‡ºçš„ç®—æ³•ï¼Œæ²¡æœ‰ä»»ä½•æ–°çš„ç®—æ³•è¢«æå‡ºï¼Œç”šè‡³è®ºæ–‡é‡Œéƒ½æ²¡æœ‰å¯¹å·²æœ‰çš„ç®—æ³•è¿›è¡Œå¤ªå¤šçš„è§£é‡Šå’Œé“ºå«ï¼Œéœ€è¦ä½ æ„Ÿå…´è¶£è‡ªå·±å»ç¿»ä»–ä»¬çš„è®ºæ–‡ã€‚</p>
<br>
<center>
  
  <br>
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ä»–ä»¬çš„æ–¹æ³•æ•´ä½“å¯ä»¥æ¦‚æ‹¬å¦‚ä¸‹ï¼š</p>
<ol>
<li>äººå·¥æ ‡ä¸€æ‰¹ SFT æ•°æ®ï¼ˆåŒ…å«é—®é¢˜å’Œå›ç­”ï¼‰ï¼Œå¯¹ GPT-3 æ¨¡å‹ï¼ˆåœ¨å¼ºåŒ–å­¦ä¹ é‡Œå¯¹åº” Policyï¼‰è¿›è¡Œå¾®è°ƒ</li>
<li>ç”¨ SFT å¾—åˆ°çš„æ¨¡å‹ï¼Œé’ˆå¯¹æ¯ä¸ªé—®é¢˜ç”Ÿæˆå‡ ä»½å›ç­”ï¼Œç„¶åäººå·¥ç»™è¿™äº›å›ç­”è´¨é‡æ‰“åˆ†ï¼ˆæ’åºï¼‰</li>
<li>ç”¨è¿™ä»½æ‰“åˆ†æ•°æ®è®­ç»ƒä¸€ä¸ªå¥–åŠ±æ¨¡å‹ï¼ˆReward Model, RMï¼‰ï¼Œè®©å¥–åŠ±æ¨¡å‹ä»£æ›¿äººå·¥æ‰“åˆ†</li>
<li>é‡‡ç”¨ PPO ç®—æ³•ï¼ŒåŸºäºå¥–åŠ±æ¨¡å‹çš„è¯„åˆ†æ¥ç»§ç»­è®­ç»ƒ GPT-3 æ¨¡å‹</li>
</ol>
<p>æ¢è¨€ä¹‹ï¼Œä»–ä»¬ä¸€å…±<strong>é€ äº†ä¸‰ä»½æ•°æ®</strong>ï¼š</p>
<ul>
<li>SFT æ•°æ®ï¼ˆ13k æ¡ï¼‰ï¼šäººå·¥è®¾è®¡çš„é—®é¢˜ï¼Œäººå·¥æ ‡æ³¨ç­”æ¡ˆ</li>
<li>Feedback æ•°æ®ï¼ˆ33k æ¡ï¼‰ï¼šé’ˆå¯¹ä¸Šé¢äººå·¥è®¾è®¡çš„é—®é¢˜ï¼Œæ¨¡å‹è¾“å‡ºçš„å‡ ä»½ç­”æ¡ˆçš„æ’åºï¼ˆæ‰“åˆ†ï¼‰</li>
<li>PPO ä½¿ç”¨çš„æ•°æ®ï¼ˆ31k æ¡ï¼‰ï¼šäººå·¥è®¾è®¡çš„é—®é¢˜ï¼ˆä¸Šé¢çš„æ¨¡å‹æ²¡è§è¿‡çš„æ–°é—®é¢˜ï¼‰ï¼Œç”¨ RM çš„è¯„åˆ†æ¥ç»§ç»­è®­ç»ƒï¼Œè¿™ä»½æ•°æ®ä¸éœ€è¦äººå·¥æ ‡æ³¨ç­”æ¡ˆ</li>
</ul>
<p><strong>è®­ç»ƒä¸‰ä¸ªæ¨¡å‹</strong>ï¼š</p>
<ul>
<li>SFT æ¨¡å‹ï¼ˆ16 epochï¼‰</li>
<li>RM (Reward Model å¥–åŠ±æ¨¡å‹)</li>
<li>PPO ç»§ç»­è®­ç»ƒå‡ºæ¥çš„æœ€ç»ˆæ¨¡å‹</li>
</ul>
<p>ä»–ä»¬ç”šè‡³å¯¹é—®é¢˜ç±»å‹è¿›è¡Œäº†ä¸€äº›åˆ†ç±»ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>æ¨¡å‹è®­ç»ƒéƒ¨åˆ†ï¼Œä¸ªäººè§‰å¾—å€¼å¾—æ³¨æ„çš„ç‚¹æœ‰ï¼š</p>
<ol>
<li>SFT é˜¶æ®µï¼Œåœ¨è®­äº† 1 epoch åæ¨¡å‹å°±å·²ç»è¿‡æ‹Ÿåˆäº†ï¼Œä½†ä»–ä»¬å‘ç°ç»§ç»­è®­ç»ƒè¿‡æ‹Ÿåˆçš„æ¨¡å‹ä¾ç„¶å¯ä»¥æå‡ RM æ€§èƒ½ï¼Œæ‰€ä»¥ä»–ä»¬è®­ç»ƒäº† 16 epoch</li>
<li>RM çš„æƒé‡æ˜¯ç›´æ¥ç”¨ SFT æ¨¡å‹åˆå§‹åŒ–çš„ï¼Œå› ä¸ºè¯„åˆ†æ¨¡å‹ä¹Ÿéœ€è¦è¯­è¨€èƒ½åŠ›ï¼Œç›´æ¥æ‹·è´ä¸€ä»½æƒé‡æ˜¯æ¯”è¾ƒçœäº‹çš„ã€‚RM çš„è¾“å…¥æ˜¯é—®é¢˜+å‡ ä»½ç­”æ¡ˆï¼Œè¾“å‡ºæ˜¯æ’åºã€‚</li>
<li>RM æ¨¡å‹åªæœ‰ 6Bï¼Œå› ä¸º 175B çš„ RM å¾ˆéš¾è®­</li>
<li>å¼ºåŒ–å­¦ä¹ é˜¶æ®µåŠ äº†ä¸€ä¸ªé€ token çš„ KL æ•£åº¦ï¼Œç”¨æ¥è®©æœ€ç»ˆæ¨¡å‹è·Ÿç¬¬ä¸€ç‰ˆ SFT æ¨¡å‹çš„è¦è¾“å‡ºåˆ†å¸ƒå°½é‡ä¿æŒä¸€è‡´ï¼Œå› ä¸º RM æ˜¯åœ¨è®­ç»ƒ SFT æ¨¡å‹çš„æ•°æ®ä¸Šè®­çš„ï¼Œå¦‚æœåˆ†å¸ƒå·®å¼‚å¤ªå¤§ï¼ŒRM çš„è¯„åˆ†å°±ä¸å‡†äº†</li>
</ol>
<p>å¼ºåŒ–å­¦ä¹ çš„ç›®æ ‡å‡½æ•°å¦‚ä¸‹ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ç®€å•ç¿»è¯‘ä¸€ä¸‹ï¼š</p>
<p>$$æŸå¤± = RM è¯„åˆ† + æ–°æ—§æ¨¡å‹è¾“å‡ºtokenåˆ†å¸ƒçš„KLæ•£åº¦ + æ—§é—®é¢˜ä¸ŠSFTçš„æŸå¤±$$</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>RM è¯„åˆ†æ˜¯ RM å¯¹å½“å‰æ­£åœ¨è®­ç»ƒçš„æ¨¡å‹åœ¨æ–°é—®é¢˜ï¼ˆç¬¬ä¸‰ä»½æ•°æ®ï¼‰ä¸Šçš„è¾“å‡ºçš„è¯„åˆ†</li>
<li>KL æ•£åº¦æ˜¯å½“å‰æ¨¡å‹è·Ÿæ—§çš„ SFT æ¨¡å‹è¾“å‡ºä¹‹é—´è®¡ç®—çš„</li>
<li>æ—§é—®é¢˜ SFT æŸå¤±æ˜¯ç”¨ç¬¬ä¸€ä»½æ•°æ®é›†ç»§ç»­æŒ‰ SFT æ–¹æ³•è®­å½“å‰æ¨¡å‹å¾—åˆ°çš„</li>
</ul>
<p>å¦å¤–ï¼Œå…³äºè®­ç»ƒæ•°æ®å’Œè¯„æµ‹æ–¹é¢çš„å–èˆä¹Ÿæœ‰æ‰€ä¸åŒï¼Œè®­ç»ƒä¸­ä»–ä»¬æ›´çœ‹é‡ helpfulï¼Œè€Œè¯„æµ‹é˜¶æ®µåˆ™æ›´çœ‹é‡ honest å’Œ harmlessã€‚</p>
<h2 id="5-gpt-4-technical-report-230308774">5. GPT-4 Technical Report (2303.08774)</h2>
<p><strong>å¤šæ¨¡</strong></p>
<p>åŸºäºä¸Šé¢ç¬”è€…ä¸‰ç§æ¨¡å‹èŒƒå¼çš„æ€è·¯ï¼Œå¤šæ¨¡æ€çš„æ¨¡å‹å¯ä»¥çœ‹æˆæ˜¯è®©ç‰¹æ®Š token çš„ç±»å‹ä»æ–‡æœ¬ token æ‹“å®½åˆ°äº†è§†è§‰ tokenï¼Œå°†æ¨¡å‹è§£å†³çš„ä»»åŠ¡ä» NLP ä»»åŠ¡æ‹“å®½åˆ°äº† CV ä»»åŠ¡ï¼Œè€Œä¸¤ç§æ¨¡æ€ token å¯¹é½çš„æŠ€æœ¯ä¹Ÿæ—©è¢« OpenAI ç ”ç©¶è¿‡äº†ï¼Œä¹Ÿå°±æ˜¯å¤§åé¼é¼çš„ CLIPã€‚å› æ­¤ï¼ŒGPT-4 å…·å¤‡å¤šæ¨¡èƒ½åŠ›æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä»¶æ„å¤–çš„äº‹æƒ…ã€‚</p>
<p><strong>RLHF</strong></p>
<p>åœ¨ç¬”è€…çœ‹æ¥ï¼ŒRLHF ç­‰æŠ€æœ¯æ›´å¤šåœ°æ˜¯åœ¨ä¸é™åˆ¶è¾“å…¥ token åºåˆ—çš„æƒ…å†µä¸‹ï¼Œå»çº¦æŸæ¨¡å‹è¾“å‡ºçš„æŠ€æœ¯ï¼Œå½“ç„¶ä»æŸç§æ„ä¹‰ä¸Šï¼Œä¹Ÿå¯ä»¥çœ‹æˆæ˜¯åœ¨ç›‘ç£ prompts -&gt; task çš„æ˜ å°„å…³ç³»çš„æŠ€æœ¯ï¼ˆå…¶å®å‘å±•åˆ°ç°åœ¨ï¼Œtask è¿™ä¸ªè¯å·²ç»ä¸å¤ªå‡†ç¡®äº†ï¼Œå¯ä»¥æ„ä¼šä¸€ä¸‹ï¼‰ã€‚</p>
<p>GPT-4 çš„æŠ¥å‘Šä¸­æ˜ç¡®æŒ‡å‡ºï¼ŒRLHF å¹¶ä¸èƒ½æå‡æ¨¡å‹è§£å†³ä»»åŠ¡çš„è´¨é‡ï¼ˆä¸ä¼šå¢åŠ çŸ¥è¯†ï¼‰ï¼Œç”šè‡³å¾ˆå¤šæ—¶å€™è°ƒçš„ä¸å¥½è¿˜ä¼šæŸå®³å„ä¸ªä»»åŠ¡ä¸Šçš„æŒ‡æ ‡ã€‚RLHF æ›´å¤šåœ°æ˜¯åœ¨æ„å»ºä¸€äº›æ˜ç¡®çš„ prompts -&gt; task æ˜ å°„å…³ç³»ï¼Œå› ä¸ºè‡ªç„¶è¯­è¨€æ˜¯å…·æœ‰æ­§ä¹‰æ€§çš„ï¼Œå°¤å…¶æ˜¯åœ¨è¾“å…¥ä¿¡æ¯è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œæ¨¡å‹æ ¹æ® prompts â€œç†è§£â€åˆ°çš„é‚£ä¸ª taskï¼Œå¹¶ä¸ä¸€å®šæ˜¯äººç±»çœŸæ­£å¿ƒé‡Œçš„é‚£ä¸ªæ„å›¾ï¼ŒRLHF å®ç°äº†ä¸€ç§å®šåˆ¶åŒ–çš„æ˜ å°„æ­å»ºï¼Œæˆ–è€…è¯´ï¼Œäººç±»å–œå¥½å¯¹é½ã€‚</p>
<p><strong>Predictable scaling</strong></p>
<p>ç”±äºå¤§æ¨¡å‹å®éªŒçš„æˆæœ¬æ—¥æ¸é«˜æ˜‚ï¼Œæˆ‘ä»¬ä¸å†èƒ½åƒå°æ¨¡å‹é‚£æ ·éšä¾¿èµ·å®éªŒè°ƒå‚äº†ã€‚å› æ­¤ OpenAI çš„å¤§éƒ¨åˆ†å®éªŒåº”è¯¥æ˜¯åœ¨ä¸€ä¸ªæ¯” GPT-4 å°å¾ˆå¤šå€çš„æ¨¡å‹ä¸Šè¿›è¡Œçš„ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå°æ¨¡å‹çš„è®­ç»ƒ lossï¼Œæ¥é¢„æµ‹å¤§æ¨¡å‹æœ€ç»ˆè®­ç»ƒå‡ºæ¥çš„ loss</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>åŒæ ·çš„ï¼Œ predictable scaling laws ä¹Ÿåœ¨å¾ˆå¤š HumanEval é›†ä¸Šå¾—åˆ°äº†è§‚å¯Ÿã€‚å½“ç„¶ï¼Œåœ¨ä¸€éƒ¨åˆ†çš„ä»»åŠ¡ä¸Šä¹Ÿè¿˜æ— æ³•è¢«æ‹Ÿåˆçš„æ€§èƒ½æ›²çº¿ï¼Œå› æ­¤ OpenAI è¯´åç»­è¿˜ä¼šè¿›ä¸€æ­¥ä¼˜åŒ–ä»–ä»¬æ¨¡å‹æ€§èƒ½é¢„æµ‹çš„æ–¹æ³•ã€‚</p>
<h2 id="6-sparks-of-artifificial-general-intelligence-early-experiments-with-gpt-4-230312712">6. Sparks of Artifificial General Intelligence: Early experiments with GPT-4 (2303.12712)</h2>
<p>æ™ºèƒ½ï¼ˆIntelligenceï¼‰æ˜¯ä¸€ä¸ªå¤šæ–¹é¢ä¸”éš¾ä»¥æ‰æ‘¸çš„æ¦‚å¿µï¼Œé•¿æœŸä»¥æ¥ç¼ºä¹ä¸€ä¸ªå…±è¯†æ€§çš„å®šä¹‰ã€‚1994 å¹´ 52 å å¿ƒç†å­¦å®¶ç»„æˆçš„å…¬å¼å°ç»„å‡ºç‰ˆçš„å…³äºæ™ºåŠ›ç§‘å­¦çš„ç¤¾è®ºä¸­ï¼Œå°†åªèƒ½å®šä¹‰ä¸ºä¸€ç§éå¸¸æ™®éçš„å¿ƒç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬<strong>æ¨ç†ã€è®¡åˆ’ã€è§£å†³é—®é¢˜ã€æŠ½è±¡æ€è€ƒã€ç†è§£å¤æ‚æƒ³æ³•ã€å¿«é€Ÿå­¦ä¹ å’Œä»ç»éªŒä¸­å­¦ä¹ çš„èƒ½åŠ›</strong>ã€‚</p>
<p>è¿™ç¯‡æ˜¯å¾®è½¯å…³äº GPT-4 çš„ç ”ç©¶æŠ¥å‘Šï¼Œé•¿è¾¾ 55 é¡µï¼Œæ–‡ä¸­çš„å®éªŒéƒ½æ˜¯åœ¨ <strong>æ—©æœŸçš„æ–‡æœ¬å•ä¸€æ¨¡æ€ç‰ˆçš„ GPT-4</strong> ä¸Šè¿›è¡Œçš„ï¼ˆè€Œä¸æ˜¯åé¢æ›´æ–°çš„å¤šæ¨¡æ€ç‰ˆæœ¬ï¼‰, å…¶ç›®æ ‡æ˜¯ç”Ÿæˆä¸€äº›æ–°é¢–è€Œå›°éš¾çš„ä»»åŠ¡å’Œé—®é¢˜ï¼Œæ¥è¯æ˜ GPT-4 çš„èƒ½åŠ›å¹¶ä¸æ˜¯å•çº¯çš„è®°å¿†ï¼Œå¹¶ä¸”å®ƒå¯¹<strong>æ¦‚å¿µã€æŠ€èƒ½å’Œé¢†åŸŸæœ‰æ·±åˆ»è€Œçµæ´»çš„ç†è§£</strong>ã€‚å¦å¤–è¿˜æ—¨åœ¨æ¢ç´¢ GPT-4 çš„å“åº”å’Œè¡Œä¸ºï¼Œä»¥éªŒè¯å…¶<strong>ä¸€è‡´æ€§ã€è¿è´¯æ€§å’Œæ­£ç¡®æ€§</strong>ï¼Œæ­ç¤ºå…¶<strong>å±€é™æ€§å’Œåå·®</strong>ã€‚</p>
<p><strong>å¦‚ä½•è¡¡é‡ GPT-4 çš„æ™ºèƒ½</strong></p>
<p>ä¼ ç»Ÿæœºå™¨å­¦ä¹ çš„æ ‡å‡†åšæ³•æ˜¯å‡†å¤‡ä¸€ç»„æ ‡å‡†è¯„æµ‹æ•°æ®é›†ï¼Œç¡®ä¿å®ƒä»¬ç‹¬ç«‹äºè®­ç»ƒæ•°æ®ä¹‹å¤–ï¼Œè¦†ç›–ä¸€ç³»åˆ—çš„ä»»åŠ¡å’Œé¢†åŸŸã€‚</p>
<p>ä½†è¿™ç§æ–¹æ³•å¹¶ä¸å¤ªé€‚ç”¨äº GPT-4ï¼Œå› ä¸º GPT-4 æ˜¯é—­æºæ¨¡å‹ï¼Œç›¸å…³çš„è®­ç»ƒæ•°æ®é›†ä¿¡æ¯ä¸å…¬å¼€ï¼Œå¹¶ä¸”å¯ä»¥é¢„è§åœ°éå¸¸åºå¤§ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ä¿è¯ç›®å‰å…¬å¼€çš„åŸºå‡†æµ‹è¯•é›†ä¸åœ¨å®ƒçš„è®­ç»ƒæ•°æ®é‡Œã€‚ä¹Ÿæ­£å› ä¸ºæ­¤ï¼Œæœ¬æ–‡é‡‡ç”¨çš„ç ”ç©¶æ–¹æ³•æ›´æ¥è¿‘äºä¼ ç»Ÿå¿ƒç†å­¦ï¼Œè€Œä¸æ˜¯æœºå™¨å­¦ä¹ æ–¹æ³•ã€‚</p>
<p><strong>å¤šæ¨¡æ€ä¸è·¨å­¦ç§‘æ•´åˆ</strong></p>
<p>æ™ºèƒ½çš„ä¸€ä¸ªé‡è¦è¡¡é‡æŒ‡æ ‡æ˜¯ç»¼åˆä¸åŒé¢†åŸŸä¿¡æ¯çš„èƒ½åŠ›ï¼Œä»¥åŠè·¨å­¦ç§‘åœ°åº”ç”¨çŸ¥è¯†å’ŒæŠ€èƒ½çš„èƒ½åŠ›ã€‚è¿™ä¸€èŠ‚ä¸­ä½œè€…ä¸¾äº†å››ä¸ªä¾‹å­æ¥è¯´æ˜ GPT-4 å…·æœ‰å¾ˆå¼ºçš„å¤šæ¨¡æ€ä¸è·¨å­¦ç§‘æ•´åˆèƒ½åŠ›ï¼š</p>
<ol>
<li>å†™ JavaScript ä»£ç æ¥ç”Ÿæˆç”»å®¶ Wassily Kandinsky é£æ ¼çš„ä½œå“ã€‚å›¾ä¸€æ˜¯è¯¥ç”»å®¶çš„åŸä½œï¼Œåé¢åˆ†åˆ«æ˜¯ GPT-4 å’Œ ChatGPT å†™çš„ä»£ç ç”»å‡ºçš„ã€‚</li>
</ol>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<ol start="2">
<li>ç”¨èå£«æ¯”äºšçš„æ–‡é£æ¥è¯æ˜ç´ æ•°æ— ç©·å®šç†</li>
</ol>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<ol start="3">
<li>ä»¥åœ£é›„ç”˜åœ°çš„å£å»å†™ä¸€å°ä¿¡ç»™ä»–çš„å¦»å­ï¼Œå†…å®¹æ˜¯æ”¯æŒâ€œç”µå­â€æˆä¸ºç¾å›½æ€»ç»Ÿå€™é€‰äºº</li>
</ol>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<ol start="4">
<li>å†™ Python ä»£ç ï¼Œä»¥å¹´é¾„ã€æ€§åˆ«ã€ä½“é‡ã€èº«é«˜å’Œè¡€æ¶²æµ‹è¯•ç»“æœå‘é‡ä½œä¸ºè¾“å…¥ï¼Œæ¥é¢„æµ‹ç”¨æˆ·æ˜¯å¦æœ‰æ‚£ç³–å°¿ç—…çš„é£é™©</li>
</ol>
<p>è¿™äº›å¯¹æ¯”å¯ä»¥ä½“ç° GPT-4 èƒ½åˆ›æ–°æ€§åœ°æ•´åˆä¸åŒé¢†åŸŸçš„æ¦‚å¿µï¼Œå¹¶ä¸”æ˜¾è‘—å¼ºäº ChatGPTã€‚é™¤æ­¤ä¹‹å¤–ä½œè€…ä¹Ÿæµ‹è¯•äº† GPT-4 åœ¨éŸ³ä¹ã€ç»˜å›¾ã€ç©ºé—´ç†è§£æ–¹é¢çš„èƒ½åŠ›ã€‚</p>
<p><strong>ä»£ç </strong></p>
<p>é™¤äº†å¸¸è§çš„ leetcode åˆ·é¢˜ï¼Œä½œè€…æµ‹è¯•äº† GPT-4 ç”Ÿæˆé€†å‘å·¥ç¨‹ä»£ç ã€è§£é‡Šå·²æœ‰ä»£ç ã€ç”¨è‡ªç„¶è¯­è¨€æ¨¡æ‹Ÿä»£ç æ‰§è¡Œè¿‡ç¨‹ã€è¿è¡Œä¼ªä»£ç ç­‰èƒ½åŠ›ã€‚</p>
<p><strong>æ•°å­¦</strong></p>
<p>åœ¨ä¸€ç³»åˆ—çš„åˆ†æå®éªŒåï¼Œä½œè€…ä»ä»¥ä¸‹ä¸‰æ–¹é¢æ€»ç»“äº†GPT-4çš„æ•°å­¦èƒ½åŠ›ï¼š</p>
<ol>
<li><strong>åˆ›é€ æ€§æ¨ç†</strong>ï¼šè¯†åˆ«æ¯ä¸ªé˜¶æ®µå¯èƒ½ç›¸å…³çš„å‚æ•°ã€ä¸­é—´æ­¥éª¤ã€è®¡ç®—æˆ–ä»£æ•°æ“ä½œçš„èƒ½åŠ›ã€‚è¯¥ç»„ä»¶é€šå¸¸åŸºäºå¯å‘å¼çŒœæµ‹æˆ–ç›´è§‰ï¼Œé€šå¸¸è¢«è®¤ä¸ºæ˜¯æ•°å­¦è§£å†³é—®é¢˜çš„æœ€å®è´¨æ€§å’Œæœ€æ·±åˆ»çš„æ–¹é¢</li>
<li><strong>æŠ€æœ¯ç†Ÿç»ƒç¨‹åº¦</strong>ï¼šæ‰§è¡Œéµå¾ªæŒ‡å®šæ­¥éª¤é›†çš„å¸¸è§„è®¡ç®—æˆ–æ“ä½œçš„èƒ½åŠ›</li>
<li><strong>æ‰¹åˆ¤æ€§æ¨ç†</strong>ï¼šæ‰¹åˆ¤æ€§åœ°æ£€æŸ¥è®ºç‚¹çš„æ¯ä¸ªæ­¥éª¤çš„èƒ½åŠ›ï¼Œå°†å…¶åˆ†è§£ä¸ºå…¶å­ç»„ä»¶ï¼Œè§£é‡Šå®ƒéœ€è¦çš„å†…å®¹ï¼Œå®ƒä¸å…¶ä½™è®ºç‚¹ç›¸å…³ä»¥åŠä¸ºä»€ä¹ˆæ˜¯æ­£ç¡®çš„</li>
</ol>
<p>è¿™ä¸€èŠ‚ä½œè€…å‘ç° GPT-4 çš„å¾ˆå¤šç¼ºé™·ï¼Œå¦‚ï¼š</p>
<ul>
<li>åœ¨æ‰§è¡Œä¸€äº›å¾ˆå¸¸è§„ä¸”æœºæ¢°çš„è®¡ç®—æ—¶ç»å¸¸ç®—é”™å’Œæ··æ·†</li>
<li>GPT-4 ç”±äºæ˜¯è‡ªå›å½’æ¨¡å‹ï¼Œå› æ­¤æ˜¯å®æ—¶çº¿æ€§è¾“å‡ºçš„ï¼Œè€Œæ²¡æœ‰åŠæ³•â€œæ‰“è…¹ç¨¿â€</li>
</ul>
<p><strong>ä¸ä¸–ç•Œçš„äº¤äº’</strong></p>
<p>æ™ºèƒ½çš„å¦ä¸€é‡è¦æ–¹é¢æ˜¯äº¤äº’èƒ½åŠ›ï¼Œå³è·Ÿå¤–ç•Œç¯å¢ƒå’Œæ™ºèƒ½ä½“è¿›è¡Œäº¤äº’çš„èƒ½åŠ›ï¼Œä½œè€…ä¸»è¦é€šè¿‡<strong>å·¥å…·è°ƒç”¨</strong>å’Œ<strong>å…·èº«äº¤äº’</strong>ä¸¤ä¸ªç»´åº¦æ¥è¯„ä¼°ã€‚</p>
<p>å·¥å…·è°ƒç”¨è¿™é‡Œä¸å¤šèµ˜è¿°äº†ï¼Œå…·èº«äº¤äº’æ–¹é¢æµ‹è¯•äº†æ–‡å­—è·‘å›¢æ¸¸æˆï¼Œä»¥åŠäº¤äº’å¼åœ°æŒ‡å¯¼äººå‘˜æ‰¾åˆ°å¤©èŠ±æ¿æ¼æ°´çš„åœ°æ–¹å¹¶è¿›è¡Œä¿®è¡¥ï¼Œé€æ­¥æ ¹æ®äººç±»çš„æ¯ä¸€æ­¥åé¦ˆï¼Œç»™å‡ºè¡ŒåŠ¨å»ºè®®å’ŒæŒ‡ç¤ºã€‚</p>
<p><strong>ä¸äººç±»çš„äº¤äº’</strong></p>
<p>GPT-4 åœ¨æ¨ç†ä»–äººå¿ƒç†çŠ¶æ€æ–¹é¢è¡¨ç°éå¸¸çªå‡ºï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡æ‹Ÿç°å®åœºæ™¯ä¸­ï¼Œå®ƒçš„è§£é‡Šèƒ½åŠ›ä¹Ÿå¾ˆå¼ºï¼Œèƒ½å¯¹è‡ªå·±çš„åˆ¤æ–­å’Œè¨€è®ºè¿›è¡Œè‡ªæˆ‘è§£é‡Šã€‚</p>
<p><strong>åˆ¤åˆ«èƒ½åŠ›</strong></p>
<p>åˆ¤åˆ«èƒ½åŠ›ä¸»è¦æŒ‡æ¨¡å‹åŒºåˆ«ä¸åŒäº‹ç‰©ã€æ¦‚å¿µå’Œæƒ…æ™¯çš„èƒ½åŠ›ã€‚æ¯”å¦‚ï¼ŒåŒºåˆ†ä¸¤ä¸ªé£Ÿç‰©å“ªä¸ªæ˜¯å¯ä»¥å®‰å…¨é£Ÿç”¨ï¼Œå“ªä¸ªæ˜¯æœ‰æ¯’çš„ã€‚</p>
<p>è¿™ä¸€èŠ‚çš„æµ‹è¯•é‡Œï¼Œæ­ç¤ºå‡ºå½“å‰çš„è¯„æµ‹æŒ‡æ ‡å­˜åœ¨çš„ç¼ºé™·ï¼šå¯¹äºè¯­å¥ç›¸ä¼¼åº¦æ•æ‰ä¸å¤Ÿï¼Œä¾ç„¶ä¸¥é‡ä¾èµ–å•è¯å’ŒçŸ­å¥çš„ç›¸ä¼¼åº¦ï¼Œå› æ­¤åœ¨å¾ˆå¤šæ—¶å€™å‚è€ƒç­”æ¡ˆå¾ˆçŸ­ï¼Œè€Œ GPT-4 ç”Ÿæˆçš„ç­”æ¡ˆå¾ˆé•¿ï¼Œä¼šè¢« ROUGE è¿™æ ·çš„æŒ‡æ ‡åˆ¤å®šä¸ºç­”æ¡ˆä¸åŒ¹é…ï¼Œè€Œäººå·¥æ£€æŸ¥åå‘ç° GPT-4 çš„ç­”æ¡ˆæ›´åŠ é«˜è´¨é‡å’Œå…·æœ‰è¯´æœåŠ›ã€‚</p>
<p>å¦ä¸€æ–¹é¢ä½œè€…ä¹Ÿæµ‹è¯•äº†ç”¨ GPT-4 ä½œä¸ºè¯„åˆ†å‘˜ï¼Œå¯¹å›ç­”è¿›è¡Œæ‰“åˆ†ï¼Œå®éªŒç°å®å°½ç®¡è·ç¦»äººç±»æ‰“åˆ†è¿˜å­˜åœ¨ä¸€äº›å·®è·ï¼Œä½†åœ¨ä¸€äº›å¼ºçº¦æŸçš„åœºæ™¯ä¸‹å·²ç»å¾ˆå…·æœ‰ç«äº‰åŠ›äº†ã€‚</p>
<p><strong>è‡ªå›å½’ç»“æ„çš„å±€é™æ€§</strong></p>
<p>è‡ªå›å½’ç»“æ„çš„è¾“å‡ºæ˜¯å®æ—¶è¿›è¡Œçš„ï¼Œå› æ­¤ä¸å­˜åœ¨â€œæ‰“è‰ç¨¿â€çš„æœºä¼šï¼Œå› æ­¤æ— æ³•â€œstep-by-stepâ€åœ°å¤„ç†é—®é¢˜ï¼Œè€Œå¼•å…¥æ€ç»´é“¾åˆ™å¯ä»¥æ˜¾è‘—åœ°æå‡æ¨¡å‹å‡†ç¡®åº¦ã€‚</p>
<p>å¯¹äºä¸€äº›ä¾èµ–é€’å½’å›æº¯çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸€æ­¥ä¸€æ­¥è¾“å‡ºæ±‰è¯ºå¡”é—®é¢˜çš„è§£æ³•ï¼ŒGPT-4 è¡¨ç°éå¸¸å·®ï¼Œåœ¨è§£å†³ä¸èƒ½ä»¥è¿ç»­æ–¹å¼å¤„ç†çš„å¤æ‚æˆ–åˆ›é€ æ€§é—®é¢˜æ—¶ï¼Œéƒ½æš´éœ²å‡ºäº†ä¸¥é‡çš„å±€é™æ€§ã€‚</p>
<p>æ¯”å¦‚è¦æ±‚ GPT-4 ä¿®æ”¹â€œ9 * 4 + 6 * 6 = 72â€è¿™ä¸ªç­‰å¼å·¦è¾¹çš„ä¸€ä¸ªæ•°å­—ï¼Œæ¥è®©ç­‰å¼è®¡ç®—ç»“æœå˜æˆ 99ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ— æ³•ç®€å•â€œstep-by-stepâ€æ¨ç†å¾—åˆ°ç­”æ¡ˆçš„é—®é¢˜ï¼ŒGPT-4 æœ€åçš„å‡†ç¡®ç‡ä¹Ÿéå¸¸ä½ã€‚</p>
<p>è¿™ä¸€èŠ‚çš„è®¨è®ºä¸­ï¼Œä½œè€…æŒ‡å‡ºï¼Œç†è§£è¿™äº›å±€é™æ€§çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ç±»æ¯”è¯ºå¥–ä½œè€…å¡å°¼æ›¼æå‡ºçš„â€œå¿«æ€è€ƒâ€å’Œâ€œæ…¢æ€è€ƒâ€çš„æ¦‚å¿µã€‚å¡å°¼æ›¼è®¤ä¸ºäººç±»æ€ç»´åˆ†æˆå¿«ã€æ…¢ä¸¤ä¸ªç³»ç»Ÿï¼Œå¿«æ€è€ƒæ˜¯ä¸€ç§è‡ªåŠ¨çš„ã€ç›´è§‚çš„ã€ä¸éœ€è¦èŠ±è´¹ç²¾åŠ›çš„æ€è€ƒæ–¹å¼ï¼Œé€Ÿåº¦å¿«ä½†æ˜¯å®¹æ˜“å‡ºé”™å’Œåè§ã€‚æ…¢æ€è€ƒæ˜¯ä¸€ç§å—æ§çš„ã€ç†æ€§çš„ã€è€—è´¹ç²¾åŠ›çš„æ€è€ƒæ–¹å¼ï¼Œè™½ç„¶é€Ÿåº¦æ…¢ä½†æ˜¯å‡†ç¡®å¯é ã€‚</p>
<p>å½“å‰çš„ GPT-4 å¾ˆå¤§ç¨‹åº¦ä¸Šå¯ä»¥çœ‹æˆæ˜¯åœ¨æ‰§è¡Œå¿«æ€è€ƒï¼Œä½†ç¼ºå°‘æ…¢æ€è€ƒèƒ½åŠ›ã€‚</p>
<p><strong>æœªæ¥æ–¹å‘</strong></p>
<p>ä½œè€…åœ¨è¿™ä¸€èŠ‚æ€»ç»“äº†æœªæ¥ GPT-4 å¯ä»¥ç ”ç©¶å’Œæ”¹è¿›çš„æ–¹å‘ï¼š</p>
<ul>
<li><strong>ç½®ä¿¡åº¦æ ¡éªŒ</strong>ï¼šæ¨¡å‹çš„è¾“å‡ºç¼ºä¹ç½®ä¿¡åº¦ï¼Œæ—¢ä¼šç¼–é€ è®­ç»ƒé›†ä¸­æ²¡æœ‰çš„å†…å®¹ï¼ˆopen-domain å¹»è§‰ï¼‰ï¼Œä¹Ÿä¼šç”Ÿæˆä¸ Prompt ä¸ä¸€è‡´çš„å†…å®¹ï¼ˆclose-domain å¹»è§‰ï¼‰</li>
</ul>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<ul>
<li><strong>é•¿æœŸè®°å¿†</strong>ï¼šå³é•¿çš„ä¸Šä¸‹æ–‡</li>
<li><strong>æŒç»­å­¦ä¹ </strong>ï¼šå½“å‰å¾®è°ƒå’Œè‡ªæˆ‘æ›´æ–°æˆæœ¬è¿‡é«˜ã€ç¼ºä¹æœ‰æ•ˆä¸”ç¨³å®šçš„æ‰‹æ®µï¼ˆä¿æŒå·²æœ‰èƒ½åŠ›ä¸ä¸¢å¤±å’Œé—å¿˜ï¼‰</li>
<li><strong>ä¸ªæ€§åŒ–</strong>ï¼šæ ¹æ®åº”ç”¨å’Œéœ€æ±‚è¿›è¡Œå®šåˆ¶ã€æ‰®æ¼”ã€è°ƒæ•´é£æ ¼ç­‰</li>
<li><strong>æå‰è§„åˆ’å’Œæ¦‚å¿µæ€§è·³è·ƒ</strong>ï¼šæ¨ç†è¿‡ç¨‹è¿‡äºçº¿æ€§ï¼Œåœ¨éœ€è¦æ€ç»´è·³è·ƒæ€§çš„ä»»åŠ¡ä¸Šè¡¨ç°ä¸ä½³</li>
<li><strong>é€æ˜åº¦ã€å¯è§£é‡Šæ€§å’Œä¸€è‡´æ€§</strong></li>
<li><strong>è®¤çŸ¥è°¬è¯¯å’Œéç†æ€§</strong>ï¼šæ•°æ®ä¸­å­˜åœ¨çš„åè§ã€æˆè§æˆ–é”™è¯¯å¼•å…¥äº†è®¤çŸ¥åå·®å’Œéç†æ€§</li>
<li><strong>å¯¹è¾“å…¥çš„æ•æ„Ÿæ€§</strong>ï¼šå¯¹äº Prompt è¿‡äºæ•æ„Ÿï¼Œé²æ£’æ€§ä¸å¤Ÿ</li>
</ul>
<p>è¿™äº›å±€é™æ€§å‡æŒ‡å‘ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š<strong>å“ªäº›ç¼ºé™·æ˜¯è‡ªå›å½’æ¶æ„çš„å…ˆå¤©ç¼ºé™·ï¼Œå“ªäº›æ˜¯åœ¨å·²æœ‰æ¶æ„ä¸Šå¯ä»¥é€šè¿‡å¤„ç†æ•°æ®ã€å¢åŠ å¤–æŒ‚çš„ç»„ä»¶å’Œå¢å¤§å‚æ•°é‡è§£å†³çš„ã€‚</strong></p>
<h3 id="7-the-dawn-of-lmms-preliminary-explorations-with-gpt-4vision-230917421">7. The Dawn of LMMs: Preliminary Explorations with GPT-4V(ision) (2309.17421)</h3>
<p>å¾®è½¯å‘å¸ƒçš„ 166 é¡µçš„ GPT-4V æŠ¥å‘Šï¼Œä¸»è¦å›´ç»•ä»¥ä¸‹å››ä¸ªç‚¹è¿›è¡Œå±•å¼€ç ”ç©¶ï¼š</p>
<ol>
<li>GPT-4V æ”¯æŒå“ªäº›è¾“å…¥å’Œå·¥ä½œæ¨¡å¼ï¼Ÿ</li>
<li>GPT-4V åœ¨ä¸åŒé¢†åŸŸå’Œä»»åŠ¡ä¸Šçš„èƒ½åŠ›è´¨é‡å’Œé€šç”¨æ€§å¦‚ä½•ï¼Ÿ</li>
<li>GPT-4V æœ‰æ•ˆä½¿ç”¨å’Œæç¤ºæ–¹æ³•æœ‰å“ªäº›ï¼Ÿ</li>
<li>æœªæ¥æœ‰å“ªäº›æœ‰å‰é€”çš„æ–¹å‘ï¼Ÿ</li>
</ol>
<p><strong>GPT-4V çš„è¾“å…¥æ¨¡å¼</strong></p>
<ul>
<li>çº¯æ–‡æœ¬</li>
<li>å•ä¸ªå›¾åƒ-æ–‡æœ¬å¯¹</li>
<li>å›¾åƒæ–‡æœ¬äº¤æ›¿è¾“å…¥</li>
</ul>
<p>å‰ä¸¤ç§ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œç¬¬ä¸‰ç§äº¤æ›¿è¾“å…¥çš„æƒ…å†µï¼Œå·²ç»éå¸¸æ¥è¿‘äºäººçš„èŠå¤©æ¨¡å¼äº†ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p><strong>GPT-4V çš„å·¥ä½œæ¨¡å¼å’Œæç¤ºæŠ€æœ¯</strong></p>
<p>å®éªŒè¯æ˜ï¼Œåœ¨ LLM ä¸Šç ”ç©¶å‡ºæ¥ä¸Šå„ç§æç¤ºæŠ€æœ¯ï¼Œåœ¨ GPT-4V ä¸Šä¹Ÿæ˜¯å¥½ä½¿çš„ï¼Œæ¯”å¦‚æ€ç»´é“¾ã€few-shot æç¤ºç­‰ã€‚</p>
<p>è¿™ä¸€èŠ‚æåˆ°äº†ä¸€ä¸ªâ€œLLMs don&rsquo;t want to succeedâ€çš„ç†è®ºï¼Œè²Œä¼¼æ˜¯æ¥è‡ªäº Andrej Karpathy çš„æŸæ¬¡æ¼”è®²ï¼Œé‡Œé¢å±•ç¤ºäº†ä¸€ç§ç±»ä¼¼äºå‚¬çœ ä¸€æ ·çš„æç¤ºæŠ€æœ¯ï¼Œå³ï¼Œ<strong>ä½ æƒ³è¦ä½ çš„ LLM è¡¨ç°æ›´å‡ºè‰²ï¼Œä½ å°±è¦ç”¨ç›´æ¥çš„æç¤ºè¯è¯´â€œä½ æ˜¯xxxæ–¹é¢çš„ä¸“å®¶â€ï¼Œå¦åˆ™å®ƒä¹‹åè¡¨ç°å‡ºä¸€èˆ¬æ™®é€šäººæ°´å¹³çš„èƒ½åŠ›</strong>ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>å®Œæ•´çš„ PPT å¯ä»¥çœ‹è¿™é‡Œï¼šhttps://karpathy.ai/stateofgpt.pdf</p>
<p>åœ¨è®ºæ–‡ä¸­ä½œè€…æ˜¯ä¸¾äº†ä¸€ä¸ªæ•°è‹¹æœçš„æ¡ˆä¾‹ï¼Œè®© GPT-4V æ¥æ•°ä¸€ä¸‹ç”»é¢ä¸­æœ‰å‡ ä¸ªè‹¹æœã€‚ä¸€å¼€å§‹ GPT-4V å¹¶ä¸èƒ½è½»æ˜“å¾—åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œä½†ç»è¿‡ä¸€ç³»åˆ—æˆ‘ä»¬å·²çŸ¥çš„ LLM Prompt æŠ€å·§åŠ å¼ºåï¼ŒGPT-4V å˜å¾—å¯é ï¼Œèƒ½å¤Ÿæ­£ç¡®è®¡æ•°ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>åœ¨æ—¥å¸¸çš„äººå’Œäººäº¤äº’ä¸­ï¼Œåœ¨å›¾ç‰‡ä¸­ç”»åœˆã€ç”»ç®­å¤´æ¥æŒ‡å‘å…³é”®ä¿¡æ¯æ˜¯ä¸€ç§å¾ˆè‡ªç„¶ä¸”å¸¸è§çš„æ–¹å¼ï¼Œ ç»å®éªŒ GPT-4V åœ¨è¿™æ–¹é¢çš„ç†è§£èƒ½åŠ›éå¸¸å¼ºå¤§ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ä½œè€…å®éªŒäº†ä¸€äº›å¾ˆæœ‰æŒ‘æˆ˜æ€§çš„ caseï¼Œå‘ç°åŸºæœ¬ä¸Šéš¾ä¸å€’å®ƒï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>åœ¨ In-context few-shot learning æ–¹é¢ï¼Œä½œè€…ä¹Ÿç”¨ä¸€ä¸ªå¾ˆæœ‰ä»£è¡¨æ€§çš„ä¾‹å­è¯´æ˜äº†æä¾›ç¤ºä¾‹æ ·æœ¬çš„é‡è¦æ€§ã€‚ä½œè€…ç»™äº†ä¸€å¼ ä»ªè¡¨çš„å›¾ï¼Œè®© GPT-4V è¯»å‡ºå½“å‰ä»ªè¡¨æŒ‡é’ˆæŒ‡å‘çš„æ•°å€¼ï¼Œä¸€å¼€å§‹ä¸è®ºå¦‚ä½•æ”¹è‰¯ prompt éƒ½æ— æ³•å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ç”šè‡³åœ¨ç»™å‡ºä¸€ä¸ªç¤ºä¾‹çš„æƒ…å†µä¸‹æ¨¡å‹ä»ç„¶è¡¨ç°ä¸ä½³ï¼Œä½†å½“ç¤ºä¾‹å¢åŠ åˆ°ä¸¤ä¸ªåï¼ŒGPT-4V å°±çªç„¶èƒ½æˆåŠŸè¯»æ•°äº†ï¼Œå¯è§<strong>æä¾›ä¸Šä¸‹æ–‡ç¤ºä¾‹å¯¹äºæå‡å¤§æ¨¡å‹æ€§èƒ½è‡³å…³é‡è¦</strong>ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p><strong>è§†è§‰è¯­è¨€èƒ½åŠ›</strong></p>
<p>åœ¨å¤§éƒ¨åˆ†å·²æœ‰çš„ CV å­ä»»åŠ¡ä¸Šï¼ŒGPT-4V éƒ½è¡¨ç°å‡ºäº†ä¸é”™çš„èƒ½åŠ›ï¼Œå¸¸è§çš„åœºæ™¯æè¿°ç­‰æ›´æ˜¯è¡¨ç°å‡ºè‰²ï¼Œåœ¨ç›¸å¯¹å°ä¼—çš„é¢†åŸŸï¼Œå¦‚åŒ»å­¦å›¾åƒä¸Šï¼ŒåŒæ ·è®©äººå°è±¡æ·±åˆ»ï¼ŒGPT-4V å¯ä»¥æ ¹æ® CT å›¾åˆ¤æ–­å‡ºæ™ºé½¿å’Œéª¨æŠ˜ç­‰ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>å½“ç„¶ï¼Œåœ¨ä¸€äº›å·²ç»è¢«åšå¾—éå¸¸æ·±å…¥çš„å­ä»»åŠ¡ä¸Šï¼ŒGPT-4V ç›¸è¾ƒäº SOTA æ¨¡å‹è¿˜æœ‰ä¸å°çš„å·®è·ï¼Œä½†è¿˜æ˜¯é‚£å¥è¯ï¼Œæ½œåŠ›å¤§äºç»å¯¹ç²¾åº¦ï¼Œç›®å‰ GPT-4V å·²ç»å±•ç°å‡ºäº†è®©äººé¼“èˆçš„æ€§èƒ½ï¼Œä¼˜åŒ–ä¸ªåˆ«ä»»åŠ¡ä¸Šçš„è¡¨ç°åªæ˜¯æ—¶é—´é—®é¢˜ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>GPT-4V ç”šè‡³èƒ½çœ‹æ‡‚æ¢—å›¾ï¼Œè§£é‡Šå…¶ä¸­çš„ç¬‘ç‚¹ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>å€ŸåŠ© GPT-4V å¼ºå¤§çš„æ¨ç†èƒ½åŠ›å’Œå…·å¤‡çš„å¸¸è¯†ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥â€œ<strong>å‡å¦‚ä½ æ˜¯ä¸€åä¾¦æ¢ï¼Œä½ å¯ä»¥ä»å›¾ä¸­æ¨ç†å‡ºå“ªäº›çº¿ç´¢ï¼Ÿ</strong>â€</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p><strong>æ—¶é—´åºåˆ—å’Œè§†é¢‘ç†è§£</strong></p>
<p>ä½œè€…å®éªŒäº†å¤šå›¾åƒåºåˆ—ï¼ŒGPT-4V èƒ½å¤Ÿè¯†åˆ«å‡ºè¿™æ˜¯ä¸€ç»„åŠ¨æ€å›¾åƒåºåˆ—ï¼Œå¹¶ä¸”èƒ½ç»“åˆèµ·æ¥åˆ¤æ–­ç”»é¢ä¸­çš„äººæ­£åœ¨åšä¿¯å§æ’‘ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p><strong>æƒ…å•†æµ‹è¯•</strong></p>
<p>åœ¨è¿™ä¸€èŠ‚ï¼ŒGPT-4V å¯ä»¥åŸºäºäºˆä»¥å†…å®¹å’Œå›¾åƒæ ·å¼è§£é‡Šè§†è§‰æƒ…æ„Ÿï¼Œå¦‚æ»¡æ„ã€æ„¤æ€’ã€æ•¬ç•å’Œææƒ§ç­‰ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ç”šè‡³å¯ä»¥ä¸€å¼ å›¾ç‰‡è®© GPT-4V ç”¨ä¸¤ç§ä¸åŒæ–¹å¼æ¥æè¿°ï¼Œåˆ†åˆ«è®©äººæ„Ÿåˆ°ä¸å®‰å’Œæ„Ÿåˆ°èˆ’é€‚ï¼ˆæ–°é—»å­¦è®©å®ƒç©æ˜ç™½äº†ï¼‰ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p><strong>æ–°å…´åº”ç”¨äº®ç‚¹</strong></p>
<ul>
<li>è¡Œä¸šï¼š
<ul>
<li>ç¼ºé™·æ£€æµ‹</li>
<li>å®‰å…¨æ£€æŸ¥</li>
<li>æ‚è´§ç»“è´¦</li>
</ul>
</li>
<li>åŒ»ç–—</li>
<li>æ±½è½¦ä¿é™©
<ul>
<li>æŸå®³è¯„ä¼°</li>
<li>ä¿é™©æŠ¥å‘Š</li>
</ul>
</li>
<li>å®šåˆ¶åŒ–
<ul>
<li>ç…§ç‰‡ç»„ç»‡</li>
<li>å¯†é›†æ ‡æ³¨ä¸åˆ†å‰²</li>
</ul>
</li>
<li>å›¾åƒç”Ÿæˆ
<ul>
<li>ç”Ÿæˆå›¾åƒçš„è¯„ä¼°</li>
<li>å›¾åƒç¼–è¾‘çš„æç¤ºç”Ÿæˆ</li>
</ul>
</li>
<li>å…·è±¡åŒ–æ™ºèƒ½ä½“
<ul>
<li>æ“ä½œæœºå™¨</li>
<li>å¯¼èˆª</li>
</ul>
</li>
<li>GUI å¯¼èˆªï¼ˆè½¯ä»¶å±‚é¢çš„äº¤äº’å’Œå¯¼èˆªï¼‰</li>
</ul>
<p>æ•´ç¯‡æŠ¥å‘Šç¯‡å¹…è¾ƒå¤šï¼Œå¹¶ä¸”ä¸¾äº†å¤§é‡è¯¦ç»†çš„ä¾‹å­ï¼Œåœ¨è¿™é‡Œå°±ä¸ä¸€ä¸€å±•å¼€äº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œç¿»é˜…ã€‚</p>
<hr>
<p>è‡³æ­¤ï¼Œæˆ‘æ€»ç»“äº† GPT ç³»åˆ—å·¥ä½œé‡Œä¸€äº›æˆ‘å…³æ³¨åˆ°çš„ç‚¹ï¼Œä»ä¸­å¯ä»¥æ„Ÿå—åˆ° OpenAI çš„å·¥ä½œä¹‹é—´éƒ½æœ‰ç€å¾ˆæ·±çš„é€»è¾‘é“¾æ¡ï¼Œå¾ˆå¤šæ¨å¹¿éƒ½ä¼¼ä¹æ˜¯æœ€ç¬¦åˆç›´è§‰çš„ã€‚OpenAI æ—©æœŸå…¬å¼€çš„è®ºæ–‡é‡Œå„ç§ç»†èŠ‚è¿˜æ˜¯å¾ˆä¸°å¯Œçš„ï¼Œä¸ä»…ç»†è‡´åœ°å‘Šè¯‰ä½ å¦‚ä½•æ¸…æ´—å’Œæ„é€ æ•°æ®ï¼Œç”šè‡³è¿˜æ•™ä½ å¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æ ‡æ³¨å‘˜ç»™ä½ æ ‡æ•°æ®ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªä» CV è½¬åˆ° LLM çš„æ–°äººï¼Œéš¾å…çŠ¯ä¸€äº›å¸¸è§æˆ–ä½çº§çš„é”™è¯¯ï¼Œæ¬¢è¿ä»»ä½•è¯»è€…åŠæ—¶æŒ‡å‡ºå’Œæ–§æ­£ï¼Œä¹Ÿæ¬¢è¿ä»»ä½•ç•™è¨€è®¨è®ºã€‚</p>
<p>æœ¬ç¯‡ç¬”è®°çš„å†™ä½œå‚è€ƒäº†æ²ç¥çš„å‡ æœŸ B ç«™è§†é¢‘ï¼Œä»¥åŠçŸ¥ä¹@è‹æ‰“çš„æ–‡ç« ï¼Œç‰¹æ­¤æ„Ÿè°¢</p>
]]></description></item><item><title>Index</title><link>https://jianye0428.github.io/posts/dl_basics_one/</link><pubDate>Fri, 26 Apr 2024 17:15:15 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/dl_basics_one/</guid><description><![CDATA[<h3 id="1softmaxå¦‚ä½•é˜²æ­¢æŒ‡æ•°ä¸Šæº¢">1ã€â­softmaxå¦‚ä½•é˜²æ­¢æŒ‡æ•°ä¸Šæº¢</h3>
<ul>
<li>åŸsoftmaxå…¬å¼ï¼š</li>
</ul>
<center>

</center>
<ul>
<li>å·¥ç¨‹åŒ–å®ç°ï¼Œé˜²æ­¢æŒ‡æ•°ä¸Šæº¢ï¼š</li>
</ul>
<center>

</center>
ï¼Œä½¿aç­‰äºxä¸­æœ€å¤§å€¼ã€‚
<h3 id="2transformerä¸­çš„positional-encoding">2ã€â­Transformerä¸­çš„positional encoding</h3>
<ul>
<li>ä¸ºä»€ä¹ˆéœ€è¦PE: å› ä¸ºtransfomeræ˜¯åŒæ—¶å¤„ç†æ‰€æœ‰è¾“å…¥çš„ï¼Œå¤±å»äº†ä½ç½®ä¿¡æ¯ã€‚</li>
<li>ç¼–ç åº”è¯¥æ»¡è¶³çš„æ¡ä»¶ï¼šaã€å¯¹äºæ¯ä¸ªä½ç½®è¯è¯­ï¼Œç¼–ç æ˜¯å”¯ä¸€çš„ bã€è¯è¯­ä¹‹é—´çš„é—´éš”å¯¹äºä¸åŒé•¿åº¦å¥å­æ˜¯ä¸€è‡´çš„ cã€èƒ½é€‚åº”ä»»æ„é•¿åº¦å¥å­</li>
<li>å…¬å¼ï¼šæ¯ä¸ªè¯è¯­ä½ç½®ç¼–ç ä¸ºä¸åŒé¢‘ç‡çš„ä½™å¼¦å‡½æ•°ï¼Œä»1åˆ°1/10000ã€‚å¦‚ä¸‹å°†æ¯ä¸ªè¯è¯­ä½ç½®ç¼–ç ä¸ºdç»´å‘é‡&ndash;&gt;</li>
</ul>
<center>

</center>
<center>

</center>
<p>å¯ç†è§£ä¸ºä¸€ç§äºŒè¿›åˆ¶ç¼–ç ï¼ŒäºŒè¿›åˆ¶çš„ä¸åŒä½å˜åŒ–é¢‘ç‡ä¸ä¸€æ ·ï¼ŒPEçš„ä¸åŒä½ç½®å˜åŒ–é¢‘ç‡ä¹Ÿä¸ä¸€æ ·</p>
<center>

</center>
<ul>
<li>å¦‚ä½•è·å–ç›¸å¯¹ä½ç½®å…³ç³»ï¼šä¸¤ä¸ªä½ç½®ç¼–ç è¿›è¡Œç‚¹ç§¯ã€‚</li>
</ul>
<center>

</center>
<h3 id="3æ±‚ä¼¼ç„¶å‡½æ•°æ­¥éª¤">3ã€â­æ±‚ä¼¼ç„¶å‡½æ•°æ­¥éª¤</h3>
<ul>
<li>å®šä¹‰ï¼šæ¦‚ç‡æ˜¯ç»™å®šå‚æ•°ï¼Œæ±‚æŸä¸ªäº‹ä»¶å‘ç”Ÿæ¦‚ç‡ï¼›ä¼¼ç„¶åˆ™æ˜¯ç»™å®šå·²å‘ç”Ÿçš„äº‹ä»¶ï¼Œä¼°è®¡å‚æ•°ã€‚</li>
</ul>
<ol>
<li>å†™å‡ºä¼¼ç„¶å‡½æ•°</li>
<li>å¯¹ä¼¼ç„¶å‡½æ•°å–å¯¹æ•°å¹¶æ•´ç†</li>
<li>æ±‚å¯¼æ•°ï¼Œå¯¼æ•°ä¸º0å¤„ä¸ºæœ€ä½³å‚æ•°</li>
<li>è§£ä¼¼ç„¶æ–¹ç¨‹</li>
</ol>
<h3 id="4hmmå’ŒcrfåŒºåˆ«">4ã€â­HMMå’ŒCRFåŒºåˆ«</h3>
<ul>
<li>CRFæ˜¯åˆ¤åˆ«æ¨¡å‹ï¼Œå¯¹é—®é¢˜çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒå»ºæ¨¡ï¼›HMMæ˜¯ç”Ÿæˆæ¨¡å‹ï¼Œå¯¹è”åˆæ¦‚ç‡åˆ†å¸ƒå»ºæ¨¡</li>
<li>HMMæ˜¯æ¦‚ç‡æœ‰å‘å›¾ï¼ŒCRFæ˜¯æ¦‚ç‡æ— å‘å›¾</li>
<li>HMMæ±‚è§£è¿‡ç¨‹å¯èƒ½æ˜¯å±€éƒ¨æœ€ä¼˜ï¼ŒCRFæ˜¯å…¨å±€æœ€ä¼˜</li>
</ul>
<h3 id="5ç©ºæ´å·ç§¯å®ç°">5ã€â­ç©ºæ´å·ç§¯å®ç°</h3>
<p>ç›¸æ¯”äºå¸¸è§„å·ç§¯å¤šäº†dilation rateè¶…å‚æ•°ï¼Œä¾‹å¦‚dilation rate=2ä»£è¡¨ç›¸é‚»ä¸¤ä¸ªå·ç§¯ç‚¹è·ç¦»ä¸º2ï¼Œå¦‚å›¾(b)ã€‚</p>
<center>

</center>
<ul>
<li>å­˜åœ¨é—®é¢˜ï¼šgridding effect, ç”±äºå·ç§¯çš„åƒç´ æœ¬è´¨ä¸Šæ˜¯é‡‡æ ·å¾—åˆ°çš„ï¼Œæ‰€ä»¥å›¾åƒçš„å±€éƒ¨ç›¸å…³æ€§ä¸¢å¤±äº†ï¼ŒåŒæ—¶è¿œè·ç¦»å·ç§¯å¾—åˆ°çš„ä¿¡æ¯ä¹Ÿæ²¡æœ‰ç›¸å…³æ€§ã€‚</li>
</ul>
<h3 id="6æ±‰æ˜è·ç¦»">6ã€â­æ±‰æ˜è·ç¦»</h3>
<p>ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹åº”ä½ç½®çš„ä¸åŒå­—ç¬¦çš„ä¸ªæ•°ã€‚</p>
<h3 id="7è®­ç»ƒè¿‡ç¨‹ä¸­å‘ç°losså¿«é€Ÿå¢å¤§åº”è¯¥ä»å“ªäº›æ–¹é¢è€ƒè™‘">7ã€â­è®­ç»ƒè¿‡ç¨‹ä¸­å‘ç°losså¿«é€Ÿå¢å¤§åº”è¯¥ä»å“ªäº›æ–¹é¢è€ƒè™‘?</h3>
<ul>
<li>å­¦ä¹ ç‡è¿‡å¤§</li>
<li>è®­ç»ƒæ ·æœ¬ä¸­æœ‰åæ•°æ®</li>
</ul>
<h3 id="8pytorchå’ŒtensorflowåŒºåˆ«">8ã€â­Pytorchå’ŒTensorFlowåŒºåˆ«</h3>
<ul>
<li>å›¾ç”Ÿæˆï¼špytorchåŠ¨æ€å›¾ï¼Œtensorflowé™æ€å›¾</li>
<li>è®¾å¤‡ç®¡ç†ï¼špytorch cudaï¼Œtensorflow è‡ªåŠ¨åŒ–</li>
</ul>
<h3 id="9modeleval-vså’Œtorchno_gradåŒºåˆ«">9ã€â­model.eval vså’Œtorch.no_gradåŒºåˆ«</h3>
<ul>
<li>model.eval: ä¾ç„¶è®¡ç®—æ¢¯åº¦ï¼Œä½†æ˜¯ä¸åä¼ ï¼›dropoutå±‚ä¿ç•™æ¦‚ç‡ä¸º1ï¼›batchnormå±‚ä½¿ç”¨å…¨å±€çš„meanå’Œvar</li>
<li>with torch.no_grad: ä¸è®¡ç®—æ¢¯åº¦</li>
</ul>
<h3 id="10æ¯ä¸ªå·ç§¯å±‚çš„flopsè®¡ç®—">10ã€â­æ¯ä¸ªå·ç§¯å±‚çš„FLOPSè®¡ç®—</h3>
<center>

</center>
å³è®¡ç®—feature mapæ¯ä¸ªç‚¹éœ€è¦çš„ä¹˜æ³•å’ŒåŠ æ³•è¿ç®—é‡ï¼Œå®šä¹‰ä¸€ä¸ªä¹˜æ³•å’ŒåŠ æ³•ä¸ºä¸€æ¬¡flopï¼Œåˆ™FLOPSè®¡ç®—å¦‚ä¸‹ï¼š
<center>

</center>
<h3 id="11pcaä¸»æˆåˆ†åˆ†æ">11ã€â­PCA(ä¸»æˆåˆ†åˆ†æ)</h3>
<ul>
<li>â­PCAæ˜¯ä¸€ç§é™ç»´æ–¹æ³•ï¼Œç”¨æ•°æ®é‡Œé¢æœ€ä¸»è¦çš„æ–¹é¢æ¥ä»£æ›¿åŸå§‹æ•°æ®ï¼Œä¾‹å¦‚å°†$m$ä¸ª$n$ç»´æ•°æ®é™ç»´åˆ°$n&rsquo;$ç»´ï¼Œå¸Œæœ›è¿™$m$ä¸ª$n&rsquo;$ç»´æ•°æ®å°½å¯èƒ½åœ°ä»£è¡¨åŸæ•°æ®ã€‚</li>
<li>â­ä¸¤ä¸ªåŸåˆ™ï¼šæœ€è¿‘é‡æ„æ€§&ndash;&gt;æ ·æœ¬ç‚¹åˆ°è¿™ä¸ªè¶…å¹³é¢çš„è·ç¦»è¶³å¤Ÿè¿‘ï¼›æœ€å¤§å¯åˆ†æ€§&ndash;&gt;æ ·æœ¬ç‚¹åœ¨è¿™ä¸ªè¶…å¹³é¢çš„æŠ•å½±å°½å¯èƒ½çš„åˆ†å¼€ã€‚</li>
<li>â­æµç¨‹ï¼šåŸºäºç‰¹å¾å€¼åˆ†è§£åæ–¹å·®çŸ©é˜µå’ŒåŸºäºå¥‡å¼‚å€¼åˆ†è§£SVDåˆ†è§£åæ–¹å·®çŸ©é˜µã€‚</li>
</ul>
<p>ï¼ˆ1ï¼‰å¯¹æ‰€æœ‰æ ·æœ¬è¿›è¡Œä¸­å¿ƒåŒ–</p>
<p>ï¼ˆ2ï¼‰è®¡ç®—æ ·æœ¬çš„åæ–¹å·®çŸ©é˜µ$XX^T$</p>
<p>ï¼ˆ3ï¼‰å¯¹åæ–¹å·®çŸ©é˜µè¿›è¡Œç‰¹å¾å€¼åˆ†è§£</p>
<p>ï¼ˆ4ï¼‰å–å‡ºæœ€å¤§çš„$n&rsquo;$ä¸ªç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Œå°†æ‰€æœ‰ç‰¹å¾å‘é‡æ ‡å‡†åŒ–ï¼Œç»„æˆç‰¹å¾å‘é‡çŸ©é˜µW</p>
<p>ï¼ˆ5ï¼‰å¯¹æ ·æœ¬é›†ä¸­çš„æ¯ä¸€ä¸ªæ ·æœ¬$x^(i)$è½¬åŒ–ä¸ºæ–°çš„æ ·æœ¬$z^(i)=W^T x^(i)$ï¼Œå³å°†æ¯ä¸ªåŸæ•°æ®æ ·æœ¬æŠ•å½±åˆ°ç‰¹å¾å‘é‡ç»„æˆçš„ç©ºé—´ä¸Š</p>
<p>ï¼ˆ6ï¼‰å¾—åˆ°è¾“å‡ºçš„æ ·æœ¬é›†$z^(1)ã€z^(2)&hellip;$</p>
<ul>
<li>â­æ„ä¹‰ï¼šaã€ä½¿å¾—ç»“æœå®¹æ˜“ç†è§£ bã€æ•°æ®é™ç»´ï¼Œé™ä½ç®—æ³•è®¡ç®—å¼€é”€ cã€å»é™¤å™ªå£°</li>
</ul>
<h3 id="12k-meanså¦‚ä½•æ”¹è¿›">12ã€â­k-meanså¦‚ä½•æ”¹è¿›ï¼Ÿ</h3>
<ul>
<li>â­ç¼ºç‚¹ï¼š1ã€kä¸ªåˆå§‹åŒ–çš„è´¨å¿ƒå¯¹æœ€åçš„èšç±»æ•ˆæœæœ‰å¾ˆå¤§å½±å“ 2ã€å¯¹ç¦»ç¾¤ç‚¹å’Œå­¤ç«‹ç‚¹æ•æ„Ÿ 3ã€Kå€¼äººä¸ºè®¾å®š</li>
<li>â­æ”¹è¿›ï¼š
<ul>
<li>K-means++ï¼šä»æ•°æ®é›†éšæœºé€‰æ‹©ä¸€ä¸ªç‚¹ä½œä¸ºç¬¬ä¸€ä¸ªèšç±»ä¸­å¿ƒï¼Œå¯¹äºæ•°æ®é›†ä¸­æ¯ä¸€ä¸ªç‚¹è®¡ç®—å’Œè¯¥ä¸­å¿ƒçš„è·ç¦»ï¼Œé€‰æ‹©ä¸‹ä¸€ä¸ªèšç±»ä¸­å¿ƒï¼Œä¼˜å…ˆé€‰æ‹©å’Œä¸Šä¸€ä¸ªèšç±»ä¸­å¿ƒè·ç¦»è¾ƒå¤§çš„ç‚¹ã€‚é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œå¾—åˆ°kä¸ªèšç±»ä¸­å¿ƒã€‚</li>
<li>K-medoidsï¼šè®¡ç®—è´¨å¿ƒæ—¶ï¼Œè´¨å¿ƒä¸€å®šæ˜¯æŸä¸ªæ ·æœ¬å€¼çš„ç‚¹ã€‚è·ç¦»åº¦é‡ï¼šæ¯ä¸ªæ ·æœ¬å’Œæ‰€æœ‰å…¶ä»–æ ·æœ¬çš„æ›¼å“ˆé¡¿è·ç¦»$((x,y), |x|+|y|)$ã€‚</li>
<li>ISODATAï¼Œåˆç§°ä¸ºè¿­ä»£è‡ªç»„ç»‡æ•°æ®åˆ†ææ³•ï¼Œæ˜¯ä¸ºäº†è§£å†³Kå€¼éœ€è¦äººä¸ºè®¾å®šçš„é—®é¢˜ã€‚æ ¸å¿ƒæ€æƒ³ï¼šå½“å±äºæŸä¸ªç±»åˆ«çš„æ ·æœ¬æ•°è¿‡å°‘æ—¶æˆ–è€…ç±»åˆ«ä¹‹é—´é å¾—éå¸¸è¿‘å°±å°†è¯¥ç±»åˆ«å»é™¤ï¼›å½“å±äºæŸä¸ªç±»åˆ«çš„æ ·æœ¬æ•°è¿‡å¤šæ—¶ï¼ŒæŠŠè¿™ä¸ªç±»åˆ«åˆ†ä¸ºä¸¤ä¸ªå­ç±»åˆ«ã€‚</li>
</ul>
</li>
<li>â­å’Œåˆ†ç±»é—®é¢˜çš„åŒºåˆ«ï¼šåˆ†ç±»çš„ç±»åˆ«å·²çŸ¥ï¼Œä¸”éœ€è¦ç›‘ç£ï¼›k-meansæ˜¯èšç±»é—®é¢˜ï¼Œç±»åˆ«æœªçŸ¥ï¼Œä¸éœ€è¦ç›‘ç£ã€‚</li>
<li>â­ç»ˆæ­¢æ¡ä»¶ï¼šaã€ç›¸é‚»ä¸¤è½®è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œéè´¨å¿ƒç‚¹æ‰€å±ç°‡å‘ç”Ÿæ”¹å˜çš„æ¯”ä¾‹å°äºæŸä¸ªé˜ˆå€¼ bã€æ‰€æœ‰ç°‡çš„è´¨å¿ƒå‡æœªæ”¹å˜ cã€è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°</li>
<li>â­æ—¶é—´å¤æ‚åº¦ï¼š$O(è¿­ä»£æ¬¡æ•° \ast æ•°æ®ä¸ªæ•° \ast k \ast æ•°æ®ç»´åº¦)$ï¼Œkä¸ºkä¸ªç±»åˆ«ä¸­å¿ƒ</li>
<li>â­ç©ºé—´å¤æ‚åº¦ï¼š$O(æ•°æ®ä¸ªæ•° \ast æ•°æ®ç»´åº¦+k \ast æ•°æ®ç»´åº¦)$</li>
</ul>
<h3 id="13dropoutå®ç°">13ã€â­Dropoutå®ç°</h3>
<center>

</center>
ä»¥pçš„æ¦‚ç‡ä½¿ç¥ç»å…ƒå¤±æ•ˆï¼Œå³ä½¿å…¶æ¿€æ´»å‡½æ•°è¾“å‡ºå€¼ä¸º0ï¼š
<center>

</center>
<p>ä¸ºäº†ä½¿è®­ç»ƒå’Œæµ‹è¯•é˜¶æ®µè¾“å‡ºå€¼æœŸæœ›ç›¸åŒï¼Œéœ€è¦åœ¨è®­ç»ƒæ—¶å°†è¾“å‡ºå€¼ä¹˜ä»¥1/(1-p)æˆ–è€…åœ¨æµ‹è¯•æ—¶å°†æƒé‡å€¼ä¹˜ä»¥(1-p)ã€‚</p>
<ul>
<li><strong>Dropoutå’ŒBatch normèƒ½å¦ä¸€èµ·ä½¿ç”¨ï¼Ÿ</strong></li>
</ul>
<p>å¯ä»¥ï¼Œä½†æ˜¯åªèƒ½å°†Dropoutæ”¾åœ¨Batch normä¹‹åä½¿ç”¨ã€‚å› ä¸ºDropoutè®­ç»ƒæ—¶ä¼šæ”¹å˜è¾“å…¥Xçš„æ–¹å·®ï¼Œä»è€Œå½±å“Batch normè®­ç»ƒè¿‡ç¨‹ä¸­ç»Ÿè®¡çš„æ»‘åŠ¨æ–¹å·®å€¼ï¼›è€Œæµ‹è¯•æ—¶æ²¡æœ‰Dropoutï¼Œè¾“å…¥Xçš„æ–¹å·®å’Œè®­ç»ƒæ—¶ä¸ä¸€è‡´ï¼Œè¿™å°±å¯¼è‡´Batch normæµ‹è¯•æ—¶æœŸæœ›çš„æ–¹å·®å’Œè®­ç»ƒæ—¶ç»Ÿè®¡çš„æœ‰åå·®ã€‚</p>
<h3 id="14æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸">14ã€â­æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸</h3>
<p><strong>æ¢¯åº¦æ¶ˆå¤±çš„åŸå› å’Œè§£å†³åŠæ³•</strong></p>
<p>ï¼ˆ1ï¼‰éšè—å±‚çš„å±‚æ•°è¿‡å¤š</p>
<p>åå‘ä¼ æ’­æ±‚æ¢¯åº¦æ—¶çš„é“¾å¼æ±‚å¯¼æ³•åˆ™ï¼ŒæŸéƒ¨åˆ†æ¢¯åº¦å°äº1ï¼Œåˆ™å¤šå±‚è¿ä¹˜åå‡ºç°æ¢¯åº¦æ¶ˆå¤±</p>
<p>ï¼ˆ2ï¼‰é‡‡ç”¨äº†ä¸åˆé€‚çš„æ¿€æ´»å‡½æ•°</p>
<p>å¦‚sigmoidå‡½æ•°çš„æœ€å¤§æ¢¯åº¦ä¸º1/4ï¼Œè¿™æ„å‘³ç€éšè—å±‚æ¯ä¸€å±‚çš„æ¢¯åº¦å‡å°äº1ï¼ˆæƒå€¼å°äº1æ—¶ï¼‰ï¼Œå‡ºç°æ¢¯åº¦æ¶ˆå¤±ã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼š1ã€reluæ¿€æ´»å‡½æ•°ï¼Œä½¿å¯¼æ•°è¡¡ä¸º1 2ã€batch norm 3ã€æ®‹å·®ç»“æ„</p>
<p><strong>æ¢¯åº¦çˆ†ç‚¸çš„åŸå› å’Œè§£å†³åŠæ³•</strong></p>
<p>ï¼ˆ1ï¼‰éšè—å±‚çš„å±‚æ•°è¿‡å¤šï¼ŒæŸéƒ¨åˆ†æ¢¯åº¦å¤§äº1ï¼Œåˆ™å¤šå±‚è¿ä¹˜åï¼Œæ¢¯åº¦å‘ˆæŒ‡æ•°å¢é•¿ï¼Œäº§ç”Ÿæ¢¯åº¦çˆ†ç‚¸ã€‚</p>
<p>ï¼ˆ2ï¼‰æƒé‡åˆå§‹å€¼å¤ªå¤§ï¼Œæ±‚å¯¼æ—¶ä¼šä¹˜ä¸Šæƒé‡</p>
<p>è§£å†³æ–¹æ³•ï¼š1ã€æ¢¯åº¦è£å‰ª 2ã€æƒé‡L1/L2æ­£åˆ™åŒ– 3ã€æ®‹å·®ç»“æ„ 4ã€batch norm</p>
<h3 id="15yolov1-yolov4æ”¹è¿›">15ã€â­YOLOV1-YOLOV4æ”¹è¿›</h3>
<p>â­<strong>YOLOV1</strong>:</p>
<ul>
<li>one-stageå¼€å±±ä¹‹ä½œï¼Œå°†å›¾åƒåˆ†æˆS*Sçš„å•å…ƒæ ¼ï¼Œæ ¹æ®ç‰©ä½“ä¸­å¿ƒæ˜¯å¦è½å…¥æŸä¸ªå•å…ƒæ ¼æ¥å†³å®šå“ªä¸ªå•å…ƒæ ¼æ¥è´Ÿè´£é¢„æµ‹è¯¥ç‰©ä½“ï¼Œæ¯ä¸ªå•å…ƒæ ¼é¢„æµ‹ä¸¤ä¸ªæ¡†çš„åæ ‡ã€å­˜åœ¨ç‰©ä½“çš„æ¦‚ç‡ï¼ˆå’Œgtçš„IoUï¼‰ã€å„ç±»åˆ«æ¡ä»¶æ¦‚ç‡ã€‚</li>
<li>æŸå¤±å‡½æ•°ï¼šå‡é‡‡ç”¨å‡æ–¹è¯¯å·®ã€‚</li>
<li>ä¼˜ç‚¹ï¼šé€Ÿåº¦å¿«ã€‚</li>
<li>ç¼ºç‚¹ï¼š1ã€æ¯ä¸ªå•å…ƒæ ¼é¢„æµ‹ä¸¤ä¸ªæ¡†ï¼Œå¹¶ä¸”åªå–å’Œgt IoUæœ€å¤§çš„æ¡†ï¼Œç›¸å½“äºæ¯ä¸ªå•å…ƒæ ¼åªèƒ½é¢„æµ‹ä¸€ä¸ªç‰©ä½“ï¼Œ<strong>æ— æ³•å¤„ç†å¯†é›†ç‰©ä½“åœºæ™¯</strong>ã€‚2ã€è¾“å‡ºå±‚ä¸º<strong>å…¨è¿æ¥å±‚</strong>ï¼Œåªèƒ½è¾“å…¥å›ºå®šåˆ†è¾¨ç‡å›¾ç‰‡ 3ã€<strong>è®¡ç®—IoUæŸå¤±æ—¶ï¼Œå°†å¤§å°ç‰©ä½“åŒç­‰å¯¹å¾…</strong>ï¼Œä½†åŒæ ·çš„å°è¯¯å·®ï¼Œå¯¹å¤§ç‰©ä½“æ¥è¯´æ˜¯å¾®ä¸è¶³é“çš„ï¼Œè€Œå¯¹å°ç‰©ä½“æ¥è¯´æ˜¯å¾ˆä¸¥é‡çš„ï¼Œè¿™ä¼šå¯¼è‡´å®šä½ä¸å‡†çš„é—®é¢˜ã€‚4ã€æ²¡æœ‰å¯†é›†é”šæ¡†ã€æ²¡æœ‰RPNï¼Œå¯¼è‡´å¬å›ç‡ä½</li>
</ul>
<p><strong>â­YOLOV2:</strong></p>
<ul>
<li>æ”¹è¿›ç‚¹ï¼š</li>
</ul>
<p>(1)ã€<strong>Batch normalization</strong>æ›¿ä»£dropoutï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</p>
<p>(2)ã€<strong>å»æ‰å…¨è¿æ¥å±‚ï¼Œä½¿ç”¨ç±»ä¼¼RPNçš„å…¨å·ç§¯å±‚</strong></p>
<p>(3)ã€<strong>å¼•å…¥Anchor</strong>ï¼Œå¹¶ä½¿ç”¨k-meansèšç±»ç¡®å®šanchorå¤§å°ã€æ¯”ä¾‹ï¼Œæé«˜äº†recall</p>
<p>(4)ã€é«˜åˆ†è¾¨ç‡é¢„è®­ç»ƒbackbone</p>
<p>(5)ã€<strong>é™å®šé¢„æµ‹æ¡†çš„ä¸­å¿ƒç‚¹åªèƒ½åœ¨cellå†…ï¼Œå…·ä½“é€šè¿‡é¢„æµ‹ç›¸å¯¹äºcellå·¦ä¸Šè§’ç‚¹çš„åç§»å®ç°</strong>ï¼Œè¿™æ ·ç½‘ç»œæ”¶æ•›æ›´ç¨³å®š</p>
<p>(6)ã€æ·»åŠ passthroughå±‚ï¼Œç›¸å½“äºå¤šå°ºåº¦ç‰¹å¾èåˆï¼Œ$1 \ast 1$å·ç§¯å°†$26 \ast 26 \ast 512$ feature mapé™ç»´æˆ$26 \ast 26 \ast 64$, ç„¶åå°†ç‰¹å¾é‡ç»„ï¼Œæ‹†åˆ†ä¸º4ä»½$13 \ast 13 \ast 64$ï¼Œconcateå¾—åˆ°$13 \ast 13 \ast 256$ feature mapï¼Œå’Œä½åˆ†è¾¨ç‡çš„$13  \ast 13 \ast 1024$ feature mapè¿›è¡Œconcate</p>
<p>(7)ã€æå‡ºDarknetè¿›è¡Œç‰¹å¾æå–ï¼Œå‚æ•°æ›´å°‘ï¼Œé€Ÿåº¦æ›´å¿«</p>
<p>(8)ã€æå‡º<strong>YOLO9000</strong>ï¼Œå»ºç«‹å±‚çº§åˆ†ç±»çš„World Treeç»“æ„ï¼Œå¯ä»¥è¿›è¡Œç»†ç²’åº¦åˆ†ç±»</p>
<p><strong>â­YOLOV3:</strong></p>
<p>(1)ã€<strong>ä½¿ç”¨sigmoidåˆ†ç±»å™¨æ›¿ä»£softmaxåˆ†ç±»å™¨</strong>ï¼Œå¯ä»¥å¤„ç†å¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜</p>
<p>(2)ã€<strong>å¼•å…¥æ®‹å·®ç»“æ„ï¼Œè¿›ä¸€æ­¥åŠ æ·±ç½‘ç»œæ·±åº¦</strong></p>
<p>(3)ã€<strong>å¤šå°ºåº¦é¢„æµ‹</strong>ï¼Œæ¯ä¸ªå°ºåº¦é¢„æµ‹3ä¸ªbbox</p>
<p><strong>â­YOLOV4:</strong></p>
<p>(1)ã€<strong>Mosaic data augmentation</strong>ï¼šå››å¼ å›¾ç‰‡æ‹¼æ¥æˆä¸€å¼ å›¾ç‰‡</p>
<p>(2)ã€<strong>DropBlock</strong>ï¼šdrop outåªä¸¢å¼ƒå•ä¸ªåƒç´ ï¼Œè€Œå› ä¸ºäºŒç»´å›¾åƒä¸­ç›¸é‚»ç‰¹å¾å¼ºç›¸å…³ï¼Œæ‰€ä»¥ä¸¢å¼ƒåç½‘ç»œä¾ç„¶å¯ä»¥æ¨æ–­å‡ºä¸¢å¤±åŒºåŸŸä¿¡æ¯ï¼Œå¯¼è‡´è¿‡æ‹Ÿåˆï¼›æ‰€ä»¥dropblocké€‰æ‹©ä¸¢å¼ƒä¸€å—è¿ç»­åŒºåŸŸã€‚</p>
<p>(3)ã€label smoothing</p>
<center>

</center>
<p>(4)ã€CIoU loss
CIoU = IoU + bboxä¸­å¿ƒè·ç¦»/å¯¹è§’çº¿è·ç¦»+é•¿å®½æ¯”ä¾‹ä¹‹å·®</p>
<center>

</center>
<center>

</center>
<p>-1&lt;=CIoU&lt;=1</p>
<p>(5)ã€YOLO with SPPï¼šå°±æ˜¯ç”¨ä¸åŒå¤§å°çš„å·ç§¯æ ¸å¯¹ç‰¹å¾å›¾è¿›è¡Œå·ç§¯ï¼Œå¾—åˆ°ä¸åŒæ„Ÿå—é‡çš„ç‰¹å¾ï¼Œç„¶åconcateåˆ°ä¸€èµ·ã€‚</p>
<h3 id="16apè®¡ç®—">16ã€â­APè®¡ç®—</h3>
<p>â­APæ˜¯å¯¹æ¯ä¸€ç±»å…ˆè®¡ç®—APï¼Œå†å°†æ‰€æœ‰ç±»å¹³å‡å¾—åˆ°æœ€ç»ˆAPã€‚
ä»¥COCOä¸­APè®¡ç®—ä¸ºä¾‹ã€‚å…ˆé€‰å®šç”¨æ¥åˆ¤æ–­TPå’ŒFPçš„IoUé˜ˆå€¼ï¼Œå¦‚0.5ï¼Œåˆ™ä»£è¡¨è®¡ç®—çš„æ˜¯AP0.5ï¼Œç„¶åå¯¹æ¯ç±»åšè®¡ç®—ï¼Œä¾‹å¦‚å¯¹äºclass1:</p>
<div class="center">
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:300px"></th>
<th style="text-align:left">class1 <div style="width:300px"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">box1</td>
<td style="text-align:left">score1</td>
</tr>
<tr>
<td style="text-align:left">box2</td>
<td style="text-align:left">score2</td>
</tr>
<tr>
<td style="text-align:left">box3</td>
<td style="text-align:left">score3</td>
</tr>
</tbody>
</table>
</div>
<p>è‹¥box1ä¸æŸgtçš„IoUå¤§äºæŒ‡å®šé˜ˆå€¼ï¼ˆå¦‚0.5)ï¼Œè®°ä¸ºPositiveï¼›è‹¥æœ‰å¤šä¸ªbboxä¸gtçš„IoUå¤§äºæŒ‡å®šé˜ˆå€¼ï¼Œé€‰æ‹©å…¶ä¸­scoreæœ€å¤§çš„è®°ä¸ºPositiveï¼Œå…¶å®ƒè®°ä¸ºNegativeã€‚å¯ç†è§£ä¸ºç¡®å®šbox1å¯¹åº”çš„labelã€‚box2ã€box3åŒç†ã€‚</p>
<p>è€Œåè¦å¾—åˆ°PRæ›²çº¿ï¼Œéœ€è¦å…ˆå¯¹box1,2,3æŒ‰scoreä»é«˜åˆ°ä½æ’åºï¼Œå‡è®¾æ’åºç»“æœå¦‚ä¸‹ï¼š</p>
<div class="center">
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:200px"></th>
<th style="text-align:left">True class <div style="width:200px"></th>
<th style="text-align:left">class1 <div style="width:200px"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">box2</td>
<td style="text-align:left">Positive</td>
<td style="text-align:left">score2</td>
</tr>
<tr>
<td style="text-align:left">box1</td>
<td style="text-align:left">Negative</td>
<td style="text-align:left">score1</td>
</tr>
<tr>
<td style="text-align:left">box3</td>
<td style="text-align:left">Positive</td>
<td style="text-align:left">score3</td>
</tr>
</tbody>
</table>
</div>
<p>ç„¶åé€è¡Œè®¡ç®—scoreé˜ˆå€¼ä¸ºscore2ã€score1ã€score3çš„Precisionå’ŒRecallï¼Œscoreå¤§äºé˜ˆå€¼çš„boxæ‰ç®—åšæ¨¡å‹é¢„æµ‹çš„Positiveï¼ˆTP+FP)ã€‚å‡è®¾å…±æœ‰ä¸‰ä¸ªgt boxï¼Œåˆ™è®¡ç®—ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="center">
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:60px"></th>
<th style="text-align:left">True class <div style="width:110px"></th>
<th style="text-align:left">class1 <div style="width:110px"></th>
<th style="text-align:left">Precision=TP/(TP+FP)</th>
<th style="text-align:left">Recall <div style="width:110px"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">box2</td>
<td style="text-align:left">Positive</td>
<td style="text-align:left">score2</td>
<td style="text-align:left">1/1</td>
<td style="text-align:left">1/3</td>
</tr>
<tr>
<td style="text-align:left">box1</td>
<td style="text-align:left">Negative</td>
<td style="text-align:left">score1</td>
<td style="text-align:left">1/2</td>
<td style="text-align:left">1/3</td>
</tr>
<tr>
<td style="text-align:left">box3</td>
<td style="text-align:left">Positive</td>
<td style="text-align:left">score3</td>
<td style="text-align:left">2/3</td>
<td style="text-align:left">2/3</td>
</tr>
</tbody>
</table>
</div>
<p>è¿™æ ·å¾—åˆ°ä¸€ä¸ªä¸ªPRæ›²çº¿ä¸Šçš„ç‚¹ï¼Œç„¶ååˆ©ç”¨æ’å€¼æ³•è®¡ç®—PRæ›²çº¿çš„é¢ç§¯ï¼Œå¾—åˆ°class1çš„APã€‚
å…·ä½“æ’å€¼æ–¹æ³•ï¼šCOCOä¸­æ˜¯å‡åŒ€å–101ä¸ªrecallå€¼å³0,0.01,0.02,&hellip;,1ï¼Œå¯¹äºæ¯ä¸ªrecallå€¼rï¼Œprecisionå€¼å–æ‰€æœ‰recall&gt;=rä¸­çš„æœ€å¤§å€¼$p_{interp(r)}$ã€‚</p>
<center>

</center>
<center>

</center>
<center>

</center>
<p>ç„¶åæ¯ä¸ªrecallå€¼åŒºé—´ï¼ˆ0-0.01ï¼Œ0.01-0.02ï¼Œ&hellip;ï¼‰éƒ½å¯¹åº”ä¸€ä¸ªçŸ©å½¢ï¼Œå°†æ‰€æœ‰çŸ©å½¢é¢ç§¯åŠ èµ·æ¥å³ä¸ºPRæ›²çº¿é¢ç§¯ï¼Œå¾—åˆ°ä¸€ä¸ªç±»åˆ«çš„APï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¯¹æ‰€æœ‰ç±»åˆ«ï¼ˆå¦‚COCOä¸­80ç±»ï¼‰ã€æ‰€æœ‰IoUé˜ˆå€¼ï¼ˆä¾‹å¦‚0.5:0.95ï¼‰çš„APå–å‡å€¼å³å¾—åˆ°æœ€ç»ˆAPã€‚</p>
<center>

</center>
<p><strong>ARè®¡ç®—</strong>
è®¡ç®—è¿‡ç¨‹åŒAPï¼Œä¹Ÿæ˜¯åœ¨æ‰€æœ‰IoUé˜ˆå€¼å’Œç±»åˆ«ä¸Šå¹³å‡ã€‚
æ¯ç»™å®šä¸€ä¸ªIoUé˜ˆå€¼å’Œç±»åˆ«ï¼Œå¾—åˆ°ä¸€ä¸ªP_Ræ›²çº¿ï¼Œå½“Pä¸ä¸º0æ—¶æœ€å¤§çš„Recallä½œä¸ºå½“å‰Recallã€‚</p>
<h3 id="17iouå˜ç§åˆé›†">17ã€â­IoUå˜ç§åˆé›†</h3>
<p><strong>IoU</strong></p>
<center>

</center>
<p><strong>GIoU</strong></p>
<center>

</center>
<p>$Ac$ä¸ºbbox Aå’Œbbox Bçš„æœ€å°å‡¸é›†é¢ç§¯ï¼ŒUä¸ºA U Bçš„é¢ç§¯ï¼Œå³ç¬¬äºŒé¡¹ä¸ºä¸å±äºAå’ŒBçš„åŒºåŸŸå æœ€å°é—­åŒ…çš„æ¯”ä¾‹ã€‚
-1&lt;=GIoU&lt;=1ï¼Œå½“Aå’ŒBä¸é‡åˆï¼Œä»å¯ä»¥è®¡ç®—æŸå¤±ï¼Œå› æ­¤å¯ä½œä¸ºæŸå¤±å‡½æ•°ã€‚</p>
<center>

</center>
<p>âœ’ï¸ä¼˜ç‚¹ï¼šåœ¨ä¸é‡å çš„æƒ…å†µä¸‹ï¼Œèƒ½è®©é¢„æµ‹æ¡†å‘gtæ¡†æ¥è¿‘ã€‚</p>
<p>âœ’ï¸ç¼ºç‚¹ï¼šé‡åˆ°Aæ¡†è¢«Bæ¡†åŒ…å«çš„æƒ…å†µä¸‹ï¼ŒGIoUç›¸åŒã€‚</p>
<center>

</center>
<p><strong>DIoU</strong></p>
<center>

</center>
<p>å…¶ä¸­ï¼Œ $b$å’Œ$b^{gt}$åˆ†åˆ«ä»£è¡¨äº†é¢„æµ‹æ¡†å’ŒçœŸå®æ¡†çš„ä¸­å¿ƒç‚¹ï¼Œä¸”$Ï$ä»£è¡¨çš„æ˜¯è®¡ç®—ä¸¤ä¸ªä¸­å¿ƒç‚¹é—´çš„æ¬§å¼è·ç¦»ã€‚$c$ä»£è¡¨çš„æ˜¯èƒ½å¤ŸåŒæ—¶åŒ…å«é¢„æµ‹æ¡†å’ŒçœŸå®æ¡†çš„æœ€å°é—­åŒ…åŒºåŸŸçš„å¯¹è§’çº¿è·ç¦»ã€‚</p>
<center>

</center>
<p>$-1 &lt; DIoU \leq 1$, å°†ç›®æ ‡ä¸anchorä¹‹é—´çš„è·ç¦»ï¼Œé‡å ç‡ä»¥åŠå°ºåº¦éƒ½è€ƒè™‘è¿›å»ï¼Œä½¿å¾—ç›®æ ‡æ¡†å›å½’å˜å¾—æ›´åŠ ç¨³å®š</p>
<p>âœ’ï¸ä¼˜ç‚¹ï¼šç›´æ¥ä¼˜åŒ–è·ç¦»ï¼Œè§£å†³GIoUåŒ…å«æƒ…å†µã€‚</p>
<center>

</center>
<p><strong>CIoU</strong></p>
<p>åœ¨DIoUçš„åŸºç¡€ä¸Šè€ƒè™‘bboxçš„é•¿å®½æ¯”ï¼š</p>
<center>

</center>
<center>

</center>
<p>$-1 \leq CIoU \leq 1$</p>
<p>âœ’ï¸ä¼˜ç‚¹ï¼šè€ƒè™‘bboxé•¿å®½æ¯”</p>
<h3 id="18depth-wise-separable-conv-æ·±åº¦å¯åˆ†ç¦»å·ç§¯">18ã€â­depth-wise separable conv (æ·±åº¦å¯åˆ†ç¦»å·ç§¯)</h3>
<p>ä¾‹å¦‚$5 \ast 5 \ast 3$å›¾ç‰‡è¦ç¼–ç ä¸º$5 \ast 5 \ast 4$ feature mapï¼Œåˆ™depth-wise convåˆ†ä¸ºä¸¤æ­¥ï¼š
å…ˆæ˜¯depth wiseå·ç§¯ï¼Œåˆ©ç”¨3ä¸ª$3 \ast 3$ convå¯¹æ¯ä¸ªé€šé“å•ç‹¬è¿›è¡Œå·ç§¯ï¼Œè¿™ä¸€æ­¥åªèƒ½æ”¹å˜feature mapé•¿å®½ï¼Œä¸èƒ½æ”¹å˜é€šé“æ•°ï¼š</p>
<center>

</center>
<p>å‚æ•°é‡ï¼š</p>
<center>

</center>
<p>è®¡ç®—é‡ï¼š</p>
<center>

</center>
<p>ç„¶åæ˜¯point wiseå·ç§¯ï¼Œåˆ©ç”¨4ä¸ª$1 \ast 1 \ast 3$ convå¯¹depth wiseç”Ÿæˆçš„feature mapè¿›è¡Œå·ç§¯ï¼Œè¿™ä¸€æ­¥åªèƒ½æ”¹å˜é€šé“æ•°ï¼Œä¸èƒ½æ”¹å˜feature mapé•¿å®½ï¼š</p>
<center>

</center>
<p>å‚æ•°é‡ï¼š</p>
<center>

</center>
<p>è®¡ç®—é‡ï¼š</p>
<center>

</center>
<p>æ‰€ä»¥ä¸ä¸€èˆ¬å·ç§¯å¯¹æ¯”ï¼Œæ€»å‚æ•°é‡å’Œè®¡ç®—é‡ï¼š</p>
<ul>
<li>æ€»å‚æ•°é‡ï¼šå¸¸è§„å·ç§¯&ndash;&gt;</li>
</ul>
<center>

</center>
<p>ï¼Œ æ·±åº¦å¯åˆ†ç¦»å·ç§¯&ndash;&gt;</p>
<center>

</center>
<ul>
<li>æ€»è®¡ç®—é‡ï¼šå¸¸è§„å·ç§¯&ndash;&gt;</li>
</ul>
<center>

</center>
<p>, æ·±åº¦å¯åˆ†ç¦»å·ç§¯&ndash;&gt;</p>
<center>

</center>
<h3 id="19æ£€æµ‹æ¨¡å‹é‡Œä¸ºå•¥ç”¨smoothl1å»å›å½’bbox">19ã€â­æ£€æµ‹æ¨¡å‹é‡Œä¸ºå•¥ç”¨smoothL1å»å›å½’bbox</h3>
<p>é¦–å…ˆï¼Œå¯¹äºL2 lossï¼Œå…¶å¯¼æ•°åŒ…å«äº†(f(x)-Y)ï¼Œæ‰€ä»¥å½“é¢„æµ‹å€¼ä¸gtå·®å¼‚è¿‡å¤§æ—¶ï¼Œå®¹æ˜“æ¢¯åº¦çˆ†ç‚¸ï¼›
è€Œå¯¹äºL1 lossï¼Œå³ä½¿è®­ç»ƒåæœŸé¢„æµ‹å€¼å’Œgtå·®å¼‚è¾ƒå°ï¼Œæ¢¯åº¦ä¾ç„¶ä¸ºå¸¸æ•°ï¼ŒæŸå¤±å‡½æ•°å°†åœ¨ç¨³å®šå€¼é™„è¿‘æ³¢åŠ¨ï¼Œéš¾ä»¥æ”¶æ•›åˆ°æ›´é«˜ç²¾åº¦ã€‚</p>
<center>

</center>
<p>æ‰€ä»¥SmoothL1 lossç»“åˆäº†ä¸¤è€…çš„ä¼˜åŠ¿ï¼Œå½“é¢„æµ‹å€¼å’Œgtå·®å¼‚è¾ƒå¤§æ—¶ä½¿ç”¨L1 lossï¼›å·®å¼‚è¾ƒå°æ—¶ä½¿ç”¨L2 lossï¼š</p>
<center>

</center>
<h3 id="20deformable-convå¦‚ä½•å®ç°æ¢¯åº¦å¯å¾®">20ã€â­Deformable convå¦‚ä½•å®ç°æ¢¯åº¦å¯å¾®ï¼Ÿ</h3>
<p>æŒ‡çš„æ˜¯å¯¹offsetå¯å¾®ï¼Œå› ä¸ºoffsetåå·ç§¯æ ¸æ‰€åœ¨ä½ç½®å¯èƒ½æ˜¯å°æ•°ï¼Œå³ä¸åœ¨feature mapæ•´æ•°ç‚¹ä¸Šï¼Œæ‰€ä»¥æ— æ³•æ±‚å¯¼ï¼›Deformable convé€šè¿‡åŒçº¿æ€§æ’å€¼å®ç°äº†offsetæ¢¯åº¦å¯å¾®ã€‚
ç”¨å¦‚ä¸‹è¡¨è¾¾å¼è¡¨è¾¾å¸¸è§„CNN:</p>
<center>

</center>
<center>

</center>
<p>åˆ™Deformable convå¯è¡¨è¾¾ä¸ºï¼š</p>
<center>

</center>
<p>$x(p_0+p_n+\Delta p_n)$å¯èƒ½ä¸æ˜¯æ•´æ•°ï¼Œéœ€è¦è¿›è¡Œæ’å€¼ï¼Œä»»æ„ç‚¹pï¼ˆå‘¨å›´å››ä¸ªæ•´æ•°ç‚¹ä¸ºqï¼‰çš„åŒçº¿æ€§æ’å€¼å¯è¡¨è¾¾ä¸ºä¸‹å¼ï¼š</p>
<center>

</center>
<center>

</center>
<p>å…¶ä¸­$g(a, b) = max(0, 1 âˆ’ |a âˆ’ b|)$ã€‚</p>
<p>åˆ™offest delta_pnæ±‚å¯¼å…¬å¼ä¸ºï¼š</p>
<center>

</center>
<p>ä»è€Œå®ç°å¯¹offsetçš„æ¢¯åº¦å¯å¾®ã€‚</p>
<h3 id="21swin-transformer">21ã€â­Swin Transformer</h3>
<p>(1)â­<strong>motivation</strong>
é«˜åˆ†è¾¨ç‡å›¾åƒä½œä¸ºåºåˆ—è¾“å…¥è®¡ç®—é‡è¿‡å¤§é—®é¢˜ï¼›å’Œnlpä¸åŒï¼Œcvé‡Œæ¯ä¸ªç‰©ä½“çš„å°ºåº¦ä¸åŒï¼Œè€Œnlpé‡Œæ¯ä¸ªç‰©ä½“çš„å•è¯é•¿åº¦éƒ½å·®ä¸å¤šã€‚</p>
<p>(2)â­<strong>idea</strong>
é—®é¢˜ä¸€ï¼šä¸€å¼ å›¾åˆ†æˆå¤šä¸ªçª—å£ï¼Œæ¯ä¸ªçª—å£åˆ†æˆå¤šä¸ªpatchï¼Œæ¯ä¸ªçª—å£å†…çš„å¤šä¸ªpatchç›¸äº’è®¡ç®—è‡ªæ³¨æ„åŠ›ï¼›é—®é¢˜äºŒï¼šæ¨¡ä»¿CNN poolingæ“ä½œï¼Œå°†æµ…å±‚å°ºåº¦patchè¿›è¡Œpath mergingå¾—åˆ°ä¸€ä¸ªå°çš„patchï¼Œå®ç°é™é‡‡æ ·ï¼Œä»è€Œå¾—åˆ°å¤šå°ºåº¦ç‰¹å¾ã€‚</p>
<p>(3)â­<strong>method</strong>
æ•´ä½“ç»“æ„å¾ˆåƒCNNï¼Œå·ç§¯è¢«çª—å£è‡ªæ³¨æ„åŠ›ä»£æ›¿ï¼Œpoolingè¢«patch mergingä»£æ›¿ã€‚</p>
<center>

</center>
<ul>
<li>âœ’ï¸method 1: shifted window</li>
</ul>
<center>

</center>
<p>ç›®çš„æ˜¯è®©ä¸é‡å çª—å£åŒºåŸŸä¹Ÿèƒ½æœ‰äº¤äº’ï¼Œæ“ä½œæœ¬è´¨æ˜¯å°†æ‰€æœ‰çª—å£å¾€å³ä¸‹è§’ç§»åŠ¨2ä¸ªpatchã€‚</p>
<p>çª—å£æ•°ä»4ä¸ªå˜æˆäº†9ä¸ªï¼Œè®¡ç®—é‡å¢å¤§ï¼Œä¸ºå‡å°è®¡ç®—é‡ï¼Œä½¿ç”¨cyclic shiftï¼Œå°†çª—å£æ‹¼æ¥æˆ4ä¸ªçª—å£ï¼Œå¦å¤–å› ä¸ºæ‹¼æ¥åAã€Bã€Cç›¸è¾ƒäºåŸå›¾å‘ç”Ÿäº†ç›¸å¯¹ä½ç½®å˜åŒ–ï¼Œæ‰€ä»¥Aã€Bã€Cå’Œå…¶ä»–åŒºåŸŸæ˜¯ä¸å¯ä»¥è¿›è¡Œäº¤äº’çš„ï¼Œå› æ­¤å¼•å…¥äº†Maskæ“ä½œã€‚</p>
<center>

</center>
<p>Maskæ“ä½œï¼š</p>
<p>ä»¥3ã€6æ‰€åœ¨çª—å£çš„è‡ªæ³¨æ„åŠ›è®¡ç®—ä¸ºä¾‹ï¼Œå°†7*7=49ä¸ªåƒç´ å±•å¹³å¾—åˆ°é•¿åº¦ä¸º49çš„ä¸€ç»´å‘é‡ï¼ŒåšçŸ©é˜µä¹˜æ³•å³Q*Kã€‚</p>
<center>

</center>
<p>åˆå› ä¸º3å’Œ6æ˜¯ä¸å¯ä»¥äº¤äº’çš„ï¼Œæ‰€ä»¥çŸ©é˜µå·¦ä¸‹è§’å’Œå³ä¸Šè§’åº”è¯¥è¢«maskæ‰ï¼ŒSwiné‡‡ç”¨çš„æ–¹æ³•æ˜¯åŠ ä¸Šå·¦ä¸‹è§’å’Œå³ä¸Šè§’ä¸º-100ï¼Œå…¶ä½™ä½ç½®ä¸º0çš„æ¨¡æ¿ï¼Œè¿™æ ·å¾—åˆ°çš„attentionçŸ©é˜µåœ¨softmaxåå°±å˜æˆ0äº†ã€‚</p>
<center>

</center>
<ul>
<li>âœ’ï¸method2: patch merging
å°±æ˜¯é—´éš”é‡‡æ ·ï¼Œç„¶ååœ¨é€šé“ç»´åº¦ä¸Šæ‹¼æ¥</li>
</ul>
<center>

</center>
<p>(4)â­<strong>SwinTransformerä½ç½®ç¼–ç å®ç°</strong></p>
<p><strong>ğŸ‘‰æ ¸å¿ƒæ€æƒ³å°±æ˜¯å»ºäº†ä¸€ä¸ªç›¸å¯¹ä½ç½®ç¼–ç embeddingå­—å…¸ï¼Œä½¿å¾—ç›¸åŒçš„ç›¸å¯¹ä½ç½®ç¼–ç æˆç›¸åŒçš„embeddingã€‚ğŸ‘ˆ</strong></p>
<p>ä¾‹å¦‚2*2çš„patchä¹‹é—´çš„ç›¸å¯¹ä½ç½®å…³ç³»çŸ©é˜µä¸º2*2*2ï¼Œç›¸å¯¹ä½ç½®èŒƒå›´ä¸º[-1,1]ï¼š</p>
<center>

</center>
<p>åˆ™xï¼Œyç›¸å¯¹ä½ç½®å…³ç³»å¯ç”¨3*3 (-1,0,1ä¸‰ç§ç›¸å¯¹ä½ç½®)çš„tableå­˜å‚¨æ‰€æœ‰å¯èƒ½çš„ç›¸å¯¹ä½ç½®å…³ç³»ï¼Œå¹¶ç”¨3*3*embed_nè¡¨ç¤ºæ‰€æœ‰ç›¸å¯¹ä½ç½®å¯¹åº”çš„embeddingã€‚<strong>ä¸ºäº†ä½¿å¾—ç´¢å¼•ä¸ºæ•´æ•°</strong>ï¼Œéœ€è¦å°†æ‰€æœ‰ç›¸å¯¹ä½ç½®å˜ä¸ºæ­£å€¼ï¼š</p>
<center>

</center>
<p>å¯ä»¥é€šè¿‡ç®€å•çš„x,yç›¸å¯¹ä½ç½®ç›¸åŠ å°†ç›¸å¯¹ä½ç½®æ˜ å°„ä¸ºä¸€ç»´ï¼Œä½†æ˜¯ä¼šå‡ºç°(0,2)å’Œ(2,0)æ— æ³•åŒºåˆ†çš„é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦ä½¿å¾—x,yç›¸å¯¹ä½ç½®ç¼–ç ä¸åŒï¼š</p>
<center>

</center>
<p>ç„¶åå°†xå’Œyç›¸å¯¹ä½ç½®ç›¸åŠ ï¼š</p>
<center>

</center>
<p>ä»è€Œæ¯ä¸ªç›¸å¯¹ä½ç½®å¯¹åº”ä¸€ä¸ªä¸€ç»´çš„å€¼ï¼Œä½œä¸ºç›¸å¯¹ä½ç½®embedding tableçš„ç´¢å¼•ï¼Œè·å–å¯¹åº”ä½ç½®çš„embeddingã€‚</p>
<h3 id="22yoloxæ ¸å¿ƒæ”¹è¿›">22ã€â­YOLOXæ ¸å¿ƒæ”¹è¿›ï¼š</h3>
<center>

</center>
<p>(1)âœ’ï¸Decoupled headï¼šå°±æ˜¯anchor freeæ–¹æ³•é‡Œæœ€å¸¸ç”¨çš„cls headå’Œreg head</p>
<p>(2)âœ’ï¸Anchor-free: å³ç±»ä¼¼FCOSï¼Œä¸åŒçš„æ˜¯é¢„æµ‹çš„æ˜¯ä¸­å¿ƒç‚¹ç›¸å¯¹äºgridå·¦ä¸Šè§’åæ ‡çš„offsetå€¼ï¼Œä»¥åŠbboxçš„é•¿å®½ï¼Œå°†ç‰©ä½“ä¸­å¿ƒçš„æŸä¸ªåŒºåŸŸå†…çš„ç‚¹å®šä¹‰ä¸ºæ­£æ ·æœ¬ï¼Œå¹¶ä¸”æ¯ä¸ªå°ºåº¦é¢„æµ‹ä¸åŒå¤§å°ç‰©ä½“ã€‚</p>
<p>(3)âœ’ï¸Label assignment(SimOTA): å°†predictionå’Œgtçš„åŒ¹é…è¿‡ç¨‹å»ºæ¨¡ä¸ºè¿è¾“é—®é¢˜ï¼Œä½¿å¾—costæœ€å°ã€‚</p>
<ul>
<li>costè¡¨ç¤ºï¼š$pred_i$å’Œ$gt_j$çš„clså’Œreg lossã€‚</li>
<li>å¯¹æ¯ä¸ªgtï¼Œé€‰æ‹©è½åœ¨æŒ‡å®šä¸­å¿ƒåŒºåŸŸçš„top-k least cost predictionså½“ä½œæ­£æ ·æœ¬ï¼Œæ¯ä¸ªgtçš„kå€¼ä¸åŒã€‚</li>
<li>æœ€ä½³æ­£é”šç‚¹æ•°é‡ä¼°è®¡ï¼šæŸä¸ªgtçš„é€‚å½“æ­£é”šç‚¹æ•°é‡åº”è¯¥ä¸è¯¥gtå›å½’è‰¯å¥½çš„é”šç‚¹æ•°é‡æ­£ç›¸å…³ï¼Œæ‰€ä»¥å¯¹äºæ¯ä¸ªgtï¼Œæˆ‘ä»¬æ ¹æ®IoUå€¼é€‰æ‹©å‰qä¸ªé¢„æµ‹ã€‚è¿™äº›IoUå€¼ç›¸åŠ ä»¥è¡¨ç¤ºæ­¤gtçš„æ­£é”šç‚¹ä¼°è®¡æ•°é‡ã€‚</li>
</ul>
<h3 id="23l1l2æ­£åˆ™åŒ–çš„åŒºåˆ«">23ã€â­L1ã€L2æ­£åˆ™åŒ–çš„åŒºåˆ«</h3>
<center>

</center>
<p>âœ’ï¸L1æ­£åˆ™åŒ–å®¹æ˜“å¾—åˆ°ç¨€ç–è§£ï¼Œå³ç¨€ç–æƒå€¼çŸ©é˜µï¼ŒL2æ­£åˆ™åŒ–å®¹æ˜“å¾—åˆ°å¹³æ»‘è§£ï¼ˆæƒå€¼å¾ˆå°ï¼‰ã€‚</p>
<p>âœ’ï¸åŸå› ï¼šaã€è§£ç©ºé—´è§’åº¦ï¼šäºŒç»´æƒ…å†µï¼ŒL1æ­£åˆ™åŒ–ï¼š||w1||+||w2||ï¼Œåˆ™å‡½æ•°å›¾åƒä¸ºå›¾ä¸­æ–¹æ¡†ï¼Œæ˜¾ç„¶æ–¹æ¡†çš„è§’ç‚¹å®¹æ˜“æ˜¯æœ€ä¼˜è§£ï¼Œè€Œè¿™äº›æœ€ä¼˜è§£éƒ½åœ¨åæ ‡è½´ä¸Šï¼Œæƒå€¼ä¸º0.</p>
<center>

</center>
<p>bã€æ¢¯åº¦ä¸‹é™è§’åº¦
æ·»åŠ æ­£åˆ™é¡¹ $\lambda \theta^2_j$ï¼Œåˆ™Lå¯¹$\theta_j$çš„å¯¼æ•°ä¸º$2\lambda \theta_j$ï¼Œæ¢¯åº¦æ›´æ–°æ—¶$\theta_j=\theta_j-2 \lambda \theta_j=(1-2 \lambda) \theta_j$ï¼Œç›¸å½“äºæ¯æ¬¡éƒ½ä¼šä¹˜ä»¥ä¸€ä¸ªå°äº1çš„æ•°ï¼Œä½¿å¾—$\theta_j$è¶Šæ¥è¶Šå°ã€‚</p>
<h3 id="24æ·±åº¦å­¦ä¹ èŠ±å¼å½’ä¸€åŒ–ä¹‹batchlayerinstancegroup-normalization">24ã€â­æ·±åº¦å­¦ä¹ èŠ±å¼å½’ä¸€åŒ–ä¹‹Batch/Layer/Instance/Group Normalization</h3>
<p><strong>âœ’ï¸Batch Normalization</strong></p>
<ul>
<li>â­<strong>æ ¸å¿ƒè¿‡ç¨‹</strong>ï¼šé¡¾åæ€ä¹‰ï¼Œå¯¹ä¸€ä¸ªbatchå†…çš„æ•°æ®è®¡ç®—å‡å€¼å’Œæ–¹å·®ï¼Œå°†æ•°æ®å½’ä¸€åŒ–ä¸ºå‡å€¼ä¸º0ã€æ–¹å·®ä¸º1çš„æ­£æ€åˆ†å¸ƒæ•°æ®ï¼Œæœ€åç”¨å¯¹æ•°æ®è¿›è¡Œç¼©æ”¾å’Œåç§»æ¥è¿˜åŸæ•°æ®æœ¬èº«çš„åˆ†å¸ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</li>
</ul>
<center>

</center>
<ul>
<li><strong>Batch Norm 1d</strong>
è¾“å…¥æ˜¯b*c, è¾“å‡ºæ˜¯b*cï¼Œå³åœ¨æ¯ä¸ªç»´åº¦ä¸Šè¿›è¡Œnormalizationã€‚</li>
<li><strong>Batch Norm 2d</strong>
ä¾‹å¦‚è¾“å…¥æ˜¯b*c*h*wï¼Œåˆ™è®¡ç®—normlizationæ—¶æ˜¯å¯¹æ¯ä¸ªé€šé“ï¼Œæ±‚b<em>h</em>wå†…çš„åƒç´ æ±‚å‡å€¼å’Œæ–¹å·®ï¼Œè¾“å‡ºæ˜¯1*c*1*1ã€‚</li>
</ul>
<center>

</center>
<center>

</center>
<ul>
<li><strong>BNæµ‹è¯•æ—¶å’Œè®­ç»ƒæ—¶ä¸åŒï¼Œæµ‹è¯•æ—¶ä½¿ç”¨çš„æ˜¯å…¨å±€è®­ç»ƒæ•°æ®çš„æ»‘åŠ¨å¹³å‡çš„å‡å€¼å’Œæ–¹å·®ã€‚</strong></li>
<li>ä½œç”¨ï¼šaã€é˜²æ­¢è¿‡æ‹Ÿåˆ bã€åŠ é€Ÿç½‘ç»œçš„æ”¶æ•›ï¼Œinternal covariate shiftå¯¼è‡´ä¸Šå±‚ç½‘ç»œéœ€è¦ä¸æ–­é€‚åº”åº•å±‚ç½‘ç»œå¸¦æ¥çš„åˆ†å¸ƒå˜åŒ– cã€ç¼“è§£æ¢¯åº¦çˆ†ç‚¸å’Œæ¢¯åº¦æ¶ˆå¤±</li>
<li>å±€é™ï¼šä¾èµ–äºbatch sizeï¼Œé€‚ç”¨äºbatch sizeè¾ƒå¤§çš„æƒ…å†µ</li>
</ul>
<p><strong>âœ’ï¸æ”¹è¿›ï¼š</strong></p>
<ul>
<li>Layer normalization: å¯¹æ¯ä¸ªæ ·æœ¬çš„æ‰€æœ‰ç‰¹å¾è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¦‚N*C*H*Wï¼Œå¯¹æ¯ä¸ªC*H*Wè¿›è¡Œå½’ä¸€åŒ–ï¼Œå¾—åˆ°Nä¸ªå‡å€¼å’Œæ–¹å·®ã€‚</li>
<li>Instance normalization: å¯¹æ¯ä¸ªæ ·æœ¬çš„æ¯ä¸ªé€šé“ç‰¹å¾è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¦‚N*C*H*Wï¼Œå¯¹æ¯ä¸ªH*Wè¿›è¡Œå½’ä¸€åŒ–ï¼Œå¾—åˆ°N*Cä¸ªå‡å€¼å’Œæ–¹å·®ã€‚</li>
<li>Group normalizationï¼šæ¯ä¸ªæ ·æœ¬æŒ‰é€šé“åˆ†ç»„è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¦‚N*C*H*Wï¼Œå¯¹æ¯ä¸ªC*H*Wï¼Œåœ¨Cç»´åº¦ä¸Šåˆ†æˆgç»„ï¼Œåˆ™å…±æœ‰N*gä¸ªå‡å€¼å’Œæ–¹å·®ã€‚</li>
</ul>
<center>

</center>
<h3 id="25æ·±åº¦å­¦ä¹ å¸¸ç”¨ä¼˜åŒ–å™¨ä»‹ç»">25ã€â­æ·±åº¦å­¦ä¹ å¸¸ç”¨ä¼˜åŒ–å™¨ä»‹ç»</h3>
<p>å‚è€ƒhttps://zhuanlan.zhihu.com/p/261695487ï¼Œä¿®æ­£äº†å…¶ä¸­çš„ä¸€äº›é”™è¯¯ã€‚</p>
<p>(1)<strong>â­SGD</strong></p>
<p>a. âœ’ï¸<strong>å…¬å¼</strong></p>
<center>

</center>
<p>å…¶ä¸­$\alpha$æ˜¯å­¦ä¹ ç‡ï¼Œ$g_t$æ˜¯å½“å‰å‚æ•°çš„æ¢¯åº¦ã€‚</p>
<p>b. âœ’ï¸<strong>ä¼˜ç‚¹</strong>ï¼šæ¯æ¬¡åªç”¨ä¸€ä¸ªæ ·æœ¬æ›´æ–°æ¨¡å‹å‚æ•°ï¼Œè®­ç»ƒé€Ÿåº¦å¿«ã€‚</p>
<p>c. âœ’ï¸<strong>ç¼ºç‚¹</strong>ï¼šå®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜ï¼›æ²¿é™¡å³­æ–¹å‘æŒ¯è¡ï¼Œè€Œæ²¿å¹³ç¼“ç»´åº¦è¿›å±•ç¼“æ…¢ï¼Œéš¾ä»¥è¿…é€Ÿæ”¶æ•›</p>
<p>(2) â­<strong>SGD with momentum</strong></p>
<p>a. âœ’ï¸<strong>å…¬å¼</strong></p>
<center>

</center>
<p>å…¶ä¸­$m_t$ä¸ºåŠ¨é‡ã€‚</p>
<p>b. âœ’ï¸<strong>ä¼˜ç‚¹</strong>ï¼šå¯å€ŸåŠ©åŠ¨é‡è·³å‡ºå±€éƒ¨æœ€ä¼˜ç‚¹ã€‚</p>
<p>c. âœ’ï¸<strong>ç¼ºç‚¹</strong>ï¼šå®¹æ˜“åœ¨å±€éƒ¨æœ€ä¼˜ç‚¹é‡Œæ¥å›æŒ¯è¡ã€‚</p>
<p>(3) â­<strong>AdaGrad</strong>ï¼šç»å¸¸æ›´æ–°çš„å‚æ•°å·²ç»æ”¶æ•›å¾—æ¯”è¾ƒå¥½äº†ï¼Œåº”è¯¥å‡å°‘å¯¹å®ƒçš„å…³æ³¨ï¼Œå³é™ä½å…¶å­¦ä¹ ç‡ï¼›å¯¹äºä¸å¸¸æ›´æ–°çš„å‚æ•°ï¼Œæ¨¡å‹å­¦ä¹ çš„ä¿¡æ¯è¿‡å°‘ï¼Œåº”è¯¥å¢åŠ å¯¹å®ƒçš„å…³æ³¨ï¼Œå³å¢å¤§å…¶å­¦ä¹ ç‡ã€‚</p>
<p>a. âœ’ï¸<strong>å…¬å¼</strong>
$$w_{t+1}=w_t-\alpha \cdot g_t / \sqrt{V_t}=w_t-\alpha \cdot g_t / \sqrt{\sum_{\tau=1}^t g_\tau^2}$$
å…¶ä¸­Vtæ˜¯äºŒé˜¶åŠ¨é‡ï¼Œä¸ºç´¯è®¡æ¢¯åº¦å€¼çš„å¹³æ–¹å’Œï¼Œä¸å‚æ•°æ›´æ–°é¢‘ç¹ç¨‹åº¦æˆæ­£æ¯”ã€‚</p>
<p>b. âœ’ï¸<strong>ä¼˜ç‚¹</strong>ï¼šç¨€ç–æ•°æ®åœºæ™¯ä¸‹è¡¨ç°å¥½ï¼›è‡ªé€‚åº”è°ƒèŠ‚å­¦ä¹ ç‡ã€‚</p>
<p>c. âœ’ï¸<strong>ç¼ºç‚¹</strong>ï¼šVtå•è°ƒé€’å¢ï¼Œä½¿å¾—å­¦ä¹ ç‡å•è°ƒé€’å‡ä¸º0ï¼Œä»è€Œä½¿å¾—è®­ç»ƒè¿‡ç¨‹è¿‡æ—©ç»“æŸã€‚</p>
<p>(4) â­<strong>RMSProp</strong>ï¼šAdaGradçš„æ”¹è¿›ç‰ˆï¼Œä¸ç´¯è®¡æ‰€æœ‰å†å²æ¢¯åº¦ï¼Œè€Œæ˜¯è¿‡å»ä¸€æ®µæ—¶é—´çª—å£å†…çš„å†å²æ¢¯åº¦ã€‚</p>
<p>a. âœ’ï¸<strong>å…¬å¼</strong>
$$\begin{aligned} w_{t+1} &amp; =w_t-\alpha \cdot g_t / \sqrt{V_t} \ &amp; =w_t-\alpha \cdot g_t / \sqrt{\beta_2 \cdot V_{t-1}+\left(1-\beta_2\right) g_t^2}\end{aligned}$$
å³æŠŠVtæ¢æˆæŒ‡æ•°ç§»åŠ¨å¹³å‡ã€‚</p>
<p>b. âœ’ï¸<strong>ä¼˜ç‚¹</strong>ï¼šé¿å…äº†äºŒé˜¶åŠ¨é‡æŒç»­ç´¯ç§¯ã€å¯¼è‡´è®­ç»ƒè¿‡ç¨‹æå‰ç»“æŸçš„é—®é¢˜äº†ã€‚</p>
<p>(5) â­<strong>Adam</strong>ï¼š=Adaptive + momentumï¼Œå³ç»“åˆäº†momentumä¸€é˜¶åŠ¨é‡+RMSPropäºŒé˜¶åŠ¨é‡ã€‚</p>
<p>a. âœ’ï¸<strong>å…¬å¼</strong>
$$\begin{aligned} w_{t+1} &amp; =w_t-\alpha \cdot m_t / \sqrt{V_t} \ &amp; =w_t-\alpha \cdot\left(\beta_1 \cdot m_{t-1}+\left(1-\beta_1\right) \cdot g_t\right) / \sqrt{\beta_2 \cdot V_{t-1}+\left(1-\beta_2\right) g_t^2}\end{aligned}$$</p>
<p>b. âœ’ï¸<strong>ä¼˜ç‚¹</strong>ï¼šé€šè¿‡ä¸€é˜¶åŠ¨é‡å’ŒäºŒé˜¶åŠ¨é‡ï¼Œæœ‰æ•ˆæ§åˆ¶å­¦ä¹ ç‡æ­¥é•¿å’Œæ¢¯åº¦æ–¹å‘ï¼Œé˜²æ­¢æ¢¯åº¦çš„æŒ¯è¡å’Œåœ¨éç‚¹çš„é™æ­¢ã€‚</p>
<p>c. âœ’ï¸<strong>ç¼ºç‚¹</strong>ï¼šäºŒé˜¶åŠ¨é‡æ˜¯å›ºå®šå†å²æ—¶é—´çª—å£çš„ç´¯ç§¯ï¼Œçª—å£çš„å˜åŒ–å¯èƒ½å¯¼è‡´VtæŒ¯è¡ï¼Œè€Œä¸æ˜¯å•è°ƒå˜åŒ–ï¼Œä»è€Œå¯¼è‡´è®­ç»ƒåæœŸå­¦ä¹ ç‡çš„æŒ¯è¡ï¼Œæ¨¡å‹ä¸æ”¶æ•›ï¼Œå¯é€šè¿‡</p>
<center>

</center>
æ¥ä¿®æ­£ï¼Œä¿è¯å­¦ä¹ ç‡å•è°ƒé€’å‡ï¼›è‡ªé€‚åº”å­¦ä¹ ç‡ç®—æ³•å¯èƒ½ä¼šå¯¹å‰æœŸå‡ºç°çš„ç‰¹å¾è¿‡æ‹Ÿåˆï¼ŒåæœŸæ‰å‡ºç°çš„ç‰¹å¾å¾ˆéš¾çº æ­£å‰æœŸçš„æ‹Ÿåˆæ•ˆæœï¼Œä»è€Œé”™è¿‡å…¨å±€æœ€ä¼˜è§£ã€‚
<hr>
<p>æ•´ç†è¿™ç¯‡æ–‡ç« ä¸æ˜“ï¼Œå–œæ¬¢çš„è¯å¯ä»¥å…³æ³¨æˆ‘&ndash;&gt;<strong>æ— åæ°ï¼ŒæŸä¹å’Œå°çº¢è–¯åŒåï¼ŒWXï¼šæ— åæ°çš„èƒ¡è¨€ä¹±è¯­ã€‚</strong> å®šæœŸåˆ†äº«ç®—æ³•ç¬”è¯•ã€é¢è¯•å¹²è´§ã€‚</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [19] | AlphaGo Zeroå¼ºåŒ–å­¦ä¹ åŸç†</title><link>https://jianye0428.github.io/posts/rl_learning_note_19/</link><pubDate>Sun, 25 Feb 2024 19:53:22 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_19/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/10470571.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åå…«) åŸºäºæ¨¡æ‹Ÿçš„æœç´¢ä¸è’™ç‰¹å¡ç½—æ ‘æœç´¢(MCTS)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†MCTSçš„åŸç†å’Œåœ¨æ£‹ç±»ä¸­çš„åŸºæœ¬åº”ç”¨ã€‚è¿™é‡Œæˆ‘ä»¬åœ¨å‰ä¸€èŠ‚MCTSçš„åŸºç¡€ä¸Šï¼Œè®¨è®ºä¸‹DeepMindçš„AlphaGo Zeroå¼ºåŒ–å­¦ä¹ åŸç†ã€‚</p>
<p>æœ¬ç¯‡ä¸»è¦å‚è€ƒäº†AlphaGo Zeroçš„<a href="https://www.nature.com/articles/nature24270.epdf?author_access_token=VJXbVjaSHxFoctQQ4p2k4tRgN0jAjWel9jnR3ZoTv0PVW4gB86EEpGqTRDtpIz-2rmo8-KG06gqVobU5NSCFeHILHcVFUeMsbvwS-lxjqQGg98faovwjxeTUgZAUMnRQ"target="_blank" rel="external nofollow noopener noreferrer">è®ºæ–‡<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>, <a href="https://www.hhyz.me/2018/08/08/2018-08-08-AlphaGO-Zero/"target="_blank" rel="external nofollow noopener noreferrer">AlphaGo Zeroç»¼è¿°<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>å’ŒAlphaGo Zero Cheat Sheetã€‚</p>
<h1 id="1-alphago-zeroæ¨¡å‹åŸºç¡€">1. AlphaGo Zeroæ¨¡å‹åŸºç¡€</h1>
<p>AlphaGo Zeroä¸éœ€è¦å­¦ä¹ äººç±»çš„æ£‹è°±ï¼Œé€šè¿‡è‡ªæˆ‘å¯¹å¼ˆå®Œæˆæ£‹åŠ›æé«˜ã€‚ä¸»è¦ä½¿ç”¨äº†ä¸¤ä¸ªæ¨¡å‹ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬ä¸Šä¸€èŠ‚ä»‹ç»MCTSæ ‘ç»“æ„ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œã€‚MCTSä¸Šä¸€ç¯‡å·²ç»æœ‰åŸºæœ¬ä»‹ç»äº†ï¼Œå¯¹äºç¥ç»ç½‘ç»œï¼Œå®ƒçš„è¾“å…¥æ˜¯å½“å‰çš„æ£‹å±€çŠ¶æ€ï¼Œè¾“å‡ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†è¾“å‡ºæ˜¯åœ¨å½“å‰æ£‹å±€çŠ¶æ€ä¸‹å„ä¸ªå¯èƒ½çš„è½å­åŠ¨ä½œå¯¹åº”çš„è·èƒœæ¦‚ç‡pï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºActor-Criticç­–ç•¥å‡½æ•°éƒ¨åˆ†ã€‚å¦ä¸€éƒ¨åˆ†è¾“å‡ºä¸ºè·èƒœæˆ–è€…å¤±è´¥çš„è¯„ä¼°[-1,1]ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºActor-Criticä»·å€¼å‡½æ•°éƒ¨åˆ†ã€‚</p>
<p>AlphaGo Zeroçš„è¡Œæ£‹ä¸»è¦æ˜¯ç”±MCTSæŒ‡å¯¼å®Œæˆçš„ï¼Œä½†æ˜¯åœ¨MCTSæœç´¢çš„è¿‡ç¨‹ä¸­ï¼Œç”±äºæœ‰ä¸€äº›ä¸åœ¨æ ‘ä¸­çš„çŠ¶æ€éœ€è¦ä»¿çœŸï¼Œåšå±€é¢è¯„ä¼°ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªç®€å•çš„ç­–ç•¥æ¥å¸®åŠ©MCTSè¯„ä¼°æ”¹è¿›ç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥æ”¹è¿›éƒ¨åˆ†ç”±å‰é¢æåˆ°çš„ç¥ç»ç½‘ç»œå®Œæˆã€‚</p>
<p>è¿™ä¸¤éƒ¨åˆ†çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">AlphaGo Zero ä¸­çš„MCTSå’ŒNN</div>
</center>
<br>
<p>å…·ä½“AlphaGo Zeroçš„MCTSå¦‚ä½•æœç´¢ï¼Œç¥ç»ç½‘ç»œå¦‚ä½•è®­ç»ƒï¼Œå¦‚ä½•æŒ‡å¯¼MCTSæœç´¢æˆ‘ä»¬åœ¨åé¢å†è®²ã€‚</p>
<h1 id="2-alphago-zeroçš„è®­ç»ƒè¿‡ç¨‹ç®€ä»‹">2. AlphaGo Zeroçš„è®­ç»ƒè¿‡ç¨‹ç®€ä»‹</h1>
<p>åœ¨è®¨è®ºAlphaGo Zeroçš„MCTSå¦‚ä½•æœç´¢ï¼Œç¥ç»ç½‘ç»œå¦‚ä½•è®­ç»ƒç­‰ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹AlphaGo Zeroçš„è®­ç»ƒè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p>
<p>AlphaGo Zeroè®­ç»ƒè¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šè‡ªæˆ‘å¯¹æˆ˜å­¦ä¹ é˜¶æ®µï¼Œè®­ç»ƒç¥ç»ç½‘ç»œé˜¶æ®µå’Œè¯„ä¼°ç½‘ç»œé˜¶æ®µã€‚</p>
<p>è‡ªæˆ‘å¯¹æˆ˜å­¦ä¹ é˜¶æ®µä¸»è¦æ˜¯AlphaGo Zeroè‡ªæˆ‘å¯¹å¼ˆï¼Œäº§ç”Ÿå¤§é‡æ£‹å±€æ ·æœ¬çš„è¿‡ç¨‹ï¼Œç”±äºAlphaGo Zeroå¹¶ä¸ä½¿ç”¨å›´æ£‹å¤§å¸ˆçš„æ£‹å±€æ¥å­¦ä¹ ï¼Œå› æ­¤éœ€è¦è‡ªæˆ‘å¯¹å¼ˆå¾—åˆ°è®­ç»ƒæ•°æ®ç”¨äºåç»­ç¥ç»ç½‘ç»œçš„è®­ç»ƒã€‚åœ¨è‡ªæˆ‘å¯¹æˆ˜å­¦ä¹ é˜¶æ®µï¼Œæ¯ä¸€æ­¥çš„è½å­æ˜¯ç”±MCTSæœç´¢æ¥å®Œæˆçš„ã€‚åœ¨MCTSæœç´¢çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸åœ¨æ ‘ä¸­çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ç¥ç»ç½‘ç»œçš„ç»“æœæ¥æ›´æ–°MCTSæ ‘ç»“æ„ä¸Šä¿å­˜çš„å†…å®¹ã€‚åœ¨æ¯ä¸€æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œåœ¨æ¯ä¸ªæ£‹å±€å½“å‰çŠ¶æ€ $s$ ä¸‹ï¼Œæ¯ä¸€æ¬¡ç§»åŠ¨ä½¿ç”¨1600æ¬¡MCTSæœç´¢æ¨¡æ‹Ÿã€‚æœ€ç»ˆMCTSç»™å‡ºæœ€ä¼˜çš„è½å­ç­–ç•¥ $Ï€$ ,è¿™ä¸ªç­–ç•¥ $Ï€$ å’Œç¥ç»ç½‘ç»œçš„è¾“å‡º $p$ æ˜¯ä¸ä¸€æ ·çš„ã€‚å½“æ¯ä¸€å±€å¯¹æˆ˜ç»“æŸåï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æœ€ç»ˆçš„èƒœè´Ÿå¥–åŠ± $z$ ,1æˆ–è€…-1. è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—åˆ°éå¸¸å¤šçš„æ ·æœ¬ $(s,Ï€,z)$,è¿™äº›æ•°æ®å¯ä»¥è®­ç»ƒç¥ç»ç½‘ç»œé˜¶æ®µã€‚</p>
<p>åœ¨è®­ç»ƒç¥ç»ç½‘ç»œé˜¶æ®µï¼Œæˆ‘ä»¬ä½¿ç”¨è‡ªæˆ‘å¯¹æˆ˜å­¦ä¹ é˜¶æ®µå¾—åˆ°çš„æ ·æœ¬é›†åˆ(s,Ï€,z)(ï¿½,ï¿½,ï¿½),è®­ç»ƒæˆ‘ä»¬ç¥ç»ç½‘ç»œçš„æ¨¡å‹å‚æ•°ã€‚è®­ç»ƒçš„ç›®çš„æ˜¯å¯¹äºæ¯ä¸ªè¾“å…¥ $s$, ç¥ç»ç½‘ç»œè¾“å‡ºçš„ $p,v$å’Œæˆ‘ä»¬è®­ç»ƒæ ·æœ¬ä¸­çš„ $Ï€$, $z$å·®è·å°½å¯èƒ½çš„å°‘ã€‚è¿™ä¸ªæŸå¤±å‡½æ•° $L$ å…¶å®æ˜¯å¾ˆç®€å•çš„ï¼š</p>
<p>$$L=(z-v)^2-\pi^Tlog(p)+c||\theta||^2$$</p>
<p>æŸå¤±å‡½æ•°ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°ï¼Œç”¨äºè¯„ä¼°ç¥ç»ç½‘ç»œé¢„æµ‹çš„èƒœè´Ÿç»“æœå’ŒçœŸå®ç»“æœä¹‹é—´çš„å·®å¼‚ã€‚ç¬¬äºŒéƒ¨åˆ†æ˜¯äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œç”¨äºè¯„ä¼°ç¥ç»ç½‘ç»œçš„è¾“å‡ºç­–ç•¥å’Œæˆ‘ä»¬MCTSè¾“å‡ºçš„ç­–ç•¥çš„å·®å¼‚ã€‚ç¬¬ä¸‰éƒ¨åˆ†æ˜¯L2æ­£åˆ™åŒ–é¡¹ã€‚</p>
<p>é€šè¿‡è®­ç»ƒç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜åŒ–ç¥ç»ç½‘ç»œçš„å‚æ•° $Î¸$,ç”¨äºåç»­æŒ‡å¯¼æˆ‘ä»¬çš„MCTSæœç´¢è¿‡ç¨‹ã€‚</p>
<p>å½“ç¥ç»ç½‘ç»œè®­ç»ƒå®Œæ¯•åï¼Œæˆ‘ä»¬å°±è¿›è¡Œäº†è¯„ä¼°é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µä¸»è¦ç”¨äºç¡®è®¤ç¥ç»ç½‘ç»œçš„å‚æ•°æ˜¯å¦å¾—åˆ°äº†ä¼˜åŒ–ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè‡ªæˆ‘å¯¹æˆ˜çš„åŒæ–¹å„è‡ªä½¿ç”¨è‡ªå·±çš„ç¥ç»ç½‘ç»œæŒ‡å¯¼MCTSæœç´¢ï¼Œå¹¶å¯¹æˆ˜è‹¥å¹²å±€ï¼Œæ£€éªŒAlphaGo Zeroåœ¨æ–°ç¥ç»ç½‘ç»œå‚æ•°ä¸‹æ£‹åŠ›æ˜¯å¦å¾—åˆ°äº†æé«˜ã€‚é™¤äº†ç¥ç»ç½‘ç»œçš„å‚æ•°ä¸åŒï¼Œè¿™ä¸ªè¿‡ç¨‹å’Œç¬¬ä¸€é˜¶æ®µçš„è‡ªæˆ‘å¯¹æˆ˜å­¦ä¹ é˜¶æ®µè¿‡ç¨‹æ˜¯ç±»ä¼¼çš„ã€‚</p>
<h1 id="3-alphago-zeroçš„ç¥ç»ç½‘ç»œç»“æ„">3. AlphaGo Zeroçš„ç¥ç»ç½‘ç»œç»“æ„</h1>
<p>åœ¨ç¬¬äºŒèŠ‚æˆ‘ä»¬å·²ç»è®¨è®ºäº†AlphaGo Zeroçš„ä¸»è¦è®­ç»ƒè¿‡ç¨‹ï¼Œä½†æ˜¯è¿˜æœ‰ä¸¤å—æ²¡æœ‰è®²æ¸…æ¥šï¼Œä¸€æ˜¯AlphaGo Zeroçš„MCTSæœç´¢è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼ŒäºŒæ˜¯AlphaGo Zeroçš„ç¥ç»ç½‘ç»œçš„ç»“æ„å…·ä½“æ˜¯ä»€ä¹ˆæ ·çš„ã€‚è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥çœ‹çœ‹AlphaGo Zeroçš„ç¥ç»ç½‘ç»œçš„ç»†èŠ‚ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹AlphaGo Zeroçš„è¾“å…¥ï¼Œå½“å‰çš„æ£‹å±€çŠ¶æ€ã€‚ç”±äºå›´æ£‹æ˜¯19x19çš„361ä¸ªç‚¹ç»„æˆçš„æ£‹å±€ï¼Œæ¯ä¸ªç‚¹çš„çŠ¶æ€æœ‰äºŒç§ï¼šå¦‚æœå½“å‰æ˜¯é»‘æ–¹è¡Œæ£‹ï¼Œåˆ™å½“å‰æœ‰é»‘æ£‹çš„ç‚¹å–å€¼1ï¼Œæœ‰ç™½æ£‹æˆ–è€…æ²¡æœ‰æ£‹å­çš„ä½ç½®å–å€¼ä¸º0ï¼Œåè¿‡æ¥ï¼Œå¦‚æœå½“å‰æ˜¯ç™½æ–¹è¡Œæ£‹ï¼Œåˆ™å½“å‰æœ‰ç™½æ£‹çš„ç‚¹å–å€¼1ï¼Œæœ‰é»‘æ£‹æˆ–è€…æ²¡æœ‰æ£‹å­çš„ä½ç½®å–å€¼ä¸º0ã€‚åŒæ—¶ï¼Œä¸ºäº†æä¾›æ›´å¤šçš„ä¿¡æ¯ï¼Œè¾“å…¥çš„æ£‹å±€çŠ¶æ€ä¸å…‰åªæœ‰å½“å‰çš„æ£‹å±€çŠ¶æ€ï¼ŒåŒ…æ‹¬äº†é»‘æ£‹ç™½æ£‹å„è‡ªå‰8æ­¥å¯¹åº”çš„æ£‹å±€çŠ¶æ€ã€‚é™¤äº†è¿™16ä¸ªæ£‹å±€çŠ¶æ€ï¼Œè¿˜æœ‰ä¸€ä¸ªå•ç‹¬çš„æ£‹å±€çŠ¶æ€ç”¨äºæ ‡è¯†å½“å‰è¡Œæ£‹æ–¹ï¼Œå¦‚æœæ˜¯å½“å‰é»‘æ£‹è¡Œæ£‹ï¼Œåˆ™æ£‹å±€çŠ¶æ€ä¸Šæ ‡å…¨1ï¼Œç™½æ£‹åˆ™æ£‹å±€çŠ¶æ€ä¸Šæ ‡å…¨0ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">Game State</div>
</center>
<br>
<p>æœ€ç»ˆç¥ç»ç½‘ç»œçš„è¾“å…¥æ˜¯ä¸€ä¸ª19x19x17çš„å¼ é‡ã€‚é‡Œé¢åŒ…å«é»‘æ£‹å’Œç™½æ£‹çš„æœ€è¿‘8æ­¥è¡Œæ£‹çŠ¶æ€å’Œå½“å‰è¡Œæ£‹æ–¹çš„ä¿¡æ¯ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬çœ‹çœ‹ç¥ç»ç½‘ç»œçš„è¾“å‡ºï¼Œç¥ç»ç½‘ç»œçš„è¾“å‡ºåŒ…æ‹¬ç­–ç•¥éƒ¨åˆ†å’Œä»·å€¼éƒ¨åˆ†ã€‚å¯¹äºç­–ç•¥éƒ¨åˆ†ï¼Œå®ƒé¢„æµ‹å½“å‰å„ä¸ªè¡Œæ£‹ç‚¹è½å­çš„æ¦‚ç‡ã€‚ç”±äºå›´æ£‹æœ‰361ä¸ªè½å­ç‚¹ï¼ŒåŠ ä¸Šè¿˜å¯ä»¥Passä¸€æ‰‹ï¼Œå› æ­¤ä¸€å…±æœ‰362ä¸ªç­–ç•¥ç«¯æ¦‚ç‡è¾“å‡ºã€‚å¯¹äºä»·å€¼ç«¯ï¼Œè¾“å‡ºå°±ç®€å•äº†ï¼Œå°±æ˜¯å½“å‰å±€é¢èƒœè´Ÿçš„è¯„ä¼°å€¼ï¼Œåœ¨[-1,1]ä¹‹é—´ã€‚</p>
<p>çœ‹å®Œäº†ç¥ç»ç½‘ç»œçš„è¾“å…¥å’Œè¾“å‡ºï¼Œæˆ‘ä»¬å†çœ‹çœ‹ç¥ç»ç½‘ç»œçš„ç»“æ„ï¼Œä¸»è¦æ˜¯ç”¨CNNç»„æˆçš„æ·±åº¦æ®‹å·®ç½‘ç»œã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;"></div>
</center>
<br>
<p>åœ¨19x19x17çš„å¼ é‡åšäº†ä¸€ä¸ªåŸºæœ¬çš„å·ç§¯åï¼Œä½¿ç”¨äº†19å±‚æˆ–è€…39å±‚çš„æ·±åº¦æ®‹å·®ç½‘ç»œï¼Œè¿™ä¸ªæ˜¯ResNetçš„ç»å…¸ç»“æ„ã€‚ç†è®ºä¸Šè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨DenseNetç­‰å…¶ä»–æµè¡Œçš„ç½‘ç»œç»“æ„ã€‚ç¥ç»ç½‘ç»œçš„æŸå¤±å‡½æ•°éƒ¨åˆ†æˆ‘ä»¬åœ¨ç¬¬äºŒèŠ‚å·²ç»å°†äº†ã€‚æ•´ä¸ªç¥ç»ç½‘ç»œå°±æ˜¯ä¸ºäº†å½“MCTSé‡åˆ°æ²¡æœ‰è§è¿‡çš„å±€é¢æ—¶ï¼Œæä¾›çš„å½“å‰çŠ¶æ€ä¸‹çš„å±€é¢è¯„ä¼°å’Œè½å­æ¦‚ç‡å‚è€ƒã€‚è¿™éƒ¨åˆ†ä¿¡æ¯ä¼šè¢«MCTSåç»­ç»¼åˆåˆ©ç”¨ã€‚</p>
<h1 id="4-alphago-zeroçš„mctsæœç´¢">4. AlphaGo Zeroçš„MCTSæœç´¢</h1>
<p>ã€€ã€€ã€€ã€€ç°åœ¨æˆ‘ä»¬æ¥å†çœ‹çœ‹AlphaGo Zeroçš„MCTSæœç´¢è¿‡ç¨‹ï¼Œåœ¨<a href="https://www.cnblogs.com/pinard/p/10470571.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åå…«) åŸºäºæ¨¡æ‹Ÿçš„æœç´¢ä¸è’™ç‰¹å¡ç½—æ ‘æœç´¢(MCTS)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>é‡Œï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†MCTSçš„åŸºæœ¬åŸç†ï¼Œå’Œ4ä¸ªä¸»è¦çš„æœç´¢é˜¶æ®µï¼šé€‰æ‹©ï¼Œæ‰©å±•ï¼Œä»¿çœŸå’Œå›æº¯ã€‚å’Œä¸Šä¸€ç¯‡çš„å†…å®¹ç›¸æ¯”ï¼Œè¿™é‡ŒMCTSçš„ä¸åŒä¸»è¦ä½“ç°åœ¨æ ‘ç»“æ„ä¸Šä¿å­˜çš„ä¿¡æ¯ä¸åŒï¼Œè¿›è€ŒUCTçš„è®¡ç®—å…¬å¼ä¹Ÿç¨æœ‰ä¸åŒã€‚æœ€åMCTSæœç´¢å®Œæ¯•åï¼ŒAlphaGo Zeroä¹Ÿæœ‰è‡ªå·±é€‰æ‹©çœŸæ­£è½å­ç‚¹çš„ç­–ç•¥ã€‚</p>
<p>ã€€ã€€ã€€ã€€åœ¨ä¸Šä¸€ç¯‡é‡Œï¼Œæˆ‘ä»¬çš„MCTSä¸Šä¿å­˜çš„æ•°æ®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸‹çš„æ€»ç›˜æ•°å’Œèµ¢çš„æ€»ç›˜æ•°ã€‚åœ¨AlphaGo Zeroè¿™é‡Œï¼Œæˆ‘ä»¬ä¿å­˜çš„ä¿¡æ¯ä¼šå¤šä¸€äº›ã€‚ä¸»è¦åŒ…æ‹¬ä¸‹é¢çš„4éƒ¨åˆ†ï¼š</p>
<ul>
<li>$N(s,a)$:è®°å½•è¾¹çš„è®¿é—®æ¬¡æ•°</li>
<li>$W(s,a)$: åˆè®¡è¡ŒåŠ¨ä»·å€¼</li>
<li>$Q(s,a)$:å¹³å‡è¡ŒåŠ¨ä»·å€¼</li>
<li>$P(s,a)$:é€‰æ‹©è¯¥æ¡è¾¹çš„å…ˆéªŒæ¦‚ç‡</li>
</ul>
<p>å…¶ä¸­ $s$ ä¸ºå½“å‰æ£‹å±€çŠ¶æ€ï¼Œ$a$ ä¸ºæŸä¸€è½å­é€‰æ‹©å¯¹åº”çš„æ ‘åˆ†æ”¯ã€‚</p>
<p>æœ‰äº†MCTSä¸Šçš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬çœ‹çœ‹AlphaGo Zeroçš„MCTSæœç´¢çš„4ä¸ªé˜¶æ®µæµç¨‹ï¼š</p>
<p>é¦–å…ˆæ˜¯é€‰æ‹©ï¼Œåœ¨MCTSå†…éƒ¨ï¼Œå‡ºç°è¿‡çš„å±€é¢ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨UCTé€‰æ‹©å­åˆ†æ”¯ã€‚å­åˆ†æ”¯çš„UCTåŸç†å’Œä¸Šä¸€èŠ‚ä¸€æ ·ã€‚ä½†æ˜¯å…·ä½“çš„å…¬å¼ç¨æœ‰ä¸åŒï¼Œå¦‚ä¸‹ï¼š</p>
<p>$$\begin{gathered}
U(s,a)=c_{puct}P(s,a)\frac{\sqrt{\sum_bN(s,b)}}{1+N(s,a)} \\
a_t=\arg\max_a(Q(s_t,a)+U(s_t,a))
\end{gathered}$$</p>
<p>æœ€ç»ˆæˆ‘ä»¬ä¼šé€‰æ‹© $Q+U$æœ€å¤§çš„å­åˆ†æ”¯ä½œä¸ºæœç´¢åˆ†æ”¯ï¼Œä¸€ç›´èµ°åˆ°æ£‹å±€ç»“æŸï¼Œæˆ–è€…èµ°åˆ°äº†æ²¡æœ‰åˆ°ç»ˆå±€MCTSçš„å¶å­èŠ‚ç‚¹ã€‚$c_{puct}$æ˜¯å†³å®šæ¢ç´¢ç¨‹åº¦çš„ä¸€ä¸ªç³»æ•°,ä¸Šä¸€ç¯‡å·²è®²è¿‡ã€‚</p>
<p>å¦‚æœåˆ°äº†æ²¡æœ‰åˆ°ç»ˆå±€çš„MCTSå¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è¿›å…¥MCTSçš„ç¬¬äºŒæ­¥ï¼Œæ‰©å±•é˜¶æ®µ,ä»¥åŠåç»­çš„ç¬¬ä¸‰æ­¥ä»¿çœŸé˜¶æ®µã€‚æˆ‘ä»¬è¿™é‡Œä¸€èµ·è®²ã€‚å¯¹äºå¶å­èŠ‚ç‚¹çŠ¶æ€sï¿½ï¼Œä¼šåˆ©ç”¨ç¥ç»ç½‘ç»œå¯¹å¶å­èŠ‚ç‚¹åšé¢„æµ‹ï¼Œå¾—åˆ°å½“å‰å¶å­èŠ‚ç‚¹çš„å„ä¸ªå¯èƒ½çš„å­èŠ‚ç‚¹ä½ç½®sLï¿½ï¿½è½å­çš„æ¦‚ç‡pï¿½å’Œå¯¹åº”çš„ä»·å€¼vï¿½,å¯¹äºè¿™äº›å¯èƒ½çš„æ–°èŠ‚ç‚¹æˆ‘ä»¬åœ¨MCTSä¸­åˆ›å»ºå‡ºæ¥ï¼Œåˆå§‹åŒ–å…¶åˆ†æ”¯ä¸Šä¿å­˜çš„ä¿¡æ¯ä¸ºï¼š</p>
<p>$$\{N(s_L,a)=0,W(s_L,a)=0,Q(s_L,a)=0,P(s_L,a)=P_a\}$$</p>
<p>è¿™ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;"></div>
</center>
<br>
<p>è¿™æ ·æ‰©å±•åï¼Œä¹‹å‰çš„å¶å­èŠ‚ç‚¹ $s$ï¼Œç°åœ¨å°±æ˜¯å†…éƒ¨èŠ‚ç‚¹äº†ã€‚åšå®Œäº†æ‰©å±•å’Œä»¿çœŸåï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå›æº¯ï¼Œå°†æ–°å¶å­èŠ‚ç‚¹åˆ†æ”¯çš„ä¿¡æ¯å›æº¯ç´¯åŠ åˆ°ç¥–å…ˆèŠ‚ç‚¹åˆ†æ”¯ä¸Šå»ã€‚è¿™ä¸ªå›æº¯çš„é€»è¾‘ä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼Œä»æ¯ä¸ªå¶å­èŠ‚ç‚¹ $L$ ä¾æ¬¡å‘æ ¹èŠ‚ç‚¹å›æº¯ï¼Œå¹¶ä¾æ¬¡æ›´æ–°ä¸Šå±‚åˆ†æ”¯æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p>
<p>$$\begin{gathered}
N(s_t,a_t)=N(s_t,a_t)+1 \\
W(s_t,a_t)=W(s_t,a_t)+v \\
Q(s_t,a_t)=\frac{W(s_t,a_t)}{N(s_t,a_t)}
\end{gathered}$$</p>
<p>è¿™ä¸ªMCTSæœç´¢è¿‡ç¨‹åœ¨ä¸€æ¬¡çœŸæ­£è¡Œæ£‹å‰ï¼Œä¸€èˆ¬ä¼šè¿›è¡Œçº¦1600æ¬¡æœç´¢ï¼Œæ¯æ¬¡æœç´¢éƒ½ä¼šè¿›è¡Œä¸Šè¿°4ä¸ªé˜¶æ®µã€‚</p>
<p>è¿™ä¸Šåƒæ¬¡MCTSæœç´¢å®Œæ¯•åï¼ŒAlphaGo Zeroå°±å¯ä»¥åœ¨MCTSçš„æ ¹èŠ‚ç‚¹ $s$ åŸºäºä»¥ä¸‹å…¬å¼é€‰æ‹©è¡Œæ£‹çš„MCTSåˆ†æ”¯äº†:</p>
<p>$$\pi(a|s)=\frac{N(s,a)^{1/\tau}}{\sum_bN(s,b)^{1/\tau}}$$</p>
<p>å…¶ä¸­ï¼Œ$Ï„$ ä¸ºæ¸©åº¦å‚æ•°ï¼Œæ§åˆ¶æ¢ç´¢çš„ç¨‹åº¦ï¼Œ$Ï„$ è¶Šå¤§ï¼Œä¸åŒèµ°æ³•é—´å·®å¼‚å˜å°ï¼Œæ¢ç´¢æ¯”ä¾‹å¢å¤§ï¼Œåä¹‹ï¼Œåˆ™æ›´å¤šé€‰æ‹©å½“å‰æœ€ä¼˜æ“ä½œã€‚æ¯ä¸€æ¬¡å®Œæ•´çš„è‡ªæˆ‘å¯¹å¼ˆçš„å‰30æ­¥ï¼Œå‚æ•° $Ï„=1$ï¼Œè¿™æ˜¯æ—©æœŸé¼“åŠ±æ¢ç´¢çš„è®¾ç½®ã€‚æ¸¸æˆå‰©ä¸‹çš„æ­¥æ•°ï¼Œè¯¥å‚æ•°å°†é€æ¸é™ä½è‡³0ã€‚å¦‚æœæ˜¯æ¯”èµ›ï¼Œåˆ™ç›´æ¥ä¸º0.</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;"></div>
</center>
<br>
<p>åŒæ—¶åœ¨éšåçš„æ—¶é—´æ­¥ä¸­ï¼Œè¿™ä¸ªMCTSæœç´¢æ ‘å°†ä¼šç»§ç»­ä½¿ç”¨ï¼Œå¯¹åº”äºå®é™…æ‰€é‡‡å–çš„è¡Œä¸ºçš„å­èŠ‚ç‚¹å°†å˜æˆæ ¹èŠ‚ç‚¹ï¼Œè¯¥å­èŠ‚ç‚¹ä¸‹çš„å­æ ‘çš„ç»Ÿè®¡æ•°æ®å°†ä¼šè¢«ä¿ç•™ï¼Œè€Œè¿™é¢—æ ‘çš„å…¶ä½™éƒ¨åˆ†å°†ä¼šä¸¢å¼ƒ ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯AlphaGo Zero MCTSæœç´¢çš„è¿‡ç¨‹ã€‚</p>
<h1 id="5-alphago-zeroå°ç»“ä¸å¼ºåŒ–å­¦ä¹ ç³»åˆ—å°ç»“">5. AlphaGo Zeroå°ç»“ä¸å¼ºåŒ–å­¦ä¹ ç³»åˆ—å°ç»“</h1>
<p>AlphaGo Zeroå·§å¦™äº†ä½¿ç”¨MCTSæœç´¢æ ‘å’Œç¥ç»ç½‘ç»œä¸€èµ·ï¼Œé€šè¿‡MCTSæœç´¢æ ‘ä¼˜åŒ–ç¥ç»ç½‘ç»œå‚æ•°ï¼Œåè¿‡æ¥åˆé€šè¿‡ä¼˜åŒ–çš„ç¥ç»ç½‘ç»œæŒ‡å¯¼MCTSæœç´¢ã€‚ä¸¤è€…ä¸€ä¸»ä¸€è¾…ï¼Œéå¸¸ä¼˜é›…çš„è§£å†³äº†è¿™ç±»çŠ¶æ€å®Œå…¨å¯è§ï¼Œä¿¡æ¯å……åˆ†çš„æ£‹ç±»é—®é¢˜ã€‚</p>
<p>å½“ç„¶è¿™ç±»å¼ºåŒ–å­¦ä¹ ç®—æ³•åªå¯¹ç‰¹å®šçš„è¿™ç±»å®Œå…¨çŠ¶æ€å¯è§ï¼Œä¿¡æ¯å……åˆ†çš„é—®é¢˜æœ‰æ•ˆï¼Œé‡åˆ°ä¿¡æ¯ä¸å¯¹ç§°çš„å¼ºåŒ–å­¦ä¹ é—®é¢˜ï¼Œæ¯”å¦‚æ˜Ÿé™…ï¼Œé­”å…½ä¹‹ç±»çš„å¯¹æˆ˜æ¸¸æˆé—®é¢˜ï¼Œè¿™ä¸ªç®—æ³•å°±ä¸é‚£ä¹ˆæœ‰æ•ˆäº†ã€‚è¦æ¨å¹¿AlphaGo Zeroçš„ç®—æ³•åˆ°å¤§å¤šæ•°æ™®é€šå¼ºåŒ–å­¦ä¹ é—®é¢˜è¿˜æ˜¯å¾ˆéš¾çš„ã€‚å› æ­¤åç»­å¼ºåŒ–å­¦ä¹ ç®—æ³•åº”è¯¥è¿˜æœ‰å¾ˆå¤šå‘å±•çš„ç©ºé—´ã€‚</p>
<p>è‡³æ­¤å¼ºåŒ–å­¦ä¹ ç³»åˆ—å°±å†™å®Œäº†ï¼Œä¹‹å‰é¢„è®¡çš„æ˜¯å†™ä¸‰ä¸ªæœˆï¼Œç»“æœç”±äºäº‹æƒ…å¤ªå¤šï¼Œå±…ç„¶èŠ±äº†å¤§åŠå¹´ã€‚ä½†æ˜¯æ€»ç®—è¿˜æ˜¯å®Œæˆäº†ï¼Œæ²¡æœ‰çƒ‚å°¾ã€‚ç”Ÿæ´»ä¸æ˜“ï¼Œç»§ç»­åŠªåŠ›ï¼</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [18] | åŸºäºæ¨¡æ‹Ÿçš„æœç´¢ä¸è’™ç‰¹å¡ç½—æ ‘æœç´¢(MCTS)</title><link>https://jianye0428.github.io/posts/rl_learning_note_18/</link><pubDate>Sun, 25 Feb 2024 19:53:18 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_18/</guid><description><![CDATA[<ul>
<li></li>
</ul>
<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/10384424.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åä¸ƒ) åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ä¸Dynaç®—æ³•æ¡†æ¶<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºåŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ–¹æ³•çš„åŸºæœ¬æ€è·¯ï¼Œä»¥åŠé›†åˆåŸºäºæ¨¡å‹ä¸ä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ¡†æ¶Dynaã€‚æœ¬æ–‡æˆ‘ä»¬è®¨è®ºå¦ä¸€ç§éå¸¸æµè¡Œçš„é›†åˆåŸºäºæ¨¡å‹ä¸ä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ–¹æ³•ï¼šåŸºäºæ¨¡æ‹Ÿçš„æœç´¢(Simulation Based Search)ã€‚</p>
<p>æœ¬ç¯‡ä¸»è¦å‚è€ƒäº†UCLå¼ºåŒ–å­¦ä¹ è¯¾ç¨‹çš„ç¬¬å…«è®²ï¼Œç¬¬ä¹è®²éƒ¨åˆ†ã€‚</p>
<h1 id="1-åŸºäºæ¨¡æ‹Ÿçš„æœç´¢æ¦‚è¿°">1. åŸºäºæ¨¡æ‹Ÿçš„æœç´¢æ¦‚è¿°</h1>
<p>ä»€ä¹ˆæ˜¯åŸºäºæ¨¡æ‹Ÿçš„æœç´¢å‘¢ï¼Ÿå½“ç„¶ä¸»è¦æ˜¯ä¸¤ä¸ªç‚¹ï¼šä¸€ä¸ªæ˜¯æ¨¡æ‹Ÿï¼Œä¸€ä¸ªæ˜¯æœç´¢ã€‚æ¨¡æ‹Ÿæˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡ä¹Ÿè®¨è®ºè¿‡ï¼Œå°±æ˜¯åŸºäºå¼ºåŒ–å­¦ä¹ æ¨¡å‹è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°æ ·æœ¬æ•°æ®ã€‚ä½†æ˜¯è¿™æ˜¯æ•°æ®ä¸æ˜¯åŸºäºå’Œç¯å¢ƒäº¤äº’è·å¾—çš„çœŸå®æ•°æ®ï¼Œæ‰€ä»¥æ˜¯â€œæ¨¡æ‹Ÿâ€ã€‚å¯¹äºæœç´¢ï¼Œåˆ™æ˜¯ä¸ºäº†åˆ©ç”¨æ¨¡æ‹Ÿçš„æ ·æœ¬ç»“æœæ¥å¸®æˆ‘ä»¬è®¡ç®—åˆ°åº•åº”è¯¥é‡‡ç”¨ä»€ä¹ˆæ ·çš„åŠ¨ä½œï¼Œä»¥å®ç°æˆ‘ä»¬çš„é•¿æœŸå—ç›Šæœ€å¤§åŒ–ã€‚</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è¿›è¡ŒåŸºäºæ¨¡æ‹Ÿçš„æœç´¢å‘¢ï¼Ÿåœ¨è¿™ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹çœ‹æœ€ç®€å•çš„å‰å‘æœç´¢(forward search)ã€‚å‰å‘æœç´¢ç®—æ³•ä»å½“å‰æˆ‘ä»¬è€ƒè™‘çš„çŠ¶æ€èŠ‚ç‚¹ $S_t$ å¼€å§‹è€ƒè™‘ï¼Œæ€ä¹ˆè€ƒè™‘å‘¢ï¼Ÿå¯¹è¯¥çŠ¶æ€èŠ‚ç‚¹æ‰€æœ‰å¯èƒ½çš„åŠ¨ä½œè¿›è¡Œæ‰©å±•ï¼Œå»ºç«‹ä¸€é¢—ä»¥ $S_t$ ä¸ºæ ¹èŠ‚ç‚¹çš„æœç´¢æ ‘ï¼Œè¿™ä¸ªæœç´¢æ ‘ä¹Ÿæ˜¯ä¸€ä¸ªMDPï¼Œåªæ˜¯å®ƒæ˜¯ä»¥å½“å‰çŠ¶æ€ä¸ºæ ¹èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ä»¥èµ·å§‹çŠ¶æ€ä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¹Ÿå«åšsub-MDPã€‚æˆ‘ä»¬æ±‚è§£è¿™ä¸ªsub-MDPé—®é¢˜ï¼Œç„¶åå¾—åˆ° $S_t$çŠ¶æ€æœ€åº”è¯¥é‡‡ç”¨çš„åŠ¨ä½œ $A_t$ã€‚å‰å‘æœç´¢çš„sub-MDPå¦‚ä¸‹å›¾ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">forward search sub-MDP</div>
</center>
<br>
<p>å‰å‘æœç´¢å»ºç«‹äº†ä¸€ä¸ªsub-MDPæ¥æ±‚è§£ï¼Œè¿™å¾ˆç²¾ç¡®ï¼Œè€Œä¸”è¿™åœ¨çŠ¶æ€åŠ¨ä½œæ•°é‡éƒ½å¾ˆå°‘çš„æ—¶å€™æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯åªè¦ç¨å¾®çŠ¶æ€åŠ¨ä½œæ•°é‡å¤šä¸€ç‚¹ï¼Œæ¯ä¸ªçŠ¶æ€çš„é€‰æ‹©å°±éƒ½ç‰¹åˆ«æ…¢äº†ï¼Œå› æ­¤ä¸å¤ªå®ç”¨ï¼Œæ­¤æ—¶åŸºäºæ¨¡æ‹Ÿçš„æœç´¢å°±æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„æŠ˜è¡·ã€‚</p>
<h1 id="2-ç®€å•è’™ç‰¹å¡ç½—æœç´¢">2. ç®€å•è’™ç‰¹å¡ç½—æœç´¢</h1>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹åŸºäºæ¨¡æ‹Ÿçš„æœç´¢ä¸­æ¯”è¾ƒç®€å•çš„ä¸€ç§æ–¹æ³•ï¼šç®€å•è’™ç‰¹å¡ç½—æœç´¢ã€‚</p>
<p>ç®€å•è’™ç‰¹å¡ç½—æœç´¢åŸºäºä¸€ä¸ªå¼ºåŒ–å­¦ä¹ æ¨¡å‹ $M_v$ å’Œä¸€ä¸ªæ¨¡æ‹Ÿç­–ç•¥ $Ï€$.åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯¹äºå½“å‰æˆ‘ä»¬è¦é€‰æ‹©åŠ¨ä½œçš„çŠ¶æ€ $S_t$, å¯¹æ¯ä¸€ä¸ªå¯èƒ½é‡‡æ ·çš„åŠ¨ä½œ $aâˆˆA$,éƒ½è¿›è¡Œ $K$ è½®é‡‡æ ·ï¼Œè¿™æ ·æ¯ä¸ªåŠ¨ä½œ $a$ éƒ½ä¼šå¾—åˆ° $K$ ç»„ç»å†å®Œæ•´çš„çŠ¶æ€åºåˆ—(episode)ã€‚å³ï¼š</p>
<p>$$\{S_t,a,R_{t+1}^k,S_{t+1}^k,A_{t+1}^k,\ldots\ldots S_T^k\}_{k=1}^K\sim M_v,\pi $$</p>
<p>ç°åœ¨å¯¹äºæ¯ä¸ª $(S_t,a)$ ç»„åˆï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºè’™ç‰¹å¡ç½—æ³•æ¥è®¡ç®—å…¶åŠ¨ä½œä»·å€¼å‡½æ•°å¹¶é€‰æ‹©æœ€ä¼˜çš„åŠ¨ä½œäº†ã€‚</p>
<p>$$\begin{gathered}Q(S_t,a)=\frac1K\sum_{k=1}^KG_t\\a_t=\arg\max_{a\in A}Q(S_t,a)\end{gathered}$$</p>
<p>ç®€å•è’™ç‰¹å¡ç½—æœç´¢å’Œèµ·å‰å‘æœç´¢æ¯”èµ·æ¥ï¼Œå¯¹äºçŠ¶æ€åŠ¨ä½œæ•°é‡çš„å¤„ç†èƒ½åŠ›ä¸Šäº†ä¸€ä¸ªæ•°é‡çº§,å¯ä»¥å¤„ç†ä¸­ç­‰è§„æ¨¡çš„é—®é¢˜ã€‚ä½†æ˜¯å‡å¦‚æˆ‘ä»¬çš„çŠ¶æ€åŠ¨ä½œæ•°é‡è¾¾åˆ°éå¸¸å¤§çš„é‡çº§ï¼Œæ¯”å¦‚å›´æ£‹çš„çº§åˆ«,é‚£ä¹ˆç®€å•è’™ç‰¹å¡ç½—æœç´¢ä¹Ÿå¤ªæ…¢äº†ã€‚åŒæ—¶ï¼Œç”±äºä½¿ç”¨è’™ç‰¹å¡ç½—æ³•è®¡ç®—å…¶åŠ¨ä½œä»·å€¼å‡½æ•°ï¼Œæ¨¡æ‹Ÿé‡‡æ ·å¾—åˆ°çš„ä¸€äº›ä¸­é—´çŠ¶æ€å’Œå¯¹åº”è¡Œä¸ºçš„ä»·å€¼å°±è¢«å¿½ç•¥äº†ï¼Œè¿™éƒ¨åˆ†æ•°æ®èƒ½ä¸èƒ½åˆ©ç”¨èµ·æ¥å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹è’™ç‰¹å¡ç½—æ ‘æœç´¢(Monte-Carlo Tree Searchï¼Œä»¥ä¸‹ç®€ç§°MCTS)æ€ä¹ˆä¼˜åŒ–è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h1 id="3-mctsçš„åŸç†">3. MCTSçš„åŸç†</h1>
<p>MCTSæ‘’å¼ƒäº†ç®€å•è’™ç‰¹å¡ç½—æœç´¢é‡Œé¢å¯¹å½“å‰çŠ¶æ€ $S_t$ æ¯ä¸ªåŠ¨ä½œéƒ½è¦è¿›è¡ŒKæ¬¡æ¨¡æ‹Ÿé‡‡æ ·çš„åšæ³•ï¼Œè€Œæ˜¯æ€»å…±å¯¹å½“å‰çŠ¶æ€ $S_t$è¿›è¡ŒKæ¬¡é‡‡æ ·ï¼Œè¿™æ ·é‡‡æ ·åˆ°çš„åŠ¨ä½œåªæ˜¯åŠ¨ä½œå…¨é›† $A$ ä¸­çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ ·åšå¤§å¤§é™ä½äº†é‡‡æ ·çš„æ•°é‡å’Œé‡‡æ ·åçš„æœç´¢è®¡ç®—ã€‚å½“ç„¶ï¼Œä»£ä»·æ˜¯å¯èƒ½åŠ¨ä½œå…¨é›†ä¸­çš„å¾ˆå¤šåŠ¨ä½œéƒ½æ²¡æœ‰é‡‡æ ·åˆ°ï¼Œå¯èƒ½é”™å¤±å¥½çš„åŠ¨ä½œé€‰æ‹©ï¼Œè¿™æ˜¯ä¸€ä¸ªç®—æ³•è®¾è®¡ä¸Šçš„æŠ˜è¡·ã€‚</p>
<p>åœ¨MCTSä¸­ï¼ŒåŸºäºä¸€ä¸ªå¼ºåŒ–å­¦ä¹ æ¨¡å‹ $M_v$å’Œä¸€ä¸ªæ¨¡æ‹Ÿç­–ç•¥$Ï€$ï¼Œå½“å‰çŠ¶æ€ $S_t$ å¯¹åº”çš„å®Œæ•´çš„çŠ¶æ€åºåˆ—(episode)æ˜¯è¿™æ ·çš„:</p>
<p>$$\{S_t,A_t^k,R_{t+1}^k,S_{t+1}^k,A_{t+1}^k,\ldots\ldots S_T^k\}_{k=1}^K\sim M_v,\pi $$</p>
<p>é‡‡æ ·å®Œæ¯•åï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºé‡‡æ ·çš„ç»“æœæ„å»ºä¸€é¢—MCTSçš„æœç´¢æ ‘ï¼Œç„¶åè¿‘ä¼¼è®¡ç®— $Q(st,a)$å’Œæœ€å¤§ $Q(s_t,a)$å¯¹åº”çš„åŠ¨ä½œã€‚</p>
<p>$$\begin{gathered}Q(S_t,a)=\frac1{N(S_t,a)}\sum_{k=1}^K\sum_{u=t}^T1(S_{uk}=S_t,A_{uk}=a)G_u\\a_t=\arg\max_{a\in A}Q(S_t,a)\end{gathered}$$</p>
<p>MCTSæœç´¢çš„ç­–ç•¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç¬¬ä¸€ä¸ªæ˜¯æ ‘å†…ç­–ç•¥(tree policy)ï¼šä¸ºå½“æ¨¡æ‹Ÿé‡‡æ ·å¾—åˆ°çš„çŠ¶æ€å­˜åœ¨äºå½“å‰çš„MCTSæ—¶ä½¿ç”¨çš„ç­–ç•¥ã€‚æ ‘å†…ç­–ç•¥å¯ä»¥ä½¿ $Ïµâˆ’$è´ªå©ªç­–ç•¥ï¼Œéšç€æ¨¡æ‹Ÿçš„è¿›è¡Œç­–ç•¥å¯ä»¥å¾—åˆ°æŒç»­æ”¹å–„ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸Šé™ç½®ä¿¡åŒºé—´ç®—æ³•UCTï¼Œè¿™åœ¨æ£‹ç±»æ¸¸æˆä¸­å¾ˆæ™®éï¼›ç¬¬äºŒä¸ªæ˜¯é»˜è®¤ç­–ç•¥(default policy)ï¼šå¦‚æœå½“å‰çŠ¶æ€ä¸åœ¨MCTSå†…ï¼Œä½¿ç”¨é»˜è®¤ç­–ç•¥æ¥å®Œæˆæ•´ä¸ªçŠ¶æ€åºåˆ—çš„é‡‡æ ·ï¼Œå¹¶æŠŠå½“å‰çŠ¶æ€çº³å…¥åˆ°æœç´¢æ ‘ä¸­ã€‚é»˜è®¤ç­–ç•¥å¯ä»¥ä½¿éšæœºç­–ç•¥æˆ–åŸºäºç›®æ ‡ä»·å€¼å‡½æ•°çš„ç­–ç•¥ã€‚</p>
<p>è¿™é‡Œè®²åˆ°çš„æ˜¯æœ€ç»å…¸çš„å¼ºåŒ–å­¦ä¹ ç»ˆMCTSçš„ç”¨æˆ·ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰å»¶æ—¶å¥–åŠ±ï¼Œä½†æ˜¯åœ¨æ£‹ç±»ä¹‹ç±»çš„é›¶å’Œé—®é¢˜ä¸­ï¼Œä¸­é—´çŠ¶æ€æ˜¯æ²¡æœ‰æ˜ç¡®å¥–åŠ±çš„ï¼Œæˆ‘ä»¬åªæœ‰åœ¨æ£‹ä¸‹å®ŒåçŸ¥é“è¾“èµ¢äº†æ‰èƒ½å¯¹å‰é¢çš„åŠ¨ä½œè¿›è¡ŒçŠ¶æ€å¥–åŠ±ï¼Œå¯¹äºè¿™ç±»é—®é¢˜æˆ‘ä»¬çš„MCTSéœ€è¦åšä¸€äº›ç»“æ„ä¸Šçš„ç»†åŒ–ã€‚</p>
<h1 id="4-ä¸Šé™ç½®ä¿¡åŒºé—´ç®—æ³•uct">4. ä¸Šé™ç½®ä¿¡åŒºé—´ç®—æ³•UCT</h1>
<p>åœ¨è®¨è®ºæ£‹ç±»æ¸¸æˆçš„MCTSæœç´¢ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç†Ÿæ‚‰ä¸‹ä¸Šé™ç½®ä¿¡åŒºé—´ç®—æ³•(Upper Confidence Bound Applied to Trees, ä»¥ä¸‹ç®€ç§°UCT)ã€‚å®ƒæ˜¯ä¸€ç§ç­–ç•¥ç®—æ³•ï¼Œæˆ‘ä»¬ä¹‹å‰æœ€å¸¸ç”¨çš„æ˜¯ $Ïµâˆ’$è´ªå©ªç­–ç•¥ã€‚ä½†æ˜¯åœ¨æ£‹ç±»é—®é¢˜ä¸­ï¼ŒUCTæ›´å¸¸ä½¿ç”¨ã€‚</p>
<p>åœ¨æ£‹ç±»æ¸¸æˆä¸­ï¼Œç»å¸¸æœ‰è¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬å‘ç°åœ¨æŸç§æ£‹çš„çŠ¶æ€ä¸‹ï¼Œæœ‰2ä¸ªå¯é€‰åŠ¨ä½œï¼Œç¬¬ä¸€ä¸ªåŠ¨ä½œå†å²æ£‹å±€ä¸­æ˜¯0èƒœ1è´Ÿï¼Œç¬¬äºŒä¸ªåŠ¨ä½œå†å²æ£‹å±€ä¸­æ˜¯8èƒœ10è´Ÿï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥é€‰æ‹©å“ªä¸ªåŠ¨ä½œå¥½å‘¢ï¼Ÿå¦‚æœæŒ‰ $Ïµâˆ’$è´ªå©ªç­–ç•¥ï¼Œåˆ™ç¬¬äºŒä¸ªåŠ¨ä½œéå¸¸å®¹æ˜“è¢«é€‰æ‹©åˆ°ã€‚ä½†æ˜¯å…¶å®è™½ç„¶ç¬¬ä¸€ä¸ªåŠ¨ä½œèƒœåˆ©0%ï¼Œä½†æ˜¯å¾ˆå¯èƒ½æ˜¯å› ä¸ºè¿™ä¸ªåŠ¨ä½œçš„å†å²æ£‹å±€å°‘ï¼Œæ•°æ®ä¸å¤Ÿå¯¼è‡´çš„ï¼Œå¾ˆå¯èƒ½è¯¥åŠ¨ä½œä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„åŠ¨ä½œã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åœ¨æœ€ä¼˜ç­–ç•¥å’Œæ¢ç´¢åº¦è¾¾åˆ°ä¸€ä¸ªé€‰æ‹©å¹³è¡¡å‘¢ï¼Ÿ $Ïµâˆ’$è´ªå©ªç­–ç•¥å¯ä»¥ç”¨ï¼Œä½†æ˜¯UCTæ˜¯ä¸€ä¸ªæ›´ä¸é”™çš„é€‰æ‹©ã€‚</p>
<p>UCTé¦–å…ˆè®¡ç®—æ¯ä¸€ä¸ªå¯é€‰åŠ¨ä½œèŠ‚ç‚¹å¯¹åº”çš„åˆ†æ•°ï¼Œè¿™ä¸ªåˆ†æ•°è€ƒè™‘äº†å†å²æœ€ä¼˜ç­–ç•¥å’Œæ¢ç´¢åº¦å—ï¼Œä¸€ä¸ªå¸¸ç”¨çš„å…¬å¼å¦‚ä¸‹ï¼š</p>
<p>$$\text{score}=\left.\frac{w_i}{n_i}+c\sqrt{\frac{\ln N_i}{n_i}}\right.$$</p>
<p>å…¶ä¸­ï¼Œ$w_i$ æ˜¯ i èŠ‚ç‚¹çš„èƒœåˆ©æ¬¡æ•°ï¼Œ$n_i$ æ˜¯ièŠ‚ç‚¹çš„æ¨¡æ‹Ÿæ¬¡æ•°ï¼Œ$N_i$ æ˜¯æ‰€æœ‰æ¨¡æ‹Ÿæ¬¡æ•°ï¼Œc æ˜¯æ¢ç´¢å¸¸æ•°ï¼Œç†è®ºå€¼ä¸º$âˆš2$ï¼Œå¯æ ¹æ®ç»éªŒè°ƒæ•´ï¼Œ$c$ è¶Šå¤§å°±è¶Šåå‘äºå¹¿åº¦æœç´¢ï¼Œ$c$ è¶Šå°å°±è¶Šåå‘äºæ·±åº¦æœç´¢ã€‚æœ€åæˆ‘ä»¬é€‰æ‹©åˆ†æ•°æœ€é«˜çš„åŠ¨ä½œèŠ‚ç‚¹ã€‚</p>
<p>æ¯”å¦‚å¯¹äºä¸‹é¢çš„æ£‹å±€ï¼Œå¯¹äºæ ¹èŠ‚ç‚¹æ¥è¯´ï¼Œæœ‰3ä¸ªé€‰æ‹©ï¼Œç¬¬ä¸€ä¸ªé€‰æ‹©7èƒœ3è´Ÿï¼Œç¬¬äºŒä¸ªé€‰æ‹©5èƒœ3è´Ÿï¼Œç¬¬ä¸‰ä¸ªé€‰æ‹©0èƒœ3è´Ÿã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å–c=10,åˆ™ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ†æ•°ä¸ºï¼š$$score(7,10)=7/10+C\cdot\sqrt{\frac{\log(21)}{10}}\approx6.2$$</p>
<p>ç¬¬äºŒä¸ªèŠ‚ç‚¹çš„åˆ†æ•°ä¸ºï¼š$$score(5,8)=5/8+C\cdot\sqrt{\frac{\log(21)}8}\approx6.8$$</p>
<p>ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹çš„åˆ†æ•°ä¸ºï¼š$$score(0,3)=0/3+C\cdot\sqrt{\frac{\log(21)}3}\approx10$$</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;"></div>
</center>
<br>
<p>å¯è§ï¼Œç”±äºæˆ‘ä»¬æŠŠæ¢ç´¢ç‡ $c$ è®¾ç½®çš„æ¯”è¾ƒå¤§ï¼Œç¬¬ä¸‰ä¸ªèŠ‚ç‚¹æ˜¯è¢«UCTé€‰ä¸­è¦æ‰§è¡Œçš„åŠ¨ä½œèŠ‚ç‚¹ã€‚å½“ç„¶å¦‚æœæˆ‘ä»¬æŠŠcè®¾ç½®çš„æ¯”è¾ƒå°çš„è¯ï¼Œç¬¬ä¸€ä¸ªæˆ–è€…ç¬¬äºŒä¸ªå¯èƒ½å°±å˜æˆæœ€å¤§çš„åˆ†æ•°äº†ã€‚</p>
<h1 id="5-æ£‹ç±»æ¸¸æˆmctsæœç´¢">5. æ£‹ç±»æ¸¸æˆMCTSæœç´¢</h1>
<p>åœ¨åƒä¸­å›½è±¡æ£‹ï¼Œå›´æ£‹è¿™æ ·çš„é›¶å’Œé—®é¢˜ä¸­ï¼Œä¸€ä¸ªåŠ¨ä½œåªæœ‰åœ¨æ£‹å±€ç»“æŸæ‰èƒ½æ‹¿åˆ°çœŸæ­£çš„å¥–åŠ±ï¼Œå› æ­¤æˆ‘ä»¬å¯¹MCTSçš„æœç´¢æ­¥éª¤å’Œæ ‘ç»“æ„ä¸Šéœ€è¦æ ¹æ®é—®é¢˜çš„ä¸åŒåšä¸€äº›ç»†åŒ–ã€‚</p>
<p>å¯¹äºMCTSçš„æ ‘ç»“æ„ï¼Œå¦‚æœæ˜¯æœ€ç®€å•çš„æ–¹æ³•ï¼Œåªéœ€è¦åœ¨èŠ‚ç‚¹ä¸Šä¿å­˜çŠ¶æ€å¯¹åº”çš„å†å²èƒœè´Ÿè®°å½•ã€‚åœ¨æ¯æ¡è¾¹ä¸Šä¿å­˜é‡‡æ ·çš„åŠ¨ä½œã€‚è¿™æ ·MCTSçš„æœç´¢éœ€è¦èµ°4æ­¥ï¼Œå¦‚ä¸‹å›¾(å›¾æ¥è‡ªç»´åŸºç™¾ç§‘)ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">BP Network</div>
</center>
<br>
<p>ç¬¬ä¸€æ­¥æ˜¯é€‰æ‹©(Selection):è¿™ä¸€æ­¥ä¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ¯æ¬¡éƒ½é€‰ä¸€ä¸ªâ€œæœ€å€¼å¾—æœç´¢çš„å­èŠ‚ç‚¹â€ï¼Œä¸€èˆ¬ä½¿ç”¨UCTé€‰æ‹©åˆ†æ•°æœ€é«˜çš„èŠ‚ç‚¹ï¼Œç›´åˆ°æ¥åˆ°ä¸€ä¸ªâ€œå­˜åœ¨æœªæ‰©å±•çš„å­èŠ‚ç‚¹â€çš„èŠ‚ç‚¹ï¼Œå¦‚å›¾ä¸­çš„ 3/3 èŠ‚ç‚¹ã€‚ä¹‹æ‰€ä»¥å«åšâ€œå­˜åœ¨æœªæ‰©å±•çš„å­èŠ‚ç‚¹â€ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªå±€é¢å­˜åœ¨æœªèµ°è¿‡çš„åç»­ç€æ³•ï¼Œä¹Ÿå°±æ˜¯MCTSä¸­æ²¡æœ‰åç»­çš„åŠ¨ä½œå¯ä»¥å‚è€ƒäº†ã€‚è¿™æ—¶æˆ‘ä»¬è¿›å…¥ç¬¬äºŒæ­¥ã€‚</p>
<p>ç¬¬äºŒæ­¥æ˜¯æ‰©å±•(Expansion)ï¼Œåœ¨è¿™ä¸ªæœç´¢åˆ°çš„å­˜åœ¨æœªæ‰©å±•çš„å­èŠ‚ç‚¹ï¼ŒåŠ ä¸Šä¸€ä¸ª0/0çš„å­èŠ‚ç‚¹ï¼Œè¡¨ç¤ºæ²¡æœ‰å†å²è®°å½•å‚è€ƒã€‚è¿™æ—¶æˆ‘ä»¬è¿›å…¥ç¬¬ä¸‰æ­¥ã€‚</p>
<p>ç¬¬ä¸‰æ­¥æ˜¯ä»¿çœŸ(simulation)ï¼Œä»ä¸Šé¢è¿™ä¸ªæ²¡æœ‰è¯•è¿‡çš„ç€æ³•å¼€å§‹ï¼Œç”¨ä¸€ä¸ªç®€å•ç­–ç•¥æ¯”å¦‚å¿«é€Ÿèµ°å­ç­–ç•¥ï¼ˆRollout policyï¼‰èµ°åˆ°åº•ï¼Œå¾—åˆ°ä¸€ä¸ªèƒœè´Ÿç»“æœã€‚å¿«é€Ÿèµ°å­ç­–ç•¥ä¸€èˆ¬é€‚åˆé€‰æ‹©èµ°å­å¾ˆå¿«å¯èƒ½ä¸æ˜¯å¾ˆç²¾ç¡®çš„ç­–ç•¥ã€‚å› ä¸ºå¦‚æœè¿™ä¸ªç­–ç•¥èµ°å¾—æ…¢ï¼Œç»“æœè™½ç„¶ä¼šæ›´å‡†ç¡®ï¼Œä½†ç”±äºè€—æ—¶å¤šäº†ï¼Œåœ¨å•ä½æ—¶é—´å†…çš„æ¨¡æ‹Ÿæ¬¡æ•°å°±å°‘äº†ï¼Œæ‰€ä»¥ä¸ä¸€å®šä¼šæ£‹åŠ›æ›´å¼ºï¼Œæœ‰å¯èƒ½ä¼šæ›´å¼±ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸€èˆ¬åªæ¨¡æ‹Ÿä¸€æ¬¡ï¼Œå› ä¸ºå¦‚æœæ¨¡æ‹Ÿå¤šæ¬¡ï¼Œè™½ç„¶æ›´å‡†ç¡®ï¼Œä½†æ›´æ…¢ã€‚</p>
<p>ç¬¬å››æ­¥æ˜¯å›æº¯(backpropagation), å°†æˆ‘ä»¬æœ€åå¾—åˆ°çš„èƒœè´Ÿç»“æœå›æº¯åŠ åˆ°MCTSæ ‘ç»“æ„ä¸Šã€‚æ³¨æ„é™¤äº†ä¹‹å‰çš„MCTSæ ‘è¦å›æº¯å¤–ï¼Œæ–°åŠ å…¥çš„èŠ‚ç‚¹ä¹Ÿè¦åŠ ä¸Šä¸€æ¬¡èƒœè´Ÿå†å²è®°å½•ï¼Œå¦‚ä¸Šå›¾æœ€å³è¾¹æ‰€ç¤ºã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯MCTSæœç´¢çš„æ•´ä¸ªè¿‡ç¨‹ã€‚è¿™4æ­¥ä¸€èˆ¬æ˜¯é€šç”¨çš„ï¼Œä½†æ˜¯MCTSæ ‘ç»“æ„ä¸Šä¿å­˜çš„å†…å®¹è€Œä¸€èˆ¬æ ¹æ®è¦è§£å†³çš„é—®é¢˜å’Œå»ºæ¨¡çš„å¤æ‚åº¦è€Œä¸åŒã€‚</p>
<h1 id="6-mctså°ç»“">6. MCTSå°ç»“</h1>
<p>MCTSé€šè¿‡é‡‡æ ·å»ºç«‹MCTSæœç´¢æ ‘ï¼Œå¹¶åŸºäº4å¤§æ­¥éª¤é€‰æ‹©ï¼Œæ‰©å±•ï¼Œä»¿çœŸå’Œå›æº¯æ¥æŒç»­ä¼˜åŒ–æ ‘å†…çš„ç­–ç•¥ï¼Œè¿›è€Œå¯ä»¥å¸®åŠ©å¯¹çŠ¶æ€ä¸‹çš„åŠ¨ä½œè¿›è¡Œé€‰æ‹©ï¼Œéå¸¸é€‚åˆçŠ¶æ€æ•°ï¼ŒåŠ¨ä½œæ•°æµ·é‡çš„å¼ºåŒ–å­¦ä¹ é—®é¢˜ã€‚æ¯”å¦‚AlphaGoå’ŒAlphaGo Zeroéƒ½é‡åº¦ä½¿ç”¨äº†MCTSæœç´¢ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€ç¯‡è®¨è®ºAlphaGo Zeroå¦‚ä½•ç»“åˆMCTSå’Œç¥ç»ç½‘ç»œæ¥æ±‚è§£å›´æ£‹å¼ºåŒ–å­¦ä¹ é—®é¢˜ã€‚</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [17] | åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ä¸Dynaç®—æ³•æ¡†æ¶</title><link>https://jianye0428.github.io/posts/rl_learning_note_17/</link><pubDate>Sun, 25 Feb 2024 19:53:15 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_17/</guid><description><![CDATA[<h1 id="å¼ºåŒ–å­¦ä¹ åä¸ƒ-åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ä¸dynaç®—æ³•æ¡†æ¶httpswwwcnblogscompinardp10384424html"><a href="https://www.cnblogs.com/pinard/p/10384424.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åä¸ƒ) åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ä¸Dynaç®—æ³•æ¡†æ¶<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></h1>
<p>åœ¨å‰é¢æˆ‘ä»¬è®¨è®ºäº†åŸºäºä»·å€¼çš„å¼ºåŒ–å­¦ä¹ (Value Based RL)å’ŒåŸºäºç­–ç•¥çš„å¼ºåŒ–å­¦ä¹ æ¨¡å‹(Policy Based RL)ï¼Œæœ¬ç¯‡æˆ‘ä»¬è®¨è®ºæœ€åä¸€ç§å¼ºåŒ–å­¦ä¹ æµæ´¾ï¼ŒåŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ (Model Based RL)ï¼Œä»¥åŠåŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•æ¡†æ¶Dynaã€‚</p>
<p>æœ¬ç¯‡ä¸»è¦å‚è€ƒäº†UCLå¼ºåŒ–å­¦ä¹ è¯¾ç¨‹çš„ç¬¬8è®²å’ŒDyna-2çš„<a href="https://www.davidsilver.uk/wp-content/uploads/2020/03/dyna2_compressed.pdf"target="_blank" rel="external nofollow noopener noreferrer">è®ºæ–‡<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚</p>
<h1 id="1-åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®€ä»‹">1. åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®€ä»‹</h1>
<p>åŸºäºä»·å€¼çš„å¼ºåŒ–å­¦ä¹ æ¨¡å‹å’ŒåŸºäºç­–ç•¥çš„å¼ºåŒ–å­¦ä¹ æ¨¡å‹éƒ½ä¸æ˜¯åŸºäºæ¨¡å‹çš„ï¼Œå®ƒä»¬ä»ä»·å€¼å‡½æ•°ï¼Œç­–ç•¥å‡½æ•°ä¸­ç›´æ¥å»å­¦ä¹ ï¼Œä¸ç”¨å­¦ä¹ ç¯å¢ƒçš„çŠ¶æ€è½¬åŒ–æ¦‚ç‡æ¨¡å‹ï¼Œå³åœ¨çŠ¶æ€ $s$ ä¸‹é‡‡å–åŠ¨ä½œ $a$,è½¬åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ $s&rsquo;$ çš„æ¦‚ç‡ $P^a_{ss&rsquo;}$ã€‚</p>
<p>è€ŒåŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ åˆ™ä¼šå°è¯•ä»ç¯å¢ƒçš„æ¨¡å‹å»å­¦ä¹ ï¼Œä¸€èˆ¬æ˜¯ä¸‹é¢ä¸¤ä¸ªç›¸äº’ç‹¬ç«‹çš„æ¨¡å‹ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ˜¯çŠ¶æ€è½¬åŒ–é¢„æµ‹æ¨¡å‹ï¼Œè¾“å…¥å½“å‰çŠ¶æ€ $s$å’ŒåŠ¨ä½œ $a$ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªçŠ¶æ€ $s&rsquo;$ã€‚</li>
<li>å¦ä¸€ä¸ªæ˜¯å¥–åŠ±é¢„æµ‹æ¨¡å‹ï¼Œè¾“å…¥å½“å‰çŠ¶æ€ $s$å’ŒåŠ¨ä½œ $a$ï¼Œé¢„æµ‹ç¯å¢ƒçš„å¥–åŠ± $r$ã€‚</li>
</ul>
<p>å³æ¨¡å‹å¯ä»¥æè¿°ä¸ºä¸‹é¢ä¸¤ä¸ªå¼å­ï¼š</p>
<p>$$\begin{gathered}S_{t+1}\sim P(S_{t+1}|S_t,A_t)\\R_{t+1}\sim R(R_{t+1}|S_t,A_t)\end{gathered}$$</p>
<p>å¦‚æœæ¨¡å‹ $P$, $R$ å¯ä»¥å‡†ç¡®çš„æè¿°çœŸæ­£çš„ç¯å¢ƒçš„è½¬åŒ–æ¨¡å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åŸºäºæ¨¡å‹æ¥é¢„æµ‹ï¼Œå½“æœ‰ä¸€ä¸ªæ–°çš„çŠ¶æ€ $S$ å’ŒåŠ¨ä½œ $A$åˆ°æ¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åŸºäºæ¨¡å‹é¢„æµ‹å¾—åˆ°æ–°çš„çŠ¶æ€å’ŒåŠ¨ä½œå¥–åŠ±ï¼Œä¸éœ€è¦å’Œç¯å¢ƒäº¤äº’ã€‚å½“ç„¶å¦‚æœæˆ‘ä»¬çš„æ¨¡å‹ä¸å¥½ï¼Œé‚£ä¹ˆåŸºäºæ¨¡å‹é¢„æµ‹çš„æ–°çŠ¶æ€å’ŒåŠ¨ä½œå¥–åŠ±å¯èƒ½é”™çš„ç¦»è°±ã€‚</p>
<p>ä»ä¸Šé¢çš„æè¿°æˆ‘ä»¬å¯ä»¥çœ‹å‡ºåŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ å’Œä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ çš„ä¸»è¦åŒºåˆ«ï¼šå³åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ˜¯ä»æ¨¡å‹ä¸­å­¦ä¹ ï¼Œè€Œä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ˜¯ä»å’Œç¯å¢ƒäº¤äº’çš„ç»å†å»å­¦ä¹ ã€‚</p>
<p>ä¸‹é¢è¿™å¼ å›¾æè¿°äº†åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ çš„æ€è·¯ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">Model-based RL</div>
</center>
<br>
<h1 id="2-åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•è®­ç»ƒæµç¨‹">2. åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•è®­ç»ƒæµç¨‹</h1>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹çœ‹åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•è®­ç»ƒæµç¨‹ï¼Œå…¶æµç¨‹å’Œæˆ‘ä»¬ç›‘ç£å­¦ä¹ ç®—æ³•æ˜¯éå¸¸ç±»ä¼¼çš„ã€‚</p>
<p>å‡è®¾è®­ç»ƒæ•°æ®æ˜¯è‹¥å¹²ç»„è¿™æ ·çš„ç»å†ï¼š</p>
<p>$$S_1,A_1,R_2,S_2,A_2,R_2,\ldots,S_T$$</p>
<p>å¯¹äºæ¯ç»„ç»å†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è½¬åŒ–ä¸º $Tâˆ’1$ ç»„è®­ç»ƒæ ·æœ¬ï¼Œå³ï¼š</p>
<p>$$\begin{gathered}
S_1,A_1\to S_2,S_1,A_1\to R_2 \\
S_2,A_2\to S_3,S_2,A_2\to R_3 \\
&hellip;&hellip; \\
S_{T-1},A_{T-1}\rightarrow S_T,~S_{T_1},A_{T-1}\rightarrow R_T
\end{gathered}$$</p>
<p>å³è¾¹çš„è®­ç»ƒæ ·æœ¬ä¸€èµ·ç»„æˆäº†ä¸€ä¸ªåˆ†ç±»æ¨¡å‹æˆ–å¯†åº¦ä¼°è®¡æ¨¡å‹ï¼Œè¾“å…¥çŠ¶æ€å’ŒåŠ¨ä½œï¼Œè¾“å‡ºä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚ å³è¾¹çš„è®­ç»ƒæ ·æœ¬ä¸€èµ·ç»„æˆäº†ä¸€ä¸ªå›å½’æ¨¡å‹è®­ç»ƒé›†ï¼Œè¾“å…¥çŠ¶æ€å’ŒåŠ¨ä½œï¼Œè¾“å‡ºåŠ¨ä½œå¥–åŠ±å€¼ã€‚</p>
<p>è‡³æ­¤æˆ‘ä»¬çš„å¼ºåŒ–å­¦ä¹ æ±‚è§£è¿‡ç¨‹å’Œä¼ ç»Ÿçš„ç›‘ç£å­¦ä¹ ç®—æ³•æ²¡æœ‰å¤ªå¤šåŒºåˆ«äº†ï¼Œå¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„ç›‘ç£å­¦ä¹ ç®—æ³•æ¥æ±‚è§£è¿™ä¸¤ä¸ªæ¨¡å‹ã€‚</p>
<p>å½“ç„¶è¿˜å¯ä»¥æ›´ç®€å•ï¼Œå³é€šè¿‡å¯¹è®­ç»ƒæ ·æœ¬è¿›è¡ŒæŸ¥è¡¨æ³•è¿›è¡Œç»Ÿè®¡ï¼Œç›´æ¥å¾—åˆ° $P(S_{t+1}|S_t,A_t)$ çš„æ¦‚ç‡å’Œ $R(R_{t+1}|S_t,A_t)$ çš„å¹³å‡å€¼ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥é¢„æµ‹ã€‚æ¯”ä½¿ç”¨æ¨¡å‹æ›´ç®€å•ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•å¯ä»¥ç”¨æ¥å¾—åˆ° $P(S_{t+1}|S_t,A_t)$å’Œ $R(R_{t+1}|S_t,A_t)$ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢å†è®²ã€‚</p>
<p>è™½ç„¶åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ€è·¯å¾ˆæ¸…æ™°ï¼Œè€Œä¸”è¿˜æœ‰ä¸è¦å’Œç¯å¢ƒæŒç»­äº¤äº’ä¼˜åŒ–çš„ä¼˜ç‚¹ï¼Œä½†æ˜¯ç”¨äºå®é™…äº§å“è¿˜æ˜¯æœ‰å¾ˆå¤šå·®è·çš„ã€‚ä¸»è¦æ˜¯æˆ‘ä»¬çš„æ¨¡å‹ç»å¤§å¤šæ•°æ—¶å€™ä¸èƒ½å‡†ç¡®çš„æè¿°çœŸæ­£çš„ç¯å¢ƒçš„è½¬åŒ–æ¨¡å‹ï¼Œé‚£ä¹ˆä½¿ç”¨åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•å¾—åˆ°çš„è§£å¤§å¤šæ•°æ—¶å€™ä¹Ÿä¸æ˜¯å¾ˆå®ç”¨ã€‚é‚£ä¹ˆæ˜¯ä¸æ˜¯åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ å°±ä¸èƒ½ç”¨äº†å‘¢ï¼Ÿä¹Ÿä¸æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ å’Œä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ é›†åˆèµ·æ¥ï¼Œå–é•¿è¡¥çŸ­ï¼Œè¿™æ ·åšæœ€å¸¸è§çš„å°±æ˜¯Dynaç®—æ³•æ¡†æ¶ã€‚</p>
<h1 id="3-dynaç®—æ³•æ¡†æ¶">3. Dynaç®—æ³•æ¡†æ¶</h1>
<p>Dynaç®—æ³•æ¡†æ¶å¹¶ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼Œè€Œæ˜¯ä¸€ç±»ç®—æ³•æ¡†æ¶çš„æ€»ç§°ã€‚Dynaå°†åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ å’Œä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ é›†åˆèµ·æ¥ï¼Œæ—¢ä»æ¨¡å‹ä¸­å­¦ä¹ ï¼Œä¹Ÿä»å’Œç¯å¢ƒäº¤äº’çš„ç»å†å»å­¦ä¹ ï¼Œä»è€Œæ›´æ–°ä»·å€¼å‡½æ•°å’Œï¼ˆæˆ–ï¼‰ç­–ç•¥å‡½æ•°ã€‚å¦‚æœç”¨å’Œç¬¬ä¸€èŠ‚ç±»ä¼¼çš„å›¾ï¼Œå¯ä»¥è¡¨ç¤ºå¦‚ä¸‹å›¾ï¼Œå’Œç¬¬ä¸€èŠ‚çš„å›¾ç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ªâ€œDirect RLâ€œçš„ç®­å¤´ï¼Œè¿™æ­£æ˜¯ä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ çš„æ€è·¯ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">Dynaç®—æ³•ç¤ºæ„å›¾</div>
</center>
<br>
<p>Dynaç®—æ³•æ¡†æ¶å’Œä¸åŒçš„å…·ä½“çš„ä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ä¸€èµ·ï¼Œå¯ä»¥å¾—åˆ°å…·ä½“çš„ä¸åŒç®—æ³•ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨åŸºäºä»·å€¼å‡½æ•°çš„Q-Learningï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—åˆ°äº†Dyna-Qç®—æ³•ã€‚æˆ‘ä»¬åŸºäºDyna-Qæ¥çœ‹çœ‹Dynaç®—æ³•æ¡†æ¶çš„ä¸€èˆ¬æµç¨‹.</p>
<h1 id="4-dyna-qç®—æ³•æµç¨‹">4. Dyna-Qç®—æ³•æµç¨‹</h1>
<p>è¿™é‡Œæˆ‘ä»¬ç»™å‡ºåŸºäºä»·å€¼å‡½æ•°çš„Dyna-Qç®—æ³•çš„æ¦‚è¦æµç¨‹ã€‚å‡è®¾æ¨¡å‹ä½¿ç”¨çš„æ˜¯æŸ¥è¡¨æ³•ã€‚</p>
<ul>
<li>(1). åˆå§‹åŒ–ä»»æ„ä¸€ä¸ªçŠ¶æ€ $s$,å’Œä»»æ„ä¸€ä¸ªåŠ¨ä½œ $a$ å¯¹åº”çš„çŠ¶æ€ä»·å€¼ $Q(s,a)$, åˆå§‹åŒ–å¥–åŠ±æ¨¡å‹ $R(s,a)$å’ŒçŠ¶æ€æ¨¡å‹ $P(s,a)$</li>
<li>(2). for $i=1$ to æœ€å¤§è¿­ä»£æ¬¡æ•°Tï¼š
<ul>
<li>(a) $S \leftarrow \text{current state}$</li>
<li>(b) $A \leftarrow \text{Ïµâˆ’greedy(S,Q)}$</li>
<li>(c) æ‰§è¡ŒåŠ¨ä½œ $A$,å¾—åˆ°æ–°çŠ¶æ€ $S&rsquo;$ å’Œå¥–åŠ± $R$</li>
<li>(d) ä½¿ç”¨Q-Learningæ›´æ–°ä»·å€¼å‡½æ•°ï¼š$Q(S,A)=Q(S,A)+\alpha[R+\gamma\max_aQ(S^{\prime},a)-Q(S,A)]$</li>
<li>(e) ä½¿ç”¨ $S,A,S^{\prime}$ æ›´æ–°çŠ¶æ€æ¨¡å‹ $P(s,a)$ï¼Œä½¿ç”¨ $S,A,R$ æ›´æ–°çŠ¶æ€æ¨¡å‹ $R(s,a)$</li>
<li>(f) $\text{for} \space \space j=1 \space \space \text{to} \text{æœ€å¤§æ¬¡æ•°}n$ï¼š
<ul>
<li>(i) éšæœºé€‰æ‹©ä¸€ä¸ªä¹‹å‰å‡ºç°è¿‡çš„çŠ¶æ€ $S$ , åœ¨çŠ¶æ€ $S$ ä¸Šå‡ºç°è¿‡çš„åŠ¨ä½œä¸­éšæœºé€‰æ‹©ä¸€ä¸ªåŠ¨ä½œ $A$</li>
<li>(ii) åŸºäºæ¨¡å‹ $P(S,A)$ å¾—åˆ° $S&rsquo;$, åŸºäºæ¨¡å‹ $R(S,A)$ å¾—åˆ° $R$</li>
<li>(iii) ä½¿ç”¨Q-Learningæ›´æ–°ä»·å€¼å‡½æ•°: $Q(S,A)=Q(S,A)+\alpha[R+\gamma\max_aQ(S^{\prime},a)-Q(S,A)]$</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ä»ä¸Šé¢çš„æµç¨‹å¯ä»¥çœ‹å‡ºï¼ŒDynaæ¡†æ¶åœ¨æ¯ä¸ªè¿­ä»£è½®ä¸­ï¼Œä¼šå…ˆå’Œç¯å¢ƒäº¤äº’ï¼Œå¹¶æ›´æ–°ä»·å€¼å‡½æ•°å’Œï¼ˆæˆ–ï¼‰ç­–ç•¥å‡½æ•°ï¼Œæ¥ç€è¿›è¡Œnæ¬¡æ¨¡å‹çš„é¢„æµ‹ï¼ŒåŒæ ·æ›´æ–°ä»·å€¼å‡½æ•°å’Œï¼ˆæˆ–ï¼‰ç­–ç•¥å‡½æ•°ã€‚è¿™æ ·åŒæ—¶åˆ©ç”¨ä¸Šäº†å’Œç¯å¢ƒäº¤äº’çš„ç»å†ä»¥åŠæ¨¡å‹çš„é¢„æµ‹ã€‚</p>
<h1 id="5-dyna-2ç®—æ³•æ¡†æ¶">5. Dyna-2ç®—æ³•æ¡†æ¶</h1>
<p>åœ¨Dynaç®—æ³•æ¡†æ¶çš„åŸºç¡€ä¸Šåæ¥åˆå‘å±•å‡ºäº†Dyna-2ç®—æ³•æ¡†æ¶ã€‚å’ŒDynaç›¸æ¯”ï¼ŒDyna-2å°†å’Œå’Œç¯å¢ƒäº¤äº’çš„ç»å†ä»¥åŠæ¨¡å‹çš„é¢„æµ‹è¿™ä¸¤éƒ¨åˆ†ä½¿ç”¨è¿›è¡Œäº†åˆ†ç¦»ã€‚è¿˜æ˜¯ä»¥Qå‡½æ•°ä¸ºä¾‹ï¼ŒDyna-2å°†è®°å¿†åˆ†ä¸º<strong>æ°¸ä¹…æ€§è®°å¿†</strong>ï¼ˆpermanent memoryï¼‰å’Œ<strong>ç¬æ—¶è®°å¿†</strong>ï¼ˆtransient memoryï¼‰, å…¶ä¸­æ°¸ä¹…æ€§è®°å¿†åˆ©ç”¨å®é™…çš„ç»éªŒæ¥æ›´æ–°ï¼Œç¬æ—¶è®°å¿†åˆ©ç”¨æ¨¡å‹æ¨¡æ‹Ÿç»éªŒæ¥æ›´æ–°ã€‚</p>
<p>æ°¸ä¹…æ€§è®°å¿†çš„Qå‡½æ•°å®šä¹‰ä¸ºï¼š</p>
<p>$$Q(S,A)=\phi(S,A)^T\theta $$</p>
<p>ç¬æ—¶è®°å¿†çš„Qå‡½æ•°å®šä¹‰ä¸ºï¼š</p>
<p>$$Q^{\prime}(S,A)=\overline{\phi}(S,A)^T\overline{\theta}$$</p>
<p>ç»„åˆèµ·æ¥åè®°å¿†çš„Qå‡½æ•°å®šä¹‰ä¸ºï¼š</p>
<p>$$\overline{Q}(S,A)=\phi(S,A)^T\theta+\overline{\phi}(S,A)^T\overline{\theta}$$</p>
<p>Dyna-2çš„åŸºæœ¬æ€æƒ³æ˜¯åœ¨é€‰æ‹©å®é™…çš„æ‰§è¡ŒåŠ¨ä½œå‰ï¼Œæ™ºèƒ½ä½“å…ˆæ‰§è¡Œä¸€éä»å½“å‰çŠ¶æ€å¼€å§‹çš„åŸºäºæ¨¡å‹çš„æ¨¡æ‹Ÿï¼Œè¯¥æ¨¡æ‹Ÿå°†ä»¿çœŸå®Œæ•´çš„è½¨è¿¹ï¼Œä»¥ä¾¿è¯„ä¼°å½“å‰çš„åŠ¨ä½œå€¼å‡½æ•°ã€‚æ™ºèƒ½ä½“ä¼šæ ¹æ®æ¨¡æ‹Ÿå¾—åˆ°çš„åŠ¨ä½œå€¼å‡½æ•°åŠ ä¸Šå®é™…ç»éªŒå¾—åˆ°çš„å€¼å‡½æ•°å…±åŒé€‰æ‹©å®é™…è¦æ‰§è¡Œçš„åŠ¨ä½œã€‚ä»·å€¼å‡½æ•°çš„æ›´æ–°æ–¹å¼ç±»ä¼¼äº $SARSA(Î»)$</p>
<p>ä»¥ä¸‹æ˜¯Dyna-2çš„ç®—æ³•æµç¨‹ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">Dyna-2 ç®—æ³•æµç¨‹</div>
</center>
<br>
<h1 id="6-åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ€»ç»“">6. åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ€»ç»“</h1>
<p>åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ä¸€èˆ¬ä¸å•ç‹¬ä½¿ç”¨ï¼Œè€Œæ˜¯å’Œä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç»“åˆèµ·æ¥ï¼Œå› æ­¤ä½¿ç”¨Dynaç®—æ³•æ¡†æ¶æ˜¯å¸¸ç”¨çš„åšæ³•ã€‚å¯¹äºæ¨¡å‹éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æŸ¥è¡¨æ³•å’Œç›‘ç£å­¦ä¹ æ³•ç­‰æ–¹æ³•ï¼Œé¢„æµ‹æˆ–è€…é‡‡æ ·å¾—åˆ°æ¨¡æ‹Ÿçš„ç»å†ã€‚è€Œå¯¹äºéæ¨¡å‹éƒ¨åˆ†ï¼Œä½¿ç”¨å‰é¢çš„Q-Learningç³»åˆ—çš„ä»·å€¼å‡½æ•°è¿‘ä¼¼ï¼Œæˆ–è€…åŸºäºActor-Criticçš„ç­–ç•¥å‡½æ•°çš„è¿‘ä¼¼éƒ½æ˜¯å¯ä»¥çš„ã€‚</p>
<p>é™¤äº†Dynaç®—æ³•æ¡†æ¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨åŸºäºæ¨¡æ‹Ÿçš„æœç´¢(simulation-based search)æ¥ç»“åˆåŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ å’Œä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ,å¹¶æ±‚è§£é—®é¢˜ã€‚è¿™éƒ¨åˆ†æˆ‘ä»¬åœ¨åé¢å†è®¨è®ºã€‚</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [16] | æ·±åº¦ç¡®å®šæ€§ç­–ç•¥æ¢¯åº¦(DDPG)</title><link>https://jianye0428.github.io/posts/rl_learning_note_16/</link><pubDate>Sun, 25 Feb 2024 19:53:12 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_16/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/10334127.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åäº”) A3C<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä½¿ç”¨å¤šçº¿ç¨‹çš„æ–¹æ³•æ¥è§£å†³Actor-Criticéš¾æ”¶æ•›çš„é—®é¢˜ï¼Œä»Šå¤©æˆ‘ä»¬ä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œè€Œæ˜¯ä½¿ç”¨å’ŒDDQNç±»ä¼¼çš„æ–¹æ³•ï¼šå³ç»éªŒå›æ”¾å’ŒåŒç½‘ç»œçš„æ–¹æ³•æ¥æ”¹è¿›Actor-Criticéš¾æ”¶æ•›çš„é—®é¢˜ï¼Œè¿™ä¸ªç®—æ³•å°±æ˜¯æ˜¯æ·±åº¦ç¡®å®šæ€§ç­–ç•¥æ¢¯åº¦(Deep Deterministic Policy Gradientï¼Œä»¥ä¸‹ç®€ç§°DDPG)ã€‚</p>
<p>æœ¬ç¯‡ä¸»è¦å‚è€ƒäº†DDPGçš„<a href="https://arxiv.org/pdf/1509.02971.pdf"target="_blank" rel="external nofollow noopener noreferrer">è®ºæ–‡<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>å’ŒICML 2016çš„<a href="https://icml.cc/2016/tutorials/deep_rl_tutorial.pdf"target="_blank" rel="external nofollow noopener noreferrer">deep RL tutorial<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚</p>
<h1 id="1-ä»éšæœºç­–ç•¥åˆ°ç¡®å®šæ€§ç­–ç•¥">1. ä»éšæœºç­–ç•¥åˆ°ç¡®å®šæ€§ç­–ç•¥</h1>
<p>ä»DDPGè¿™ä¸ªåå­—çœ‹ï¼Œå®ƒæ˜¯ç”±Dï¼ˆDeepï¼‰+Dï¼ˆDeterministic ï¼‰+ PG(Policy Gradient)ç»„æˆã€‚PG(Policy Gradient)æˆ‘ä»¬åœ¨<a href="https://www.cnblogs.com/pinard/p/10137696.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åä¸‰) ç­–ç•¥æ¢¯åº¦(Policy Gradient)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>é‡Œå·²ç»è®¨è®ºè¿‡ã€‚é‚£ä»€ä¹ˆæ˜¯ç¡®å®šæ€§ç­–ç•¥æ¢¯åº¦(Deterministic Policy Gradientï¼Œä»¥ä¸‹ç®€ç§°DPG)å‘¢ï¼Ÿ</p>
<p>ç¡®å®šæ€§ç­–ç•¥æ˜¯å’Œéšæœºç­–ç•¥ç›¸å¯¹è€Œè¨€çš„ï¼Œå¯¹äºæŸä¸€äº›åŠ¨ä½œé›†åˆæ¥è¯´ï¼Œå®ƒå¯èƒ½æ˜¯è¿ç»­å€¼ï¼Œæˆ–è€…éå¸¸é«˜ç»´çš„ç¦»æ•£å€¼ï¼Œè¿™æ ·åŠ¨ä½œçš„ç©ºé—´ç»´åº¦æå¤§ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨éšæœºç­–ç•¥ï¼Œå³åƒDQNä¸€æ ·ç ”ç©¶å®ƒæ‰€æœ‰çš„å¯èƒ½åŠ¨ä½œçš„æ¦‚ç‡ï¼Œå¹¶è®¡ç®—å„ä¸ªå¯èƒ½çš„åŠ¨ä½œçš„ä»·å€¼çš„è¯ï¼Œé‚£éœ€è¦çš„æ ·æœ¬é‡æ˜¯éå¸¸å¤§æ‰å¯è¡Œçš„ã€‚äºæ˜¯æœ‰äººå°±æƒ³å‡ºä½¿ç”¨ç¡®å®šæ€§ç­–ç•¥æ¥ç®€åŒ–è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ä½œä¸ºéšæœºç­–ç•¥ï¼Œåœ¨ç›¸åŒçš„ç­–ç•¥ï¼Œåœ¨åŒä¸€ä¸ªçŠ¶æ€å¤„ï¼Œé‡‡ç”¨çš„åŠ¨ä½œæ˜¯åŸºäºä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒçš„ï¼Œå³æ˜¯ä¸ç¡®å®šçš„ã€‚è€Œç¡®å®šæ€§ç­–ç•¥åˆ™å†³å®šç®€å•ç‚¹ï¼Œè™½ç„¶åœ¨åŒä¸€ä¸ªçŠ¶æ€å¤„ï¼Œé‡‡ç”¨çš„åŠ¨ä½œæ¦‚ç‡ä¸åŒï¼Œä½†æ˜¯æœ€å¤§æ¦‚ç‡åªæœ‰ä¸€ä¸ªï¼Œå¦‚æœæˆ‘ä»¬åªå–æœ€å¤§æ¦‚ç‡çš„åŠ¨ä½œï¼Œå»æ‰è¿™ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œé‚£ä¹ˆå°±ç®€å•å¤šäº†ã€‚å³ä½œä¸ºç¡®å®šæ€§ç­–ç•¥ï¼Œç›¸åŒçš„ç­–ç•¥ï¼Œåœ¨åŒä¸€ä¸ªçŠ¶æ€å¤„ï¼ŒåŠ¨ä½œæ˜¯å”¯ä¸€ç¡®å®šçš„ï¼Œå³ç­–ç•¥å˜æˆï¼š</p>
<p>$$\pi_\theta(s)=a$$</p>
<h1 id="2-ä»dpgåˆ°ddpg">2. ä»DPGåˆ°DDPG</h1>
<p>åœ¨çœ‹ç¡®å®šæ€§ç­–ç•¥æ¢¯åº¦DPGå‰ï¼Œæˆ‘ä»¬çœ‹çœ‹åŸºäºQå€¼çš„éšæœºæ€§ç­–ç•¥æ¢¯åº¦çš„æ¢¯åº¦è®¡ç®—å…¬å¼ï¼š</p>
<p>$$\nabla_\theta J(\pi_\theta)=E_{s\sim\rho^\pi,a\sim\pi_\theta}[\nabla_\theta log\pi_\theta(s,a)Q_\pi(s,a)]$$</p>
<p>å…¶ä¸­çŠ¶æ€çš„é‡‡æ ·ç©ºé—´ä¸º$\rho^\pi$, $\nabla_\theta log\pi_\theta(s,a)$æ˜¯åˆ†å€¼å‡½æ•°ï¼Œå¯è§éšæœºæ€§ç­–ç•¥æ¢¯åº¦éœ€è¦åœ¨æ•´ä¸ªåŠ¨ä½œçš„ç©ºé—´$\pi_\mathrm{\theta}$è¿›è¡Œé‡‡æ ·ã€‚</p>
<p>è€ŒDPGåŸºäºQå€¼çš„ç¡®å®šæ€§ç­–ç•¥æ¢¯åº¦çš„æ¢¯åº¦è®¡ç®—å…¬å¼æ˜¯ï¼š</p>
<p>$$\nabla_\theta J(\pi_\theta)=E_{s\sim\rho^\pi}[\nabla_\theta\pi_\theta(s)\nabla_aQ_\pi(s,a)|<em>{a=\pi</em>\theta(s)}]$$</p>
<p>è·Ÿéšæœºç­–ç•¥æ¢¯åº¦çš„å¼å­ç›¸æ¯”ï¼Œå°‘äº†å¯¹åŠ¨ä½œçš„ç§¯åˆ†ï¼Œå¤šäº†å›æŠ¥Qå‡½æ•°å¯¹åŠ¨ä½œçš„å¯¼æ•°ã€‚</p>
<p>è€Œä»DPGåˆ°DDPGçš„è¿‡ç¨‹ï¼Œå®Œå…¨å¯ä»¥ç±»æ¯”DQNåˆ°DDQNçš„è¿‡ç¨‹ã€‚é™¤äº†è€ç”Ÿå¸¸è°ˆçš„ç»éªŒå›æ”¾ä»¥å¤–ï¼Œæˆ‘ä»¬æœ‰äº†åŒç½‘ç»œï¼Œå³å½“å‰ç½‘ç»œå’Œç›®æ ‡ç½‘ç»œçš„æ¦‚å¿µã€‚è€Œç”±äºç°åœ¨æˆ‘ä»¬æœ¬æ¥å°±æœ‰Actorç½‘ç»œå’ŒCriticä¸¤ä¸ªç½‘ç»œï¼Œé‚£ä¹ˆåŒç½‘ç»œåå°±å˜æˆäº†4ä¸ªç½‘ç»œï¼Œåˆ†åˆ«æ˜¯ï¼šActorå½“å‰ç½‘ç»œï¼ŒActorç›®æ ‡ç½‘ç»œï¼ŒCriticå½“å‰ç½‘ç»œï¼ŒCriticç›®æ ‡ç½‘ç»œã€‚2ä¸ªActorç½‘ç»œçš„ç»“æ„ç›¸åŒï¼Œ2ä¸ªCriticç½‘ç»œçš„ç»“æ„ç›¸åŒã€‚é‚£ä¹ˆè¿™4ä¸ªç½‘ç»œçš„åŠŸèƒ½å„è‡ªæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<h1 id="3-ddpgçš„åŸç†">3. DDPGçš„åŸç†</h1>
<p>DDPGæœ‰4ä¸ªç½‘ç»œï¼Œåœ¨äº†è§£è¿™4ä¸ªç½‘ç»œçš„åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¤ä¹ DDQNçš„ä¸¤ä¸ªç½‘ç»œï¼šå½“å‰Qç½‘ç»œå’Œç›®æ ‡Qç½‘ç»œçš„ä½œç”¨ã€‚å¯ä»¥å¤ä¹ <a href="https://www.cnblogs.com/pinard/p/9778063.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆåï¼‰Double DQN (DDQN)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚</p>
<p>DDQNçš„å½“å‰Qç½‘ç»œè´Ÿè´£å¯¹å½“å‰çŠ¶æ€ $S$ ä½¿ç”¨ $Ïµ$âˆ’è´ªå©ªæ³•é€‰æ‹©åŠ¨ä½œ $A$ï¼Œæ‰§è¡ŒåŠ¨ä½œ $A$,è·å¾—æ–°çŠ¶æ€ $S&rsquo;$å’Œå¥–åŠ±$R$,å°†æ ·æœ¬æ”¾å…¥ç»éªŒå›æ”¾æ± ï¼Œå¯¹ç»éªŒå›æ”¾æ± ä¸­é‡‡æ ·çš„ä¸‹ä¸€çŠ¶æ€ $S&rsquo;$ä½¿ç”¨è´ªå©ªæ³•é€‰æ‹©åŠ¨ä½œ $A&rsquo;$ï¼Œä¾›ç›®æ ‡Qç½‘ç»œè®¡ç®—ç›®æ ‡Qå€¼ï¼Œå½“ç›®æ ‡Qç½‘ç»œè®¡ç®—å‡ºç›®æ ‡Qå€¼åï¼Œå½“å‰Qç½‘ç»œä¼šè¿›è¡Œç½‘ç»œå‚æ•°çš„æ›´æ–°ï¼Œå¹¶å®šæœŸæŠŠæœ€æ–°ç½‘ç»œå‚æ•°å¤åˆ¶åˆ°ç›®æ ‡Qç½‘ç»œã€‚</p>
<p>DDQNçš„ç›®æ ‡Qç½‘ç»œåˆ™è´Ÿè´£åŸºäºç»éªŒå›æ”¾æ± è®¡ç®—ç›®æ ‡Qå€¼, æä¾›ç»™å½“å‰Qç½‘ç»œç”¨ï¼Œç›®æ ‡Qç½‘ç»œä¼šå®šæœŸä»å½“å‰Qç½‘ç»œå¤åˆ¶æœ€æ–°ç½‘ç»œå‚æ•°ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å›åˆ°DDPGï¼Œä½œä¸ºDDPGï¼ŒCriticå½“å‰ç½‘ç»œï¼ŒCriticç›®æ ‡ç½‘ç»œå’ŒDDQNçš„å½“å‰Qç½‘ç»œï¼Œç›®æ ‡Qç½‘ç»œçš„åŠŸèƒ½å®šä½åŸºæœ¬ç±»ä¼¼ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰è‡ªå·±çš„Actorç­–ç•¥ç½‘ç»œï¼Œå› æ­¤ä¸éœ€è¦ $Ïµ$âˆ’è´ªå©ªæ³•è¿™æ ·çš„é€‰æ‹©æ–¹æ³•ï¼Œè¿™éƒ¨åˆ†DDQNçš„åŠŸèƒ½åˆ°äº†DDPGå¯ä»¥åœ¨Actorå½“å‰ç½‘ç»œå®Œæˆã€‚è€Œå¯¹ç»éªŒå›æ”¾æ± ä¸­é‡‡æ ·çš„ä¸‹ä¸€çŠ¶æ€ $S&rsquo;$ ä½¿ç”¨è´ªå©ªæ³•é€‰æ‹©åŠ¨ä½œ $A&rsquo;$ï¼Œè¿™éƒ¨åˆ†å·¥ä½œç”±äºç”¨æ¥ä¼°è®¡ç›®æ ‡Qå€¼ï¼Œå› æ­¤å¯ä»¥æ”¾åˆ°Actorç›®æ ‡ç½‘ç»œå®Œæˆã€‚</p>
<p>åŸºäºç»éªŒå›æ”¾æ± å’Œç›®æ ‡Actorç½‘ç»œæä¾›çš„ $S&rsquo;$, $A&rsquo;$ è®¡ç®—ç›®æ ‡Qå€¼çš„ä¸€éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†ç”±äºæ˜¯è¯„ä¼°ï¼Œå› æ­¤è¿˜æ˜¯æ”¾åˆ°Criticç›®æ ‡ç½‘ç»œå®Œæˆã€‚è€ŒCriticç›®æ ‡ç½‘ç»œè®¡ç®—å‡ºç›®æ ‡Qå€¼ä¸€éƒ¨åˆ†åï¼ŒCriticå½“å‰ç½‘ç»œä¼šè®¡ç®—ç›®æ ‡Qå€¼ï¼Œå¹¶è¿›è¡Œç½‘ç»œå‚æ•°çš„æ›´æ–°ï¼Œå¹¶å®šæœŸå°†ç½‘ç»œå‚æ•°å¤åˆ¶åˆ°Criticç›®æ ‡ç½‘ç»œã€‚</p>
<p>æ­¤å¤–ï¼ŒActorå½“å‰ç½‘ç»œä¹Ÿä¼šåŸºäºCriticå½“å‰ç½‘ç»œè®¡ç®—å‡ºçš„ç›®æ ‡Qå€¼ï¼Œè¿›è¡Œç½‘ç»œå‚æ•°çš„æ›´æ–°ï¼Œå¹¶å®šæœŸå°†ç½‘ç»œå‚æ•°å¤åˆ¶åˆ°Actorç›®æ ‡ç½‘ç»œã€‚</p>
<p>æœ‰äº†ä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬æ€»ç»“ä¸‹DDPG 4ä¸ªç½‘ç»œçš„åŠŸèƒ½å®šä½ï¼š</p>
<ul>
<li>
<p>(1). <strong>Actorå½“å‰ç½‘ç»œ</strong>: è´Ÿè´£ç­–ç•¥ç½‘ç»œå‚æ•° $Î¸$çš„è¿­ä»£æ›´æ–°ï¼Œè´Ÿè´£æ ¹æ®å½“å‰çŠ¶æ€ $S$é€‰æ‹©å½“å‰åŠ¨ä½œ $A$ï¼Œç”¨äºå’Œç¯å¢ƒäº¤äº’ç”Ÿæˆ $S&rsquo;$, $R$ã€‚</p>
</li>
<li>
<p>(2). <strong>Actorç›®æ ‡ç½‘ç»œ</strong>: è´Ÿè´£æ ¹æ®ç»éªŒå›æ”¾æ± ä¸­é‡‡æ ·çš„ä¸‹ä¸€çŠ¶æ€ $S&rsquo;$ é€‰æ‹©æœ€ä¼˜ä¸‹ä¸€åŠ¨ä½œ$A&rsquo;$ã€‚ç½‘ç»œå‚æ•° $Î¸&rsquo;$å®šæœŸä» $Î¸$å¤åˆ¶ã€‚</p>
</li>
<li>
<p>(3). <strong>Criticå½“å‰ç½‘ç»œ</strong>: è´Ÿè´£ä»·å€¼ç½‘ç»œå‚æ•° $w$çš„è¿­ä»£æ›´æ–°ï¼Œè´Ÿè´£è®¡ç®—è´Ÿè´£è®¡ç®—å½“å‰Qå€¼ $Q(S,A,w)$ã€‚ç›®æ ‡Qå€¼$y_i=R+Î³Q&rsquo;(S&rsquo;,A&rsquo;,w&rsquo;)$</p>
</li>
<li>
<p>(4). <strong>Criticç›®æ ‡ç½‘ç»œ</strong>: è´Ÿè´£è®¡ç®—ç›®æ ‡Qå€¼ä¸­çš„ $Q&rsquo;(S&rsquo;,A&rsquo;,w&rsquo;)$éƒ¨åˆ†ã€‚ç½‘ç»œå‚æ•° $w&rsquo;$ å®šæœŸä» $w$å¤åˆ¶ã€‚</p>
</li>
</ul>
<p>DDPGé™¤äº†è¿™4ä¸ªç½‘ç»œç»“æ„ï¼Œè¿˜ç”¨åˆ°äº†ç»éªŒå›æ”¾ï¼Œè¿™éƒ¨åˆ†ç”¨äºè®¡ç®—ç›®æ ‡Qå€¼ï¼Œå’ŒDQNæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p>
<p>æ­¤å¤–ï¼ŒDDPGä»å½“å‰ç½‘ç»œåˆ°ç›®æ ‡ç½‘ç»œçš„å¤åˆ¶å’Œæˆ‘ä»¬ä¹‹å‰è®²åˆ°äº†DQNä¸ä¸€æ ·ã€‚å›æƒ³DQNï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥æŠŠå°†å½“å‰Qç½‘ç»œçš„å‚æ•°å¤åˆ¶åˆ°ç›®æ ‡Qç½‘ç»œï¼Œå³$w$â€²=$w$, DDPGè¿™é‡Œæ²¡æœ‰ä½¿ç”¨è¿™ç§ç¡¬æ›´æ–°ï¼Œè€Œæ˜¯ä½¿ç”¨äº†è½¯æ›´æ–°ï¼Œå³æ¯æ¬¡å‚æ•°åªæ›´æ–°ä¸€ç‚¹ç‚¹ï¼Œå³ï¼š</p>
<p>$$\begin{gathered}
w&rsquo;\leftarrow\tau w+(1-\tau)w&rsquo; \
\theta&rsquo;\leftarrow\tau\theta+(1-\tau)\theta'
\end{gathered}$$</p>
<p>å…¶ä¸­ $Ï„$æ˜¯æ›´æ–°ç³»æ•°ï¼Œä¸€èˆ¬å–çš„æ¯”è¾ƒå°ï¼Œæ¯”å¦‚0.1æˆ–è€…0.01è¿™æ ·çš„å€¼ã€‚</p>
<p>åŒæ—¶ï¼Œä¸ºäº†å­¦ä¹ è¿‡ç¨‹å¯ä»¥å¢åŠ ä¸€äº›éšæœºæ€§ï¼Œå¢åŠ å­¦ä¹ çš„è¦†ç›–ï¼ŒDDPGå¯¹é€‰æ‹©å‡ºæ¥çš„åŠ¨ä½œ $A$ä¼šå¢åŠ ä¸€å®šçš„å™ªå£° $N$, å³æœ€ç»ˆå’Œç¯å¢ƒäº¤äº’çš„åŠ¨ä½œ $A$ çš„è¡¨è¾¾å¼æ˜¯ï¼š</p>
<p>$$A=\pi_\theta(S)+\mathcal{N}$$</p>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹DDPGçš„æŸå¤±å‡½æ•°ã€‚å¯¹äºCriticå½“å‰ç½‘ç»œï¼Œå…¶æŸå¤±å‡½æ•°å’ŒDQNæ˜¯ç±»ä¼¼çš„ï¼Œéƒ½æ˜¯å‡æ–¹è¯¯å·®ï¼Œå³ï¼š</p>
<p>$$J(w)=\frac1m\sum_{j=1}^m(y_j-Q(\phi(S_j),A_j,w))^2$$</p>
<p>è€Œå¯¹äº Actorå½“å‰ç½‘ç»œï¼Œå…¶æŸå¤±å‡½æ•°å°±å’Œä¹‹å‰è®²çš„PGï¼ŒA3Cä¸åŒäº†ï¼Œè¿™é‡Œç”±äºæ˜¯ç¡®å®šæ€§ç­–ç•¥ï¼ŒåŸè®ºæ–‡å®šä¹‰çš„æŸå¤±æ¢¯åº¦æ˜¯ï¼š</p>
<p>$$\nabla_J(\theta)=\frac1m\sum_{j=1}^m[\nabla_aQ_(s_i,a_i,w)|<em>{s=s_i,a=\pi</em>\theta(s)}\nabla_\theta\pi_{\theta(s)}|_{s=s_i}]$$</p>
<p>è¿™ä¸ªå¯ä»¥å¯¹åº”ä¸Šæˆ‘ä»¬ç¬¬äºŒèŠ‚çš„ç¡®å®šæ€§ç­–ç•¥æ¢¯åº¦ï¼Œçœ‹èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯å…¶å®ç†è§£èµ·æ¥å¾ˆç®€å•ã€‚å‡å¦‚å¯¹åŒä¸€ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬è¾“å‡ºäº†ä¸¤ä¸ªä¸åŒçš„åŠ¨ä½œ $a_1$å’Œ$a_2$ï¼Œä»Criticå½“å‰ç½‘ç»œå¾—åˆ°äº†ä¸¤ä¸ªåé¦ˆçš„ $Q$ å€¼ï¼Œåˆ†åˆ«æ˜¯ $Q_1$,$Q_2$ï¼Œå‡è®¾ $Q_1&gt;Q_2$,å³é‡‡å–åŠ¨ä½œ1å¯ä»¥å¾—åˆ°æ›´å¤šçš„å¥–åŠ±ï¼Œé‚£ä¹ˆç­–ç•¥æ¢¯åº¦çš„æ€æƒ³æ˜¯ä»€ä¹ˆå‘¢ï¼Œå°±æ˜¯å¢åŠ  $a_1$çš„æ¦‚ç‡ï¼Œé™ä½$a_2$çš„æ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒActoræƒ³è¦å°½å¯èƒ½çš„å¾—åˆ°æ›´å¤§çš„Qå€¼ã€‚æ‰€ä»¥æˆ‘ä»¬çš„Actorçš„æŸå¤±å¯ä»¥ç®€å•çš„ç†è§£ä¸ºå¾—åˆ°çš„åé¦ˆQå€¼è¶Šå¤§æŸå¤±è¶Šå°ï¼Œå¾—åˆ°çš„åé¦ˆQå€¼è¶Šå°æŸå¤±è¶Šå¤§ï¼Œå› æ­¤åªè¦å¯¹çŠ¶æ€ä¼°è®¡ç½‘ç»œè¿”å›çš„Qå€¼å–ä¸ªè´Ÿå·å³å¯ï¼Œå³ï¼š</p>
<p>$$J(\theta)=-\frac1m\sum_{j=1}^mQ_(s_i,a_i,w)$$</p>
<h1 id="4-ddpgç®—æ³•æµç¨‹">4. DDPGç®—æ³•æµç¨‹</h1>
<p>è¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸‹DDPGçš„ç®—æ³•æµç¨‹</p>
<p>è¾“å…¥ï¼šActorå½“å‰ç½‘ç»œï¼ŒActorç›®æ ‡ç½‘ç»œï¼ŒCriticå½“å‰ç½‘ç»œï¼ŒCriticç›®æ ‡ç½‘ç»œ,å‚æ•°åˆ†åˆ«ä¸º $Î¸$,$Î¸&rsquo;$,$w$,$w&rsquo;$,è¡°å‡å› å­ $Î³$, è½¯æ›´æ–°ç³»æ•° $Ï„$, æ‰¹é‡æ¢¯åº¦ä¸‹é™çš„æ ·æœ¬æ•° $m$,ç›®æ ‡Qç½‘ç»œå‚æ•°æ›´æ–°é¢‘ç‡ $C$ã€‚æœ€å¤§è¿­ä»£æ¬¡æ•° $T$ã€‚éšæœºå™ªéŸ³å‡½æ•° $\mathcal{N}$</p>
<p>è¾“å‡ºï¼šæœ€ä¼˜Actorå½“å‰ç½‘ç»œå‚æ•° $Î¸$,Criticå½“å‰ç½‘ç»œå‚æ•° $w$</p>
<ul>
<li>(1). éšæœºåˆå§‹åŒ–$Î¸$,$w$, $w$â€²=$w$,$Î¸$â€²=$Î¸$ã€‚æ¸…ç©ºç»éªŒå›æ”¾çš„é›†åˆ$D$</li>
<li>(2). for i from 1 to Tï¼Œè¿›è¡Œè¿­ä»£ã€‚
<ul>
<li>a) åˆå§‹åŒ– $S$ä¸ºå½“å‰çŠ¶æ€åºåˆ—çš„ç¬¬ä¸€ä¸ªçŠ¶æ€, æ‹¿åˆ°å…¶ç‰¹å¾å‘é‡ $Ï•(S)$</li>
<li>b) åœ¨Actorå½“å‰ç½‘ç»œåŸºäºçŠ¶æ€ $S$ å¾—åˆ°åŠ¨ä½œ $A=Ï€_Î¸(Ï•(S))+\mathcal{N}$</li>
<li>c) æ‰§è¡ŒåŠ¨ä½œ$A$,å¾—åˆ°æ–°çŠ¶æ€$S$â€²,å¥–åŠ±$R$,æ˜¯å¦ç»ˆæ­¢çŠ¶æ€%is_end$</li>
<li>d) å°† ${Ï•(S), A, R, Ï•(S&rsquo;), is_end}$ è¿™ä¸ªäº”å…ƒç»„å­˜å…¥ç»éªŒå›æ”¾é›†åˆ$D$</li>
<li>e) $S=S'$</li>
<li>f) ä»ç»éªŒå›æ”¾é›†åˆ $D$ ä¸­é‡‡æ · $m$ ä¸ªæ ·æœ¬${\phi(S_j),A_j,R_j,\phi(S_j^{\prime}),is_end_j},j=1,2.,,,m$ï¼Œè®¡ç®—å½“å‰ç›®æ ‡Qå€¼$y_j$ï¼š
<ul>
<li>$$\left.y_j=\left{\begin{array}{ll}R_j&amp;is_end_j\textit{ is true}\R_j+\gamma Q^{\prime}(\phi(S_j^{\prime}),\pi_{\theta^{\prime}}(\phi(S_j^{\prime})),w^{\prime})&amp;is_end_j\textit{ is false}\end{array}\right.\right.$$</li>
</ul>
</li>
<li>g) ä½¿ç”¨å‡æ–¹å·®æŸå¤±å‡½æ•° $\frac1m\sum_{j=1}^m(y_j-Q(\phi(S_j),A_j,w))^2$ï¼Œé€šè¿‡ç¥ç»ç½‘ç»œçš„æ¢¯åº¦åå‘ä¼ æ’­æ¥æ›´æ–°Criticå½“å‰ç½‘ç»œçš„æ‰€æœ‰å‚æ•° $w$</li>
<li>h) ä½¿ç”¨ $\begin{aligned}J(\theta)=-\frac1m\sum_{j=1}^mQ_(s_i,a_i,\theta)\end{aligned}$ï¼Œé€šè¿‡ç¥ç»ç½‘ç»œçš„æ¢¯åº¦åå‘ä¼ æ’­æ¥æ›´æ–°Actorå½“å‰ç½‘ç»œçš„æ‰€æœ‰å‚æ•° $Î¸$</li>
<li>i) å¦‚æœ i%C=1, åˆ™æ›´æ–°Criticç›®æ ‡ç½‘ç»œå’ŒActorç›®æ ‡ç½‘ç»œå‚æ•°ï¼š
<ul>
<li>$$\begin{gathered} w&rsquo;\leftarrow\tau w+(1-\tau)w&rsquo; \
\theta&rsquo;\leftarrow\tau\theta+(1-\tau)\theta'
\end{gathered}$$</li>
</ul>
</li>
<li>j) å¦‚æœ$S&rsquo;$æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œå½“å‰è½®è¿­ä»£å®Œæ¯•ï¼Œå¦åˆ™è½¬åˆ°æ­¥éª¤(b)</li>
</ul>
</li>
</ul>
<p>ä»¥ä¸Šå°±æ˜¯DDPGç®—æ³•çš„ä¸»æµç¨‹ï¼Œè¦æ³¨æ„çš„æ˜¯ä¸Šé¢2.fä¸­çš„ $\pi_{\theta^{\prime}}(\phi(S_j^{\prime}))$ æ˜¯é€šè¿‡Actorç›®æ ‡ç½‘ç»œå¾—åˆ°ï¼Œè€Œ $Q^{\prime}(\phi(S_i^{\prime}),\pi_{\theta^{\prime}}(\phi(S_i^{\prime})),w^{\prime})$ åˆ™æ˜¯é€šè¿‡Criticç›®æ ‡ç½‘ç»œå¾—åˆ°çš„ã€‚</p>
<h1 id="5-ddpgå®ä¾‹">5. DDPGå®ä¾‹</h1>
<p>è¿™é‡Œæˆ‘ä»¬ç»™å‡ºDDPGç¬¬ä¸€ä¸ªç®—æ³•å®ä¾‹ï¼Œä»£ç ä¸»è¦å‚è€ƒè‡ªè«çƒ¦çš„<a href="https://github.com/MorvanZhou/Reinforcement-learning-with-tensorflow/blob/master/contents/9_Deep_Deterministic_Policy_Gradient_DDPG/DDPG_update.py"target="_blank" rel="external nofollow noopener noreferrer">Githubä»£ç <i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚å¢åŠ äº†æµ‹è¯•æ¨¡å‹æ•ˆæœçš„éƒ¨åˆ†ï¼Œä¼˜åŒ–äº†å°‘é‡å‚æ•°ã€‚ä»£ç è¯¦è§ï¼šhttps://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/ddpg.py</p>
<p>è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰ç”¨ä¹‹å‰çš„CartPoleæ¸¸æˆï¼Œå› ä¸ºå®ƒä¸æ˜¯è¿ç»­åŠ¨ä½œã€‚æˆ‘ä»¬ä½¿ç”¨äº†Pendulum-v0è¿™ä¸ªæ¸¸æˆã€‚ç›®çš„æ˜¯ç”¨æœ€å°çš„åŠ›çŸ©ä½¿æ£’å­ç«–èµ·æ¥ï¼Œè¿™ä¸ªæ¸¸æˆçš„è¯¦ç»†ä»‹ç»å‚è§<a href="https://github.com/openai/gym/wiki/Pendulum-v0"target="_blank" rel="external nofollow noopener noreferrer">è¿™é‡Œ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚è¾“å…¥çŠ¶æ€æ˜¯è§’åº¦çš„sinï¼Œcoså€¼ï¼Œä»¥åŠè§’é€Ÿåº¦ã€‚ä¸€å…±ä¸‰ä¸ªå€¼ã€‚åŠ¨ä½œæ˜¯ä¸€ä¸ªè¿ç»­çš„åŠ›çŸ©å€¼ã€‚</p>
<p>ä¸¤ä¸ªActorç½‘ç»œå’Œä¸¤ä¸ªCriticç½‘ç»œçš„å®šä¹‰å‚è§ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_build_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">trainable</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">tanh</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_bound</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;scaled_a&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_build_c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">trainable</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">n_l1</span> <span class="o">=</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">    <span class="n">w1_s</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;w1_s&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">s_dim</span><span class="p">,</span> <span class="n">n_l1</span><span class="p">],</span> <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">w1_a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;w1_a&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a_dim</span><span class="p">,</span> <span class="n">n_l1</span><span class="p">],</span> <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">b1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;b1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_l1</span><span class="p">],</span> <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">w1_s</span><span class="p">)</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">w1_a</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span><span class="p">)</span>  <span class="c1"># Q(s,a)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Actorå½“å‰ç½‘ç»œå’ŒCriticå½“å‰ç½‘ç»œæŸå¤±å‡½æ•°çš„å®šä¹‰å‚è§ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="n">td_error</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">q_target</span><span class="p">,</span> <span class="n">predictions</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">ctrain</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="n">LR_C</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">td_error</span><span class="p">,</span> <span class="n">var_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ce_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">a_loss</span> <span class="o">=</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>    <span class="c1"># maximize the q</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">atrain</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="n">LR_A</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">a_loss</span><span class="p">,</span> <span class="n">var_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ae_params</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Actorç›®æ ‡ç½‘ç»œå’ŒCriticç›®æ ‡ç½‘ç»œå‚æ•°è½¯æ›´æ–°ï¼ŒActorå½“å‰ç½‘ç»œå’ŒCriticå½“å‰ç½‘ç»œåå‘ä¼ æ’­æ›´æ–°éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">learn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># soft target replacement</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_replace</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">MEMORY_CAPACITY</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl">  <span class="n">bs</span> <span class="o">=</span> <span class="n">bt</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">s_dim</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">ba</span> <span class="o">=</span> <span class="n">bt</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_dim</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_dim</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_dim</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">br</span> <span class="o">=</span> <span class="n">bt</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">s_dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">s_dim</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">bs_</span> <span class="o">=</span> <span class="n">bt</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">s_dim</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atrain</span><span class="p">,</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">:</span> <span class="n">bs</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrain</span><span class="p">,</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">:</span> <span class="n">bs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">:</span> <span class="n">ba</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">:</span> <span class="n">br</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_</span><span class="p">:</span> <span class="n">bs_</span><span class="p">})</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä½™çš„å¯ä»¥å¯¹ç…§ç®—æ³•å’Œä»£ç ä¸€èµ·å­¦ä¹ ï¼Œåº”è¯¥æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚</p>
<h1 id="6-ddpgæ€»ç»“">6. DDPGæ€»ç»“</h1>
<p>DDPGå‚è€ƒäº†DDQNçš„ç®—æ³•æ€æƒ³å—ï¼Œé€šè¿‡åŒç½‘ç»œå’Œç»éªŒå›æ”¾ï¼ŒåŠ ä¸€äº›å…¶ä»–çš„ä¼˜åŒ–ï¼Œæ¯”è¾ƒå¥½çš„è§£å†³äº†Actor-Criticéš¾æ”¶æ•›çš„é—®é¢˜ã€‚å› æ­¤åœ¨å®é™…äº§å“ä¸­å°¤å…¶æ˜¯è‡ªåŠ¨åŒ–ç›¸å…³çš„äº§å“ä¸­ç”¨çš„æ¯”è¾ƒå¤šï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„Actor-Criticç®—æ³•ã€‚</p>
<p>åˆ°æ­¤ï¼Œæˆ‘ä»¬çš„Policy Based RLç³»åˆ—ä¹Ÿè®¨è®ºå®Œäº†ï¼Œè€Œåœ¨æ›´æ—©æˆ‘ä»¬è®¨è®ºäº†Value Based RLç³»åˆ—ï¼Œè‡³æ­¤ï¼Œæˆ‘ä»¬è¿˜å‰©ä¸‹Model Based RLæ²¡æœ‰è®¨è®ºã€‚åç»­æˆ‘ä»¬è®¨è®ºModel Based RLçš„ç›¸å…³ç®—æ³•ã€‚</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [15] | A3C</title><link>https://jianye0428.github.io/posts/rl_learning_note_15/</link><pubDate>Sun, 25 Feb 2024 15:36:01 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_15/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/10272023.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åå››) Actor-Critic<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†Actor-Criticçš„ç®—æ³•æµç¨‹ï¼Œä½†æ˜¯ç”±äºæ™®é€šçš„Actor-Criticç®—æ³•éš¾ä»¥æ”¶æ•›ï¼Œéœ€è¦ä¸€äº›å…¶ä»–çš„ä¼˜åŒ–ã€‚è€ŒAsynchronous Advantage Actor-critic(ä»¥ä¸‹ç®€ç§°A3C)å°±æ˜¯å…¶ä¸­æ¯”è¾ƒå¥½çš„ä¼˜åŒ–ç®—æ³•ã€‚æœ¬æ–‡æˆ‘ä»¬è®¨è®ºA3Cçš„ç®—æ³•åŸç†å’Œç®—æ³•æµç¨‹ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦å‚è€ƒäº†A3Cçš„<a href="http://proceedings.mlr.press/v48/mniha16.pdf"target="_blank" rel="external nofollow noopener noreferrer">è®ºæ–‡<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼Œä»¥åŠICML 2016çš„<a href="https://icml.cc/2016/tutorials/deep_rl_tutorial.pdf"target="_blank" rel="external nofollow noopener noreferrer">deep RL tutorial<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚</p>
<h1 id="1-a3cçš„å¼•å…¥">1. A3Cçš„å¼•å…¥</h1>
<p>ä¸Šä¸€ç¯‡Actor-Criticç®—æ³•çš„ä»£ç ï¼Œå…¶å®å¾ˆéš¾æ”¶æ•›ï¼Œæ— è®ºæ€ä¹ˆè°ƒå‚ï¼Œæœ€åçš„CartPoleéƒ½å¾ˆéš¾ç¨³å®šåœ¨200åˆ†ï¼Œè¿™æ˜¯Actor-Criticç®—æ³•çš„é—®é¢˜ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯æœ‰åŠæ³•å»æœ‰ä¼˜åŒ–è¿™ä¸ªéš¾ä»¥æ”¶æ•›çš„é—®é¢˜çš„ã€‚</p>
<p>å›å¿†ä¸‹ä¹‹å‰çš„DQNç®—æ³•ï¼Œä¸ºäº†æ–¹ä¾¿æ”¶æ•›ä½¿ç”¨äº†ç»éªŒå›æ”¾çš„æŠ€å·§ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„Actor-Criticæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨ç»éªŒå›æ”¾çš„æŠ€å·§å‘¢ï¼Ÿå½“ç„¶å¯ä»¥ï¼ä¸è¿‡A3Cæ›´è¿›ä¸€æ­¥ï¼Œè¿˜å…‹æœäº†ä¸€äº›ç»éªŒå›æ”¾çš„é—®é¢˜ã€‚ç»éªŒå›æ”¾æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ å›æ”¾æ± ç»éªŒæ•°æ®ç›¸å…³æ€§å¤ªå¼ºï¼Œç”¨äºè®­ç»ƒçš„æ—¶å€™æ•ˆæœå¾ˆå¯èƒ½ä¸ä½³ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å­¦ä¹ ä¸‹æ£‹ï¼Œæ€»æ˜¯å’ŒåŒä¸€ä¸ªäººä¸‹ï¼ŒæœŸæœ›èƒ½æé«˜æ£‹è‰ºã€‚è¿™å½“ç„¶æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯åˆ°ä¸€å®šç¨‹åº¦å°±å†éš¾æé«˜äº†ï¼Œæ­¤æ—¶æœ€å¥½çš„æ–¹æ³•æ˜¯å¦å¯»é«˜æ‰‹åˆ‡ç£‹ã€‚</p>
<p>A3Cçš„æ€è·¯ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ƒ<font color=green>åˆ©ç”¨å¤šçº¿ç¨‹çš„æ–¹æ³•ï¼ŒåŒæ—¶åœ¨å¤šä¸ªçº¿ç¨‹é‡Œé¢åˆ†åˆ«å’Œç¯å¢ƒè¿›è¡Œäº¤äº’å­¦ä¹ ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æŠŠå­¦ä¹ çš„æˆæœæ±‡æ€»èµ·æ¥ï¼Œæ•´ç†ä¿å­˜åœ¨ä¸€ä¸ªå…¬å…±çš„åœ°æ–¹</font>ã€‚å¹¶ä¸”ï¼Œå®šæœŸä»å…¬å…±çš„åœ°æ–¹æŠŠå¤§å®¶çš„é½å¿ƒå­¦ä¹ çš„æˆæœæ‹¿å›æ¥ï¼ŒæŒ‡å¯¼è‡ªå·±å’Œç¯å¢ƒåé¢çš„å­¦ä¹ äº¤äº’ã€‚</p>
<p>é€šè¿‡è¿™ç§æ–¹æ³•ï¼ŒA3Cé¿å…äº†ç»éªŒå›æ”¾ç›¸å…³æ€§è¿‡å¼ºçš„é—®é¢˜ï¼ŒåŒæ—¶åšåˆ°äº†å¼‚æ­¥å¹¶å‘çš„å­¦ä¹ æ¨¡å‹ã€‚</p>
<h1 id="2-a3cçš„ç®—æ³•ä¼˜åŒ–">2. A3Cçš„ç®—æ³•ä¼˜åŒ–</h1>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ç›¸æ¯”Actor-Criticï¼ŒA3Cåˆ°åº•åšäº†å“ªäº›å…·ä½“çš„ä¼˜åŒ–ã€‚</p>
<p>ç›¸æ¯”Actor-Criticï¼ŒA3Cçš„ä¼˜åŒ–ä¸»è¦æœ‰3ç‚¹ï¼Œåˆ†åˆ«æ˜¯å¼‚æ­¥è®­ç»ƒæ¡†æ¶ï¼Œç½‘ç»œç»“æ„ä¼˜åŒ–ï¼ŒCriticè¯„ä¼°ç‚¹çš„ä¼˜åŒ–ã€‚å…¶ä¸­å¼‚æ­¥è®­ç»ƒæ¡†æ¶æ˜¯æœ€å¤§çš„ä¼˜åŒ–ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹è¿™ä¸ªå¼‚æ­¥è®­ç»ƒæ¡†æ¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">å¼‚æ­¥è®­ç»ƒæ¡†æ¶</div>
</center>
<br>
<p>å›¾ä¸­ä¸Šé¢çš„Global Networkå°±æ˜¯ä¸Šä¸€èŠ‚è¯´çš„å…±äº«çš„å…¬å…±éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯ä¸€ä¸ªå…¬å…±çš„ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œè¿™ä¸ªç¥ç»ç½‘ç»œåŒ…æ‹¬Actorç½‘ç»œå’ŒCriticç½‘ç»œä¸¤éƒ¨åˆ†çš„åŠŸèƒ½ã€‚ä¸‹é¢æœ‰nä¸ªworkerçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹é‡Œæœ‰å’Œå…¬å…±çš„ç¥ç»ç½‘ç»œä¸€æ ·çš„ç½‘ç»œç»“æ„ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼šç‹¬ç«‹çš„å’Œç¯å¢ƒè¿›è¡Œäº¤äº’å¾—åˆ°ç»éªŒæ•°æ®ï¼Œè¿™äº›çº¿ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°ï¼Œç‹¬ç«‹è¿è¡Œã€‚</p>
<p>æ¯ä¸ªçº¿ç¨‹å’Œç¯å¢ƒäº¤äº’åˆ°ä¸€å®šé‡çš„æ•°æ®åï¼Œå°±è®¡ç®—åœ¨è‡ªå·±çº¿ç¨‹é‡Œçš„ç¥ç»ç½‘ç»œæŸå¤±å‡½æ•°çš„æ¢¯åº¦ï¼Œä½†æ˜¯è¿™äº›æ¢¯åº¦å´å¹¶ä¸æ›´æ–°è‡ªå·±çº¿ç¨‹é‡Œçš„ç¥ç»ç½‘ç»œï¼Œè€Œæ˜¯å»æ›´æ–°å…¬å…±çš„ç¥ç»ç½‘ç»œã€‚ä¹Ÿå°±æ˜¯nä¸ªçº¿ç¨‹ä¼šç‹¬ç«‹çš„ä½¿ç”¨ç´¯ç§¯çš„æ¢¯åº¦åˆ†åˆ«æ›´æ–°å…¬å…±éƒ¨åˆ†çš„ç¥ç»ç½‘ç»œæ¨¡å‹å‚æ•°ã€‚æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œçº¿ç¨‹ä¼šå°†è‡ªå·±çš„ç¥ç»ç½‘ç»œçš„å‚æ•°æ›´æ–°ä¸ºå…¬å…±ç¥ç»ç½‘ç»œçš„å‚æ•°ï¼Œè¿›è€ŒæŒ‡å¯¼åé¢çš„ç¯å¢ƒäº¤äº’ã€‚</p>
<p>å¯è§ï¼Œå…¬å…±éƒ¨åˆ†çš„ç½‘ç»œæ¨¡å‹å°±æ˜¯æˆ‘ä»¬è¦å­¦ä¹ çš„æ¨¡å‹ï¼Œè€Œçº¿ç¨‹é‡Œçš„ç½‘ç»œæ¨¡å‹ä¸»è¦æ˜¯ç”¨äºå’Œç¯å¢ƒäº¤äº’ä½¿ç”¨çš„ï¼Œè¿™äº›çº¿ç¨‹é‡Œçš„æ¨¡å‹å¯ä»¥å¸®åŠ©çº¿ç¨‹æ›´å¥½çš„å’Œç¯å¢ƒäº¤äº’ï¼Œæ‹¿åˆ°é«˜è´¨é‡çš„æ•°æ®å¸®åŠ©æ¨¡å‹æ›´å¿«æ”¶æ•›ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬äºŒä¸ªä¼˜åŒ–ï¼Œç½‘ç»œç»“æ„çš„ä¼˜åŒ–ã€‚ä¹‹å‰åœ¨<a href="https://www.cnblogs.com/pinard/p/10272023.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åå››) Actor-Critic<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªä¸åŒçš„ç½‘ç»œActorå’ŒCriticã€‚åœ¨A3Cè¿™é‡Œï¼Œæˆ‘ä»¬æŠŠä¸¤ä¸ªç½‘ç»œæ”¾åˆ°äº†ä¸€èµ·ï¼Œå³è¾“å…¥çŠ¶æ€ $S$,å¯ä»¥è¾“å‡ºçŠ¶æ€ä»·å€¼ $V$,å’Œå¯¹åº”çš„ç­–ç•¥ $Ï€$, å½“ç„¶ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥æŠŠActorå’ŒCriticçœ‹åšç‹¬ç«‹çš„ä¸¤å—ï¼Œåˆ†åˆ«å¤„ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">æŠŠActorå’ŒCriticçœ‹åšç‹¬ç«‹çš„ä¸¤å—ï¼Œåˆ†åˆ«å¤„ç†</div>
</center>
<br>
<p>ç¬¬ä¸‰ä¸ªä¼˜åŒ–ç‚¹æ˜¯Criticè¯„ä¼°ç‚¹çš„ä¼˜åŒ–ï¼Œåœ¨<a href="https://www.cnblogs.com/pinard/p/10272023.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åå››) Actor-Critic<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ç¬¬2èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸åŒçš„Criticè¯„ä¼°ç‚¹çš„é€‰æ‹©ï¼Œå…¶ä¸­déƒ¨åˆ†è®²åˆ°äº†ä½¿ç”¨ä¼˜åŠ¿å‡½æ•° $A$ æ¥åšCriticè¯„ä¼°ç‚¹ï¼Œä¼˜åŠ¿å‡½æ•° $A$ åœ¨æ—¶åˆ»tä¸è€ƒè™‘å‚æ•°çš„é»˜è®¤è¡¨è¾¾å¼ä¸ºï¼š</p>
<p>$$A(S,A,t)=Q(S,A)-V(S)$$</p>
<p>$Q(S,A)$çš„å€¼ä¸€èˆ¬å¯ä»¥é€šè¿‡å•æ­¥é‡‡æ ·è¿‘ä¼¼ä¼°è®¡ï¼Œå³ï¼š</p>
<p>$$Q(S,A)=R+\gamma V(S^{\prime})$$</p>
<p>è¿™æ ·ä¼˜åŠ¿å‡½æ•°å»æ‰åŠ¨ä½œå¯ä»¥è¡¨è¾¾ä¸ºï¼š</p>
<p>$$A(S,t)=R+\gamma V(S^{\prime})-V(S)$$</p>
<p>å…¶ä¸­ $V(S)$çš„å€¼éœ€è¦é€šè¿‡Criticç½‘ç»œæ¥å­¦ä¹ å¾—åˆ°ã€‚</p>
<p>åœ¨A3Cä¸­ï¼Œé‡‡æ ·æ›´è¿›ä¸€æ­¥ï¼Œä½¿ç”¨äº†Næ­¥é‡‡æ ·ï¼Œä»¥åŠ é€Ÿæ”¶æ•›ã€‚è¿™æ ·A3Cä¸­ä½¿ç”¨çš„ä¼˜åŠ¿å‡½æ•°è¡¨è¾¾ä¸ºï¼š</p>
<p>$$A(S,t)=R_t++\gamma R_{t+1}+\ldots\gamma^{n-1}R_{t+n-1}+\gamma^nV(S^{\prime})-V(S)$$</p>
<p>å¯¹äºActorå’ŒCriticçš„æŸå¤±å‡½æ•°éƒ¨åˆ†ï¼Œå’ŒActor-CriticåŸºæœ¬ç›¸åŒã€‚æœ‰ä¸€ä¸ªå°çš„ä¼˜åŒ–ç‚¹å°±æ˜¯åœ¨Actor-Criticç­–ç•¥å‡½æ•°çš„æŸå¤±å‡½æ•°ä¸­ï¼ŒåŠ å…¥äº†ç­–ç•¥ $Ï€$ çš„ç†µé¡¹,ç³»æ•°ä¸º $c$, å³ç­–ç•¥å‚æ•°çš„æ¢¯åº¦æ›´æ–°å’ŒActor-Criticç›¸æ¯”å˜æˆäº†è¿™æ ·ï¼š</p>
<p>$$\theta=\theta+\alpha\nabla_\theta log\pi_\theta(s_t,a_t)A(S,t)+c\nabla_\theta H(\pi(S_t,\theta))$$</p>
<p>ä»¥ä¸Šå°±æ˜¯A3Cå’ŒActor-Criticç›¸æ¯”æœ‰ä¼˜åŒ–çš„éƒ¨åˆ†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥æ€»ä»·ä¸‹A3Cçš„ç®—æ³•æµç¨‹ã€‚</p>
<h1 id="3-a3cç®—æ³•æµç¨‹">3. A3Cç®—æ³•æµç¨‹</h1>
<p>è¿™é‡Œæˆ‘ä»¬å¯¹A3Cç®—æ³•æµç¨‹åšä¸€ä¸ªæ€»ç»“ï¼Œç”±äºA3Cæ˜¯å¼‚æ­¥å¤šçº¿ç¨‹çš„ï¼Œæˆ‘ä»¬è¿™é‡Œç»™å‡ºä»»æ„ä¸€ä¸ªçº¿ç¨‹çš„ç®—æ³•æµç¨‹ã€‚</p>
<ul>
<li>
<p>è¾“å…¥ï¼šå…¬å…±éƒ¨åˆ†çš„A3Cç¥ç»ç½‘ç»œç»“æ„ï¼Œå¯¹åº”å‚æ•°ä½ $Î¸$ , $w$ï¼Œæœ¬çº¿ç¨‹çš„A3Cç¥ç»ç½‘ç»œç»“æ„ï¼Œå¯¹åº”å‚æ•° $Î¸&rsquo;$, $w&rsquo;$, å…¨å±€å…±äº«çš„è¿­ä»£è½®æ•° $T$ï¼Œå…¨å±€æœ€å¤§è¿­ä»£æ¬¡æ•° $T_{max}$, çº¿ç¨‹å†…å•æ¬¡è¿­ä»£æ—¶é—´åºåˆ—æœ€å¤§é•¿åº¦ $T_{local}$,çŠ¶æ€ç‰¹å¾ç»´åº¦ $n$, åŠ¨ä½œé›† $A$, æ­¥é•¿ $Î±$, $Î²$ï¼Œç†µç³»æ•° $c$, è¡°å‡å› å­ $Î³$</p>
</li>
<li>
<p>è¾“å‡ºï¼šå…¬å…±éƒ¨åˆ†çš„A3Cç¥ç»ç½‘ç»œå‚æ•° $Î¸$, $w$</p>
<ul>
<li>(1). æ›´æ–°æ—¶é—´åºåˆ— $t=1$</li>
<li>(2). é‡ç½®Actorå’ŒCriticçš„æ¢¯åº¦æ›´æ–°é‡: $dÎ¸â†0$,$dwâ†0$</li>
<li>(3). ä»å…¬å…±éƒ¨åˆ†çš„A3Cç¥ç»ç½‘ç»œåŒæ­¥å‚æ•°åˆ°æœ¬çº¿ç¨‹çš„ç¥ç»ç½‘ç»œï¼š$Î¸&rsquo;=Î¸,w&rsquo;=w$</li>
<li>(4). $t_{start}=t$ï¼Œåˆå§‹åŒ–çŠ¶æ€ $s_t$</li>
<li>(5). åŸºäºç­–ç•¥ $Ï€(at|st;Î¸)$ é€‰æ‹©å‡ºåŠ¨ä½œ $a_t$</li>
<li>(6). æ‰§è¡ŒåŠ¨ä½œ $a_t$å¾—åˆ°å¥–åŠ± $r_t$ å’Œæ–°çŠ¶æ€ $s_{t+1}$</li>
<li>(7). $tâ†t+1$, $Tâ†T+1$</li>
<li>(8). å¦‚æœ $s_t$æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œæˆ– $t âˆ’ t_{start}==t_{local}$,åˆ™è¿›å…¥æ­¥éª¤(9)ï¼Œå¦åˆ™å›åˆ°æ­¥éª¤(5)</li>
<li>(9). è®¡ç®—æœ€åä¸€ä¸ªæ—¶é—´åºåˆ—ä½ç½® $s_t$çš„ $Q(s,t)$:
<ul>
<li>$$\left.Q(s,t)=\left\{\begin{array}{ll}0&amp;terminal~state\\V(s_t,w^{\prime})&amp;none~terminal~state,bootstrapping\end{array}\right.\right.$$</li>
</ul>
</li>
<li>(10). for $iâˆˆ(tâˆ’1,tâˆ’2,&hellip;t_{start})$:
<ul>
<li>1). è®¡ç®—æ¯ä¸ªæ—¶åˆ»çš„$Q(s,i)$ï¼š $Q(s,i)=r_i+\gamma Q(s,i+1)$</li>
<li>2). ç´¯è®¡Actorçš„æœ¬åœ°æ¢¯åº¦æ›´æ–°ï¼š
<ul>
<li>$$d\theta\leftarrow d\theta+\nabla_{\theta^{\prime}}log\pi_{\theta^{\prime}}(s_i,a_i)(Q(s,i)-V(S_i,w^{\prime}))+c\nabla_{\theta^{\prime}}H(\pi(s_i,\theta^{\prime}))$$</li>
</ul>
</li>
<li>3). ç´¯è®¡Criticçš„æœ¬åœ°æ¢¯åº¦æ›´æ–°ï¼š
<ul>
<li>$$\begin{aligned}dw&amp;\leftarrow dw+\frac{\partial(Q(s,i)-V(S_i,w^{\prime}))^2}{\partial w^{\prime}}\end{aligned}$$</li>
</ul>
</li>
</ul>
</li>
<li>(11). æ›´æ–°å…¨å±€ç¥ç»ç½‘ç»œçš„æ¨¡å‹å‚æ•°ï¼š
<ul>
<li>$$\theta=\theta+\alpha d\theta,~w=w-\beta dw$$</li>
</ul>
</li>
<li>(12). å¦‚æœ $T&gt;T_{max}$,åˆ™ç®—æ³•ç»“æŸï¼Œè¾“å‡ºå…¬å…±éƒ¨åˆ†çš„A3Cç¥ç»ç½‘ç»œå‚æ•° $Î¸$, $w$,å¦åˆ™è¿›å…¥æ­¥éª¤(3)</li>
</ul>
</li>
</ul>
<p>ä»¥ä¸Šå°±æ˜¯A3Cç®—æ³•å•ä¸ªçº¿ç¨‹çš„ç®—æ³•æµç¨‹ã€‚</p>
<h1 id="4-a3cç®—æ³•å®ä¾‹">4. A3Cç®—æ³•å®ä¾‹</h1>
<p>ä¸‹é¢æˆ‘ä»¬åŸºäºä¸Šè¿°ç®—æ³•æµç¨‹ç»™å‡ºA3Cç®—æ³•å®ä¾‹ã€‚ä»ç„¶ä½¿ç”¨äº†OpenAI Gymä¸­çš„CartPole-v0æ¸¸æˆæ¥ä½œä¸ºæˆ‘ä»¬ç®—æ³•åº”ç”¨ã€‚CartPole-v0æ¸¸æˆçš„ä»‹ç»å‚è§<a href="https://github.com/openai/gym/wiki/CartPole-v0"target="_blank" rel="external nofollow noopener noreferrer">è¿™é‡Œ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚å®ƒæ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬è¦æ±‚å°±æ˜¯æ§åˆ¶ä¸‹é¢çš„cartç§»åŠ¨ä½¿è¿æ¥åœ¨ä¸Šé¢çš„poleä¿æŒå‚ç›´ä¸å€’ã€‚è¿™ä¸ªä»»åŠ¡åªæœ‰ä¸¤ä¸ªç¦»æ•£åŠ¨ä½œï¼Œè¦ä¹ˆå‘å·¦ç”¨åŠ›ï¼Œè¦ä¹ˆå‘å³ç”¨åŠ›ã€‚è€ŒstateçŠ¶æ€å°±æ˜¯è¿™ä¸ªcartçš„ä½ç½®å’Œé€Ÿåº¦ï¼Œ poleçš„è§’åº¦å’Œè§’é€Ÿåº¦ï¼Œ4ç»´çš„ç‰¹å¾ã€‚åšæŒåˆ°200åˆ†çš„å¥–åŠ±åˆ™ä¸ºè¿‡å…³ã€‚</p>
<p>ç®—æ³•ä»£ç å¤§éƒ¨åˆ†å‚è€ƒäº†è«çƒ¦çš„<a href="https://github.com/MorvanZhou/Reinforcement-learning-with-tensorflow/blob/master/contents/10_A3C/A3C_discrete_action.py"target="_blank" rel="external nofollow noopener noreferrer">A3Cä»£ç <i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼Œå¢åŠ äº†æ¨¡å‹æµ‹è¯•éƒ¨åˆ†çš„ä»£ç å¹¶è°ƒæ•´äº†éƒ¨åˆ†æ¨¡å‹å‚æ•°ã€‚å®Œæ•´çš„ä»£ç å‚è§æˆ‘çš„Githubï¼šhttps://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/a3c.py</p>
<p>æ•´ä¸ªç®—æ³•çš„Actorå’ŒCriticçš„ç½‘ç»œç»“æ„éƒ½å®šä¹‰åœ¨è¿™é‡Œï¼Œ æ‰€æœ‰çš„çº¿ç¨‹ä¸­çš„ç½‘ç»œç»“æ„ï¼Œå…¬å…±éƒ¨åˆ†çš„ç½‘ç»œç»“æ„éƒ½åœ¨è¿™é‡Œå®šä¹‰ã€‚</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_build_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">w_init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="s1">&#39;actor&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">l_a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu6</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">w_init</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;la&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">a_prob</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">l_a</span><span class="p">,</span> <span class="n">N_A</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">w_init</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ap&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="s1">&#39;critic&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">l_c</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu6</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">w_init</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;lc&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">l_c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">w_init</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>  <span class="c1"># state value</span>
</span></span><span class="line"><span class="cl">  <span class="n">a_params</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">GraphKeys</span><span class="o">.</span><span class="n">TRAINABLE_VARIABLES</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span> <span class="o">+</span> <span class="s1">&#39;/actor&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">c_params</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">GraphKeys</span><span class="o">.</span><span class="n">TRAINABLE_VARIABLES</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span> <span class="o">+</span> <span class="s1">&#39;/critic&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">a_prob</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">a_params</span><span class="p">,</span> <span class="n">c_params</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€æœ‰çº¿ç¨‹åˆå§‹åŒ–éƒ¨åˆ†ï¼Œä»¥åŠæœ¬çº¿ç¨‹å’Œå…¬å…±çš„ç½‘ç»œç»“æ„åˆå§‹åŒ–éƒ¨åˆ†å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&#34;/cpu:0&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">OPT_A</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">RMSPropOptimizer</span><span class="p">(</span><span class="n">LR_A</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;RMSPropA&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">OPT_C</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">RMSPropOptimizer</span><span class="p">(</span><span class="n">LR_C</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;RMSPropC&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">GLOBAL_AC</span> <span class="o">=</span> <span class="n">ACNet</span><span class="p">(</span><span class="n">GLOBAL_NET_SCOPE</span><span class="p">)</span>  <span class="c1"># we only need its params</span>
</span></span><span class="line"><span class="cl">  <span class="n">workers</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Create worker</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_WORKERS</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">i_name</span> <span class="o">=</span> <span class="s1">&#39;W_</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span>   <span class="c1"># worker name</span>
</span></span><span class="line"><span class="cl">    <span class="n">workers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Worker</span><span class="p">(</span><span class="n">i_name</span><span class="p">,</span> <span class="n">GLOBAL_AC</span><span class="p">))</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ¬çº¿ç¨‹ç¥ç»ç½‘ç»œå°†æœ¬åœ°çš„æ¢¯åº¦æ›´æ–°é‡ç”¨äºæ›´æ–°å…¬å…±ç½‘ç»œå‚æ•°çš„é€»è¾‘åœ¨update_globalå‡½æ•°ä¸­ï¼Œè€Œä»å…¬å…±ç½‘ç»œæŠŠå‚æ•°æ‹‰å›åˆ°æœ¬çº¿ç¨‹ç¥ç»ç½‘ç»œçš„é€»è¾‘åœ¨pull_globalä¸­ã€‚</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">update_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feed_dict</span><span class="p">):</span>  <span class="c1"># run by a local</span>
</span></span><span class="line"><span class="cl">  <span class="n">SESS</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">update_a_op</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_c_op</span><span class="p">],</span> <span class="n">feed_dict</span><span class="p">)</span>  <span class="c1"># local grads applies to global net</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">pull_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># run by a local</span>
</span></span><span class="line"><span class="cl">  <span class="n">SESS</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">pull_a_params_op</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_c_params_op</span><span class="p">])</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¦ç»†çš„å†…å®¹å¤§å®¶å¯ä»¥å¯¹ç…§ä»£ç å’Œç®—æ³•æµç¨‹ä¸€èµ·çœ‹ã€‚åœ¨ä¸»å‡½æ•°é‡Œæˆ‘æ–°åŠ äº†ä¸€ä¸ªæµ‹è¯•æ¨¡å‹æ•ˆæœçš„è¿‡ç¨‹ï¼Œå¤§å®¶å¯ä»¥è¯•è¯•çœ‹çœ‹æœ€åçš„æ¨¡å‹æ•ˆæœå¦‚ä½•ã€‚</p>
<h1 id="5-a3cå°ç»“">5. A3Cå°ç»“</h1>
<p>A3Cè§£å†³äº†Actor-Criticéš¾ä»¥æ”¶æ•›çš„é—®é¢˜ï¼ŒåŒæ—¶æ›´é‡è¦çš„æ˜¯ï¼Œæä¾›äº†ä¸€ç§é€šç”¨çš„å¼‚æ­¥çš„å¹¶å‘çš„å¼ºåŒ–å­¦ä¹ æ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå¹¶å‘æ¡†æ¶ä¸å…‰å¯ä»¥ç”¨äºA3Cï¼Œè¿˜å¯ä»¥ç”¨äºå…¶ä»–çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ã€‚è¿™æ˜¯A3Cæœ€å¤§çš„è´¡çŒ®ã€‚ç›®å‰ï¼Œå·²ç»æœ‰åŸºäºGPUçš„A3Cæ¡†æ¶ï¼Œè¿™æ ·A3Cçš„æ¡†æ¶è®­ç»ƒé€Ÿåº¦å°±æ›´å¿«äº†ã€‚</p>
<p>é™¤äº†A3C, DDPGç®—æ³•ä¹Ÿå¯ä»¥æ”¹å–„Actor-Criticéš¾æ”¶æ•›çš„é—®é¢˜ã€‚å®ƒä½¿ç”¨äº†Nature DQNï¼ŒDDQNç±»ä¼¼çš„æ€æƒ³ï¼Œç”¨ä¸¤ä¸ªActorç½‘ç»œï¼Œä¸¤ä¸ªCriticç½‘ç»œï¼Œä¸€å…±4ä¸ªç¥ç»ç½‘ç»œæ¥è¿­ä»£æ›´æ–°æ¨¡å‹å‚æ•°ã€‚åœ¨ä¸‹ä¸€ç¯‡æˆ‘ä»¬è®¨è®ºDDPGç®—æ³•ã€‚</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [14] | Actor-Critic</title><link>https://jianye0428.github.io/posts/rl_learning_note_14/</link><pubDate>Sun, 25 Feb 2024 15:35:58 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_14/</guid><description><![CDATA[<ul>
<li></li>
</ul>
<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/10137696.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åä¸‰) ç­–ç•¥æ¢¯åº¦(Policy Gradient)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°äº†åŸºäºç­–ç•¥(Policy Based)çš„å¼ºåŒ–å­¦ä¹ æ–¹æ³•çš„åŸºæœ¬æ€è·¯ï¼Œå¹¶è®¨è®ºäº†è’™ç‰¹å¡ç½—ç­–ç•¥æ¢¯åº¦reinforceç®—æ³•ã€‚ä½†æ˜¯ç”±äºè¯¥ç®—æ³•éœ€è¦å®Œæ•´çš„çŠ¶æ€åºåˆ—ï¼ŒåŒæ—¶å•ç‹¬å¯¹ç­–ç•¥å‡½æ•°è¿›è¡Œè¿­ä»£æ›´æ–°ï¼Œä¸å¤ªå®¹æ˜“æ”¶æ•›ã€‚</p>
<p>åœ¨æœ¬ç¯‡æˆ‘ä»¬è®¨è®ºç­–ç•¥(Policy Based)å’Œä»·å€¼(Value Based)ç›¸ç»“åˆçš„æ–¹æ³•ï¼šActor-Criticç®—æ³•ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦å‚è€ƒäº†Suttonçš„å¼ºåŒ–å­¦ä¹ ä¹¦ç¬¬13ç« å’ŒUCLå¼ºåŒ–å­¦ä¹ è®²ä¹‰çš„ç¬¬7è®²ã€‚</p>
<h1 id="1-actor-criticç®—æ³•ç®€ä»‹">1. Actor-Criticç®—æ³•ç®€ä»‹</h1>
<p>Actor-Criticä»åå­—ä¸Šçœ‹åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œæ¼”å‘˜(Actor)å’Œè¯„ä»·è€…(Critic)ã€‚å…¶ä¸­Actorä½¿ç”¨æˆ‘ä»¬ä¸Šä¸€èŠ‚è®²åˆ°çš„ç­–ç•¥å‡½æ•°ï¼Œè´Ÿè´£ç”ŸæˆåŠ¨ä½œ(Action)å¹¶å’Œç¯å¢ƒäº¤äº’ã€‚è€ŒCriticä½¿ç”¨æˆ‘ä»¬ä¹‹å‰è®²åˆ°äº†çš„ä»·å€¼å‡½æ•°ï¼Œè´Ÿè´£è¯„ä¼°Actorçš„è¡¨ç°ï¼Œå¹¶æŒ‡å¯¼Actorä¸‹ä¸€é˜¶æ®µçš„åŠ¨ä½œã€‚</p>
<p>å›æƒ³æˆ‘ä»¬ä¸Šä¸€ç¯‡çš„ç­–ç•¥æ¢¯åº¦ï¼Œç­–ç•¥å‡½æ•°å°±æ˜¯æˆ‘ä»¬çš„Actorï¼Œä½†æ˜¯é‚£é‡Œæ˜¯æ²¡æœ‰Criticçš„ï¼Œæˆ‘ä»¬å½“æ—¶ä½¿ç”¨äº†è’™ç‰¹å¡ç½—æ³•æ¥è®¡ç®—æ¯ä¸€æ­¥çš„ä»·å€¼éƒ¨åˆ†æ›¿ä»£äº†Criticçš„åŠŸèƒ½ï¼Œä½†æ˜¯åœºæ™¯æ¯”è¾ƒå—é™ã€‚å› æ­¤ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ç±»ä¼¼DQNä¸­ç”¨çš„ä»·å€¼å‡½æ•°æ¥æ›¿ä»£è’™ç‰¹å¡ç½—æ³•ï¼Œä½œä¸ºä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„Criticã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´åœ¨Actor-Criticç®—æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åšä¸¤ç»„è¿‘ä¼¼ï¼Œç¬¬ä¸€ç»„æ˜¯ç­–ç•¥å‡½æ•°çš„è¿‘ä¼¼ï¼š</p>
<p>$$
\pi_\theta(s,a)=P(a|s,\theta)\approx\pi(a|s)
$$</p>
<p>ç¬¬äºŒç»„æ˜¯ä»·å€¼å‡½æ•°çš„è¿‘ä¼¼ï¼Œå¯¹äºçŠ¶æ€ä»·å€¼å’ŒåŠ¨ä½œä»·å€¼å‡½æ•°åˆ†åˆ«æ˜¯ï¼š</p>
<p>$$
\hat{v}(s,w)\approx v_\pi(s)
$$</p>
<p>$$
\hat{q}(s,a,w)\approx q_\pi(s,a)
$$</p>
<p>å¯¹äºæˆ‘ä»¬ä¸Šä¸€èŠ‚è®²åˆ°çš„è’™ç‰¹å¡ç½—ç­–ç•¥æ¢¯åº¦reinforceç®—æ³•ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ”¹é€ æ‰èƒ½å˜æˆActor-Criticç®—æ³•ã€‚é¦–å…ˆï¼Œåœ¨è’™ç‰¹å¡ç½—ç­–ç•¥æ¢¯åº¦reinforceç®—æ³•ä¸­ï¼Œæˆ‘ä»¬çš„ç­–ç•¥çš„å‚æ•°æ›´æ–°å…¬å¼æ˜¯ï¼š</p>
<p>$$
\theta=\theta+\alpha\nabla_\theta log\pi_\theta(s_t,a_t)v_t
$$</p>
<p>æ¢¯åº¦æ›´æ–°éƒ¨åˆ†ä¸­ï¼Œ$\nabla_\theta log\pi_\theta(s_t,a_t)$æ˜¯æˆ‘ä»¬çš„åˆ†å€¼å‡½æ•°ï¼Œä¸ç”¨åŠ¨ï¼Œè¦å˜æˆActorçš„è¯æ”¹åŠ¨çš„æ˜¯$v_t$ï¼Œè¿™å—ä¸èƒ½å†ä½¿ç”¨è’™ç‰¹å¡ç½—æ³•æ¥å¾—åˆ°ï¼Œè€Œåº”è¯¥ä»Criticå¾—åˆ°ã€‚</p>
<p>è€Œå¯¹äºCriticæ¥è¯´ï¼Œè¿™å—æ˜¯æ–°çš„ï¼Œä¸è¿‡æˆ‘ä»¬å®Œå…¨å¯ä»¥å‚è€ƒä¹‹å‰DQNçš„åšæ³•ï¼Œå³ç”¨ä¸€ä¸ªQç½‘ç»œæ¥åšä¸ºCriticï¼Œè¿™ä¸ªQç½‘ç»œçš„è¾“å…¥å¯ä»¥æ˜¯çŠ¶æ€ï¼Œè€Œè¾“å‡ºæ˜¯æ¯ä¸ªåŠ¨ä½œçš„ä»·å€¼æˆ–è€…æœ€ä¼˜åŠ¨ä½œçš„ä»·å€¼ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æ±‡æ€»æ¥è¯´ï¼Œå°±æ˜¯Criticé€šè¿‡Qç½‘ç»œè®¡ç®—çŠ¶æ€çš„æœ€ä¼˜ä»·å€¼$v_t$,è€ŒActoråˆ©ç”¨$v_t$è¿™ä¸ªæœ€ä¼˜ä»·å€¼è¿­ä»£æ›´æ–°ç­–ç•¥å‡½æ•°çš„å‚æ•°$\theta$,è¿›è€Œé€‰æ‹©åŠ¨ä½œï¼Œå¹¶å¾—åˆ°åé¦ˆå’Œæ–°çš„çŠ¶æ€ï¼ŒCriticä½¿ç”¨åé¦ˆå’Œæ–°çš„çŠ¶æ€æ›´æ–°Qç½‘ç»œå‚æ•°$w$,åœ¨åé¢Criticä¼šä½¿ç”¨æ–°çš„ç½‘ç»œå‚æ•°$w$æ¥å¸®Actorè®¡ç®—çŠ¶æ€çš„æœ€ä¼˜ä»·å€¼$v_{te}$</p>
<h1 id="2-actor-criticç®—æ³•å¯é€‰å½¢å¼">2. Actor-Criticç®—æ³•å¯é€‰å½¢å¼</h1>
<p>åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬å·²ç»å¯¹Actor-Criticç®—æ³•çš„æµç¨‹åšäº†ä¸€ä¸ªåˆæ­¥çš„æ€»ç»“ï¼Œä¸è¿‡æœ‰ä¸€ä¸ªå¯ä»¥æ³¨æ„çš„ç‚¹å°±æ˜¯ï¼Œæˆ‘ä»¬å¯¹äºCriticè¯„ä¼°çš„ç‚¹é€‰æ‹©æ˜¯å’Œä¸Šä¸€ç¯‡ç­–ç•¥æ¢¯åº¦ä¸€æ ·çš„çŠ¶æ€ä»·å€¼ $v_t$å®é™…ä¸Šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©å¾ˆå¤šå…¶ä»–çš„æŒ‡æ ‡æ¥åšä¸ºCriticçš„è¯„ä¼°ç‚¹ã€‚è€Œç›®å‰å¯ä»¥ä½¿ç”¨çš„Actor-Criticè¯„ä¼°ç‚¹ä¸»è¦æœ‰ï¼š</p>
<ul>
<li>
<p>a) åŸºäºçŠ¶æ€ä»·å€¼ï¼šè¿™æ˜¯æˆ‘ä»¬ä¸Šä¸€èŠ‚ä½¿ç”¨çš„è¯„ä¼°ç‚¹ï¼Œè¿™æ ·Actorçš„ç­–ç•¥å‡½æ•°å‚æ•°æ›´æ–°çš„æ³•å…¬å¼æ˜¯ï¼š</p>
<ul>
<li>$$\theta=\theta+\alpha\nabla_\theta log\pi_\theta(s_t,a_t)V(s,w)$$</li>
</ul>
</li>
<li>
<p>b) åŸºäºåŠ¨ä½œä»·å€¼ï¼šåœ¨DQNä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„éƒ½æ˜¯åŠ¨ä½œä»·å€¼å‡½æ•°Qæ¥åšä»·å€¼è¯„ä¼°ï¼Œè¿™æ ·Actorçš„ç­–ç•¥å‡½æ•°å‚æ•°æ›´æ–°çš„æ³•å…¬å¼æ˜¯ï¼š</p>
<ul>
<li>$$\theta=\theta+\alpha\nabla_\theta log\pi_\theta(s_t,a_t)Q(s,a,w)$$</li>
</ul>
</li>
<li>
<p>c) åŸºäºTDè¯¯å·®ï¼šåœ¨<a href="https://www.cnblogs.com/pinard/p/9529828.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆäº”ï¼‰ç”¨æ—¶åºå·®åˆ†æ³•ï¼ˆTDï¼‰æ±‚è§£<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°äº†TDè¯¯å·®ï¼Œå®ƒçš„è¡¨è¾¾å¼æ˜¯ $\delta(t)=R_{t+1}+\gamma V(S_{t+1})-V(S_t)$ æˆ–è€… $\delta(t)=R_{t+1}+\gamma Q(S_{t+1}\text{,}A_{t+1})-Q(S_t,A_t)$, è¿™æ ·Actorçš„ç­–ç•¥å‡½æ•°å‚æ•°æ›´æ–°çš„æ³•å…¬å¼æ˜¯ï¼š</p>
<ul>
<li>$$\theta=\theta+\alpha\nabla_\theta log\pi_\theta(s_t,a_t)\delta(t)$$</li>
</ul>
</li>
<li>
<p>d) åŸºäºä¼˜åŠ¿å‡½æ•°ï¼šåœ¨<a href="https://www.cnblogs.com/pinard/p/9923859.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åäºŒ) Dueling DQN<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°è¿‡ä¼˜åŠ¿å‡½æ•°Açš„å®šä¹‰ï¼š$A(S,A,w,\beta)=Q(S,A,w,\alpha,\beta)-V(S,w,\alpha)$, å³åŠ¨ä½œä»·å€¼å‡½æ•°å’ŒçŠ¶æ€ä»·å€¼å‡½æ•°çš„å·®å€¼ã€‚è¿™æ ·Actorçš„ç­–ç•¥å‡½æ•°å‚æ•°æ›´æ–°çš„æ³•å…¬å¼æ˜¯ï¼š</p>
<ul>
<li>$$\theta=\theta+\alpha\nabla_\theta log\pi_\theta(s_t,a_t)A(S,A,w,\beta)$$</li>
</ul>
</li>
<li>
<p>e) åŸºäº $TD(Î»)$ è¯¯å·®ï¼šä¸€èˆ¬éƒ½æ˜¯åŸºäºåå‘ $TD(Î»)$è¯¯å·®, åœ¨<a href="https://www.cnblogs.com/pinard/p/9529828.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆäº”ï¼‰ç”¨æ—¶åºå·®åˆ†æ³•ï¼ˆTDï¼‰æ±‚è§£<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ä¹Ÿæœ‰è®²åˆ°ï¼Œæ˜¯TDè¯¯å·®å’Œæ•ˆç”¨è¿¹Eçš„ä¹˜ç§¯ã€‚è¿™æ ·Actorçš„ç­–ç•¥å‡½æ•°å‚æ•°æ›´æ–°çš„æ³•å…¬å¼æ˜¯ï¼š</p>
<ul>
<li>$\theta=\theta+\alpha\nabla_\theta log\pi_\theta(s_t,a_t)\delta(t)E(t)$</li>
</ul>
</li>
</ul>
<p>å¯¹äºCriticæœ¬èº«çš„æ¨¡å‹å‚æ•° $w$ ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°æ¥åšåšè¿­ä»£æ›´æ–°ï¼Œç±»ä¼¼ä¹‹å‰DQNç³»åˆ—ä¸­æ‰€è®²çš„è¿­ä»£æ–¹æ³•. å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æœ€ç®€å•çš„çº¿æ€§Qå‡½æ•°ï¼Œæ¯”å¦‚ $Q(s,a,w)=Ï•(s,a)^Tw$,åˆ™Criticæœ¬èº«çš„æ¨¡å‹å‚æ•° $w$çš„æ›´æ–°å…¬å¼å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<p>$$\begin{gathered}
\delta=R_{t+1}+\gamma Q(S_{t+1}\text{,}A_{t+1})-Q(S_t,A_t) \\
w=w+\beta\delta\phi(s,a)
\end{gathered}$$</p>
<p>é€šè¿‡å¯¹å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°æ±‚å¯¼å¯ä»¥å¾ˆå®¹æ˜“çš„å¾—åˆ°ä¸Šå¼ã€‚å½“ç„¶å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä½¿ç”¨çº¿æ€§Qå‡½æ•°ï¼Œè€Œä½¿ç”¨ç¥ç»ç½‘ç»œè¡¨ç¤ºçŠ¶æ€å’ŒQå€¼çš„å…³ç³»ã€‚</p>
<h1 id="3-actor-criticç®—æ³•æµç¨‹">3. Actor-Criticç®—æ³•æµç¨‹</h1>
<p>è¿™é‡Œç»™ä¸€ä¸ªActor-Criticç®—æ³•çš„æµç¨‹æ€»ç»“ï¼Œè¯„ä¼°ç‚¹åŸºäºTDè¯¯å·®ï¼ŒCriticä½¿ç”¨ç¥ç»ç½‘ç»œæ¥è®¡ç®—TDè¯¯å·®å¹¶æ›´æ–°ç½‘ç»œå‚æ•°ï¼ŒActorä¹Ÿä½¿ç”¨ç¥ç»ç½‘ç»œæ¥æ›´æ–°ç½‘ç»œå‚æ•°ã€€ã€€</p>
<p>ç®—æ³•è¾“å…¥ï¼šè¿­ä»£è½®æ•° $T$ï¼ŒçŠ¶æ€ç‰¹å¾ç»´åº¦ $n$, åŠ¨ä½œé›† $A$, æ­¥é•¿ $Î±$, $Î²$ï¼Œè¡°å‡å› å­ $Î³$, æ¢ç´¢ç‡ $Ïµ$, Criticç½‘ç»œç»“æ„å’ŒActorç½‘ç»œç»“æ„ã€‚</p>
<p>è¾“å‡ºï¼šActor ç½‘ç»œå‚æ•° $Î¸$, Criticç½‘ç»œå‚æ•° $w$</p>
<ul>
<li>(1). éšæœºåˆå§‹åŒ–æ‰€æœ‰çš„çŠ¶æ€å’ŒåŠ¨ä½œå¯¹åº”çš„ä»·å€¼Qï¿½. éšæœºåˆå§‹åŒ–Criticç½‘ç»œçš„æ‰€æœ‰å‚æ•°$w$ã€‚éšæœºåˆå§‹åŒ–Actorç½‘ç»œçš„æ‰€æœ‰å‚æ•°$\theta$ã€‚</li>
<li>(2). for i from 1 to Tï¼Œè¿›è¡Œè¿­ä»£ã€‚
<ul>
<li>a) åˆå§‹åŒ– $S$ ä¸ºå½“å‰çŠ¶æ€åºåˆ—çš„ç¬¬ä¸€ä¸ªçŠ¶æ€, æ‹¿åˆ°å…¶ç‰¹å¾å‘é‡ $Ï•(S)$</li>
<li>b) åœ¨Actorç½‘ç»œä¸­ä½¿ç”¨ $Ï•(S)$ ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºåŠ¨ä½œ $A$,åŸºäºåŠ¨ä½œ $A$å¾—åˆ°æ–°çš„çŠ¶æ€ $S&rsquo;$,åé¦ˆ $R$ã€‚</li>
<li>c) åœ¨Criticç½‘ç»œä¸­åˆ†åˆ«ä½¿ç”¨ $Ï•(S)$ï¼Œ$Ï•(S&rsquo;)$ ä½œä¸ºè¾“å…¥ï¼Œå¾—åˆ°Qå€¼è¾“å‡º $V(S)$ï¼Œ$V(S&rsquo;)$</li>
<li>d) è®¡ç®—TDè¯¯å·® $\delta=R+\gamma V(S^{\prime})-V(S)$</li>
<li>e) ä½¿ç”¨å‡æ–¹å·®æŸå¤±å‡½æ•° $\sum(R+\gamma V(S^{\prime})-V(S,w))^2$ ä½œCriticç½‘ç»œå‚æ•° $w$çš„æ¢¯åº¦æ›´æ–°</li>
<li>f) æ›´æ–°Actorç½‘ç»œå‚æ•° $Î¸$:
<ul>
<li>$$\theta=\theta+\alpha\nabla_\theta log\pi_\theta(S_t,A)\delta $$</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å¯¹äºActorçš„åˆ†å€¼å‡½æ•° $âˆ‡_Î¸logÏ€_Î¸(S_t,A)$,å¯ä»¥é€‰æ‹©softmaxæˆ–è€…é«˜æ–¯åˆ†å€¼å‡½æ•°ã€‚</p>
<p>ä¸Šè¿°Actor-Criticç®—æ³•å·²ç»æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç®—æ³•æ¡†æ¶ï¼Œä½†æ˜¯ç¦»å®é™…åº”ç”¨è¿˜æ¯”è¾ƒè¿œã€‚ä¸»è¦åŸå› æ˜¯è¿™é‡Œæœ‰ä¸¤ä¸ªç¥ç»ç½‘ç»œï¼Œéƒ½éœ€è¦æ¢¯åº¦æ›´æ–°ï¼Œè€Œä¸”äº’ç›¸ä¾èµ–ã€‚ä½†æ˜¯äº†è§£è¿™ä¸ªç®—æ³•è¿‡ç¨‹åï¼Œå…¶ä»–åŸºäºActor-Criticçš„ç®—æ³•å°±å¥½ç†è§£äº†ã€‚</p>
<h1 id="4-actor-criticç®—æ³•å®ä¾‹">4. Actor-Criticç®—æ³•å®ä¾‹</h1>
<p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥æ¼”ç¤ºä¸Šé¢çš„Actor-Criticç®—æ³•ã€‚ä»ç„¶ä½¿ç”¨äº†OpenAI Gymä¸­çš„CartPole-v0æ¸¸æˆæ¥ä½œä¸ºæˆ‘ä»¬ç®—æ³•åº”ç”¨ã€‚CartPole-v0æ¸¸æˆçš„ä»‹ç»å‚è§<a href="https://github.com/openai/gym/wiki/CartPole-v0"target="_blank" rel="external nofollow noopener noreferrer">è¿™é‡Œ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚å®ƒæ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬è¦æ±‚å°±æ˜¯æ§åˆ¶ä¸‹é¢çš„cartç§»åŠ¨ä½¿è¿æ¥åœ¨ä¸Šé¢çš„poleä¿æŒå‚ç›´ä¸å€’ã€‚è¿™ä¸ªä»»åŠ¡åªæœ‰ä¸¤ä¸ªç¦»æ•£åŠ¨ä½œï¼Œè¦ä¹ˆå‘å·¦ç”¨åŠ›ï¼Œè¦ä¹ˆå‘å³ç”¨åŠ›ã€‚è€ŒstateçŠ¶æ€å°±æ˜¯è¿™ä¸ªcartçš„ä½ç½®å’Œé€Ÿåº¦ï¼Œ poleçš„è§’åº¦å’Œè§’é€Ÿåº¦ï¼Œ4ç»´çš„ç‰¹å¾ã€‚åšæŒåˆ°200åˆ†çš„å¥–åŠ±åˆ™ä¸ºè¿‡å…³ã€‚</p>
<p>ç®—æ³•æµç¨‹å¯ä»¥å‚è€ƒä¸Šé¢çš„ç¬¬ä¸‰èŠ‚ï¼Œè¿™é‡Œçš„åˆ†å€¼å‡½æ•°æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯softmaxå‡½æ•°ï¼Œå’Œä¸Šä¸€ç‰‡çš„ç±»ä¼¼ã€‚å®Œæ•´çš„ä»£ç å‚è§Githubï¼šhttps://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/actor_critic.py</p>
<p>ä»£ç ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯Actorï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯Criticã€‚å¯¹äºActoréƒ¨åˆ†ï¼Œå¤§å®¶å¯ä»¥å’Œä¸Šä¸€ç¯‡ç­–ç•¥æ¢¯åº¦çš„ä»£ç å¯¹æ¯”ï¼Œæ”¹åŠ¨å¹¶ä¸å¤§ï¼Œä¸»è¦åŒºåˆ«åœ¨äºæ¢¯åº¦æ›´æ–°éƒ¨åˆ†ï¼Œç­–ç•¥æ¢¯åº¦ä½¿ç”¨æ˜¯è’™ç‰¹å¡ç½—æ³•è®¡ç®—å‡ºçš„ä»·å€¼ $v(t)$,åˆ™æˆ‘ä»¬çš„actorä½¿ç”¨çš„æ˜¯TDè¯¯å·®ã€‚</p>
<p>åœ¨ç­–ç•¥æ¢¯åº¦éƒ¨åˆ†ï¼Œå¯¹åº”çš„ä½ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neg_log_prob</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tf_vt</span><span class="p">)</span>  <span class="c1"># reward guided loss</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è€Œæˆ‘ä»¬çš„Actorå¯¹åº”çš„ä½ç½®çš„ä»£ç æ˜¯ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">exp</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neg_log_prob</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">td_error</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤å¤„è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºä½¿ç”¨çš„æ˜¯TDè¯¯å·®ï¼Œè€Œä¸æ˜¯ä»·å€¼ $v(t)$,æ­¤å¤„éœ€è¦æœ€å¤§åŒ–<code>self.exp</code>,è€Œä¸æ˜¯æœ€å°åŒ–å®ƒï¼Œè¿™ç‚¹å’Œç­–ç•¥æ¢¯åº¦ä¸åŒã€‚å¯¹åº”çš„Actorä»£ç ä¸ºï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#è¿™é‡Œéœ€è¦æœ€å¤§åŒ–å½“å‰ç­–ç•¥çš„ä»·å€¼ï¼Œå› æ­¤éœ€è¦æœ€å¤§åŒ–self.exp,å³æœ€å°åŒ–-self.exp</span>
</span></span><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="n">LEARNING_RATE</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤æ­¤ä¹‹å¤–ï¼ŒActoréƒ¨åˆ†çš„ä»£ç å’Œç­–ç•¥æ¢¯åº¦çš„ä»£ç åŒºåˆ«å¹¶ä¸å¤§ã€‚</p>
<p>å¯¹äºCriticéƒ¨åˆ†ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç±»ä¼¼äºDQNçš„ä¸‰å±‚ç¥ç»ç½‘ç»œã€‚ä¸è¿‡æˆ‘ä»¬ç®€åŒ–äº†è¿™ä¸ªç½‘ç»œçš„è¾“å‡ºï¼Œåªæœ‰ä¸€ç»´è¾“å‡ºå€¼ï¼Œè€Œä¸æ˜¯ä¹‹å‰DQNä½¿ç”¨çš„æœ‰å¤šå°‘ä¸ªå¯é€‰åŠ¨ä½œï¼Œå°±æœ‰å¤šå°‘ç»´è¾“å‡ºå€¼ã€‚ç½‘ç»œç»“æ„å¦‚ä¸‹:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_Q_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># network weights</span>
</span></span><span class="line"><span class="cl">  <span class="n">W1q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="n">b1q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="n">W2q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="n">b2q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">state_input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">],</span> <span class="s2">&#34;state&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># hidden layers</span>
</span></span><span class="line"><span class="cl">  <span class="n">h_layerq</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">,</span> <span class="n">W1q</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1q</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Q Value layer</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">Q_value</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">h_layerq</span><span class="p">,</span> <span class="n">W2q</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2q</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å’Œä¹‹å‰çš„DQNç›¸æ¯”ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªåŒºåˆ«å°±æ˜¯æˆ‘ä»¬çš„criticæ²¡æœ‰ä½¿ç”¨DQNçš„ç»éªŒå›æ”¾ï¼Œåªæ˜¯ä½¿ç”¨äº†åé¦ˆå’Œå½“å‰ç½‘ç»œåœ¨ä¸‹ä¸€ä¸ªçŠ¶æ€çš„è¾“å‡ºæ¥æ‹Ÿåˆå½“å‰çŠ¶æ€ã€‚</p>
<p>å¯¹äºç®—æ³•ä¸­Actorå’ŒCriticäº¤äº’çš„é€»è¾‘ï¼Œåœ¨mainå‡½æ•°ä¸­ï¼š</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">STEP</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">action</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">choose_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="c1"># e-greedy action for train</span>
</span></span><span class="line"><span class="cl">  <span class="n">next_state</span><span class="p">,</span><span class="n">reward</span><span class="p">,</span><span class="n">done</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">td_error</span> <span class="o">=</span> <span class="n">critic</span><span class="o">.</span><span class="n">train_Q_network</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">next_state</span><span class="p">)</span>  <span class="c1"># gradient = grad[r + gamma * V(s_) - V(s)]</span>
</span></span><span class="line"><span class="cl">  <span class="n">actor</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">td_error</span><span class="p">)</span>  <span class="c1"># true_gradient = grad[logPi(s,a) * td_error]</span>
</span></span><span class="line"><span class="cl">  <span class="n">state</span> <span class="o">=</span> <span class="n">next_state</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¤§å®¶å¯¹ç…§ç¬¬ä¸‰èŠ‚çš„ç®—æ³•æµç¨‹å’Œä»£ç åº”è¯¥å¯ä»¥æ¯”è¾ƒå®¹æ˜“ç†æ¸…è¿™ä¸ªè¿‡ç¨‹ã€‚ä½†æ˜¯è¿™ä¸ªç¨‹åºå¾ˆéš¾æ”¶æ•›ã€‚å› æ­¤å¤§å®¶è·‘äº†åå‘ç°åˆ†æ•°æ€»æ˜¯å¾ˆä½çš„è¯æ˜¯å¯ä»¥ç†è§£çš„ã€‚æˆ‘ä»¬éœ€è¦ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ã€‚</p>
<h1 id="5-actor-criticç®—æ³•å°ç»“">5. Actor-Criticç®—æ³•å°ç»“</h1>
<p>åŸºæœ¬ç‰ˆçš„Actor-Criticç®—æ³•è™½ç„¶æ€è·¯å¾ˆå¥½ï¼Œä½†æ˜¯ç”±äºéš¾æ”¶æ•›çš„åŸå› ï¼Œè¿˜éœ€è¦åšæ”¹è¿›ã€‚</p>
<p>ç›®å‰æ”¹è¿›çš„æ¯”è¾ƒå¥½çš„æœ‰ä¸¤ä¸ªç»å…¸ç®—æ³•ï¼Œä¸€ä¸ªæ˜¯DDPGç®—æ³•ï¼Œä½¿ç”¨äº†åŒActorç¥ç»ç½‘ç»œå’ŒåŒCriticç¥ç»ç½‘ç»œçš„æ–¹æ³•æ¥æ”¹å–„æ”¶æ•›æ€§ã€‚è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬åœ¨ä»DQNåˆ°Nature DQNçš„è¿‡ç¨‹ä¸­å·²ç»ç”¨è¿‡ä¸€æ¬¡äº†ã€‚å¦ä¸€ä¸ªæ˜¯A3Cç®—æ³•ï¼Œä½¿ç”¨äº†å¤šçº¿ç¨‹çš„æ–¹å¼ï¼Œä¸€ä¸ªä¸»çº¿ç¨‹è´Ÿè´£æ›´æ–°Actorå’ŒCriticçš„å‚æ•°ï¼Œå¤šä¸ªè¾…çº¿ç¨‹è´Ÿè´£åˆ†åˆ«å’Œç¯å¢ƒäº¤äº’ï¼Œå¾—åˆ°æ¢¯åº¦æ›´æ–°å€¼ï¼Œæ±‡æ€»æ›´æ–°ä¸»çº¿ç¨‹çš„å‚æ•°ã€‚è€Œæ‰€æœ‰çš„è¾…çº¿ç¨‹ä¼šå®šæœŸä»ä¸»çº¿ç¨‹æ›´æ–°ç½‘ç»œå‚æ•°ã€‚è¿™äº›è¾…çº¿ç¨‹èµ·åˆ°äº†ç±»ä¼¼DQNä¸­ç»éªŒå›æ”¾çš„ä½œç”¨ï¼Œä½†æ˜¯æ•ˆæœæ›´å¥½ã€‚</p>
<p>åœ¨åé¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šç»§ç»­è®¨è®ºDDPGå’ŒA3Cã€‚</p>
<p>ã€€</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [13] | ç­–ç•¥æ¢¯åº¦(Policy Gradient)</title><link>https://jianye0428.github.io/posts/rl_learning_note_13/</link><pubDate>Sun, 25 Feb 2024 15:35:55 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_13/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨å‰é¢è®²åˆ°çš„DQNç³»åˆ—å¼ºåŒ–å­¦ä¹ ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å¯¹ä»·å€¼å‡½æ•°è¿›è¡Œäº†è¿‘ä¼¼è¡¨ç¤ºï¼ŒåŸºäºä»·å€¼æ¥å­¦ä¹ ã€‚è¿™ç§Value Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•åœ¨å¾ˆå¤šé¢†åŸŸéƒ½å¾—åˆ°æ¯”è¾ƒå¥½çš„åº”ç”¨ï¼Œä½†æ˜¯Value Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•ä¹Ÿæœ‰å¾ˆå¤šå±€é™æ€§ï¼Œå› æ­¤åœ¨å¦ä¸€äº›åœºæ™¯ä¸‹æˆ‘ä»¬éœ€è¦å…¶ä»–çš„æ–¹æ³•ï¼Œæ¯”å¦‚æœ¬ç¯‡è®¨è®ºçš„ç­–ç•¥æ¢¯åº¦(Policy Gradient)ï¼Œå®ƒæ˜¯Policy Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•ï¼ŒåŸºäºç­–ç•¥æ¥å­¦ä¹ ã€‚</p>
<p>æœ¬æ–‡å‚è€ƒäº†Suttonçš„å¼ºåŒ–å­¦ä¹ ä¹¦ç¬¬13ç« å’Œç­–ç•¥æ¢¯åº¦çš„<a href="https://homes.cs.washington.edu/~todorov/courses/amath579/reading/PolicyGradient.pdf"target="_blank" rel="external nofollow noopener noreferrer">è®ºæ–‡<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚</p>
<h1 id="1-value-basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•çš„ä¸è¶³">1. Value Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•çš„ä¸è¶³</h1>
<p>DQNç³»åˆ—å¼ºåŒ–å­¦ä¹ ç®—æ³•ä¸»è¦çš„ <strong><font color=red>é—®é¢˜</font></strong> ä¸»è¦æœ‰ä¸‰ç‚¹ã€‚</p>
<ul>
<li>
<p>ç¬¬ä¸€ç‚¹æ˜¯å¯¹è¿ç»­åŠ¨ä½œçš„å¤„ç†èƒ½åŠ›ä¸è¶³ã€‚DQNä¹‹ç±»çš„æ–¹æ³•ä¸€èˆ¬éƒ½æ˜¯åªå¤„ç†ç¦»æ•£åŠ¨ä½œï¼Œæ— æ³•å¤„ç†è¿ç»­åŠ¨ä½œã€‚è™½ç„¶æœ‰NAF DQNä¹‹ç±»çš„å˜é€šæ–¹æ³•ï¼Œä½†æ˜¯å¹¶ä¸ä¼˜é›…ã€‚æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ç»å…¸çš„å†°çƒä¸–ç•Œ(PuckWorld) å¼ºåŒ–å­¦ä¹ é—®é¢˜ï¼Œå…·ä½“çš„åŠ¨æ€demoè§<a href="https://cs.stanford.edu/people/karpathy/reinforcejs/puckworld.html"target="_blank" rel="external nofollow noopener noreferrer">è¿™é‡Œ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚ç¯å¢ƒç”±ä¸€ä¸ªæ­£æ–¹å½¢åŒºåŸŸæ„æˆä»£è¡¨ç€å†°çƒåœºåœ°ï¼Œåœºåœ°å†…å¤§çš„åœ†ä»£è¡¨ç€è¿åŠ¨å‘˜ä¸ªä½“ï¼Œå°åœ†ä»£è¡¨ç€ç›®æ ‡å†°çƒã€‚åœ¨è¿™ä¸ªæ­£æ–¹å½¢ç¯å¢ƒä¸­ï¼Œå°åœ†ä¼šæ¯éš”ä¸€å®šçš„æ—¶é—´éšæœºæ”¹å˜åœ¨åœºåœ°çš„ä½ç½®ï¼Œè€Œä»£è¡¨ä¸ªä½“çš„å¤§åœ†çš„ä»»åŠ¡å°±æ˜¯å°½å¯èƒ½å¿«çš„æ¥è¿‘å†°çƒç›®æ ‡ã€‚å¤§åœ†å¯ä»¥æ“ä½œçš„è¡Œä¸ºæ˜¯åœ¨æ°´å¹³å’Œç«–ç›´å…±å››ä¸ªæ–¹å‘ä¸Šæ–½åŠ ä¸€ä¸ªæ—¶é—´ä¹˜æ—¶é•¿çš„åŠ›ï¼Œå€Ÿæ­¤æ¥æ”¹å˜å¤§åœ†çš„é€Ÿåº¦ã€‚å‡å¦‚æ­¤æ—¶è¿™ä¸ªåŠ›çš„å¤§å°å’Œæ–¹å‘æ˜¯å¯ä»¥çµæ´»é€‰æ‹©çš„ï¼Œé‚£ä¹ˆä½¿ç”¨æ™®é€šçš„DQNä¹‹ç±»çš„ç®—æ³•å°±ä¸å¥½åšäº†ã€‚å› ä¸ºæ­¤æ—¶ç­–ç•¥æ˜¯ä¸€ä¸ªæœ‰å…·ä½“å€¼æœ‰æ–¹å‘çš„åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªåŠ›åœ¨æ°´å¹³å’Œå‚ç›´æ–¹å‘åˆ†è§£ã€‚é‚£ä¹ˆè¿™ä¸ªåŠ›å°±æ˜¯ä¸¤ä¸ªè¿ç»­çš„å‘é‡ç»„æˆï¼Œè¿™ä¸ªç­–ç•¥ä½¿ç”¨ç¦»æ•£çš„æ–¹å¼æ˜¯ä¸å¥½è¡¨è¾¾çš„ï¼Œä½†æ˜¯ç”¨Policy Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•å´å¾ˆå®¹æ˜“å»ºæ¨¡ã€‚</p>
</li>
<li>
<p>ç¬¬äºŒç‚¹æ˜¯å¯¹å—é™çŠ¶æ€ä¸‹çš„é—®é¢˜å¤„ç†èƒ½åŠ›ä¸è¶³ã€‚åœ¨ä½¿ç”¨ç‰¹å¾æ¥æè¿°çŠ¶æ€ç©ºé—´ä¸­çš„æŸä¸€ä¸ªçŠ¶æ€æ—¶ï¼Œæœ‰å¯èƒ½å› ä¸ºä¸ªä½“è§‚æµ‹çš„é™åˆ¶æˆ–è€…å»ºæ¨¡çš„å±€é™ï¼Œå¯¼è‡´çœŸå®ç¯å¢ƒä¸‹æœ¬æ¥ä¸åŒçš„ä¸¤ä¸ªçŠ¶æ€å´å†æˆ‘ä»¬å»ºæ¨¡åæ‹¥æœ‰ç›¸åŒçš„ç‰¹å¾æè¿°ï¼Œè¿›è€Œå¾ˆæœ‰å¯èƒ½å¯¼è‡´æˆ‘ä»¬çš„value Basedæ–¹æ³•æ— æ³•å¾—åˆ°æœ€ä¼˜è§£ã€‚æ­¤æ—¶ä½¿ç”¨Policy Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•ä¹Ÿå¾ˆæœ‰æ•ˆã€‚</p>
</li>
<li>
<p>ç¬¬ä¸‰ç‚¹æ˜¯æ— æ³•è§£å†³éšæœºç­–ç•¥é—®é¢˜ã€‚Value Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•å¯¹åº”çš„æœ€ä¼˜ç­–ç•¥é€šå¸¸æ˜¯ç¡®å®šæ€§ç­–ç•¥ï¼Œå› ä¸ºå…¶æ˜¯ä»ä¼—å¤šè¡Œä¸ºä»·å€¼ä¸­é€‰æ‹©ä¸€ä¸ªæœ€å¤§ä»·å€¼çš„è¡Œä¸ºï¼Œè€Œæœ‰äº›é—®é¢˜çš„æœ€ä¼˜ç­–ç•¥å´æ˜¯éšæœºç­–ç•¥ï¼Œè¿™ç§æƒ…å†µä¸‹åŒæ ·æ˜¯æ— æ³•é€šè¿‡åŸºäºä»·å€¼çš„å­¦ä¹ æ¥æ±‚è§£çš„ã€‚è¿™æ—¶ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨Policy Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•ã€‚</p>
</li>
</ul>
<p>ç”±äºä¸Šé¢è¿™äº›åŸå› ï¼ŒValue Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•ä¸èƒ½é€šåƒæ‰€æœ‰çš„åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦æ–°çš„è§£å†³ä¸Šè¿°ç±»åˆ«é—®é¢˜çš„æ–¹æ³•ï¼Œæ¯”å¦‚Policy Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•ã€‚</p>
<h1 id="2-policy-basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•å¼•å…¥">2. Policy Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•å¼•å…¥</h1>
<p>å›æƒ³æˆ‘ä»¬åœ¨Value Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å¯¹ä»·å€¼å‡½æ•°è¿›è¡Œäº†è¿‘ä¼¼è¡¨ç¤ºï¼Œå¼•å…¥äº†ä¸€ä¸ªåŠ¨ä½œä»·å€¼å‡½æ•° $\hat{q}$ï¼Œè¿™ä¸ªå‡½æ•°ç”±å‚æ•° $w$ æè¿°ï¼Œå¹¶æ¥å—çŠ¶æ€ $s$ ä¸åŠ¨ä½œ $a$ ä½œä¸ºè¾“å…¥ï¼Œè®¡ç®—åå¾—åˆ°è¿‘ä¼¼çš„åŠ¨ä½œä»·å€¼ï¼Œå³ï¼š</p>
<p>$$\hat{q}\left(s,a,w\right)\approx q_\pi(s,a)$$</p>
<p>åœ¨Policy Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•ä¸‹ï¼Œæˆ‘ä»¬é‡‡æ ·ç±»ä¼¼çš„æ€è·¯ï¼Œåªä¸è¿‡è¿™æ—¶æˆ‘ä»¬å¯¹ç­–ç•¥è¿›è¡Œè¿‘ä¼¼è¡¨ç¤ºã€‚æ­¤æ—¶ç­–ç•¥ $Ï€$å¯ä»¥è¢«è¢«æè¿°ä¸ºä¸€ä¸ªåŒ…å«å‚æ•° $Î¸$ çš„å‡½æ•°,å³ï¼š</p>
<p>$$\pi_\theta(s,a)=P(a|s,\theta)\approx\pi(a|s)$$</p>
<p>å°†ç­–ç•¥è¡¨ç¤ºæˆä¸€ä¸ªè¿ç»­çš„å‡½æ•°åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿ç»­å‡½æ•°çš„ä¼˜åŒ–æ–¹æ³•æ¥å¯»æ‰¾æœ€ä¼˜çš„ç­–ç•¥äº†ã€‚è€Œæœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯æ¢¯åº¦ä¸Šå‡æ³•äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¢¯åº¦å¯¹åº”çš„ä¼˜åŒ–ç›®æ ‡å¦‚ä½•å®šä¹‰å‘¢ï¼Ÿ</p>
<h1 id="3-ç­–ç•¥æ¢¯åº¦çš„ä¼˜åŒ–ç›®æ ‡">3. ç­–ç•¥æ¢¯åº¦çš„ä¼˜åŒ–ç›®æ ‡</h1>
<p>æˆ‘ä»¬è¦ç”¨æ¢¯åº¦ä¸Šå‡æ¥å¯»æ‰¾æœ€ä¼˜çš„æ¢¯åº¦ï¼Œé¦–å…ˆå°±è¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥ä¼˜åŒ–çš„å‡½æ•°ç›®æ ‡ã€‚</p>
<p>æœ€ç®€å•çš„ä¼˜åŒ–ç›®æ ‡å°±æ˜¯åˆå§‹çŠ¶æ€æ”¶è·çš„æœŸæœ›ï¼Œå³ä¼˜åŒ–ç›®æ ‡ä¸ºï¼š</p>
<p>$$J_1(\theta)=V_{\pi_\theta}(s_1)=\mathbb{E}_{\pi_\theta}(G_1)$$</p>
<p>ä½†æ˜¯æœ‰çš„é—®é¢˜æ˜¯æ²¡æœ‰æ˜ç¡®çš„åˆå§‹çŠ¶æ€çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡å¯ä»¥å®šä¹‰å¹³å‡ä»·å€¼ï¼Œå³ï¼š
$$J_{avV}(\theta)=\sum_sd_{\pi_\theta}(s)V_{\pi_\theta}(s)$$</p>
<p>å…¶ä¸­ï¼Œ$d_Ï€Î¸(s)$ æ˜¯åŸºäºç­–ç•¥ $Ï€_Î¸$ç”Ÿæˆçš„é©¬å°”ç§‘å¤«é“¾å…³äºçŠ¶æ€çš„é™æ€åˆ†å¸ƒã€‚</p>
<p>æˆ–è€…å®šä¹‰ä¸ºæ¯ä¸€æ—¶é—´æ­¥çš„å¹³å‡å¥–åŠ±ï¼Œå³ï¼š</p>
<p>$$J_{avR}(\theta)==\sum_sd_{\pi_\theta}(s)\sum_a\pi_\theta(s,a)R_s^a$$</p>
<p>æ— è®ºæˆ‘ä»¬æ˜¯é‡‡ç”¨ $J_1$, $J_{av}V$, è¿˜æ˜¯ $J_{av}R$ æ¥è¡¨ç¤ºä¼˜åŒ–ç›®æ ‡ï¼Œæœ€ç»ˆå¯¹ $Î¸$æ±‚å¯¼çš„æ¢¯åº¦éƒ½å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<p>$$\nabla_\theta J(\theta)=\mathbb{E}_{\pi_\theta}[\nabla_\theta log\pi_\theta(s,a)Q_\pi(s,a)]$$</p>
<p>å…·ä½“çš„è¯æ˜è¿‡ç¨‹è¿™é‡Œå°±ä¸å†åˆ—äº†ï¼Œå¦‚æœå¤§å®¶æ„Ÿå…´è¶£ï¼Œå¯ä»¥å»çœ‹ç­–ç•¥æ¢¯åº¦çš„<a href="https://homes.cs.washington.edu/~todorov/courses/amath579/reading/PolicyGradient.pdf"target="_blank" rel="external nofollow noopener noreferrer">è®ºæ–‡<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>çš„é™„å½•1ï¼Œé‡Œé¢æœ‰è¯¦ç»†çš„è¯æ˜ã€‚</p>
<p>å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥é‡‡ç”¨å¾ˆå¤šå…¶ä»–å¯èƒ½çš„ä¼˜åŒ–ç›®æ ‡æ¥åšæ¢¯åº¦ä¸Šå‡ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„æ¢¯åº¦å¼å­é‡Œé¢çš„ $\nabla_\theta log\pi_\theta(s,a)$ éƒ¨åˆ†å¹¶ä¸æ”¹å˜ï¼Œå˜åŒ–çš„åªæ˜¯åé¢çš„ $Q_\pi(s,a)$ éƒ¨åˆ†ã€‚å¯¹äº $\nabla_\theta log\pi_\theta(s,a)$,æˆ‘ä»¬ä¸€èˆ¬ç§°ä¸º<strong>åˆ†å€¼å‡½æ•°</strong>(score function)ã€‚</p>
<p>ç°åœ¨æ¢¯åº¦çš„å¼å­å·²ç»æœ‰äº†ï¼Œåé¢å‰©ä¸‹çš„å°±æ˜¯ç­–ç•¥å‡½æ•° $\pi_\theta(s,a)$çš„è®¾è®¡äº†ã€‚</p>
<h1 id="4-ç­–ç•¥å‡½æ•°çš„è®¾è®¡">4. ç­–ç•¥å‡½æ•°çš„è®¾è®¡</h1>
<p>ç°åœ¨æˆ‘ä»¬å›å¤´çœ‹ä¸€ä¸‹ç­–ç•¥å‡½æ•° $\pi_\theta(s,a)$ çš„è®¾è®¡ï¼Œåœ¨å‰é¢å®ƒä¸€ç›´æ˜¯ä¸€ä¸ªæ•°å­¦ç¬¦å·ã€‚</p>
<p>æœ€å¸¸ç”¨çš„ç­–ç•¥å‡½æ•°å°±æ˜¯softmaxç­–ç•¥å‡½æ•°äº†ï¼Œå®ƒä¸»è¦åº”ç”¨äºç¦»æ•£ç©ºé—´ä¸­ï¼Œsoftmaxç­–ç•¥ä½¿ç”¨æè¿°çŠ¶æ€å’Œè¡Œä¸ºçš„ç‰¹å¾ $Ï•(s,a)$ ä¸å‚æ•° $Î¸$çš„çº¿æ€§ç»„åˆæ¥æƒè¡¡ä¸€ä¸ªè¡Œä¸ºå‘ç”Ÿçš„å‡ ç‡,å³:</p>
<p>$$\pi_\theta(s,a)=\frac{e^{\phi(s,a)^T\theta}}{\sum_be^{\phi(s,b)^T\theta}}$$</p>
<p>åˆ™é€šè¿‡æ±‚å¯¼å¾ˆå®¹æ˜“æ±‚å‡ºå¯¹åº”çš„åˆ†å€¼å‡½æ•°ä¸ºï¼š</p>
<p>$$\nabla_\theta log\pi_\theta(s,a)=\phi(s,a)-\mathbb{E}_{\pi_\theta}[\phi(s,.)]$$</p>
<p>å¦ä¸€ç§é«˜æ–¯ç­–ç•¥åˆ™æ˜¯åº”ç”¨äºè¿ç»­è¡Œä¸ºç©ºé—´çš„ä¸€ç§å¸¸ç”¨ç­–ç•¥ã€‚è¯¥ç­–ç•¥å¯¹åº”çš„è¡Œä¸ºä»é«˜æ–¯åˆ†å¸ƒ $\mathbb{N}(\phi(\mathrm{s})^{\mathbb{T}}\theta,\sigma^2)$ä¸­äº§ç”Ÿã€‚é«˜æ–¯ç­–ç•¥å¯¹åº”çš„åˆ†å€¼å‡½æ•°æ±‚å¯¼å¯ä»¥å¾—åˆ°ä¸º:</p>
<p>$$\nabla_\theta log\pi_\theta(s,a)==\frac{(a-\phi(s)^T\theta)\phi(s)}{\sigma^2}$$</p>
<p>æœ‰ç­–ç•¥æ¢¯åº¦çš„å…¬å¼å’Œç­–ç•¥å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç¬¬ä¸€ç‰ˆçš„ç­–ç•¥æ¢¯åº¦ç®—æ³•äº†ã€‚</p>
<h1 id="5-è’™ç‰¹å¡ç½—ç­–ç•¥æ¢¯åº¦reinforceç®—æ³•">5. è’™ç‰¹å¡ç½—ç­–ç•¥æ¢¯åº¦reinforceç®—æ³•</h1>
<p>è¿™é‡Œæˆ‘ä»¬è®¨è®ºæœ€ç®€å•çš„ç­–ç•¥æ¢¯åº¦ç®—æ³•ï¼Œè’™ç‰¹å¡ç½—ç­–ç•¥æ¢¯åº¦reinforceç®—æ³•, ä½¿ç”¨ä»·å€¼å‡½æ•° $v(s)$ æ¥è¿‘ä¼¼ä»£æ›¿ç­–ç•¥æ¢¯åº¦å…¬å¼é‡Œé¢çš„ $Q_Ï€(s,a)$ã€‚ç®—æ³•çš„æµç¨‹å¾ˆç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<ul>
<li>è¾“å…¥ï¼šNä¸ªè’™ç‰¹å¡ç½—å®Œæ•´åºåˆ—,è®­ç»ƒæ­¥é•¿ $Î±$</li>
<li>è¾“å‡ºï¼šç­–ç•¥å‡½æ•°çš„å‚æ•° $Î¸$
<ul>
<li>(1). for æ¯ä¸ªè’™ç‰¹å¡ç½—åºåˆ—:
<ul>
<li>a. ç”¨è’™ç‰¹å¡ç½—æ³•è®¡ç®—åºåˆ—æ¯ä¸ªæ—¶é—´ä½ç½®tçš„çŠ¶æ€ä»·å€¼ $v_t$</li>
<li>b. å¯¹åºåˆ—æ¯ä¸ªæ—¶é—´ä½ç½®tï¼Œä½¿ç”¨æ¢¯åº¦ä¸Šå‡æ³•ï¼Œæ›´æ–°ç­–ç•¥å‡½æ•°çš„å‚æ•° $Î¸$ï¼š
<ul>
<li>$$\theta=\theta+\alpha\nabla_\theta log\pi_\theta(s_t,a_t)v_t$$</li>
</ul>
</li>
</ul>
</li>
<li>(2).è¿”å›ç­–ç•¥å‡½æ•°çš„å‚æ•° $Î¸$</li>
</ul>
</li>
</ul>
<p>ã€€ã€€è¿™é‡Œçš„ç­–ç•¥å‡½æ•°å¯ä»¥æ˜¯softmaxç­–ç•¥ï¼Œé«˜æ–¯ç­–ç•¥æˆ–è€…å…¶ä»–ç­–ç•¥ã€‚</p>
<h1 id="6-ç­–ç•¥æ¢¯åº¦å®ä¾‹">6. ç­–ç•¥æ¢¯åº¦å®ä¾‹</h1>
<p>è¿™é‡Œç»™å‡ºç¬¬5èŠ‚çš„è’™ç‰¹å¡ç½—ç­–ç•¥æ¢¯åº¦reinforceç®—æ³•çš„ä¸€ä¸ªå®ä¾‹ã€‚ä»ç„¶ä½¿ç”¨äº†OpenAI Gymä¸­çš„CartPole-v0æ¸¸æˆæ¥ä½œä¸ºæˆ‘ä»¬ç®—æ³•åº”ç”¨ã€‚CartPole-v0æ¸¸æˆçš„ä»‹ç»å‚è§<a href="https://github.com/openai/gym/wiki/CartPole-v0"target="_blank" rel="external nofollow noopener noreferrer">è¿™é‡Œ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚å®ƒæ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬è¦æ±‚å°±æ˜¯æ§åˆ¶ä¸‹é¢çš„cartç§»åŠ¨ä½¿è¿æ¥åœ¨ä¸Šé¢çš„poleä¿æŒå‚ç›´ä¸å€’ã€‚è¿™ä¸ªä»»åŠ¡åªæœ‰ä¸¤ä¸ªç¦»æ•£åŠ¨ä½œï¼Œè¦ä¹ˆå‘å·¦ç”¨åŠ›ï¼Œè¦ä¹ˆå‘å³ç”¨åŠ›ã€‚è€ŒstateçŠ¶æ€å°±æ˜¯è¿™ä¸ªcartçš„ä½ç½®å’Œé€Ÿåº¦ï¼Œ poleçš„è§’åº¦å’Œè§’é€Ÿåº¦ï¼Œ4ç»´çš„ç‰¹å¾ã€‚åšæŒåˆ°200åˆ†çš„å¥–åŠ±åˆ™ä¸ºè¿‡å…³ã€‚</p>
<p>å®Œæ•´çš„ä»£ç å‚è§æˆ‘çš„githubï¼šhttps://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/policy_gradient.py</p>
<p>è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨softmaxç­–ç•¥ä½œä¸ºæˆ‘ä»¬çš„ç­–ç•¥å‡½æ•°ï¼ŒåŒæ—¶ï¼Œsoftmaxçš„å‰ç½®éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç­–ç•¥æ¨¡å‹ç”¨ä¸€ä¸ªä¸‰å±‚çš„softmaxç¥ç»ç½‘ç»œæ¥è¡¨ç¤ºã€‚è¿™æ ·å¥½å¤„å°±æ˜¯æ¢¯åº¦çš„æ›´æ–°å¯ä»¥äº¤ç»™ç¥ç»ç½‘ç»œæ¥åšã€‚</p>
<p>æˆ‘ä»¬çš„softmaxç¥ç»ç½‘ç»œçš„ç»“æ„å¦‚ä¸‹ï¼Œæ³¨æ„è¿™ä¸ªç½‘ç»œä¸æ˜¯ä»·å€¼Qç½‘ç»œï¼Œè€Œæ˜¯ç­–ç•¥ç½‘ç»œï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_softmax_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># network weights</span>
</span></span><span class="line"><span class="cl">  <span class="n">W1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="n">b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="n">W2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="n">b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># input layer</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">state_input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s2">&#34;float&#34;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">tf_acts</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;actions_num&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">tf_vt</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;actions_value&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># hidden layers</span>
</span></span><span class="line"><span class="cl">  <span class="n">h_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">,</span> <span class="n">W1</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># softmax layer</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">softmax_input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">h_layer</span><span class="p">,</span> <span class="n">W2</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span>
</span></span><span class="line"><span class="cl">  <span class="c1">#softmax output</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">all_act_prob</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">softmax_input</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;act_prob&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">neg_log_prob</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sparse_softmax_cross_entropy_with_logits</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">softmax_input</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tf_acts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neg_log_prob</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tf_vt</span><span class="p">)</span>  <span class="c1"># reward guided loss</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="n">LEARNING_RATE</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loss</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„æˆ‘ä»¬çš„æŸå¤±å‡½æ•°æ˜¯softmaxäº¤å‰ç†µæŸå¤±å‡½æ•°å’ŒçŠ¶æ€ä»·å€¼å‡½æ•°çš„ä¹˜ç§¯ï¼Œè¿™æ ·TensorFlowåé¢å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬åšæ¢¯åº¦çš„è¿­ä»£ä¼˜åŒ–ã€‚</p>
<p>å¦ä¸€ä¸ªè¦æ³¨æ„çš„ç‚¹å°±æ˜¯è’™ç‰¹å¡ç½—æ³•é‡Œé¢ä»·å€¼å‡½æ•°çš„è®¡ç®—ï¼Œä¸€èˆ¬æ˜¯ä»åå‘å‰ç®—ï¼Œè¿™æ ·å‰é¢çš„ä»·å€¼çš„è®¡ç®—å¯ä»¥åˆ©ç”¨åé¢çš„ä»·å€¼ä½œä¸ºä¸­é—´ç»“æœï¼Œç®€åŒ–è®¡ç®—ï¼Œå¯¹åº”ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">learn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">discounted_ep_rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ep_rs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">running_add</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ep_rs</span><span class="p">))):</span>
</span></span><span class="line"><span class="cl">      <span class="n">running_add</span> <span class="o">=</span> <span class="n">running_add</span> <span class="o">*</span> <span class="n">GAMMA</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_rs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="n">discounted_ep_rs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">running_add</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">discounted_ep_rs</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">discounted_ep_rs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">discounted_ep_rs</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">discounted_ep_rs</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä½™éƒ¨åˆ†å’Œä¹‹å‰çš„DQNçš„ä»£ç ç±»ä¼¼ã€‚</p>
<h1 id="7-ç­–ç•¥æ¢¯åº¦å°ç»“">7. ç­–ç•¥æ¢¯åº¦å°ç»“</h1>
<p>ç­–ç•¥æ¢¯åº¦æä¾›äº†å’ŒDQNä¹‹ç±»çš„æ–¹æ³•ä¸åŒçš„æ–°æ€è·¯ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸Šé¢çš„è’™ç‰¹å¡ç½—ç­–ç•¥æ¢¯åº¦reinforceç®—æ³•å´å¹¶ä¸å®Œç¾ã€‚ç”±äºæ˜¯è’™ç‰¹å¡ç½—æ³•ï¼Œæˆ‘ä»¬éœ€è¦å®Œå…¨çš„åºåˆ—æ ·æœ¬æ‰èƒ½åšç®—æ³•è¿­ä»£ï¼ŒåŒæ—¶è’™ç‰¹å¡ç½—æ³•ä½¿ç”¨æ”¶è·çš„æœŸæœ›æ¥è®¡ç®—çŠ¶æ€ä»·å€¼ï¼Œä¼šå¯¼è‡´è¡Œä¸ºæœ‰è¾ƒå¤šçš„å˜å¼‚æ€§ï¼Œæˆ‘ä»¬çš„å‚æ•°æ›´æ–°çš„æ–¹å‘å¾ˆå¯èƒ½ä¸æ˜¯ç­–ç•¥æ¢¯åº¦çš„æœ€ä¼˜æ–¹å‘ã€‚</p>
<p>å› æ­¤ï¼ŒPolicy Basedçš„å¼ºåŒ–å­¦ä¹ æ–¹æ³•è¿˜éœ€è¦æ”¹è¿›ï¼Œæ³¨æ„åˆ°æˆ‘ä»¬ä¹‹å‰æœ‰Value Basedå¼ºåŒ–å­¦ä¹ æ–¹æ³•ï¼Œé‚£ä¹ˆä¸¤è€…èƒ½ä¸èƒ½ç»“åˆèµ·æ¥ä¸€èµ·ä½¿ç”¨å‘¢ï¼Ÿä¸‹ä¸€ç¯‡æˆ‘ä»¬è®¨è®ºPolicy Based+Value Basedç»“åˆçš„ç­–ç•¥æ¢¯åº¦æ–¹æ³•Actor-Criticã€‚</p>
<p>ã€€ã€€ã€€ã€€</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [12] | Dueling DQN</title><link>https://jianye0428.github.io/posts/rl_learning_note_12/</link><pubDate>Sun, 25 Feb 2024 11:16:52 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_12/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/9797695.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ (åä¸€) Prioritized Replay DQN<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¯¹DQNçš„ç»éªŒå›æ”¾æ± æŒ‰æƒé‡é‡‡æ ·æ¥ä¼˜åŒ–DQNç®—æ³•çš„æ–¹æ³•ï¼Œæœ¬æ–‡è®¨è®ºå¦ä¸€ç§ä¼˜åŒ–æ–¹æ³•ï¼ŒDueling DQNã€‚æœ¬ç« å†…å®¹ä¸»è¦å‚è€ƒäº†ICML 2016çš„<a href="https://icml.cc/2016/tutorials/deep_rl_tutorial.pdf"target="_blank" rel="external nofollow noopener noreferrer">deep RL tutorial<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>å’ŒDueling DQNçš„è®ºæ–‡(Dueling Network Architectures for Deep Reinforcement Learning)(ICML 2016)ã€‚</p>
<h1 id="1-dueling-dqnçš„ä¼˜åŒ–ç‚¹è€ƒè™‘">1. Dueling DQNçš„ä¼˜åŒ–ç‚¹è€ƒè™‘</h1>
<p>åœ¨å‰é¢è®²åˆ°çš„DDQNä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¼˜åŒ–ç›®æ ‡Qå€¼çš„è®¡ç®—æ¥ä¼˜åŒ–ç®—æ³•ï¼Œåœ¨Prioritized Replay DQNä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¼˜åŒ–ç»éªŒå›æ”¾æ± æŒ‰æƒé‡é‡‡æ ·æ¥ä¼˜åŒ–ç®—æ³•ã€‚è€Œåœ¨Dueling DQNä¸­ï¼Œæˆ‘ä»¬å°è¯•é€šè¿‡<font color=red>ä¼˜åŒ–ç¥ç»ç½‘ç»œçš„ç»“æ„</font>æ¥ä¼˜åŒ–ç®—æ³•ã€‚</p>
<p>å…·ä½“å¦‚ä½•ä¼˜åŒ–ç½‘ç»œç»“æ„å‘¢ï¼ŸDueling DQNè€ƒè™‘å°†Qç½‘ç»œåˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯ä»…ä»…ä¸çŠ¶æ€ $S$æœ‰å…³ï¼Œä¸å…·ä½“è¦é‡‡ç”¨çš„åŠ¨ä½œ $A$æ— å…³ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬å«åš<strong>ä»·å€¼å‡½æ•°éƒ¨åˆ†</strong>ï¼Œè®°åš $V(S,w,Î±)$,ç¬¬äºŒéƒ¨åˆ†åŒæ—¶ä¸çŠ¶æ€çŠ¶æ€ $S$ å’ŒåŠ¨ä½œ $A$æœ‰å…³ï¼Œè¿™éƒ¨åˆ†å«åš**ä¼˜åŠ¿å‡½æ•°(Advantage Function)**éƒ¨åˆ†,è®°ä¸º $A(S,A,w,Î²)$,é‚£ä¹ˆæœ€ç»ˆæˆ‘ä»¬çš„ä»·å€¼å‡½æ•°å¯ä»¥é‡æ–°è¡¨ç¤ºä¸ºï¼š</p>
<p>$$Q(S,A,w,\alpha,\beta)=V(S,w,\alpha)+A(S,A,w,\beta)$$</p>
<p>å…¶ä¸­ï¼Œ$w$ æ˜¯å…¬å…±éƒ¨åˆ†çš„ç½‘ç»œå‚æ•°ï¼Œè€Œ $Î±$ æ˜¯ä»·å€¼å‡½æ•°ç‹¬æœ‰éƒ¨åˆ†çš„ç½‘ç»œå‚æ•°ï¼Œè€Œ $Î²$ æ˜¯ä¼˜åŠ¿å‡½æ•°ç‹¬æœ‰éƒ¨åˆ†çš„ç½‘ç»œå‚æ•°ã€‚</p>
<h1 id="2-dueling-dqnç½‘ç»œç»“æ„">2. Dueling DQNç½‘ç»œç»“æ„</h1>
<p>ç”±äºQç½‘ç»œçš„ä»·å€¼å‡½æ•°è¢«åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå› æ­¤Dueling DQNçš„ç½‘ç»œç»“æ„ä¹Ÿå’Œä¹‹å‰çš„DQNä¸åŒã€‚ä¸ºäº†ç®€åŒ–ç®—æ³•æè¿°ï¼Œè¿™é‡Œä¸ä½¿ç”¨åŸè®ºæ–‡çš„CNNç½‘ç»œç»“æ„ï¼Œè€Œæ˜¯ä½¿ç”¨å‰é¢æ–‡ä¸­ç”¨åˆ°çš„æœ€ç®€å•çš„ä¸‰å±‚ç¥ç»ç½‘ç»œæ¥æè¿°ã€‚æ˜¯å¦ä½¿ç”¨CNNå¯¹Dueling DQNç®—æ³•æœ¬èº«æ— å½±å“ã€‚</p>
<p>åœ¨å‰é¢è®²åˆ°çš„DDQNç­‰DQNç®—æ³•ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªç®€å•çš„ä¸‰å±‚ç¥ç»ç½‘ç»œï¼šä¸€ä¸ªè¾“å…¥å±‚ï¼Œä¸€ä¸ªéšè—å±‚å’Œä¸€ä¸ªè¾“å‡ºå±‚ã€‚å¦‚ä¸‹å·¦å›¾æ‰€ç¤ºï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">ç¥ç»ç½‘ç»œä¸Dueling DQN</div>
</center>
<br>
<p>è€Œåœ¨Dueling DQNä¸­ï¼Œæˆ‘ä»¬åœ¨åé¢åŠ äº†ä¸¤ä¸ªå­ç½‘ç»œç»“æ„ï¼Œåˆ†åˆ«å¯¹åº”ä¸Šé¢ä¸Šåˆ°ä»·æ ¼å‡½æ•°ç½‘ç»œéƒ¨åˆ†å’Œä¼˜åŠ¿å‡½æ•°ç½‘ç»œéƒ¨åˆ†ã€‚å¯¹åº”ä¸Šé¢å³å›¾æ‰€ç¤ºã€‚æœ€ç»ˆQç½‘ç»œçš„è¾“å‡ºç”±ä»·æ ¼å‡½æ•°ç½‘ç»œçš„è¾“å‡ºå’Œä¼˜åŠ¿å‡½æ•°ç½‘ç»œçš„è¾“å‡ºçº¿æ€§ç»„åˆå¾—åˆ°ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸Šä¸€èŠ‚çš„ä»·å€¼å‡½æ•°çš„ç»„åˆå…¬å¼å¾—åˆ°æˆ‘ä»¬çš„åŠ¨ä½œä»·å€¼ï¼Œä½†æ˜¯è¿™ä¸ªå¼å­æ— æ³•è¾¨è¯†æœ€ç»ˆè¾“å‡ºé‡Œé¢ $V(S,w,Î±)$ å’Œ $A(S,A,w,Î²)$å„è‡ªçš„ä½œç”¨ï¼Œä¸ºäº†å¯ä»¥ä½“ç°è¿™ç§å¯è¾¨è¯†æ€§(identifiability),å®é™…ä½¿ç”¨çš„ç»„åˆå…¬å¼å¦‚ä¸‹ï¼š</p>
<p>$$Q(S,A,w,\alpha,\beta)=V(S,w,\alpha)+(A(S,A,w,\beta)-\frac1{\mathcal{A}}\sum_{a^{\prime}\in\mathcal{A}}A(S,a^{\prime},w,\beta))$$</p>
<p>å…¶å®å°±æ˜¯å¯¹ä¼˜åŠ¿å‡½æ•°éƒ¨åˆ†åšäº†ä¸­å¿ƒåŒ–çš„å¤„ç†ã€‚ä»¥ä¸Šå°±æ˜¯Dueling DQNçš„ä¸»è¦ç®—æ³•æ€è·¯ã€‚ç”±äºå®ƒä»…ä»…æ¶‰åŠç¥ç»ç½‘ç»œçš„ä¸­é—´ç»“æ„çš„æ”¹è¿›ï¼Œç°æœ‰çš„DQNç®—æ³•å¯ä»¥åœ¨ä½¿ç”¨Duel DQNç½‘ç»œç»“æ„çš„åŸºç¡€ä¸Šç»§ç»­ä½¿ç”¨ç°æœ‰çš„ç®—æ³•ã€‚ç”±äºç®—æ³•ä¸»æµç¨‹å’Œå…¶ä»–ç®—æ³•æ²¡æœ‰å·®å¼‚ï¼Œè¿™é‡Œå°±ä¸å•ç‹¬è®²Duel DQNçš„ç®—æ³•æµç¨‹äº†ã€‚</p>
<h1 id="3-dueling-dqnå®ä¾‹">3. Dueling DQNå®ä¾‹</h1>
<p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥æ¼”ç¤ºDueling DQNçš„åº”ç”¨ã€‚ä»ç„¶ä½¿ç”¨äº†OpenAI Gymä¸­çš„CartPole-v0æ¸¸æˆæ¥ä½œä¸ºæˆ‘ä»¬ç®—æ³•åº”ç”¨ã€‚CartPole-v0æ¸¸æˆçš„ä»‹ç»å‚è§<a href="https://github.com/openai/gym/wiki/CartPole-v0"target="_blank" rel="external nofollow noopener noreferrer">è¿™é‡Œ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚å®ƒæ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬è¦æ±‚å°±æ˜¯æ§åˆ¶ä¸‹é¢çš„cartç§»åŠ¨ä½¿è¿æ¥åœ¨ä¸Šé¢çš„poleä¿æŒå‚ç›´ä¸å€’ã€‚è¿™ä¸ªä»»åŠ¡åªæœ‰ä¸¤ä¸ªç¦»æ•£åŠ¨ä½œï¼Œè¦ä¹ˆå‘å·¦ç”¨åŠ›ï¼Œè¦ä¹ˆå‘å³ç”¨åŠ›ã€‚è€ŒstateçŠ¶æ€å°±æ˜¯è¿™ä¸ªcartçš„ä½ç½®å’Œé€Ÿåº¦ï¼Œ poleçš„è§’åº¦å’Œè§’é€Ÿåº¦ï¼Œ4ç»´çš„ç‰¹å¾ã€‚åšæŒåˆ°200åˆ†çš„å¥–åŠ±åˆ™ä¸ºè¿‡å…³ã€‚</p>
<p>è¿™ä¸ªå®ä¾‹ä»£åŸºäºNature DQNï¼Œå¹¶å°†ç½‘ç»œç»“æ„æ”¹ä¸ºä¸Šå›¾ä¸­å³è¾¹çš„Dueling DQNç½‘ç»œç»“æ„ï¼Œå®Œæ•´çš„ä»£ç å‚è§github: <a href="https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/duel_dqn.py"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/duel_dqn.py<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>è¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨Dueling DQNå’ŒNature DQNçš„ä»£ç çš„ä¸åŒä¹‹å¤„ã€‚ä¹Ÿå°±æ˜¯ç½‘ç»œç»“æ„å®šä¹‰éƒ¨åˆ†ï¼Œä¸»è¦çš„ä»£ç å¦‚ä¸‹ï¼Œä¸€å…±æœ‰ä¸¤ä¸ªç›¸åŒç»“æ„çš„Qç½‘ç»œï¼Œæ¯ä¸ªQç½‘ç»œéƒ½æœ‰çŠ¶æ€å‡½æ•°å’Œä¼˜åŠ¿å‡½æ•°çš„å®šä¹‰ï¼Œä»¥åŠç»„åˆåçš„Qç½‘ç»œè¾“å‡ºï¼Œå¦‚ä»£ç çº¢è‰²éƒ¨åˆ†ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_Q_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># input layer</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">state_input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s2">&#34;float&#34;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># network weights</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="s1">&#39;current_net&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">W1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># hidden layer 1</span>
</span></span><span class="line"><span class="cl">    <span class="n">h_layer_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">,</span><span class="n">W1</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># hidden layer  for state value</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="n">W21</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="n">b21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">h_layer_1</span><span class="p">,</span> <span class="n">W21</span><span class="p">)</span> <span class="o">+</span> <span class="n">b21</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># hidden layer  for action value</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="s1">&#39;Advantage&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="n">W22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="n">b22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">h_layer_1</span><span class="p">,</span> <span class="n">W22</span><span class="p">)</span> <span class="o">+</span> <span class="n">b22</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1"># Q Value layer</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">Q_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keep_dims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="s1">&#39;target_net&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">W1t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">b1t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># hidden layer 1</span>
</span></span><span class="line"><span class="cl">    <span class="n">h_layer_1t</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">,</span><span class="n">W1t</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># hidden layer  for state value</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="n">W2v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="n">b2v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">VT</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">h_layer_1t</span><span class="p">,</span> <span class="n">W2v</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2v</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># hidden layer  for action value</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="s1">&#39;Advantage&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="n">W2a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="n">b2a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">AT</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">h_layer_1t</span><span class="p">,</span> <span class="n">W2a</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1"># Q Value layer</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">target_Q_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VT</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AT</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AT</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keep_dims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä½™éƒ¨åˆ†ä»£ç å’ŒNature DQNåŸºæœ¬ç›¸åŒã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¹Ÿåœ¨å‰é¢DDQNï¼ŒPrioritized Replay DQNä»£ç çš„åŸºç¡€ä¸Šï¼ŒæŠŠç½‘ç»œç»“æ„æ”¹æˆä¸Šé¢çš„å®šä¹‰ï¼Œè¿™æ ·Dueling DQNä¹Ÿå¯ä»¥èµ·ä½œç”¨ã€‚</p>
<h1 id="4-dqnæ€»ç»“">4. DQNæ€»ç»“</h1>
<p>DQNç³»åˆ—æˆ‘èŠ±äº†5ç¯‡æ¥è®²è§£ï¼Œä¸€å…±5ä¸ªå‰åæœ‰å…³è”çš„ç®—æ³•ï¼šDQN(NIPS2013), Nature DQN, DDQN, Prioritized Replay DQNå’ŒDueling DQNã€‚ç›®å‰ä½¿ç”¨çš„æ¯”è¾ƒä¸»æµçš„æ˜¯åé¢ä¸‰ç§ç®—æ³•æ€è·¯ï¼Œè¿™ä¸‰ç§ç®—æ³•æ€è·¯ä¹Ÿæ˜¯å¯ä»¥æ··ç€ä¸€èµ·ä½¿ç”¨çš„ï¼Œç›¸äº’å¹¶ä¸æ’æ–¥ã€‚</p>
<p>å½“ç„¶DQNå®¶æ—çš„ç®—æ³•è¿œè¿œä¸æ­¢è¿™äº›ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„DQNç®—æ³•æˆ‘æ²¡æœ‰è¯¦ç»†ä»‹ç»ï¼Œæ¯”å¦‚ä½¿ç”¨ä¸€äº›è¾ƒå¤æ‚çš„CNNå’ŒRNNç½‘ç»œæ¥æé«˜DQNçš„è¡¨è¾¾èƒ½åŠ›ï¼Œåˆæ¯”å¦‚æ”¹è¿›æ¢ç´¢çŠ¶æ€ç©ºé—´çš„æ–¹æ³•ç­‰ï¼Œä¸»è¦æ˜¯åœ¨DQNçš„åŸºç¡€ä¸ŠæŒç»­ä¼˜åŒ–ã€‚</p>
<p>DQNç®—æ˜¯æ·±åº¦å¼ºåŒ–å­¦ä¹ çš„ä¸­çš„ä¸»æµæµæ´¾ï¼Œä»£è¡¨äº†Value-Basedè¿™ä¸€å¤§ç±»æ·±åº¦å¼ºåŒ–å­¦ä¹ ç®—æ³•ã€‚ä½†æ˜¯å®ƒä¹Ÿæœ‰è‡ªå·±çš„ä¸€äº›é—®é¢˜ï¼Œå°±æ˜¯ç»å¤§å¤šæ•°DQNåªèƒ½å¤„ç†ç¦»æ•£çš„åŠ¨ä½œé›†åˆï¼Œä¸èƒ½å¤„ç†è¿ç»­çš„åŠ¨ä½œé›†åˆã€‚è™½ç„¶NAF DQNå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æ–¹æ³•è¿‡äºå¤æ‚äº†ã€‚è€Œæ·±åº¦å¼ºåŒ–å­¦ä¹ çš„å¦ä¸€ä¸ªä¸»æµæµæ´¾Policy-Basedè€Œå¯ä»¥è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»ä¸‹ä¸€ç¯‡æˆ‘ä»¬å¼€å§‹è®¨è®ºPolicy-Basedæ·±åº¦å¼ºåŒ–å­¦ä¹ ã€‚</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [11] | Prioritized Replay DQN</title><link>https://jianye0428.github.io/posts/rl_learning_note_11/</link><pubDate>Sun, 25 Feb 2024 11:16:48 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_11/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/9778063.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆåï¼‰Double DQN (DDQN)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°äº†DDQNä½¿ç”¨ä¸¤ä¸ªQç½‘ç»œï¼Œç”¨å½“å‰Qç½‘ç»œè®¡ç®—æœ€å¤§Qå€¼å¯¹åº”çš„åŠ¨ä½œï¼Œç”¨ç›®æ ‡Qç½‘ç»œè®¡ç®—è¿™ä¸ªæœ€å¤§åŠ¨ä½œå¯¹åº”çš„ç›®æ ‡Qå€¼ï¼Œè¿›è€Œæ¶ˆé™¤è´ªå©ªæ³•å¸¦æ¥çš„åå·®ã€‚ä»Šå¤©æˆ‘ä»¬åœ¨DDQNçš„åŸºç¡€ä¸Šï¼Œå¯¹ç»éªŒå›æ”¾éƒ¨åˆ†çš„é€»è¾‘åšä¼˜åŒ–ã€‚å¯¹åº”çš„ç®—æ³•æ˜¯Prioritized Replay DQNã€‚</p>
<p>æœ¬ç« å†…å®¹ä¸»è¦å‚è€ƒäº†ICML 2016çš„<a href="https://icml.cc/2016/tutorials/deep_rl_tutorial.pdf"target="_blank" rel="external nofollow noopener noreferrer">deep RL tutorial<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>å’ŒPrioritized Replay DQNçš„è®ºæ–‡(Prioritized Experience Replay)(ICLR 2016)ã€‚</p>
<h1 id="1-prioritized-replay-dqnä¹‹å‰ç®—æ³•çš„é—®é¢˜">1. Prioritized Replay DQNä¹‹å‰ç®—æ³•çš„é—®é¢˜</h1>
<p>åœ¨Prioritized Replay DQNä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºäº†å¾ˆå¤šç§DQNï¼Œæ¯”å¦‚Nature DQNï¼Œ DDQNç­‰ï¼Œä»–ä»¬éƒ½æ˜¯é€šè¿‡ç»éªŒå›æ”¾æ¥é‡‡æ ·ï¼Œè¿›è€Œåšç›®æ ‡Qå€¼çš„è®¡ç®—çš„ã€‚åœ¨é‡‡æ ·çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯ä¸€è§†åŒä»ï¼Œåœ¨ç»éªŒå›æ”¾æ± é‡Œé¢çš„æ‰€æœ‰çš„æ ·æœ¬éƒ½æœ‰ç›¸åŒçš„è¢«é‡‡æ ·åˆ°çš„æ¦‚ç‡ã€‚</p>
<p>ä½†æ˜¯æ³¨æ„åˆ°åœ¨ç»éªŒå›æ”¾æ± é‡Œé¢çš„ä¸åŒçš„æ ·æœ¬ç”±äºTDè¯¯å·®çš„ä¸åŒï¼Œå¯¹æˆ‘ä»¬åå‘ä¼ æ’­çš„ä½œç”¨æ˜¯ä¸ä¸€æ ·çš„ã€‚TDè¯¯å·®è¶Šå¤§ï¼Œé‚£ä¹ˆå¯¹æˆ‘ä»¬åå‘ä¼ æ’­çš„ä½œç”¨è¶Šå¤§ã€‚è€ŒTDè¯¯å·®å°çš„æ ·æœ¬ï¼Œç”±äºTDè¯¯å·®å°ï¼Œå¯¹åå‘æ¢¯åº¦çš„è®¡ç®—å½±å“ä¸å¤§ã€‚åœ¨Qç½‘ç»œä¸­ï¼ŒTDè¯¯å·®å°±æ˜¯ç›®æ ‡Qç½‘ç»œè®¡ç®—çš„ç›®æ ‡Qå€¼å’Œå½“å‰Qç½‘ç»œè®¡ç®—çš„Qå€¼ä¹‹é—´çš„å·®è·ã€‚</p>
<p>è¿™æ ·å¦‚æœTDè¯¯å·®çš„ç»å¯¹å€¼ $|Î´(t)|$è¾ƒå¤§çš„æ ·æœ¬æ›´å®¹æ˜“è¢«é‡‡æ ·ï¼Œåˆ™æˆ‘ä»¬çš„ç®—æ³•ä¼šæ¯”è¾ƒå®¹æ˜“æ”¶æ•›ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹Prioritized Replay DQNçš„ç®—æ³•æ€è·¯ã€‚</p>
<h1 id="2-prioritized-replay-dqnç®—æ³•çš„å»ºæ¨¡">2. Prioritized Replay DQNç®—æ³•çš„å»ºæ¨¡</h1>
<p>Prioritized Replay DQNæ ¹æ®æ¯ä¸ªæ ·æœ¬çš„TDè¯¯å·®ç»å¯¹å€¼ $|Î´(t)|$ï¼Œç»™å®šè¯¥æ ·æœ¬çš„ä¼˜å…ˆçº§æ­£æ¯”äº $|Î´(t)|$ï¼Œå°†è¿™ä¸ªä¼˜å…ˆçº§çš„å€¼å­˜å…¥ç»éªŒå›æ”¾æ± ã€‚å›å¿†ä¸‹ä¹‹å‰çš„DQNç®—æ³•ï¼Œæˆ‘ä»¬ä»…ä»…åªä¿å­˜å’Œç¯å¢ƒäº¤äº’å¾—åˆ°çš„æ ·æœ¬çŠ¶æ€ï¼ŒåŠ¨ä½œï¼Œå¥–åŠ±ç­‰æ•°æ®ï¼Œæ²¡æœ‰ä¼˜å…ˆçº§è¿™ä¸ªè¯´æ³•ã€‚</p>
<p>ç”±äºå¼•å…¥äº†ç»éªŒå›æ”¾çš„ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆPrioritized Replay DQNçš„ç»éªŒå›æ”¾æ± å’Œä¹‹å‰çš„å…¶ä»–DQNç®—æ³•çš„ç»éªŒå›æ”¾æ± å°±ä¸ä¸€æ ·äº†ã€‚å› ä¸ºè¿™ä¸ªä¼˜å…ˆçº§å¤§å°ä¼šå½±å“å®ƒè¢«é‡‡æ ·çš„æ¦‚ç‡ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨SumTreeè¿™æ ·çš„äºŒå‰æ ‘ç»“æ„æ¥åšæˆ‘ä»¬çš„å¸¦ä¼˜å…ˆçº§çš„ç»éªŒå›æ”¾æ± æ ·æœ¬çš„å­˜å‚¨ã€‚</p>
<p>å…·ä½“çš„SumTreeæ ‘ç»“æ„å¦‚ä¸‹å›¾ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">sum_tree ç»“æ„å›¾</div>
</center>
<br>
<p>æ‰€æœ‰çš„ç»éªŒå›æ”¾æ ·æœ¬åªä¿å­˜åœ¨æœ€ä¸‹é¢çš„å¶å­èŠ‚ç‚¹ä¸Šé¢ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸€ä¸ªæ ·æœ¬ã€‚å†…éƒ¨èŠ‚ç‚¹ä¸ä¿å­˜æ ·æœ¬æ•°æ®ã€‚è€Œå¶å­èŠ‚ç‚¹é™¤äº†ä¿å­˜æ•°æ®ä»¥å¤–ï¼Œè¿˜è¦ä¿å­˜è¯¥æ ·æœ¬çš„ä¼˜å…ˆçº§ï¼Œå°±æ˜¯å›¾ä¸­çš„æ˜¾ç¤ºçš„æ•°å­—ã€‚å¯¹äºå†…éƒ¨èŠ‚ç‚¹æ¯ä¸ªèŠ‚ç‚¹åªä¿å­˜è‡ªå·±çš„å„¿å­èŠ‚ç‚¹çš„ä¼˜å…ˆçº§å€¼ä¹‹å’Œï¼Œå¦‚å›¾ä¸­å†…éƒ¨èŠ‚ç‚¹ä¸Šæ˜¾ç¤ºçš„æ•°å­—ã€‚</p>
<p>è¿™æ ·ä¿å­˜æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿä¸»è¦æ˜¯æ–¹ä¾¿é‡‡æ ·ã€‚ä»¥ä¸Šé¢çš„æ ‘ç»“æ„ä¸ºä¾‹ï¼Œæ ¹èŠ‚ç‚¹æ˜¯42ï¼Œå¦‚æœè¦é‡‡æ ·ä¸€ä¸ªæ ·æœ¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨[0,42]ä¹‹é—´åšå‡åŒ€é‡‡æ ·ï¼Œé‡‡æ ·åˆ°å“ªä¸ªåŒºé—´ï¼Œå°±æ˜¯å“ªä¸ªæ ·æœ¬ã€‚æ¯”å¦‚æˆ‘ä»¬é‡‡æ ·åˆ°äº†26ï¼Œ åœ¨ï¼ˆ25-29ï¼‰è¿™ä¸ªåŒºé—´ï¼Œé‚£ä¹ˆå°±æ˜¯ç¬¬å››ä¸ªå¶å­èŠ‚ç‚¹è¢«é‡‡æ ·åˆ°ã€‚è€Œæ³¨æ„åˆ°ç¬¬ä¸‰ä¸ªå¶å­èŠ‚ç‚¹ä¼˜å…ˆçº§æœ€é«˜ï¼Œæ˜¯12ï¼Œå®ƒçš„åŒºé—´13-25ä¹Ÿæ˜¯æœ€é•¿çš„ï¼Œä¼šæ¯”å…¶ä»–èŠ‚ç‚¹æ›´å®¹æ˜“è¢«é‡‡æ ·åˆ°ã€‚</p>
<p>å¦‚æœè¦é‡‡æ ·ä¸¤ä¸ªæ ·æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨[0,21],[21,42]ä¸¤ä¸ªåŒºé—´åšå‡åŒ€é‡‡æ ·ï¼Œæ–¹æ³•å’Œä¸Šé¢é‡‡æ ·ä¸€ä¸ªæ ·æœ¬ç±»ä¼¼ã€‚</p>
<p>ç±»ä¼¼çš„é‡‡æ ·ç®—æ³•æ€æƒ³æˆ‘ä»¬åœ¨<a href="https://www.cnblogs.com/pinard/p/7249903.html"target="_blank" rel="external nofollow noopener noreferrer">word2vecåŸç†(ä¸‰) åŸºäºNegative Samplingçš„æ¨¡å‹<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ç¬¬å››èŠ‚ä¸­ä¹Ÿæœ‰è®²åˆ°ã€‚</p>
<p>é™¤äº†ç»éªŒå›æ”¾æ± ï¼Œç°åœ¨æˆ‘ä»¬çš„Qç½‘ç»œçš„ç®—æ³•æŸå¤±å‡½æ•°ä¹Ÿæœ‰ä¼˜åŒ–ï¼Œä¹‹å‰æˆ‘ä»¬çš„æŸå¤±å‡½æ•°æ˜¯ï¼š</p>
<p>$$\frac1m\sum_{j=1}^m(y_j-Q(\phi(S_j),A_j,w))^2$$</p>
<p>ç°åœ¨æˆ‘ä»¬æ–°çš„è€ƒè™‘äº†æ ·æœ¬ä¼˜å…ˆçº§çš„æŸå¤±å‡½æ•°æ˜¯</p>
<p>$$\frac1m\sum_{j=1}^mw_j(y_j-Q(\phi(S_j),A_j,w))^2$$</p>
<p>å…¶ä¸­ $w_j$æ˜¯ç¬¬jä¸ªæ ·æœ¬çš„ä¼˜å…ˆçº§æƒé‡ï¼Œç”±TDè¯¯å·® $|Î´(t)|$å½’ä¸€åŒ–å¾—åˆ°ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªè¦æ³¨æ„çš„ç‚¹å°±æ˜¯å½“æˆ‘ä»¬å¯¹Qç½‘ç»œå‚æ•°è¿›è¡Œäº†æ¢¯åº¦æ›´æ–°åï¼Œéœ€è¦é‡æ–°è®¡ç®—TDè¯¯å·®ï¼Œå¹¶å°†TDè¯¯å·®æ›´æ–°åˆ°SunTreeä¸Šé¢ã€‚</p>
<p>é™¤äº†ä»¥ä¸Šä¸‰ä¸ªéƒ¨åˆ†ï¼ŒPrioritized Replay DQNå’ŒDDQNçš„ç®—æ³•æµç¨‹ç›¸åŒã€‚</p>
<h1 id="3-prioritized-replay-dqnç®—æ³•æµç¨‹">3. Prioritized Replay DQNç®—æ³•æµç¨‹</h1>
<p>ä¸‹é¢æˆ‘ä»¬æ€»ç»“ä¸‹Prioritized Replay DQNçš„ç®—æ³•æµç¨‹ï¼ŒåŸºäºä¸Šä¸€èŠ‚çš„DDQNï¼Œå› æ­¤è¿™ä¸ªç®—æ³•æˆ‘ä»¬åº”è¯¥å«åšPrioritized Replay DDQNã€‚ä¸»æµç¨‹å‚è€ƒè®ºæ–‡(Prioritized Experience Replay)(ICLR 2016)ã€‚</p>
<ul>
<li>ç®—æ³•è¾“å…¥ï¼šè¿­ä»£è½®æ•° $T$ï¼ŒçŠ¶æ€ç‰¹å¾ç»´åº¦ $n$, åŠ¨ä½œé›† $A$, æ­¥é•¿ $Î±$ï¼Œé‡‡æ ·æƒé‡ç³»æ•° $Î²$ï¼Œè¡°å‡å› å­ $Î³$, æ¢ç´¢ç‡ $Ïµ$, å½“å‰Qç½‘ç»œ $Q$ï¼Œç›®æ ‡Qç½‘ç»œ $Q&rsquo;$, æ‰¹é‡æ¢¯åº¦ä¸‹é™çš„æ ·æœ¬æ•° $m$,ç›®æ ‡Qç½‘ç»œå‚æ•°æ›´æ–°é¢‘ç‡ $C$, SumTreeçš„å¶å­èŠ‚ç‚¹æ•° $S$ã€‚</li>
<li>è¾“å‡ºï¼šQç½‘ç»œå‚æ•°ã€‚</li>
<li>
<ol>
<li>éšæœºåˆå§‹åŒ–æ‰€æœ‰çš„çŠ¶æ€å’ŒåŠ¨ä½œå¯¹åº”çš„ä»·å€¼ $Q$. éšæœºåˆå§‹åŒ–å½“å‰Qç½‘ç»œçš„æ‰€æœ‰å‚æ•° $w$,åˆå§‹åŒ–ç›®æ ‡Qç½‘ç»œ $Q&rsquo;$çš„å‚æ•° $w&rsquo;=w$ã€‚åˆå§‹åŒ–ç»éªŒå›æ”¾SumTreeçš„é»˜è®¤æ•°æ®ç»“æ„ï¼Œæ‰€æœ‰SumTreeçš„Sä¸ªå¶å­èŠ‚ç‚¹çš„ä¼˜å…ˆçº§ $p_j$ä¸º1ã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>for i from 1 to Tï¼Œè¿›è¡Œè¿­ä»£ã€‚</li>
</ol>
<ul>
<li>a) åˆå§‹åŒ–Sä¸ºå½“å‰çŠ¶æ€åºåˆ—çš„ç¬¬ä¸€ä¸ªçŠ¶æ€, æ‹¿åˆ°å…¶ç‰¹å¾å‘é‡ $Ï•(S)$</li>
<li>b) åœ¨Qç½‘ç»œä¸­ä½¿ç”¨ $Ï•(S)$ ä½œä¸ºè¾“å…¥ï¼Œå¾—åˆ°Qç½‘ç»œçš„æ‰€æœ‰åŠ¨ä½œå¯¹åº”çš„Qå€¼è¾“å‡ºã€‚ç”¨ $Ïµâˆ’$è´ªå©ªæ³•åœ¨å½“å‰Qå€¼è¾“å‡ºä¸­é€‰æ‹©å¯¹åº”çš„åŠ¨ä½œ $A$</li>
<li>c) åœ¨çŠ¶æ€ $S$ æ‰§è¡Œå½“å‰åŠ¨ä½œ $A$,å¾—åˆ°æ–°çŠ¶æ€ $S&rsquo;$ å¯¹åº”çš„ç‰¹å¾å‘é‡ $Ï•(S&rsquo;)$å’Œå¥–åŠ± $R$,æ˜¯å¦ç»ˆæ­¢çŠ¶æ€ <code>is_end</code></li>
<li>d) å°† ${Ï•(S),A,R,Ï•(S&rsquo;),is_end}$è¿™ä¸ªäº”å…ƒç»„å­˜å…¥SumTree</li>
<li>e) $S=S'$</li>
<li>f) ä»SumTreeä¸­é‡‡æ · $m$ ä¸ªæ ·æœ¬ ${Ï•(S_j),A_j,R_j,Ï•(S&rsquo;_j),is_end_j},j=1,2.,,,m$ï¼Œæ¯ä¸ªæ ·æœ¬è¢«é‡‡æ ·çš„æ¦‚ç‡åŸºäº $P(j)=\frac{p_j}{\sum_i(p_i)}$ï¼ŒæŸå¤±å‡½æ•°æƒé‡ $w_j=(N*P(j))^{-\beta}/\max_i(w_i)$ï¼Œè®¡ç®—å½“å‰ç›®æ ‡Qå€¼ $y_j$:
<ul>
<li>$$\left.y_j=\left\\{\begin{matrix}R_j&amp;is_end_j\textit{is true}\\\\R_j+\gamma Q^{\prime}(\phi(S_j^{\prime}),\arg\max_{a^{\prime}}Q(\phi(S_j^{\prime}),a,w),w^{\prime})&amp;is_end_j\textit{is false}\end{matrix}\right.\right.$$</li>
</ul>
</li>
<li>g) ä½¿ç”¨å‡æ–¹å·®æŸå¤±å‡½æ•°$\begin{aligned}\frac{1}{m}\sum_{j=1}^mw_j(y_j-Q(\phi(S_j),A_j,w))^2\end{aligned}$ï¼Œé€šè¿‡ç¥ç»ç½‘ç»œçš„æ¢¯åº¦åå‘ä¼ æ’­æ¥æ›´æ–°Qç½‘ç»œçš„æ‰€æœ‰å‚æ•° $w$</li>
<li>h) é‡æ–°è®¡ç®—æ‰€æœ‰æ ·æœ¬çš„TDè¯¯å·® $\delta_j=y_j-Q(\phi(S_j),A_j,w)$ï¼Œæ›´æ–°SumTreeä¸­æ‰€æœ‰èŠ‚ç‚¹çš„ä¼˜å…ˆçº§ $p_j=|\delta_j|$</li>
<li>i) å¦‚æœi%C=1,åˆ™æ›´æ–°ç›®æ ‡Qç½‘ç»œå‚æ•° $w&rsquo;=w$</li>
<li>j) å¦‚æœ $S&rsquo;$æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œå½“å‰è½®è¿­ä»£å®Œæ¯•ï¼Œå¦åˆ™è½¬åˆ°æ­¥éª¤b)</li>
</ul>
</li>
</ul>
<p>æ³¨æ„ï¼Œä¸Šè¿°ç¬¬äºŒæ­¥çš„fæ­¥å’Œgæ­¥çš„Qå€¼è®¡ç®—ä¹Ÿéƒ½éœ€è¦é€šè¿‡Qç½‘ç»œè®¡ç®—å¾—åˆ°ã€‚å¦å¤–ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œä¸ºäº†ç®—æ³•è¾ƒå¥½çš„æ”¶æ•›ï¼Œæ¢ç´¢ç‡$Ïµ$éœ€è¦éšç€è¿­ä»£çš„è¿›è¡Œè€Œå˜å°ã€‚</p>
<h1 id="4-prioritized-replay-ddqnç®—æ³•æµç¨‹">4. Prioritized Replay DDQNç®—æ³•æµç¨‹</h1>
<p>ä¸‹é¢æˆ‘ä»¬ç»™å‡ºPrioritized Replay DDQNç®—æ³•çš„å®ä¾‹ä»£ç ã€‚ä»ç„¶ä½¿ç”¨äº†OpenAI Gymä¸­çš„CartPole-v0æ¸¸æˆæ¥ä½œä¸ºæˆ‘ä»¬ç®—æ³•åº”ç”¨ã€‚CartPole-v0æ¸¸æˆçš„ä»‹ç»å‚è§<a href="https://github.com/openai/gym/wiki/CartPole-v0"target="_blank" rel="external nofollow noopener noreferrer">è¿™é‡Œ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚å®ƒæ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬è¦æ±‚å°±æ˜¯æ§åˆ¶ä¸‹é¢çš„cartç§»åŠ¨ä½¿è¿æ¥åœ¨ä¸Šé¢çš„poleä¿æŒå‚ç›´ä¸å€’ã€‚è¿™ä¸ªä»»åŠ¡åªæœ‰ä¸¤ä¸ªç¦»æ•£åŠ¨ä½œï¼Œè¦ä¹ˆå‘å·¦ç”¨åŠ›ï¼Œè¦ä¹ˆå‘å³ç”¨åŠ›ã€‚è€ŒstateçŠ¶æ€å°±æ˜¯è¿™ä¸ªcartçš„ä½ç½®å’Œé€Ÿåº¦ï¼Œ poleçš„è§’åº¦å’Œè§’é€Ÿåº¦ï¼Œ4ç»´çš„ç‰¹å¾ã€‚åšæŒåˆ°200åˆ†çš„å¥–åŠ±åˆ™ä¸ºè¿‡å…³ã€‚</p>
<p>å®Œæ•´çš„ä»£ç å‚è§æˆ‘çš„github: <a href="https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/ddqn_prioritised_replay.py"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/ddqn_prioritised_replay.py<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼Œ ä»£ç ä¸­çš„SumTreeçš„ç»“æ„å’Œç»éªŒå›æ”¾æ± çš„ç»“æ„å‚è€ƒäº†morvanzhouçš„<a href="https://github.com/MorvanZhou/Reinforcement-learning-with-tensorflow/blob/master/contents/5.2_Prioritized_Replay_DQN/RL_brain.py"target="_blank" rel="external nofollow noopener noreferrer">githubä»£ç <i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚</p>
<p>è¿™é‡Œé‡ç‚¹è®²ä¸‹å’Œç¬¬ä¸‰èŠ‚ä¸­ç®—æ³•æè¿°ä¸åŒçš„åœ°æ–¹ï¼Œä¸»è¦æ˜¯ $w_j$çš„è®¡ç®—ã€‚æ³¨æ„åˆ°ï¼š</p>
<p>$$w_j=\frac{(N<em>P(j))^{-\beta}}{\max_i(w_i)}=\frac{(N</em>P(j))^{-\beta}}{\max_i((N*P(i))^{-\beta})}=\frac{(P(j))^{-\beta}}{\max_i((P(i))^{-\beta})}=(\frac{P_j}{\min_iP(i)})^{-\beta}$$</p>
<p>å› æ­¤ä»£ç é‡Œé¢$w_j$ï¼Œå³ISWeightsçš„è®¡ç®—ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p>
<p><a href="javascript:void%280%29;"></a></p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">b_idx</span><span class="p">,</span> <span class="n">b_memory</span><span class="p">,</span> <span class="n">ISWeights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="n">pri_seg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">total_p</span> <span class="o">/</span> <span class="n">n</span>       <span class="c1"># priority segment</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_increment_per_sampling</span><span class="p">])</span>  <span class="c1"># max = 1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">min_prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">tree</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">capacity</span><span class="p">:])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">total_p</span>     <span class="c1"># for later calculate ISweight</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">min_prob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">min_prob</span> <span class="o">=</span> <span class="mf">0.00001</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pri_seg</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">pri_seg</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">idx</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">get_leaf</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">prob</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">total_p</span>
</span></span><span class="line"><span class="cl">    <span class="n">ISWeights</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">prob</span><span class="o">/</span><span class="n">min_prob</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">b_idx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">b_memory</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">,</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">b_idx</span><span class="p">,</span> <span class="n">b_memory</span><span class="p">,</span> <span class="n">ISWeights</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ä»£ç çš„é‡‡æ ·åœ¨ç¬¬äºŒèŠ‚å·²ç»è®²åˆ°ã€‚æ ¹æ®æ ‘çš„ä¼˜å…ˆçº§çš„å’Œtotal_på’Œé‡‡æ ·æ•°nï¼Œå°†è¦é‡‡æ ·çš„åŒºé—´åˆ’åˆ†ä¸ºnæ®µï¼Œæ¯æ®µæ¥è¿›è¡Œå‡åŒ€é‡‡æ ·ï¼Œæ ¹æ®é‡‡æ ·åˆ°çš„å€¼è½åˆ°çš„åŒºé—´ï¼Œå†³å®šè¢«é‡‡æ ·åˆ°çš„å¶å­èŠ‚ç‚¹ã€‚å½“æˆ‘ä»¬æ‹¿åˆ°ç¬¬iæ®µçš„å‡åŒ€é‡‡æ ·å€¼vä»¥åï¼Œå°±å¯ä»¥å»SumTreeä¸­æ‰¾å¯¹åº”çš„å¶å­èŠ‚ç‚¹æ‹¿æ ·æœ¬æ•°æ®ï¼Œæ ·æœ¬å¶å­èŠ‚ç‚¹åºå·ä»¥åŠæ ·æœ¬ä¼˜å…ˆçº§äº†ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  Tree structure and array storage:
</span></span></span><span class="line"><span class="cl"><span class="s2">  Tree index:
</span></span></span><span class="line"><span class="cl"><span class="s2">        0         -&gt; storing priority sum
</span></span></span><span class="line"><span class="cl"><span class="s2">      / </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">    1     2
</span></span></span><span class="line"><span class="cl"><span class="s2">    / \   / </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">  3   4 5   6    -&gt; storing priority for transitions
</span></span></span><span class="line"><span class="cl"><span class="s2">  Array type for storing:
</span></span></span><span class="line"><span class="cl"><span class="s2">  [0,1,2,3,4,5,6]
</span></span></span><span class="line"><span class="cl"><span class="s2">  &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">parent_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>     <span class="c1"># the while loop is faster than the method in the reference code</span>
</span></span><span class="line"><span class="cl">    <span class="n">cl_idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">parent_idx</span> <span class="o">+</span> <span class="mi">1</span>         <span class="c1"># this leaf&#39;s left and right kids</span>
</span></span><span class="line"><span class="cl">    <span class="n">cr_idx</span> <span class="o">=</span> <span class="n">cl_idx</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">cl_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">):</span>        <span class="c1"># reach bottom, end search</span>
</span></span><span class="line"><span class="cl">      <span class="n">leaf_idx</span> <span class="o">=</span> <span class="n">parent_idx</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>       <span class="c1"># downward search, always search for a higher priority node</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">[</span><span class="n">cl_idx</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">parent_idx</span> <span class="o">=</span> <span class="n">cl_idx</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">v</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">[</span><span class="n">cl_idx</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">parent_idx</span> <span class="o">=</span> <span class="n">cr_idx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">data_idx</span> <span class="o">=</span> <span class="n">leaf_idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">leaf_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">[</span><span class="n">leaf_idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_idx</span><span class="p">]</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº†é‡‡æ ·éƒ¨åˆ†ï¼Œè¦æ³¨æ„çš„å°±æ˜¯å½“æ¢¯åº¦æ›´æ–°å®Œæ¯•åï¼Œæˆ‘ä»¬è¦å»æ›´æ–°SumTreeçš„æƒé‡ï¼Œä»£ç å¦‚ä¸‹ï¼Œæ³¨æ„å¶å­èŠ‚ç‚¹çš„æƒé‡æ›´æ–°åï¼Œè¦å‘ä¸Šå›æº¯ï¼Œæ›´æ–°æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹çš„æƒé‡ã€‚</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">batch_update</span><span class="p">(</span><span class="n">tree_idx</span><span class="p">,</span> <span class="n">abs_errors</span><span class="p">)</span>  <span class="c1"># update priority</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">batch_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree_idx</span><span class="p">,</span> <span class="n">abs_errors</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">abs_errors</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>  <span class="c1"># convert to abs and avoid 0</span>
</span></span><span class="line"><span class="cl">    <span class="n">clipped_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">abs_errors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_err_upper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">clipped_errors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">ti</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tree_idx</span><span class="p">,</span> <span class="n">ps</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree_idx</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">change</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">[</span><span class="n">tree_idx</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">[</span><span class="n">tree_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># then propagate the change through tree</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">tree_idx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>    <span class="c1"># this method is faster than the recursive loop in the reference code</span>
</span></span><span class="line"><span class="cl">      <span class="n">tree_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">tree_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">[</span><span class="n">tree_idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">change</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº†ä¸Šé¢è¿™éƒ¨åˆ†çš„åŒºåˆ«ï¼Œå’ŒDDQNæ¯”ï¼ŒTensorFlowçš„ç½‘ç»œç»“æ„æµç¨‹ä¸­å¤šäº†ä¸€ä¸ªTDè¯¯å·®çš„è®¡ç®—èŠ‚ç‚¹ï¼Œä»¥åŠæŸå¤±å‡½æ•°å¤šäº†ä¸€ä¸ªISWeightsç³»æ•°ã€‚æ­¤å¤–ï¼ŒåŒºåˆ«ä¸å¤§ã€‚</p>
<h1 id="5-prioritized-replay-dqnå°ç»“">5. Prioritized Replay DQNå°ç»“</h1>
<p>Prioritized Replay DQNå’ŒDDQNç›¸æ¯”ï¼Œæ”¶æ•›é€Ÿåº¦æœ‰äº†å¾ˆå¤§çš„æé«˜ï¼Œé¿å…äº†ä¸€äº›æ²¡æœ‰ä»·å€¼çš„è¿­ä»£ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªä¸é”™çš„ä¼˜åŒ–ç‚¹ã€‚åŒæ—¶å®ƒä¹Ÿå¯ä»¥ç›´æ¥é›†æˆDDQNç®—æ³•ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„DQNç®—æ³•ã€‚</p>
<p>ä¸‹ä¸€ç¯‡æˆ‘ä»¬è®¨è®ºDQNå®¶æ—çš„å¦ä¸€ä¸ªä¼˜åŒ–ç®—æ³•Duel DQNï¼Œå®ƒå°†ä»·å€¼Qåˆ†è§£ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯ä»…ä»…å—çŠ¶æ€ä½†ä¸å—åŠ¨ä½œå½±å“çš„éƒ¨åˆ†ï¼Œç¬¬äºŒéƒ¨åˆ†æ‰æ˜¯åŒæ—¶å—çŠ¶æ€å’ŒåŠ¨ä½œå½±å“çš„éƒ¨åˆ†ï¼Œç®—æ³•çš„æ•ˆæœä¹Ÿå¾ˆå¥½ã€‚</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [10] | Double DQN (DDQN)</title><link>https://jianye0428.github.io/posts/rl_learning_note_10/</link><pubDate>Fri, 23 Feb 2024 13:17:52 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_10/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/9756075.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆä¹ï¼‰Deep Q-Learningè¿›é˜¶ä¹‹Nature DQN<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†Nature DQNçš„ç®—æ³•æµç¨‹ï¼Œå®ƒé€šè¿‡ä½¿ç”¨ä¸¤ä¸ªç›¸åŒçš„ç¥ç»ç½‘ç»œï¼Œä»¥è§£å†³æ•°æ®æ ·æœ¬å’Œç½‘ç»œè®­ç»ƒä¹‹å‰çš„ç›¸å…³æ€§ã€‚ä½†æ˜¯è¿˜æ˜¯æœ‰å…¶ä»–å€¼å¾—ä¼˜åŒ–çš„ç‚¹ï¼Œæ–‡æœ¬å°±å…³æ³¨äºNature DQNçš„ä¸€ä¸ªæ”¹è¿›ç‰ˆæœ¬: Double DQNç®—æ³•ï¼ˆä»¥ä¸‹ç®€ç§°DDQNï¼‰ã€‚</p>
<p>æœ¬ç« å†…å®¹ä¸»è¦å‚è€ƒäº†ICML 2016çš„<a href="https://icml.cc/2016/tutorials/deep_rl_tutorial.pdf"target="_blank" rel="external nofollow noopener noreferrer">deep RL tutorial<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>å’ŒDDQNçš„è®ºæ–‡(Deep Reinforcement Learning with Double Q-learning)ã€‚</p>
<h1 id="1-dqnçš„ç›®æ ‡qå€¼è®¡ç®—é—®é¢˜">1. DQNçš„ç›®æ ‡Qå€¼è®¡ç®—é—®é¢˜</h1>
<p>åœ¨DDQNä¹‹å‰ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„ç›®æ ‡Qå€¼éƒ½æ˜¯é€šè¿‡<strong>è´ªå©ªæ³•</strong>ç›´æ¥å¾—åˆ°çš„ï¼Œæ— è®ºæ˜¯Q-Learningï¼Œ DQN(NIPS 2013)è¿˜æ˜¯ Nature DQNï¼Œéƒ½æ˜¯å¦‚æ­¤ã€‚æ¯”å¦‚å¯¹äºNature DQN,è™½ç„¶ç”¨äº†ä¸¤ä¸ªQç½‘ç»œå¹¶ä½¿ç”¨ç›®æ ‡Qç½‘ç»œè®¡ç®—Qå€¼ï¼Œå…¶ç¬¬jä¸ªæ ·æœ¬çš„ç›®æ ‡Qå€¼çš„è®¡ç®—è¿˜æ˜¯è´ªå©ªæ³•å¾—åˆ°çš„ï¼Œè®¡ç®—å¦‚ä¸‹å¼:</p>
<p>$$\left.y_j=\left{\begin{array}{ll}R_j&amp;is_end_j\textit{ is true}\R_j+\gamma\max_{a^{\prime}}Q^{\prime}(\phi(S_j^{\prime}),A_j^{\prime},w^{\prime})&amp;is_end_j\textit{ is false}\end{array}\right.\right.$$</p>
<p>ä½¿ç”¨maxè™½ç„¶å¯ä»¥å¿«é€Ÿè®©Qå€¼å‘å¯èƒ½çš„ä¼˜åŒ–ç›®æ ‡é æ‹¢ï¼Œä½†æ˜¯å¾ˆå®¹æ˜“è¿‡çŠ¹ä¸åŠï¼Œå¯¼è‡´è¿‡åº¦ä¼°è®¡(Over Estimation)ï¼Œæ‰€è°“è¿‡åº¦ä¼°è®¡å°±æ˜¯æœ€ç»ˆæˆ‘ä»¬å¾—åˆ°çš„ç®—æ³•æ¨¡å‹æœ‰å¾ˆå¤§çš„åå·®(bias)ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ DDQNé€šè¿‡è§£è€¦ç›®æ ‡Qå€¼åŠ¨ä½œçš„é€‰æ‹©å’Œç›®æ ‡Qå€¼çš„è®¡ç®—è¿™ä¸¤æ­¥ï¼Œæ¥è¾¾åˆ°æ¶ˆé™¤è¿‡åº¦ä¼°è®¡çš„é—®é¢˜ã€‚</p>
<h1 id="2-ddqnçš„ç®—æ³•å»ºæ¨¡">2. DDQNçš„ç®—æ³•å»ºæ¨¡</h1>
<p>DDQNå’ŒNature DQNä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸€æ ·çš„ä¸¤ä¸ªQç½‘ç»œç»“æ„ã€‚åœ¨Nature DQNçš„åŸºç¡€ä¸Šï¼Œé€šè¿‡è§£è€¦ç›®æ ‡Qå€¼åŠ¨ä½œçš„é€‰æ‹©å’Œç›®æ ‡Qå€¼çš„è®¡ç®—è¿™ä¸¤æ­¥ï¼Œæ¥æ¶ˆé™¤è¿‡åº¦ä¼°è®¡çš„é—®é¢˜ã€‚</p>
<p>åœ¨ä¸Šä¸€èŠ‚é‡Œï¼ŒNature DQNå¯¹äºéç»ˆæ­¢çŠ¶æ€ï¼Œå…¶ç›®æ ‡Qå€¼çš„è®¡ç®—å¼å­æ˜¯ï¼š</p>
<p>$$y_j=R_j+\gamma\max_{a^{\prime}}Q^{\prime}(\phi(S_j^{\prime}),A_j^{\prime},w^{\prime})$$</p>
<p>åœ¨DDQN(Double DQN)è¿™é‡Œï¼Œä¸å†æ˜¯ç›´æ¥åœ¨ç›®æ ‡Qç½‘ç»œé‡Œé¢æ‰¾å„ä¸ªåŠ¨ä½œä¸­æœ€å¤§Qå€¼ï¼Œè€Œæ˜¯å…ˆåœ¨å½“å‰Qç½‘ç»œä¸­å…ˆæ‰¾å‡ºæœ€å¤§Qå€¼å¯¹åº”çš„åŠ¨ä½œï¼Œå³:</p>
<p>$$a^{max}(S_j^{\prime},w)=\arg\max_{a^{\prime}}Q(\phi(S_j^{\prime}),a,w)$$</p>
<p>ç„¶ååˆ©ç”¨è¿™ä¸ªé€‰æ‹©å‡ºæ¥çš„åŠ¨ä½œ $\begin{aligned}&amp;a^{max}(S_j^{\prime},w)\end{aligned}$ åœ¨ç›®æ ‡ç½‘ç»œé‡Œé¢å»è®¡ç®—ç›®æ ‡Qå€¼ã€‚å³ï¼š</p>
<p>$$y_j=R_j+\gamma Q^{\prime}(\phi(S_j^{\prime}),a^{max}(S_j^{\prime},w),w^{\prime})$$</p>
<p>ç»¼åˆèµ·æ¥å†™å°±æ˜¯ï¼š</p>
<p>$$y_j=R_j+\gamma Q^{\prime}(\phi(S_j^{\prime}),\arg\max_{a^{\prime}}Q(\phi(S_j^{\prime}),a,w),w^{\prime})$$</p>
<p>é™¤äº†ç›®æ ‡Qå€¼çš„è®¡ç®—æ–¹å¼ä»¥å¤–ï¼ŒDDQNç®—æ³•å’ŒNature DQNçš„ç®—æ³•æµç¨‹å®Œå…¨ç›¸åŒã€‚</p>
<h1 id="3-ddqnç®—æ³•æµç¨‹">3. DDQNç®—æ³•æµç¨‹</h1>
<p>è¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸‹DDQNçš„ç®—æ³•æµç¨‹ï¼Œå’ŒNature DQNçš„åŒºåˆ«ä»…ä»…åœ¨æ­¥éª¤2.fä¸­ç›®æ ‡Qå€¼çš„è®¡ç®—ã€‚</p>
<ul>
<li>ç®—æ³•è¾“å…¥ï¼šè¿­ä»£è½®æ•° $T$ï¼ŒçŠ¶æ€ç‰¹å¾ç»´åº¦ $n$, åŠ¨ä½œé›† $A$, æ­¥é•¿ $Î±$ï¼Œè¡°å‡å› å­ $Î³$, æ¢ç´¢ç‡ $Ïµ$, å½“å‰Qç½‘ç»œ $Q$ï¼Œç›®æ ‡Qç½‘ç»œ $Q&rsquo;$, æ‰¹é‡æ¢¯åº¦ä¸‹é™çš„æ ·æœ¬ $m$,ç›®æ ‡Qç½‘ç»œå‚æ•°æ›´æ–°é¢‘ $C$ã€‚</li>
<li>è¾“å‡ºï¼šQç½‘ç»œå‚æ•°</li>
<li>
<ol>
<li>éšæœºåˆå§‹åŒ–æ‰€æœ‰çš„çŠ¶æ€å’ŒåŠ¨ä½œå¯¹åº”çš„ä»·å€¼ $Q$. éšæœºåˆå§‹åŒ–å½“å‰Qç½‘ç»œçš„æ‰€æœ‰å‚æ•° $w$,åˆå§‹åŒ–ç›®æ ‡Qç½‘ç»œ $Q&rsquo;çš„å‚æ•° $wâ€²=w$ ã€‚æ¸…ç©ºç»éªŒå›æ”¾çš„é›†åˆ $D$ã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>for i from 1 to Tï¼Œè¿›è¡Œè¿­ä»£ã€‚</li>
</ol>
<ul>
<li>a) åˆå§‹åŒ– $S$ä¸ºå½“å‰çŠ¶æ€åºåˆ—çš„ç¬¬ä¸€ä¸ªçŠ¶æ€, æ‹¿åˆ°å…¶ç‰¹å¾å‘é‡ $Ï•(S)$</li>
<li>b) åœ¨Qç½‘ç»œä¸­ä½¿ç”¨ $Ï•(S)$ä½œä¸ºè¾“å…¥ï¼Œå¾—åˆ°Qç½‘ç»œçš„æ‰€æœ‰åŠ¨ä½œå¯¹åº”çš„Qå€¼è¾“å‡ºã€‚ç”¨ $Ïµâˆ’$è´ªå©ªæ³•åœ¨å½“å‰Qå€¼è¾“å‡ºä¸­é€‰æ‹©å¯¹åº”çš„åŠ¨ä½œ $A$</li>
<li>c) åœ¨çŠ¶æ€ $S$æ‰§è¡Œå½“å‰åŠ¨ä½œ $A$,å¾—åˆ°æ–°çŠ¶æ€ $S&rsquo;$å¯¹åº”çš„ç‰¹å¾å‘é‡ $Ï•(S&rsquo;)$ å’Œå¥–åŠ± $R$,æ˜¯å¦ç»ˆæ­¢çŠ¶æ€ <code>is_end</code></li>
<li>d) å°† ${Ï•(S),A,R,Ï•(Sâ€²),is_end} $,è¿™ä¸ªäº”å…ƒç»„å­˜å…¥ç»éªŒå›æ”¾é›†åˆ $D$</li>
<li>e) $S=S'$</li>
<li>f) ä»ç»éªŒå›æ”¾é›†åˆ $D$ ä¸­é‡‡æ · $m$ ä¸ªæ ·æœ¬ ${Ï•(S_j),A_j,R_j,Ï•(S&rsquo;_j),is_end_j},j=1,2.,,,m$, è®¡ç®—å½“å‰ç›®æ ‡Qå€¼ $y_j$:
<ul>
<li>$$\left.y_j=\left{\begin{array}{ll}R_j&amp;is_end_j\textit{ is true}\R_j+\gamma Q^{\prime}(\phi(S_j^{\prime}),\arg\max_{a^{\prime}}Q(\phi(S_j^{\prime}),a,w),w^{\prime})&amp;is_end_j\textit{ is false}\end{array}\right.\right.$$</li>
</ul>
</li>
<li>g) ä½¿ç”¨å‡æ–¹å·®æŸå¤±å‡½æ•°$\frac1m\sum_{j=1}^m(y_j-Q(\phi(S_j),A_j,w))^2$ï¼Œé€šè¿‡ç¥ç»ç½‘ç»œçš„æ¢¯åº¦åå‘ä¼ æ’­æ¥æ›´æ–°Qç½‘ç»œçš„æ‰€æœ‰å‚æ•°wï¿½</li>
<li>h) å¦‚æœ $i%C=1$,åˆ™æ›´æ–°ç›®æ ‡Qç½‘ç»œå‚æ•° $w&rsquo;=w$</li>
<li>i) å¦‚æœ $S&rsquo;$æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œå½“å‰è½®è¿­ä»£å®Œæ¯•ï¼Œå¦åˆ™è½¬åˆ°æ­¥éª¤b)</li>
</ul>
</li>
</ul>
<p>æ³¨æ„ï¼Œä¸Šè¿°ç¬¬äºŒæ­¥çš„fæ­¥å’Œgæ­¥çš„Qå€¼è®¡ç®—ä¹Ÿéƒ½éœ€è¦é€šè¿‡Qç½‘ç»œè®¡ç®—å¾—åˆ°ã€‚å¦å¤–ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œä¸ºäº†ç®—æ³•è¾ƒå¥½çš„æ”¶æ•›ï¼Œæ¢ç´¢ç‡ $Ïµ$éœ€è¦éšç€è¿­ä»£çš„è¿›è¡Œè€Œå˜å°ã€‚</p>
<h1 id="4-ddqnç®—æ³•å®ä¾‹">4. DDQNç®—æ³•å®ä¾‹ã€€</h1>
<p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥æ¼”ç¤ºDQNçš„åº”ç”¨ã€‚ä»ç„¶ä½¿ç”¨äº†OpenAI Gymä¸­çš„CartPole-v0æ¸¸æˆæ¥ä½œä¸ºæˆ‘ä»¬ç®—æ³•åº”ç”¨ã€‚CartPole-v0æ¸¸æˆçš„ä»‹ç»å‚è§<a href="https://github.com/openai/gym/wiki/CartPole-v0"target="_blank" rel="external nofollow noopener noreferrer">è¿™é‡Œ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚å®ƒæ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬è¦æ±‚å°±æ˜¯æ§åˆ¶ä¸‹é¢çš„cartç§»åŠ¨ä½¿è¿æ¥åœ¨ä¸Šé¢çš„poleä¿æŒå‚ç›´ä¸å€’ã€‚è¿™ä¸ªä»»åŠ¡åªæœ‰ä¸¤ä¸ªç¦»æ•£åŠ¨ä½œï¼Œè¦ä¹ˆå‘å·¦ç”¨åŠ›ï¼Œè¦ä¹ˆå‘å³ç”¨åŠ›ã€‚è€ŒstateçŠ¶æ€å°±æ˜¯è¿™ä¸ªcartçš„ä½ç½®å’Œé€Ÿåº¦ï¼Œ poleçš„è§’åº¦å’Œè§’é€Ÿåº¦ï¼Œ4ç»´çš„ç‰¹å¾ã€‚åšæŒåˆ°200åˆ†çš„å¥–åŠ±åˆ™ä¸ºè¿‡å…³ã€‚</p>
<p>å®Œæ•´çš„ä»£ç å‚è§github: <a href="https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/ddqn.py"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/ddqn.py<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>è¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨DDQNå’Œä¸Šä¸€èŠ‚çš„Nature DQNçš„ä»£ç çš„ä¸åŒä¹‹å¤„ã€‚ä»£ç åªæœ‰ä¸€ä¸ªåœ°æ–¹ä¸ä¸€æ ·ï¼Œå°±æ˜¯è®¡ç®—ç›®æ ‡Qå€¼çš„æ—¶å€™ï¼Œå¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="c1"># Step 2: calculate y</span>
</span></span><span class="line"><span class="cl">  <span class="n">y_batch</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="n">current_Q_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q_value</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">:</span> <span class="n">next_state_batch</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="n">max_action_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">current_Q_batch</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">target_Q_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_Q_value</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">:</span> <span class="n">next_state_batch</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">BATCH_SIZE</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">done</span> <span class="o">=</span> <span class="n">minibatch</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">y_batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward_batch</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">target_Q_value</span> <span class="o">=</span> <span class="n">target_Q_batch</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">max_action_next</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">      <span class="n">y_batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward_batch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">GAMMA</span> <span class="o">*</span> <span class="n">target_Q_value</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è€Œä¹‹å‰çš„Nature DQNè¿™é‡Œçš„ç›®æ ‡Qå€¼è®¡ç®—æ˜¯å¦‚ä¸‹è¿™æ ·çš„ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"> <span class="c1"># Step 2: calculate y</span>
</span></span><span class="line"><span class="cl">  <span class="n">y_batch</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="n">Q_value_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_Q_value</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">:</span><span class="n">next_state_batch</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">BATCH_SIZE</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">done</span> <span class="o">=</span> <span class="n">minibatch</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">y_batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward_batch</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">y_batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward_batch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">GAMMA</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Q_value_batch</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº†ä¸Šé¢è¿™éƒ¨åˆ†çš„åŒºåˆ«ï¼Œä¸¤ä¸ªç®—æ³•çš„ä»£ç å®Œå…¨ç›¸åŒã€‚</p>
<h1 id="5-ddqnå°ç»“">5. DDQNå°ç»“</h1>
<p>DDQNç®—æ³•å‡ºæ¥ä»¥åï¼Œå–å¾—äº†æ¯”è¾ƒå¥½çš„æ•ˆæœï¼Œå› æ­¤å¾—åˆ°äº†æ¯”è¾ƒå¹¿æ³›çš„åº”ç”¨ã€‚ä¸è¿‡æˆ‘ä»¬çš„DQNä»ç„¶æœ‰å…¶ä»–å¯ä»¥ä¼˜åŒ–çš„ç‚¹ï¼Œå¦‚ä¸Šä¸€ç¯‡æœ€åè®²åˆ°çš„: éšæœºé‡‡æ ·çš„æ–¹æ³•å¥½å—ï¼ŸæŒ‰é“ç†ç»éªŒå›æ”¾é‡Œä¸åŒæ ·æœ¬çš„é‡è¦æ€§æ˜¯ä¸ä¸€æ ·çš„ï¼ŒTDè¯¯å·®å¤§çš„æ ·æœ¬é‡è¦ç¨‹åº¦åº”è¯¥é«˜ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚çš„Prioritised Replay DQNä¸­è®¨è®ºã€‚</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [9] | Deep Q-Learningè¿›é˜¶ä¹‹Nature DQN</title><link>https://jianye0428.github.io/posts/rl_learning_note_9/</link><pubDate>Fri, 23 Feb 2024 13:17:48 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_9/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/9714655.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆå…«ï¼‰ä»·å€¼å‡½æ•°çš„è¿‘ä¼¼è¡¨ç¤ºä¸Deep Q-Learning<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°äº†Deep Q-Learningï¼ˆNIPS 2013ï¼‰çš„ç®—æ³•å’Œä»£ç ï¼Œåœ¨è¿™ä¸ªç®—æ³•åŸºç¡€ä¸Šï¼Œæœ‰å¾ˆå¤šDeep Q-Learning(ä»¥ä¸‹ç®€ç§°DQN)çš„æ”¹è¿›ç‰ˆï¼Œä»Šå¤©æˆ‘ä»¬æ¥è®¨è®ºDQNçš„ç¬¬ä¸€ä¸ªæ”¹è¿›ç‰ˆNature DQN(NIPS 2015)ã€‚</p>
<p>æœ¬ç« å†…å®¹ä¸»è¦å‚è€ƒäº†ICML 2016çš„<a href="https://icml.cc/2016/tutorials/deep_rl_tutorial.pdf"target="_blank" rel="external nofollow noopener noreferrer">deep RL tutorial<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>å’ŒNature DQNçš„è®ºæ–‡ã€‚</p>
<h1 id="1-dqnnips-2013çš„é—®é¢˜">1. DQN(NIPS 2013)çš„é—®é¢˜</h1>
<p>åœ¨ä¸Šä¸€ç¯‡æˆ‘ä»¬å·²ç»è®¨è®ºäº†DQN(NIPS 2013)çš„ç®—æ³•åŸç†å’Œä»£ç å®ç°ï¼Œè™½ç„¶å®ƒå¯ä»¥è®­ç»ƒåƒCartPoleè¿™æ ·çš„ç®€å•æ¸¸æˆï¼Œä½†æ˜¯æœ‰å¾ˆå¤šé—®é¢˜ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆè®¨è®ºç¬¬ä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>æ³¨æ„åˆ°DQN(NIPS 2013)é‡Œé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ç›®æ ‡ $Q$å€¼çš„è®¡ç®—æ–¹å¼ï¼š</p>
<p>$$\left.y_j=\left\\{\begin{array}{ll}R_j&amp;is_end_j\textit{ is true}\\\\R_j+\gamma\max_{a^{\prime}}Q(\phi(S_j^{\prime}),A_j^{\prime},w)&amp;is_end_j\textit{ is false}\end{array}\right.\right.$$</p>
<p>è¿™é‡Œç›®æ ‡Qå€¼çš„è®¡ç®—ä½¿ç”¨åˆ°äº†å½“å‰è¦è®­ç»ƒçš„Qç½‘ç»œå‚æ•°æ¥è®¡ç®—$Q(\phi(S_j^{\prime}),A_j^{\prime},w)$ï¼Œè€Œå®é™…ä¸Šï¼Œæˆ‘ä»¬åˆå¸Œæœ›é€šè¿‡ $y_j$æ¥åç»­æ›´æ–° $Q$ç½‘ç»œå‚æ•°ã€‚è¿™æ ·ä¸¤è€…å¾ªç¯ä¾èµ–ï¼Œè¿­ä»£èµ·æ¥ä¸¤è€…çš„ç›¸å…³æ€§å°±å¤ªå¼ºäº†ã€‚ä¸åˆ©äºç®—æ³•çš„æ”¶æ•›ã€‚</p>
<p>å› æ­¤ï¼Œä¸€ä¸ªæ”¹è¿›ç‰ˆçš„DQN: Nature DQNå°è¯•<strong>ç”¨ä¸¤ä¸ªQç½‘ç»œæ¥å‡å°‘ç›®æ ‡Qå€¼è®¡ç®—å’Œè¦æ›´æ–°Qç½‘ç»œå‚æ•°ä¹‹é—´çš„ä¾èµ–å…³ç³»</strong>ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹Nature DQNæ˜¯æ€ä¹ˆåšçš„ã€‚</p>
<h1 id="2-nature-dqnçš„å»ºæ¨¡">2. Nature DQNçš„å»ºæ¨¡</h1>
<p>Nature DQNçš„ä¸¤ä¸ªQç½‘ç»œåˆ†åˆ«å‘½åä¸ºå½“å‰Qç½‘ç»œå’Œç›®æ ‡Qç½‘ç»œã€‚</p>
<p>Nature DQNä½¿ç”¨äº†ä¸¤ä¸ªQç½‘ç»œï¼Œä¸€ä¸ª<strong>å½“å‰Qç½‘ç»œ</strong>$Q$ç”¨æ¥é€‰æ‹©åŠ¨ä½œï¼Œæ›´æ–°æ¨¡å‹å‚æ•°ï¼Œå¦ä¸€ä¸ª<strong>ç›®æ ‡Qç½‘ç»œ</strong> $Q&rsquo;$ç”¨äºè®¡ç®—ç›®æ ‡Qå€¼ã€‚ç›®æ ‡Qç½‘ç»œçš„ç½‘ç»œå‚æ•°ä¸éœ€è¦è¿­ä»£æ›´æ–°ï¼Œè€Œæ˜¯æ¯éš”ä¸€æ®µæ—¶é—´ä»å½“å‰Qç½‘ç»œ$Q$å¤åˆ¶è¿‡æ¥ï¼Œå³å»¶æ—¶æ›´æ–°ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç›®æ ‡Qå€¼å’Œå½“å‰çš„Qå€¼ç›¸å…³æ€§ã€‚</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¤ä¸ªQç½‘ç»œçš„ç»“æ„æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚è¿™æ ·æ‰å¯ä»¥å¤åˆ¶ç½‘ç»œå‚æ•°ã€‚</p>
<p>Nature DQNå’Œä¸Šä¸€ç¯‡çš„DQNç›¸æ¯”ï¼Œé™¤äº†ç”¨ä¸€ä¸ªæ–°çš„ç›¸åŒç»“æ„çš„ç›®æ ‡Qç½‘ç»œæ¥è®¡ç®—ç›®æ ‡Qå€¼ä»¥å¤–ï¼Œå…¶ä½™éƒ¨åˆ†åŸºæœ¬æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚</p>
<h1 id="3-nature-dqnçš„ç®—æ³•æµç¨‹">3. Nature DQNçš„ç®—æ³•æµç¨‹</h1>
<p>ä¸‹é¢æˆ‘ä»¬æ¥æ€»ç»“ä¸‹Nature DQNçš„ç®—æ³•æµç¨‹ï¼Œ åŸºäºDQN NIPS 2015ï¼š</p>
<p>ç®—æ³•è¾“å…¥ï¼šè¿­ä»£è½®æ•° $T$ï¼ŒçŠ¶æ€ç‰¹å¾ç»´åº¦ $n$, åŠ¨ä½œé›† $A$, æ­¥é•¿ $Î±$ï¼Œè¡°å‡å› å­ $Î³$, æ¢ç´¢ç‡ $Ïµ$, å½“å‰Qç½‘ç»œ $Q$ï¼Œç›®æ ‡Qç½‘ç»œ $Q&rsquo;$, æ‰¹é‡æ¢¯åº¦ä¸‹é™çš„æ ·æœ¬æ•° $m$,ç›®æ ‡Qç½‘ç»œå‚æ•°æ›´æ–°é¢‘ç‡$C$ã€‚</p>
<p>è¾“å‡ºï¼š$Q$ç½‘ç»œå‚æ•°</p>
<ul>
<li>
<ol>
<li>éšæœºåˆå§‹åŒ–æ‰€æœ‰çš„çŠ¶æ€å’ŒåŠ¨ä½œå¯¹åº”çš„ä»·å€¼ $Q$. éšæœºåˆå§‹åŒ–å½“å‰Qç½‘ç»œçš„æ‰€æœ‰å‚æ•° $w$,åˆå§‹åŒ–ç›®æ ‡Qç½‘ç»œ $Q&rsquo;$çš„å‚æ•° $w&rsquo;=w$ã€‚æ¸…ç©ºç»éªŒå›æ”¾çš„é›†åˆ $D$ã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>for i from 1 to Tï¼Œè¿›è¡Œè¿­ä»£ã€‚</li>
</ol>
<ul>
<li>a) åˆå§‹åŒ–Sä¸ºå½“å‰çŠ¶æ€åºåˆ—çš„ç¬¬ä¸€ä¸ªçŠ¶æ€, æ‹¿åˆ°å…¶ç‰¹å¾å‘é‡ $Ï•(S)$</li>
<li>b) åœ¨Qç½‘ç»œä¸­ä½¿ç”¨ $Ï•(S)$ä½œä¸ºè¾“å…¥ï¼Œå¾—åˆ°Qç½‘ç»œçš„æ‰€æœ‰åŠ¨ä½œå¯¹åº”çš„Qå€¼è¾“å‡ºã€‚ç”¨ $Ïµâˆ’$è´ªå©ªæ³•åœ¨å½“å‰Qå€¼è¾“å‡ºä¸­é€‰æ‹©å¯¹åº”çš„åŠ¨ä½œ $A$</li>
<li>c) åœ¨çŠ¶æ€ $S$ æ‰§è¡Œå½“å‰åŠ¨ä½œ $A$,å¾—åˆ°æ–°çŠ¶æ€ $S&rsquo;$ å¯¹åº”çš„ç‰¹å¾å‘é‡ $Ï•(S&rsquo;)$ å’Œå¥–åŠ± $R$,æ˜¯å¦ç»ˆæ­¢çŠ¶æ€<code>is_end</code></li>
<li>d) å°† $\\{Ï•(S),A,R,Ï•(Sâ€²),is_end\\}$è¿™ä¸ªäº”å…ƒç»„å­˜å…¥ç»éªŒå›æ”¾é›†åˆ $D$</li>
<li>e) $S=S'$</li>
<li>f) ä»ç»éªŒå›æ”¾é›†åˆ $D$ ä¸­é‡‡æ · $m$ ä¸ªæ ·æœ¬ ${Ï•(S_j),A_j,R_j,Ï•(S&rsquo;_j),is_end_j},j=1,2.,,,m$ï¼Œè®¡ç®—å½“å‰ç›®æ ‡Qå€¼ $y_j$ï¼š
<ul>
<li>$$\left.y_j=\left\\{\begin{array}{ll}R_j&amp;is_end_j\textit{ is true}\\\\R_j+\gamma\max_{a^{\prime}}Q^{\prime}(\phi(S_j^{\prime}),A_j^{\prime},w^{\prime})&amp;is_end_j\textit{ is false}\end{array}\right.\right.$$</li>
</ul>
</li>
<li>g) ä½¿ç”¨å‡æ–¹å·®æŸå¤±å‡½æ•° $\frac1m\sum_{j=1}^m(y_j-Q(\phi(S_j),A_j,w))^2$ï¼Œé€šè¿‡ç¥ç»ç½‘ç»œçš„æ¢¯åº¦åå‘ä¼ æ’­æ¥æ›´æ–°Qç½‘ç»œçš„æ‰€æœ‰å‚æ•° $w$</li>
<li>h) å¦‚æœ $i%C=1$, åˆ™æ›´æ–°ç›®æ ‡Qç½‘ç»œå‚æ•° $w&rsquo;=w$</li>
<li>i) å¦‚æœ $S&rsquo;$æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œå½“å‰è½®è¿­ä»£å®Œæ¯•ï¼Œå¦åˆ™è½¬åˆ°æ­¥éª¤b)</li>
</ul>
</li>
</ul>
<p>æ³¨æ„ï¼Œä¸Šè¿°ç¬¬äºŒæ­¥çš„fæ­¥å’Œgæ­¥çš„Qå€¼è®¡ç®—ä¹Ÿéƒ½éœ€è¦é€šè¿‡Qç½‘ç»œè®¡ç®—å¾—åˆ°ã€‚å¦å¤–ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œä¸ºäº†ç®—æ³•è¾ƒå¥½çš„æ”¶æ•›ï¼Œæ¢ç´¢ç‡ $Ïµ$ éœ€è¦éšç€è¿­ä»£çš„è¿›è¡Œè€Œå˜å°ã€‚</p>
<h1 id="4-nature-dqnç®—æ³•å®ä¾‹">4. Nature DQNç®—æ³•å®ä¾‹</h1>
<p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥æ¼”ç¤ºDQNçš„åº”ç”¨ã€‚ä»ç„¶ä½¿ç”¨äº†OpenAI Gymä¸­çš„CartPole-v0æ¸¸æˆæ¥ä½œä¸ºæˆ‘ä»¬ç®—æ³•åº”ç”¨ã€‚CartPole-v0æ¸¸æˆçš„ä»‹ç»å‚è§<a href="https://github.com/openai/gym/wiki/CartPole-v0"target="_blank" rel="external nofollow noopener noreferrer">è¿™é‡Œ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚å®ƒæ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬è¦æ±‚å°±æ˜¯æ§åˆ¶ä¸‹é¢çš„cartç§»åŠ¨ä½¿è¿æ¥åœ¨ä¸Šé¢çš„poleä¿æŒå‚ç›´ä¸å€’ã€‚è¿™ä¸ªä»»åŠ¡åªæœ‰ä¸¤ä¸ªç¦»æ•£åŠ¨ä½œï¼Œè¦ä¹ˆå‘å·¦ç”¨åŠ›ï¼Œè¦ä¹ˆå‘å³ç”¨åŠ›ã€‚è€ŒstateçŠ¶æ€å°±æ˜¯è¿™ä¸ªcartçš„ä½ç½®å’Œé€Ÿåº¦ï¼Œ poleçš„è§’åº¦å’Œè§’é€Ÿåº¦ï¼Œ4ç»´çš„ç‰¹å¾ã€‚åšæŒåˆ°200åˆ†çš„å¥–åŠ±åˆ™ä¸ºè¿‡å…³ã€‚</p>
<p>å®Œæ•´çš„ä»£ç å‚è§github: <a href="https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/nature_dqn.py"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/nature_dqn.py<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>è¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨Nature DQNå’Œä¸Šä¸€èŠ‚çš„NIPS 2013 DQNçš„ä»£ç çš„ä¸åŒä¹‹å¤„ã€‚</p>
<p>é¦–å…ˆæ˜¯Qç½‘ç»œï¼Œä¸Šä¸€ç¯‡çš„DQNæ˜¯ä¸€ä¸ªä¸‰å±‚çš„ç¥ç»ç½‘ç»œï¼Œè€Œè¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªä¸€æ ·çš„ä¸‰å±‚ç¥ç»ç½‘ç»œï¼Œä¸€ä¸ªæ˜¯å½“å‰Qç½‘ç»œï¼Œä¸€ä¸ªæ˜¯ç›®æ ‡Qç½‘ç»œï¼Œç½‘ç»œçš„å®šä¹‰éƒ¨åˆ†å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">create_Q_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># input layer</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">state_input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s2">&#34;float&#34;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># network weights</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="s1">&#39;current_net&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="n">W1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="n">b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="n">W2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="n">b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1"># hidden layers</span>
</span></span><span class="line"><span class="cl">      <span class="n">h_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">,</span><span class="n">W1</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># Q Value layer</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">Q_value</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">h_layer</span><span class="p">,</span><span class="n">W2</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="s1">&#39;target_net&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="n">W1t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="n">b1t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="n">W2t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_variable</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="n">b2t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_variable</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1"># hidden layers</span>
</span></span><span class="line"><span class="cl">      <span class="n">h_layer_t</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">,</span><span class="n">W1t</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># Q Value layer</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">target_Q_value</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">h_layer</span><span class="p">,</span><span class="n">W2t</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2t</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºå®šæœŸå°†ç›®æ ‡Qç½‘ç»œçš„å‚æ•°æ›´æ–°çš„ä»£ç å¦‚ä¸‹é¢ä¸¤éƒ¨åˆ†ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="n">t_params</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">GraphKeys</span><span class="o">.</span><span class="n">GLOBAL_VARIABLES</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="s1">&#39;target_net&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">e_params</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">GraphKeys</span><span class="o">.</span><span class="n">GLOBAL_VARIABLES</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="s1">&#39;current_net&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="s1">&#39;soft_replacement&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">target_replace_op</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t_params</span><span class="p">,</span> <span class="n">e_params</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">update_target_q_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># update target Q netowrk</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">episode</span> <span class="o">%</span> <span class="n">REPLACE_TARGET_FREQ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_replace_op</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="c1">#print(&#39;episode &#39;+str(episode) +&#39;, target Q network params replaced!&#39;)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤å¤–ï¼Œæ³¨æ„ä¸‹æˆ‘ä»¬è®¡ç®—ç›®æ ‡Qå€¼çš„éƒ¨åˆ†ï¼Œè¿™é‡Œä½¿ç”¨çš„ç›®æ ‡Qç½‘ç»œçš„å‚æ•°ï¼Œè€Œä¸æ˜¯å½“å‰Qç½‘ç»œçš„å‚æ•°ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="c1"># Step 2: calculate y</span>
</span></span><span class="line"><span class="cl">  <span class="n">y_batch</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="n">Q_value_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_Q_value</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">:</span><span class="n">next_state_batch</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">BATCH_SIZE</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">done</span> <span class="o">=</span> <span class="n">minibatch</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">y_batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward_batch</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">y_batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward_batch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">GAMMA</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Q_value_batch</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä½™éƒ¨åˆ†åŸºæœ¬å’Œä¸Šä¸€ç¯‡DQNçš„ä»£ç ç›¸åŒã€‚è¿™é‡Œç»™å‡ºæˆ‘è·‘çš„æŸä¸€æ¬¡çš„ç»“æœ:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">episode: <span class="m">0</span> Evaluation Average Reward: 9.8
</span></span><span class="line"><span class="cl">episode: <span class="m">100</span> Evaluation Average Reward: 9.8
</span></span><span class="line"><span class="cl">episode: <span class="m">200</span> Evaluation Average Reward: 9.6
</span></span><span class="line"><span class="cl">episode: <span class="m">300</span> Evaluation Average Reward: 10.0
</span></span><span class="line"><span class="cl">episode: <span class="m">400</span> Evaluation Average Reward: 34.8
</span></span><span class="line"><span class="cl">episode: <span class="m">500</span> Evaluation Average Reward: 177.4
</span></span><span class="line"><span class="cl">episode: <span class="m">600</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">700</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">800</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">900</span> Evaluation Average Reward: 198.4
</span></span><span class="line"><span class="cl">episode: <span class="m">1000</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1100</span> Evaluation Average Reward: 193.2
</span></span><span class="line"><span class="cl">episode: <span class="m">1200</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1300</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1400</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1500</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1600</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1700</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1800</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1900</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2000</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2100</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2200</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2300</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2400</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2500</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2600</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2700</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2800</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2900</span> Evaluation Average Reward: 200.0</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼Œç”±äºDQNä¸ä¿è¯ç¨³å®šçš„æ”¶æ•›ï¼Œæ‰€ä»¥æ¯æ¬¡è·‘çš„ç»“æœä¼šä¸åŒï¼Œå¦‚æœä½ è·‘çš„ç»“æœåé¢ä»ç„¶æ”¶æ•›çš„ä¸å¥½ï¼Œå¯ä»¥æŠŠä»£ç å¤šè·‘å‡ æ¬¡ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€å¥½çš„è®­ç»ƒç»“æœã€‚</p>
<h1 id="5-nature-dqnæ€»ç»“">5. Nature DQNæ€»ç»“</h1>
<p>Nature DQNå¯¹DQN NIPS 2013åšäº†ç›¸å…³æ€§æ–¹é¢çš„æ”¹è¿›ï¼Œè¿™ä¸ªæ”¹è¿›è™½ç„¶ä¸é”™ï¼Œä½†æ˜¯ä»ç„¶æ²¡æœ‰è§£å†³DQNçš„ å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>1ï¼‰ ç›®æ ‡Qå€¼çš„è®¡ç®—æ˜¯å¦å‡†ç¡®ï¼Ÿå…¨éƒ¨é€šè¿‡max Qæ¥è®¡ç®—æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿ</li>
<li>2ï¼‰ éšæœºé‡‡æ ·çš„æ–¹æ³•å¥½å—ï¼ŸæŒ‰é“ç†ä¸åŒæ ·æœ¬çš„é‡è¦æ€§æ˜¯ä¸ä¸€æ ·çš„ã€‚</li>
<li>3ï¼‰ Qå€¼ä»£è¡¨çŠ¶æ€ï¼ŒåŠ¨ä½œçš„ä»·å€¼ï¼Œé‚£ä¹ˆå•ç‹¬åŠ¨ä½œä»·å€¼çš„è¯„ä¼°ä¼šä¸ä¼šæ›´å‡†ç¡®ï¼Ÿ</li>
</ul>
<p>ç¬¬ä¸€ä¸ªé—®é¢˜å¯¹åº”çš„æ”¹è¿›æ˜¯Double DQN, ç¬¬äºŒä¸ªé—®é¢˜çš„æ”¹è¿›æ˜¯Prioritised Replay DQNï¼Œç¬¬ä¸‰ä¸ªé—®é¢˜çš„æ”¹è¿›æ˜¯Dueling DQNï¼Œè¿™ä¸‰ä¸ªDQNçš„æ”¹è¿›ç‰ˆæˆ‘ä»¬åœ¨ä¸‹ä¸€ç¯‡æ¥è®¨è®ºã€‚</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [8] | ä»·å€¼å‡½æ•°çš„è¿‘ä¼¼è¡¨ç¤ºä¸Deep Q-Learning</title><link>https://jianye0428.github.io/posts/rl_learning_note_8/</link><pubDate>Fri, 23 Feb 2024 13:17:44 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_8/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨å¼ºåŒ–å­¦ä¹ ç³»åˆ—çš„<a href="https://www.cnblogs.com/pinard/p/9385570.html"target="_blank" rel="external nofollow noopener noreferrer">å‰ä¸ƒç¯‡<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>é‡Œï¼Œæˆ‘ä»¬ä¸»è¦è®¨è®ºçš„éƒ½æ˜¯è§„æ¨¡æ¯”è¾ƒå°çš„å¼ºåŒ–å­¦ä¹ é—®é¢˜æ±‚è§£ç®—æ³•ã€‚ä»Šå¤©å¼€å§‹æˆ‘ä»¬æ­¥å…¥æ·±åº¦å¼ºåŒ–å­¦ä¹ ã€‚è¿™ä¸€ç¯‡å…³æ³¨äºä»·å€¼å‡½æ•°çš„è¿‘ä¼¼è¡¨ç¤ºå’ŒDeep Q-Learningç®—æ³•ã€‚</p>
<p>Deep Q-Learningè¿™ä¸€ç¯‡å¯¹åº”Suttonä¹¦çš„ç¬¬11ç« éƒ¨åˆ†å’ŒUCLå¼ºåŒ–å­¦ä¹ è¯¾ç¨‹çš„ç¬¬å…­è®²ã€‚</p>
<h1 id="1-ä¸ºä½•éœ€è¦ä»·å€¼å‡½æ•°çš„è¿‘ä¼¼è¡¨ç¤º">1. ä¸ºä½•éœ€è¦ä»·å€¼å‡½æ•°çš„è¿‘ä¼¼è¡¨ç¤º</h1>
<p>åœ¨ä¹‹å‰è®²åˆ°äº†å¼ºåŒ–å­¦ä¹ æ±‚è§£æ–¹æ³•ï¼Œæ— è®ºæ˜¯åŠ¨æ€è§„åˆ’DPï¼Œè’™ç‰¹å¡ç½—æ–¹æ³•MCï¼Œè¿˜æ˜¯æ—¶åºå·®åˆ†TDï¼Œä½¿ç”¨çš„çŠ¶æ€éƒ½æ˜¯ç¦»æ•£çš„æœ‰é™ä¸ªçŠ¶æ€é›†åˆ $S$ã€‚æ­¤æ—¶é—®é¢˜çš„è§„æ¨¡æ¯”è¾ƒå°ï¼Œæ¯”è¾ƒå®¹æ˜“æ±‚è§£ã€‚ä½†æ˜¯å‡å¦‚æˆ‘ä»¬é‡åˆ°å¤æ‚çš„çŠ¶æ€é›†åˆå‘¢ï¼Ÿç”šè‡³å¾ˆå¤šæ—¶å€™ï¼ŒçŠ¶æ€æ˜¯è¿ç»­çš„ï¼Œé‚£ä¹ˆå°±ç®—ç¦»æ•£åŒ–åï¼Œé›†åˆä¹Ÿå¾ˆå¤§ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„ä¼ ç»Ÿæ–¹æ³•ï¼Œæ¯”å¦‚Q-Learningï¼Œæ ¹æœ¬æ— æ³•åœ¨å†…å­˜ä¸­ç»´æŠ¤è¿™ä¹ˆå¤§çš„ä¸€å¼ Qè¡¨ã€‚ã€€ã€€ã€€ã€€</p>
<p>æ¯”å¦‚ç»å…¸çš„å†°çƒä¸–ç•Œ(PuckWorld)å¼ºåŒ–å­¦ä¹ é—®é¢˜ï¼Œå…·ä½“çš„åŠ¨æ€demoè§<a href="https://cs.stanford.edu/people/karpathy/reinforcejs/puckworld.html"target="_blank" rel="external nofollow noopener noreferrer">è¿™é‡Œ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚ç¯å¢ƒç”±ä¸€ä¸ªæ­£æ–¹å½¢åŒºåŸŸæ„æˆä»£è¡¨ç€å†°çƒåœºåœ°ï¼Œåœºåœ°å†…å¤§çš„åœ†ä»£è¡¨ç€è¿åŠ¨å‘˜ä¸ªä½“ï¼Œå°åœ†ä»£è¡¨ç€ç›®æ ‡å†°çƒã€‚åœ¨è¿™ä¸ªæ­£æ–¹å½¢ç¯å¢ƒä¸­ï¼Œå°åœ†ä¼šæ¯éš”ä¸€å®šçš„æ—¶é—´éšæœºæ”¹å˜åœ¨åœºåœ°çš„ä½ç½®ï¼Œè€Œä»£è¡¨ä¸ªä½“çš„å¤§åœ†çš„ä»»åŠ¡å°±æ˜¯å°½å¯èƒ½å¿«çš„æ¥è¿‘å†°çƒç›®æ ‡ã€‚å¤§åœ†å¯ä»¥æ“ä½œçš„è¡Œä¸ºæ˜¯åœ¨æ°´å¹³å’Œç«–ç›´å…±å››ä¸ªæ–¹å‘ä¸Šæ–½åŠ ä¸€ä¸ªæ—¶é—´æ­¥æ—¶é•¿çš„ä¸€ä¸ªå¤§å°å›ºå®šçš„åŠ›ï¼Œå€Ÿæ­¤æ¥æ”¹å˜å¤§åœ†çš„é€Ÿåº¦ã€‚ç¯å¢ƒä¼šåœ¨æ¯ä¸€ä¸ªæ—¶é—´æ­¥å†…å‘Šè¯‰ä¸ªä½“å½“å‰çš„æ°´å¹³ä¸å‚ç›´åæ ‡ã€å½“å‰çš„é€Ÿåº¦åœ¨æ°´å¹³å’Œå‚ç›´æ–¹å‘ä¸Šçš„åˆ†é‡ä»¥åŠç›®æ ‡çš„æ°´å¹³å’Œå‚ç›´åæ ‡å…±6é¡¹æ•°æ®ï¼Œå¥–åŠ±å€¼ä¸ºä¸ªä½“ä¸ç›®æ ‡ä¸¤è€…ä¸­å¿ƒè·ç¦»çš„è´Ÿæ•°ï¼Œä¹Ÿå°±æ˜¯è·ç¦»è¶Šå¤§å¥–åŠ±å€¼è¶Šä½ä¸”æœ€é«˜å¥–åŠ±å€¼ä¸º0ã€‚</p>
<p>åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼ŒçŠ¶æ€æ˜¯ä¸€ä¸ª6ç»´çš„å‘é‡ï¼Œå¹¶ä¸”æ˜¯è¿ç»­å€¼ã€‚æ²¡æ³•ç›´æ¥ç”¨ä¹‹å‰ç¦»æ•£é›†åˆçš„æ–¹æ³•æ¥æè¿°çŠ¶æ€ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿ç»­ç‰¹å¾ç¦»æ•£åŒ–ã€‚æ¯”å¦‚æŠŠè¿™ä¸ªå†°çƒåœº100x100çš„æ¡†æŒ‰1x1çš„æ ¼å­åˆ’åˆ†æˆ10000ä¸ªæ ¼å­ï¼Œé‚£ä¹ˆå¯¹äºè¿åŠ¨å‘˜çš„åæ ‡å’Œå†°çƒçš„åæ ‡å°±æœ‰$10^4âˆ—10^4=10^8$æ¬¡ç§ï¼Œå¦‚æœå†åŠ ä¸Šä¸ªä½“é€Ÿåº¦çš„åˆ†é‡å°±æ›´æ˜¯å¤©æ–‡æ•°å­—äº†ï¼Œæ­¤æ—¶ä¹‹å‰è®²è¿‡çš„å¼ºåŒ–å­¦ä¹ æ–¹æ³•éƒ½ä¼šå› ä¸ºé—®é¢˜çš„è§„æ¨¡å¤ªå¤§è€Œæ— æ³•ä½¿ç”¨ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿå¿…é¡»è¦å¯¹é—®é¢˜çš„å»ºæ¨¡åšä¿®æ”¹äº†ï¼Œè€Œä»·å€¼å‡½æ•°çš„è¿‘ä¼¼è¡¨ç¤ºå°±æ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ³•ã€‚</p>
<h1 id="2-ä»·å€¼å‡½æ•°çš„è¿‘ä¼¼è¡¨ç¤ºæ–¹æ³•">2. ä»·å€¼å‡½æ•°çš„è¿‘ä¼¼è¡¨ç¤ºæ–¹æ³•</h1>
<p>ç”±äºé—®é¢˜çš„çŠ¶æ€é›†åˆè§„æ¨¡å¤§ï¼Œä¸€ä¸ªå¯è¡Œçš„å»ºæ¨¡æ–¹æ³•æ˜¯ä»·å€¼å‡½æ•°çš„è¿‘ä¼¼è¡¨ç¤ºã€‚æ–¹æ³•æ˜¯æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªçŠ¶æ€ä»·å€¼å‡½æ•° $\hat{v}$, è¿™ä¸ªå‡½æ•°ç”±å‚æ•° $w$ æè¿°ï¼Œå¹¶æ¥å—çŠ¶æ€ $s$ ä½œä¸ºè¾“å…¥ï¼Œè®¡ç®—åå¾—åˆ°çŠ¶æ€ $s$ çš„ä»·å€¼ï¼Œå³æˆ‘ä»¬æœŸæœ›ï¼š</p>
<p>$$\hat{v}(s,w)\approx v_\pi(s)$$</p>
<p>ç±»ä¼¼çš„ï¼Œå¼•å…¥ä¸€ä¸ªåŠ¨ä½œä»·å€¼å‡½æ•° $\hat{q}$ï¼Œè¿™ä¸ªå‡½æ•°ç”±å‚æ•° $w$ æè¿°ï¼Œå¹¶æ¥å—çŠ¶æ€ $s$ ä¸åŠ¨ä½œ $a$ ä½œä¸ºè¾“å…¥ï¼Œè®¡ç®—åå¾—åˆ°åŠ¨ä½œä»·å€¼ï¼Œå³æˆ‘ä»¬æœŸæœ›ï¼š</p>
<p>$$\hat{q}(s,a,w)\approx q_\pi(s,a)$$</p>
<p>ä»·å€¼å‡½æ•°è¿‘ä¼¼çš„æ–¹æ³•å¾ˆå¤šï¼Œæ¯”å¦‚æœ€ç®€å•çš„çº¿æ€§è¡¨ç¤ºæ³•ï¼Œç”¨ $Ï•(s)$è¡¨ç¤ºçŠ¶æ€ $s$ çš„ç‰¹å¾å‘é‡ï¼Œåˆ™æ­¤æ—¶æˆ‘ä»¬çš„çŠ¶æ€ä»·å€¼å‡½æ•°å¯ä»¥è¿‘ä¼¼è¡¨ç¤ºä¸ºï¼š</p>
<p>$$\hat{v}(s,w)=\phi(s)^Tw$$</p>
<p>å½“ç„¶ï¼Œé™¤äº†çº¿æ€§è¡¨ç¤ºæ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨å†³ç­–æ ‘ï¼Œæœ€è¿‘é‚»ï¼Œå‚…é‡Œå¶å˜æ¢ï¼Œç¥ç»ç½‘ç»œæ¥è¡¨è¾¾æˆ‘ä»¬çš„çŠ¶æ€ä»·å€¼å‡½æ•°ã€‚è€Œæœ€å¸¸è§ï¼Œåº”ç”¨æœ€å¹¿æ³›çš„è¡¨ç¤ºæ–¹æ³•æ˜¯ç¥ç»ç½‘ç»œã€‚å› æ­¤åé¢æˆ‘ä»¬çš„è¿‘ä¼¼è¡¨è¾¾æ–¹æ³•å¦‚æœæ²¡æœ‰ç‰¹åˆ«æåˆ°ï¼Œéƒ½æ˜¯æŒ‡çš„ç¥ç»ç½‘ç»œçš„è¿‘ä¼¼è¡¨ç¤ºã€‚</p>
<p>å¯¹äºç¥ç»ç½‘ç»œï¼Œå¯ä»¥ä½¿ç”¨DNNï¼ŒCNNæˆ–è€…RNNã€‚æ²¡æœ‰ç‰¹åˆ«çš„é™åˆ¶ã€‚å¦‚æœæŠŠæˆ‘ä»¬è®¡ç®—ä»·å€¼å‡½æ•°çš„ç¥ç»ç½‘ç»œçœ‹åšä¸€ä¸ªé»‘ç›’å­ï¼Œé‚£ä¹ˆæ•´ä¸ªè¿‘ä¼¼è¿‡ç¨‹å¯ä»¥çœ‹åšä¸‹é¢è¿™ä¸‰ç§æƒ…å†µï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">ç¥ç»ç½‘ç»œæ‹Ÿåˆä»·å€¼å‡½æ•°</div>
</center>
<br>
<p>å¯¹äºçŠ¶æ€ä»·å€¼å‡½æ•°ï¼Œç¥ç»ç½‘ç»œçš„è¾“å…¥æ˜¯çŠ¶æ€sçš„ç‰¹å¾å‘é‡ï¼Œè¾“å‡ºæ˜¯çŠ¶æ€ä»·å€¼ $\hat{v}(s,w)$ã€‚å¯¹äºåŠ¨ä½œä»·å€¼å‡½æ•°ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯è¾“å…¥çŠ¶æ€ $s$ çš„ç‰¹å¾å‘é‡å’ŒåŠ¨ä½œ $a$ï¼Œè¾“å‡ºå¯¹åº”çš„åŠ¨ä½œä»·å€¼ $\hat{q}(s,a,w)$ï¼Œå¦ä¸€ç§æ˜¯åªè¾“å…¥çŠ¶æ€ $s$ çš„ç‰¹å¾å‘é‡ï¼ŒåŠ¨ä½œé›†åˆæœ‰å¤šå°‘ä¸ªåŠ¨ä½œå°±æœ‰å¤šå°‘ä¸ªè¾“å‡º $\hat{q}(s,ai,w)$ã€‚è¿™é‡Œéšå«äº†æˆ‘ä»¬çš„åŠ¨ä½œæ˜¯æœ‰é™ä¸ªçš„ç¦»æ•£åŠ¨ä½œã€‚</p>
<p>å¯¹äºæˆ‘ä»¬å‰ä¸€ç¯‡è®²åˆ°çš„Q-Learningç®—æ³•ï¼Œæˆ‘ä»¬ç°åœ¨å°±ä»·å€¼å‡½æ•°çš„è¿‘ä¼¼è¡¨ç¤ºæ¥å°†å…¶æ”¹é€ ï¼Œé‡‡ç”¨ä¸Šé¢å³è¾¹çš„ç¬¬ä¸‰å¹…å›¾çš„åŠ¨ä½œä»·å€¼å‡½æ•°å»ºæ¨¡æ€è·¯æ¥åšï¼Œç°åœ¨æˆ‘ä»¬å«å®ƒDeep Q-Learningã€‚</p>
<h1 id="3-deep-q-learningç®—æ³•æ€è·¯">3. Deep Q-Learningç®—æ³•æ€è·¯</h1>
<p>Deep Q-Learningç®—æ³•çš„åŸºæœ¬æ€è·¯æ¥æºäºQ-Learningã€‚ä½†æ˜¯å’ŒQ-Learningä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå®ƒçš„Qå€¼çš„è®¡ç®—ä¸æ˜¯ç›´æ¥é€šè¿‡çŠ¶æ€å€¼så’ŒåŠ¨ä½œæ¥è®¡ç®—ï¼Œè€Œæ˜¯é€šè¿‡ä¸Šé¢è®²åˆ°çš„Qç½‘ç»œæ¥è®¡ç®—çš„ã€‚è¿™ä¸ªQç½‘ç»œæ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬ä¸€èˆ¬ç®€ç§°Deep Q-Learningä¸ºDQNã€‚</p>
<p>DQNçš„è¾“å…¥æ˜¯æˆ‘ä»¬çš„çŠ¶æ€så¯¹åº”çš„çŠ¶æ€å‘é‡ $Ï•(s)$ï¼Œ è¾“å‡ºæ˜¯æ‰€æœ‰åŠ¨ä½œåœ¨è¯¥çŠ¶æ€ä¸‹çš„åŠ¨ä½œä»·å€¼å‡½æ•°Qã€‚Qç½‘ç»œå¯ä»¥æ˜¯DNNï¼ŒCNNæˆ–è€…RNNï¼Œæ²¡æœ‰å…·ä½“çš„ç½‘ç»œç»“æ„è¦æ±‚ã€‚</p>
<p>DQNä¸»è¦ä½¿ç”¨çš„æŠ€å·§æ˜¯ç»éªŒå›æ”¾(experience replay), å³å°†æ¯æ¬¡å’Œç¯å¢ƒäº¤äº’å¾—åˆ°çš„å¥–åŠ±ä¸çŠ¶æ€æ›´æ–°æƒ…å†µéƒ½ä¿å­˜èµ·æ¥ï¼Œç”¨äºåé¢ç›®æ ‡Qå€¼çš„æ›´æ–°ã€‚ä¸ºä»€ä¹ˆéœ€è¦ç»éªŒå›æ”¾å‘¢ï¼Ÿæˆ‘ä»¬å›å¿†ä¸€ä¸‹Q-Learningï¼Œå®ƒæ˜¯æœ‰ä¸€å¼ Qè¡¨æ¥ä¿å­˜æ‰€æœ‰çš„Qå€¼çš„å½“å‰ç»“æœçš„ï¼Œä½†æ˜¯DQNæ˜¯æ²¡æœ‰çš„ï¼Œé‚£ä¹ˆåœ¨åšåŠ¨ä½œä»·å€¼å‡½æ•°æ›´æ–°çš„æ—¶å€™ï¼Œå°±éœ€è¦å…¶ä»–çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯<strong>ç»éªŒå›æ”¾</strong>ã€‚</p>
<p>é€šè¿‡ç»éªŒå›æ”¾å¾—åˆ°çš„ç›®æ ‡Qå€¼å’Œé€šè¿‡Qç½‘ç»œè®¡ç®—çš„Qå€¼è‚¯å®šæ˜¯æœ‰è¯¯å·®çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¢¯åº¦çš„åå‘ä¼ æ’­æ¥æ›´æ–°ç¥ç»ç½‘ç»œçš„å‚æ•° $w$ï¼Œå½“ $w$ æ”¶æ•›åï¼Œæˆ‘ä»¬çš„å°±å¾—åˆ°çš„è¿‘ä¼¼çš„Qå€¼è®¡ç®—æ–¹æ³•ï¼Œè¿›è€Œè´ªå©ªç­–ç•¥ä¹Ÿå°±æ±‚å‡ºæ¥äº†ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ€»ç»“ä¸‹DQNçš„ç®—æ³•æµç¨‹ï¼ŒåŸºäºNIPS 2013 DQNã€‚ã€€ã€€ã€€ã€€</p>
<ul>
<li>ç®—æ³•è¾“å…¥ï¼šè¿­ä»£è½®æ•° $T$ï¼ŒçŠ¶æ€ç‰¹å¾ç»´åº¦ $n$, åŠ¨ä½œé›† $A$, æ­¥é•¿ $Î±$ï¼Œè¡°å‡å› å­ $Î³$, æ¢ç´¢ç‡ $Ïµ$, Qç½‘ç»œç»“æ„, æ‰¹é‡æ¢¯åº¦ä¸‹é™çš„æ ·æœ¬æ•° $m$ã€‚</li>
<li>è¾“å‡ºï¼šQç½‘ç»œå‚æ•°
<ul>
<li>
<ol>
<li>éšæœºåˆå§‹åŒ–$Q$ç½‘ç»œçš„æ‰€æœ‰å‚æ•° $w$ï¼ŒåŸºäº $w$åˆå§‹åŒ–æ‰€æœ‰çš„çŠ¶æ€å’ŒåŠ¨ä½œå¯¹åº”çš„ä»·å€¼ $Q$ã€‚æ¸…ç©ºç»éªŒå›æ”¾çš„é›†åˆ $D$ã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>for i from 1 to Tï¼Œè¿›è¡Œè¿­ä»£ã€‚</li>
</ol>
<ul>
<li>a) åˆå§‹åŒ–Sä¸ºå½“å‰çŠ¶æ€åºåˆ—çš„ç¬¬ä¸€ä¸ªçŠ¶æ€, æ‹¿åˆ°å…¶ç‰¹å¾å‘é‡ $Ï•(S)$</li>
<li>b) åœ¨Qç½‘ç»œä¸­ä½¿ç”¨ $Ï•(S)$ ä½œä¸ºè¾“å…¥ï¼Œå¾—åˆ°Qç½‘ç»œçš„æ‰€æœ‰åŠ¨ä½œå¯¹åº”çš„Qå€¼è¾“å‡ºã€‚ç”¨ $Ïµâˆ’$è´ªå©ªæ³•åœ¨å½“å‰Qå€¼è¾“å‡ºä¸­é€‰æ‹©å¯¹åº”çš„åŠ¨ä½œ $A$</li>
<li>c) åœ¨çŠ¶æ€ $S$æ‰§è¡Œå½“å‰åŠ¨ä½œ $A$,å¾—åˆ°æ–°çŠ¶æ€ $S&rsquo;$å¯¹åº”çš„ç‰¹å¾å‘é‡ $Ï•(S&rsquo;)$å’Œå¥–åŠ± $R$,æ˜¯å¦ç»ˆæ­¢çŠ¶æ€<code>is_end</code></li>
<li>d) å°† $\\{Ï•(S),A,R,Ï•(S&rsquo;),is_end\\}$è¿™ä¸ªäº”å…ƒç»„å­˜å…¥ç»éªŒå›æ”¾é›†åˆD</li>
<li>e) $S=S'$</li>
<li>f) ä»ç»éªŒå›æ”¾é›†åˆ $D$ ä¸­é‡‡æ · $m$ ä¸ªæ ·æœ¬ ${Ï•(Sj),Aj,Rj,Ï•(Sâ€²j),is_endj},j=1,2.,,,m$ï¼Œè®¡ç®—å½“å‰ç›®æ ‡Qå€¼$y_j$ï¼š
<ul>
<li>$$\left.y_j=\left\\{\begin{array}{ll}R_j&amp;is_end_j\mathrm{~}is\mathrm{~}true\\\\R_j+\gamma\max_{a^{\prime}}Q(\phi(S_j^{\prime}),A_j^{\prime},w)&amp;is_end_j\mathrm{~}is\mathrm{~}false\end{array}\right.\right.$$</li>
</ul>
</li>
<li>g) ä½¿ç”¨å‡æ–¹å·®æŸå¤±å‡½æ•°$\frac1m\sum_{i=1}^m(y_j-Q(\phi(S_j),A_j,w))^2$ï¼Œé€šè¿‡ç¥ç»ç½‘ç»œçš„æ¢¯åº¦åå‘ä¼ æ’­æ¥æ›´æ–°Qç½‘ç»œçš„æ‰€æœ‰å‚æ•° $w$</li>
<li>h) å¦‚æœ$S&rsquo;$æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œå½“å‰è½®è¿­ä»£å®Œæ¯•ï¼Œå¦åˆ™è½¬åˆ°æ­¥éª¤b)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>æ³¨æ„ï¼Œä¸Šè¿°ç¬¬äºŒæ­¥çš„ $f$æ­¥å’Œ $g$æ­¥çš„ $Q$å€¼è®¡ç®—ä¹Ÿéƒ½éœ€è¦é€šè¿‡ $Q$ç½‘ç»œè®¡ç®—å¾—åˆ°ã€‚å¦å¤–ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œä¸ºäº†ç®—æ³•è¾ƒå¥½çš„æ”¶æ•›ï¼Œæ¢ç´¢ç‡ $Ïµ$éœ€è¦éšç€è¿­ä»£çš„è¿›è¡Œè€Œå˜å°ã€‚</p>
<h1 id="4-deep-q-learningå®ä¾‹">4. Deep Q-Learningå®ä¾‹</h1>
<p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥æ¼”ç¤ºDQNçš„åº”ç”¨ã€‚è¿™é‡Œä½¿ç”¨äº†OpenAI Gymä¸­çš„CartPole-v0æ¸¸æˆæ¥ä½œä¸ºæˆ‘ä»¬ç®—æ³•åº”ç”¨ã€‚CartPole-v0æ¸¸æˆçš„ä»‹ç»å‚è§<a href="https://github.com/openai/gym/wiki/CartPole-v0"target="_blank" rel="external nofollow noopener noreferrer">è¿™é‡Œ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚å®ƒæ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬è¦æ±‚å°±æ˜¯æ§åˆ¶ä¸‹é¢çš„cartç§»åŠ¨ä½¿è¿æ¥åœ¨ä¸Šé¢çš„poleä¿æŒå‚ç›´ä¸å€’ã€‚è¿™ä¸ªä»»åŠ¡åªæœ‰ä¸¤ä¸ªç¦»æ•£åŠ¨ä½œï¼Œè¦ä¹ˆå‘å·¦ç”¨åŠ›ï¼Œè¦ä¹ˆå‘å³ç”¨åŠ›ã€‚è€ŒstateçŠ¶æ€å°±æ˜¯è¿™ä¸ªcartçš„ä½ç½®å’Œé€Ÿåº¦ï¼Œ poleçš„è§’åº¦å’Œè§’é€Ÿåº¦ï¼Œ4ç»´çš„ç‰¹å¾ã€‚åšæŒåˆ°200åˆ†çš„å¥–åŠ±åˆ™ä¸ºè¿‡å…³ã€‚</p>
<p>å®Œæ•´çš„ä»£ç å‚è§github: <a href="https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/dqn.py"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/dqn.py<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>ä»£ç å‚è€ƒäº†çŸ¥ä¹ä¸Šçš„ä¸€ä¸ª<a href="https://zhuanlan.zhihu.com/p/21477488"target="_blank" rel="external nofollow noopener noreferrer">DQNå®ä¾‹<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼Œä¿®æ”¹äº†ä»£ç ä¸­çš„ä¸€äº›é”™è¯¯ï¼Œå¹¶ç”¨æœ€æ–°çš„Python3.6+Tensorflow1.8.0è¿è¡Œã€‚è¦è·‘ä»£ç éœ€è¦å®‰è£…OpenAIçš„Gymåº“ï¼Œä½¿ç”¨<code>pip install gym</code>å³å¯ã€‚</p>
<p>ä»£ç ä½¿ç”¨äº†ä¸€ä¸ªä¸‰å±‚çš„ç¥ç»ç½‘ç»œï¼Œè¾“å…¥å±‚ï¼Œä¸€ä¸ªéšè—å±‚å’Œä¸€ä¸ªè¾“å‡ºå±‚ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹å…³é”®éƒ¨åˆ†çš„ä»£ç ã€‚</p>
<p>ç®—æ³•ç¬¬2æ­¥çš„æ­¥éª¤bé€šè¿‡$Ïµâˆ’$è´ªå©ªæ³•é€‰æ‹©åŠ¨ä½œçš„ä»£ç å¦‚ä¸‹ï¼Œæ³¨æ„æ¯æ¬¡æˆ‘ä»¬$Ïµâˆ’$è´ªå©ªæ³•åéƒ½ä¼šå‡å°$Ïµ$å€¼ã€‚</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">egreedy_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">Q_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q_value</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">:[</span><span class="n">state</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">})[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">-=</span> <span class="p">(</span><span class="n">INITIAL_EPSILON</span> <span class="o">-</span> <span class="n">FINAL_EPSILON</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10000</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">-=</span> <span class="p">(</span><span class="n">INITIAL_EPSILON</span> <span class="o">-</span> <span class="n">FINAL_EPSILON</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10000</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">Q_value</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç®—æ³•ç¬¬2æ­¥çš„æ­¥éª¤cåœ¨çŠ¶æ€Sï¿½æ‰§è¡Œå½“å‰åŠ¨ä½œAï¿½çš„ä»£ç å¦‚ä¸‹ï¼Œè¿™ä¸ªäº¤äº’æ˜¯ç”±Gymå®Œæˆçš„ã€‚</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="n">next_state</span><span class="p">,</span><span class="n">reward</span><span class="p">,</span><span class="n">done</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Define reward for agent</span>
</span></span><span class="line"><span class="cl">  <span class="n">reward</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">done</span> <span class="k">else</span> <span class="mf">0.1</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç®—æ³•ç¬¬2æ­¥çš„æ­¥éª¤dä¿å­˜ç»éªŒå›æ”¾æ•°æ®çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">perceive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">action</span><span class="p">,</span><span class="n">reward</span><span class="p">,</span><span class="n">next_state</span><span class="p">,</span><span class="n">done</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">one_hot_action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">one_hot_action</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">replay_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">state</span><span class="p">,</span><span class="n">one_hot_action</span><span class="p">,</span><span class="n">reward</span><span class="p">,</span><span class="n">next_state</span><span class="p">,</span><span class="n">done</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replay_buffer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">REPLAY_SIZE</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">replay_buffer</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replay_buffer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">BATCH_SIZE</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">train_Q_network</span><span class="p">()</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç®—æ³•ç¬¬2æ­¥çš„æ­¥éª¤f,gè®¡ç®—ç›®æ ‡Qå€¼ï¼Œå¹¶æ›´æ–°Qç½‘ç»œçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">train_Q_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">time_step</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Step 1: obtain random minibatch from replay memory</span>
</span></span><span class="line"><span class="cl">  <span class="n">minibatch</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replay_buffer</span><span class="p">,</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">state_batch</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">minibatch</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">action_batch</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">minibatch</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">reward_batch</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">minibatch</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">next_state_batch</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">minibatch</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Step 2: calculate y</span>
</span></span><span class="line"><span class="cl">  <span class="n">y_batch</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="n">Q_value_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q_value</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">:</span><span class="n">next_state_batch</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">BATCH_SIZE</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">done</span> <span class="o">=</span> <span class="n">minibatch</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">y_batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward_batch</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">y_batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward_batch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">GAMMA</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Q_value_batch</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">y_input</span><span class="p">:</span><span class="n">y_batch</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">action_input</span><span class="p">:</span><span class="n">action_batch</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">state_input</span><span class="p">:</span><span class="n">state_batch</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬åœ¨æ¯100è½®è¿­ä»£å®Œåä¼šå»ç©10æ¬¡äº¤äº’æµ‹è¯•ï¼Œè®¡ç®—10æ¬¡çš„å¹³å‡å¥–åŠ±ã€‚è¿è¡Œäº†ä»£ç åï¼Œæˆ‘çš„3000è½®è¿­ä»£çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">episode: <span class="m">0</span> Evaluation Average Reward: 12.2
</span></span><span class="line"><span class="cl">episode: <span class="m">100</span> Evaluation Average Reward: 9.4
</span></span><span class="line"><span class="cl">episode: <span class="m">200</span> Evaluation Average Reward: 10.4
</span></span><span class="line"><span class="cl">episode: <span class="m">300</span> Evaluation Average Reward: 10.5
</span></span><span class="line"><span class="cl">episode: <span class="m">400</span> Evaluation Average Reward: 11.6
</span></span><span class="line"><span class="cl">episode: <span class="m">500</span> Evaluation Average Reward: 12.4
</span></span><span class="line"><span class="cl">episode: <span class="m">600</span> Evaluation Average Reward: 29.6
</span></span><span class="line"><span class="cl">episode: <span class="m">700</span> Evaluation Average Reward: 48.1
</span></span><span class="line"><span class="cl">episode: <span class="m">800</span> Evaluation Average Reward: 85.0
</span></span><span class="line"><span class="cl">episode: <span class="m">900</span> Evaluation Average Reward: 169.4
</span></span><span class="line"><span class="cl">episode: <span class="m">1000</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1100</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1200</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1300</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1400</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1500</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1600</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1700</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1800</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">1900</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2000</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2100</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2200</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2300</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2400</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2500</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2600</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2700</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2800</span> Evaluation Average Reward: 200.0
</span></span><span class="line"><span class="cl">episode: <span class="m">2900</span> Evaluation Average Reward: 200.0</span></span></code></pre></td></tr></table>
</div>
</div><p>å¤§æ¦‚åˆ°ç¬¬1000æ¬¡è¿­ä»£åï¼Œç®—æ³•å·²ç»æ”¶æ•›ï¼Œè¾¾åˆ°æœ€é«˜çš„200åˆ†ã€‚å½“ç„¶ç”±äºæ˜¯$Ïµâˆ’$æ¢ç´¢ï¼Œæ¯æ¬¡å‰é¢çš„è¾“å‡ºå¯èƒ½ä¸åŒï¼Œä½†æœ€ååº”è¯¥éƒ½å¯ä»¥æ”¶æ•›åˆ°200çš„åˆ†æ•°ã€‚å½“ç„¶ç”±äºDQNä¸ä¿è¯ç»å¯¹çš„æ”¶æ•›ï¼Œæ‰€ä»¥å¯èƒ½åˆ°äº†200åˆ†åè¿˜ä¼šæœ‰æŠ–åŠ¨ã€‚</p>
<h1 id="5-deep-q-learningå°ç»“">5. Deep Q-Learningå°ç»“ã€€ã€€ã€€ã€€</h1>
<p>DQNç”±äºå¯¹ä»·å€¼å‡½æ•°åšäº†è¿‘ä¼¼è¡¨ç¤ºï¼Œå› æ­¤æœ‰äº†è§£å†³å¤§è§„æ¨¡å¼ºåŒ–å­¦ä¹ é—®é¢˜çš„èƒ½åŠ›ã€‚ä½†æ˜¯DQNæœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å®ƒå¹¶ä¸ä¸€å®šèƒ½ä¿è¯Qç½‘ç»œçš„æ”¶æ•›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸ä¸€å®šå¯ä»¥å¾—åˆ°æ”¶æ•›åçš„Qç½‘ç»œå‚æ•°ã€‚è¿™ä¼šå¯¼è‡´æˆ‘ä»¬è®­ç»ƒå‡ºçš„æ¨¡å‹æ•ˆæœå¾ˆå·®ã€‚</p>
<p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œè¡ç”Ÿå‡ºäº†DQNçš„å¾ˆå¤šå˜ç§ï¼Œæ¯”å¦‚Nature DQN(NIPS 2015), Double DQNï¼ŒDueling DQNç­‰ã€‚è¿™äº›æˆ‘ä»¬åœ¨ä¸‹ä¸€ç¯‡è®¨è®ºã€‚</p>
]]></description></item><item><title>å¼ºåŒ–å­¦ä¹ ç¬”è®° [7] | æ—¶åºå·®åˆ†ç¦»çº¿æ§åˆ¶ç®—æ³•Q-Learning</title><link>https://jianye0428.github.io/posts/rl_learning_note_7/</link><pubDate>Fri, 23 Feb 2024 13:17:35 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_7/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/9614290.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆå…­ï¼‰æ—¶åºå·®åˆ†åœ¨çº¿æ§åˆ¶ç®—æ³•SARSA<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­æˆ‘ä»¬è®¨è®ºäº†æ—¶åºå·®åˆ†çš„åœ¨çº¿æ§åˆ¶ç®—æ³•SARSAï¼Œè€Œå¦ä¸€ç±»æ—¶åºå·®åˆ†çš„ç¦»çº¿æ§åˆ¶ç®—æ³•è¿˜æ²¡æœ‰è®¨è®ºï¼Œå› æ­¤æœ¬æ–‡æˆ‘ä»¬å…³æ³¨äºæ—¶åºå·®åˆ†ç¦»çº¿æ§åˆ¶ç®—æ³•ï¼Œä¸»è¦æ˜¯ç»å…¸çš„Q-Learningç®—æ³•ã€‚</p>
<p>Q-Learningè¿™ä¸€ç¯‡å¯¹åº”Suttonä¹¦çš„ç¬¬å…­ç« éƒ¨åˆ†å’ŒUCLå¼ºåŒ–å­¦ä¹ è¯¾ç¨‹çš„ç¬¬äº”è®²éƒ¨åˆ†ã€‚</p>
<h1 id="1-q-learningç®—æ³•çš„å¼•å…¥">1. Q-Learningç®—æ³•çš„å¼•å…¥ã€€ã€€ã€€ã€€</h1>
<p>Q-Learningç®—æ³•æ˜¯ä¸€ç§ä½¿ç”¨æ—¶åºå·®åˆ†æ±‚è§£å¼ºåŒ–å­¦ä¹ æ§åˆ¶é—®é¢˜çš„æ–¹æ³•ï¼Œå›é¡¾ä¸‹æ­¤æ—¶æˆ‘ä»¬çš„æ§åˆ¶é—®é¢˜å¯ä»¥è¡¨ç¤ºä¸ºï¼šç»™å®šå¼ºåŒ–å­¦ä¹ çš„5ä¸ªè¦ç´ ï¼šçŠ¶æ€é›† $S$, åŠ¨ä½œé›† $A$, å³æ—¶å¥–åŠ± $R$ï¼Œè¡°å‡å› å­ $Î³$, æ¢ç´¢ç‡ $Ïµ$, æ±‚è§£æœ€ä¼˜çš„åŠ¨ä½œä»·å€¼å‡½æ•° $qâˆ—$å’Œæœ€ä¼˜ç­–ç•¥ $Ï€âˆ—$ã€‚</p>
<p>è¿™ä¸€ç±»å¼ºåŒ–å­¦ä¹ çš„é—®é¢˜æ±‚è§£<u>ä¸éœ€è¦ç¯å¢ƒçš„çŠ¶æ€è½¬åŒ–æ¨¡å‹</u>ï¼Œæ˜¯ä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ é—®é¢˜æ±‚è§£æ–¹æ³•ã€‚å¯¹äºå®ƒçš„æ§åˆ¶é—®é¢˜æ±‚è§£ï¼Œå’Œè’™ç‰¹å¡ç½—æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯ä»·å€¼è¿­ä»£ï¼Œå³é€šè¿‡ä»·å€¼å‡½æ•°çš„æ›´æ–°ï¼Œæ¥æ›´æ–°ç­–ç•¥ï¼Œé€šè¿‡ç­–ç•¥æ¥äº§ç”Ÿæ–°çš„çŠ¶æ€å’Œå³æ—¶å¥–åŠ±ï¼Œè¿›è€Œæ›´æ–°ä»·å€¼å‡½æ•°ã€‚ä¸€ç›´è¿›è¡Œä¸‹å»ï¼Œç›´åˆ°ä»·å€¼å‡½æ•°å’Œç­–ç•¥éƒ½æ”¶æ•›ã€‚</p>
<p>å†å›é¡¾ä¸‹æ—¶åºå·®åˆ†æ³•çš„æ§åˆ¶é—®é¢˜ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯åœ¨çº¿æ§åˆ¶ï¼Œå³ä¸€ç›´ä½¿ç”¨ä¸€ä¸ªç­–ç•¥æ¥æ›´æ–°ä»·å€¼å‡½æ•°å’Œé€‰æ‹©æ–°çš„åŠ¨ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šä¸€ç¯‡è®²åˆ°çš„SARSA, è€Œå¦ä¸€ç±»æ˜¯ç¦»çº¿æ§åˆ¶ï¼Œä¼šä½¿ç”¨ä¸¤ä¸ªæ§åˆ¶ç­–ç•¥ï¼Œä¸€ä¸ªç­–ç•¥ç”¨äºé€‰æ‹©æ–°çš„åŠ¨ä½œï¼Œå¦ä¸€ä¸ªç­–ç•¥ç”¨äºæ›´æ–°ä»·å€¼å‡½æ•°ã€‚è¿™ä¸€ç±»çš„ç»å…¸ç®—æ³•å°±æ˜¯Q-Learningã€‚</p>
<p>å¯¹äºQ-Learningï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ $Ïµâˆ’$è´ªå©ªæ³•æ¥é€‰æ‹©æ–°çš„åŠ¨ä½œï¼Œè¿™éƒ¨åˆ†å’ŒSARSAå®Œå…¨ç›¸åŒã€‚ä½†æ˜¯å¯¹äºä»·å€¼å‡½æ•°çš„æ›´æ–°ï¼ŒQ-Learningä½¿ç”¨çš„æ˜¯è´ªå©ªæ³•ï¼Œè€Œä¸æ˜¯SARSAçš„ $Ïµâˆ’$è´ªå©ªæ³•ã€‚è¿™ä¸€ç‚¹å°±æ˜¯SARSAå’ŒQ-Learningæœ¬è´¨çš„åŒºåˆ«ã€‚</p>
<h1 id="2-q-learningç®—æ³•æ¦‚è¿°">2. Q-Learningç®—æ³•æ¦‚è¿°</h1>
<p>Q-Learningç®—æ³•çš„æ‹“æ‰‘å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">Q Learning æ‹“æ‰‘å›¾</div>
</center>
<br>
<p>é¦–å…ˆæˆ‘ä»¬åŸºäºçŠ¶æ€ $S$ï¼Œç”¨ $Ïµâˆ’$è´ªå©ªæ³•é€‰æ‹©åˆ°åŠ¨ä½œ $A$, ç„¶åæ‰§è¡ŒåŠ¨ä½œ$A$ï¼Œå¾—åˆ°å¥–åŠ± $R$ï¼Œå¹¶è¿›å…¥çŠ¶æ€ $S&rsquo;$ï¼Œæ­¤æ—¶ï¼Œå¦‚æœæ˜¯SARSAï¼Œä¼šç»§ç»­åŸºäºçŠ¶æ€ $S&rsquo;$ï¼Œç”¨ $Ïµâˆ’$è´ªå©ªæ³•é€‰æ‹© $A&rsquo;$,ç„¶åæ¥æ›´æ–°ä»·å€¼å‡½æ•°ã€‚ä½†æ˜¯Q-Learningåˆ™ä¸åŒã€‚</p>
<p>å¯¹äºQ-Learningï¼Œå®ƒåŸºäºçŠ¶æ€ $S&rsquo;$ï¼Œæ²¡æœ‰ä½¿ç”¨ $Ïµâˆ’$è´ªå©ªæ³•é€‰æ‹© $A$ï¼Œè€Œæ˜¯ä½¿ç”¨è´ªå©ªæ³•é€‰æ‹© $A&rsquo;$ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé€‰æ‹©ä½¿ $Q(S&rsquo;,a)$ æœ€å¤§çš„ $a$ ä½œä¸º $A&rsquo;$æ¥æ›´æ–°ä»·å€¼å‡½æ•°ã€‚ç”¨æ•°å­¦å…¬å¼è¡¨ç¤ºå°±æ˜¯ï¼š</p>
<p>$$Q(S,A)=Q(S,A)+\alpha(R+\gamma\max_aQ(S^{\prime},a)-Q(S,A))$$</p>
<p>å¯¹åº”åˆ°ä¸Šå›¾ä¸­å°±æ˜¯åœ¨å›¾ä¸‹æ–¹çš„ä¸‰ä¸ªé»‘åœ†åœˆåŠ¨ä½œä¸­é€‰æ‹©ä¸€ä¸ªä½¿ $Q(S&rsquo;,a)$æœ€å¤§çš„åŠ¨ä½œä½œä¸º $A&rsquo;$ã€‚</p>
<p>æ­¤æ—¶é€‰æ‹©çš„åŠ¨ä½œåªä¼šå‚ä¸ä»·å€¼å‡½æ•°çš„æ›´æ–°ï¼Œä¸ä¼šçœŸæ­£çš„æ‰§è¡Œã€‚ä»·å€¼å‡½æ•°æ›´æ–°åï¼Œæ–°çš„æ‰§è¡ŒåŠ¨ä½œéœ€è¦åŸºäºçŠ¶æ€ $S&rsquo;$ï¼Œç”¨ $Ïµâˆ’$è´ªå©ªæ³•é‡æ–°é€‰æ‹©å¾—åˆ°ã€‚è¿™ä¸€ç‚¹ä¹Ÿå’ŒSARSAç¨æœ‰ä¸åŒã€‚å¯¹äºSARSAï¼Œä»·å€¼å‡½æ•°æ›´æ–°ä½¿ç”¨çš„ $A&rsquo;$ ä¼šä½œä¸ºä¸‹ä¸€é˜¶æ®µå¼€å§‹æ—¶å€™çš„æ‰§è¡ŒåŠ¨ä½œã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å¯¹Q-Learningç®—æ³•åšä¸€ä¸ªæ€»ç»“ã€‚</p>
<h1 id="3-q-learningç®—æ³•æµç¨‹">3. Q-Learningç®—æ³•æµç¨‹</h1>
<p>ä¸‹é¢æˆ‘ä»¬æ€»ç»“ä¸‹Q-Learningç®—æ³•çš„æµç¨‹ã€‚</p>
<ul>
<li>ç®—æ³•è¾“å…¥ï¼šè¿­ä»£è½®æ•° $T$ï¼ŒçŠ¶æ€é›† $S$, åŠ¨ä½œé›† $A$, æ­¥é•¿ $Î±$ï¼Œè¡°å‡å› å­ $Î³$, æ¢ç´¢ç‡ $Ïµ$,</li>
<li>è¾“å‡º: æ‰€æœ‰çš„çŠ¶æ€å’ŒåŠ¨ä½œå¯¹åº”çš„ä»·å€¼ $Q$
<ul>
<li>
<ol>
<li>éšæœºåˆå§‹åŒ–æ‰€æœ‰çš„çŠ¶æ€å’ŒåŠ¨ä½œå¯¹åº”çš„ä»·å€¼Qï¿½. å¯¹äºç»ˆæ­¢çŠ¶æ€å…¶Qï¿½å€¼åˆå§‹åŒ–ä¸º0.</li>
</ol>
</li>
<li>
<ol start="2">
<li>for i from 1 to Tï¼Œè¿›è¡Œè¿­ä»£ã€‚</li>
</ol>
<ul>
<li>a) åˆå§‹åŒ– $S$ ä¸ºå½“å‰çŠ¶æ€åºåˆ—çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ã€‚</li>
<li>b) ç”¨ $Ïµâˆ’$è´ªå©ªæ³•åœ¨å½“å‰çŠ¶æ€ $S$ é€‰æ‹©å‡ºåŠ¨ä½œ $A$</li>
<li>c) åœ¨çŠ¶æ€ $S$æ‰§è¡Œå½“å‰åŠ¨ä½œ $A$,å¾—åˆ°æ–°çŠ¶æ€ $S&rsquo;$å’Œå¥–åŠ± $R$</li>
<li>d) æ›´æ–°ä»·å€¼å‡½æ•° $Q(S,A)$:
<ul>
<li>$$Q(S,A)+\alpha(R+\gamma\max_aQ(S^{\prime},a)-Q(S,A))$$</li>
</ul>
</li>
<li>e) $S=S'$</li>
<li>f) å¦‚æœ$S&rsquo;$æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œå½“å‰è½®è¿­ä»£å®Œæ¯•ï¼Œå¦åˆ™è½¬åˆ°æ­¥éª¤b)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="4-q-learningç®—æ³•å®ä¾‹windy-gridworld">4. Q-Learningç®—æ³•å®ä¾‹ï¼šWindy GridWorld</h1>
<p>æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨å’ŒSARSAä¸€æ ·çš„ä¾‹å­æ¥ç ”ç©¶Q-Learningã€‚å¦‚æœå¯¹windy gridworldçš„é—®é¢˜è¿˜ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥å¤ä¹ <a href="https://www.cnblogs.com/pinard/p/9614290.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆå…­ï¼‰æ—¶åºå·®åˆ†åœ¨çº¿æ§åˆ¶ç®—æ³•SARSA<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ç¬¬4èŠ‚çš„ç¬¬äºŒæ®µã€‚</p>
<p>å®Œæ•´çš„ä»£ç å‚è§github: <a href="https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/q_learning_windy_world.py"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/q_learning_windy_world.py<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>ç»å¤§éƒ¨åˆ†ä»£ç å’ŒSARSAæ˜¯ç±»ä¼¼çš„ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥é‡ç‚¹æ¯”è¾ƒå’ŒSARSAä¸åŒçš„éƒ¨åˆ†ã€‚åŒºåˆ«éƒ½åœ¨<code>episode()</code>è¿™ä¸ªå‡½æ•°é‡Œé¢ã€‚</p>
<p>é¦–å…ˆæ˜¯åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªåˆå§‹åŒ–çŠ¶æ€ $S$,æŠŠ $A$ çš„äº§ç”Ÿæ”¾åˆ°äº†whileå¾ªç¯é‡Œé¢, è€Œå›å¿†ä¸‹SARSAä¼šåŒæ—¶åˆå§‹åŒ–çŠ¶æ€ $S$ å’ŒåŠ¨ä½œ $A$ï¼Œå†å»æ‰§è¡Œå¾ªç¯ã€‚ä¸‹é¢è¿™æ®µQ-Learningçš„ä»£ç å¯¹åº”æˆ‘ä»¬ç®—æ³•çš„ç¬¬äºŒæ­¥æ­¥éª¤aå’Œbï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># play for an episode</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">episode</span><span class="p">(</span><span class="n">q_value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># track the total time steps in this episode</span>
</span></span><span class="line"><span class="cl">  <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># initialize state</span>
</span></span><span class="line"><span class="cl">  <span class="n">state</span> <span class="o">=</span> <span class="n">START</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">GOAL</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># choose an action based on epsilon-greedy algorithm</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">EPSILON</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">ACTIONS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">values_</span> <span class="o">=</span> <span class="n">q_value</span><span class="p">[</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl">      <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">action_</span> <span class="k">for</span> <span class="n">action_</span><span class="p">,</span> <span class="n">value_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values_</span><span class="p">)</span> <span class="k">if</span> <span class="n">value_</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values_</span><span class="p">)])</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ç€æˆ‘ä»¬ä¼šå»æ‰§è¡ŒåŠ¨ä½œ $A$,å¾—åˆ° $S&rsquo;$ï¼Œ ç”±äºå¥–åŠ±ä¸æ˜¯ç»ˆæ­¢å°±æ˜¯-1ï¼Œä¸éœ€è¦å•ç‹¬è®¡ç®—ã€‚,è¿™éƒ¨åˆ†å’ŒSARSAçš„ä»£ç ç›¸åŒã€‚å¯¹åº”æˆ‘ä»¬Q-Learningç®—æ³•çš„ç¬¬äºŒæ­¥æ­¥éª¤cï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">next_state</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">state</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="n">ACTION_UP</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">WIND</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">j</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">ACTION_DOWN</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">WIND</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">WORLD_HEIGHT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">j</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">ACTION_LEFT</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">WIND</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">ACTION_RIGHT</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">WIND</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">WORLD_WIDTH</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="kc">False</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åé¢æˆ‘ä»¬ç”¨è´ªå©ªæ³•é€‰æ‹©å‡ºæœ€å¤§çš„ $Q(S&rsquo;,a)$,å¹¶æ›´æ–°ä»·å€¼å‡½æ•°ï¼Œæœ€åæ›´æ–°å½“å‰çŠ¶æ€ $S$ã€‚å¯¹åº”æˆ‘ä»¬Q-Learningç®—æ³•çš„ç¬¬äºŒæ­¥æ­¥éª¤d,eã€‚æ³¨æ„SARSAè¿™é‡Œæ˜¯ä½¿ç”¨Ïµâˆ’ï¿½âˆ’è´ªå©ªæ³•ï¼Œè€Œä¸æ˜¯è´ªå©ªæ³•ã€‚åŒæ—¶SARSAä¼šåŒæ—¶æ›´æ–°çŠ¶æ€Sï¿½å’ŒåŠ¨ä½œAï¿½,è€ŒQ-Learningåªä¼šæ›´æ–°å½“å‰çŠ¶æ€Sï¿½ã€‚</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">values_</span> <span class="o">=</span> <span class="n">q_value</span><span class="p">[</span><span class="n">next_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">next_state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl"><span class="n">next_action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">action_</span> <span class="k">for</span> <span class="n">action_</span><span class="p">,</span> <span class="n">value_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values_</span><span class="p">)</span> <span class="k">if</span> <span class="n">value_</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values_</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sarsa update</span>
</span></span><span class="line"><span class="cl"><span class="n">q_value</span><span class="p">[</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">action</span><span class="p">]</span> <span class="o">+=</span> \
</span></span><span class="line"><span class="cl">    <span class="n">ALPHA</span> <span class="o">*</span> <span class="p">(</span><span class="n">REWARD</span> <span class="o">+</span> <span class="n">q_value</span><span class="p">[</span><span class="n">next_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">next_state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">next_action</span><span class="p">]</span> <span class="o">-</span> <span class="n">q_value</span><span class="p">[</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">action</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span> <span class="o">=</span> <span class="n">next_state</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è·‘å®Œå®Œæ•´çš„ä»£ç ï¼Œå¤§å®¶å¯ä»¥å¾ˆå®¹æ˜“å¾—åˆ°è¿™ä¸ªé—®é¢˜çš„æœ€ä¼˜è§£ï¼Œè¿›è€Œå¾—åˆ°åœ¨æ¯ä¸ªæ ¼å­é‡Œçš„æœ€ä¼˜è´ªå©ªç­–ç•¥ã€‚</p>
<h1 id="5-sarsa-vs-q-learning">5. SARSA vs Q-Learning</h1>
<p>ç°åœ¨SARSAå’ŒQ-Learningç®—æ³•æˆ‘ä»¬éƒ½è®²å®Œäº†ï¼Œé‚£ä¹ˆä½œä¸ºæ—¶åºå·®åˆ†æ§åˆ¶ç®—æ³•çš„ä¸¤ç§ç»å…¸æ–¹æ³•å—ï¼Œä»–ä»¬éƒ½æœ‰è¯´æ˜ç‰¹ç‚¹ï¼Œå„è‡ªé€‚ç”¨äºä»€ä¹ˆæ ·çš„åœºæ™¯å‘¢ï¼Ÿ</p>
<p>Q-Learningç›´æ¥å­¦ä¹ çš„æ˜¯ <font color=red>æœ€ä¼˜ç­–ç•¥</font>ï¼Œè€ŒSARSA<font color=red>åœ¨å­¦ä¹ æœ€ä¼˜ç­–ç•¥çš„åŒæ—¶è¿˜åœ¨åšæ¢ç´¢</font>ã€‚è¿™å¯¼è‡´æˆ‘ä»¬åœ¨å­¦ä¹ æœ€ä¼˜ç­–ç•¥çš„æ—¶å€™ï¼Œå¦‚æœç”¨SARSAï¼Œä¸ºäº†ä¿è¯æ”¶æ•›ï¼Œéœ€è¦åˆ¶å®šä¸€ä¸ªç­–ç•¥ï¼Œä½¿ $Ïµâˆ’$è´ªå©ªæ³•çš„è¶…å‚æ•° $Ïµ$åœ¨è¿­ä»£çš„è¿‡ç¨‹ä¸­é€æ¸å˜å°ã€‚Q-Learningæ²¡æœ‰è¿™ä¸ªçƒ¦æ¼ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªå°±æ˜¯Q-Learningç›´æ¥å­¦ä¹ æœ€ä¼˜ç­–ç•¥ï¼Œä½†æ˜¯æœ€ä¼˜ç­–ç•¥ä¼šä¾èµ–äºè®­ç»ƒä¸­äº§ç”Ÿçš„ä¸€ç³»åˆ—æ•°æ®ï¼Œæ‰€ä»¥<font color=red>å—æ ·æœ¬æ•°æ®çš„å½±å“è¾ƒå¤§</font>ï¼Œå› æ­¤å—åˆ°è®­ç»ƒæ•°æ®æ–¹å·®çš„å½±å“å¾ˆå¤§ï¼Œç”šè‡³ä¼šå½±å“Qå‡½æ•°çš„æ”¶æ•›ã€‚Q-Learningçš„æ·±åº¦å¼ºåŒ–å­¦ä¹ ç‰ˆDeep Q-Learningä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼ŒSARSAåœ¨æ”¶æ•›çš„è¿‡ç¨‹ä¸­é¼“åŠ±æ¢ç´¢ï¼Œè¿™æ ·å­¦ä¹ è¿‡ç¨‹ä¼šæ¯”è¾ƒå¹³æ»‘ï¼Œä¸è‡³äºè¿‡äºæ¿€è¿›ï¼Œå¯¼è‡´å‡ºç°åƒQ-Learningå¯èƒ½é‡åˆ°ä¸€äº›ç‰¹æ®Šçš„æœ€ä¼˜â€œé™·é˜±â€ã€‚æ¯”å¦‚ç»å…¸çš„å¼ºåŒ–å­¦ä¹ é—®é¢˜&quot;Cliff Walk&quot;ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯åœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­è®­ç»ƒå¼ºåŒ–å­¦ä¹ æ¨¡å‹ï¼Œæ¨èä½¿ç”¨Q-Learningï¼Œå¦‚æœæ˜¯ <strong><font color=red>åœ¨çº¿ç”Ÿäº§ç¯å¢ƒ</font></strong> ä¸­è®­ç»ƒæ¨¡å‹ï¼Œåˆ™æ¨èä½¿ç”¨ <strong><font color=red>SARSA</font></strong>ã€‚</p>
<h1 id="6-q-learningç»“è¯­">6. Q-Learningç»“è¯­ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</h1>
<p>å¯¹äºQ-Learningå’ŒSARSAè¿™æ ·çš„æ—¶åºå·®åˆ†ç®—æ³•ï¼Œå¯¹äºå°å‹çš„å¼ºåŒ–å­¦ä¹ é—®é¢˜æ˜¯éå¸¸çµæ´»æœ‰æ•ˆçš„ï¼Œä½†æ˜¯åœ¨å¤§æ•°æ®æ—¶ä»£ï¼Œå¼‚å¸¸å¤æ‚çš„çŠ¶æ€å’Œå¯é€‰åŠ¨ä½œï¼Œä½¿Q-Learningå’ŒSARSAè¦ç»´æŠ¤çš„Qè¡¨å¼‚å¸¸çš„å¤§ï¼Œç”šè‡³è¿œè¿œè¶…å‡ºå†…å­˜ï¼Œè¿™é™åˆ¶äº†æ—¶åºå·®åˆ†ç®—æ³•çš„åº”ç”¨åœºæ™¯ã€‚åœ¨æ·±åº¦å­¦ä¹ å…´èµ·åï¼ŒåŸºäºæ·±åº¦å­¦ä¹ çš„å¼ºåŒ–å­¦ä¹ å¼€å§‹å ä¸»å¯¼åœ°ä½ï¼Œå› æ­¤ä»ä¸‹ä¸€ç¯‡å¼€å§‹æˆ‘ä»¬å¼€å§‹è®¨è®ºæ·±åº¦å¼ºåŒ–å­¦ä¹ çš„å»ºæ¨¡æ€è·¯ã€‚</p>
]]></description></item><item><title>RLå­¦ä¹ ç¬”è®° [5] | ç”¨æ—¶åºå·®åˆ†æ³•ï¼ˆTDï¼‰æ±‚è§£</title><link>https://jianye0428.github.io/posts/rl_learning_note_5/</link><pubDate>Thu, 22 Feb 2024 17:25:21 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_5/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0 å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/9492980.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆå››ï¼‰ç”¨è’™ç‰¹å¡ç½—æ³•ï¼ˆMCï¼‰æ±‚è§£<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°äº†ä½¿ç”¨è’™ç‰¹å¡ç½—æ³•æ¥æ±‚è§£å¼ºåŒ–å­¦ä¹ é—®é¢˜çš„æ–¹æ³•ï¼Œè™½ç„¶è’™ç‰¹å¡ç½—æ³•å¾ˆçµæ´»ï¼Œä¸éœ€è¦ç¯å¢ƒçš„çŠ¶æ€è½¬åŒ–æ¦‚ç‡æ¨¡å‹ï¼Œä½†æ˜¯å®ƒéœ€è¦æ‰€æœ‰çš„é‡‡æ ·åºåˆ—éƒ½æ˜¯ç»å†å®Œæ•´çš„çŠ¶æ€åºåˆ—ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰å®Œæ•´çš„çŠ¶æ€åºåˆ—ï¼Œé‚£ä¹ˆå°±æ— æ³•ä½¿ç”¨è’™ç‰¹å¡ç½—æ³•æ±‚è§£äº†ã€‚æœ¬æ–‡æˆ‘ä»¬å°±æ¥è®¨è®ºå¯ä»¥ä¸ä½¿ç”¨å®Œæ•´çŠ¶æ€åºåˆ—æ±‚è§£å¼ºåŒ–å­¦ä¹ é—®é¢˜çš„æ–¹æ³•ï¼šæ—¶åºå·®åˆ†(Temporal-Difference, TD)ã€‚</p>
<p>æ—¶åºå·®åˆ†è¿™ä¸€ç¯‡å¯¹åº”Suttonä¹¦çš„ç¬¬å…­ç« éƒ¨åˆ†å’ŒUCLå¼ºåŒ–å­¦ä¹ è¯¾ç¨‹çš„ç¬¬å››è®²éƒ¨åˆ†ï¼Œç¬¬äº”è®²éƒ¨åˆ†ã€‚</p>
<h1 id="1-æ—¶åºå·®åˆ†tdç®€ä»‹">1. æ—¶åºå·®åˆ†TDç®€ä»‹</h1>
<p>æ—¶åºå·®åˆ†æ³•å’Œè’™ç‰¹å¡ç½—æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯<strong>ä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ é—®é¢˜</strong>æ±‚è§£æ–¹æ³•ã€‚æ‰€ä»¥åœ¨ä¸Šä¸€ç¯‡å®šä¹‰çš„ä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ§åˆ¶é—®é¢˜å’Œé¢„æµ‹é—®é¢˜çš„å®šä¹‰ï¼Œåœ¨è¿™é‡Œä»ç„¶é€‚ç”¨ã€‚</p>
<p>é¢„æµ‹é—®é¢˜ï¼šå³ç»™å®šå¼ºåŒ–å­¦ä¹ çš„5ä¸ªè¦ç´ ï¼šçŠ¶æ€é›† $S$, åŠ¨ä½œé›† $A$, å³æ—¶å¥–åŠ± $R$ï¼Œè¡°å‡å› å­ $Î³$, ç»™å®šç­–ç•¥ $Ï€$ï¼Œ æ±‚è§£è¯¥ç­–ç•¥çš„çŠ¶æ€ä»·å€¼å‡½æ•° $v(Ï€)$</p>
<p>æ§åˆ¶é—®é¢˜ï¼šä¹Ÿå°±æ˜¯æ±‚è§£æœ€ä¼˜çš„ä»·å€¼å‡½æ•°å’Œç­–ç•¥ã€‚ç»™å®šå¼ºåŒ–å­¦ä¹ çš„5ä¸ªè¦ç´ ï¼šçŠ¶æ€é›† $S$, åŠ¨ä½œé›† $A$, å³æ—¶å¥–åŠ± $R$ï¼Œè¡°å‡å› å­ $Î³$, æ¢ç´¢ç‡ $Ïµ$, æ±‚è§£æœ€ä¼˜çš„åŠ¨ä½œä»·å€¼å‡½æ•° $qâˆ—$ å’Œæœ€ä¼˜ç­–ç•¥ $Ï€âˆ—$ã€€</p>
<p>å›é¡¾è’™ç‰¹å¡ç½—æ³•ä¸­è®¡ç®—çŠ¶æ€æ”¶è·çš„æ–¹æ³•æ˜¯ï¼š</p>
<p>$$G_t=R_{t+1}+\gamma R_{t+2}+\gamma^2R_{t+3}+\ldots\gamma^{T-t-1}R_T$$</p>
<p>è€Œå¯¹äºæ—¶åºå·®åˆ†æ³•æ¥è¯´ï¼Œæˆ‘ä»¬æ²¡æœ‰å®Œæ•´çš„çŠ¶æ€åºåˆ—ï¼Œåªæœ‰éƒ¨åˆ†çš„çŠ¶æ€åºåˆ—ï¼Œé‚£ä¹ˆå¦‚ä½•å¯ä»¥è¿‘ä¼¼æ±‚å‡ºæŸä¸ªçŠ¶æ€çš„æ”¶è·å‘¢ï¼Ÿå›é¡¾<a href="https://www.cnblogs.com/pinard/p/9426283.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆäºŒï¼‰é©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹(MDP)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­çš„è´å°”æ›¼æ–¹ç¨‹ï¼š</p>
<p>$$v_\pi(s)=\mathbb{E}_\pi(R_{t+1}+\gamma v_\pi(S_{t+1})|S_t=s)$$</p>
<p>è¿™å¯å‘æˆ‘ä»¬å¯ä»¥ç”¨ $R_{t+1}+\gamma v(S_{t+1})$ æ¥è¿‘ä¼¼çš„ä»£æ›¿æ”¶è· $G_t$,ä¸€èˆ¬æˆ‘ä»¬æŠŠ $R_{t+1}+\gamma V(S_{t+1})$ ç§°ä¸ºTDç›®æ ‡å€¼ã€‚$R_{t+1}+\gamma V(S_{t+1})-V(S_t)$ ç§°ä¸ºTDè¯¯å·®ï¼Œå°†ç”¨TDç›®æ ‡å€¼è¿‘ä¼¼ä»£æ›¿æ”¶è· $G(t)$ çš„è¿‡ç¨‹ç§°ä¸ºå¼•å¯¼(bootstrapping)ã€‚è¿™æ ·æˆ‘ä»¬åªéœ€è¦ä¸¤ä¸ªè¿ç»­çš„çŠ¶æ€ä¸å¯¹åº”çš„å¥–åŠ±ï¼Œå°±å¯ä»¥å°è¯•æ±‚è§£å¼ºåŒ–å­¦ä¹ é—®é¢˜äº†ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†è‡ªå·±çš„è¿‘ä¼¼æ”¶è· $G_t$ çš„è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥å»æ±‚è§£æ—¶åºå·®åˆ†çš„é¢„æµ‹é—®é¢˜å’Œæ§åˆ¶é—®é¢˜äº†ã€‚</p>
<h1 id="2-æ—¶åºå·®åˆ†tdçš„é¢„æµ‹é—®é¢˜æ±‚è§£">2. æ—¶åºå·®åˆ†TDçš„é¢„æµ‹é—®é¢˜æ±‚è§£</h1>
<p>æ—¶åºå·®åˆ†çš„é¢„æµ‹é—®é¢˜æ±‚è§£å’Œè’™ç‰¹å¡ç½—æ³•ç±»ä¼¼ï¼Œä½†æ˜¯ä¸»è¦æœ‰ä¸¤ä¸ªä¸åŒç‚¹ã€‚ä¸€æ˜¯æ”¶è· $G_t$ çš„è¡¨è¾¾å¼ä¸åŒï¼Œæ—¶åºå·®åˆ† $G(t)$ çš„è¡¨è¾¾å¼ä¸ºï¼š</p>
<p>$$G(t)=R_{t+1}+\gamma V(S_{t+1})$$</p>
<p>äºŒæ˜¯è¿­ä»£çš„å¼å­ç³»æ•°ç¨æœ‰ä¸åŒï¼Œå›é¡¾è’™ç‰¹å¡ç½—æ³•çš„è¿­ä»£å¼å­æ˜¯ï¼š</p>
<p>$$V(S_t)=V(S_t)+\frac1{N(S_t)}(G_t-V(S_t))$$</p>
<p>ç”±äºåœ¨æ—¶åºå·®åˆ†æˆ‘ä»¬æ²¡æœ‰å®Œæ•´çš„åºåˆ—ï¼Œä¹Ÿå°±æ²¡æœ‰å¯¹åº”çš„æ¬¡æ•° $N(S_t)$ ,ä¸€èˆ¬å°±ç”¨ä¸€ä¸ª[0,1]çš„ç³»æ•° $Î±$ ä»£æ›¿ã€‚è¿™æ ·æ—¶åºå·®åˆ†çš„ä»·å€¼å‡½æ•°è¿­ä»£å¼å­æ˜¯ï¼š</p>
<p>$$V(S_t)=V(S_t)+\alpha(G_t-V(S_t)) \\\\
Q(S_t,A_t)=Q(S_t,A_t)+\alpha(G_t-Q(S_t,A_t)) $$</p>
<p>è¿™é‡Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹è’™ç‰¹å¡ç½—æ³•å’Œæ—¶åºå·®åˆ†æ³•æ±‚è§£é¢„æµ‹é—®é¢˜çš„ä¸åŒã€‚</p>
<p>å‡è®¾æˆ‘ä»¬çš„å¼ºåŒ–å­¦ä¹ é—®é¢˜æœ‰A,Bä¸¤ä¸ªçŠ¶æ€ï¼Œæ¨¡å‹æœªçŸ¥ï¼Œä¸æ¶‰åŠç­–ç•¥å’Œè¡Œä¸ºã€‚åªæ¶‰åŠçŠ¶æ€è½¬åŒ–å’Œå³æ—¶å¥–åŠ±ã€‚ä¸€å…±æœ‰8ä¸ªå®Œæ•´çš„çŠ¶æ€åºåˆ—å¦‚ä¸‹ï¼š</p>
<p>ã€€ã€€â‘  A,0,B,0 â‘¡B,1 â‘¢B,1 â‘£ B,1 â‘¤ B,1 â‘¥B,1 â‘¦B,1 â‘§B,0</p>
<p>åªæœ‰ç¬¬ä¸€ä¸ªçŠ¶æ€åºåˆ—æ˜¯æœ‰çŠ¶æ€è½¬ç§»çš„ï¼Œå…¶ä½™7ä¸ªåªæœ‰ä¸€ä¸ªçŠ¶æ€ã€‚è®¾ç½®è¡°å‡å› å­ $Î³=1$ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬æŒ‰è’™ç‰¹å¡ç½—æ³•æ¥æ±‚è§£é¢„æµ‹é—®é¢˜ã€‚ç”±äºåªæœ‰ç¬¬ä¸€ä¸ªåºåˆ—ä¸­åŒ…å«çŠ¶æ€Aï¼Œå› æ­¤Açš„ä»·å€¼ä»…èƒ½é€šè¿‡ç¬¬ä¸€ä¸ªåºåˆ—æ¥è®¡ç®—ï¼Œä¹Ÿå°±ç­‰åŒäºè®¡ç®—è¯¥åºåˆ—ä¸­çŠ¶æ€Açš„æ”¶è·ï¼š</p>
<p>$$V(A)=G(A)=R_A+\gamma R_B=0$$</p>
<p>å¯¹äºBï¼Œåˆ™éœ€è¦å¯¹å…¶åœ¨8ä¸ªåºåˆ—ä¸­çš„æ”¶è·å€¼æ¥å¹³å‡ï¼Œå…¶ç»“æœæ˜¯6/8ã€‚</p>
<p><strong>å†æ¥çœ‹çœ‹æ—¶åºå·®åˆ†æ³•æ±‚è§£çš„è¿‡ç¨‹</strong>ã€‚å…¶æ”¶è·æ˜¯åœ¨è®¡ç®—çŠ¶æ€åºåˆ—ä¸­æŸçŠ¶æ€ä»·å€¼æ—¶æ˜¯åº”ç”¨å…¶åç»­çŠ¶æ€çš„é¢„ä¼°ä»·å€¼æ¥è®¡ç®—çš„ï¼Œå¯¹äºBæ¥è¯´ï¼Œå®ƒæ€»æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œæ²¡æœ‰åç»­çŠ¶æ€ï¼Œå› æ­¤å®ƒçš„ä»·å€¼ç›´æ¥ç”¨å…¶åœ¨8ä¸ªåºåˆ—ä¸­çš„æ”¶è·å€¼æ¥å¹³å‡ï¼Œå…¶ç»“æœæ˜¯6/8ã€‚</p>
<p>å¯¹äºAï¼Œåªåœ¨ç¬¬ä¸€ä¸ªåºåˆ—å‡ºç°ï¼Œå®ƒçš„ä»·å€¼ä¸ºï¼š</p>
<p>$$V(A)=R_A+\gamma V(B)=\frac68$$</p>
<p>ä»ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°è’™ç‰¹å¡ç½—æ³•å’Œæ—¶åºå·®åˆ†æ³•æ±‚è§£é¢„æµ‹é—®é¢˜çš„åŒºåˆ«ã€‚</p>
<p>ä¸€æ˜¯æ—¶åºå·®åˆ†æ³•åœ¨çŸ¥é“ç»“æœä¹‹å‰å°±å¯ä»¥å­¦ä¹ ï¼Œä¹Ÿå¯ä»¥åœ¨æ²¡æœ‰ç»“æœæ—¶å­¦ä¹ ï¼Œè¿˜å¯ä»¥åœ¨æŒç»­è¿›è¡Œçš„ç¯å¢ƒä¸­å­¦ä¹ ï¼Œè€Œè’™ç‰¹å¡ç½—æ³•åˆ™è¦ç­‰åˆ°æœ€åç»“æœæ‰èƒ½å­¦ä¹ ï¼Œæ—¶åºå·®åˆ†æ³•å¯ä»¥æ›´å¿«é€Ÿçµæ´»çš„æ›´æ–°çŠ¶æ€çš„ä»·å€¼ä¼°è®¡ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹æœ‰ç€éå¸¸é‡è¦çš„å®é™…æ„ä¹‰ã€‚</p>
<p>äºŒæ˜¯æ—¶åºå·®åˆ†æ³•åœ¨æ›´æ–°çŠ¶æ€ä»·å€¼æ—¶ä½¿ç”¨çš„æ˜¯TD ç›®æ ‡å€¼ï¼Œå³åŸºäºå³æ—¶å¥–åŠ±å’Œä¸‹ä¸€çŠ¶æ€çš„é¢„ä¼°ä»·å€¼æ¥æ›¿ä»£å½“å‰çŠ¶æ€åœ¨çŠ¶æ€åºåˆ—ç»“æŸæ—¶å¯èƒ½å¾—åˆ°çš„æ”¶è·ï¼Œæ˜¯å½“å‰çŠ¶æ€ä»·å€¼çš„æœ‰åä¼°è®¡ï¼Œè€Œè’™ç‰¹å¡ç½—æ³•åˆ™ä½¿ç”¨å®é™…çš„æ”¶è·æ¥æ›´æ–°çŠ¶æ€ä»·å€¼ï¼Œæ˜¯æŸä¸€ç­–ç•¥ä¸‹çŠ¶æ€ä»·å€¼çš„æ— åä¼°è®¡ï¼Œè¿™ä¸€ç‚¹è’™ç‰¹å¡ç½—æ³•å ä¼˜ã€‚</p>
<p>ä¸‰æ˜¯è™½ç„¶æ—¶åºå·®åˆ†æ³•å¾—åˆ°çš„ä»·å€¼æ˜¯æœ‰åä¼°è®¡ï¼Œä½†æ˜¯å…¶æ–¹å·®å´æ¯”è’™ç‰¹å¡ç½—æ³•å¾—åˆ°çš„æ–¹å·®è¦ä½ï¼Œä¸”å¯¹åˆå§‹å€¼æ•æ„Ÿï¼Œé€šå¸¸æ¯”è’™ç‰¹å¡ç½—æ³•æ›´åŠ é«˜æ•ˆã€‚</p>
<p>ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºæ—¶åºå·®åˆ†æ³•çš„ä¼˜åŠ¿æ¯”è¾ƒå¤§ï¼Œå› æ­¤ç°åœ¨ä¸»æµçš„å¼ºåŒ–å­¦ä¹ æ±‚è§£æ–¹æ³•éƒ½æ˜¯åŸºäºæ—¶åºå·®åˆ†çš„ã€‚åé¢çš„æ–‡ç« ä¹Ÿä¼šä¸»è¦åŸºäºæ—¶åºå·®åˆ†æ³•æ¥æ‰©å±•è®¨è®ºã€‚</p>
<h1 id="3-næ­¥æ—¶åºå·®åˆ†">3. næ­¥æ—¶åºå·®åˆ†</h1>
<p>åœ¨ç¬¬äºŒèŠ‚çš„æ—¶åºå·®åˆ†æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç”¨ $R_{t+1}+\gamma v(S_{t+1})$ æ¥è¿‘ä¼¼çš„ä»£æ›¿æ”¶è· $G_t$ã€‚å³å‘å‰ä¸€æ­¥æ¥è¿‘ä¼¼æˆ‘ä»¬çš„æ”¶è· $G_{t}$,é‚£ä¹ˆèƒ½ä¸èƒ½å‘å‰ä¸¤æ­¥å‘¢ï¼Ÿå½“ç„¶å¯ä»¥ï¼Œè¿™æ—¶æˆ‘ä»¬çš„æ”¶è· $G_t$ çš„è¿‘ä¼¼è¡¨è¾¾å¼ä¸ºï¼š</p>
<p>$$G_t^{(2)}=R_{t+1}+\gamma R_{t+2}+\gamma^2V(S_{t+2})$$</p>
<p>ä»ä¸¤æ­¥ï¼Œåˆ°ä¸‰æ­¥ï¼Œå†åˆ°næ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å½’çº³å‡ºnæ­¥æ—¶åºå·®åˆ†æ”¶è· $G^{(n)}_t$è¡¨è¾¾å¼ä¸ºï¼š$$G_t^{(n)}=R_{t+1}+\gamma R_{t+2}+\ldots+\gamma^{n-1}R_{t+n}+\gamma^nV(S_{t+n})$$</p>
<p>å½“nè¶Šæ¥è¶Šå¤§ï¼Œè¶‹äºæ— ç©·ï¼Œæˆ–è€…è¯´è¶‹äºä½¿ç”¨å®Œæ•´çš„çŠ¶æ€åºåˆ—æ—¶ï¼Œnæ­¥æ—¶åºå·®åˆ†å°±ç­‰ä»·äºè’™ç‰¹å¡ç½—æ³•äº†ã€‚</p>
<p>å¯¹äºnæ­¥æ—¶åºå·®åˆ†æ¥è¯´ï¼Œå’Œæ™®é€šçš„æ—¶åºå·®åˆ†çš„åŒºåˆ«å°±åœ¨äºæ”¶è·çš„è®¡ç®—æ–¹å¼çš„å·®å¼‚ã€‚é‚£ä¹ˆæ—¢ç„¶æœ‰è¿™ä¸ªnæ­¥çš„è¯´æ³•ï¼Œé‚£ä¹ˆnåˆ°åº•æ˜¯å¤šå°‘æ­¥å¥½å‘¢ï¼Ÿå¦‚ä½•è¡¡é‡nçš„å¥½åå‘¢ï¼Ÿæˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚è®¨è®ºã€‚</p>
<h1 id="4-tdÎ»">4. TD(Î»)</h1>
<p>næ­¥æ—¶åºå·®åˆ†é€‰æ‹©å¤šå°‘æ­¥æ•°ä½œä¸ºä¸€ä¸ªè¾ƒä¼˜çš„è®¡ç®—å‚æ•°æ˜¯éœ€è¦å°è¯•çš„è¶…å‚æ•°è°ƒä¼˜é—®é¢˜ã€‚ä¸ºäº†èƒ½åœ¨ä¸å¢åŠ è®¡ç®—å¤æ‚åº¦çš„æƒ…å†µä¸‹ç»¼åˆè€ƒè™‘æ‰€æœ‰æ­¥æ•°çš„é¢„æµ‹ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°[0,1]çš„å‚æ•° $\lambda$,å®šä¹‰å…¥â€”æ”¶è·æ˜¯ $n$ ä» $1$ åˆ° $\infty$ æ‰€æœ‰æ­¥çš„æ”¶è·ä¹˜ä»¥æƒé‡çš„å’Œã€‚æ¯ä¸€æ­¥çš„æƒé‡æ˜¯ $(1-\lambda)\lambda^{n-1}$,è¿™æ · $\lambda-$æ”¶è·çš„è®¡ç®—å…¬å¼è¡¨ç¤ºä¸º:</p>
<p>$$G_t^\lambda=(1-\lambda)\sum_{n=1}^\infty\lambda^{n-1}G_t^{(n)}$$</p>
<p>è¿›è€Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° $TD(Î»)$ çš„ä»·å€¼å‡½æ•°çš„è¿­ä»£å…¬å¼ï¼š</p>
<p>$$V(S_t)=V(S_t)+\alpha(G_t^\lambda-V(S_t)) \\\\
Q(S_t,A_t)=Q(S_t,A_t)+\alpha(G_t^\lambda-Q(S_t,A_t)) $$</p>
<p>æ¯ä¸€æ­¥æ”¶è·çš„æƒé‡å®šä¹‰ä¸º $(1âˆ’Î»)Î»^{nâˆ’1}$ çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¶å›¾åƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°éšç€nçš„å¢å¤§ï¼Œå…¶ç¬¬næ­¥æ”¶è·çš„æƒé‡å‘ˆå‡ ä½•çº§æ•°çš„è¡°å‡ã€‚å½“åœ¨Tæ—¶åˆ»åˆ°è¾¾ç»ˆæ­¢çŠ¶æ€æ—¶ï¼Œæœªåˆ†é…çš„æƒé‡å…¨éƒ¨ç»™äºˆç»ˆæ­¢çŠ¶æ€çš„å®é™…æ”¶è·å€¼ã€‚è¿™æ ·å¯ä»¥ä½¿ä¸€ä¸ªå®Œæ•´çš„çŠ¶æ€åºåˆ—ä¸­æ‰€æœ‰çš„næ­¥æ”¶è·çš„æƒé‡åŠ èµ·æ¥ä¸º1ï¼Œç¦»å½“å‰çŠ¶æ€è¶Šè¿œçš„æ”¶è·å…¶æƒé‡è¶Šå°ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">TD(Î»)</div>
</center>
<br>
<p>ä»å‰å‘æ¥çœ‹ $TD(Î»)$ï¼Œ ä¸€ä¸ªçŠ¶æ€çš„ä»·å€¼ $V(St)$ç”± $G_t$å¾—åˆ°ï¼Œè€ŒGtï¿½ï¿½åˆé—´æ¥ç”±æ‰€æœ‰åç»­çŠ¶æ€ä»·å€¼è®¡ç®—å¾—åˆ°ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºæ›´æ–°ä¸€ä¸ªçŠ¶æ€çš„ä»·å€¼éœ€è¦çŸ¥é“æ‰€æœ‰åç»­çŠ¶æ€çš„ä»·å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¿…é¡»è¦ç»å†å®Œæ•´çš„çŠ¶æ€åºåˆ—è·å¾—åŒ…æ‹¬ç»ˆæ­¢çŠ¶æ€çš„æ¯ä¸€ä¸ªçŠ¶æ€çš„å³æ—¶å¥–åŠ±æ‰èƒ½æ›´æ–°å½“å‰çŠ¶æ€çš„ä»·å€¼ã€‚è¿™å’Œè’™ç‰¹å¡ç½—æ³•çš„è¦æ±‚ä¸€æ ·ï¼Œå› æ­¤TD(Î»)ï¿½ï¿½(ï¿½)æœ‰ç€å’Œè’™ç‰¹å¡ç½—æ³•ä¸€æ ·çš„åŠ£åŠ¿ã€‚å½“ $Î»=0$ æ—¶,å°±æ˜¯ç¬¬äºŒèŠ‚è®²åˆ°çš„æ™®é€šçš„æ—¶åºå·®åˆ†æ³•ï¼Œå½“ $Î»=1$ æ—¶,å°±æ˜¯è’™ç‰¹å¡ç½—æ³•ã€‚</p>
<p>ä»åå‘æ¥çœ‹ $TD(Î»)$ï¼Œå®ƒå¯ä»¥åˆ†ææˆ‘ä»¬çŠ¶æ€å¯¹åç»­çŠ¶æ€çš„å½±å“ã€‚æ¯”å¦‚è€é¼ åœ¨ä¾æ¬¡è¿ç»­æ¥å—äº†3 æ¬¡å“é“ƒå’Œ1 æ¬¡äº®ç¯ä¿¡å·åé­åˆ°äº†ç”µå‡»ï¼Œé‚£ä¹ˆåœ¨åˆ†æé­ç”µå‡»çš„åŸå› æ—¶ï¼Œåˆ°åº•æ˜¯å“é“ƒçš„å› ç´ è¾ƒé‡è¦è¿˜æ˜¯äº®ç¯çš„å› ç´ æ›´é‡è¦å‘¢ï¼Ÿå¦‚æœæŠŠè€é¼ é­åˆ°ç”µå‡»çš„åŸå› è®¤ä¸ºæ˜¯ä¹‹å‰æ¥å—äº†è¾ƒå¤šæ¬¡æ•°çš„å“é“ƒï¼Œåˆ™ç§°è¿™ç§å½’å› ä¸ºé¢‘ç‡å¯å‘(frequency heuristic) å¼ï¼›è€ŒæŠŠç”µå‡»å½’å› äºæœ€è¿‘å°‘æ•°å‡ æ¬¡çŠ¶æ€çš„å½±å“ï¼Œåˆ™ç§°ä¸ºå°±è¿‘å¯å‘(recency heuristic) å¼ã€‚</p>
<p>å¦‚æœç»™æ¯ä¸€ä¸ªçŠ¶æ€å¼•å…¥ä¸€ä¸ªæ•°å€¼ï¼šæ•ˆç”¨(eligibility, E) æ¥è¡¨ç¤ºè¯¥çŠ¶æ€å¯¹åç»­çŠ¶æ€çš„å½±å“ï¼Œå°±å¯ä»¥åŒæ—¶åˆ©ç”¨åˆ°ä¸Šè¿°ä¸¤ä¸ªå¯å‘ã€‚è€Œæ‰€æœ‰çŠ¶æ€çš„æ•ˆç”¨å€¼æ€»ç§°ä¸ºæ•ˆç”¨è¿¹(eligibility traces,ES)ã€‚å®šä¹‰ä¸ºï¼š</p>
<p>$$ E_0(s)=0 \\\\ \left.E_t(s)=\gamma\lambda E_{t-1}(s)+1(S_t=s)=\left\\{\begin{array}{ll}0&amp;t&lt;k\\\\(\gamma\lambda)^{t-k}&amp;t\geq k\end{array}\right.\right.,\quad s.t.\quad\lambda,\gamma\in[0,1],s\textit{ is visited once at time k}$$</p>
<p>æ­¤æ—¶æˆ‘ä»¬$TD(Î»)$çš„ä»·å€¼å‡½æ•°æ›´æ–°å¼å­å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<p>$$\delta_t=R_{t+1}+\gamma v(S_{t+1})-V(S_t)\\\\V(S_t)=V(S_t)+\alpha\delta_tE_t(s)$$</p>
<p>ä¹Ÿè®¸æœ‰äººä¼šé—®ï¼Œè¿™å‰å‘çš„å¼å­å’Œåå‘çš„å¼å­çœ‹èµ·æ¥ä¸åŒå•Šï¼Œæ˜¯ä¸æ˜¯ä¸åŒçš„é€»è¾‘å‘¢ï¼Ÿå…¶å®ä¸¤è€…æ˜¯ç­‰ä»·çš„ã€‚ç°åœ¨æˆ‘ä»¬ä»å‰å‘æ¨å¯¼ä¸€ä¸‹åå‘çš„æ›´æ–°å¼å­ã€‚</p>
<p>$$\begin{aligned}
G_t^\lambda-V(S_t)&amp; =-V(S_t)+(1-\lambda)\lambda^0(R_{t+1}+\gamma V(S_{t+1})) &amp;&amp; \text{(1)}  \\\\
&amp;+(1-\lambda)\lambda^1(R_{t+1}+\gamma R_{t+2}+\gamma^2V(S_{t+2}))&amp;&amp; (2)  \\\\
&amp;+(1-\lambda)\lambda^2(R_{t+1}+\gamma R_{t+2}+\gamma^2R_{t+3}+\gamma^3V(S_{t+3}))&amp;&amp; (3)  \\\\
&amp;+\ldots &amp;&amp; \text{(4)}  \\\\
&amp;=-V(S_t)+(\gamma\lambda)^0(R_{t+1}+\gamma V(S_{t+1})-\gamma\lambda V(S_{t+1}))&amp;&amp; (5)  \\\\
&amp;+(\gamma\lambda)^1(R_{t+2}+\gamma V(S_{t+2})-\gamma\lambda V(S_{t+2}))&amp;&amp; \text{(6)}  \\\\
&amp;+(\gamma\lambda)^2(R_{t+3}+\gamma V(S_{t+3})-\gamma\lambda V(S_{t+3}))&amp;&amp; \text{(7)}  \\\\
&amp;\begin{array}{c}+\ldots\end{array}&amp;&amp; \text{(8)}  \\\\
&amp;=(\gamma\lambda)^0(R_{t+1}+\gamma V(S_{t+1})-V(S_t))&amp;&amp; \left(9\right)  \\\\
&amp;+(\gamma\lambda)^1(R_{t+2}+\gamma V(S_{t+2})-V(S_{t+1}))&amp;&amp; \text{(10)}  \\\\
&amp;+(\gamma\lambda)^2(R_{t+3}+\gamma V(S_{t+3})-V(S_{t+2}))&amp;&amp; (11)  \\\\
&amp;\begin{array}{c}+\ldots\end{array}&amp;&amp; (12)  \\\\
&amp;=\delta_t+\gamma\lambda\delta_{t+1}+(\gamma\lambda)^2\delta_{t+2}+\ldots &amp;&amp; (13)
\end{aligned}$$</p>
<p>å¯ä»¥çœ‹å‡ºå‰å‘TDè¯¯å·®å’Œåå‘çš„TDè¯¯å·®å®é™…ä¸Šä¸€è‡´çš„ã€‚</p>
<h1 id="5-æ—¶åºå·®åˆ†çš„æ§åˆ¶é—®é¢˜æ±‚è§£">5. æ—¶åºå·®åˆ†çš„æ§åˆ¶é—®é¢˜æ±‚è§£</h1>
<p>ç°åœ¨æˆ‘ä»¬å›åˆ°æ™®é€šçš„æ—¶åºå·®åˆ†ï¼Œæ¥çœ‹çœ‹å®ƒæ§åˆ¶é—®é¢˜çš„æ±‚è§£æ–¹æ³•ã€‚å›æƒ³ä¸Šä¸€ç¯‡è’™ç‰¹å¡ç½—æ³•åœ¨çº¿æ§åˆ¶çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯$Ïµâˆ’$è´ªå©ªæ³•æ¥åšä»·å€¼è¿­ä»£ã€‚å¯¹äºæ—¶åºå·®åˆ†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨$Ïµâˆ’$è´ªå©ªæ³•æ¥ä»·å€¼è¿­ä»£ï¼Œå’Œè’™ç‰¹å¡ç½—æ³•åœ¨çº¿æ§åˆ¶çš„åŒºåˆ«ä¸»è¦åªæ˜¯åœ¨äºæ”¶è·çš„è®¡ç®—æ–¹å¼ä¸åŒã€‚æ—¶åºå·®åˆ†çš„åœ¨çº¿æ§åˆ¶(on-policy)ç®—æ³•æœ€å¸¸è§çš„æ˜¯SARSAç®—æ³•ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€ç¯‡å•ç‹¬è®²è§£ã€‚</p>
<p>è€Œé™¤äº†åœ¨çº¿æ§åˆ¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åšç¦»çº¿æ§åˆ¶(off-policy)ï¼Œç¦»çº¿æ§åˆ¶å’Œåœ¨çº¿æ§åˆ¶çš„åŒºåˆ«ä¸»è¦åœ¨äºåœ¨çº¿æ§åˆ¶ä¸€èˆ¬åªæœ‰ä¸€ä¸ªç­–ç•¥(æœ€å¸¸è§çš„æ˜¯$Ïµâˆ’$è´ªå©ªæ³•)ã€‚è€Œç¦»çº¿æ§åˆ¶ä¸€èˆ¬æœ‰ä¸¤ä¸ªç­–ç•¥ï¼Œå…¶ä¸­ä¸€ä¸ªç­–ç•¥(æœ€å¸¸è§çš„æ˜¯$Ïµâˆ’$è´ªå©ªæ³•)ç”¨äºé€‰æ‹©æ–°çš„åŠ¨ä½œï¼Œå¦ä¸€ä¸ªç­–ç•¥(æœ€å¸¸è§çš„æ˜¯è´ªå©ªæ³•)ç”¨äºæ›´æ–°ä»·å€¼å‡½æ•°ã€‚æ—¶åºå·®åˆ†çš„ç¦»çº¿æ§åˆ¶ç®—æ³•æœ€å¸¸è§çš„æ˜¯Q-Learningç®—æ³•ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸‹ç¯‡å•ç‹¬è®²è§£ã€‚</p>
<h1 id="6-æ—¶åºå·®åˆ†å°ç»“">6. æ—¶åºå·®åˆ†å°ç»“</h1>
<p>æ—¶åºå·®åˆ†å’Œè’™ç‰¹å¡ç½—æ³•æ¯”å®ƒæ›´åŠ çµæ´»ï¼Œå­¦ä¹ èƒ½åŠ›æ›´å¼ºï¼Œå› æ­¤æ˜¯ç›®å‰ä¸»æµçš„å¼ºåŒ–å­¦ä¹ æ±‚è§£é—®é¢˜çš„æ–¹æ³•ï¼Œç°åœ¨ç»å¤§éƒ¨åˆ†å¼ºåŒ–å­¦ä¹ ä¹ƒè‡³æ·±åº¦å¼ºåŒ–å­¦ä¹ çš„æ±‚è§£éƒ½æ˜¯ä»¥æ—¶åºå·®åˆ†çš„æ€æƒ³ä¸ºåŸºç¡€çš„ã€‚å› æ­¤åé¢æˆ‘ä»¬ä¼šé‡ç‚¹è®¨è®ºã€‚</p>
<p>ä¸‹ä¸€ç¯‡æˆ‘ä»¬ä¼šè®¨è®ºæ—¶åºå·®åˆ†çš„åœ¨çº¿æ§åˆ¶ç®—æ³•SARSAã€‚</p>
]]></description></item><item><title>RLå­¦ä¹ ç¬”è®° [6] | æ—¶åºå·®åˆ†åœ¨çº¿æ§åˆ¶ç®—æ³•SARSA</title><link>https://jianye0428.github.io/posts/rl_learning_note_6/</link><pubDate>Thu, 22 Feb 2024 16:29:33 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/rl_learning_note_6/</guid><description><![CDATA[<h1 id="0-å¼•è¨€">0. å¼•è¨€</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/9529828.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆäº”ï¼‰ç”¨æ—¶åºå·®åˆ†æ³•ï¼ˆTDï¼‰æ±‚è§£<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ç”¨æ—¶åºå·®åˆ†æ¥æ±‚è§£å¼ºåŒ–å­¦ä¹ é¢„æµ‹é—®é¢˜çš„æ–¹æ³•ï¼Œä½†æ˜¯å¯¹æ§åˆ¶ç®—æ³•çš„æ±‚è§£è¿‡ç¨‹æ²¡æœ‰æ·±å…¥ï¼Œæœ¬æ–‡æˆ‘ä»¬å°±å¯¹æ—¶åºå·®åˆ†çš„åœ¨çº¿æ§åˆ¶ç®—æ³•SARSAåšè¯¦ç»†çš„è®¨è®ºã€‚</p>
<p>SARSAè¿™ä¸€ç¯‡å¯¹åº”Suttonä¹¦çš„ç¬¬å…­ç« éƒ¨åˆ†å’ŒUCLå¼ºåŒ–å­¦ä¹ è¯¾ç¨‹çš„ç¬¬äº”è®²éƒ¨åˆ†ã€‚</p>
<h1 id="1-sarsaç®—æ³•çš„å¼•å…¥">1. SARSAç®—æ³•çš„å¼•å…¥</h1>
<p>SARSAç®—æ³•æ˜¯ä¸€ç§ä½¿ç”¨æ—¶åºå·®åˆ†æ±‚è§£å¼ºåŒ–å­¦ä¹ æ§åˆ¶é—®é¢˜çš„æ–¹æ³•ï¼Œå›é¡¾ä¸‹æ­¤æ—¶æˆ‘ä»¬çš„æ§åˆ¶é—®é¢˜å¯ä»¥è¡¨ç¤ºä¸ºï¼šç»™å®šå¼ºåŒ–å­¦ä¹ çš„5ä¸ªè¦ç´ ï¼šçŠ¶æ€é›† $S$, åŠ¨ä½œé›† $A$, å³æ—¶å¥–åŠ± $R$ï¼Œè¡°å‡å› å­ $Î³$, æ¢ç´¢ç‡ $Ïµ$, æ±‚è§£æœ€ä¼˜çš„åŠ¨ä½œä»·å€¼å‡½æ•° $qâˆ—$ å’Œæœ€ä¼˜ç­–ç•¥ $Ï€âˆ—$ã€‚</p>
<p>è¿™ä¸€ç±»å¼ºåŒ–å­¦ä¹ çš„é—®é¢˜æ±‚è§£ä¸éœ€è¦ç¯å¢ƒçš„çŠ¶æ€è½¬åŒ–æ¨¡å‹ï¼Œæ˜¯<strong>ä¸åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ é—®é¢˜</strong>æ±‚è§£æ–¹æ³•ã€‚å¯¹äºå®ƒçš„æ§åˆ¶é—®é¢˜æ±‚è§£ï¼Œå’Œè’™ç‰¹å¡ç½—æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯ä»·å€¼è¿­ä»£ï¼Œå³é€šè¿‡ä»·å€¼å‡½æ•°çš„æ›´æ–°ï¼Œæ¥æ›´æ–°å½“å‰çš„ç­–ç•¥ï¼Œå†é€šè¿‡æ–°çš„ç­–ç•¥ï¼Œæ¥äº§ç”Ÿæ–°çš„çŠ¶æ€å’Œå³æ—¶å¥–åŠ±ï¼Œè¿›è€Œæ›´æ–°ä»·å€¼å‡½æ•°ã€‚ä¸€ç›´è¿›è¡Œä¸‹å»ï¼Œç›´åˆ°ä»·å€¼å‡½æ•°å’Œç­–ç•¥éƒ½æ”¶æ•›ã€‚</p>
<p>å†å›é¡¾ä¸‹æ—¶åºå·®åˆ†æ³•çš„æ§åˆ¶é—®é¢˜ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯åœ¨çº¿æ§åˆ¶ï¼Œå³ä¸€ç›´ä½¿ç”¨ä¸€ä¸ªç­–ç•¥æ¥æ›´æ–°ä»·å€¼å‡½æ•°å’Œé€‰æ‹©æ–°çš„åŠ¨ä½œã€‚è€Œå¦ä¸€ç±»æ˜¯ç¦»çº¿æ§åˆ¶ï¼Œä¼šä½¿ç”¨ä¸¤ä¸ªæ§åˆ¶ç­–ç•¥ï¼Œä¸€ä¸ªç­–ç•¥ç”¨äºé€‰æ‹©æ–°çš„åŠ¨ä½œï¼Œå¦ä¸€ä¸ªç­–ç•¥ç”¨äºæ›´æ–°ä»·å€¼å‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬çš„SARSAç®—æ³•ï¼Œå±äºåœ¨çº¿æ§åˆ¶è¿™ä¸€ç±»ï¼Œå³ä¸€ç›´ä½¿ç”¨ä¸€ä¸ªç­–ç•¥æ¥æ›´æ–°ä»·å€¼å‡½æ•°å’Œé€‰æ‹©æ–°çš„åŠ¨ä½œï¼Œè€Œè¿™ä¸ªç­–ç•¥æ˜¯ $Ïµâˆ’$è´ªå©ªæ³•ï¼Œåœ¨<a href="https://www.cnblogs.com/pinard/p/9492980.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆå››ï¼‰ç”¨è’™ç‰¹å¡ç½—æ³•ï¼ˆMCï¼‰æ±‚è§£<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­ï¼Œæˆ‘ä»¬å¯¹äº $Ïµâˆ’$è´ªå©ªæ³•æœ‰è¯¦ç»†è®²è§£ï¼Œå³é€šè¿‡è®¾ç½®ä¸€ä¸ªè¾ƒå°çš„ $Ïµ$ å€¼ï¼Œä½¿ç”¨ $1âˆ’Ïµ$ çš„æ¦‚ç‡è´ªå©ªåœ°é€‰æ‹©ç›®å‰è®¤ä¸ºæ˜¯æœ€å¤§è¡Œä¸ºä»·å€¼çš„è¡Œä¸ºï¼Œè€Œç”¨ $Ïµ$ çš„æ¦‚ç‡éšæœºçš„ä»æ‰€æœ‰ m ä¸ªå¯é€‰è¡Œä¸ºä¸­é€‰æ‹©è¡Œä¸ºã€‚ç”¨å…¬å¼å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<p>$$\left.\pi(a|s)=\left\\{\begin{array}{ll}\epsilon/m+1-\epsilon&amp;if\mathrm{~}a^*=\arg\max_{a\in A}Q(s,a)\\\\\epsilon/m&amp;else\end{array}\right.\right.$$</p>
<p>Ï€(a|s)={Ïµ/m+1âˆ’Ïµifaâˆ—=argmaxaâˆˆAQ(s,a)Ïµ/melseï¿½(ï¿½|ï¿½)={ï¿½/ï¿½+1âˆ’ï¿½ï¿½ï¿½ï¿½âˆ—=argâ¡maxï¿½âˆˆï¿½ï¿½(ï¿½,ï¿½)ï¿½/ï¿½ï¿½ï¿½ï¿½ï¿½</p>
<h1 id="2-sarsaç®—æ³•æ¦‚è¿°">2. SARSAç®—æ³•æ¦‚è¿°</h1>
<p>ä½œä¸ºSARSAç®—æ³•çš„åå­—æœ¬èº«æ¥è¯´ï¼Œå®ƒå®é™…ä¸Šæ˜¯ç”± $S,A,R,S,A$ å‡ ä¸ªå­—æ¯ç»„æˆçš„ã€‚è€Œ $S,A,R$ åˆ†åˆ«ä»£è¡¨çŠ¶æ€ï¼ˆStateï¼‰ï¼ŒåŠ¨ä½œ(Action),å¥–åŠ±(Reward)ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å‰é¢ä¸€ç›´åœ¨ä½¿ç”¨çš„ç¬¦å·ã€‚è¿™ä¸ªæµç¨‹ä½“ç°åœ¨ä¸‹å›¾ï¼š</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">SARSA Transition</div>
</center>
<br>
<p>åœ¨è¿­ä»£çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆåŸºäº $Ïµâˆ’$è´ªå©ªæ³•åœ¨å½“å‰çŠ¶æ€ $S$ é€‰æ‹©ä¸€ä¸ªåŠ¨ä½œ $A$ ï¼Œè¿™æ ·ç³»ç»Ÿä¼šè½¬åˆ°ä¸€ä¸ªæ–°çš„çŠ¶æ€ $Sâ€²$, åŒæ—¶ç»™æˆ‘ä»¬ä¸€ä¸ªå³æ—¶å¥–åŠ± $R$ , åœ¨æ–°çš„çŠ¶æ€ $Sâ€²$ï¼Œæˆ‘ä»¬ä¼šåŸºäº $Ïµâˆ’$è´ªå©ªæ³•åœ¨çŠ¶æ€ $Sâ€²$ é€‰æ‹©ä¸€ä¸ªåŠ¨ä½œ $Aâ€²$ï¼Œä½†æ˜¯æ³¨æ„è¿™æ—¶å€™æˆ‘ä»¬å¹¶ä¸æ‰§è¡Œè¿™ä¸ªåŠ¨ä½œ $Aâ€²$ï¼Œåªæ˜¯ç”¨æ¥æ›´æ–°çš„æˆ‘ä»¬çš„ä»·å€¼å‡½æ•°ï¼Œä»·å€¼å‡½æ•°çš„æ›´æ–°å…¬å¼æ˜¯ï¼š</p>
<p>$$Q(S,A)=Q(S,A)+\alpha(R+\gamma Q(S^{\prime},A^{\prime})-Q(S,A))$$</p>
<p>å…¶ä¸­ï¼Œ$Î³$ æ˜¯è¡°å‡å› å­ï¼Œ$Î±$ æ˜¯è¿­ä»£æ­¥é•¿ã€‚è¿™é‡Œå’Œè’™ç‰¹å¡ç½—æ³•æ±‚è§£åœ¨çº¿æ§åˆ¶é—®é¢˜çš„è¿­ä»£å…¬å¼çš„åŒºåˆ«ä¸»è¦æ˜¯ï¼Œæ”¶è· $G_t$çš„è¡¨è¾¾å¼ä¸åŒï¼Œå¯¹äºæ—¶åºå·®åˆ†ï¼Œæ”¶è· $G_t$çš„è¡¨è¾¾å¼æ˜¯ $R+\gamma Q(S&rsquo;,A&rsquo;)$ ã€‚è¿™ä¸ªä»·å€¼å‡½æ•°æ›´æ–°çš„è´å°”æ›¼å…¬å¼æˆ‘ä»¬åœ¨<a href="https://www.cnblogs.com/pinard/p/9529828.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆäº”ï¼‰ç”¨æ—¶åºå·®åˆ†æ³•ï¼ˆTDï¼‰æ±‚è§£<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ç¬¬2èŠ‚æœ‰è¯¦ç»†è®²åˆ°ã€‚</p>
<p>é™¤äº†æ”¶è· $G_t$çš„è¡¨è¾¾å¼ä¸åŒï¼ŒSARSAç®—æ³•å’Œè’™ç‰¹å¡ç½—åœ¨çº¿æ§åˆ¶ç®—æ³•åŸºæœ¬ç±»ä¼¼ã€‚</p>
<h1 id="3-sarsaç®—æ³•æµç¨‹">3. SARSAç®—æ³•æµç¨‹</h1>
<p>ä¸‹é¢æˆ‘ä»¬æ€»ç»“ä¸‹SARSAç®—æ³•çš„æµç¨‹ã€‚</p>
<ul>
<li>ç®—æ³•è¾“å…¥ï¼šè¿­ä»£è½®æ•° $T$ï¼ŒçŠ¶æ€é›† $S$, åŠ¨ä½œé›† $A$, æ­¥é•¿ $Î±$ï¼Œè¡°å‡å› å­ $Î³$, æ¢ç´¢ç‡ $Ïµ$,</li>
<li>è¾“å‡ºï¼šæ‰€æœ‰çš„çŠ¶æ€å’ŒåŠ¨ä½œå¯¹åº”çš„ä»·å€¼ $Q$</li>
<li>
<ol>
<li>éšæœºåˆå§‹åŒ–æ‰€æœ‰çš„çŠ¶æ€å’ŒåŠ¨ä½œå¯¹åº”çš„ä»·å€¼Qï¿½. å¯¹äºç»ˆæ­¢çŠ¶æ€å…¶Qï¿½å€¼åˆå§‹åŒ–ä¸º0.</li>
</ol>
</li>
<li>
<ol start="2">
<li>for i from 1 to Tï¼Œè¿›è¡Œè¿­ä»£ã€‚</li>
</ol>
<ul>
<li>a) åˆå§‹åŒ– $S$ ä¸ºå½“å‰çŠ¶æ€åºåˆ—çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ã€‚è®¾ç½® $A$ ä¸º $Ïµâˆ’$è´ªå©ªæ³•åœ¨å½“å‰çŠ¶æ€$S$ é€‰æ‹©çš„åŠ¨ä½œã€‚</li>
<li>b) åœ¨çŠ¶æ€ $S$ æ‰§è¡Œå½“å‰åŠ¨ä½œ $A$ ,å¾—åˆ°æ–°çŠ¶æ€ $Sâ€²$ å’Œ å¥–åŠ± $R$</li>
<li>c) ç”¨ $\epsilon-$è´ªå©ªæ³•åœ¨çŠ¶æ€ $S&rsquo;$ é€‰æ‹©æ–°çš„åŠ¨ä½œ $A'$</li>
<li>d) æ›´æ–°ä»·å€¼å‡½æ•° $Q(S,A)$:
<ul>
<li>$$Q(S,A)=Q(S,A)+\alpha(R+\gamma Q(S^{\prime},A^{\prime})-Q(S,A))$$</li>
</ul>
</li>
<li>e) $S=Sâ€²$, $A=Aâ€²$</li>
<li>f) å¦‚æœ $Sâ€²$ æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œå½“å‰è½®è¿­ä»£å®Œæ¯•ï¼Œå¦åˆ™è½¬åˆ°æ­¥éª¤b)</li>
</ul>
</li>
</ul>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªè¦æ³¨æ„çš„æ˜¯ï¼Œæ­¥é•¿ $Î±$ä¸€èˆ¬éœ€è¦éšç€è¿­ä»£çš„è¿›è¡Œé€æ¸å˜å°ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯åŠ¨ä½œä»·å€¼å‡½æ•° $Q$ å¯ä»¥æ”¶æ•›ã€‚å½“ $Q$ æ”¶æ•›æ—¶ï¼Œæˆ‘ä»¬çš„ç­–ç•¥ $Ïµâˆ’$è´ªå©ªæ³•ä¹Ÿå°±æ”¶æ•›äº†ã€‚</p>
<h1 id="4-sarsaç®—æ³•å®ä¾‹windy-gridworld">4. SARSAç®—æ³•å®ä¾‹ï¼šWindy GridWorld</h1>
<p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªè‘—åçš„å®ä¾‹Windy GridWorldæ¥ç ”ç©¶SARSAç®—æ³•ã€‚</p>
<p>å¦‚ä¸‹å›¾ä¸€ä¸ª10Ã—7çš„é•¿æ–¹å½¢æ ¼å­ä¸–ç•Œï¼Œæ ‡è®°æœ‰ä¸€ä¸ªèµ·å§‹ä½ç½® S å’Œä¸€ä¸ªç»ˆæ­¢ç›®æ ‡ä½ç½® Gï¼Œæ ¼å­ä¸‹æ–¹çš„æ•°å­—è¡¨ç¤ºå¯¹åº”çš„åˆ—ä¸­ä¸€å®šå¼ºåº¦çš„é£ã€‚å½“ä¸ªä½“è¿›å…¥è¯¥åˆ—çš„æŸä¸ªæ ¼å­æ—¶ï¼Œä¼šæŒ‰å›¾ä¸­ç®­å¤´æ‰€ç¤ºçš„æ–¹å‘è‡ªåŠ¨ç§»åŠ¨æ•°å­—è¡¨ç¤ºçš„æ ¼æ•°ï¼Œå€Ÿæ­¤æ¥æ¨¡æ‹Ÿä¸–ç•Œä¸­é£çš„ä½œç”¨ã€‚åŒæ ·æ ¼å­ä¸–ç•Œæ˜¯æœ‰è¾¹ç•Œçš„ï¼Œä¸ªä½“ä»»æ„æ—¶åˆ»åªèƒ½å¤„åœ¨ä¸–ç•Œå†…éƒ¨çš„ä¸€ä¸ªæ ¼å­ä¸­ã€‚ä¸ªä½“å¹¶ä¸æ¸…æ¥šè¿™ä¸ªä¸–ç•Œçš„æ„é€ ä»¥åŠæœ‰é£ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸çŸ¥é“æ ¼å­æ˜¯é•¿æ–¹å½¢çš„ï¼Œä¹Ÿä¸çŸ¥é“è¾¹ç•Œåœ¨å“ªé‡Œï¼Œä¹Ÿä¸çŸ¥é“è‡ªå·±åœ¨é‡Œé¢ç§»åŠ¨ç§»æ­¥åä¸‹ä¸€ä¸ªæ ¼å­ä¸ä¹‹å‰æ ¼å­çš„ç›¸å¯¹ä½ç½®å…³ç³»ï¼Œå½“ç„¶å®ƒä¹Ÿä¸æ¸…æ¥šèµ·å§‹ä½ç½®ã€ç»ˆæ­¢ç›®æ ‡çš„å…·ä½“ä½ç½®ã€‚ä½†æ˜¯ä¸ªä½“ä¼šè®°ä½æ›¾ç»ç»è¿‡çš„æ ¼å­ï¼Œä¸‹æ¬¡åœ¨è¿›å…¥è¿™ä¸ªæ ¼å­æ—¶ï¼Œå®ƒèƒ½å‡†ç¡®çš„è¾¨è®¤å‡ºè¿™ä¸ªæ ¼å­æ›¾ç»ä»€ä¹ˆæ—¶å€™æ¥è¿‡ã€‚æ ¼å­å¯ä»¥æ‰§è¡Œçš„è¡Œä¸ºæ˜¯æœä¸Šã€ä¸‹ã€å·¦ã€å³ç§»åŠ¨ä¸€æ­¥ï¼Œæ¯ç§»åŠ¨ä¸€æ­¥åªè¦ä¸æ˜¯è¿›å…¥ç›®æ ‡ä½ç½®éƒ½ç»™äºˆä¸€ä¸ª -1 çš„æƒ©ç½šï¼Œç›´è‡³è¿›å…¥ç›®æ ‡ä½ç½®åè·å¾—å¥–åŠ± 0 åŒæ—¶æ°¸ä¹…åœç•™åœ¨è¯¥ä½ç½®ã€‚ç°åœ¨è¦æ±‚è§£çš„é—®é¢˜æ˜¯ä¸ªä½“åº”è¯¥éµå¾ªæ€æ ·çš„ç­–ç•¥æ‰èƒ½å°½å¿«çš„ä»èµ·å§‹ä½ç½®åˆ°è¾¾ç›®æ ‡ä½ç½®ã€‚</p>
<br>
<center>
  
  <br>
  <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">Windy GridWorld</div>
</center>
<br>
<p>é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œå®Œæ•´çš„ä»£ç åœ¨<a href="https://github.com/ljpzzz/machinelearning/blob/master/reinforcement-learning/sarsa_windy_world.py"target="_blank" rel="external nofollow noopener noreferrer">æˆ‘çš„github<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚è¿™é‡Œæˆ‘ä¸»è¦çœ‹ä¸€ä¸‹å…³é”®éƒ¨åˆ†çš„ä»£ç ã€‚</p>
<p>ç®—æ³•ä¸­ç¬¬2æ­¥æ­¥éª¤a,åˆå§‹åŒ– $S$,ä½¿ç”¨ $Ïµâˆ’$è´ªå©ªæ³•åœ¨å½“å‰çŠ¶æ€ $S$ é€‰æ‹©çš„åŠ¨ä½œçš„è¿‡ç¨‹ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># initialize state</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span> <span class="o">=</span> <span class="n">START</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># choose an action based on epsilon-greedy algorithm</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">EPSILON</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">ACTIONS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">values_</span> <span class="o">=</span> <span class="n">q_value</span><span class="p">[</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl">  <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">action_</span> <span class="k">for</span> <span class="n">action_</span><span class="p">,</span> <span class="n">value_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values_</span><span class="p">)</span> <span class="k">if</span> <span class="n">value_</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values_</span><span class="p">)])</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç®—æ³•ä¸­ç¬¬2æ­¥æ­¥éª¤b,åœ¨çŠ¶æ€Sï¿½æ‰§è¡Œå½“å‰åŠ¨ä½œAï¿½,å¾—åˆ°æ–°çŠ¶æ€Sâ€²ï¿½â€²çš„è¿‡ç¨‹ï¼Œç”±äºå¥–åŠ±ä¸æ˜¯ç»ˆæ­¢å°±æ˜¯-1ï¼Œä¸éœ€è¦å•ç‹¬è®¡ç®—ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">state</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="n">ACTION_UP</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">WIND</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">j</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">ACTION_DOWN</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">WIND</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">WORLD_HEIGHT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">j</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">ACTION_LEFT</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">WIND</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">ACTION_RIGHT</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">WIND</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">WORLD_WIDTH</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="kc">False</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç®—æ³•ä¸­ç¬¬2æ­¥æ­¥éª¤c,ç”¨ $Ïµâˆ’$è´ªå©ªæ³•åœ¨çŠ¶æ€ $S&rsquo;$é€‰æ‹©æ–°çš„åŠ¨ä½œ $Aâ€²$çš„è¿‡ç¨‹ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">next_state</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">EPSILON</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">next_action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">ACTIONS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">values_</span> <span class="o">=</span> <span class="n">q_value</span><span class="p">[</span><span class="n">next_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">next_state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl">  <span class="n">next_action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">action_</span> <span class="k">for</span> <span class="n">action_</span><span class="p">,</span> <span class="n">value_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values_</span><span class="p">)</span> <span class="k">if</span> <span class="n">value_</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values_</span><span class="p">)])</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç®—æ³•ä¸­ç¬¬2æ­¥æ­¥éª¤d,e, æ›´æ–°ä»·å€¼å‡½æ•° $Q(S,A)$ ä»¥åŠæ›´æ–°å½“å‰çŠ¶æ€åŠ¨ä½œçš„è¿‡ç¨‹ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Sarsa update</span>
</span></span><span class="line"><span class="cl"><span class="n">q_value</span><span class="p">[</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">action</span><span class="p">]</span> <span class="o">+=</span> \
</span></span><span class="line"><span class="cl">  <span class="n">ALPHA</span> <span class="o">*</span> <span class="p">(</span><span class="n">REWARD</span> <span class="o">+</span> <span class="n">q_value</span><span class="p">[</span><span class="n">next_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">next_state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">next_action</span><span class="p">]</span> <span class="o">-</span> <span class="n">q_value</span><span class="p">[</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">action</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span> <span class="o">=</span> <span class="n">next_state</span>
</span></span><span class="line"><span class="cl"><span class="n">action</span> <span class="o">=</span> <span class="n">next_action</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä»£ç å¾ˆç®€å•ï¼Œç›¸ä¿¡å¤§å®¶å¯¹ç…§ç®—æ³•ï¼Œè·‘è·‘ä»£ç ï¼Œå¯ä»¥å¾ˆå®¹æ˜“å¾—åˆ°è¿™ä¸ªé—®é¢˜çš„æœ€ä¼˜è§£ï¼Œè¿›è€Œææ¸…æ¥šSARSAç®—æ³•çš„æ•´ä¸ªæµç¨‹ã€‚</p>
<h1 id="5-sarsaÎ»">5. SARSA(Î»)</h1>
<p>åœ¨<a href="https://www.cnblogs.com/pinard/p/9529828.html"target="_blank" rel="external nofollow noopener noreferrer">å¼ºåŒ–å­¦ä¹ ï¼ˆäº”ï¼‰ç”¨æ—¶åºå·®åˆ†æ³•ï¼ˆTDï¼‰æ±‚è§£<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ä¸­æˆ‘ä»¬è®²åˆ°äº†å¤šæ­¥æ—¶åºå·®åˆ† $TD(Î»)$ çš„ä»·å€¼å‡½æ•°è¿­ä»£æ–¹æ³•ï¼Œé‚£ä¹ˆåŒæ ·çš„ï¼Œå¯¹åº”çš„å¤šæ­¥æ—¶åºå·®åˆ†åœ¨çº¿æ§åˆ¶ç®—æ³•ï¼Œå°±æ˜¯æˆ‘ä»¬çš„ $SARSA(Î»)$ã€‚</p>
<p>$TD(\lambda)$æœ‰å‰å‘å’Œåå‘ä¸¤ç§ä»·å€¼å‡½æ•°è¿­ä»£æ–¹å¼ï¼Œå½“ç„¶å®ƒä»¬æ˜¯ç­‰ä»·çš„ã€‚åœ¨æ§åˆ¶é—®é¢˜çš„æ±‚è§£æ—¶ï¼ŒåŸºäºåå‘è®¤è¯†çš„ $SARSA(\lambda)$ç®—æ³•å°†å¯ä»¥æœ‰æ•ˆåœ°åœ¨çº¿å­¦ä¹ ï¼Œæ•°æ®å­¦ä¹ å®Œå³å¯ä¸¢å¼ƒã€‚å› æ­¤ $SARSA(\lambda)$ç®—æ³•é»˜è®¤éƒ½æ˜¯åŸºäºåå‘æ¥è¿›è¡Œä»·å€¼å‡½æ•°è¿­ä»£ã€‚</p>
<p>åœ¨ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²åˆ°äº†$TD(\lambda)$çŠ¶æ€ä»·å€¼å‡½æ•°çš„åå‘è¿­ä»£ï¼Œå³ï¼š</p>
<p>$$\begin{gathered}\delta_t=R_{t+1}+\gamma V(S_{t+1})-V(S_t)\\\\V(S_t)=V(S_t)+\alpha\delta_tE_t(S)\end{gathered}$$</p>
<p>å¯¹åº”çš„åŠ¨ä½œä»·å€¼å‡½æ•°çš„è¿­ä»£å…¬å¼å¯ä»¥æ‰¾æ ·å†™å‡ºï¼Œå³ï¼š</p>
<p>$$\begin{gathered}\delta_t=R_{t+1}+\gamma Q(S_{t+1},A_{t+1})-Q(S_t,A_t)\\\\Q(S_t,A_t)=Q(S_t,A_t)+\alpha\delta_tE_t(S,A)\end{gathered}$$</p>
<p>é™¤äº†çŠ¶æ€ä»·å€¼å‡½æ•° $Q(S,A)$ çš„æ›´æ–°æ–¹å¼ï¼Œå¤šæ­¥å‚æ•° $Î»$ ä»¥åŠåå‘è®¤è¯†å¼•å…¥çš„æ•ˆç”¨è¿¹ $E(S,A)$ ï¼Œå…¶ä½™ç®—æ³•æ€æƒ³å’Œ $SARSA$ ç±»ä¼¼ã€‚è¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸‹ $SARSA(Î»)$çš„ç®—æ³•æµç¨‹ã€‚ã€€ã€€ã€€</p>
<ul>
<li>ç®—æ³•è¾“å…¥ï¼šè¿­ä»£è½®æ•° $T$ï¼ŒçŠ¶æ€é›† $S$, åŠ¨ä½œé›† $A$, æ­¥é•¿ $Î±$ï¼Œè¡°å‡å› å­ $Î³$, æ¢ç´¢ç‡$Ïµ$, å¤šæ­¥å‚æ•°$Î»$</li>
<li>è¾“å‡ºï¼šæ‰€æœ‰çš„çŠ¶æ€å’ŒåŠ¨ä½œå¯¹åº”çš„ä»·å€¼$Q$</li>
<li>
<ol>
<li>éšæœºåˆå§‹åŒ–æ‰€æœ‰çš„çŠ¶æ€å’ŒåŠ¨ä½œå¯¹åº”çš„ä»·å€¼ $Q$. å¯¹äºç»ˆæ­¢çŠ¶æ€å…¶ $Q$å€¼åˆå§‹åŒ–ä¸º0.</li>
</ol>
</li>
<li>
<ol start="2">
<li>for i from 1 to Tï¼Œè¿›è¡Œè¿­ä»£ã€‚</li>
</ol>
<ul>
<li>a) åˆå§‹åŒ–æ‰€æœ‰çŠ¶æ€åŠ¨ä½œçš„æ•ˆç”¨è¿¹ $E$ ä¸º0ï¼Œåˆå§‹åŒ–Sä¸ºå½“å‰çŠ¶æ€åºåˆ—çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ã€‚è®¾ç½®$A$ä¸º $Ïµâˆ’$è´ªå©ªæ³•åœ¨å½“å‰çŠ¶æ€ $S$é€‰æ‹©çš„åŠ¨ä½œã€‚</li>
<li>b) åœ¨çŠ¶æ€ $S$ æ‰§è¡Œå½“å‰åŠ¨ä½œ $A$,å¾—åˆ°æ–°çŠ¶æ€ $S&rsquo;$ å’Œå¥–åŠ± $R$</li>
<li>c) ç”¨$Ïµâˆ’$è´ªå©ªæ³•åœ¨çŠ¶æ€ $S&rsquo;$ é€‰æ‹©æ–°çš„åŠ¨ä½œ $A'$</li>
<li>d) æ›´æ–°æ•ˆç”¨è¿¹å‡½æ•° $E(S,A)$å’ŒTDè¯¯å·® $Î´$:
<ul>
<li>$$\begin{gathered}E(S,A)=E(S,A)+1\\\\\delta=R_{t+1}+\gamma Q(S_{t+1},A_{t+1})-Q(S_t,A_t)\end{gathered}$$</li>
</ul>
</li>
<li>e) å¯¹å½“å‰åºåˆ—æ‰€æœ‰å‡ºç°çš„çŠ¶æ€så’Œå¯¹åº”åŠ¨ä½œ $a$, æ›´æ–°ä»·å€¼å‡½æ•° $Q(s,a)$å’Œæ•ˆç”¨è¿¹å‡½æ•° $E(s,a)$:
<ul>
<li>$$\begin{gathered}Q(s,a)=Q(s,a)+\alpha\delta E(s,a)\\\\E(s,a)=\gamma\lambda E(s,a)\end{gathered}$$</li>
</ul>
</li>
<li>f) $S=S&rsquo;$, $A=A'$</li>
<li>g) å¦‚æœ $S&rsquo;$æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œå½“å‰è½®è¿­ä»£å®Œæ¯•ï¼Œå¦åˆ™è½¬åˆ°æ­¥éª¤b)</li>
</ul>
</li>
</ul>
<p>å¯¹äºæ­¥é•¿$Î±$ï¼Œå’ŒSARSAä¸€æ ·ï¼Œä¸€èˆ¬ä¹Ÿéœ€è¦éšç€è¿­ä»£çš„è¿›è¡Œé€æ¸å˜å°æ‰èƒ½ä¿è¯åŠ¨ä½œä»·å€¼å‡½æ•°$Q$æ”¶æ•›ã€‚</p>
<h1 id="6-sarsaå°ç»“">6. SARSAå°ç»“</h1>
<p>SARSAç®—æ³•å’ŒåŠ¨æ€è§„åˆ’æ³•æ¯”èµ·æ¥ï¼Œä¸éœ€è¦ç¯å¢ƒçš„çŠ¶æ€è½¬æ¢æ¨¡å‹ï¼Œå’Œè’™ç‰¹å¡ç½—æ³•æ¯”èµ·æ¥ï¼Œä¸éœ€è¦å®Œæ•´çš„çŠ¶æ€åºåˆ—ï¼Œå› æ­¤æ¯”è¾ƒçµæ´»ã€‚åœ¨ä¼ ç»Ÿçš„å¼ºåŒ–å­¦ä¹ æ–¹æ³•ä¸­ä½¿ç”¨æ¯”è¾ƒå¹¿æ³›ã€‚</p>
<p>ä½†æ˜¯SARSAç®—æ³•ä¹Ÿæœ‰ä¸€ä¸ªä¼ ç»Ÿå¼ºåŒ–å­¦ä¹ æ–¹æ³•å…±æœ‰çš„é—®é¢˜ï¼Œå°±æ˜¯æ— æ³•æ±‚è§£å¤ªå¤æ‚çš„é—®é¢˜ã€‚åœ¨ SARSA ç®—æ³•ä¸­ï¼Œ$Q(S,A)$ çš„å€¼ä½¿ç”¨ä¸€å¼ å¤§è¡¨æ¥å­˜å‚¨çš„ï¼Œå¦‚æœæˆ‘ä»¬çš„çŠ¶æ€å’ŒåŠ¨ä½œéƒ½è¾¾åˆ°ç™¾ä¸‡ä¹ƒè‡³åƒä¸‡çº§ï¼Œéœ€è¦åœ¨å†…å­˜é‡Œä¿å­˜çš„è¿™å¼ å¤§è¡¨ä¼šè¶…çº§å¤§ï¼Œç”šè‡³æº¢å‡ºï¼Œå› æ­¤ä¸æ˜¯å¾ˆé€‚åˆè§£å†³è§„æ¨¡å¾ˆå¤§çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œå¯¹äºä¸æ˜¯ç‰¹åˆ«å¤æ‚çš„é—®é¢˜ï¼Œä½¿ç”¨SARSAè¿˜æ˜¯å¾ˆä¸é”™çš„ä¸€ç§å¼ºåŒ–å­¦ä¹ é—®é¢˜æ±‚è§£æ–¹æ³•ã€‚</p>
<p>ä¸‹ä¸€ç¯‡æˆ‘ä»¬è®¨è®ºSARSAçš„å§Šå¦¹ç®—æ³•ï¼Œæ—¶åºå·®åˆ†ç¦»çº¿æ§åˆ¶ç®—æ³•Q-Learningã€‚</p>
]]></description></item></channel></rss>