<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>CMake 笔记 | [11] 检测环境 - yejian's blog</title><meta name=author content="Jian YE">
<meta name=author-link content="https://github.com/jianye0428"><meta name=description content="一、CMake:检测环境 导言 通过前面几篇的学习，我们掌握CMake以及与C++相关的基本知识。尽管CMake跨平台，但有时源代码并不是完全可移植。为了使得我们的源代码能够跨平台、操作系统和编译器，根据平台不同的方式配置和/或构建代码是在构建项目过程中必不可少的环节。 二、检测操作系统 CMake是一组跨"><meta name=keywords content='CMake'><meta itemprop=name content="CMake 笔记 | [11] 检测环境"><meta itemprop=description content="一、CMake:检测环境 导言 通过前面几篇的学习，我们掌握CMake以及与C++相关的基本知识。尽管CMake跨平台，但有时源代码并不是完全可移植。为了使得我们的源代码能够跨平台、操作系统和编译器，根据平台不同的方式配置和/或构建代码是在构建项目过程中必不可少的环节。 二、检测操作系统 CMake是一组跨"><meta itemprop=datePublished content="2024-01-26T09:10:44+08:00"><meta itemprop=dateModified content="2024-01-26T13:16:25+08:00"><meta itemprop=wordCount content="4622"><meta itemprop=image content="https://jianye0428.github.io/images/favicon/jian_icon.png"><meta itemprop=keywords content="CMake"><meta property="og:url" content="https://jianye0428.github.io/posts/cmake_note_11/"><meta property="og:site_name" content="yejian's blog"><meta property="og:title" content="CMake 笔记 | [11] 检测环境"><meta property="og:description" content="一、CMake:检测环境 导言 通过前面几篇的学习，我们掌握CMake以及与C++相关的基本知识。尽管CMake跨平台，但有时源代码并不是完全可移植。为了使得我们的源代码能够跨平台、操作系统和编译器，根据平台不同的方式配置和/或构建代码是在构建项目过程中必不可少的环节。 二、检测操作系统 CMake是一组跨"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-26T09:10:44+08:00"><meta property="article:modified_time" content="2024-01-26T13:16:25+08:00"><meta property="article:tag" content="CMake"><meta property="og:image" content="https://jianye0428.github.io/images/favicon/jian_icon.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jianye0428.github.io/images/favicon/jian_icon.png"><meta name=twitter:title content="CMake 笔记 | [11] 检测环境"><meta name=twitter:description content="一、CMake:检测环境 导言 通过前面几篇的学习，我们掌握CMake以及与C++相关的基本知识。尽管CMake跨平台，但有时源代码并不是完全可移植。为了使得我们的源代码能够跨平台、操作系统和编译器，根据平台不同的方式配置和/或构建代码是在构建项目过程中必不可少的环节。 二、检测操作系统 CMake是一组跨"><meta name=application-name content="菠菜阿九时代峰峻啊；数量可根据；"><meta name=apple-mobile-web-app-title content="菠菜阿九时代峰峻啊；数量可根据；"><meta name=theme-color data-light=#ffffff data-dark=#252627 content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/png href=/jian_icon.png><link rel=icon type=image/png sizes=32x32 href=/jian_icon.png><link rel=icon type=image/png sizes=16x16 href=/jian_icon.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://jianye0428.github.io/posts/cmake_note_11/><link rel=prev href=https://jianye0428.github.io/posts/cmake_note_10/><link rel=next href=https://jianye0428.github.io/posts/cmake_note_12/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"CMake 笔记 | [11] 检测环境","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/jianye0428.github.io\/posts\/cmake_note_11\/"},"image":["https:\/\/jianye0428.github.io\/images\/favicon\/jian_icon.png"],"genre":"posts","keywords":"CMake","wordcount":4622,"url":"https:\/\/jianye0428.github.io\/posts\/cmake_note_11\/","datePublished":"2024-01-26T09:10:44+08:00","dateModified":"2024-01-26T13:16:25+08:00","publisher":{"@type":"Organization","name":"Jian YE","logo":"https:\/\/jianye0428.github.io\/images\/favicon\/jian_icon.png"},"author":{"@type":"Person","name":"Jian YE"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=wide><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="yejian's blog"><img loading=lazy src=/images/favicon/jian_icon.png srcset="/images/favicon/jian_icon.png, /images/favicon/jian_icon.png 1.5x, /images/favicon/jian_icon.png 2x" sizes=auto data-title="yejian's blog" data-alt="yejian's blog" class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Jian's Blog</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 所有文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/guestbook/><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> 留言</a></li><li class="menu-item has-children"><a class=menu-link href=/about/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> 关于</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/projects/_index.zh-tw/ title=項目><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> 我的項目</a></li><li class=menu-item><a class=menu-link href=/projects/ title=项目><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> 我的项目</a></li></ul></li><li class=menu-item><a class=menu-link href=/pilot/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> 导航</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="yejian's blog"><img loading=lazy src=/images/favicon/jian_icon.png srcset="/images/favicon/jian_icon.png, /images/favicon/jian_icon.png 1.5x, /images/favicon/jian_icon.png 2x" sizes=auto data-title=/images/favicon/jian_icon.png data-alt=/images/favicon/jian_icon.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Jian's Blog</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 所有文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/guestbook/><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> 留言</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/about/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> 关于</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/projects/_index.zh-tw/ title=項目><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> 我的項目</a></li><li class=menu-item><a class=menu-link href=/projects/ title=项目><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> 我的项目</a></li></ul></li><li class=menu-item><a class=menu-link href=/pilot/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> 导航</a></li><li class="menu-item text-center"><a class=menu-link href=https://github.com/jianye0428/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class="container container-reverse"><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>CMake 笔记 | [11] 检测环境</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/jianye0428 title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src="https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp" srcset="https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp, https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp 1.5x, https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp 2x" sizes=auto data-title="Jian YE" data-alt="Jian YE" class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;Jian YE</a></span>
<span class=post-category>收录于 <a href=/categories/c++/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> C++</a></span></div><div class=post-meta-line><span title="发布于 2024-01-26 09:10:44"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2024-01-26>2024-01-26</time></span>&nbsp;<span title="更新于 2024-01-26 13:16:25"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2024-01-26>2024-01-26</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 4622 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 10 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="CMake 笔记 | [11] 检测环境">
<i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#一cmake检测环境>一、CMake:检测环境</a></li><li><a href=#二检测操作系统>二、检测操作系统</a></li><li><a href=#三处理与编译器相关的源代码>三、处理与编译器相关的源代码</a></li><li><a href=#四检测与处理器体系结构>四、检测与处理器体系结构</a></li><li><a href=#五附录>五、附录</a></li><li><a href=#六检测处理器指令集>六、检测处理器指令集</a></li></ul></nav></div></div><div class=content id=content data-end-flag=（完）><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>本文最后更新于 2024-01-26，文中内容可能已过时。</div></div></div><h2 id=一cmake检测环境>一、CMake:检测环境</h2><div class="details admonition quote"><div class="details-summary admonition-title"><i class="icon fa-solid fa-quote-right fa-fw" aria-hidden=true></i>导言<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><strong>通过前面几篇的学习，我们掌握<code>CMake</code>以及与<code>C++</code>相关的基本知识。尽管<code>CMake</code>跨平台，但有时源代码并不是完全可移植。为了使得我们的源代码能够跨平台、操作系统和编译器，根据平台不同的方式配置和/或构建代码是在构建项目过程中必不可少的环节。</strong></div></div></div><h2 id=二检测操作系统>二、检测操作系统</h2><p><code>CMake</code>是一组跨平台工具。在实际的开发过程中，我们需要操作系统相关的CMake代码，会根据操作系统启用条件编译，或者在可用或必要时使用特定于编译器的扩展。</p><p>这里举个特定示例说明：</p><p><code>Windows</code>与<code>Unix</code>系统的文件结构有明显的差异，如将深度学习模型集成于<code>C++</code>开发的软件系统中时，我们想要将深度学习模型(*.pth)拷贝到指定的文件中时：</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>MSVC</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>file</span><span class=p>(</span><span class=n>GLOB</span> <span class=n>MODEL</span> <span class=s>&#34;${CMAKE_SOURCE_DIR}/resource/*.pt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>add_custom_command</span><span class=p>(</span><span class=n>TARGET</span> <span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span> <span class=n>POST_BUILD</span>
</span></span><span class=line><span class=cl>                     <span class=n>COMMAND</span> <span class=err>$</span><span class=p>{</span><span class=n>CMAKE_COMMAND</span><span class=p>}</span> <span class=o>-</span><span class=n>E</span> <span class=n>copy_if_different</span>
</span></span><span class=line><span class=cl>                     <span class=err>$</span><span class=p>{</span><span class=n>MODEL</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                     <span class=err>$</span><span class=o>&lt;</span><span class=nl>TARGET_FILE_DIR</span><span class=p>:</span><span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span><span class=o>&gt;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elseif</span><span class=p>(</span><span class=n>UNIX</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>file</span><span class=p>(</span><span class=n>GLOB</span> <span class=n>MODEL</span> <span class=s>&#34;${CMAKE_SOURCE_DIR}/resource/*.pt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>file</span><span class=p>(</span><span class=n>COPY</span> <span class=err>$</span><span class=p>{</span><span class=n>MODEL</span><span class=p>}</span> <span class=n>DESTINATION</span> <span class=err>$</span><span class=p>{</span><span class=n>EXECUTE_FILE</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>endif</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>这段<code>CMake</code>代码用于在构建项目后，根据目标平台的不同（<code>Windows</code>或<code>UNIX/Linux</code>），将模型文件复制到输出目录中，以确保运行程序时所需的模型文件（具有<code>.pt</code>扩展名）与可执行文件位于同一目录下。</p><p>对于<code>MSVC</code>（<code>Microsoft Visual C++</code>编译器，通常用于<code>Windows</code>平台）：</p><ul><li>使用<code>file()</code>命令并设置<code>GLOB</code>选项，在<code>CMake</code>源代码目录（<code>${CMAKE_SOURCE_DIR}</code>）下的<code>resource</code>目录中查找所有<code>.pt</code>模型文件。</li><li>然后使用<code>add_custom_command()</code>命令将自定义的后期构建命令添加到目标``（<code>${PROJECT_NAME}</code>）中。</li><li>自定义命令会将找到的所有<code>.pt</code>模型文件复制到输出目录（<code>$&lt;TARGET_FILE_DIR:${PROJECT_NAME}></code>）。使用<code>copy_if_different</code>参数确保仅在目标文件与源文件不同或目标目录中不存在时才复制文件。</li></ul><p>对于<code>UNIX</code>平台（包括<code>Linux</code>）：</p><ul><li>使用<code>file()</code>命令并设置<code>GLOB</code>选项，在<code>CMake</code>源代码目录（<code>\${CMAKE_SOURCE_DIR}</code>）下的<code>resource</code>目录中查找所有<code>.pt</code>模型文件。</li><li>然后使用<code>file()</code>命令并设置<code>COPY</code>选项，将找到的所有<code>.pt</code>模型文件复制到指定的目标目录（<code>${EXECUTE_FILE}</code>）。</li></ul><p>接下来，我们将通过一个不需要编译任何源代码的示例，演示如何使用<code>CMake</code>检测操作系统。</p><p>项目地址：</p><blockquote><p><a href=https://gitee.com/jiangli01/tutorials/tree/master/cmake-tutorial/chapter2/01 target=_blank rel="external nofollow noopener noreferrer">https://gitee.com/jiangli01/tutorials/tree/master/cmake-tutorial/chapter2/01<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></p></blockquote><p><strong>CMakeLists.txt</strong></p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>cmake_minimum_required</span><span class=p>(</span><span class=n>VERSION</span> <span class=mf>3.10</span> <span class=n>FATAL_ERROR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>project</span><span class=p>(</span><span class=n>os_test</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>CMAKE_SYSTEM_NAME</span> <span class=n>STREQUAL</span> <span class=s>&#34;Linux&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;Configuring on/for Linux&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elseif</span><span class=p>(</span><span class=n>CMAKE_SYSTEM_NAME</span> <span class=n>STREQUAL</span> <span class=s>&#34;Darwin&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;Configuring on/for macOs&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elseif</span><span class=p>(</span><span class=n>CMAKE_SYSTEM_NAME</span> <span class=n>STREQUAL</span> <span class=s>&#34;Windows&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;Configuring on/for Windows&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elseif</span><span class=p>(</span><span class=n>CMAKE_SYSTEM_NAME</span> <span class=n>STREQUAL</span> <span class=s>&#34;AIX&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;Configuring on/for IBM AIX&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;Configuring on/for ${CMAKE_SYSTEM_NAME}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>endif</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p><strong>输出结果</strong></p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>-- The C compiler identification is GNU 9.4.0
</span></span><span class=line><span class=cl>-- The CXX compiler identification is GNU 9.4.0
</span></span><span class=line><span class=cl>-- Check <span class=k>for</span> working C compiler: /usr/bin/cc
</span></span><span class=line><span class=cl>-- Check <span class=k>for</span> working C compiler: /usr/bin/cc -- works
</span></span><span class=line><span class=cl>-- Detecting C compiler ABI info
</span></span><span class=line><span class=cl>-- Detecting C compiler ABI info - <span class=k>done</span>
</span></span><span class=line><span class=cl>-- Detecting C compile features
</span></span><span class=line><span class=cl>-- Detecting C compile features - <span class=k>done</span>
</span></span><span class=line><span class=cl>-- Check <span class=k>for</span> working CXX compiler: /usr/bin/c++
</span></span><span class=line><span class=cl>-- Check <span class=k>for</span> working CXX compiler: /usr/bin/c++ -- works
</span></span><span class=line><span class=cl>-- Detecting CXX compiler ABI info
</span></span><span class=line><span class=cl>-- Detecting CXX compiler ABI info - <span class=k>done</span>
</span></span><span class=line><span class=cl>-- Detecting CXX compile features
</span></span><span class=line><span class=cl>-- Detecting CXX compile features - <span class=k>done</span>
</span></span><span class=line><span class=cl>-- Configuring on/for Linux
</span></span><span class=line><span class=cl>-- Configuring <span class=k>done</span>
</span></span><span class=line><span class=cl>-- Generating <span class=k>done</span>
</span></span><span class=line><span class=cl>-- Build files have been written to: /home/jiangli/repo/tutorials/cmake-tutorial/chapter2/01/build</span></span></code></pre></td></tr></table></div></div><p><code>CMake</code>为目标操作系统定义了<code>CMAKE_SYSTEM_NAME</code>，因此不需要使用定制命令、工具或脚本来查询此信息。然后，可以使用此变量的值实现特定于操作系统的条件和解决方案。</p><ul><li>在<code>macOS</code>上<code>CMAKE_SYSTEM_NAME</code>为<code>Darwin</code>。</li><li>在<code>Linux和Windows</code>上，<code>CMAKE_SYSTEM_NAME</code>分别为<code>Linux</code>和<code>Windows</code>。我们了解了如何在特定的操作系统上执行特定的<code>CMake</code>代码。当然，应该尽量减少这种定制化行为，以便简化迁移到新平台的过程。</li></ul><p>注意：为了最小化从一个平台转移到另一个平台时的成本，应该避免直接使用<code>Shell</code>命令，还应该避免<code>显式的路径分隔符</code>(<code>Linux</code>和<code>macOS</code>上的前斜杠和<code>Windows</code>上的后斜杠)。<code>CMake</code>代码中只使用前斜杠作为路径分隔符，<code>CMake</code>将自动将它们转换为所涉及的操作系统环境。</p><h2 id=三处理与编译器相关的源代码>三、处理与编译器相关的源代码</h2><p>为了可移植性，我们尽量避免去编写新代码，但遇到有依赖的情况我们也要去解决，特别是当使用历史代码或处理编译器依赖工具。</p><p>项目地址：</p><blockquote><p><a href=https://gitee.com/jiangli01/tutorials/tree/master/cmake-tutorial/chapter2/02 target=_blank rel="external nofollow noopener noreferrer">https://gitee.com/jiangli01/tutorials/tree/master/cmake-tutorial/chapter2/02<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></p></blockquote><p><strong>CMakeLists.txt</strong></p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>cmake_minimum_required</span><span class=p>(</span><span class=n>VERSION</span> <span class=mf>3.10</span> <span class=n>FATAL_ERROR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>project</span><span class=p>(</span><span class=n>hello_os</span> <span class=n>LANGUAGES</span> <span class=n>CXX</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add_executable</span><span class=p>(</span><span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span> <span class=n>hello_os</span><span class=p>.</span><span class=n>cpp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>CMAKE_SYSTEM_NAME</span> <span class=n>STREQUAL</span> <span class=s>&#34;Linux&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>target_compile_definitions</span><span class=p>(</span><span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span> <span class=n>PUBLIC</span> <span class=s>&#34;IS_LINUX&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>endif</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>CMAKE_SYSTEM_NAME</span> <span class=n>STREQUAL</span> <span class=s>&#34;Darwin&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>target_compile_definitions</span><span class=p>(</span><span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span> <span class=n>PUBLIC</span> <span class=s>&#34;IS_MACOS&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>endif</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>CMAKE_SYSTEM_NAME</span> <span class=n>STREQUAL</span> <span class=s>&#34;Windows&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>target_compile_definitions</span><span class=p>(</span><span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span> <span class=n>PUBLIC</span> <span class=s>&#34;IS_WINDOWS&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>endif</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>通过<code>target_compile_definitions()</code>命令向目标（<code>hello_os</code>）添加预定义宏<code>IS_LINUX</code>、<code>IS_MACOS</code>或者<code>IS_WINDOWS</code>，该宏在编译过程中将生效。</p><p><code>target_compile_definitions</code>会将将定义限制于一个特定的目标，以及通过<code>PRIVATE</code>|<code>PUBLIC</code>|<code>INTERFACE</code>限定符，限制这些定义可见性:</p><ul><li><code>PRIVATE</code>，编译定义将只应用于给定的目标，而不应用于相关的其他目标。</li><li><code>INTERFACE</code>，对给定目标的编译定义将只应用于使用它的目标。</li><li><code>PUBLIC</code>，编译定义将应用于给定的目标和使用它的所有其他目标。</li></ul><p>当然，在<code>C++</code>中，可以直接使用预定义的宏来识别不同的平台和操作系统。这些预定义的宏是由编译器或操作系统提供的，可以在源代码中使用它们来编写平台相关的代码。以下是一些常用的平台识别宏：</p><ul><li><code>__APPLE__</code>：在苹果（<code>Apple</code>）平台（例如 <code>macOS</code> 和 <code>iOS</code>）上定义。</li><li><code>__linux__</code>：在<code>Linux</code>平台上定义。</li><li><code>_WIN32</code>：在<code>32</code>位<code>Windows</code>操作系统上定义。</li><li><code>_WIN64</code>：在<code>64</code>位<code>Windows</code>操作系统上定义。</li><li><code>_MSC_VER</code>：在使用<code>Microsoft Visual C++</code>编译器时定义，表示编译器的版本号。</li><li><code>__GNUC__</code>：在使用<code>GNU</code>编译器（例如<code>g++</code>）时定义，表示编译器的版本号。</li></ul><p><strong>hello_os.cpp</strong></p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>HelloOS</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>HelloOS</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>HelloOS</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=cp>#ifdef IS_WINDOWS
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=s>&#34;Hello from Windows!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>#elif IS_LINUX
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=s>&#34;Hello from Linux!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>#elif IS_MACOS
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=s>&#34;Hello from macOS!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>#else
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=s>&#34;Hello from an unknown system!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><code>Windows</code>系统上，将看到来自<code>Windows</code>的<code>Hello</code>。其他操作系统将产生不同的输出。</p><h2 id=四检测与处理器体系结构>四、检测与处理器体系结构</h2><p>19世纪70年代，出现的<code>64位</code>整数运算和本世纪初出现的用于个人计算机的<code>64位寻址</code>，扩大了内存寻址范围，开发商投入了大量资源来移植为<code>32位</code>体系结构硬编码，以支持<code>64位寻址</code>。虽然，避免显式硬编码的方式非常明智，但需要在使用<code>CMake</code>配置的代码中适应硬编码限制。
项目地址：</p><blockquote><p><a href=https://gitee.com/jiangli01/tutorials/tree/master/cmake-tutorial/chapter2/03 target=_blank rel="external nofollow noopener noreferrer">https://gitee.com/jiangli01/tutorials/tree/master/cmake-tutorial/chapter2/03<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></p></blockquote><p><strong>CMakeLists.txt</strong></p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>cmake_minimum_required</span><span class=p>(</span><span class=n>VERSION</span> <span class=mf>3.10</span> <span class=n>FATAL_ERROR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>project</span><span class=p>(</span><span class=n>arch_dependent</span> <span class=n>LANGUAGES</span> <span class=n>CXX</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add_executable</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=err>$</span><span class=p>{</span><span class=n>CMAKE_SOURCE_DIR</span><span class=p>}</span><span class=o>/</span><span class=n>arch_dependent</span><span class=p>.</span><span class=n>cpp</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp># 检查空指针类型的大小
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>if</span><span class=p>(</span><span class=n>CMAKE_SIZEOF_VOID_P</span> <span class=n>EQUAL</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>target_compile_definitions</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>PUBLIC</span> <span class=s>&#34;IS_64_BIT_ARCH&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;Target is 64 bits&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>target_compile_definitions</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>PUBLIC</span> <span class=s>&#34;IS_32_BIT_ARCH&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;Target is 32 bits&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>endif</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp># 通过定义目标编译定义，让预处理器了解主机处理器架构
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>if</span><span class=p>(</span><span class=n>CMAKE_HOST_SYSTEM_PROCESSOR</span> <span class=n>MATCHES</span> <span class=s>&#34;i386&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;i386 architecture detected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elseif</span><span class=p>(</span><span class=n>CMAKE_HOST_SYSTEM_PROCESSOR</span> <span class=n>MATCHES</span> <span class=s>&#34;i686&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;i686 architecture detected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elseif</span><span class=p>(</span><span class=n>CMAKE_HOST_SYSTEM_PROCESSOR</span> <span class=n>MATCHES</span> <span class=s>&#34;x86_64&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;x86_64 architecture detected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;host processor architecture is unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>endif</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>target_compile_definitions</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>PUBLIC</span> <span class=s>&#34;ARCHITECTURE=${CMAKE_HOST_SYSTEM_PROCESSOR}&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p><code>CMake</code>定义了<code>CMAKE_HOST_SYSTEM_PROCESSOR</code>变量，以包含当前运行的处理器的名称。可以设置为<code>i386</code>、<code>i686</code>、<code>x86_64</code>、<code>AMD64</code>等等，当然，这取决于当前的<code>CPU</code>。</p><p><code>CMAKE_SIZEOF_VOID_P</code>为<code>void指针</code>的大小。可以在<code>CMake</code>配置时进行查询，以便修改目标或目标编译定义。可以基于检测到的主机处理器体系结构，使用预处理器定义，确定需要编译的分支源代码。</p><p>当然，编写新代码时应该避免这种依赖，但在处理遗留代码或交叉编译时，这种依赖是有用的。</p><p>注意：使用<code>CMAKE_SIZEOF_VOID_P</code>是检查当前<code>CPU</code>是否具有<code>32位</code>或<code>64位</code>架构的唯一“真正”可移植的方法。</p><p><strong>arch_dependent.cpp</strong></p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstdlib&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define STRINGIFY(x) #x
</span></span></span><span class=line><span class=cl><span class=cp>#define TOSTRING(x) STRINGIFY(x)
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>ArchInfo</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>ArchInfo</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>ArchInfo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>arch_info</span><span class=p>(</span><span class=n>TOSTRING</span><span class=p>(</span><span class=n>ARCHITECTURE</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>arch_info</span> <span class=o>+=</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=s>&#34; architecture.  &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>#ifdef IS_32_BIT_ARCH
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=k>return</span> <span class=n>arch_info</span> <span class=o>+</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=s>&#34;Compiled on a 32 bit host processor.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>#elif IS_64_BIT_ARCH
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=k>return</span> <span class=n>arch_info</span> <span class=o>+</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=s>&#34;Compiled on a 64 bit host processor.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>#else
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=k>return</span> <span class=n>arch_info</span> <span class=o>+</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=s>&#34;Neither 32 not 64 bit, puzzling ...&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><strong>输出结果</strong></p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir build
</span></span><span class=line><span class=cl><span class=nb>cd</span> build
</span></span><span class=line><span class=cl>cmake ..
</span></span><span class=line><span class=cl>-- The CXX compiler identification is GNU 9.4.0
</span></span><span class=line><span class=cl>-- Check <span class=k>for</span> working CXX compiler: /usr/bin/c++
</span></span><span class=line><span class=cl>-- Check <span class=k>for</span> working CXX compiler: /usr/bin/c++ -- works
</span></span><span class=line><span class=cl>-- Detecting CXX compiler ABI info
</span></span><span class=line><span class=cl>-- Detecting CXX compiler ABI info - <span class=k>done</span>
</span></span><span class=line><span class=cl>-- Detecting CXX compile features
</span></span><span class=line><span class=cl>-- Detecting CXX compile features - <span class=k>done</span>
</span></span><span class=line><span class=cl>-- Target is <span class=m>64</span> bits
</span></span><span class=line><span class=cl>-- x86_64 architecture detected
</span></span><span class=line><span class=cl>-- Configuring <span class=k>done</span>
</span></span><span class=line><span class=cl>-- Generating <span class=k>done</span>
</span></span><span class=line><span class=cl>-- Build files have been written to: /home/jiangli/repo/tutorials/cmake-tutorial/chapter2/03/build
</span></span><span class=line><span class=cl>make
</span></span><span class=line><span class=cl>Scanning dependencies of target arch_dependent
</span></span><span class=line><span class=cl><span class=o>[</span> 50%<span class=o>]</span> Building CXX object CMakeFiles/arch_dependent.dir/arch_dependent.cpp.o
</span></span><span class=line><span class=cl><span class=o>[</span>100%<span class=o>]</span> Linking CXX executable arch_dependent
</span></span><span class=line><span class=cl><span class=o>[</span>100%<span class=o>]</span> Built target arch_dependent
</span></span><span class=line><span class=cl>./arch_dependent
</span></span><span class=line><span class=cl>x86_64 architecture.  Compiled on a <span class=m>64</span> bit host processor.</span></span></code></pre></td></tr></table></div></div><h2 id=五附录>五、附录</h2><p>除了<code>CMAKE_HOST_SYSTEM_PROCESSOR</code>, <code>CMake</code>还定义了<code>CMAKE_SYSTEM_PROCESSOR</code>变量。前者包含当前运行的<code>CPU</code>在<code>CMake</code>的名称，而后者将包含当前正在为其构建的CPU的名称。这是一个细微的差别，在交叉编译时起着非常重要的作用。</p><p>另一种让<code>CMake</code>检测主机处理器体系结构，是使用<code>C</code>或<code>C++</code>中定义的符号，结合<code>CMake</code>的<code>try_run</code>函数:</p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#if defined(__i386) || defined(__i386__) || defined(_M_IX86)
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#error cmake_arch i386
</span></span></span><span class=line><span class=cl><span class=cp>#elif defined(__x86_64) || defined(__x86_64__) || defined(__amd64) || defined(_M_X64)
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#error cmake_arch x86_64
</span></span></span><span class=line><span class=cl><span class=cp>#endif</span></span></span></code></pre></td></tr></table></div></div><p>这种策略也是检测目标处理器体系结构的推荐策略，因为<code>CMake</code>似乎没有提供可移植的内在解决方案。</p><p>另一种选择，将只使用<code>CMake</code>，完全不使用预处理器，代价是为每种情况设置不同的源文件，然后使用<code>target_source</code>命令将其设置为可执行目标<code>arch_dependent</code>依赖的源文件:</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>add_executable</span><span class=p>(</span><span class=n>arch</span><span class=o>-</span><span class=n>dependent</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>CMAKE_HOST_SYSTEM_PROCESSOR</span> <span class=n>MATCHES</span> <span class=s>&#34;i386&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;i386 architecture detected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>target_sources</span><span class=p>(</span><span class=n>arch_dependent</span>
</span></span><span class=line><span class=cl>        <span class=n>PRIVATE</span>
</span></span><span class=line><span class=cl>        <span class=n>arch_dependent_i386</span><span class=p>.</span><span class=n>cpp</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elseif</span><span class=p>(</span><span class=n>CMAKE_HOST_SYSTEM_PROCESSOR</span> <span class=n>MATCHES</span> <span class=s>&#34;i686&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;i686 architecture detected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>target_sources</span><span class=p>(</span><span class=n>arch_dependent</span>
</span></span><span class=line><span class=cl>        <span class=n>PRIVATE</span>
</span></span><span class=line><span class=cl>            <span class=n>arch_dependent_i686</span><span class=p>.</span><span class=n>cpp</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elseif</span><span class=p>(</span><span class=n>CMAKE_HOST_SYSTEM_PROCESSOR</span> <span class=n>MATCHES</span> <span class=s>&#34;x86_64&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;x86_64 architecture detected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>target_sources</span><span class=p>(</span><span class=n>arch_dependent</span>
</span></span><span class=line><span class=cl>        <span class=n>PRIVATE</span>
</span></span><span class=line><span class=cl>            <span class=n>arch_dependent_x86_64</span><span class=p>.</span><span class=n>cpp</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>(</span><span class=n>STATUS</span> <span class=s>&#34;host processor architecture is unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>endif</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>这种方法，显然需要对现有项目进行更多的工作，因为源文件需要分离。此外，不同源文件之间的代码复制肯定也会成为问题。</p><h2 id=六检测处理器指令集>六、检测处理器指令集</h2><p><code>CMake</code>可以检测主机处理器支持的指令集。这个功能是较新版本添加到<code>CMake</code>中的，需要<code>CMake 3.10</code>或更高版本。检测到的主机系统信息，可用于设置相应的编译器标志，或实现可选的源代码编译，或根据主机系统生成源代码。</p><p>将使用<code>config.h.in</code>生成<code>config.h</code>文件。config.h.in如下:</p><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#ifndef CONFIG_HEADER_IN_H
</span></span></span><span class=line><span class=cl><span class=cp>#define CONFIG_HEADER_IN_H
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define NUMBER_OF_LOGICAL_CORES @_NUMBER_OF_LOGICAL_CORES@
</span></span></span><span class=line><span class=cl><span class=cp>#define NUMBER_OF_PHYSICAL_CORES @_NUMBER_OF_PHYSICAL_CORES@
</span></span></span><span class=line><span class=cl><span class=cp>#define TOTAL_VIRTUAL_MEMORY @_TOTAL_VIRTUAL_MEMORY@
</span></span></span><span class=line><span class=cl><span class=cp>#define AVAILABLE_VIRTUAL_MEMORY @_AVAILABLE_VIRTUAL_MEMORY@
</span></span></span><span class=line><span class=cl><span class=cp>#define TOTAL_PHYSICAL_MEMORY @_TOTAL_PHYSICAL_MEMORY@
</span></span></span><span class=line><span class=cl><span class=cp>#define AVAILABLE_PHYSICAL_MEMORY @_AVAILABLE_PHYSICAL_MEMORY@
</span></span></span><span class=line><span class=cl><span class=cp>#define IS_64BIT @_IS_64BIT@
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_FPU @_HAS_FPU@
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_MMX @_HAS_MMX@
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_MMX_PLUS @_HAS_MMX_PLUS@
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_SSE @_HAS_SSE@
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_SSE2 @_HAS_SSE2@
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_SSE_FP @_HAS_SSE_FP@
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_SSE_MMX @_HAS_SSE_MMX@
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_AMD_3DNOW @_HAS_AMD_3DNOW@
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_AMD_3DNOW_PLUS @_HAS_AMD_3DNOW_PLUS@
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_IA64 @_HAS_IA64@
</span></span></span><span class=line><span class=cl><span class=cp>#define OS_NAME &#34;@_OS_NAME@&#34;
</span></span></span><span class=line><span class=cl><span class=cp>#define OS_RELEASE &#34;@_OS_RELEASE@&#34;
</span></span></span><span class=line><span class=cl><span class=cp>#define OS_VERSION &#34;@_OS_VERSION@&#34;
</span></span></span><span class=line><span class=cl><span class=cp>#define OS_PLATFORM &#34;@_OS_PLATFORM@&#34;
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=c1>// ! CONFIG_HEADER_IN_H
</span></span></span></code></pre></td></tr></table></div></div><p><strong>CMakeLists.txt</strong></p><div class=highlight id=id-12><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>cmake_minimum_required</span><span class=p>(</span><span class=n>VERSION</span> <span class=mf>3.10</span> <span class=n>FATAL_ERROR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>project</span><span class=p>(</span><span class=n>progressor_info</span> <span class=n>LANGUAGES</span> <span class=n>CXX</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add_executable</span><span class=p>(</span><span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>target_sources</span><span class=p>(</span><span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>PRIVATE</span> <span class=err>$</span><span class=p>{</span><span class=n>CMAKE_SOURCE_DIR</span><span class=p>}</span><span class=o>/</span><span class=n>processor_info</span><span class=p>.</span><span class=n>cpp</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>target_include_directories</span><span class=p>(</span><span class=err>$</span><span class=p>{</span><span class=n>PROJECT_NAME</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>PRIVATE</span> <span class=err>$</span><span class=p>{</span><span class=n>PROJECT_BINARY_DIR</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>foreach</span><span class=p>(</span><span class=n>key</span>
</span></span><span class=line><span class=cl>  <span class=n>IN</span> <span class=n>ITEMS</span>
</span></span><span class=line><span class=cl>    <span class=n>NUMBER_OF_LOGICAL_CORES</span>
</span></span><span class=line><span class=cl>    <span class=n>NUMBER_OF_PHYSICAL_CORES</span>
</span></span><span class=line><span class=cl>    <span class=n>TOTAL_VIRTUAL_MEMORY</span>
</span></span><span class=line><span class=cl>    <span class=n>AVAILABLE_VIRTUAL_MEMORY</span>
</span></span><span class=line><span class=cl>    <span class=n>TOTAL_PHYSICAL_MEMORY</span>
</span></span><span class=line><span class=cl>    <span class=n>AVAILABLE_PHYSICAL_MEMORY</span>
</span></span><span class=line><span class=cl>    <span class=n>IS_64BIT</span>
</span></span><span class=line><span class=cl>    <span class=n>HAS_FPU</span>
</span></span><span class=line><span class=cl>    <span class=n>HAS_MMX</span>
</span></span><span class=line><span class=cl>    <span class=n>HAS_MMX_PLUS</span>
</span></span><span class=line><span class=cl>    <span class=n>HAS_SSE</span>
</span></span><span class=line><span class=cl>    <span class=n>HAS_SSE2</span>
</span></span><span class=line><span class=cl>    <span class=n>HAS_SSE_FP</span>
</span></span><span class=line><span class=cl>    <span class=n>HAS_SSE_MMX</span>
</span></span><span class=line><span class=cl>    <span class=n>HAS_AMD_3DNOW</span>
</span></span><span class=line><span class=cl>    <span class=n>HAS_AMD_3DNOW_PLUS</span>
</span></span><span class=line><span class=cl>    <span class=n>HAS_IA64</span>
</span></span><span class=line><span class=cl>    <span class=n>OS_NAME</span>
</span></span><span class=line><span class=cl>    <span class=n>OS_RELEASE</span>
</span></span><span class=line><span class=cl>    <span class=n>OS_VERSION</span>
</span></span><span class=line><span class=cl>    <span class=n>OS_PLATFORM</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>cmake_host_system_information</span><span class=p>(</span><span class=n>RESULT</span> <span class=n>_</span><span class=err>$</span><span class=p>{</span><span class=n>key</span><span class=p>}</span> <span class=n>QUERY</span> <span class=err>$</span><span class=p>{</span><span class=n>key</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>endforeach</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>configure_file</span><span class=p>(</span><span class=n>config</span><span class=p>.</span><span class=n>h</span><span class=p>.</span><span class=n>in</span> <span class=n>config</span><span class=p>.</span><span class=n>h</span> <span class=err>@</span><span class=n>ONLY</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p><code>foreach</code>循环会查询多个键值，并定义相应的变量。<code>cmake_host_system_information</code>查询运行<code>CMake</code>的主机系统的系统信息。本例中，对每个键使用了一个函数调用。然后，使用这些变量来配置<code>config.h.in</code>中的占位符，输入并生成<code>config.h</code>。</p><p>此配置使用<code>configure_file</code>命令完成。最后，<code>config.h</code>包含在<code>processor_info.cpp</code>中。编译后，它将把值打印到屏幕上。</p><div class=highlight id=id-13><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>target_include_directories(${PROJECT_NAME}
</span></span><span class=line><span class=cl>  PRIVATE ${PROJECT_BINARY_DIR}
</span></span><span class=line><span class=cl>)</span></span></code></pre></td></tr></table></div></div><p>这将生成的可执行文件链接到可执行文件所在的文件夹中。</p><p>我们编译后，<code>config.h</code>将于<code>build</code>中生成，在本机中生成的内容如下：</p><div class=highlight id=id-14><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#ifndef CONFIG_HEADER_IN_H
</span></span></span><span class=line><span class=cl><span class=cp>#define CONFIG_HEADER_IN_H
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define NUMBER_OF_LOGICAL_CORES 16
</span></span></span><span class=line><span class=cl><span class=cp>#define NUMBER_OF_PHYSICAL_CORES 16
</span></span></span><span class=line><span class=cl><span class=cp>#define TOTAL_VIRTUAL_MEMORY 2047
</span></span></span><span class=line><span class=cl><span class=cp>#define AVAILABLE_VIRTUAL_MEMORY 2047
</span></span></span><span class=line><span class=cl><span class=cp>#define TOTAL_PHYSICAL_MEMORY 7903
</span></span></span><span class=line><span class=cl><span class=cp>#define AVAILABLE_PHYSICAL_MEMORY 6007
</span></span></span><span class=line><span class=cl><span class=cp>#define IS_64BIT 1
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_FPU 1
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_MMX 1
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_MMX_PLUS 0
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_SSE 1
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_SSE2 1
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_SSE_FP 0
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_SSE_MMX 0
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_AMD_3DNOW 0
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_AMD_3DNOW_PLUS 0
</span></span></span><span class=line><span class=cl><span class=cp>#define HAS_IA64 0
</span></span></span><span class=line><span class=cl><span class=cp>#define OS_NAME &#34;Linux&#34;
</span></span></span><span class=line><span class=cl><span class=cp>#define OS_RELEASE &#34;5.15.0-78-generic&#34;
</span></span></span><span class=line><span class=cl><span class=cp>#define OS_VERSION &#34;#85~20.04.1-Ubuntu SMP Mon Jul 17 09:42:39 UTC 2023&#34;
</span></span></span><span class=line><span class=cl><span class=cp>#define OS_PLATFORM &#34;x86_64&#34;
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=c1>// ! CONFIG_HEADER_IN_H
</span></span></span></code></pre></td></tr></table></div></div><p><strong>processor_info.cpp</strong></p><div class=highlight id=id-15><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstdlib&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;config.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Number of logical cores: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>NUMBER_OF_LOGICAL_CORES</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Number of physical cores: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>NUMBER_OF_PHYSICAL_CORES</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Total virtual memory in megabytes: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>TOTAL_VIRTUAL_MEMORY</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Available virtual memory in megabytes: &#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>AVAILABLE_VIRTUAL_MEMORY</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Total physical memory in megabytes: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>TOTAL_PHYSICAL_MEMORY</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Available physical memory in megabytes: &#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>AVAILABLE_PHYSICAL_MEMORY</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Processor is 64Bit: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>IS_64BIT</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Processor has floating point unit: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>HAS_FPU</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Processor supports MMX instructions: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>HAS_MMX</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Processor supports Ext. MMX instructions: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>HAS_MMX_PLUS</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Processor supports SSE instructions: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>HAS_SSE</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Processor supports SSE2 instructions: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>HAS_SSE2</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Processor supports SSE FP instructions: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>HAS_SSE_FP</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Processor supports SSE MMX instructions: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>HAS_SSE_MMX</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Processor supports 3DNow instructions: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>HAS_AMD_3DNOW</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Processor supports 3DNow+ instructions: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>HAS_AMD_3DNOW_PLUS</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;IA64 processor emulating x86 : &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>HAS_IA64</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;OS name: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>OS_NAME</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;OS sub-type: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>OS_RELEASE</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;OS build ID: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>OS_VERSION</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;OS platform: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>OS_PLATFORM</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><div class=post-reward><div class=comment>Buy me a coffee~</div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward>赞赏</label><div class=reward-ways data-mode=fixed><div><img loading=lazy src=/images/alipay.png srcset="/images/alipay.png, /images/alipay.png 1.5x, /images/alipay.png 2x" sizes=auto data-title="Jian YE 支付宝" data-alt="Jian YE 支付宝" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span data-animation>支付宝</span></div><div><img loading=lazy src=/images/wechatpay.png srcset="/images/wechatpay.png, /images/wechatpay.png 1.5x, /images/wechatpay.png 2x" sizes=auto data-title="Jian YE 微信" data-alt="Jian YE 微信" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span data-animation>微信</span></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2024-01-26 13:16:25">更新于 2024-01-26&nbsp;<a class=git-hash href=https://github.com/jianye0428/JianBlog/commit/2b70465ff0b723f811ccfaf9519d4dc4338ce33c rel="external nofollow noopener noreferrer" target=_blank title="commit by yejian(18817571704@163.com) 2b70465ff0b723f811ccfaf9519d4dc4338ce33c: bug: update cmake note 11 file"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>2b70465</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/cmake_note_11/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span><span><a href=https://github.com/jianye0428/JianBlog/edit/docs/content/posts/C++/CMAKE/Cmake_Learning_Notes/Cmake_Note_11/index.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://jianye0428.github.io/posts/cmake_note_11/ data-title="CMake 笔记 | [11] 检测环境" data-hashtags=CMake><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://jianye0428.github.io/posts/cmake_note_11/ data-hashtag=CMake><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Linkedin" data-sharer=linkedin data-url=https://jianye0428.github.io/posts/cmake_note_11/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://jianye0428.github.io/posts/cmake_note_11/ data-title="CMake 笔记 | [11] 检测环境"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 百度" data-sharer=baidu data-url=https://jianye0428.github.io/posts/cmake_note_11/ data-title="CMake 笔记 | [11] 检测环境"><i data-svg-src=/lib/simple-icons/icons/baidu.min.svg aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/cmake/ class=post-tag>CMake</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/cmake_note_10/ class=post-nav-item rel=prev title="CMake 笔记 | [10] 使用控制流"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>CMake 笔记 | [10] 使用控制流</a>
<a href=/posts/cmake_note_12/ class=post-nav-item rel=next title="CMake 笔记 | [12] 检测环境">CMake 笔记 | [12] 检测环境<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.126.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2018 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/jianye0428 target=_blank rel="external nofollow noopener noreferrer">Jian YE</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics order-first"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="ms-1 d-none">博客已运行</span><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div></div><a href=https://github.com/jianye0428/JianBlog title="在 GitHub 上查看程式碼，訂閱請點 Watch" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#000;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=/lib/cell-watermark/watermark.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:50},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{algoliaAppID:"MTJNHU0JVB",algoliaIndex:"index",algoliaSearchKey:"5486225134d99f43826da401ee9bad57",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},siteTime:"2018-05-28T20:01:01+08:00",twemoji:!0,watermark:{appendto:".wrapper>main",colspacing:30,content:'<img style="height: 0.85rem;" src="/images/favicon/jian_icon.png" alt="logo" /> jianye',enable:!0,fontfamily:"MMT_LRH,沐目体",fontsize:1.1,height:20,opacity:.0125,rotate:15,rowspacing:60,width:150}}</script><script src=/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script></body></html>