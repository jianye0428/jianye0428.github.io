<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [4] - yejian's blog</title><meta name=author content="Jian YE">
<meta name=author-link content="https://github.com/jianye0428"><meta name=description content><meta name=keywords content='Effective'><meta itemprop=name content="Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [4]"><meta itemprop=datePublished content="2023-07-31T07:26:06+08:00"><meta itemprop=dateModified content="2023-10-07T09:25:23+08:00"><meta itemprop=wordCount content="10032"><meta itemprop=image content="https://jianye0428.github.io/images/favicon/jian_icon.png"><meta itemprop=keywords content="Effective"><meta property="og:url" content="https://jianye0428.github.io/posts/effective_cpp_part_four/"><meta property="og:site_name" content="yejian's blog"><meta property="og:title" content="Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [4]"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-31T07:26:06+08:00"><meta property="article:modified_time" content="2023-10-07T09:25:23+08:00"><meta property="article:tag" content="Effective"><meta property="og:image" content="https://jianye0428.github.io/images/favicon/jian_icon.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jianye0428.github.io/images/favicon/jian_icon.png"><meta name=twitter:title content="Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [4]"><meta name=application-name content="è èœé˜¿ä¹æ—¶ä»£å³°å³»å•Šï¼›æ•°é‡å¯æ ¹æ®ï¼›"><meta name=apple-mobile-web-app-title content="è èœé˜¿ä¹æ—¶ä»£å³°å³»å•Šï¼›æ•°é‡å¯æ ¹æ®ï¼›"><meta name=theme-color data-light=#ffffff data-dark=#252627 content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/png href=/jian_icon.png><link rel=icon type=image/png sizes=32x32 href=/jian_icon.png><link rel=icon type=image/png sizes=16x16 href=/jian_icon.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://jianye0428.github.io/posts/effective_cpp_part_four/><link rel=prev href=https://jianye0428.github.io/posts/effective_cpp_part_three/><link rel=next href=https://jianye0428.github.io/posts/ddpm/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [4]","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/jianye0428.github.io\/posts\/effective_cpp_part_four\/"},"image":["https:\/\/jianye0428.github.io\/images\/favicon\/jian_icon.png"],"genre":"posts","keywords":"Effective","wordcount":10032,"url":"https:\/\/jianye0428.github.io\/posts\/effective_cpp_part_four\/","datePublished":"2023-07-31T07:26:06+08:00","dateModified":"2023-10-07T09:25:23+08:00","publisher":{"@type":"Organization","name":"Jian YE","logo":"https:\/\/jianye0428.github.io\/images\/favicon\/jian_icon.png"},"author":{"@type":"Person","name":"Jian YE"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="yejian's blog"><img loading=lazy src=/images/favicon/jian_icon.png srcset="/images/favicon/jian_icon.png, /images/favicon/jian_icon.png 1.5x, /images/favicon/jian_icon.png 2x" sizes=auto data-title="yejian's blog" data-alt="yejian's blog" class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Jian's Blog</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> æ‰€æœ‰æ–‡ç« </a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> åˆ†ç±»</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> æ ‡ç­¾</a></li><li class=menu-item><a class=menu-link href=/friends/ title=å‹æƒ…é“¾æ¥><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> å‹é“¾</a></li><li class=menu-item><a class=menu-link href=/guestbook/><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> ç•™è¨€</a></li><li class="menu-item has-children"><a class=menu-link href=/about/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> å…³äº</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/projects/_index.zh-tw/ title=é …ç›®><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> æˆ‘çš„é …ç›®</a></li><li class=menu-item><a class=menu-link href=/projects/ title=é¡¹ç›®><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> æˆ‘çš„é¡¹ç›®</a></li></ul></li><li class=menu-item><a class=menu-link href=/pilot/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> å¯¼èˆª</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹â€¦â€¦ id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=æœç´¢><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=æ¸…ç©º><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=åˆ‡æ¢ä¸»é¢˜><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="yejian's blog"><img loading=lazy src=/images/favicon/jian_icon.png srcset="/images/favicon/jian_icon.png, /images/favicon/jian_icon.png 1.5x, /images/favicon/jian_icon.png 2x" sizes=auto data-title=/images/favicon/jian_icon.png data-alt=/images/favicon/jian_icon.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Jian's Blog</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹â€¦â€¦ id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=æœç´¢><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=æ¸…ç©º><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>å–æ¶ˆ</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> æ‰€æœ‰æ–‡ç« </a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> åˆ†ç±»</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> æ ‡ç­¾</a></li><li class=menu-item><a class=menu-link href=/friends/ title=å‹æƒ…é“¾æ¥><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> å‹é“¾</a></li><li class=menu-item><a class=menu-link href=/guestbook/><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> ç•™è¨€</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/about/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> å…³äº</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/projects/_index.zh-tw/ title=é …ç›®><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> æˆ‘çš„é …ç›®</a></li><li class=menu-item><a class=menu-link href=/projects/ title=é¡¹ç›®><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> æˆ‘çš„é¡¹ç›®</a></li></ul></li><li class=menu-item><a class=menu-link href=/pilot/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> å¯¼èˆª</a></li><li class="menu-item text-center"><a class=menu-link href=https://github.com/jianye0428/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=åˆ‡æ¢ä¸»é¢˜><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class="container container-reverse"><aside class=toc id=toc-auto><h2 class=toc-title>ç›®å½•&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [4]</span></h1><p class="single-subtitle animate__animated animate__fadeIn">æ”¹å–„ç¨‹åºä¸è®¾è®¡çš„55ä¸ªå…·ä½“åšæ³•(Rule41-55)</p></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/jianye0428 title=ä½œè€… target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src="https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp" srcset="https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp, https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp 1.5x, https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp 2x" sizes=auto data-title="Jian YE" data-alt="Jian YE" class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;Jian YE</a></span>
<span class=post-category>æ”¶å½•äº <a href=/categories/c++/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> C++</a></span></div><div class=post-meta-line><span title="å‘å¸ƒäº 2023-07-31 07:26:06"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2023-07-31>2023-07-31</time></span>&nbsp;<span title="æ›´æ–°äº 2023-10-07 09:25:23"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2023-10-07>2023-10-07</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>çº¦ 10032 å­—</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>é¢„è®¡é˜…è¯» 21 åˆ†é’Ÿ</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [4]">
<i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;æ¬¡é˜…è¯»
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>ç›®å½•</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#ch7-æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹>CH7 æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹</a><ul><li><a href=#r41-äº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€>R41 äº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€</a></li><li><a href=#r42-äº†è§£typenameçš„åŒé‡æ„ä¹‰>R42 äº†è§£typenameçš„åŒé‡æ„ä¹‰</a></li><li><a href=#r43-å­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°>R43 å­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°</a></li><li><a href=#r44-å°†ä¸å‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates>R44 å°†ä¸å‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates</a></li><li><a href=#r45-è¿ç”¨æ¨¡æ¿æˆå‘˜å‡½æ•°æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹>R45 è¿ç”¨æ¨¡æ¿æˆå‘˜å‡½æ•°æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹</a></li><li><a href=#r46-éœ€è¦ç±»å‹è½¬æ¢æ—¶è¯·ä¸ºæ¨¡æ¿å®šä¹‰éæˆå‘˜å‡½æ•°>R46 éœ€è¦ç±»å‹è½¬æ¢æ—¶è¯·ä¸ºæ¨¡æ¿å®šä¹‰éæˆå‘˜å‡½æ•°</a></li><li><a href=#r47-è¯·ä½¿ç”¨traits-classesè¡¨ç°ç±»å‹ä¿¡æ¯>R47 è¯·ä½¿ç”¨traits classesè¡¨ç°ç±»å‹ä¿¡æ¯</a></li><li><a href=#r48-è®¤è¯†templateæ¨¡æ¿å…ƒç¼–ç¨‹>R48 è®¤è¯†Templateæ¨¡æ¿å…ƒç¼–ç¨‹</a></li></ul></li><li><a href=#ch8-å®šåˆ¶newå’Œdelete>CH8 å®šåˆ¶newå’Œdelete</a><ul><li><a href=#r49-äº†è§£new-handlerçš„è¡Œä¸º>R49 äº†è§£new-handlerçš„è¡Œä¸º</a></li><li><a href=#r50-äº†è§£newå’Œdeleteçš„åˆç†æ›¿æ¢æ—¶æœº>R50 äº†è§£newå’Œdeleteçš„åˆç†æ›¿æ¢æ—¶æœº</a></li><li><a href=#r51-ç¼–å†™newå’Œdeleteæ—¶éœ€å›ºå®ˆå¸¸è§„>R51 ç¼–å†™newå’Œdeleteæ—¶éœ€å›ºå®ˆå¸¸è§„</a></li><li><a href=#r52-å†™äº†placement-new-ä¹Ÿè¦å†™placement-delete>R52 å†™äº†placement-new ä¹Ÿè¦å†™placement-delete</a></li></ul></li><li><a href=#ch9-æ‚é¡¹è®¨è®º>CH9 æ‚é¡¹è®¨è®º</a><ul><li><a href=#r53-ä¸è¦è½»æ˜“å¿½ç•¥ç¼–è¯‘å™¨çš„è­¦å‘Š>R53 ä¸è¦è½»æ˜“å¿½ç•¥ç¼–è¯‘å™¨çš„è­¦å‘Š</a></li><li><a href=#r54-ç†Ÿæ‚‰åŒ…æ‹¬tr1åœ¨å†…çš„æ ‡å‡†ç¨‹åºåº“>R54 ç†Ÿæ‚‰åŒ…æ‹¬TR1åœ¨å†…çš„æ ‡å‡†ç¨‹åºåº“</a></li><li><a href=#r55-è®©è‡ªå·±ç†Ÿæ‚‰boost>R55 è®©è‡ªå·±ç†Ÿæ‚‰Boost</a></li></ul></li></ul></nav></div></div><div class=content id=content data-end-flag=ï¼ˆå®Œï¼‰><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-exclamation-triangle fa-fw" aria-hidden=true></i>è­¦å‘Š<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>æœ¬æ–‡æœ€åæ›´æ–°äº 2023-10-07ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ã€‚</div></div></div><h1 id=å‰è¨€>å‰è¨€</h1><blockquote><p>Effective-C++æ€»ç»“ç³»åˆ—åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬äºŒéƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬3~4ç« ï¼Œå†…å®¹èŒƒå›´Rule13~25ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule13ç®€å†™ä¸ºR13ã€‚</p></blockquote><div class="details admonition Note"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>Effective-C++ç³»åˆ—List<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>ğŸ’¡ <a href=https://jianye0428.github.io/posts/partone/ target=_blank rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></br>ğŸ’¡ <a href=https://jianye0428.github.io/posts/parttwo/ target=_blank rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></br>ğŸ’¡ <a href=https://jianye0428.github.io/posts/partthree/ target=_blank rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></br>ğŸ’¡ <a href=https://jianye0428.github.io/posts/partfour/ target=_blank rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></br></div></div></div><p>ç”±äºåŸä¹¦åœ¨C++11ä¹‹å‰å†™æˆï¼Œæœ‰äº›ç°ä»£C++ç‰¹æ€§ä¸ä¼šæåŠï¼Œæ‰€ä»¥ä¼šæ ¹æ®æœ¬äºº<code>å¼€å‘ç»éªŒ</code>æ–°å¢ä¸€äº›ä¸ªäººæ„Ÿæ‚ŸğŸ‘‰<code>By the way</code>ç¯èŠ‚ã€‚</p><h2 id=ch7-æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹>CH7 æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹</h2><h3 id=r41-äº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€>R41 äº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€</h3><p>é¢å‘å¯¹è±¡ç¼–ç¨‹çš„é€šå¸¸åšæ³•ï¼š</p><ul><li><strong>æ˜¾å¼</strong>å®šä¹‰æ¥å£ï¼ˆå‚æ•°å’Œè¿”å›å€¼ç±»å‹éƒ½æ˜¯ç¡®å®šçš„ï¼Œå‡½æ•°ç­¾å å°±æ˜¯ç¡®å®šçš„ï¼‰</li><li>è™šå‡½æ•°å®ç°<strong>è¿è¡Œæ—¶å¤šæ€</strong></li></ul><p>é‚£ä¹ˆç¼–è¯‘æœŸå¤šæ€å‘¢ï¼Ÿåœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„ç­”æ¡ˆé€šå¸¸æ˜¯å‡½æ•°é‡è½½ã€‚</p><p>åœ¨Templates åŠæ³›å‹ç¼–ç¨‹ä¸­ï¼Œæ›´ä¸ºæ³¨é‡çš„æ˜¯<strong>éšå¼æ¥å£</strong>å’Œ<strong>ç¼–è¯‘æœŸå¤šæ€</strong>ï¼š</p><ul><li><code>éšå¼æ¥å£</code>:
Templateçš„æ¥å£å±äºéšå¼æ¥å£ï¼Œå› ä¸ºå®ƒç±»å‹ä¸ç¡®å®šï¼Œæ‰€ä»¥æ˜¯åŸºäºæœ‰æ•ˆè¡¨è¾¾å¼æ¥åŒºåˆ†ã€‚å†åŠ ä¸Šè¿ç®—ç¬¦é‡è½½ç­‰ç‰¹æ€§ï¼Œéšå¼æ¥å£çš„è‡ªç”±åº¦éå¸¸å¤§ã€‚</li><li><code>ç¼–è¯‘æœŸå¤šæ€</code>:
Templateçš„å¤šæ€æ˜¯é€šè¿‡Templateå…·ç°åŒ–å’Œå‡½æ•°é‡è½½å†³è®®å‘ç”Ÿäºç¼–è¯‘æœŸã€‚</li></ul><p>ä¸Šè¿°æè¿°çœ‹èµ·æ¥æœ‰ç‚¹æŠ½è±¡ï¼Œåˆ†æä¸‹æ–¹Templateå‡½æ•°ä»£ç ï¼š</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>doProcessing</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;</span> <span class=n>w</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>10</span> <span class=o>&amp;&amp;</span> <span class=n>w</span> <span class=o>!=</span> <span class=n>someNastyWidget</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>doProcessingå±äºéšå¼æ¥å£ï¼Œç±»å‹ä¸å®šï¼Œä¼ å…¥ä¸åŒç±»å‹Tï¼Œå°±å¾—åˆ°ä¸åŒçš„å‡½æ•°ã€‚</p><p>ç”±äº <code>æ“ä½œç¬¦é‡è½½(operator overloading)</code> çš„å­˜åœ¨ï¼Œéšå¼æ¥å£å¯¹ä¼ å…¥çš„ T ç±»å‹çš„è¦æ±‚æ¯”è¾ƒå®½æ¾ï¼Œåˆ—ä¸¾å¦‚ä¸‹ï¼š</p><ol><li>Tç±»å‹æˆ–å…¶çˆ¶ç±»å‹å…·æœ‰ size() æ¥å£ï¼Œsize() æ¥å£è¿”å›ç±»å‹Sä¸ºæ•´å‹æˆ–è€…Sç±»å‹æœ‰ <code>bool operator>(int)</code> æ¥å£ï¼›</li><li>Tç±»å‹æœ‰ <code>bool operator != (const T&)</code>æ¥å£ï¼›æˆ–Tç±»å‹å¯ä»¥éšå¼è½¬æ¢ä¸ºæŸSç±»å‹ï¼ŒSå¯ä»¥ä¸someNastyWidgetè¿›è¡Œ != æ¯”è¾ƒï¼Œæˆ–è€…å¹²è„†someNastyWidgetå°±æ˜¯Tç±»å‹ï¼›</li><li>ä¸Šè¿°1 ã€ 2 ç‚¹çš„æè¿°æ²¡æœ‰å°† <code>operator &&</code> è€ƒè™‘è¿›æ¥ï¼Œå¦åˆ™æƒ…å†µä¼šæ›´ä¸ºå¤æ‚ï¼Œè¿™é‡Œä¸èµ˜è¿°äº†ã€‚</li></ol><h3 id=r42-äº†è§£typenameçš„åŒé‡æ„ä¹‰>R42 äº†è§£typenameçš„åŒé‡æ„ä¹‰</h3><ul><li><code>typename</code> å’Œ <code>class</code> å…³é”®å­—åœ¨å£°æ˜ Template å‚æ•°çš„æ—¶å€™ï¼Œæ²¡æœ‰ä»»ä½•åŒºåˆ«
å¦‚ä¸‹ç¤ºä¾‹ï¼Œæ•ˆæœæ˜¯ä¸€è‡´çš„ï¼š</li></ul><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Widget</span> <span class=p>;</span> <span class=c1>//æ—©æœŸC++ä½¿ç”¨è¿™ä¸ªå£°æ˜Templateå‚æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Widget</span><span class=p>;</span> <span class=c1>//ç°åœ¨æ›´æ¨èç”¨è¿™ä¸ªï¼Œæš—ç¤ºå‚æ•°ä¸ä¸€å®šæ˜¯ä¸ªclassç±»å‹
</span></span></span></code></pre></td></tr></table></div></div><ul><li><p>ä½¿ç”¨å…³é”®å­— <code>typename</code> æ ‡è¯† <strong>åµŒå¥—ä»å±ç±»å‹åç§°</strong>
æ¨¡æ¿å†…çš„ä»å±ç±»å‹ï¼Œæ˜¯æŒ‡åœ¨æ¨¡æ¿å‡½æ•°/æ¨¡æ¿ç±»ä¸­ï¼Œéœ€è¦<strong>ä¾èµ–ä¼ å…¥çš„ template å‚æ•°é—´æ¥è¡¨ç¤º</strong>çš„ç±»å‹ï¼Œå¦‚æœå‘ˆåµŒå¥—çŠ¶ï¼Œå°±å«åµŒå¥—ä»å±åç§°/ç±»å‹ã€‚ å¦‚ä¸‹ç¤ºä¾‹çš„ <code>C::const_iterator</code> å°±æ˜¯åµŒå¥—ä»å±ç±»å‹ã€‚</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>C</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>printContainer2ndVal</span><span class=p>(</span><span class=k>const</span> <span class=n>C</span><span class=o>&amp;</span> <span class=n>container</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>container</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>typename</span> <span class=n>C</span><span class=o>::</span><span class=n>const_iterator</span> <span class=n>iter</span><span class=p>(</span><span class=n>container</span><span class=p>.</span><span class=n>begin</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;this container&#39;s second value is: &#34;</span> <span class=o>&lt;&lt;</span> <span class=o>*++</span><span class=n>iter</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>æ­¤æ—¶ï¼Œtypename çš„ä½œç”¨å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ C::const_iterator æ˜¯ä¸ªç±»å‹ï¼Œå¦åˆ™ä¼šç¼–è¯‘æŠ¥é”™ã€‚æ­¤æ—¶å¯ä»¥ç”¨ class å…³é”®å­—æ›¿ä»£ï¼Œä½†æ˜¯ä¸å»ºè®®ã€‚</p><p>typename ä½¿ç”¨èŒƒå›´ä¸åªæ˜¯ template å‡½æ•°å†…éƒ¨ï¼Œä¹ŸåŒ…æ‹¬äº†å‡½æ•°å…¥å‚ ï¼š</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>C</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>foo</span><span class=p>(</span><span class=k>const</span> <span class=n>C</span><span class=o>&amp;</span> <span class=n>container</span><span class=p>,</span>    <span class=c1>// ä¸å…è®¸ä½¿ç”¨ &#34;typename&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>typename</span> <span class=n>C</span><span class=o>::</span><span class=n>iterator</span> <span class=n>iter</span><span class=p>);</span> <span class=c1>// å¿…é¡»ä½¿ç”¨ &#34;typename&#34;
</span></span></span></code></pre></td></tr></table></div></div><p>âš ï¸ å…¶ä»–ç‰¹æ®Šæƒ…å†µï¼šä¸è¦åœ¨ åŸºç±»åˆ—è¡¨base class list æˆ– æˆå‘˜åˆå§‹åŒ–åˆ—member initialization list ä½¿ç”¨ typename</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Derived</span><span class=o>:</span> <span class=k>public</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>Nested</span><span class=p>{</span> <span class=c1>//åŸºç±»åˆ—è¡¨ä¸å…è®¸ä½¿ç”¨typename
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>explicit</span> <span class=n>Derived</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>)</span><span class=o>:</span><span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>Nested</span><span class=p>(</span><span class=n>x</span><span class=p>){</span><span class=c1>// æˆå‘˜åˆå€¼åˆ—ä¹Ÿä¸å…è®¸typename
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>typedef</span> <span class=k>typename</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>Nested</span> <span class=n>NestedType</span><span class=p>;</span><span class=c1>//ç»“åˆtypedefå®šä¹‰ï¼Œå¸¸è§„ç”¨æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>NestedType</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span><span class=c1>// å…¶ä»–æ“ä½œ
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=r43-å­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°>R43 å­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°</h3><p><strong>æ¨¡æ¿åŒ–åŸºç±»</strong>ï¼šæŒ‡å®šä¹‰ template æ¨¡æ¿ç±»æ—¶ï¼Œç»§æ‰¿äºæŸåŸºç±» Base<t>ï¼Œè¿™ä¸ª Base<t> ç±»å°±æ˜¯æ¨¡æ¿åŒ–åŸºç±»ã€‚</p><p>ğŸ¤” é‚£ä¹ˆ Base<t> ç±»æœ‰å…³çš„å‡½æ•°ç­‰åç§°è¯¥å¦‚ä½•å¤„ç†ï¼Œåœ¨å­ç±»ä¸­ç›´æ¥ä½¿ç”¨å—ï¼Ÿè¿˜æ˜¯æœ‰æ³¨æ„äº‹é¡¹ï¼Ÿè¿™ï¼Œå°±æ˜¯æœ¬èŠ‚è¦è®¨è®ºçš„é—®é¢˜ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>Company</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MsgSender</span><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>SendPlain</span><span class=p>(){</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;send plain</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>SendEncrypted</span><span class=p>(){</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;send encrypted</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>  <span class=c1>// åŸºç±»
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>Company</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>LoggingMsgSender</span><span class=o>:</span> <span class=k>public</span> <span class=n>MsgSender</span><span class=o>&lt;</span><span class=n>Company</span><span class=o>&gt;</span><span class=p>{</span><span class=c1>//å­ç±»
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>SendPlainMsg</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=n>SendPlain</span><span class=p>();</span><span class=c1>//  ==&gt; è¿™æ ·ç›´æ¥è°ƒç”¨æ˜¯ä¸è¡Œçš„ï¼Œæƒ³æƒ³ä¸ºä»€ä¹ˆï¼Ÿ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>ä¸Šè¿°æ³¨é‡Šä¸­é—®é¢˜çš„åŸå› ï¼šå› ä¸ºå½“å…¨ç‰¹åŒ–æ—¶å¯éšæ„å»é™¤ MsgSender å†…çš„å‡½æ•°ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨æ— æ³•ç¡®å®šåŸºç±»æ˜¯å¦ä»æœ‰ SendPlain è¿™ä¸ªæ–¹æ³•ã€‚æ‰€ä»¥ï¼Œç¼–è¯‘å™¨å¹²è„†<strong>æ‹’ç»åœ¨ç¼–è¯‘æ—¶</strong>å»æ¨¡æ¿åŒ–åŸºç±»ä¸­<strong>ä¸»åŠ¨å¯»æ‰¾</strong>ç»§æ‰¿è€Œæ¥çš„åç§°ã€‚</p><p>è§£å†³æ–¹æ³•æœ‰ä¸‰ä¸ªï¼š</p><ol><li>ä½¿ç”¨ <code>this-></code> è°ƒç”¨SendPlain()ï¼Œå³å¯è½¬åŒ–ä¸ºè¿è¡Œæ—¶çš„é—®é¢˜ï¼Œæ¨èè¿™ä¸ªæ–¹æ³•ï¼›</li><li>ä½¿ç”¨ <code>using MsgSender::SendPlain;</code> è¿™æ ·çš„ using å£°æ˜å¼ï¼Œæˆ‘ä»¬åœ¨ Rule 33: é¿å…é®æ©ç”±ç»§æ‰¿å¾—æ¥çš„åç§° ä¸­ç”¨è¿‡è¿™ç§æ–¹æ³•ï¼Œæ˜¾å¼åœ°å‘Šè¯‰ç¼–è¯‘å™¨æ‰©å¤§åç§°æœç´¢èŒƒå›´ï¼Œå°è¯•å»åŸºç±»æ‰¾æ‰¾ï¼›</li><li>ä½¿ç”¨æ˜¾å¼è°ƒç”¨ï¼Œå³ <code>MsgSender::SendPlain();</code> ï¼Œä½†è¿™æ ·åšçš„åå¤„æ˜¯ç›´æ¥æ–­ç»äº† virtual å‡½æ•°çš„çµæ´»æ€§å’Œå¯èƒ½ï¼Œä¸å¤ªæ¨è</li></ol><h3 id=r44-å°†ä¸å‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates>R44 å°†ä¸å‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates</h3><p>é€šå¸¸ï¼Œåœ¨éæ¨¡æ¿ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹å‡ºé‡å¤çš„ä»£ç æˆ–è€…ç±»ï¼Œä¸€èˆ¬é‡‡ç”¨æŠ½å–å…¬å…±éƒ¨åˆ†ä¸ºå•ç‹¬å‡½æ•°ï¼Œæˆ–è€…é‡‡ç”¨ç±»çš„ç»§æ‰¿/èšåˆç­‰é¢å‘å¯¹è±¡è®¾è®¡æ–¹å¼ã€‚</p><p>ä½†æ˜¯ï¼Œ template æœ‰å…³çš„ä»£ç ï¼Œæœ‰æ—¶ä»£ç é‡å¤æ˜¯éšæ™¦çš„ã€‚ è¿™ä¸€èŠ‚æ˜¯ä¸ºäº†è§£å†³ template çš„ <code>ä»£ç è†¨èƒ€(code bloat)</code> é—®é¢˜ï¼Œä¸»è¦åŸåˆ™ä¸º <code>å…±æ€§ä¸å·®å¼‚æ€§åˆ†æ(commonality and variability analysis)</code> ã€‚</p><p>**æŸäº›ä¸æ°å½“çš„è®¾è®¡ï¼Œä¼šå¯¼è‡´æ— ç•çš„ä»£ç è†¨èƒ€ã€‚**å…ˆçœ‹ä¸‹æ–¹è¿™ä¸ªåé¢æ•™æï¼š</p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>n</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SquareMatrix</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>invert</span><span class=p>()</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;size is &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>n</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>åº”ç”¨ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>//ä¸‹é¢è¿™2å¥ï¼Œæ¨¡æ¿ç±»å®ä¾‹åŒ– 1 æ¬¡ã€‚ invertå‡½æ•°æœ‰ 1 ä»½å®ç°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>SquareMatrix</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>5</span><span class=o>&gt;</span> <span class=n>mat5</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>SquareMatrix</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>5</span><span class=o>&gt;</span> <span class=n>mat5New</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//æ¢æˆä¸‹é¢è¿™2å¥ï¼Œæ¨¡æ¿ç±»å®ä¾‹åŒ– 2 æ¬¡ã€‚invertå‡½æ•°æœ‰ 2 ä»½å®ç°(é—®é¢˜æš´éœ²)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>SquareMatrix</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>5</span><span class=o>&gt;</span> <span class=n>mat5</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>SquareMatrix</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>10</span><span class=o>&gt;</span> <span class=n>mat10</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p><strong>è†¨èƒ€åŸå› </strong>ï¼šåœ¨ç¼–è¯‘å™¨çœ‹æ¥ï¼ŒSquareMatrix&lt;int, 5> å’Œ SquareMatrix&lt;int, 10> æ˜¯2ä¸ª<strong>å®Œå…¨ä¸åŒçš„ C++ ç±»</strong>ï¼Œå®ä¾‹åŒ–äº†2æ¬¡ï¼Œç”Ÿæˆäº†è¿™2ä¸ªç±»ã€‚è¯•æƒ³ï¼Œå¦‚æœä»£ç ä¸­è¿˜éœ€è¦å…¶ä»– size çš„SquareMatrix ï¼Œéƒ½ä¼šå†ç”Ÿæˆä¸€ä¸ªæ–°ç±»ï¼Œé‚£ä¹ˆæœ€åäºŒè¿›åˆ¶æ–‡ä»¶å°±å¤šäº†è®¸å¤šé‡å¤çš„ç›®æ ‡ä»£ç ï¼Œä¹Ÿå°±æ˜¯è†¨èƒ€ã€‚</p><p>å¦‚æœèƒ½<strong>æŠ½ç¦»å‚æ•°ç›¸å…³ä»£ç </strong>ï¼Œåšåˆ°å°ºå¯¸æ— å…³ï¼Œä¾¿å¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p><strong>è§£å†³æ€è·¯</strong>ï¼šæ–°å»ºä¸€ä¸ªåŸºç±» BaseMatrix ï¼Œå°†å°ºå¯¸å‚æ•°ä¼ å…¥ç»™åˆ°åŸºç±»ä½œä¸ºæˆå‘˜å˜é‡ä¿ç®¡ï¼Œå…·ä½“çš„æ•°æ®å¯ä»¥ç”¨æ•°ç»„æŒ‡é’ˆå½¢å¼æ‰˜ç®¡ã€‚ä¸è®ºæœ‰å¤šå°‘ä¸ªä¸å°ºå¯¸æœ‰å…³çš„æ´¾ç”Ÿç±»ï¼Œä¸€ä¸ª T ç±»å‹å°±<strong>åªæœ‰ä¸€ä¸ªåŸºç±»</strong>ï¼Œæ‰€ä»¥åŸºç±» <code>baseInvert</code> <strong>å‡½æ•°å®ç°åªæœ‰ä¸€ä»½</strong>ã€‚</p><p><mark>åŸºç±»å®ç°</mark>ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BaseSqaureMatrix</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>BaseSqaureMatrix</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>n</span><span class=p>,</span><span class=n>T</span><span class=o>*</span> <span class=n>dataPtr</span><span class=p>)</span> <span class=o>:</span><span class=n>n_</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=n>dataPtr_</span><span class=p>(</span><span class=n>dataPtr</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>baseInvert</span><span class=p>()</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;invert: pData = &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>dataPtr_</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; , size = &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>n_</span>  <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>SetDataPtr</span><span class=p>(</span><span class=n>T</span><span class=o>*</span> <span class=n>dataPtr</span><span class=p>)</span> <span class=p>{</span> <span class=n>dataPtr_</span> <span class=o>=</span> <span class=n>dataPtr</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>n_</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span><span class=o>*</span> <span class=n>dataPtr_</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p><mark>ç›®æ ‡æ´¾ç”Ÿç±»</mark>å®ç°å¦‚ä¸‹ï¼š</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>n</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SquareMatrix</span> <span class=o>:</span> <span class=k>public</span> <span class=n>BaseSqaureMatrix</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>SquareMatrix</span><span class=p>()</span> <span class=o>:</span><span class=n>BaseSqaureMatrix</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=k>nullptr</span><span class=p>),</span> <span class=n>data_</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=k>new</span> <span class=n>T</span><span class=p>[</span><span class=n>n</span><span class=o>*</span><span class=n>n</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>-&gt;</span><span class=n>SetDataPtr</span><span class=p>(</span><span class=n>data_</span><span class=p>.</span><span class=n>get</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>invert</span><span class=p>()</span> <span class=p>{</span> <span class=k>this</span><span class=o>-&gt;</span><span class=n>baseInvert</span><span class=p>();</span> <span class=p>}</span><span class=c1>// å‚è€ƒRule43
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>data_</span> <span class=p>;</span><span class=c1>// RAIIç®¡ç†èµ„æº
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>æœ€ç»ˆæ•ˆæœï¼šç›¸åŒ T ç±»å‹çš„templateå®ä¾‹ç±»(æ¯”å¦‚SquareMatrix&lt;float,5>å’ŒSquareMatrix&lt;float,6>)ï¼Œ<mark>å…±äº«å®ç°ç </mark>ï¼Œç¥›é™¤ä»£ç è†¨èƒ€ã€‚</p><h3 id=r45-è¿ç”¨æ¨¡æ¿æˆå‘˜å‡½æ•°æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹>R45 è¿ç”¨æ¨¡æ¿æˆå‘˜å‡½æ•°æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Base *pBase = pDerived</code>; è¿™æ ·æ™®é€šç±»å‹è£¸æŒ‡é’ˆçš„éšå¼è½¬æ¢æ˜¯è¢« C++ æ‰€è®¤å¯çš„ã€‚</p><p>é‚£ä¹ˆå¦‚æœæ¢æˆæ™ºèƒ½æŒ‡é’ˆæ¨¡æ¿ç±» SmartPtr<base> å’Œ SmartPtr <derived>å‘¢ï¼Œè¿˜èƒ½è¿™æ ·<strong>ä¸éœ€é¢å¤–é…ç½®</strong>å°±éšæ„è½¬æ¢å—ï¼Œç­”æ¡ˆæ˜¾ç„¶<strong>æ˜¯ä¸è¡Œ</strong>çš„ï¼ˆçºµç„¶ Base å’Œ Derived æ˜¯å…¼å®¹ç±»å‹ä¹Ÿä¸è¡Œï¼‰ã€‚</p><p>æœ¬èŠ‚ï¼Œå°±é‡‡ç”¨<mark>æ¨¡æ¿æˆå‘˜å‡½æ•°</mark>æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p><ul><li><strong>ä½¿ç”¨æ¨¡æ¿æˆå‘˜å‡½æ•°ï¼Œæ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹çš„â€œæ³›åŒ–æ„é€ â€/â€œæ³›åŒ–èµ‹å€¼â€</strong>
<code>æ³›åŒ–(generalized)Copyæ„é€ </code>ï¼Œæ˜¯æŒ‡æ¥å—å…¶ä»–å…¼å®¹ç±»å‹è¿›è¡Œæ¨¡æ¿å‡½æ•°çš„Copyæ„é€ ã€‚ä¸¾ä¾‹ä¸€ä¸ªç²—ç³™çš„ RAII æ™ºèƒ½æŒ‡é’ˆå®ç°ï¼Œä»£ç å¦‚ä¸‹ğŸ‘‡:<div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SmartPtr</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>SmartPtr</span><span class=p>(</span><span class=n>T</span><span class=o>*</span> <span class=n>origPtr</span><span class=p>)</span> <span class=o>:</span><span class=n>originPtr_</span><span class=p>(</span><span class=n>origPtr</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>SmartPtr</span><span class=p>(</span><span class=k>const</span> <span class=n>SmartPtr</span><span class=o>&amp;</span> <span class=n>smt</span><span class=p>)</span> <span class=o>:</span><span class=n>originPtr_</span><span class=p>(</span><span class=n>smt</span><span class=p>.</span><span class=n>get</span><span class=p>())</span> <span class=p>{}</span><span class=c1>// æ­£å¸¸Copyæ„é€ å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//æ­£å¸¸copyæ“ä½œç¬¦å‡½æ•°: ç®€å•æ¼”ç¤ºï¼Œå°±æµ…å¤åˆ¶å§
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>SmartPtr</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>SmartPtr</span><span class=o>&amp;</span> <span class=n>smt</span><span class=p>)</span> <span class=p>{</span> <span class=n>originPtr_</span> <span class=o>=</span> <span class=n>smt</span><span class=p>.</span><span class=n>get</span><span class=p>();</span> <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>U</span><span class=o>&gt;</span> <span class=c1>//æ³›åŒ–æ„é€ å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>SmartPtr</span><span class=p>(</span><span class=k>const</span> <span class=n>SmartPtr</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;&amp;</span> <span class=n>other</span><span class=p>)</span><span class=o>:</span><span class=n>originPtr_</span><span class=p>(</span><span class=n>other</span><span class=p>.</span><span class=n>get</span><span class=p>())</span> <span class=p>{</span> <span class=p>}</span> <span class=c1>//ä¸ºäº†éšå¼è½¬æ¢ä¸åŠ  explict
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>U</span><span class=o>&gt;</span> <span class=c1>//æ³›åŒ–èµ‹å€¼æ“ä½œç¬¦
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>SmartPtr</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>SmartPtr</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>originPtr_</span> <span class=o>=</span> <span class=n>other</span><span class=p>.</span><span class=n>get</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span><span class=c1>//ç®€å•æ¼”ç¤ºï¼Œæµ…å¤åˆ¶
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>*</span> <span class=nf>get</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>originPtr_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=o>~</span><span class=n>SmartPtr</span><span class=p>()</span> <span class=p>{</span> <span class=k>delete</span> <span class=n>originPtr_</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>*</span> <span class=n>originPtr_</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div>æœ‰ä¸Šè¿°çš„ä»£ç æ”¯æŒï¼Œæˆ‘ä»¬å°±èƒ½å†™å‡ºå¦‚ä¸‹çš„åº”ç”¨ä»£ç ï¼š<div class=highlight id=id-12><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>class</span> <span class=nc>BaseObj</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DerivedObj</span><span class=o>:</span><span class=k>public</span> <span class=n>BaseObj</span> <span class=p>{};</span><span class=c1>//DerivedObjæ˜¯BaseObjå…¼å®¹ç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>SmartPtr</span><span class=o>&lt;</span><span class=n>DerivedObj</span><span class=o>&gt;</span> <span class=n>smDerived</span><span class=p>(</span><span class=k>new</span> <span class=n>DerivedObj</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=n>SmartPtr</span><span class=o>&lt;</span><span class=n>BaseObj</span><span class=o>&gt;</span> <span class=n>smBase</span><span class=p>(</span><span class=n>smDerived</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>SmartPtr</span><span class=o>&lt;</span><span class=n>BaseObj</span><span class=o>&gt;</span> <span class=n>smBase2</span> <span class=o>=</span> <span class=n>smDerived</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div></li><li><strong>å³ä½¿æœ‰ â€œæ³›åŒ–æ„é€ / èµ‹å€¼â€ï¼Œä¹Ÿéœ€è¦æ­£å¸¸çš„ Copyæ„é€ /èµ‹å€¼</strong>
æ³¨æ„ï¼Œæ¨¡æ¿æˆå‘˜å‡½æ•°ä¸ä¼šæ”¹å˜è¯­è¨€è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´â€œæ³›åŒ–æ„é€ â€ä¸èƒ½ä»£æ›¿æ­£å¸¸çš„ copy æ„é€ å‡½æ•°ã€‚æ‰€ä»¥ï¼Œéœ€è¦åŒæ—¶å£°æ˜æ­£å¸¸çš„ Copy æ„é€ å‡½æ•°å’Œ Copy èµ‹å€¼æ“ä½œç¬¦å‡½æ•°ã€‚</li></ul><h3 id=r46-éœ€è¦ç±»å‹è½¬æ¢æ—¶è¯·ä¸ºæ¨¡æ¿å®šä¹‰éæˆå‘˜å‡½æ•°>R46 éœ€è¦ç±»å‹è½¬æ¢æ—¶è¯·ä¸ºæ¨¡æ¿å®šä¹‰éæˆå‘˜å‡½æ•°</h3><p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ› class æ”¯æŒç±»å‹è½¬æ¢ï¼Œç±»ä¼¼æœ¬ä¹¦çš„å¦å¤–ä¸€èŠ‚ğŸ‘‰ <a href=https://jianye0428.github.io/posts/parttwo/#r24-%E8%8B%A5%E6%89%80%E6%9C%89%E5%8F%82%E6%95%B0%E7%9A%86%E9%9C%80%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E8%AF%B7%E9%87%87%E7%94%A8non-member target=_blank rel="external nofollow noopener noreferrer">Rule24:è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢ï¼Œè¯·é‡‡ç”¨non-member<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> ã€‚</p><p>å¦‚æœ Rule24 ä¸­çš„ Rational ç±»æ˜¯ template æ¨¡æ¿ç±»ï¼Œç›´æ¥ä»¿ç…§ Rule24 åˆ©ç”¨ non-member å‡½æ•°åšæ··åˆè¿ç®—æ˜¯è¡Œä¸é€šçš„ï¼ŒåŸå› æ˜¯ <strong>template å®å‚æ¨å¯¼</strong>æ˜¯ä¸é‡‡çº³ â€œé€šè¿‡æ„é€ å‡½æ•°è€Œå‘ç”Ÿçš„â€éšå¼ç±»å‹è½¬æ¢ã€‚</p><p>è§£å†³åŠæ³•å¦‚ä¸‹:</p><ul><li><p><strong>ä½¿ç”¨ â€œtemplate class å†…éƒ¨çš„friendå‡½æ•°â€ å®Œæˆå‚æ•°éšå¼è½¬æ¢</strong>
å°† Rule24 çš„ non-member çš„ <strong>operator *å‡½æ•°</strong>æ”¹ä¸º <code>inline-friend</code> å‡½æ•°ï¼Œå› ä¸º template å®ä¾‹åŒ–çš„æ—¶å€™éœ€è¦æ‰¾åˆ°è¯¥ friend å‡½æ•°çš„å®šä¹‰å®ç°ï¼Œç±»å¤–å®šä¹‰å®ç°æ˜¯ä¼šé“¾æ¥é”™è¯¯çš„ï¼Œæ‰€ä»¥éœ€è¦ inline ã€‚
å‚è€ƒä»£ç å®ç°å¦‚ä¸‹ï¼š</p><div class=highlight id=id-13><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RationalNew</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>RationalNew</span><span class=p>(</span><span class=n>T</span> <span class=n>numerator</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>T</span> <span class=n>denominator</span> <span class=o>=</span> <span class=mi>1</span><span class=p>)</span> <span class=o>:</span><span class=n>numerator_</span><span class=p>(</span><span class=n>numerator</span><span class=p>),</span> <span class=n>denominator_</span><span class=p>(</span><span class=n>denominator</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=nf>numerator</span><span class=p>()</span><span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>numerator_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=nf>denominator</span><span class=p>()</span><span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>denominator_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=k>const</span> <span class=n>RationalNew</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=k>operator</span><span class=o>*</span><span class=p>(</span><span class=k>const</span> <span class=n>RationalNew</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span><span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>RationalNew</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span><span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>RationalNew</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>lhs</span><span class=p>.</span><span class=n>numerator</span><span class=p>()</span><span class=o>*</span><span class=n>rhs</span><span class=p>.</span><span class=n>numerator</span><span class=p>(),</span><span class=n>lhs</span><span class=p>.</span><span class=n>denominator</span><span class=p>()</span><span class=o>*</span><span class=n>rhs</span><span class=p>.</span><span class=n>denominator</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>numerator_</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>denominator_</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>é‚£ä¹ˆï¼Œå¯¹å¦‚ä¸‹çš„åº”ç”¨ä»£ç ï¼Œå°±ä½¿ç”¨è‡ªå¦‚äº†ï¼š</p><div class=highlight id=id-14><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>RationalNew</span><span class=o>&lt;</span><span class=kt>float</span><span class=o>&gt;</span> <span class=n>oneHalf</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span><span class=mf>2.0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>RationalNew</span><span class=o>&lt;</span><span class=kt>float</span><span class=o>&gt;</span> <span class=n>res</span> <span class=o>=</span> <span class=n>oneHalf</span> <span class=o>*</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>RationalNew</span><span class=o>&lt;</span><span class=kt>float</span><span class=o>&gt;</span> <span class=n>res2</span> <span class=o>=</span> <span class=mi>3</span> <span class=o>*</span> <span class=n>oneHalf</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>è‹¥inline-friendå‡½æ•°ä½“å¤ªå¤§ï¼Œå¯ä»¥æŠ½ç¦»å‡ºç±»å¤–è¾…åŠ©å‡½æ•°ä¾›inlineè°ƒç”¨</strong>
ä¸Šè¿°çš„ operator* å‡½æ•°ä½“åªæœ‰ä¸€è¡Œï¼Œå®ç°ç®€å•ï¼Œä½†å¦‚æœå®ç°è¿‡ç¨‹å¤æ‚ä»£ç é‡å¤§ï¼Œè€ƒè™‘ inline å¸¦æ¥çš„å†²å‡»ä»¥åŠä»£ç å¯è¯»æ€§ï¼Œå¯ä»¥æŠ½å–ä¸ªå‡½æ•°å‡ºæ¥ä¾› inline-friend è°ƒç”¨ã€‚</p><p>ä¿®æ”¹æ–¹å¼å¦‚ä¸‹ï¼š</p><div class=highlight id=id-15><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RationalNew</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=c1>//  å…¶ä»–éƒ¨åˆ†ç•¥ã€‚æ³¨æ„ operator* å‡½æ•°ä½“å®ç°ï¼Œæ”¹ä¸ºè°ƒç”¨doMultiply
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>friend</span> <span class=k>const</span> <span class=n>RationalNew</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=k>operator</span><span class=o>*</span><span class=p>(</span><span class=k>const</span> <span class=n>RationalNew</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span><span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>RationalNew</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span><span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>doMultiply</span><span class=p>(</span><span class=n>lhs</span><span class=p>,</span><span class=n>rhs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>// ç±»å¤–å‡½æ•°  doMultiply
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>RationalNew</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>doMultiply</span><span class=p>(</span><span class=k>const</span> <span class=n>RationalNew</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span><span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>RationalNew</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span><span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>RationalNew</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>lhs</span><span class=p>.</span><span class=n>numerator</span><span class=p>()</span><span class=o>*</span><span class=n>rhs</span><span class=p>.</span><span class=n>numerator</span><span class=p>(),</span> <span class=n>lhs</span><span class=p>.</span><span class=n>denominator</span><span class=p>()</span><span class=o>*</span><span class=n>rhs</span><span class=p>.</span><span class=n>denominator</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=r47-è¯·ä½¿ç”¨traits-classesè¡¨ç°ç±»å‹ä¿¡æ¯>R47 è¯·ä½¿ç”¨traits classesè¡¨ç°ç±»å‹ä¿¡æ¯</h3><p>C++ ä¸­é€šå¸¸æŠŠ Traits ç§°ä¸º<strong>ç±»å‹èƒå–</strong>æŠ€æœ¯ï¼Œå³ï¼šåœ¨ template ç¼–ç¨‹ä¸­ï¼Œè·å–æ¨¡æ¿å‚æ•°çš„ç±»å‹ä¿¡æ¯ï¼Œå¹¶åœ¨ç¼–è¯‘é˜¶æ®µé’ˆå¯¹ä¸åŒçš„ç±»å‹å“åº”ä¸åŒçš„å¤„ç†ã€‚åŒæ—¶ï¼Œè¿™ä¸ªæŠ€æœ¯è¦æ±‚å¯¹C++<strong>å†…ç½®ç±»å‹built-in</strong> å’Œ <strong>ç”¨æˆ·è‡ªå®šä¹‰user-defined</strong> ç±»å‹çš„è¡¨ç°å¿…é¡»ä¸€æ ·å¥½ã€‚</p><p>æœ¬èŠ‚è®¨è®ºæ­¤è®®é¢˜ï¼Œå¹¶ä¸”ä»¥ä¸€ä¸ª C++ æ ‡å‡†çš„æ¨¡æ¿å‡½æ•°ä½œä¸ºåˆ‡å…¥å£è¿›è¡Œè®¨è®º(std::advanceï¼Œä½œç”¨æ˜¯å…¼å®¹ä¸åŒç±»å‹è¿­ä»£å™¨ï¼Œç”¨äºåç»­å–ç”¨æŒ‡å®šåç§»é‡çš„å…ƒç´  )ã€‚</p><p>ä¸‹æ–¹ â€œBy the wayâ€ ç¯èŠ‚ç®€å•å±•ç¤ºäº† std::advance æ ‡å‡†C++çš„å£°æ˜å¼å’ŒåŸºæœ¬ç”¨æ³•ï¼š ğŸ‘‡ï¼ˆå•å‡»å±•å¼€ï¼‰</p><p><div class="details admonition Note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>std::advance éœ€è¦çš„å¤´æ–‡ä»¶åŒ…å«ä¸º <code>#include&lt;iterator></code> ï¼Œå†çœ‹ä¸‹å®ƒçš„å‡½æ•°åŸå‹å£°æ˜ï¼š</p><div class=highlight id=id-35><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span> <span class=k>class</span> <span class=nc>InputIt</span><span class=p>,</span> <span class=k>class</span> <span class=nc>Distance</span> <span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>advance</span><span class=p>(</span> <span class=n>InputIt</span><span class=o>&amp;</span> <span class=n>it</span><span class=p>,</span> <span class=n>Distance</span> <span class=n>n</span> <span class=p>);</span>       <span class=c1>// C++17 ä¹‹å‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span> <span class=k>class</span> <span class=nc>InputIt</span><span class=p>,</span> <span class=k>class</span> <span class=nc>Distance</span> <span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>void</span> <span class=n>advance</span><span class=p>(</span> <span class=n>InputIt</span><span class=o>&amp;</span> <span class=n>it</span><span class=p>,</span> <span class=n>Distance</span> <span class=n>n</span> <span class=p>);</span> <span class=c1>// è‡ªC++17 å¼€å§‹
</span></span></span></code></pre></td></tr></table></div></div><p>å†çœ‹ä¸‹ç¤ºä¾‹åº”ç”¨ä»£ç ï¼š</p><div class=highlight id=id-36><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>nums</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>vIter</span> <span class=o>=</span> <span class=n>nums</span><span class=p>.</span><span class=n>begin</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>advance</span><span class=p>(</span><span class=n>vIter</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;after advance  3 offset: *vIter = &#34;</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>vIter</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>deque</span><span class=o>&lt;</span><span class=kt>float</span><span class=o>&gt;</span> <span class=n>fNums</span><span class=p>{</span><span class=mf>0.1</span><span class=p>,</span><span class=mf>0.2</span><span class=p>,</span><span class=mf>0.3</span><span class=p>,</span><span class=mf>0.4</span><span class=p>,</span><span class=mf>0.5</span><span class=p>,</span><span class=mf>0.6</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>dIter</span> <span class=o>=</span> <span class=n>fNums</span><span class=p>.</span><span class=n>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>advance</span><span class=p>(</span><span class=n>dIter</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;after advance -2 offset: *dIter = &#34;</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>dIter</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>list</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;</span> <span class=n>chList</span><span class=p>{</span><span class=mi>10</span><span class=p>,</span><span class=mi>20</span><span class=p>,</span><span class=mi>30</span><span class=p>,</span><span class=mi>40</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>cIter</span> <span class=o>=</span> <span class=n>chList</span><span class=p>.</span><span class=n>begin</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>advance</span><span class=p>(</span><span class=n>cIter</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;after advance  2 offset: *cIter = &#34;</span> <span class=o>&lt;&lt;</span> <span class=kt>int</span><span class=p>(</span><span class=o>*</span><span class=n>cIter</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>æœ€ç»ˆè¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š</p><div class=highlight id=id-37><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>after advance  <span class=m>3</span> offset: *vIter <span class=o>=</span> <span class=m>4</span>
</span></span><span class=line><span class=cl>after advance -2 offset: *dIter <span class=o>=</span> 0.5
</span></span><span class=line><span class=cl>after advance  <span class=m>2</span> offset: *cIter <span class=o>=</span> <span class=m>30</span></span></span></code></pre></td></tr></table></div></div></div></div></div>èƒŒæ™¯çŸ¥è¯† ğŸ‘‰ STL è¿­ä»£å™¨æŒ‰ç…§åŠŸèƒ½åˆ†ä¸º 5 ç±»ï¼Œå¦‚ä¸‹æ–¹è¡¨æ ¼æ‰€è¿°ï¼š</p><table><thead><tr><th>æè¿°</th><th>ç‰¹ç‚¹</th><th>åº”ç”¨</th><th></th></tr></thead><tbody><tr><td>input è¿­ä»£å™¨</td><td>åªå‘å‰ç§»åŠ¨ï¼Œä¸€æ¬¡ä¸€æ­¥ï¼Œåªè¯»</td><td>istream_iterators</td><td></td></tr><tr><td>outputè¿­ä»£å™¨</td><td>åªå‘å‰ç§»åŠ¨ï¼Œä¸€æ¬¡ä¸€æ­¥ï¼Œåªå†™</td><td>ostream_iterators</td><td></td></tr><tr><td>forwardè¿­ä»£å™¨</td><td>åªå‘å‰ç§»åŠ¨ï¼Œä¸€æ¬¡ä¸€æ­¥ï¼Œå¯è¯»å†™</td><td>single-list iterator</td><td></td></tr><tr><td>Bidirectionalè¿­ä»£å™¨</td><td>åŒå‘ç§»åŠ¨ï¼Œä¸€æ¬¡ä¸€æ­¥ï¼Œå¯è¯»å†™</td><td>set/multiset/map/multimap</td><td></td></tr><tr><td>random-accessè¿­ä»£å™¨</td><td>åŒå‘ç§»åŠ¨ï¼Œä¸€æ¬¡å¤šæ­¥ï¼Œå¯è¯»å†™</td><td>vetor/deque/string</td><td></td></tr></tbody></table><p><mark>å¦‚ä½•è®¾è®¡ä¸€ä¸ª trait_class å¹¶è¿ç”¨èµ·æ¥å‘¢ï¼Ÿ</mark></p><ul><li><strong>Step1ï¼š ç¡®è®¤è‹¥å¹²ä¸ªå¸Œæœ›è·å–çš„ç±»å‹ä¿¡æ¯</strong> (æœ¬ä¾‹åªæœ‰ä¸€ä¸ª iterator ç±»åˆ«ä¿¡æ¯)
é’ˆå¯¹5 ç§è¿­ä»£å™¨åˆ†ç±»ï¼ŒC++ æä¾›äº†ä¸“å±çš„ <strong>å·æ ‡ç»“æ„tag struct</strong> åŠ ä»¥åŒºåˆ†(å¯ä»¥ç†è§£ä¸ºç¼–è¯‘æœŸçš„æšä¸¾ä½œç”¨)ï¼Œç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š<div class=highlight id=id-16><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>struct</span> <span class=nc>input_iterator_tag</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>output_iterato_tag</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>forward_iterator_tag</span><span class=o>:</span><span class=k>public</span> <span class=n>input_iterator_tag</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>bidirectional_iterator_tag</span><span class=o>:</span> <span class=k>public</span> <span class=n>forward_iterator_tag</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>random_access_iterator_tag</span><span class=o>:</span> <span class=k>public</span> <span class=n>bidirectional_iterator_tag</span><span class=p>{};</span><span class=err>`</span></span></span></code></pre></td></tr></table></div></div></li><li><strong>Step2ï¼šä¸ºè¯¥ä¿¡æ¯é€‰ä¸€ä¸ªåç§°</strong> (ä¾‹å¦‚ iterator_category)
é‚£ä¹ˆ vectorï¼Œsetä¹‹ç±»çš„<strong>ç›®æ ‡å®¹å™¨ç±»</strong>ï¼Œå¦‚ä½•ä¸ä¸Šè¿° iterator_tag <strong>è”ç³»èµ·æ¥</strong>å‘¢ï¼Œéœ€è¦ä¸€ä¸ªåç§°ä¼ é€’å‡ºå»ï¼š<div class=highlight id=id-17><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span> <span class=p>...</span> <span class=o>&gt;</span> <span class=c1>//çœç•¥template å‚æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>vector</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>iterator</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>public</span><span class=o>:</span>   <span class=c1>// ps: C++11 ä¹‹åä½¿ç”¨çš„éƒ½æ˜¯ using å®šä¹‰å¼
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>typedef</span> <span class=n>random_access_iterator_tag</span> <span class=n>iterator_category</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div></li><li><strong>Step3ï¼šæä¾›ä¸€ä¸ª template ç±»å’Œä¸€ç»„ç‰¹åŒ–ç‰ˆæœ¬</strong>ï¼ˆç‰¹åŒ–ç‰ˆæœ¬æ”¯æŒæŸäº›ç‰¹æ®Šæƒ…å†µï¼‰
<code>Traits æŠ€æœ¯</code>é’ˆå¯¹äºè¿­ä»£å™¨çš„å…³é”®æ¨¡æ¿ç±» iterator_traits å®šä¹‰å¦‚ä¸‹ï¼š<div class=highlight id=id-18><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>IterT</span><span class=o>&gt;</span>  <span class=c1>//  æ³¨æ„ï¼šä½¿ç”¨çš„æ˜¯ struct
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>iterator_traits</span> <span class=p>{</span> <span class=c1>//è¿™é‡Œçš„ IterT å°±å¯ä»¥ä¼ å…¥vectorç­‰å®¹å™¨ç±»
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>typedef</span> <span class=k>typename</span> <span class=n>IterT</span><span class=o>::</span><span class=n>iterator_category</span>  <span class=n>iterator_category</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div>æ³¨æ„ï¼Œè¿™é‡Œçš„ IterT ç±»å‹ä¸èƒ½æ˜¯æŒ‡é’ˆç±»å‹ï¼Œå› ä¸º pointer ä¸èƒ½åç»­åµŒå¥—ã€‚é‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªç‰¹åŒ–ç‰ˆæœ¬äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š<div class=highlight id=id-19><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>IterT</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>iterator_traits</span><span class=o>&lt;</span><span class=n>IterT</span><span class=o>*&gt;</span><span class=p>{</span> <span class=c1>// æŒ‡é’ˆç±»å‹å’Œ random è¿­ä»£å™¨ç±»ä¼¼
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>typedef</span> <span class=n>random_access_iterator_tag</span> <span class=n>iterator_category</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></li></ul><p>è‡³æ­¤ï¼Œiterator_traits çš„åŸºæœ¬å®ç°å°±å®Œæˆäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>iterator_traits&lt;IterT>::iterator_category</code> å¯ä»¥åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œæ¥ä¸‹æ¥çœ‹çœ‹advance å‡½æ•°å¦‚ä½•ä½¿ç”¨å®ƒã€‚</p><p>ğŸ’— æ­£ç¡®åšæ³•ï¼šåˆ©ç”¨ <strong>å‡½æ•°é‡è½½overloading</strong> æŠ€æœ¯ï¼Œä½¿å¾— <strong>trait classes åœ¨ç¼–è¯‘æœŸå¯¹ç±»å‹æ‰§è¡Œ if â€¦ else æµ‹è¯•</strong>ã€‚</p><p>å›é¡¾æˆ‘ä»¬çš„ advance å‡½æ•°ï¼Œåªæœ‰è¿­ä»£å™¨ç±»å‹ IterT å’Œ åç§»é‡ DistT ã€‚å¯ä»¥é‡è½½å…¶å­å‡½æ•° doAdvance ï¼Œå®Œæˆç±»å‹èƒå–åçš„è‡ªé€‚åº”ï¼š</p><div class=highlight id=id-20><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>IterT</span><span class=p>,</span> <span class=k>typename</span> <span class=n>DistT</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>doAdvance</span><span class=p>(</span><span class=n>IterT</span><span class=o>&amp;</span> <span class=n>iter</span><span class=p>,</span> <span class=n>DistT</span> <span class=n>d</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>random_access_iterator_tag</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>iter</span> <span class=o>+=</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>IterT</span><span class=p>,</span> <span class=k>typename</span> <span class=n>DistT</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>doAdvance</span><span class=p>(</span><span class=n>IterT</span><span class=o>&amp;</span> <span class=n>iter</span><span class=p>,</span> <span class=n>DistT</span> <span class=n>d</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>bidirectional_iterator_tag</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>d</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span> <span class=k>while</span> <span class=p>(</span><span class=n>d</span><span class=o>--</span><span class=p>)</span> <span class=o>++</span><span class=n>iter</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span> <span class=k>while</span> <span class=p>(</span><span class=n>d</span><span class=o>++</span><span class=p>)</span> <span class=o>--</span><span class=n>iter</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>IterT</span><span class=p>,</span> <span class=k>typename</span> <span class=n>DistT</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>doAdvance</span><span class=p>(</span><span class=n>IterT</span><span class=o>&amp;</span> <span class=n>iter</span><span class=p>,</span> <span class=n>DistT</span> <span class=n>d</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>input_iterator_tag</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>d</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span><span class=k>throw</span> <span class=n>std</span><span class=o>::</span><span class=n>out_of_range</span><span class=p>(</span><span class=s>&#34;Negative distance&#34;</span><span class=p>);}</span><span class=c1>//ps: msvcä¸­çš„C++å®ç°æ˜¯é‡‡ç”¨ç¼–è¯‘æœŸé—´çš„assetåˆ¤å®š
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>while</span> <span class=p>(</span><span class=n>d</span><span class=o>--</span><span class=p>)</span> <span class=o>++</span><span class=n>iter</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>è‡ªç„¶åœ°ï¼Œadvance å‡½æ•°çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class=highlight id=id-21><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>IterT</span><span class=p>,</span> <span class=k>typename</span> <span class=n>DistT</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span>  <span class=n>advance</span><span class=p>(</span><span class=n>IterT</span><span class=o>&amp;</span> <span class=n>iter</span><span class=p>,</span> <span class=n>DistT</span> <span class=n>d</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>doAdvance</span><span class=p>(</span><span class=n>iter</span><span class=p>,</span><span class=n>d</span><span class=p>,</span> <span class=cm>/*ä¸è®º category çš„tagç±»å‹æ˜¯ä»€ä¹ˆï¼Œé‡è½½èƒ½æ‰¾åˆ°åŒ¹é…å‡½æ•°ã€‚å³ç¼–è¯‘æœŸçš„ if...else æµ‹è¯•*/</span>
</span></span><span class=line><span class=cl>              <span class=k>typename</span> <span class=n>std</span><span class=o>::</span><span class=n>iterator_traits</span><span class=o>&lt;</span><span class=n>IterT</span><span class=o>&gt;::</span><span class=n>iterator_category</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>è‡³æ­¤ï¼Œä¸€ä¸ªå®Œæ•´çš„ (ä»¥ iterator_traits ä¸ºä¾‹)Traits æŠ€æœ¯å®ç°ä¸è¿ç”¨çš„è¿‡ç¨‹å°±å®Œæˆäº†ã€‚</p><div class="details admonition Note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><ul><li><p>å…³äº iterator_traits ï¼Œä¸æ­¢æœ‰ iterator_categoryï¼Œè¿˜æœ‰ difference_type, value_type, pointer, reference ç­‰4ä¸ªæˆå‘˜ï¼Œ<a href=https://zh.cppreference.com/w/cpp/iterator/iterator_traits target=_blank rel="external nofollow noopener noreferrer">è¯¦ç»†å¯å‚è€ƒ cppå‚è€ƒæ‰‹å†Œï¼šiterator_traits<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> ã€‚</p></li><li><p>C++ æ ‡å‡†åº“ä¸­ç±»ä¼¼ iterator_traits åº”ç”¨äº† Traits æŠ€æœ¯çš„æ¨¡æ¿æœ‰åå‡ ä¸ªã€‚</p><p>ä¸¾ä¾‹å¸¸ç”¨çš„æ•°å€¼ç±»å‹èƒå– <code>numeric_limits</code> ï¼Œéœ€è¦æ³¨æ„2ä¸ªç»†èŠ‚ï¼š</p><ol><li>å¤´æ–‡ä»¶æ˜¯ #include<limits>;</li><li>æˆå‘˜å‡½æ•° lowest/min/max æŒ‰ç…§é¡ºåºï¼Œåˆ†åˆ«ä»£è¡¨ç»™å®šç±»å‹çš„ æœ€ä½æœ‰é™å€¼ã€æœ€å°éè´Ÿå€¼ã€æœ€å¤§æœ‰é™å€¼ã€‚å°¤å…¶æ˜¯ float/doubleï¼Œå–æœ€å°å€¼æ˜¯ lowest() ï¼Œä¸æ˜¯ min().</li></ol></li></ul></div></div></div><h3 id=r48-è®¤è¯†templateæ¨¡æ¿å…ƒç¼–ç¨‹>R48 è®¤è¯†Templateæ¨¡æ¿å…ƒç¼–ç¨‹</h3><p><strong>TMPï¼Œæ¨¡æ¿å…ƒç¼–ç¨‹template metaprogramming</strong> ï¼Œæ˜¯ç¼–å†™ template-based C++ ç¨‹åºå¹¶æ‰§è¡Œäºç¼–è¯‘æœŸçš„è¿‡ç¨‹ã€‚TMP è¿‡ç¨‹ç»“æŸåï¼Œè‹¥å¹² C++ æºç ä¼šè¢« templates å…·ç°åŒ–å‡ºæ¥ï¼Œä¾¿ä¼šä¸€å¦‚å¾€å¸¸åœ°è¢«ç¼–è¯‘ã€‚</p><p>TMP æœ‰ 2 ä¸ªå¼ºå¤§çš„ä½œç”¨ï¼š</p><ol><li>å¯ä»¥å®Œæˆé TMP çš„å¸¸è§„ç¼–ç¨‹åšä¸åˆ°çš„äº‹æƒ…
æ¯”å¦‚ä»£ç ç”Ÿæˆï¼Œç±»å‹é€‚é…ç­‰ã€‚</li><li>å¯ä»¥å°†æŸäº›å·¥ä½œä»è¿è¡ŒæœŸè½¬ç§»åˆ°ç¼–è¯‘æœŸ
å¯ä»¥å°†è¿è¡ŒæœŸçš„é”™è¯¯æå‰æš´éœ²åœ¨ç¼–è¯‘æœŸï¼Œå¯ä»¥è·å¾—æ›´å°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ›´å¿«åœ°è¿è¡Œï¼Œæ›´å°‘åœ°å†…å­˜éœ€æ±‚ï¼Œç¼ºç‚¹æ˜¯æ˜æ˜¾å¢åŠ ç¼–è¯‘æ—¶é—´ã€‚</li></ol><p>TMP å·²è¢«è¯æ˜æ˜¯ä¸ªâ€œ<strong>å›¾çµå®Œå¤‡</strong>â€çš„æœºå™¨ï¼Œæ„æ€æ˜¯å®ƒå¼ºå¤§åˆ°å¯ä»¥è®¡ç®—ä»»ä½•äº‹ç‰©ã€‚ä½¿ç”¨ TMP å¯ä»¥å£°æ˜å˜é‡ã€æ‰§è¡Œå¾ªç¯ã€ç¼–å†™åŠè°ƒç”¨å‡½æ•°â€¦ç­‰ç­‰ã€‚</p><p>æ¯”è¾ƒç‰¹åˆ«çš„æ˜¯ï¼ŒTMP å®ç°ä¸Šè¿°å„ç±»åŠŸèƒ½çš„æ–¹å¼ä¸åŒäºå¸¸è§„ C++ ç¨‹åºã€‚æ¯”å¦‚ä¸Šä¸€èŠ‚ Rule47 ä¸­ä½¿ç”¨é‡è½½å®Œæˆäº†ç¼–è¯‘æœŸçš„ ifâ€¦else æ¡ä»¶åˆ†æ”¯ã€‚TMP å¾ªç¯åŠŸèƒ½ä¹Ÿé€šå¸¸ä¼šä½¿ç”¨ â€œ<strong>é€’å½’å…·ç°åŒ–</strong>â€ æ¥å®Œæˆçš„ã€‚</p><p>ä¸‹æ–¹ä»£ç ç¤ºèŒƒå¦‚ä½•ä½¿ç”¨ TMP çš„æ–¹å¼æ¥è®¡ç®—é˜¶ä¹˜ï¼š</p><div class=highlight id=id-22><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=kt>unsigned</span> <span class=n>n</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Factorial</span>
</span></span><span class=line><span class=cl><span class=p>{</span>   <span class=c1>// é€’å½’çš„å½¢å¼ä½“ç°: f(n) = n * f(n -1)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>enum</span> <span class=p>{</span><span class=n>value</span> <span class=o>=</span> <span class=n>n</span><span class=o>*</span> <span class=n>Factorial</span><span class=o>&lt;</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Factorial</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>  <span class=c1>// æ¨¡æ¿å…¨ç‰¹åŒ–: å®é™…æ˜¯åˆå§‹åŒ– f(0) = 1
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>enum</span> <span class=p>{</span><span class=n>value</span> <span class=o>=</span> <span class=mi>1</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>é‚£ä¹ˆé˜¶ä¹˜è®¡ç®—åœ¨ç¼–è¯‘æœŸå°±å®Œæˆäº†ï¼Œè¿è¡Œæ—¶å°±æ˜¯ç›´æ¥å–ç”¨äº†ï¼š</p><div class=highlight id=id-23><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Factorial(&#34;</span> <span class=o>&lt;&lt;</span> <span class=mi>5</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;) = &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>Factorial</span><span class=o>&lt;</span><span class=mi>5</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Factorial(&#34;</span> <span class=o>&lt;&lt;</span> <span class=mi>7</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;) = &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>Factorial</span><span class=o>&lt;</span><span class=mi>7</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><h2 id=ch8-å®šåˆ¶newå’Œdelete>CH8 å®šåˆ¶newå’Œdelete</h2><h3 id=r49-äº†è§£new-handlerçš„è¡Œä¸º>R49 äº†è§£new-handlerçš„è¡Œä¸º</h3><p>å½“ <code>operator new</code> æ— æ³•æ»¡è¶³æŸä¸ªå†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œä¸€èˆ¬ä¼šæŠ›å‡º <code>std::bad_alloc</code> å¼‚å¸¸ã€‚</p><blockquote><p>å¦‚æœç”¨ std::nothrow ä¿®é¥° new æ“ä½œç¬¦ï¼Œä½¿å¾—å†…å­˜åˆ†é…é˜¶æ®µä¸ä¼šæŠ›å¼‚å¸¸ï¼Œå¤±è´¥äº†å°±è¿”å› null æŒ‡é’ˆã€‚ä¸¾ä¾‹ :</p><div class=highlight id=id-24><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kt>int</span> <span class=o>*</span><span class=n>pArr</span> <span class=o>=</span> <span class=k>new</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>nothrow</span><span class=p>)</span> <span class=kt>int</span><span class=p>[</span><span class=mh>0x1fffffff</span><span class=p>];</span> <span class=c1>//å³ä½¿åˆ†é…å¤±è´¥ï¼Œä¹Ÿä¸æŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯å¾—åˆ°nullæŒ‡é’ˆ.
</span></span></span><span class=line><span class=cl><span class=c1>//  nothroow-new ä¸èƒ½ä¿è¯ class åç»­çš„æ„é€ å‡½æ•°ä¸æŠ›å¼‚å¸¸
</span></span></span></code></pre></td></tr></table></div></div></blockquote><p>new-hanlder çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class=highlight id=id-25><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>//å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>OutOfMemTip</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;new memory fail,out of memory!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>abort</span><span class=p>();</span><span class=c1>//ç»ˆæ­¢ç¨‹åºï¼Œè‹¥è°ƒè¯•æ¨¡å¼ä¼šå¼¹çª—æç¤º
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// æ•…æ„åˆ¶é€ newå¤±è´¥çš„æƒ…å½¢ï¼Œç¨‹åºä¼šè°ƒç”¨ OutOfMemTipï¼Œè§¦å‘std::abort()
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>set_new_handler</span><span class=p>(</span><span class=n>OutOfMemTip</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=o>*</span><span class=n>pArr</span> <span class=o>=</span>  <span class=k>new</span> <span class=kt>int</span><span class=p>[</span><span class=mh>0x1fffffff</span><span class=p>];</span><span class=c1>//çº¦2GB,å¦‚æœæ‰›çš„ä½ï¼Œè°ƒå¤§è¿™ä¸ªæ•°
</span></span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹å‡ºè¿™æ ·çš„å‡½æ•°æŒ‡é’ˆç»™äº†ä½¿ç”¨è€…éå¸¸å¤§çš„è®¾è®¡å¼¹æ€§ï¼Œå¯ä»¥åšåˆ°ä»¥ä¸‹äº‹æƒ…ï¼š</p><ul><li>æå‰ç”³è¯·å†…å­˜ï¼Œè®© new_handler è§¦å‘ä¸‹ä¸€æ¬¡åˆ†é…ä½¿ç”¨ï¼›</li><li>å®‰è£…å¦ä¸€ä¸ª new_handler ï¼Œæˆ–è®¸æ–°çš„ handler å¯ä»¥ç”³è¯·åˆ°å†…å­˜ï¼›</li><li>å¸è½½ new_handler ï¼Œåªè¦ä¼  null æŒ‡é’ˆå³å¯ï¼›</li><li>æ‰‹åŠ¨æŠ› std::bad_alloc çš„å¼‚å¸¸ï¼›</li><li>ä¸è¿”å›ï¼Œé€šå¸¸è°ƒç”¨ std::abort() æˆ– std::exit() ;</li></ul><p>ğŸ¤” æˆ‘ä»¬æ€è€ƒå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šæ˜¯å¦å¯ä»¥ è®©ä¸åŒçš„ <strong>C++ ç±»æ‹¥æœ‰è‡ªå·±çš„ new-handler</strong> å‘¢ï¼Ÿ C++ æ ‡å‡†æœºåˆ¶æ˜¯ä¸æ”¯æŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°ã€‚æœ‰ä¸¤ä¸ªå®ç°é€”å¾„ï¼Œåˆ—ä¸¾å¦‚ä¸‹ï¼š</p><ol><li><strong>é’ˆå¯¹æŸä¸ªç‰¹å®šç±» ï¼Œç±»å†…é‡è½½ static ç±»å‹çš„ <code>operator new</code> ä»¥åŠ <code>set_new_handler</code>æ–¹æ³•</strong>
å…·ä½“å®ç°ç•¥ï¼Œåªæƒ³æŒ‡å‡ºè¿™æ ·åšæ³•æœ‰ä¸ªæ˜æ˜¾å¼Šç«¯ï¼Œå°±æ˜¯æ¯ä¸ªç±»éƒ½å¾—è¿™ä¹ˆåšï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œä¹Ÿå®¹æ˜“ä»£ç å†—ä½™ã€‚</li><li><strong>ä½¿ç”¨ CRTP æ–¹æ³•ï¼ˆå³ <code>æ€ªå¼‚çš„å¾ªç¯æ¨¡æ¿æ¨¡å¼curiously recurring template pattern</code> ï¼‰å°†ä¸Šè¿°æ–¹æ³• 1 å¡è¿› template ç±»</strong>
è¿™æ ·åšçš„å¥½å¤„æ˜¯ä½¿ç”¨æ¨¡æ¿ç±»èµ‹äºˆä¸Šè¿° operator new å’Œ set_new_hanler çš„æ“ä½œï¼Œä½¿ç”¨èµ·æ¥æ–¹ä¾¿ã€‚
CRTP æ–¹æ³•ä¸­çš„åŸºç±» NewHandlerSupport å®ç°å¦‚ä¸‹ ğŸ‘‡(ç‚¹å‡»æ‰“å¼€æŠ˜å ) ï¼š</li></ol><div class=highlight id=id-26><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>NewHandlerSupport</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>new_handler</span> <span class=n>set_new_handler</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>new_handler</span> <span class=n>p</span><span class=p>)</span><span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>new_handler</span> <span class=n>oldHandler</span> <span class=o>=</span> <span class=n>currentHandler_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>currentHandler_</span> <span class=o>=</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>oldHandler</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>void</span><span class=o>*</span> <span class=k>operator</span> <span class=nf>new</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>)</span> <span class=k>throw</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>bad_alloc</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>new_handler</span> <span class=n>oldHandle</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>set_new_handler</span><span class=p>(</span><span class=n>currentHandler_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>void</span> <span class=o>*</span><span class=n>res</span> <span class=o>=</span> <span class=o>::</span><span class=k>operator</span> <span class=k>new</span><span class=p>(</span><span class=n>size</span><span class=p>);</span> <span class=c1>//newå®Œåå¤åŸglobal-new-handler
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>std</span><span class=o>::</span><span class=n>set_new_handler</span><span class=p>(</span><span class=n>oldHandle</span><span class=p>);</span><span class=c1>//åŸä¹¦ä½¿ç”¨RAIIæ‰‹æ³•åœ¨è¿˜åŸè¿™ä¸ªhandlerï¼Œè¿™é‡Œä½œç”¨ç±»ä¼¼
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>new_handler</span> <span class=n>currentHandler_</span><span class=p>;</span><span class=c1>//åˆå§‹åŒ–åŠ¨ä½œæ”¾åˆ°ç±»å¤–cppæ–‡ä»¶é‡Œå»
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>é‚£ä¹ˆç›®æ ‡ç±» <code>TestNewHandler</code> åªè¦åŸºäº <code>CRTP</code> æ–¹æ³•ç»§æ‰¿äºåŸºç±»å°±å¯ä»¥äº†ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><div class=highlight id=id-27><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>class</span> <span class=nc>TestNewHandler</span> <span class=o>:</span> <span class=k>public</span> <span class=n>NewHandlerSupport</span><span class=o>&lt;</span><span class=n>TestNewHandler</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//ä¸å¿…å£°æ˜ set_new_handler æˆ– operator new
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>//æœ€ç»ˆåº”ç”¨æ—¶ä¹Ÿéå¸¸ç®€å•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>TestNewHandler</span><span class=o>::</span><span class=n>set_new_handler</span><span class=p>(</span><span class=n>OutOfMemTip</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>TestNewHandler</span><span class=o>*</span> <span class=n>pTestHandle</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TestNewHandler</span><span class=p>();</span></span></span></code></pre></td></tr></table></div></div><h3 id=r50-äº†è§£newå’Œdeleteçš„åˆç†æ›¿æ¢æ—¶æœº>R50 äº†è§£newå’Œdeleteçš„åˆç†æ›¿æ¢æ—¶æœº</h3><p>æ›¿æ¢ç¼–è¯‘å™¨æä¾›çš„ <code>operator new</code> å’Œ <code>operator delete</code> çš„ å¸¸è§ç†ç”± å¦‚ä¸‹ï¼š</p><ol><li><p><strong>æ£€æµ‹è¿ç”¨ä¸Šçš„é”™è¯¯</strong>
è‡ªå®šä¹‰çš„new/deleteå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ ¡éªŒå®é™…æ§åˆ¶çš„åŒºæ®µå†…å­˜ï¼Œæ¯”å¦‚å¯ä»¥åœ¨ç›®æ ‡åŒºå—å‰åé¢å¤–ç©ºé—´æ·»åŠ å†…å­˜ç­¾å(æ¯”å¦‚å†™å…¥ç‰¹å®š int å€¼)ï¼Œç›‘æµ‹è¶Šç•Œçš„é—®é¢˜ã€‚
è¶Šç•Œåˆ†2ç§ï¼šunderruns (åŒºå—å†…å­˜èµ·ç‚¹ä¹‹å‰) å’Œ overruns (åŒºå—å†…å­˜æœ«å°¾ä¹‹å)ã€‚</p></li><li><p><strong>æ—¶é—´æˆ–å†…å­˜ä½¿ç”¨çš„ä¼˜åŒ–</strong>
é€šç”¨çš„ new/delete éœ€è¦é€‚ç”¨å„ç§åˆ†é…å½¢æ€å’Œåœºæ™¯ï¼Œå¯¹äºå†…å­˜ç¢ç‰‡æˆ–æ—¶é—´æ€§èƒ½éƒ½æ˜¯ä¸­åº¸æ°´å¹³ã€‚
å¯¹ç‰¹å®šçš„éœ€æ±‚å’Œåœºæ™¯ï¼Œå®šåˆ¶åŒ–åœ°å†…å­˜ç®¡ç†ä¼šæœ‰å¾ˆå¥½çš„ä¼˜åŒ–æ•ˆæœã€‚</p></li><li><p><strong>æ”¶é›†å†…å­˜ä½¿ç”¨çš„ç»Ÿè®¡æ•°æ®</strong>
å¯¹å†…å­˜åˆ†é…ç»†èŠ‚çš„æŠŠæ§ï¼Œä¾‹å¦‚åˆ†é…åŒºå—çš„å¤§å°åˆ†å¸ƒã€å­˜ç»­å‘¨æœŸã€FIFO/LIFOæ¬¡åºåˆ†é…å›æ”¶ã€å†…å­˜å³°å€¼ç­‰æƒ…å†µã€‚</p></li><li><p><strong>å¼¥è¡¥é»˜è®¤å†…å­˜åˆ†é…å™¨çš„ éæœ€ä½³å¯¹é½ä½suboptimal alignment</strong>
ä¾‹å¦‚x86ä½“ç³»ç»“æ„CPUä¸Šè®¿é—®doubleéƒ½æ˜¯8byteså¯¹é½ï¼Œå¦‚æœèƒ½åœ¨å†…å­˜åˆ†é…æ—¶å°±åšå¥½å†…å­˜å¯¹é½ï¼Œå¯æå‡è®¿é—®æ•ˆç‡ã€‚</p></li><li><p><strong>å°†ç›¸å…³å¯¹è±¡æˆç°‡é›†ä¸­</strong>
æ¯”å¦‚å·²çŸ¥æŸä¸ªæ•°æ®ç»“æ„å¾€å¾€ä¸€èµ·ä½¿ç”¨ï¼Œé‚£ä¹ˆåˆ†é…çš„æ—¶å€™åº”è¯¥å°½é‡è®©æ‰€æœ‰æ•°æ®çš„å†…å­˜é›†ä¸­ä¸€äº›ï¼Œé¿å…é¢‘ç¹è§¦å‘ æ¢é¡µä¸­æ–­page faults ï¼Œæå‡è®¿é—®æ•ˆç‡ã€‚</p></li><li><p><strong>å…¶ä»–çš„éä¼ ç»Ÿè¡Œä¸º</strong>
æƒ³å®Œæˆä¸€äº›ç³»ç»Ÿç¼–è¯‘å™¨åŠä¸åˆ°çš„äº‹æƒ…ã€‚æ¯”å¦‚å¸Œæœ›åˆ†é…é‡Šæ”¾å…±äº«å†…å­˜çš„åŒºå—ï¼Œä½†æ˜¯åªæœ‰ C-API èƒ½åšåˆ°ï¼Œé‚£å°±éœ€è¦å®šåˆ¶ç‰ˆçš„ new/delete å»åŒ…è£¹å°è£…è¿™æ ·çš„APIã€‚</p></li></ol><h3 id=r51-ç¼–å†™newå’Œdeleteæ—¶éœ€å›ºå®ˆå¸¸è§„>R51 ç¼–å†™newå’Œdeleteæ—¶éœ€å›ºå®ˆå¸¸è§„</h3><p>ä¸Šä¸€ä¸ªæ¡æ¬¾è®²äº†é‡å†™ new/delete çš„åŸå› ï¼Œè¿™ä¸€èŠ‚å°†è®²è¿°å…·ä½“éœ€è¦éµå®ˆçš„å‡ ä¸ªè§„åˆ™ã€‚</p><ol><li><p><strong>æ­£ç¡®å¤„ç† new å¤±è´¥çš„æƒ…å†µ</strong>
å¦‚æœåˆ†é…æ­£å¸¸ï¼Œç›´æ¥è¿”å›åŒºå—å¯¹åº”çš„æŒ‡é’ˆå³å¯ã€‚å¯å¦‚æœå¤±è´¥ï¼Œå°±å¿…é¡»å¾—æ­£ç¡®è°ƒç”¨ new-handler å‡½æ•°ï¼Œå‚è€ƒ R49 äº†è§£new-handlerçš„è¡Œä¸ºã€‚</p></li><li><p><strong>å¦‚æœè¦æ±‚åˆ†é… 0 byte ç©ºé—´</strong>
C++è§„å®šï¼Œå¦‚æœå®¢æˆ·è¦æ±‚åˆ†é… 0 byte å†…å­˜ç”³è¯·ï¼Œå°±è¿”å› 1byte ç©ºé—´ç”³è¯·ï¼Œå¹¶è¿”å›è¯¥æœ‰æ•ˆåœ°å€ã€‚</p></li><li><p><strong>ç†è§£ operator new å†…éƒ¨çš„æ— ç©·å¾ªç¯</strong>
operator new æœ‰ä¸ª while(true) å¾ªç¯ï¼Œåˆ†é…æˆåŠŸå¯ä»¥returnï¼Œæˆ–ç”± new-handler ä¸º nullptr æ—¶æŠ›å‡º std::bad_alloc å¼‚å¸¸ã€‚ä¼ªä»£ç pseudocode å¦‚ä¸‹ï¼š</p></li></ol><div class=highlight id=id-28><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kt>void</span><span class=o>*</span> <span class=k>operator</span> <span class=nf>new</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>)</span> <span class=k>throw</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>bad_alloc</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>size</span> <span class=o>==</span> <span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>      <span class=n>size</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=nb>true</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=err>å°è¯•åˆ†é…</span> <span class=n>size</span> <span class=n>bytes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=err>åˆ†é…æˆåŠŸ</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>  <span class=n>target_pointer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>new_handler</span> <span class=n>globalHandler</span> <span class=o>=</span> <span class=n>set_new_handler</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>set_new_handler</span><span class=p>(</span><span class=n>globalHandler</span><span class=p>);</span><span class=c1>//åˆ†é…å¤±è´¥äº†
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>globalHandler</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=n>globalHanler</span><span class=p>)();</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>throw</span> <span class=n>std</span><span class=o>::</span><span class=n>bad_alloc</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ol start=4><li><strong>å½“åŸºç±»çš„ operator new è¢«å­ç±»ç»§æ‰¿æ—¶</strong>
å½“åŸºç±»è¢«ç»§æ‰¿æ—¶ï¼Œæˆå‘˜ operator new ä¹Ÿä¸€èµ·è¢«ç»§æ‰¿äº†ï¼Œè¦æ³¨æ„çš„æ˜¯åŸºç±»å’Œå­ç±»çš„ size é€šå¸¸æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¨èå®ç°å¦‚ä¸‹ï¼š</li></ol><div class=highlight id=id-29><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>void</span><span class=o>*</span> <span class=k>operator</span> <span class=k>new</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>)</span><span class=k>throw</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>bad_alloc</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>size</span> <span class=o>!=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>Base</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=o>::</span><span class=k>operator</span> <span class=k>new</span><span class=p>(</span><span class=n>size</span><span class=p>);</span><span class=c1>//å­ç±»èµ°è¿™é‡Œ
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>operator new[] ä¸èƒ½è¿™æ ·åœ¨åŸºç±»ä¸­åŒºåˆ†</strong>ã€‚å› ä¸ºå³ä½¿åœ¨Baseç±»ï¼Œä¹Ÿæ— æ³•å‡å®šæ¯ä¸ªå…ƒç´ æ˜¯ sizeof(Base)ï¼Œé€šå¸¸è¿˜æœ‰é¢å¤–å†…å­˜ç©ºé—´æ¥ä¿å­˜å…ƒç´ ä¸ªæ•°ã€‚</p><ol start=5><li>operator delete çš„æ³¨æ„äº‹é¡¹
C++ éœ€è¦ä¿è¯ â€œ<code>åˆ é™¤NULLæŒ‡é’ˆæ°¸è¿œå®‰å…¨</code>â€ï¼Œæ‰€ä»¥å¿…é¡»å…‘ç°è¿™ä¸ªè§„åˆ™ã€‚é’ˆå¯¹nullæŒ‡é’ˆï¼Œå°±ä»€ä¹ˆä¹Ÿä¸åšï¼Œç›´æ¥returnã€‚</li></ol><h3 id=r52-å†™äº†placement-new-ä¹Ÿè¦å†™placement-delete>R52 å†™äº†placement-new ä¹Ÿè¦å†™placement-delete</h3><p>placement-newï¼Œæ˜¯æŒ‡â€œ<code>é™¤sizeå‚æ•°ä»¥å¤–ï¼Œæ¥å—ä¸€ä¸ªé¢å¤–å‚æ•°å‚ä¸æ„é€ </code>â€çš„ ç‰¹å®š operator-newã€‚</p><p>å…¶ä¸­ï¼Œâ€œ<code>æ¥å—ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¯¹è±¡è¯¥è¢«æ„é€ ä¹‹å¤„</code>â€æ˜¯<strong>æœ€å¸¸ä½¿ç”¨</strong>çš„ placement-newï¼Œå³â€œ<code>ä¸€ä¸ªç‰¹å®šä½ç½®ä¸Šçš„new</code>â€ï¼Œå½¢å¼å¦‚ä¸‹ä¸ºï¼š</p><div class=highlight id=id-30><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>//è¿™ä¸ªç‰¹æ®Šçš„ä¹Ÿæ˜¯æœ€å¸¸æ¶‰åŠçš„ placement-new å·²è¢«çº³å…¥C++æ ‡å‡†ç¨‹åºåº“
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=o>*</span> <span class=k>operator</span> <span class=nf>new</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>,</span><span class=kt>void</span><span class=o>*</span> <span class=n>pMemory</span><span class=p>)</span> <span class=k>noexcept</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>å…ˆæš‚æ—¶è€ƒè™‘ä¸€ä¸ªè°ƒç”¨äº†placement-newçš„æ­£å¸¸æ„é€ è¿‡ç¨‹ï¼š</p><div class=highlight id=id-31><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// æœ‰è¿™æ ·ä¸€ä¸ªplacement-new,æ¥æ”¶ä¸€ä¸ªostreamæ¥logåˆ†é…æ—¶çš„ç›¸å…³ä¿¡æ¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span><span class=o>*</span> <span class=k>operator</span> <span class=nf>new</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>logStream</span><span class=p>)</span> <span class=k>throw</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>bad_alloc</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Widget</span><span class=o>*</span> <span class=n>pw</span> <span class=o>=</span> <span class=k>new</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>cerr</span><span class=p>)</span> <span class=n>Widget</span><span class=p>;</span><span class=c1>//ä¼ å…¥ostream
</span></span></span></code></pre></td></tr></table></div></div><p>å¯¹äºä»»ä½•çš„newå¯¹è±¡æ„é€ è¿‡ç¨‹ï¼Œè‡³å°‘å¯åˆ†ä¸ºä¸‹è¿°2ä¸ªè¿‡ç¨‹ï¼š</p><ol><li>operator new åˆ†é…å¯¹è±¡éœ€è¦çš„å†…å­˜ç©ºé—´ï¼›</li><li>æ‰§è¡Œå¯¹åº”çš„æ„é€ å‡½æ•°
å¦‚æœä¸Šè¿°è¿‡ç¨‹ 1 æˆåŠŸäº†ï¼Œè¿‡ç¨‹ 2 æŠ›å¼‚å¸¸ï¼Œå·²ç»ç”³è¯·çš„å†…å­˜å°±éœ€è¦åŠæ—¶å›æ”¶é¿å…memory-leakï¼Œè¿è¡ŒæœŸç³»ç»Ÿå°±ä¼šå°è¯•å¯»æ‰¾å¹¶è°ƒç”¨â€œ<strong>é¢å¤–å‚æ•°ä¸ªæ•°å’Œç±»å‹éƒ½ä¸operator new ä¸€è‡´çš„operator delete</strong>â€ï¼Œå®Œæˆå†…å­˜å›æ”¶ã€‚</li></ol><p>é‚£ä¹ˆä¸Šè¿°äº‹å®ï¼Œå°±æ˜¯ placement-new å’Œ placement-delete éœ€è¦<strong>æˆå¯¹å®ç°çš„ç†ç”±</strong>ã€‚</p><p>é’ˆå¯¹ä¸Šä¾‹é¢å¤–å‚æ•°æ˜¯ std::ostream çš„operator newï¼Œoperator deleteï¼Œç±»å£°æ˜å½¢å¼å¦‚ä¸‹:</p><div class=highlight id=id-32><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>class</span> <span class=nc>Widget</span><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>void</span><span class=o>*</span> <span class=k>operator</span> <span class=k>new</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>logStream</span><span class=p>)</span> <span class=k>throw</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>bad_alloc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>//ä¸æŠ›å¼‚å¸¸æ—¶ï¼Œæœ€åå¯¹è±¡ææ„æ—¶æ­£å¸¸è°ƒç”¨è¿™ä¸ª
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>static</span> <span class=kt>void</span> <span class=k>operator</span> <span class=nf>delete</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>pMemory</span><span class=p>)</span> <span class=k>noexcept</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>//newæŠ›å¼‚å¸¸æ—¶ï¼Œè°ƒç”¨è¿™ä¸ª é¢å¤–å‚æ•°ä¸ªæ•°å’Œç±»å‹éƒ½ä¸€è‡´çš„ placement-delete
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>static</span> <span class=kt>void</span> <span class=k>operator</span> <span class=nf>delete</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>pMemory</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>logStream</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>âš ï¸ <strong>One More Thing</strong> : C++ åœ¨global ä½œç”¨åŸŸæä¾›ä»¥ä¸‹å½¢å¼çš„ operator new:</p><div class=highlight id=id-33><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kt>void</span> <span class=o>*</span> <span class=k>operator</span> <span class=nf>new</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>)</span> <span class=k>throw</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>bad_alloc</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=o>*</span> <span class=k>operator</span> <span class=nf>new</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>,</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span> <span class=k>noexcept</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=o>*</span> <span class=k>operator</span> <span class=nf>new</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>,</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>nothrow_t</span> <span class=o>&amp;</span><span class=p>)</span> <span class=k>noexcept</span><span class=p>;</span><span class=c1>//è§æ¡æ¬¾49 new-Handlerçš„è¡Œä¸º
</span></span></span></code></pre></td></tr></table></div></div><p>ğŸ˜ æ‰€ä»¥ï¼Œå¦‚æœåœ¨class å†…å£°æ˜äº†ä¸Šè¿° operator newï¼Œ åˆ™globalä½œç”¨åŸŸçš„ operator new ä¼šè¢«<code>åç§°é®æ©</code>ã€‚</p><p>ğŸ¤” <code>è§£å†³åŠæ³•</code>ï¼šåœ¨åŸºç±»å¯¹globalä½œç”¨åŸŸçš„ ::operator new è¿›è¡Œå°è£…è°ƒç”¨ï¼Œç„¶ååœ¨å­ç±»ä¸­ä½¿ç”¨using å£°æ˜å¼ç ´é™¤åç§°é®æ©ã€‚</p><h2 id=ch9-æ‚é¡¹è®¨è®º>CH9 æ‚é¡¹è®¨è®º</h2><h3 id=r53-ä¸è¦è½»æ˜“å¿½ç•¥ç¼–è¯‘å™¨çš„è­¦å‘Š>R53 ä¸è¦è½»æ˜“å¿½ç•¥ç¼–è¯‘å™¨çš„è­¦å‘Š</h3><ul><li><p><strong>ä¸¥è‚ƒå¯¹å¾…ç¼–è¯‘å™¨å‘å‡ºçš„è­¦å‘Šä¿¡æ¯</strong>
ç¼–è¯‘å™¨å‘å‡ºçš„è­¦å‘Šä¿¡æ¯ï¼Œç»å¸¸ä¼šè¢«å¿½ç•¥ã€‚No-Warningæ˜¯å€¼å¾—è¿½å´‡çš„ï¼Œé™¤éä½ å¯¹ç¼–è¯‘ warning ä¿¡æ¯æ˜¯å……åˆ†äº†è§£å¹¶ç¡®ä¿¡æ˜¯æ— å…³ç´§è¦çš„ã€‚</p><p>ä¸‹é¢ä¸¾ä¸€ä¸ªè¾ƒä¸ºå¸¸è§çš„ä¾‹å­ï¼š</p><div class=highlight id=id-34><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>class</span> <span class=nc>BaseWarn</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>GetWarnInfo</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=s>&#34;Base&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DerivedWarn</span> <span class=o>:</span><span class=k>public</span> <span class=n>BaseWarn</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>GetWarnInfo</span><span class=p>()</span>  <span class=p>{</span><span class=c1>//ç¼ºäº†const
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>return</span> <span class=s>&#34;Derived&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œæ²¡æœ‰æˆåŠŸå®ç°è™šå‡½æ•°é‡å†™ï¼Œè€Œæ˜¯é€ æˆäº†â€œ<strong>åç§°é®æ©</strong>â€ã€‚
è¿™æ ·çš„é”™è¯¯è¾ƒä¸ºéšè”½ï¼Œæœ‰äº›ç¼–è¯‘å™¨ä¼šç»™å‡ºè­¦å‘Šä¿¡æ¯ï¼Œæœ‰äº›ç”šè‡³è¿è­¦å‘Šä¿¡æ¯éƒ½æ²¡æœ‰ï¼ˆPsï¼šæˆ‘è‡ªè¡Œæµ‹è¯•äº†VS2017ï¼Œæ²¡æœ‰warningä¿¡æ¯ï¼‰ã€‚
<code>å¦‚æœç¼–è¯‘å™¨ç»™å‡ºäº†è­¦å‘Šä¿¡æ¯ï¼Œè¯·è®¤çœŸå¯¹å¾…</code>ã€‚</p></li><li><p><strong>ä¸è¦è¿‡åº¦ä¾èµ–ç¼–è¯‘å™¨çš„æŠ¥è­¦èƒ½åŠ›</strong>
è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œä¸åŒç¼–è¯‘å™¨å¤„ç†æ€åº¦ä¸åŒï¼Œè­¦å‘Šä¿¡æ¯ç”šè‡³å¯èƒ½æ¢ä¸ªç¼–è¯‘å™¨å°±æ¶ˆå¤±äº†ã€‚</p></li></ul><h3 id=r54-ç†Ÿæ‚‰åŒ…æ‹¬tr1åœ¨å†…çš„æ ‡å‡†ç¨‹åºåº“>R54 ç†Ÿæ‚‰åŒ…æ‹¬TR1åœ¨å†…çš„æ ‡å‡†ç¨‹åºåº“</h3><p><strong>C++ Technical Report 1 (TR1)</strong> å¹¶éæ ‡å‡†ï¼Œè€Œæ˜¯ä¸€ä»½è‰ç¨¿æ–‡ä»¶ï¼Œå¯¹C++æ ‡å‡†åº“çš„ç¬¬ä¸€æ¬¡æ‰©å±•ï¼Œå®ƒæå‡ºäº†å¯¹C++æ ‡å‡†å‡½å¼åº“çš„è¿½åŠ é¡¹ç›®ã€‚</p><p>è¿™ä»½æ–‡ä»¶çš„ç›®æ ‡åœ¨äºã€Œä¸ºæ‰©å……çš„C++æ ‡å‡†å‡½å¼åº“å»ºç«‹æ›´ä¸ºå¹¿æ³›çš„ç°å®ä½œå“ã€ã€‚</p><blockquote><p><code>æˆ‘çš„ç†è§£</code>ï¼š200x å¹´å‘å¸ƒçš„ C++ ç§°ä¸º â€œC++0xâ€ï¼ŒæŒç»­ä¿®æ”¹ä¸­ï¼Œæ‰€æœ‰ä¿®æ”¹å°†åˆå¹¶äº TR1ï¼Œæœ€ç»ˆç»å¤§éƒ¨åˆ†éƒ½å®šç‰ˆã€æ”¶å½•å‘å¸ƒäº <strong>C++11</strong>ã€‚</p></blockquote><p>TR1è¯¦ç»†å™è¿°äº†è®¸å¤šæ–°ç‰¹æ€§ï¼Œéƒ½æ”¾åœ¨ <code>std::tr1</code> å‘½åç©ºé—´å†…ï¼ˆä»¥ä¸‹ç®€ç§° <code>tr1::</code> ï¼‰ï¼Œåˆ—ä¸¾å¦‚ä¸‹</p><ol><li><code>æ™ºèƒ½æŒ‡é’ˆ</code>ï¼štr1::shared_ptr å’Œ tr1::weak_ptr ï¼ŒRAII åŸºç¡€ï¼Œä¸èµ˜è¿°ï¼›</li><li><code>tr1::function</code>ï¼šè¡¨ç¤º å¯è°ƒç”¨ç‰©callable entityï¼Œå³ä»»ä½•å‡½æ•°æˆ–å‡½æ•°å¯¹è±¡ï¼Œåªè¦ç­¾åä¸€è‡´å³å¯ï¼›</li><li><code>tr1::bind</code>ï¼šå¯¹å‡½æ•°è°ƒç”¨çš„å°è£…ï¼Œå°†å‡½æ•°å’Œå…¶å‚æ•°ç»‘å®šä¸€èµ·ï¼›</li><li><code>Hash tables</code>ï¼šé‡‡å“ˆå¸Œè¡¨å½¢å¼å‚ä¸æ„æˆï¼Œåç§°ä»¥ unordered_ å¼€å¤´çš„ set/multiset/map/multimapï¼›</li><li><code>æ­£åˆ™è¡¨è¾¾å¼</code>ï¼šå¤´æ–‡ä»¶åœ¨ <regrex>ï¼›</li><li><code>Tuple å…ƒç»„(æˆ–å«å˜é‡ç»„)</code>ï¼šä¸å®šé•¿å˜é‡ç»„ï¼Œæ˜¯ std::pair çš„ä¸€ç§æ³›åŒ–ï¼›</li><li><code>tr1::array</code>: å’Œ C è¯­è¨€æ•°ç»„ä¸€æ ·ï¼Œæ˜¯ä¸ªå®šé•¿æ•°ç»„ï¼ŒåŒ…è£¹äº† STL ç”¨æ³•ï¼›</li><li><code>tr1::mem_fn</code>: ä¼ å…¥ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ˆæ”¯æŒå¯¹æˆå‘˜å‡½æ•°å–å€ï¼‰ä½œä¸ºå…¥å‚ï¼Œæ„é€ ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œè¿›è€Œè°ƒç”¨ï¼Œç±»ä¼¼åœ°è¿˜æœ‰ mem_fn_ref;</li><li><code>tr1::reference_wrapper</code>ï¼šâ€œå°è£…å¼•ç”¨ä¸ºä¸€ä¸ªå¯¹è±¡â€ï¼Œé€šå¸¸ç”¨äºå¯¹å¼•ç”¨è¿›è¡Œå°è£…ç„¶åè£…å…¥æ ‡å‡†å®¹å™¨(ç›´æ¥å¾€å®¹å™¨å¡å¼•ç”¨æ˜¯ä¸è¡Œçš„)ï¼›</li><li><code>éšæœºæ•°ç”Ÿæˆå·¥å…·</code>ï¼šrandom_deviceï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆæˆ–è€…ä½¿ç”¨ä¸åŒçš„ éšæœºæ•°å¼•æ“ å’Œ éšæœºåˆ†å¸ƒç®—æ³•è¿›è¡Œç”Ÿæˆï¼Œå¤´æ–‡ä»¶æ˜¯ <random>ï¼›</li><li><code>æ•°å­¦ç‰¹æ®Šå‡½æ•°</code>ï¼šåŒ…æ‹¬Laguerreå¤šé¡¹å¼ã€Bessel å‡½æ•°ã€å®Œå…¨æ¤­åœ†ç§¯åˆ†ç­‰ç‰¹æ®Šæ•°å­¦å‡½æ•°ï¼Œæ³¨æ„ï¼Œè¿™äº› åœ¨ C++17 æ‰å¼•å…¥C++æ ‡å‡†ï¼Œå¯å‚è€ƒcppreference: special math ï¼Œå¤´æ–‡ä»¶åœ¨ <cmath>ï¼›</li><li><code>C99å…¼å®¹æ‰©å……</code> ï¼šC99æ ‡å‡†æ˜¯Cè¯­è¨€çš„å®˜æ–¹æ ‡å‡†ç¬¬äºŒç‰ˆï¼Œ1999å¹´å‘å¸ƒï¼ŒTR1å¯¹å…¶è¿›è¡Œäº†å…¼å®¹ï¼›</li><li><code>Type traits ç±»å‹èƒå–</code>ï¼štemplateç¼–ç¨‹çš„ç²¾åä¹‹ä¸€ï¼Œå‚è€ƒ Rule47:ä½¿ç”¨traitè¡¨ç°ç±»å‹ä¿¡æ¯ï¼Œå¤´æ–‡ä»¶ä¸º &lt;type_traits>ï¼ŒåŠŸèƒ½ååˆ†ä¸°å¯Œï¼Œå¯å‚è€ƒcppreference: type_traitsï¼›</li><li><code>tr1::result_of</code> ï¼šå¯ä»¥å¯¹å‡½æ•°è¿”å›å€¼åšæ¨æ–­ï¼Œå¾—åˆ°è¿”å›å€¼ç±»å‹ï¼Œå¤´æ–‡ä»¶ä¸º &lt;type_traits> ï¼Œç¤ºä¾‹ç”¨æ³•å¦‚ä¸‹ï¼š
<code>c++ // å‡è®¾æœ‰ä¸ªå‡½æ•° double calcDaySale(int); std::tr1::result_of&lt;calcDaySale(int)>::type x = 3.14;//xå°±æ˜¯doubleç±»å‹. C++11ä¸­ç›´æ¥ std::result_of </code>æ›´è¯¦ç»†çš„å®šç‰ˆTR1ä¿¡æ¯å¯ä»¥å‚è€ƒ<a href=https://aristeia.com/EC3E/TR1_info.html target=_blank rel="external nofollow noopener noreferrer">Effective-C++ï¼šTR1 information<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>ã€‚</li></ol><h3 id=r55-è®©è‡ªå·±ç†Ÿæ‚‰boost>R55 è®©è‡ªå·±ç†Ÿæ‚‰Boost</h3><p>Boostæ˜¯ä¸€ä¸ªC++å¼€å‘è€…é›†ç»“çš„ç¤¾ç¾¤ï¼Œä¹Ÿæ˜¯ä¸ªå¯è‡ªç”±ä¸‹è½½çš„ç¨‹åºåº“é›†ï¼Œç½‘å€æ˜¯ <code>http://boost.org</code>ã€‚</p><p><strong>å…¶ç‰¹æ®Šæ€§</strong>ï¼šå’ŒC++æ ‡å‡†å§”å‘˜ä¼šæœ‰ç€ç‹¬ä¸€æ— äºŒçš„å¯†åˆ‡å…³ç³»ï¼Œä¸”å…·æœ‰å¾ˆæ·±å½±å“åŠ›ï¼›æ¥çº³ç¨‹åºåº“éå¸¸ä¸¥è°¨ï¼Œéœ€è¦ä¸€æ¬¡ä»¥ä¸Šçš„åŒè¡Œä¸“å®¶è¯„å®¡ã€‚</p><p>Boost ç¨‹åºåº“é›†å¯å¤„ç†çš„åœºæ™¯æœ‰è®¸å¤šï¼ˆä¸”<strong>å›Šæ‹¬äº†TR1</strong>çš„å®ç°ï¼‰ï¼Œå¯åŒºåˆ†å‡ºæ•°åä¸ªç±»åˆ«ï¼Œå¹¶ä¸”è¿˜åœ¨æŒç»­å¢åŠ ï¼Œ<strong>åˆ—ä¸¾ä¸€å°éƒ¨åˆ†</strong>å¦‚ä¸‹ï¼š</p><ul><li><strong>å­—ç¬¦ä¸²ä¸æ–‡æœ¬å¤„ç†</strong></li><li><strong>å®¹å™¨</strong></li><li><strong>å‡½æ•°å¯¹è±¡ä¸é«˜çº§ç¼–ç¨‹</strong></li><li><strong>æ³›å‹ç¼–ç¨‹</strong>ï¼šè¦†ç›–ä¸€å¤§ç»„ traits classes</li><li><strong>æ¨¡æ¿å…ƒç¼–ç¨‹</strong>ï¼šè¦†ç›–ä¸€ä¸ªé’ˆå¯¹ç¼–è¯‘å™¨ assertions è€Œå†™çš„ç¨‹åºåº“ï¼Œä»¥åŠ Boost MPLç¨‹åºåº“</li><li><strong>æ•°å­¦å’Œæ•°å€¼</strong>:åŒ…æ‹¬æœ‰ç†æ•°ã€å…«å…ƒæ•°ã€å››å…ƒæ•°ã€å…¬çº¦æ•°ã€å¤šé‡è¿ç®—ã€éšæœºæ•°ç­‰ç­‰</li><li><strong>æ­£ç¡®æ€§ä¸æµ‹è¯•æ€§</strong></li><li><strong>æ•°æ®ç»“æ„</strong></li><li><strong>è¯­è¨€é—´çš„æ”¯æŒ</strong>ï¼šå…è®¸ C++ å’Œ Python ä¹‹é—´çš„æ— ç¼äº’è”</li><li><strong>å†…å­˜</strong>ï¼šè¦†ç›–Poolç¨‹åºåº“å’Œæ™ºèƒ½æŒ‡é’ˆç­‰</li><li><strong>æ‚é¡¹</strong>ï¼šåŒ…æ‹¬ CRC æ ¡éªŒã€æ—¥æœŸå’Œæ—¶é—´çš„å¤„ç†ã€æ–‡ä»¶ç³»ç»Ÿç­‰å†…å®¹</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒBoost æ˜¯ä¸€ä¸ªç¤¾ç¾¤ï¼Œä¹Ÿæ˜¯ä¸ªç½‘ç«™ã€‚è‡´åŠ›äºå…è´¹ã€æºç å¼€æ”¾ã€åŒè¡Œå¤å®¡çš„ C++ ç¨‹åºåº“å¼€å‘ï¼Œéå¸¸å€¼å¾—ç»å¸¸è®¿é—®ä¸å­¦ä¹ ã€‚</p><p>ref:</br>[1]. <a href=https://blog.csdn.net/cltcj/category_12098441.html target=_blank rel="external nofollow noopener noreferrer">https://blog.csdn.net/cltcj/category_12098441.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></br>[2]. <a href=https://kissingfire123.github.io/2022/05/17_effective-c-%e4%b9%8b%e9%98%85%e8%af%bb%e6%80%bb%e7%bb%93%e5%9b%9b/ target=_blank rel="external nofollow noopener noreferrer">https://kissingfire123.github.io/2022/05/17_effective-c-%e4%b9%8b%e9%98%85%e8%af%bb%e6%80%bb%e7%bb%93%e5%9b%9b/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></br></p></div><div class=post-reward><div class=comment>Buy me a coffee~</div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward>èµèµ</label><div class=reward-ways data-mode=fixed><div><img loading=lazy src=/images/alipay.png srcset="/images/alipay.png, /images/alipay.png 1.5x, /images/alipay.png 2x" sizes=auto data-title="Jian YE æ”¯ä»˜å®" data-alt="Jian YE æ”¯ä»˜å®" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span data-animation>æ”¯ä»˜å®</span></div><div><img loading=lazy src=/images/wechatpay.png srcset="/images/wechatpay.png, /images/wechatpay.png 1.5x, /images/wechatpay.png 2x" sizes=auto data-title="Jian YE å¾®ä¿¡" data-alt="Jian YE å¾®ä¿¡" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span data-animation>å¾®ä¿¡</span></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="æ›´æ–°äº 2023-10-07 09:25:23">æ›´æ–°äº 2023-10-07&nbsp;<a class=git-hash href=https://github.com/jianye0428/JianBlog/commit/f43a10a9b4079963a6d78279f6f805b045e519d1 rel="external nofollow noopener noreferrer" target=_blank title="commit by yejian(18817571704@163.com) f43a10a9b4079963a6d78279f6f805b045e519d1: bug: modify effective c++ naming rules"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>f43a10a</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/effective_cpp_part_four/index.md title=é˜…è¯»åŸå§‹æ–‡æ¡£ class=link-to-markdown>é˜…è¯»åŸå§‹æ–‡æ¡£</a></span><span><a href=https://github.com/jianye0428/JianBlog/edit/docs/content/posts/C++/Effective_C++/Effective_CPP_Part_Four/index.md title=ç¼–è¾‘æ­¤é¡µ target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>ç¼–è¾‘æ­¤é¡µ</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="åˆ†äº«åˆ° Twitter" data-sharer=twitter data-url=https://jianye0428.github.io/posts/effective_cpp_part_four/ data-title="Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [4]" data-hashtags=Effective><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="åˆ†äº«åˆ° Facebook" data-sharer=facebook data-url=https://jianye0428.github.io/posts/effective_cpp_part_four/ data-hashtag=Effective><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="åˆ†äº«åˆ° Linkedin" data-sharer=linkedin data-url=https://jianye0428.github.io/posts/effective_cpp_part_four/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="åˆ†äº«åˆ° å¾®åš" data-sharer=weibo data-url=https://jianye0428.github.io/posts/effective_cpp_part_four/ data-title="Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [4]"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="åˆ†äº«åˆ° ç™¾åº¦" data-sharer=baidu data-url=https://jianye0428.github.io/posts/effective_cpp_part_four/ data-title="Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [4]"><i data-svg-src=/lib/simple-icons/icons/baidu.min.svg aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/effective/ class=post-tag>Effective</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>è¿”å›</a></span>&nbsp;|&nbsp;<span><a href=/>ä¸»é¡µ</a></span></section></div><div class=post-nav><a href=/posts/effective_cpp_part_three/ class=post-nav-item rel=prev title="Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [3]"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [3]</a>
<a href=/posts/ddpm/ class=post-nav-item rel=next title="Diffusion æ‰©æ•£æ¨¡å‹ï¼ˆDDPMï¼‰">Diffusion æ‰©æ•£æ¨¡å‹ï¼ˆDDPMï¼‰<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">ç”± <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.127.0">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2018 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/jianye0428 target=_blank rel="external nofollow noopener noreferrer">Jian YE</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics order-first"><span class=site-time title=ç½‘ç«™è¿è¡Œä¸­â€¦â€¦><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="ms-1 d-none">åšå®¢å·²è¿è¡Œ</span><span class="run-times ms-1">ç½‘ç«™è¿è¡Œä¸­â€¦â€¦</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=æ€»è®¿å®¢æ•°><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=æ€»è®¿é—®é‡><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=å›åˆ°é¡¶éƒ¨><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div></div><a href=https://github.com/jianye0428/JianBlog title="åœ¨ GitHub ä¸ŠæŸ¥çœ‹ç¨‹å¼ç¢¼ï¼Œè¨‚é–±è«‹é» Watch" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#000;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>FixIt ä¸»é¢˜åœ¨å¯ç”¨ JavaScript çš„æƒ…å†µä¸‹æ•ˆæœæœ€ä½³ã€‚</div></noscript></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=/lib/cell-watermark/watermark.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"å¤åˆ¶åˆ°å‰ªè´´æ¿",editLockTitle:"é”å®šå¯ç¼–è¾‘ä»£ç å—",editUnLockTitle:"è§£é”å¯ç¼–è¾‘ä»£ç å—",editable:!0,maxShownLines:50},comment:{enable:!1},cookieconsent:{content:{dismiss:"åŒæ„",link:"äº†è§£æ›´å¤š",message:"æœ¬ç½‘ç«™ä½¿ç”¨ Cookies æ¥æ”¹å–„æ‚¨çš„æµè§ˆä½“éªŒã€‚"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{algoliaAppID:"MTJNHU0JVB",algoliaIndex:"index",algoliaSearchKey:"5486225134d99f43826da401ee9bad57",highlightTag:"em",maxResultLength:10,noResultsFound:"æ²¡æœ‰æ‰¾åˆ°ç»“æœ",snippetLength:50,type:"algolia"},siteTime:"2018-05-28T20:01:01+08:00",twemoji:!0,watermark:{appendto:".wrapper>main",colspacing:30,content:'<img style="height: 0.85rem;" src="/images/favicon/jian_icon.png" alt="logo" /> jianye',enable:!0,fontfamily:"MMT_LRH,æ²ç›®ä½“",fontsize:1.1,height:20,opacity:.0125,rotate:15,rowspacing:60,width:150}}</script><script src=/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script></body></html>