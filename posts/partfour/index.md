# Effective STL ç²¾è¯»æ€»ç»“ [4] | è¿­ä»£å™¨


# å‰è¨€

> Effective-STLæ€»ç»“ç³»åˆ—åˆ†ä¸ºä¸ƒéƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬å››éƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬å››ç« ï¼Œå†…å®¹èŒƒå›´Rule26~29ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule26ç®€å†™ä¸ºR26ã€‚

{{< admonition Note "Effective-STLç³»åˆ—List" false >}}
æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ [Effective STL(ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“(ä¸€)](https://jianye0428.github.io/posts/partone/)</br>
ğŸ’¡ [Effective STL(ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“(äºŒ)](https://jianye0428.github.io/posts/parttwo/)</br>
ğŸ’¡ [Effective STL(ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“(ä¸‰)](https://jianye0428.github.io/posts/partthree/)</br>
ğŸ’¡ [Effective STL(ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“(å››)](https://jianye0428.github.io/posts/partfour/)</br>
{{< /admonition >}}

## R26: iterator ä¼˜å…ˆäº const_interatorã€reverse_interator åŠ const_reverse_interator

1. STLä¸­æ‰€æœ‰çš„æ ‡å‡†å®¹å™¨éƒ½æä¾›äº†4ç§è¿­ä»£å™¨ç±»å‹ï¼Œå¯¹å®¹å™¨ç±»container<T>è€Œè¨€ï¼Œiteratorç±»å‹ç›¸å½“äºT*ï¼Œconst_iteratorç›¸å½“äºconst T*ã€‚reverse_iteratorå’Œconst_reverse_iteratoré€’å¢çš„æ•ˆæœæ˜¯ä»å®¹å™¨çš„å°¾éƒ¨åå‘éå†åˆ°å¤´éƒ¨ã€‚
2. å¯¹äºvectorå®¹å™¨çš„insertå‡½æ•°å’Œeraseå‡½æ•°ï¼Œè¿™äº›å‡½æ•°åªæ¥å—iteratorç±»å‹çš„å‚æ•°ï¼Œè€Œä¸æ˜¯const_iteratorã€reverse_iteratoræˆ–è€…const_reverse_iteratorã€‚ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº†ä¸åŒç±»å‹è¿­ä»£å™¨ä¹‹é—´çš„å…³ç³»ã€‚é»‘è‰²ç®­å¤´ï¼Œå¹¶ä¸”ä¸Šé¢æœªæ ‡å‡½æ•°çš„è¡¨ç¤ºéšå¼ç±»å‹è½¬æ¢ï¼Œæ ‡å‡½æ•°çš„è¡¨ç¤ºæ˜¾ç¤ºç±»å‹è½¬æ¢ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡base()å¾—åˆ°çš„è¿­ä»£å™¨æˆ–è®¸å¹¶éæ˜¯ä½ æœŸæœ›çš„è¿­ä»£å™¨ç±»å‹ã€‚ä¹Ÿå¯ä»¥çœ‹å‡ºæƒ³éšå¼è½¬æ¢const_iteratoråˆ°iteratoræ˜¯ä¸å¯è¡Œçš„ã€‚ä»reverse_iteratorè½¬æ¢æ¥çš„iteratoråœ¨ä½¿ç”¨ä¹‹å‰å¯èƒ½éœ€è¦è¿›è¡Œç›¸åº”çš„è°ƒæ•´ï¼Œæ¡æ¬¾28å°†æ›´è¯¦ç»†åœ°è¯´æ˜è¿™ä¸€ç‚¹ã€‚ç”±æ­¤å¯è§ï¼Œå°½é‡ä½¿ç”¨iteratorï¼Œè€Œä¸æ˜¯constæˆ–reverseå‹çš„è¿­ä»£å™¨ï¼Œå¯ä»¥ä½¿å®¹å™¨çš„ä½¿ç”¨æ›´ä¸ºç®€å•æœ‰æ•ˆï¼Œå¹¶ä¸”å¯ä»¥é¿å…æ½œåœ¨çš„é—®é¢˜ã€‚

ä¸åŒç±»å‹çš„è¿­ä»£å™¨ä¹‹é—´çš„å…³ç³»:
![](images/1.png)

3. å‡è®¾æœ‰ä¸ªiterator iå’Œä¸€ä¸ªconst_iterator ciæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯åœ¨æ¯”è¾ƒè¿™ä¸¤ä¸ªè¿­ä»£å™¨æ—¶ï¼Œå³if(i == ci)çš„ç»“æœå´æ˜¯å‡ï¼Œç”šè‡³ä¸èƒ½é€šè¿‡ç¼–è¯‘ï¼Œå› ä¸ºè¿™äº›STLå®ç°å°†const_iteratorçš„operator==ä½œä¸ºæˆå‘˜å‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªéæˆå‘˜å‡½æ•°ï¼Œciä¸èƒ½éšå¼è½¬æˆiï¼Œä½†æ˜¯iå¯ä»¥éšå¼è½¬æˆciï¼Œæ‰€ä»¥åˆ¤æ–­if(ci == i)æ˜¯çœŸã€‚é¿å…è¿™ç§é—®é¢˜æœ€ç®€å•çš„åŠæ³•æ˜¯å‡å°‘æ··ç”¨ä¸åŒç±»å‹çš„è¿­ä»£å™¨ï¼Œå°½é‡ä½¿ç”¨iteratoræ¥ä»£æ›¿const_iteratorã€‚

## R27: ä½¿ç”¨ distance å’Œ advance å°†å®¹å™¨çš„ const_interator è½¬æ¢æˆ iterator

1. é¦–å…ˆè€ƒè™‘ç±»å‹è½¬æ¢è¾¾åˆ°è¯¥æ¡æ¬¾çš„ç›®çš„ï¼ŒåŒ…æ‹¬ä¸¤ç§ä»£ç ï¼ŒIter i(ci);å’ŒIter i(const_cast<Iter>(ci));ï¼Œè¿™ä¸¤ç§ä»£ç éƒ½ä¸èƒ½é€šè¿‡ç¼–è¯‘ï¼ŒåŸå› åœ¨äºiteratorå’Œconst_iteratoræ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ä¸ªç±»ï¼Œç›¸å½“äºintå’Œcomplex<double>ä¹‹é—´äº’è½¬ï¼Œå½“ç„¶ä¸å¯èƒ½æˆåŠŸã€‚ä¸è¿‡å¯¹äºvectorå’Œstringæ¥è¯´ï¼Œä¸Šé¢çš„ä»£ç å¯èƒ½é€šè¿‡ç¼–è¯‘ï¼Œå› ä¸ºå¤§å¤šæ•°STLå°†vector<T>::iteratorå’Œvector<T>::const_iteratoråˆ†åˆ«å®šä¹‰ä¸ºT*å’Œconst T*ï¼Œstring::iteratorå’Œstring::const_iteratorå®šä¹‰ä¸ºchar*å’Œconst char*ï¼Œå› æ­¤å¯¹äºè¿™ä¸¤ä¸ªå®¹å™¨å¼ºè½¬å¯èƒ½æ˜¯æˆåŠŸçš„ï¼Œä½†æ˜¯å³ä½¿åœ¨è¿™ä¸¤ä¸ªå®¹å™¨ç§ï¼Œreverse_iteratorå’Œconst_reverse_iteratorä»ç„¶æ˜¯ä¸¤ä¸ªç±»ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ä¸èƒ½å¼ºè½¬çš„ã€‚
2. å¯ä»¥é€šè¿‡distanceå‡½æ•°è¿›è¡Œè½¬æ¢ï¼Œä»£ç å¦‚ä¸‹ï¼š
   ```c++
    typedef deque<int> IntDeque;
    typedef IntDeque::iterator Iter;
    typedef IntDeque::const_iterator ConstIter;

    IntDeque d;
    ConstIter ci;
    Iter i(d.begin());
    advance(i, distance(i, ci));//ç›®å‰ä¸èƒ½é€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯æ€æƒ³æ˜¯é€šè¿‡distanceè®¡ç®—å‡ºciå’Œbeginä¹‹é—´çš„è·ç¦»ï¼Œç„¶åç§»åŠ¨è¿™ä¹ˆå¤šè·ç¦»
   ```
   ä¸Šé¢è¿™ä¸ªç¨‹åºä¸èƒ½é€šè¿‡ç¼–è¯‘çš„åŸå› æ˜¯distanceå‡½æ•°åªèƒ½æ¥å—ä¸€ç§ç±»å‹çš„è¿­ä»£å™¨ï¼Œè€Œiå’Œciæ˜¯ä¸¤ç§ä¸åŒçš„è¿­ä»£å™¨ã€‚è¦é€šè¿‡ç¼–è¯‘æœ€ç®€å•çš„æ–¹æ³•æ˜¯æ˜¾ç¤ºæŒ‡å®šdistanceä½¿ç”¨çš„ç±»å‹ï¼Œå³advance(i, distance<ConstIter>(i, ci));é™¤äº†è¾¾æˆæ•ˆç‡ï¼Œå†è€ƒè™‘è¿™ä¹ˆåšçš„æ•ˆç‡å¦‚ä½•ï¼Œå®ƒçš„æ‰§è¡Œæ•ˆç‡å–å†³äºä½ ä½¿ç”¨çš„è¿­ä»£å™¨ï¼Œå¯¹äºéšæœºè®¿é—®è¿­ä»£å™¨ï¼ˆvectorã€stringå’Œdequeï¼‰ï¼Œå®ƒæ˜¯å¸¸æ•°æ—¶é—´æ“ä½œï¼Œå¯¹äºåŒå‘è¿­ä»£å™¨ï¼ˆå…¶ä»–æ‰€æœ‰ï¼‰ï¼Œå®ƒæ˜¯çº¿æ€§æ—¶é—´æ“ä½œã€‚

## R28: æ­£ç¡®ç†è§£ç”±reverse_iteratorçš„base()æˆå‘˜å‡½æ•°æ‰€äº§ç”Ÿçš„iteratorçš„ç”¨æ³•

![](images/2.png)

å‡è®¾é€šè¿‡reverse_iteratoræŸ¥æ‰¾å®¹å™¨ä¸­å€¼ä¸º3çš„å…ƒç´ ï¼Œriè¡¨ç¤º3çš„ä½ç½®ï¼Œä½†æ˜¯åœ¨è°ƒç”¨base()å‡½æ•°å°†å…¶è½¬æ¢æˆiteratorç±»å‹æ—¶ï¼Œå› ä¸ºåç§»å˜æˆiæ‰€æŒ‡å‘çš„ä½ç½®ã€‚å‡è®¾è¦åœ¨riçš„ä½ç½®æ’å…¥æ–°å…ƒç´ ï¼Œæˆ‘ä»¬é¢„æœŸæ–°å…ƒç´ ä¼šæ’å…¥åœ¨ç°åœ¨å…ƒç´ 3çš„ä½ç½®ï¼Œç„¶å3å’Œå…¶åçš„å…ƒç´ éœ€è¦å¾€å³ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œä½†æ˜¯å› ä¸ºinsertä¼šå°†æ–°å…ƒç´ æ’å…¥åˆ°è¿­ä»£å™¨æŒ‡å‘ä½ç½®çš„å‰é¢ï¼Œè€Œé€†åºéå†çš„é¡ºåºæ˜¯ç”±åå‘å‰çš„ï¼Œæ‰€ä»¥ä¼šå°†æ–°å…ƒç´ æ’å…¥åœ¨3çš„â€œåé¢â€ï¼Œå®é™…å¯¹reverse_iteratoræ¥è¯´å°±æ˜¯â€œå‰é¢â€ã€‚æ‰€ä»¥å¦‚æœæ˜¯åœ¨reverse_iteratorç±»å‹riä½ç½®æ’å…¥ï¼Œåªéœ€è¦åœ¨ir.base()ä½ç½®æ’å…¥å³å¯ã€‚ä½†æ˜¯å¦‚æœæ˜¯åœ¨riä½ç½®åˆ é™¤å…ƒç´ ï¼Œåˆ™éœ€è¦åœ¨ri.base()ä½ç½®å‰é¢çš„ä½ç½®æ‰§è¡Œåˆ é™¤ã€‚ä½†æ˜¯å…¶ä¸­è¿˜æ˜¯æœ‰å‘ï¼Œè¯·çœ‹å¦‚ä¸‹ä»£ç ï¼š

```c++
//è¿™æ®µä»£ç é€šä¸è¿‡ç¼–è¯‘
vector<int> v;
vector<int>::reverse_iterator ri = find(v.rbegin(), v.rend(), 3);
v.erase(--ri.base());//iteratorçš„--æ˜¯å·¦ç§»ï¼Œreverse_iteratorçš„--æ˜¯å³ç§»
```
è¿™æ®µä»£ç å¯¹äºvectorå’Œstringä¸èƒ½é€šè¿‡ç¼–è¯‘çš„åŸå› åœ¨äºï¼Œè¿™ä¸¤ç§å®¹å™¨çš„iteratorå’Œconst_iteratoræ˜¯ä»¥å†…ç½®æŒ‡é’ˆçš„æ–¹å¼å®ç°çš„ï¼Œæ‰€ä»¥ri.base()çš„ç»“æœæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè€ŒCå’ŒC++éƒ½è§„å®šäº†ä»å‡½æ•°è¿”å›çš„æŒ‡é’ˆä¸åº”è¯¥è¢«ä¿®æ”¹ã€‚æ‰€ä»¥å¿…é¡»æ¢ä¸ªè°ƒç”¨æ–¹å¼ï¼šv.erase((++ri).base());ï¼Œå…ˆè®©riå·¦ç§»å†å–æŒ‡é’ˆã€‚

## R29: å¯¹äºé€ä¸ªå­—ç¬¦çš„è¾“å…¥è¯·è€ƒè™‘ä½¿ç”¨istreambuf::iterator

å‡è®¾ä½ æƒ³å°†ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­çš„å†…å®¹æ‹·è´åˆ°ä¸€ä¸ªstringå¯¹è±¡ä¸­ï¼Œè€ƒè™‘å¦‚ä¸‹çš„å®ç°æ–¹å¼ï¼š

```c++
ifstream inputFile("inputData.txt");
string fileData((istream_iterator<char>(inputFile)), istream_iterator<char>());//æ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°ç”¨æ‹¬å·åŒ…èµ·æ¥
```

ä½†æ˜¯è¿™ç§è¯»å–æ–¹å¼æ˜¯ä¸åŒ…å«ç©ºç™½å­—ç¬¦çš„ï¼Œå› ä¸ºistream_iteratorä½¿ç”¨operator>>å®Œæˆè¯»æ“ä½œï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹operator>>ä¼šè·³è¿‡ç©ºç™½å­—ç¬¦ï¼Œå‡å®šä½ è¦ä¿ç•™ç©ºç™½å­—ç¬¦ï¼Œå¯ä»¥æ›´æ”¹è¿™ç§é»˜è®¤è¡Œä¸ºï¼Œå¦‚ä¸‹ä»£ç :

```c++
ifstream inputFile("inputData.txt");
inputFile.unsetf(ios::skipws);
string fileData((istream_iterator<char>(inputFile)), istream_iterator<char>());//æ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°ç”¨æ‹¬å·åŒ…èµ·æ¥
```

ä¸Šè¿°ä»£ç æ˜¯å¯ä»¥å®Œæˆè¦æ±‚çš„åŠŸèƒ½çš„ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°å®ƒå¹¶ä¸å¤Ÿå¿«ï¼Œistream_iteratorå†…éƒ¨ä½¿ç”¨çš„operator>>å®é™…ä¸Šæ‰§è¡Œäº†æ ¼å¼åŒ–è¾“å‡ºï¼Œè¿™æ„å‘³ç€æ¯æ¬¡è°ƒç”¨operator>>æ“ä½œç¬¦ï¼Œéƒ½ä¼šæ‰§è¡Œè®¸å¤šé™„åŠ çš„æ“ä½œã€‚ä¸€ç§æ›´ä¸ºæœ‰æ•ˆçš„é€”å¾„æ˜¯ä½¿ç”¨istreambuf_iteratorï¼Œistreambuf_iteratorçš„ä½¿ç”¨æ–¹æ³•ä¸istream_iteratorå¤§è‡´ç›¸åŒï¼Œä½†æ˜¯istream_iterator<char>ä½¿ç”¨operator>>ä»è¾“å…¥æµä¸­è¯»å–å•ä¸ªå­—ç¬¦ï¼Œè€Œistreambuf_iterator<char>ä»ä¸€ä¸ªè¾“å…¥æµçš„ç¼“å†²åŒºè¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚ä½¿ç”¨çš„ä»£ç å°±æ˜¯å°†istream_iteratoræ”¹æˆistreambuf_iteratorã€‚

```c++
ifstream inputFile("inputData.txt");
string fileData((istreambuf_iterator<char>(inputFile)), istreambuf_iterator<char>());//æ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°ç”¨æ‹¬å·åŒ…èµ·æ¥
```

åŒæ ·å¯¹äºéæ ¼å¼åŒ–çš„é€ä¸ªå­—ç¬¦çš„è¾“å‡ºï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ostreambuf_iteratoræ›¿æ¢ostream_iteratorã€‚

ref:
[1]. https://www.cnblogs.com/Sherry4869/p/15128250.html</br>
[2]. https://blog.csdn.net/zhuikefeng/article/details/108164117#t42</br>
[3]. https://zhuanlan.zhihu.com/p/458156007

---

> ä½œè€…: [Jian YE](https://github.com/jianye0428)  
> URL: https://jianye0428.github.io/posts/partfour/  

