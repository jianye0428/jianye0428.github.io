<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>æ‰€æœ‰æ–‡ç«  - yejian's blog</title><link>https://jianye0428.github.io/posts/</link><description>æ‰€æœ‰æ–‡ç«  | yejian's blog</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>18817571704@163.com (Jian YE)</managingEditor><webMaster>18817571704@163.com (Jian YE)</webMaster><lastBuildDate>Mon, 28 Aug 2023 07:58:09 +0800</lastBuildDate><atom:link href="https://jianye0428.github.io/posts/" rel="self" type="application/rss+xml"/><item><title>Effective STL [16] | å¦‚ä½•å°†vectorå’Œstringçš„æ•°æ®ä¼ ç»™é—ç•™çš„API</title><link>https://jianye0428.github.io/posts/clause_16/</link><pubDate>Mon, 07 Aug 2023 08:35:57 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_16/</guid><description><![CDATA[<h2 id="string-å’Œ-vector-ä¼ é€’ç»™c-api">string å’Œ vector ä¼ é€’ç»™C API</h2>
<h3 id="vectorä¼ é€’æŒ‡é’ˆ">vectorä¼ é€’æŒ‡é’ˆ</h3>
<p>Cé£æ ¼APIæ¥å—çš„æ˜¯<strong>æ•°ç»„</strong>å’Œ<code>char*</code>æŒ‡é’ˆï¼Œè¿™æ ·çš„APIè¿˜ä¼šå­˜åœ¨å¾ˆé•¿æ—¶é—´ï¼Œå¦‚æœæœ‰1ä¸ªvectorå¯¹è±¡randyï¼Œ åˆ™ä½¿ç”¨<code>&amp;v[0]</code>å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæŒ‡å‘randyä¸­æ•°æ®çš„æŒ‡é’ˆã€‚å¯¹äºstringå¯¹è±¡sesameï¼Œåˆ™ä¼ é€’<code>sesame.c_str()</code>å³å¯ã€‚</p>
<p>è¡¨è¾¾å¼<code>randy[0]</code>ç”Ÿäº§ä¸€ä¸ªæŒ‡å‘vectorä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨ï¼Œæ‰€ä»¥ï¼Œ<code>&amp;randy[0]</code>æ˜¯æŒ‡å‘é‚£ä¸ªé¦–å…ƒç´ çš„æŒ‡é’ˆã€‚</p>
<p>vectorä¸­çš„å…ƒç´ è¢«C++æ ‡å‡†é™å®šä¸ºå­˜å‚¨åœ¨è¿ç»­å†…å­˜ä¸­ï¼Œå°±åƒæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯èƒ½ä¼šè¿™ä¹ˆä¼ é€’</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// C API
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">doSomething</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span><span class="o">*</span> <span class="n">pInts</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">numInts</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">doSomething</span><span class="p">(</span><span class="o">&amp;</span><span class="n">randy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">randy</span><span class="p">.</span><span class="n">size</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å”¯ä¸€çš„é—®é¢˜å°±æ˜¯ï¼Œå¦‚æœrandyæ˜¯ç©ºçš„ï¼Œ<code>randysize()</code>æ˜¯0ï¼Œè€Œ<code>&amp;randy[0]</code>è¯•å›¾äº§ç”Ÿä¸€ä¸ªæŒ‡å‘æ ¹æœ¬å°±ä¸å­˜åœ¨çš„ä¸œè¥¿çš„æŒ‡é’ˆã€‚</p>
<p>å¯ä»¥æå‰åˆ¤æ–­ä¸€ä¸‹randyçš„å¤§å°ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">randy</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">doSomething</span><span class="p">(</span><span class="o">&amp;</span><span class="n">randy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">randy</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>randy.begin()ä»£æ›¿&amp;randy[0]?</strong></p>
</blockquote>
<p>å¯¹äºvectorï¼Œå…¶è¿­ä»£å™¨å®é™…ä¸Šæ˜¯æŒ‡é’ˆã€‚</p>
<p><code>begin</code>çš„è¿”å›ç±»å‹æ˜¯<code>iterator</code>ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå½“ä½ éœ€è¦ä¸€ä¸ªæŒ‡å‘vectorå†…éƒ¨æ•°æ®çš„æŒ‡é’ˆæ—¶ç»ä¸è¯¥ä½¿ç”¨beginã€‚å¦‚æœä½ åŸºäºæŸäº›åŸå› å†³å®šé”®å…¥<code>randy.begin()</code>ï¼Œå°±åº”è¯¥é”®å…¥<code>&amp;*randy.begin()</code>ï¼Œå› ä¸ºè¿™å°†ä¼šäº§ç”Ÿå’Œ<code>&amp;v[0]</code>ç›¸åŒçš„æŒ‡é’ˆã€‚</p>
<h3 id="string-ä¼ é€’æŒ‡é’ˆ">string ä¼ é€’æŒ‡é’ˆ</h3>
<p>ç±»ä¼¼ä»vectorä¸Šè·å–æŒ‡å‘å†…éƒ¨æ•°æ®çš„æŒ‡é’ˆçš„æ–¹æ³•ï¼Œ<strong>å¯¹stringä¸æ˜¯å¯é çš„</strong>:</p>
<ol>
<li>stringä¸­çš„æ•°æ®å¹¶æ²¡æœ‰ä¿è¯è¢«å­˜å‚¨åœ¨ç‹¬ç«‹çš„ä¸€å—è¿ç»­å†…å­˜ä¸­</li>
<li>stringçš„å†…éƒ¨è¡¨ç¤ºå½¢å¼å¹¶æ²¡æ‰¿è¯ºä»¥ä¸€ä¸ªnullå­—ç¬¦ç»“æŸã€‚è¿™è§£é‡Šäº†stringçš„æˆå‘˜å‡½æ•°c_strå­˜åœ¨çš„åŸå› </li>
</ol>
<p>å³ä½¿æ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º0ï¼Œ<code>c_str</code>å°†è¿”å›ä¸€ä¸ªæŒ‡å‘<code>null</code>å­—ç¬¦çš„æŒ‡é’ˆã€‚</p>
<p><strong>åœ¨ä¸¤ç§å½¢å¼ä¸‹ï¼ŒæŒ‡é’ˆéƒ½è¢«ä¼ é€’ä¸ºæŒ‡å‘constçš„æŒ‡é’ˆã€‚vectorå’Œstringçš„æ•°æ®åªèƒ½ä¼ ç»™åªè¯»å–è€Œä¸ä¿®æ”¹å®ƒçš„APIã€‚</strong></p>
<p>å¦‚æœä½ å°†<code>randy</code>ä¼ ç»™ä¸€ä¸ªä¿®æ”¹å…¶å…ƒç´ çš„Cé£æ ¼APIçš„è¯ï¼Œå…¸å‹æƒ…å†µéƒ½æ˜¯æ²¡é—®é¢˜ï¼Œä½†<strong>è¢«è°ƒç”¨çš„å‡½æ•°ç»ä¸èƒ½è¯•å›¾æ”¹å˜vectorä¸­å…ƒç´ çš„ä¸ªæ•°</strong>ã€‚å¦åˆ™ï¼Œrandyçš„å†…éƒ¨çŠ¶æ€å°†ä¼šå˜å¾—ä¸ä¸€è‡´ï¼Œ<code>v.size()</code>å°†ä¼šå¾—åˆ°ä¸€ä¸ªä¸æ­£ç¡®çš„ç»“æœã€‚</p>
<p><strong>æŠŠä¸€ä¸ªvectorä¼ é€’ç»™éœ€è¦ä¿®æ”¹vectoræ•°æ®çš„APIï¼Œä¸€å®šè¦ç¡®ä¿è¿™äº›é¢å¤–é™åˆ¶ç»§ç»­è¢«æ»¡è¶³</strong>ï¼Œæ¯”å¦‚æ˜¯å¦éœ€è¦ä¿æŒåŸæ¥vectorä¸­å…ƒç´ çš„é¡ºåºã€‚</p>
<h2 id="cé£æ ¼apiè¿”å›çš„å…ƒç´ åˆå§‹åŒ–stlå®¹å™¨">Cé£æ ¼APIè¿”å›çš„å…ƒç´ åˆå§‹åŒ–STLå®¹å™¨</h2>
<h3 id="åˆå§‹åŒ–vector">åˆå§‹åŒ–vector</h3>
<p><strong>åˆ©ç”¨vectorå’Œæ•°ç»„æ½œåœ¨çš„å†…å­˜åˆ†å¸ƒå…¼å®¹æ€§å°†å­˜å‚¨vecotrçš„å…ƒç´ çš„ç©ºé—´ä¼ ç»™APIå‡½æ•°ï¼š</strong></p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// C APIï¼šæ­¤å‡½æ•°éœ€è¦ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œæ•°ç»„æœ€å¤šæœ‰arraySizeä¸ªdouble
</span></span></span><span class="line"><span class="cl"><span class="c1">// è€Œä¸”ä¼šå¯¹æ•°ç»„å†™å…¥æ•°æ®ã€‚å®ƒè¿”å›å†™å…¥çš„doubleæ•°ï¼Œä¸ä¼šå¤§äºarraySize
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">size_t</span> <span class="nf">fillArray</span><span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="n">pArray</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">arraySize</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">vd</span><span class="p">(</span><span class="n">maxNumDoubles</span><span class="p">);</span> <span class="c1">// å»ºç«‹ä¸€ä¸ªvectorï¼Œå®ƒçš„å¤§å°æ˜¯maxNumDoubles
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vd</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">fillArray</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vd</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span> <span class="c1">// è®©fillArrayæŠŠæ•°æ®å†™å…¥vdï¼Œç„¶åè°ƒæ•´vdçš„å¤§å°ä¸ºfillArrayå†™å…¥çš„å…ƒç´ ä¸ªæ•°
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è¿™ä¸ªæŠ€å·§åªèƒ½å·¥ä½œäºvectorï¼Œå› ä¸ºåªæœ‰vectoræ‰¿è¯ºäº†ä¸æ•°ç»„å…·æœ‰ç›¸åŒçš„æ½œåœ¨å†…å­˜åˆ†å¸ƒã€‚</strong></p>
<h3 id="åˆå§‹åŒ–string">åˆå§‹åŒ–string</h3>
<p>åªè¦è®©APIå°†æ•°æ®æ”¾å…¥ä¸€ä¸ª<code>vector&lt;char&gt;</code>ï¼Œç„¶åä»vectorä¸­å°†æ•°æ®æ‹·åˆ°stringï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// C APIï¼šæ­¤å‡½æ•°éœ€è¦ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œæ•°ç»„æœ€å¤šæœ‰arraySizeä¸ªchar
</span></span></span><span class="line"><span class="cl"><span class="c1">// è€Œä¸”ä¼šå¯¹æ•°ç»„å†™å…¥æ•°æ®ã€‚å®ƒè¿”å›å†™å…¥çš„charæ•°ï¼Œä¸ä¼šå¤§äºarraySize
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">size_t</span> <span class="nf">fillString</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">pArray</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">arraySize</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">vc</span><span class="p">(</span><span class="n">maxNumChars</span><span class="p">);</span> <span class="c1">// å»ºç«‹ä¸€ä¸ªvectorï¼Œå®ƒçš„å¤§å°æ˜¯maxNumChars
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">size_t</span> <span class="n">charsWritten</span> <span class="o">=</span> <span class="n">fillString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vc</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="c1">// è®©fillStringæŠŠæ•°æ®å†™å…¥vc
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">string</span> <span class="nf">s</span><span class="p">(</span><span class="n">vc</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vc</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">charsWritten</span><span class="p">);</span> <span class="c1">// ä»vcé€šè¿‡èŒƒå›´æ„é€ å‡½æ•°æ‹·è´æ•°æ®åˆ°s
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆå§‹åŒ–å…¶ä»–stlå®¹å™¨">åˆå§‹åŒ–å…¶ä»–STLå®¹å™¨</h3>
<p><strong>é€šç”¨æ–¹æ³•ï¼šCé£æ ¼APIæŠŠæ•°æ®æ”¾å…¥ä¸€ä¸ªvectorï¼Œç„¶åæ‹·åˆ°å®é™…æƒ³è¦çš„STLå®¹å™¨</strong></p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">size_t</span> <span class="nf">fillArray</span><span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="n">pArray</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">arraySize</span><span class="p">);</span> <span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">vd</span><span class="p">(</span><span class="n">maxNumDoubles</span><span class="p">);</span> <span class="c1">// ä¸€æ ·åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vd</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">fillArray</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vd</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl"><span class="n">deque</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">());</span> <span class="c1">// æ‹·è´æ•°æ®åˆ°deque
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">list</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">l</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">());</span> <span class="c1">// æ‹·è´æ•°æ®åˆ°list
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">set</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">s</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">());</span> <span class="c1">// æ‹·è´æ•°æ®åˆ°set
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="stlå®¹å™¨ä¼ é€’ç»™c-api">STLå®¹å™¨ä¼ é€’ç»™C API</h3>
<p>STLå®¹å™¨å°†å®ƒä»¬çš„æ•°æ®ä¼ ç»™Cé£æ ¼APIï¼Œåªè¦å°†å®¹å™¨çš„æ¯ä¸ªæ•°æ®æ‹·åˆ°vectorï¼Œç„¶åå°†vectorä¼ ç»™API:</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">doSomething</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span><span class="o">*</span><span class="n">pints</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">numInts</span><span class="p">);</span> <span class="c1">// C API (åŒä¸Š)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">intSet</span><span class="p">;</span> <span class="c1">// ä¿å­˜è¦ä¼ é€’ç»™APIæ•°æ®çš„set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">(</span><span class="n">intSet</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">intSet</span><span class="p">.</span><span class="n">end</span><span class="p">());</span> <span class="c1">// æ‹·è´setæ•°æ®åˆ°vector
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">v</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="n">doSomething</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="c1">// ä¼ é€’æ•°æ®åˆ°API
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å¦‚æœåœ¨ç¼–è¯‘æœŸå°±çŸ¥é“å®¹å™¨çš„å¤§å°</strong>ï¼Œå¯ä»¥å°†æ•°æ®æ‹·è¿›ä¸€ä¸ª<strong>æ•°ç»„</strong>ï¼Œç„¶åå°†æ•°ç»„ä¼ ç»™Cé£æ ¼çš„APIï¼Œå¦åˆ™ä¸å¾—ä¸åˆ†é…åŠ¨æ€æ•°ç»„ã€‚</p>
]]></description></item><item><title>Effective STL ç²¾åº¦æ€»ç»“ [6] | ä»¿å‡½æ•°ã€ä»¿å‡½æ•°ç±»ã€å‡½æ•°ç­‰</title><link>https://jianye0428.github.io/posts/partsix/</link><pubDate>Tue, 22 Aug 2023 19:22:49 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/partsix/</guid><description><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1>
<blockquote>
<p>Effective-STLæ€»ç»“ç³»åˆ—åˆ†ä¸ºä¸ƒéƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬å…­éƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬å…­ç« ï¼Œå†…å®¹èŒƒå›´Rule38~42ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule38ç®€å†™ä¸ºR38ã€‚</p>
</blockquote>
<div class="details admonition Note">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Effective-STLç³»åˆ—List<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partone/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/parttwo/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partthree/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partfour/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></div>
    </div>
  </div>
<h2 id="r38-éµå¾ªæŒ‰å€¼ä¼ é€’çš„åŸåˆ™æ¥è®¾è®¡å‡½æ•°å­ç±»">R38: éµå¾ªæŒ‰å€¼ä¼ é€’çš„åŸåˆ™æ¥è®¾è®¡å‡½æ•°å­ç±»</h2>
<p>å‡½æ•°æŒ‡é’ˆæ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚</p>
<p>å‡½æ•°å¯¹è±¡å¾€å¾€æŒ‰å€¼ä¼ é€’å’Œè¿”å›ã€‚æ‰€ä»¥ï¼Œç¼–å†™çš„å‡½æ•°å¯¹è±¡å¿…é¡»å°½å¯èƒ½åœ°å°å·§ï¼Œå¦åˆ™å¤åˆ¶çš„å¼€é”€å¤§ï¼›å‡½æ•°å¯¹è±¡å¿…é¡»æ˜¯<strong>å•æ€</strong>çš„(ä¸æ˜¯å¤šæ€)ï¼Œä¸å¾—ä½¿ç”¨è™šå‡½æ•°ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›åˆ›å»ºä¸€ä¸ªåŒ…å«å¤§é‡æ•°æ®å¹¶ä¸”ä½¿ç”¨äº†å¤šæ€æ€§çš„å‡½æ•°å­ç±»ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BPFCImpl</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="n">unary_function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">void</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Widget</span> <span class="n">w</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">...</span>
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="o">~</span><span class="n">BPFCImpl</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">operator</span><span class="p">()</span> <span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">friend</span> <span class="k">class</span> <span class="nc">BPFC</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>					<span class="c1">// å…è®¸BPFCè®¿é—®å†…éƒ¨æ•°æ®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BPFC</span><span class="o">:</span>								<span class="c1">// æ–°çš„BPFCç±»ï¼šçŸ­å°ã€å•æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">public</span> <span class="n">unary_function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">void</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">BPFCImpl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pImpl</span><span class="p">;</span>					<span class="c1">// BPFCå”¯ä¸€çš„æ•°æ®æˆå‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="k">const</span>	<span class="c1">// ç°åœ¨è¿™æ˜¯ä¸€ä¸ªéè™šå‡½æ•°ï¼Œå°†è°ƒç”¨è½¬åˆ°BPFCImplä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">pImpl</span><span class="o">-&gt;</span><span class="k">operator</span><span class="p">()(</span><span class="n">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆä½ åº”è¯¥åˆ›å»ºä¸€ä¸ªå°å·§ã€å•æ€çš„ç±»ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å¦ä¸€ä¸ªå®ç°ç±»ï¼Œå¹¶ä¸”å°†æ‰€æœ‰çš„æ•°æ®å’Œè™šå‡½æ•°éƒ½æ”¾åœ¨å®ç°ç±»ä¸­(â€œPimpl Idiomâ€)ã€‚</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BPFCImpl</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="n">unary_function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">void</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Widget</span> <span class="n">w</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">...</span>
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="o">~</span><span class="n">BPFCImpl</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">operator</span><span class="p">()</span> <span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">friend</span> <span class="k">class</span> <span class="nc">BPFC</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>					<span class="c1">// å…è®¸BPFCè®¿é—®å†…éƒ¨æ•°æ®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BPFC</span><span class="o">:</span>								<span class="c1">// æ–°çš„BPFCç±»ï¼šçŸ­å°ã€å•æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">public</span> <span class="n">unary_function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">void</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">BPFCImpl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pImpl</span><span class="p">;</span>					<span class="c1">// BPFCå”¯ä¸€çš„æ•°æ®æˆå‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="k">const</span>	<span class="c1">// ç°åœ¨è¿™æ˜¯ä¸€ä¸ªéè™šå‡½æ•°ï¼Œå°†è°ƒç”¨è½¬åˆ°BPFCImplä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">pImpl</span><span class="o">-&gt;</span><span class="k">operator</span><span class="p">()(</span><span class="n">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="r39-ç¡®ä¿åˆ¤åˆ«å¼æ˜¯-çº¯å‡½æ•°">R39 ç¡®ä¿åˆ¤åˆ«å¼æ˜¯ â€œçº¯å‡½æ•°â€</h2>
<p><strong>åˆ¤åˆ«å¼(predicate)ï¼šä¸€ä¸ªè¿”å›å€¼ä¸º bool ç±»å‹çš„å‡½æ•°ã€‚</strong></p>
<p><strong>çº¯å‡½æ•°ï¼šæŒ‡è¿”å›å€¼ä»…ä»…ä¾èµ–äºå…¶å‚æ•°çš„å‡½æ•°ã€‚</strong></p>
<p>åˆ¤åˆ«å¼ç±»(predicate class)ï¼šä¸€ä¸ªå‡½æ•°å­ç±»ï¼Œå®ƒçš„ operator() å‡½æ•°æ˜¯ä¸€ä¸ªåˆ¤åˆ«å¼(è¿”å› true æˆ– false)ã€‚</p>
<p>STL ä¸­å‡¡æ˜¯å¯ä»¥æ¥å—ä¸€ä¸ªåˆ¤åˆ«å¼ç±»å¯¹è±¡çš„åœ°æ–¹ï¼Œä¹Ÿå°±å¯ä»¥æ¥å—ä¸€ä¸ªåˆ¤åˆ«å¼å‡½æ•°ã€‚</p>
<p>åˆ¤åˆ«å¼åº”è¯¥æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œè€Œçº¯å‡½æ•°åº”è¯¥æ²¡æœ‰çŠ¶æ€ã€‚</p>
<h2 id="r40-ä½¿ä»¿å‡½æ•°ç±»å¯é€‚é…">R40 ä½¿ä»¿å‡½æ•°ç±»å¯é€‚é…</h2>
<p>å¯¹å‡½æ•°æŒ‡é’ˆï¼Œè¦å…ˆåº”ç”¨<code>ptr_fun</code>ä¹‹åå†åº”ç”¨<code>not1</code>ä¹‹åæ‰å¯ä»¥å·¥ä½œã€‚</p>
<p>4 ä¸ªæ ‡å‡†çš„å‡½æ•°é…æ¥å™¨(<code>not1</code>ã€<code>not2</code>ã€<code>bind1st</code>ã€<code>bind2nd</code>)éƒ½è¦æ±‚ä¸€äº›ç‰¹æ®Šçš„ç±»å‹å®šä¹‰ï¼Œæä¾›è¿™äº›å¿…è¦ç±»å‹å®šä¹‰(<code>argument_type</code>ã€<code>first_argument_type</code>ã€<code>second_argument_type</code>ã€<code>result_type</code>)çš„å‡½æ•°å¯¹è±¡è¢«ç§°ä¸ºå¯é…æ¥(å¯é€‚é…)(<code>adaptable</code>)çš„å‡½æ•°å¯¹è±¡ã€‚</p>
<p>æä¾›è¿™äº›ç±»å‹å®šä¹‰æœ€ç®€å•çš„æ–¹æ³•ï¼šè®©å‡½æ•°å­ä»ä¸€ä¸ªåŸºç»“æ„ç»§æ‰¿ã€‚</p>
<ul>
<li>å¯¹äº unary_functionï¼Œå¿…é¡»æŒ‡å®šå‡½æ•°å­ç±» operator() æ‰€å¸¦çš„å‚æ•°ç±»å‹ï¼Œä»¥åŠ operator() è¿”å›ç±»å‹ã€‚</li>
<li>å¯¹äº binary_functionï¼Œå¿…é¡»æŒ‡å®š 3 ä¸ªç±»å‹ï¼šoperator() ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå‚æ•°ç±»å‹ï¼Œä»¥åŠ operator() è¿”å›ç±»å‹ã€‚</li>
</ul>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MeetsThreshold</span><span class="o">:</span> <span class="k">public</span> <span class="n">std</span><span class="o">::</span><span class="n">unary_function</span><span class="o">&lt;</span><span class="n">Widget</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">T</span> <span class="n">threshold</span><span class="p">;</span>						<span class="c1">// åŒ…å«çŠ¶æ€ä¿¡æ¯ï¼Œä½¿ç”¨ç±»å°è£…ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">MeetsThreshold</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">threshold</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">WidgetNameCompare</span><span class="o">:</span>					<span class="c1">// STLä¸­æ‰€æœ‰æ— çŠ¶æ€å‡½æ•°å­ç±»ä¸€èˆ¬éƒ½è¢«å®šä¹‰æˆç»“æ„ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">public</span> <span class="n">std</span><span class="o">::</span><span class="n">binary_function</span><span class="o">&lt;</span><span class="n">Widget</span><span class="p">,</span> <span class="n">Widget</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼ é€’ç»™ binary_function æˆ– unary_function çš„éæŒ‡é’ˆç±»å‹éœ€è¦å»æ‰ const å’Œåº”ç”¨(&amp;)éƒ¨åˆ†ã€‚</p>
<h2 id="r41-ç†è§£-ptr_funmem_fun-å’Œ-mem_fun_ref-çš„æ¥ç”±">R41 ç†è§£ ptr_funã€mem_fun å’Œ mem_fun_ref çš„æ¥ç”±</h2>
<p>STLè¯­æ³•æƒ¯ä¾‹ï¼šå‡½æ•°æˆ–è€…å‡½æ•°å¯¹è±¡è¢«è°ƒç”¨æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨éæˆå‘˜å‡½æ•°çš„è¯­æ³•å½¢å¼ã€‚</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">for_each</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">test</span><span class="p">);</span>					<span class="c1">// è°ƒç”¨1ï¼šf(x)ï¼Œfä¸ºéæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">for_each</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">Widget</span><span class="o">::</span><span class="n">test</span><span class="p">);</span>			<span class="c1">// è°ƒç”¨2ï¼šx.f()ï¼Œfä¸ºæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>														<span class="c1">// xæ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å¯¹è±¡çš„å¼•ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">list</span><span class="o">&lt;</span><span class="n">Widget</span> <span class="o">*&gt;</span> <span class="n">lpw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">for_each</span><span class="p">(</span><span class="n">lpw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">lpw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">Widgettest</span><span class="p">);</span>			<span class="c1">// è°ƒç”¨3ï¼šp-&gt;f()ï¼Œfä¸ºæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>														<span class="c1">// pæ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡xçš„æŒ‡é’ˆã€‚
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>mem_funã€mem_fun_tï¼šmem_fun å°†è¯­æ³• 3 è°ƒæ•´ä¸ºè¯­æ³• 1ã€‚</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">R</span><span class="p">,</span> <span class="k">typename</span> <span class="n">C</span><span class="o">&gt;</span>		<span class="c1">//è¯¥mem_funå£°æ˜é’ˆå¯¹ä¸å¸¦å‚æ•°çš„éconstæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mem_fun_t</span><span class="o">&lt;</span><span class="n">R</span><span class="p">,</span><span class="n">C</span><span class="o">&gt;</span>							<span class="c1">//Cæ˜¯ç±»ï¼ŒRæ˜¯æ‰€æŒ‡å‘çš„æˆå‘˜å‡½æ•°è¿”å›çš„ç±»å‹ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mem_fun</span><span class="p">(</span><span class="n">R</span><span class="p">(</span><span class="n">C</span><span class="o">::*</span><span class="n">pmf</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><p>mem_fun å¸¦ä¸€ä¸ªæŒ‡å‘æŸä¸ªæˆå‘˜å‡½æ•°çš„æŒ‡é’ˆå‚æ•° pmfï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ª mem_fun_t ç±»å‹çš„å¯¹è±¡ã€‚</p>
<p>mem_fun_t æ˜¯ä¸€ä¸ªå‡½æ•°å­ç±»ï¼Œå®ƒæ‹¥æœ‰è¯¥æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆï¼Œå¹¶æä¾›äº† operator() å‡½æ•°ï¼Œåœ¨ operator() ä¸­è°ƒç”¨äº†é€šè¿‡å‚æ•°ä¼ é€’è¿›æ¥çš„å¯¹è±¡ä¸Šçš„è¯¥æˆå‘˜å‡½æ•°ã€‚</p>
<p>ç±»ä¼¼åœ°ï¼Œmem_fun_ref å°†è¯­æ³• 2 è°ƒæ•´ä¸ºè¯­æ³• 1ã€‚</p>
<p><strong>æ€»ç»“:</strong></p>
<ul>
<li>std::ptr_funï¼šå°†å‡½æ•°æŒ‡é’ˆè½¬æ¢ä¸ºå‡½æ•°å¯¹è±¡ã€‚</li>
<li>std::mem_funï¼šå°†æˆå‘˜å‡½æ•°è½¬æ¢ä¸ºå‡½æ•°å¯¹è±¡(æŒ‡é’ˆç‰ˆæœ¬)ã€‚</li>
<li>std::mem_fun_refï¼šå°†æˆå‘˜å‡½æ•°è½¬æ¢ä¸ºå‡½æ•°å¯¹è±¡(å¼•ç”¨ç‰ˆæœ¬)ã€‚</li>
</ul>
<h2 id="r42-ç¡®ä¿lesstä¸operatorå…·æœ‰ç›¸åŒçš„è¯­ä¹‰">R42 ç¡®ä¿less<T>ä¸operator&lt;å…·æœ‰ç›¸åŒçš„è¯­ä¹‰</h2>
<p>å°½é‡é¿å…ä¿®æ”¹ less çš„è¡Œä¸ºï¼Œå¯èƒ½ä¼šè¯¯å¯¼å…¶ä»–ç¨‹åºå‘˜ã€‚</p>
<p>å¦‚æœä½ ä½¿ç”¨äº† lessï¼Œæ— è®ºæ˜¯æ˜¾å¼åœ°è¿˜æ˜¯éšå¼åœ°ï¼Œéƒ½éœ€è¦ç¡®ä¿å®ƒä¸ operator&lt; å…·æœ‰ç›¸åŒçš„æ„ä¹‰ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›ä»¥ä¸€ç§ç‰¹æ®Šçš„æ–¹å¼æ¥æ’åˆ—å¯¹è±¡ï¼Œé‚£ä¹ˆæœ€å¥½åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°å­ç±»ã€‚</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªmultiset<Widget>å®¹å™¨ï¼Œå®ƒé»˜è®¤çš„æ¯”è¾ƒå‡½æ•°æ˜¯less<Widget>ï¼Œè€Œless<Widget>åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šè°ƒç”¨operator&lt;æ¥å®Œæˆmultisetçš„æ’åºï¼Œè€Œoperator&lt;æ˜¯æŒ‰ç…§Widgetä¸­æˆå‘˜å˜é‡weightæ¥æ’åºçš„ï¼Œç°åœ¨ç‰¹æ®Šæƒ…å†µä¸‹éœ€è¦ä¸€ä¸ªæŒ‰Widgetä¸­æˆå‘˜å˜é‡speedæ¥æ’åºçš„multisetï¼Œä¸€ç§æ–¹æ³•æ˜¯å…¨ç‰¹åŒ–less<Widget>ï¼Œä½†æ˜¯è¿™ç§åšæ³•å¹¶ä¸å¥½ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½æ˜¯è§‰å¾—è‡ªå·±æŒ‰ç…§weightæ¥æ’åºï¼Œä½†æ˜¯å…¶å®åšçš„å´æ˜¯æŒ‰ç…§speedæ¥æ’åºï¼Œæ›´å¥½çš„åŠæ³•æ˜¯åˆ›å»ºä¸€ä¸ªå‡½æ•°å­ç±»ï¼Œç„¶åç”¨è¯¥å­ç±»åšæ¯”è¾ƒå‡½æ•°ï¼Œè€Œä¸æ˜¯æ”¹å˜lessçš„é»˜è®¤è¡Œä¸ºã€‚</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">speedCompare</span> <span class="o">:</span> <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="n">Widget</span><span class="p">,</span> <span class="n">Widget</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">maxSpeed</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">maxSpeed</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">multiset</span><span class="o">&lt;</span><span class="n">Widget</span><span class="p">,</span> <span class="n">speedCompare</span><span class="o">&gt;</span> <span class="n">widgets</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Ref:</p>
<p>[1]. <a href="https://www.cnblogs.com/Sherry4869/p/15162253.html"target="_blank" rel="external nofollow noopener noreferrer">https://www.cnblogs.com/Sherry4869/p/15162253.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>
[2]. <a href="https://blog.csdn.net/zhuikefeng/article/details/108164117#t35"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/zhuikefeng/article/details/108164117#t35<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>
[3]. <a href="https://zhuanlan.zhihu.com/p/458156007"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/458156007<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>Effective STL [33] | æé˜²åœ¨æŒ‡é’ˆçš„å®¹å™¨ä¸Šä½¿ç”¨ç±»ä¼¼removeçš„ç®—æ³•</title><link>https://jianye0428.github.io/posts/clause_33/</link><pubDate>Sat, 26 Aug 2023 10:55:54 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_33/</guid><description><![CDATA[<h2 id="åˆ é™¤å«æœ‰æŒ‡é’ˆçš„å®¹å™¨å…ƒç´ ">åˆ é™¤å«æœ‰æŒ‡é’ˆçš„å®¹å™¨å…ƒç´ </h2>
<p>å¦‚æœä½ åœ¨ç®¡ç†ä¸€å †åŠ¨æ€åˆ†é…çš„Widgetsï¼Œæ¯ä¸€ä¸ªéƒ½å¯èƒ½é€šè¿‡æ£€éªŒï¼Œä½ æŠŠç»“æœæŒ‡é’ˆä¿å­˜åœ¨ä¸€ä¸ªvectorä¸­ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¿™ä¸ªWidgetæ˜¯å¦é€šè¿‡æ£€éªŒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="n">isCertified</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹ä¸€ä¸ªvectorç„¶åç”¨åŠ¨æ€åˆ†é…çš„Widgetçš„æŒ‡é’ˆå¡«å……
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">*&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Widget</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å½“å’Œvå·¥ä½œä¸€æ®µæ—¶é—´åï¼Œä½ å†³å®šé™¤å»æœªé€šè¿‡æ£€éªŒçš„Widgetï¼Œå› ä¸ºä½ ä¸å†éœ€è¦å®ƒä»¬äº†ã€‚</p>
<p><strong>å°½é‡ç”¨ç®—æ³•è°ƒç”¨ä»£æ›¿æ˜¾å¼å¾ªç¯å’Œå…³äºremoveå’Œeraseä¹‹é—´å…³ç³»çš„æè¿°</strong>ï¼Œä½ è‡ªç„¶ä¼šæƒ³åˆ°è½¬å‘erase-removeæƒ¯ç”¨æ³•ï¼Œè™½ç„¶è¿™æ¬¡ä½ ä½¿ç”¨äº†remove_ifï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">remove_if</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ é™¤æœªé€šè¿‡æ£€éªŒçš„WidgetæŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">not1</span><span class="p">(</span><span class="n">mem_fun</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Widget</span><span class="o">::</span><span class="n">isCertified</span><span class="p">))),</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å…³äºmem_funçš„ä¿¡æ¯å‚è§æ¡æ¬¾41
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ¡æ¬¾7ä»‹ç»è¿‡æ‘§æ¯å®¹å™¨ä¸­çš„ä¸€ä¸ªæŒ‡é’ˆä¹Ÿä¸ä¼šåˆ é™¤æŒ‡é’ˆæŒ‡å‘çš„ä¸œè¥¿çš„è®¨è®ºï¼Œæ‰€ä»¥è¿™é‡Œå½“è°ƒç”¨eraseæ—¶ï¼Œæå¯èƒ½ä½ å·²ç»æ³„æ¼äº†èµ„æºã€‚</p>
<h2 id="èµ„æºæ³„éœ²åˆ†æ">èµ„æºæ³„éœ²åˆ†æ</h2>
<p>æˆ‘ä»¬å‡è®¾åœ¨è°ƒç”¨remove_ifå‰ï¼Œvçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<p></p>
<p>åœ¨è°ƒç”¨remove_ifåï¼Œä¸€èˆ¬æ¥è¯´vçœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆåŒ…å«ä»remove_ifè¿”å›çš„è¿­ä»£å™¨ï¼‰ï¼š</p>
<p></p>
<p>èµ„æºæ³„æ¼çš„ç†ç”±ç°åœ¨å¾ˆæ˜æœ—äº†ã€‚æŒ‡å‘Widget Bå’ŒCçš„â€œåˆ é™¤çš„â€æŒ‡é’ˆè¢«vectorä¸­åé¢çš„â€œä¸åˆ é™¤çš„â€æŒ‡é’ˆè¦†ç›–ã€‚æ²¡æœ‰ä»€ä¹ˆæŒ‡å‘ä¸¤ä¸ªæœªé€šè¿‡æ£€éªŒçš„Widgetï¼Œå®ƒä»¬ä¹Ÿæ²¡æœ‰è¢«åˆ é™¤ï¼Œå®ƒä»¬çš„å†…å­˜å’Œå…¶ä»–èµ„æºæ³„æ¼äº†ã€‚</p>
<p>ä¸€æ—¦remove_ifå’Œeraseè¿”å›åï¼Œæƒ…å†µçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<p></p>
<p>ç°åœ¨ä½ ä¹Ÿå¾ˆæ¸…æ¥šä¸ºä»€ä¹ˆåº”è¯¥åŠªåŠ›é¿å…åœ¨åŠ¨æ€åˆ†é…çš„æŒ‡é’ˆçš„å®¹å™¨ä¸Šä½¿ç”¨removeå’Œç±»ä¼¼ç®—æ³•ï¼ˆremove_ifå’Œuniqueï¼‰ã€‚</p>
<p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½ ä¼šå‘ç°<strong>partitionç®—æ³•æ˜¯åˆç†çš„æ›¿ä»£å“</strong>ã€‚</p>
<h2 id="æ­£ç¡®åˆ é™¤åšæ³•">æ­£ç¡®åˆ é™¤åšæ³•</h2>
<p>å¦‚æœä½ æ— æ³•é¿å…åœ¨é‚£æ ·çš„å®¹å™¨ä¸Šä½¿ç”¨removeï¼Œæ’é™¤è¿™ä¸ªé—®é¢˜ä¸€ç§æ–¹æ³•æ˜¯åœ¨<strong>åº”ç”¨erase-removeæƒ¯ç”¨æ³•ä¹‹å‰å…ˆåˆ é™¤æŒ‡é’ˆå¹¶è®¾ç½®å®ƒä»¬ä¸ºç©ºï¼Œç„¶åé™¤å»å®¹å™¨ä¸­çš„æ‰€æœ‰ç©ºæŒ‡é’ˆ</strong>ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">delAndNullifyUncertified</span><span class="p">(</span><span class="n">Widget</span> <span class="o">*&amp;</span><span class="n">pWidget</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å¦‚æœ*pWidgetæ˜¯ä¸€ä¸ªæœªé€šè¿‡æ£€éªŒWidgetï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pWidget</span><span class="o">-&gt;</span><span class="n">isCertified</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ é™¤æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">delete</span> <span class="n">pWidget</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¹¶ä¸”è®¾ç½®å®ƒä¸ºç©º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">pWidget</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠæ‰€æœ‰æŒ‡å‘æœªé€šè¿‡æ£€éªŒWidgetçš„æŒ‡é’ˆåˆ é™¤å¹¶ä¸”è®¾ç½®ä¸ºç©º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">for_each</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">delAndNullifyUncertified</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä»vä¸­é™¤å»ç©ºæŒ‡é’ˆ0å¿…é¡»æ˜ å°„åˆ°ä¸€ä¸ªæŒ‡é’ˆï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">remove</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">               <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Widget</span> <span class="o">*&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è®©C++å¯ä»¥æ­£ç¡®åœ°æ¨å‡ºremoveçš„ç¬¬ä¸‰ä¸ªå‚æ•°çš„ç±»å‹
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç„¶ï¼Œè¿™å‡è®¾vectorå¹¶ä¸å®¹çº³ä»»ä½•ä½ æƒ³ä¿ç•™çš„ç©ºæŒ‡é’ˆã€‚å¦‚æœæœ‰çš„è¯ï¼Œä½ å¯èƒ½å¿…é¡»è‡ªå·±å†™å¾ªç¯æ¥æŒ‰ä½ çš„æ–¹å¼åˆ é™¤æŒ‡é’ˆã€‚</p>
<h3 id="æ™ºèƒ½æŒ‡é’ˆ">æ™ºèƒ½æŒ‡é’ˆ</h3>
<p>å¦‚æœä½ æŠŠæŒ‡é’ˆçš„å®¹å™¨æ›¿æ¢æˆ<strong>æ‰§è¡Œå¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆçš„å®¹å™¨</strong>ï¼Œåˆ é™¤ç›¸å…³çš„å›°éš¾å°±ä¸å­˜åœ¨äº†ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨erase-removeæƒ¯ç”¨æ³•ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// RCSP = â€œå¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆâ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">RCSP</span> <span class="p">{</span> <span class="p">...};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// RCSPW = â€œRCSP to Widgetâ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="n">RCSP</span><span class="o">&lt;</span> <span class="n">Widget</span><span class="o">&gt;</span> <span class="n">RCSPW</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹ä¸€ä¸ªvectorï¼Œç”¨åŠ¨æ€åˆ†é…Widgetçš„æ™ºèƒ½æŒ‡é’ˆå¡«å……å®ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">RCSPW</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">RCSPW</span><span class="p">(</span><span class="k">new</span> <span class="n">Widget</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// eraseæœªé€šè¿‡æ£€éªŒçš„Widgetçš„æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">remove_if</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="n">not1</span> <span class="p">(</span><span class="n">mem_fun</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Widget</span><span class="o">::</span><span class="n">isCertified</span><span class="p">))),</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ²¡æœ‰èµ„æºæ³„æ¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦è®©è¿™äº›å·¥ä½œï¼Œä½ çš„<strong>æ™ºèƒ½æŒ‡é’ˆç±»å‹å°±å¿…é¡»å¯ä»¥ï¼ˆæ¯”å¦‚<code>RCSP&lt;Widget&gt;</code>ï¼‰éšå¼è½¬æ¢ä¸ºç›¸åº”çš„å†…å»ºæŒ‡é’ˆç±»å‹ï¼ˆæ¯”å¦‚<code>Widget*</code>ï¼‰</strong>ã€‚é‚£æ˜¯å› ä¸ºå®¹å™¨æŒæœ‰æ™ºèƒ½æŒ‡é’ˆï¼Œä½†è¢«è°ƒç”¨çš„æˆå‘˜å‡½æ•°ï¼ˆæ¯”å¦‚<code>Widget::isCertified</code>ï¼‰è¦çš„æ˜¯å†…å»ºæŒ‡é’ˆã€‚å¦‚æœä¸å­˜åœ¨éšå¼è½¬æ¢ï¼Œä½ çš„ç¼–è¯‘å™¨ä¼šæŠ—è®®çš„ã€‚</p>
]]></description></item><item><title>Effective STL ç²¾åº¦æ€»ç»“ [7] | åœ¨ç¨‹åºä¸­ä½¿ç”¨STL</title><link>https://jianye0428.github.io/posts/partseven/</link><pubDate>Mon, 28 Aug 2023 07:58:09 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/partseven/</guid><description><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1>
<blockquote>
<p>Effective-STLæ€»ç»“ç³»åˆ—åˆ†ä¸ºä¸ƒéƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬ä¸ƒéƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬ä¸ƒç« ï¼Œå†…å®¹èŒƒå›´Rule43~50ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule43ç®€å†™ä¸ºR43ã€‚</p>
</blockquote>
<div class="details admonition Note">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Effective-STLç³»åˆ—List<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partone/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/parttwo/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partthree/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partfour/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></div>
    </div>
  </div>
<h2 id="r43-ç®—æ³•è°ƒç”¨ä¼˜å…ˆäºæ‰‹å†™çš„å¾ªç¯">R43 ç®—æ³•è°ƒç”¨ä¼˜å…ˆäºæ‰‹å†™çš„å¾ªç¯</h2>
<p>è°ƒç”¨ç®—æ³•ä¼˜äºæ‰‹å†™å¾ªç¯ï¼š</p>
<ul>
<li>æ•ˆç‡ï¼š<strong>ç®—æ³•</strong>æ¯”æ‰‹å†™çš„å¾ªç¯<strong>æ•ˆç‡æ›´é«˜</strong>ã€‚</li>
<li>æ­£ç¡®æ€§ï¼šæ‰‹å†™å¾ªç¯æ¯”ä½¿ç”¨ç®—æ³•å®¹æ˜“å‡ºé”™ã€‚</li>
<li>å¯ç»´æŠ¤æ€§ï¼šä½¿ç”¨ç®—æ³•çš„ä»£ç æ›´åŠ ç®€æ´æ˜äº†ã€‚</li>
</ul>
<p>ä¾‹å­ï¼šP155ï¼Œ</p>
<p>ç®—æ³•çš„åç§°è¡¨æ˜äº†å®ƒçš„åŠŸèƒ½ï¼Œè€Œ forã€whileã€do å¾ªç¯ä¸èƒ½ã€‚</p>
<p>æ‰‹å†™å¾ªç¯éœ€è¦ç»´æŠ¤è¿­ä»£å™¨çš„æœ‰æ•ˆæ€§ã€‚</p>
<p>Ref:</p>
<p>[1]. <a href="https://www.cnblogs.com/Sherry4869/p/15162253.html"target="_blank" rel="external nofollow noopener noreferrer">https://www.cnblogs.com/Sherry4869/p/15162253.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>
[2]. <a href="https://blog.csdn.net/zhuikefeng/article/details/108164117#t35"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/zhuikefeng/article/details/108164117#t35<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>
[3]. <a href="https://zhuanlan.zhihu.com/p/458156007"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/458156007<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>Effective STL [4] | ç”¨emptyæ¥ä»£æ›¿æ£€æŸ¥size()æ˜¯å¦ä¸º0</title><link>https://jianye0428.github.io/posts/clause_4/</link><pubDate>Mon, 24 Jul 2023 13:15:46 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_4/</guid><description><![CDATA[<h2 id="åˆ¤æ–­å®¹å™¨æ˜¯å¦ä¸ºç©º">åˆ¤æ–­å®¹å™¨æ˜¯å¦ä¸ºç©º</h2>
<p>å¯¹äºä»»æ„å®¹å™¨ randy, å½“åˆ¤æ–­æ˜¯å¦ä¸ºç©ºçš„æ—¶å€™ï¼Œä¼šä½¿ç”¨åˆ°ä»¥ä¸‹åˆ¤æ–­è¯­å¥ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="n">randy</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// work
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// or
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="n">randy</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// work
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åº”è¯¥é¦–é€‰emptyçš„æ„é€ ï¼Œè€Œä¸”ç†ç”±å¾ˆç®€å•ï¼š<strong>å¯¹äºæ‰€æœ‰çš„æ ‡å‡†å®¹å™¨ï¼Œemptyæ˜¯ä¸€ä¸ªå¸¸æ•°æ—¶é—´çš„æ“ä½œï¼Œä½†å¯¹äºä¸€äº›<code>list</code>å®ç°ï¼Œ<code>size</code>èŠ±è´¹çº¿æ€§æ—¶é—´</strong></p>
<h2 id="list-sizeè€—æ—¶">list sizeè€—æ—¶</h2>
<p><strong>Q</strong>ï¼šä½†æ˜¯ä»€ä¹ˆé€ æˆlistè¿™ä¹ˆéº»çƒ¦ï¼Ÿä¸ºä»€ä¹ˆä¸èƒ½ä¹Ÿæä¾›ä¸€ä¸ªå¸¸æ•°æ—¶é—´çš„sizeï¼Ÿ</p>
<p><strong>A</strong>ï¼šå¯¹äºlistç‰¹æœ‰çš„spliceæœ‰å¾ˆå¤šè¦å¤„ç†çš„ä¸œè¥¿ã€‚</p>
<p>è€ƒè™‘è¿™æ®µä»£ç ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">list1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">list2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">list1</span><span class="p">.</span><span class="n">splice</span><span class="p">(</span> <span class="c1">// æŠŠlist2ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">list1</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">list2</span><span class="p">,</span> <span class="c1">// ä»ç¬¬ä¸€æ¬¡å‡ºç°5åˆ°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">find</span><span class="p">(</span><span class="n">list2</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">list2</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">5</span><span class="p">),</span> <span class="c1">// æœ€åä¸€æ¬¡å‡ºç°10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">find</span><span class="p">(</span><span class="n">list2</span><span class="p">.</span><span class="n">rbegin</span><span class="p">(),</span> <span class="n">list2</span><span class="p">.</span><span class="n">rend</span><span class="p">(),</span> <span class="mi">10</span><span class="p">).</span><span class="n">base</span><span class="p">()</span> <span class="c1">// çš„æ‰€æœ‰èŠ‚ç‚¹ç§»åˆ°list1çš„ç»“å°¾ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤é<code>list2</code>åœ¨5çš„åé¢æœ‰ä¸€ä¸ª10ï¼Œå¦åˆ™è¿™æ®µä»£ç æ— æ³•å·¥ä½œï¼Œä½†æ˜¯å’±ä»¬å‡è®¾è¿™ä¸æ˜¯é—®é¢˜ã€‚</p>
<p><strong>Q</strong>ï¼šå‡è®¾ä¸Šè¿°ä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œé‚£ä¹ˆæ¥åˆå<code>list1</code>æœ‰å¤šå°‘å…ƒç´ ï¼Ÿ</p>
<p><strong>A</strong>ï¼šç»“åˆå<code>list1</code>çš„å…ƒç´ ä¸ªæ•°=æ¥åˆä¹‹åå‰<code>list1</code>çš„å…ƒç´ ä¸ªæ•° + æ¥åˆè¿›å»çš„å…ƒç´ ä¸ªæ•°</p>
<p><strong>Q</strong>ï¼šæœ‰å¤šå°‘å…ƒç´ æ¥åˆè¿›å»äº†ï¼Ÿ</p>
<p><strong>A</strong>ï¼šå…ƒç´ ä¸ªæ•°ä¸º<code>find(list2.rbegin(), list2.rend(), 10).base()</code>æ‰€å®šä¹‰çš„åŒºé—´çš„å…ƒç´ ä¸ªæ•°ã€‚</p>
<p>åˆ°åº•æœ‰å¤šå°‘ï¼Ÿ</p>
<p>åœ¨æ²¡æœ‰éå†è¿™ä¸ªåŒºé—´å¹¶è®¡æ•°ä¹‹å‰æ— æ³•çŸ¥é“ã€‚</p>
<p><strong>é—®é¢˜å‰–æ</strong></p>
<p>å¦‚æœsizeæ˜¯ä¸€ä¸ªå¸¸æ•°æ—¶é—´æ“ä½œï¼Œå½“æ“ä½œæ—¶æ¯ä¸ªlistæˆå‘˜å‡½æ•°å¿…é¡»æ›´æ–°listçš„å¤§å°ã€‚ä¹ŸåŒ…æ‹¬äº†spliceã€‚</p>
<p>è®©åŒºé—´ç‰ˆæœ¬çš„spliceæ›´æ–°å®ƒæ‰€æ›´æ”¹çš„listå¤§å°çš„<strong>å”¯ä¸€çš„æ–¹æ³•</strong>æ˜¯ç®—å‡ºæ¥åˆè¿›æ¥çš„å…ƒç´ çš„ä¸ªæ•°ï¼Œä½†<strong>é‚£ä¹ˆåšå°±ä¼šä½¿å®ƒä¸å¯èƒ½æœ‰ä½ æ‰€å¸Œæœ›çš„å¸¸æ•°æ—¶é—´çš„æ€§èƒ½ã€‚</strong></p>
<p>å¦‚æœä½ å»æ‰äº†spliceçš„åŒºé—´å½¢å¼è¦æ›´æ–°å®ƒæ‰€ä¿®æ”¹çš„listçš„å¤§å°çš„éœ€æ±‚ï¼Œspliceå°±å¯ä»¥æ˜¯å¸¸æ•°æ—¶é—´ï¼Œä½†<strong>sizeå°±å˜æˆçº¿æ€§æ—¶é—´çš„æ“ä½œ</strong>ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œ<strong>å¿…é¡»éå†å®ƒçš„æ•´ä¸ªæ•°æ®ç»“æ„æ¥æ‰çŸ¥é“åŒ…å«å¤šå°‘å…ƒç´ </strong>ã€‚</p>
<p>ä¸åŒçš„listå®ç°ç”¨ä¸åŒçš„æ–¹å¼è§£å†³è¿™ä¸ªçŸ›ç›¾ï¼Œä¾èµ–äºä»–ä»¬çš„ä½œè€…é€‰æ‹©çš„æ˜¯è®©sizeæˆ–spliceçš„åŒºé—´å½¢å¼è¾¾åˆ°æœ€é«˜æ•ˆç‡ã€‚</p>
<p>å¦‚æœä½ ç¢°å·§ä½¿ç”¨äº†ä¸€ä¸ªå¸¸æ•°æ—¶é—´çš„spliceçš„åŒºé—´å½¢å¼æ¯”å¸¸æ•°æ—¶é—´çš„sizeä¼˜å…ˆçº§æ›´é«˜çš„listå®ç°ï¼Œ<strong>è°ƒç”¨emptyæ¯”è°ƒç”¨sizeæ›´å¥½ï¼Œå› ä¸ºemptyæ€»æ˜¯å¸¸æ•°æ—¶é—´æ“ä½œã€‚</strong></p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>ä¸åŒçš„listå®ç°ç”¨ä¸åŒçš„æ–¹å¼è§£å†³è¿™ä¸ªçŸ›ç›¾ï¼Œä¾èµ–äºå®ƒä»¬çš„ä½œè€…é€‰æ‹©çš„æ˜¯è®©sizeæˆ–spliceçš„åŒºé—´å½¢å¼è¾¾åˆ°æœ€é«˜æ•ˆç‡ã€‚</p>
<p>å¦‚æœä½ ç¢°å·§ä½¿ç”¨äº†ä¸€ä¸ªå¸¸æ•°æ—¶é—´çš„spliceçš„åŒºé—´å½¢å¼æ¯”å¸¸æ•°æ—¶é—´çš„sizeä¼˜å…ˆçº§æ›´é«˜çš„listå®ç°ï¼Œ<font color=blue>è°ƒç”¨emptyæ¯”è°ƒç”¨sizeæ›´å¥½ï¼Œå› ä¸ºemptyæ€»æ˜¯å¸¸æ•°æ—¶é—´æ“ä½œã€‚</font></p>
<h2 id="stl-vector-å’Œ-listçš„empty-åŠ-size--å®ç°æºç ">STL vector å’Œ listçš„empty åŠ size  å®ç°æºç </h2>
<p><strong>vector</strong></p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// vector
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">size_type</span>
</span></span><span class="line"><span class="cl">  <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="n">_GLIBCXX_NOEXCEPT</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="k">return</span> <span class="n">size_type</span><span class="p">(</span><span class="n">end</span><span class="p">()</span> <span class="o">-</span> <span class="n">begin</span><span class="p">());</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">  <span class="nf">empty</span><span class="p">()</span> <span class="k">const</span> <span class="n">_GLIBCXX_NOEXCEPT</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="k">return</span> <span class="n">begin</span><span class="p">()</span> <span class="o">==</span> <span class="n">end</span><span class="p">();</span> <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>list</strong></p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// list
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/**  Returns the number of elements in the %list.  */</span>
</span></span><span class="line"><span class="cl"><span class="n">size_type</span>
</span></span><span class="line"><span class="cl"><span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="n">_GLIBCXX_NOEXCEPT</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="k">return</span> <span class="n">_M_node_count</span><span class="p">();</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// return the stored size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">size_t</span>
</span></span><span class="line"><span class="cl">      <span class="nf">_M_node_count</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">_M_get_size</span><span class="p">();</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// size() è°ƒç”¨ _M_get_size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="n">size_t</span> <span class="nf">_M_get_size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_M_impl</span><span class="p">.</span><span class="n">_M_node</span><span class="p">.</span><span class="n">_M_size</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// [23.2.2.2] capacity
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">*  Returns true if the %list is empty.  (Thus begin() would equal
</span></span></span><span class="line"><span class="cl"><span class="cm">*  end().)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="n">_GLIBCXX_NODISCARD</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="nf">empty</span><span class="p">()</span> <span class="k">const</span> <span class="n">_GLIBCXX_NOEXCEPT</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">_M_impl</span><span class="p">.</span><span class="n">_M_node</span><span class="p">.</span><span class="n">_M_next</span> <span class="o">==</span> <span class="o">&amp;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">_M_impl</span><span class="p">.</span><span class="n">_M_node</span><span class="p">;</span> <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>Effective STL [5] | å°½é‡ä½¿ç”¨åŒºé—´æˆå‘˜å‡½æ•°ä»£æ›¿å®ƒä»¬çš„å•å…ƒç´ å…„å¼Ÿ</title><link>https://jianye0428.github.io/posts/clause_5/</link><pubDate>Mon, 24 Jul 2023 13:15:50 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_5/</guid><description><![CDATA[<h2 id="example">Example</h2>
<p>Qï¼šç»™å®šä¸¤ä¸ªvectorï¼Œv1å’Œv2ï¼Œä½¿v1çš„å†…å®¹å’Œv2çš„ååŠéƒ¨åˆ†ä¸€æ ·çš„æœ€ç®€å•æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>Aï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">v1</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v2</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">v2</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">v2</span><span class="p">.</span><span class="n">end</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªæµ‹éªŒè®¾è®¡ä¸ºåšä¸¤ä»¶äº‹:</p>
<ol>
<li>å®ƒæä¾›ç»™æˆ‘ä¸€ä¸ªæœºä¼šæ¥æé†’ä½ assignæˆå‘˜å‡½æ•°çš„å­˜åœ¨</li>
</ol>
<p>å¤ªå¤šçš„ç¨‹åºå‘˜æ²¡æ³¨æ„åˆ°è¿™æ˜¯ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„æ–¹æ³•ã€‚<strong>å®ƒå¯¹äºæ‰€æœ‰æ ‡å‡†åºåˆ—å®¹å™¨ï¼ˆvectorï¼Œstringï¼Œdequeå’Œlistï¼‰éƒ½æœ‰æ•ˆã€‚</strong></p>
<p>æ— è®ºä½•æ—¶ä½ å¿…é¡»å®Œå…¨ä»£æ›¿ä¸€ä¸ªå®¹å™¨çš„å†…å®¹ï¼Œä½ å°±åº”è¯¥æƒ³åˆ°èµ‹å€¼ã€‚</p>
<p>å¦‚æœä½ åªæ˜¯æ‹·è´ä¸€ä¸ªå®¹å™¨åˆ°å¦ä¸€ä¸ªåŒç±»å‹çš„å®¹å™¨ï¼Œ<code>operator=</code>å°±æ˜¯é€‰æ‹©çš„èµ‹å€¼å‡½æ•°ï¼Œä½†å¯¹äºç¤ºèŒƒçš„é‚£ä¸ªä¾‹å­ï¼Œå½“ä½ æƒ³è¦ç»™ä¸€ä¸ªå®¹å™¨å®Œå…¨çš„æ–°æ•°æ®é›†æ—¶ï¼Œassignå°±å¯ä»¥åˆ©ç”¨ï¼Œä½†<code>operator=</code>åšä¸äº†ã€‚</p>
<ol start="2">
<li>æ¼”ç¤ºä¸ºä»€ä¹ˆåŒºé—´æˆå‘˜å‡½æ•°ä¼˜å…ˆäºå®ƒä»¬çš„å•å…ƒç´ æ›¿ä»£å“ã€‚</li>
</ol>
<p>åŒºé—´æˆå‘˜å‡½æ•°æ˜¯ä¸€ä¸ªåƒSTLç®—æ³•çš„æˆå‘˜å‡½æ•°ï¼Œä½¿ç”¨ä¸¤ä¸ªè¿­ä»£å™¨å‚æ•°æ¥æŒ‡å®šå…ƒç´ çš„ä¸€ä¸ªåŒºé—´æ¥è¿›è¡ŒæŸä¸ªæ“ä½œã€‚</p>
<p>ä¸ç”¨åŒºé—´æˆå‘˜å‡½æ•°æ¥è§£å†³è¿™ä¸ªæ¡æ¬¾å¼€å¤´çš„é—®é¢˜ï¼Œä½ å°±å¿…é¡»å†™ä¸€ä¸ªæ˜¾å¼å¾ªç¯ï¼Œå¯èƒ½å°±åƒè¿™æ ·:</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="n">Randy</span><span class="o">&gt;</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// å‡è®¾v1å’Œv2æ˜¯Randyçš„vector
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v1</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Randy</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">ci</span> <span class="o">=</span> <span class="n">v2</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">v2</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ci</span> <span class="o">!=</span> <span class="n">v2</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">ci</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">*</span><span class="n">ci</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å†™è¿™æ®µä»£ç æ¯”å†™assignçš„è°ƒç”¨è¦åšå¤šå¾—å¤šçš„å·¥ä½œã€‚</p>
<p><strong>copy æ›¿ä»£å¾ªç¯</strong></p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">v1</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">copy</span><span class="p">(</span><span class="n">v2</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">v2</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">v2</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">back_inserter</span><span class="p">(</span><span class="n">v1</span><span class="p">))</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è™½ç„¶åœ¨è¿™æ®µä»£ç ä¸­æ²¡æœ‰è¡¨ç°å‡ºå¾ªç¯ï¼Œåœ¨copyä¸­çš„ç¡®å­˜åœ¨ä¸€ä¸ªå¾ªç¯ ã€‚</p>
<p>æ•ˆç‡æŸå¤±ä»ç„¶å­˜åœ¨ã€‚</p>
<p>å‡ ä¹æ‰€æœ‰ç›®æ ‡åŒºé—´æ˜¯é€šè¿‡æ’å…¥è¿­ä»£å™¨ï¼ˆæ¯”å¦‚ï¼Œé€šè¿‡inserterï¼Œback_inserteræˆ–front_inserterï¼‰æŒ‡å®šçš„copyçš„ä½¿ç”¨éƒ½å¯ä»¥â€”â€”åº”è¯¥â€”â€”é€šè¿‡è°ƒç”¨åŒºé—´ æˆå‘˜å‡½æ•°æ¥ä»£æ›¿ã€‚</p>
<p>æ¯”å¦‚è¿™é‡Œï¼Œè¿™ä¸ªcopyçš„è°ƒç”¨å¯ä»¥ç”¨ä¸€ä¸ªinsertçš„åŒºé—´ç‰ˆæœ¬ä»£æ›¿ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">v1</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">v1</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">v2</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">v2</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">v2</span><span class="p">.</span><span class="n">end</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªè¾“å…¥é‡ç¨å¾®æ¯”è°ƒç”¨copyå°‘ï¼Œä½†å®ƒå‘ç”Ÿçš„ä¹Ÿæ¯”è¯´çš„è¦ç›´æ¥ï¼šæ•°æ®æ’å…¥v1ã€‚</p>
<p>è¿™é‡Œinsert ä¹Ÿæ¯” copy å¥½ï¼Œå› ä¸ºå­—é¢ä¸Šinsert è¡¨ç¤ºæœ‰æ•°æ®æ’å…¥åˆ°äº† v1ä¸­ï¼Œè€Œcopy çš„ä½¿ç”¨æŠŠå®ƒå˜å¾—æ™¦æ¶©ã€‚</p>
<p><strong>å…³äºä¸œè¥¿è¢«æ‹·è´è¿™ä¸ªäº‹å®å¹¶æ²¡æœ‰ä»€ä¹ˆå¥½å…³æ³¨çš„ï¼Œå› ä¸ºSTLæ„å»ºåœ¨ä¸œè¥¿ä¼šè¢«æ‹·è´çš„å‡å®šä¸Šã€‚æ‹·è´å¯¹STLæ¥è¯´å¾ˆåŸºæœ¬ã€‚</strong></p>
<p><strong>å°ç»“</strong></p>
<p>æˆ‘ä»¬å·²ç»ç¡®å®š3ä¸ªå°½é‡ä½¿ç”¨åŒºé—´æˆå‘˜å‡½æ•°ä»£æ›¿å®ƒä»¬çš„å•å…ƒç´ å…„å¼Ÿçš„ç†ç”±ã€‚ â— ä¸€èˆ¬æ¥è¯´ä½¿ç”¨åŒºé—´æˆå‘˜å‡½æ•°å¯ä»¥è¾“å…¥æ›´å°‘çš„ä»£ç ã€‚ â— åŒºé—´æˆå‘˜å‡½æ•°ä¼šå¯¼è‡´ä»£ç æ›´æ¸…æ™°æ›´ç›´æ¥äº†å½“ã€‚</p>
<h2 id="æ•ˆç‡">æ•ˆç‡</h2>
<p>å½“å¤„ç†æ ‡å‡†åºåˆ—å®¹å™¨æ—¶ï¼Œåº”ç”¨å•å…ƒç´ æˆå‘˜å‡½æ•°æ¯”å®ŒæˆåŒæ ·ç›®çš„çš„åŒºé—´æˆå‘˜å‡½æ•°éœ€è¦æ›´å¤šåœ°å†…å­˜åˆ†é…ï¼Œæ›´é¢‘ç¹åœ°æ‹·è´å¯¹è±¡ï¼Œè€Œä¸”/æˆ–è€…é€ æˆå¤šä½™æ“ä½œã€‚</p>
<p>å¯¹æ­¤ï¼Œæˆ‘ä¹‹å‰è¿˜åšäº†ä¸ªå•å…ƒç´ å…„å¼Ÿæ’å…¥å’Œæ‰¹é‡æ’å…¥çš„æ•ˆç‡æ¯”è¾ƒçš„æ–‡ç« <a href="https://mp.weixin.qq.com/s?__biz=MzUyMDc2MDMxNg==&amp;mid=2247490268&amp;idx=1&amp;sn=fcf5b24ec09e544f1f0fea544e59bfd6&amp;chksm=f9e4244fce93ad5988926b2cba002426ada65b79d4672b7bad565fff633c52a29f9f451d6494&amp;token=855912511&amp;lang=zh_CN&amp;scene=21#wechat_redirect"target="_blank" rel="external nofollow noopener noreferrer">ã€Švector ç”¨ insert æ‰¹é‡æ’å…¥æ•ˆç‡é«˜è¿˜æ˜¯emplace_backæ•ˆç‡é«˜ã€‹<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼Œä¹Ÿè¯å®äº†è¿™ä¸ªè§‚ç‚¹ã€‚</p>
<p>æ ‡å‡†è¦æ±‚åŒºé—´<code>insert</code>å‡½æ•°ç›´æ¥æŠŠç°æœ‰å…ƒç´ ç§»åŠ¨åˆ°å®ƒä»¬æœ€åçš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ï¼Œå¼€é”€æ˜¯æ¯ä¸ªå…ƒç´ ä¸€æ¬¡ç§»åŠ¨ã€‚æ€»å…±å¼€é”€æ˜¯næ¬¡ç§»åŠ¨ï¼ŒnumValuesæ¬¡å®¹å™¨ä¸­çš„å¯¹è±¡ç±»å‹çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œå‰©ä¸‹çš„æ˜¯ç±»å‹çš„èµ‹å€¼æ“ä½œç¬¦ã€‚</p>
<p>ç›¸æ¯”å•å…ƒç´ æ’å…¥ç­–ç•¥ï¼ŒåŒºé—´insertå°‘æ‰§è¡Œäº†n*(numValues-1)æ¬¡ç§»åŠ¨ã€‚</p>
<p>èŠ±ä¸€åˆ†é’Ÿæƒ³æƒ³ã€‚è¿™æ„å‘³ç€å¦‚æœnumValuesæ˜¯100ï¼Œinsertçš„åŒºé—´å½¢å¼ä¼šæ¯”é‡å¤è°ƒç”¨insertçš„å•å…ƒç´ å½¢å¼çš„ä»£ç å°‘èŠ±è´¹99%çš„ç§»åŠ¨ï¼</p>
<p>ä»…å½“å¯ä»¥ä¸ç”¨å¤±å»ä¸¤ä¸ªè¿­ä»£å™¨çš„ä½ç½®å°±èƒ½å†³å®šå®ƒä»¬ä¹‹é—´çš„è·ç¦»æ—¶ï¼Œä¸€ä¸ªåŒºé—´insertå‡½æ•°æ‰èƒ½åœ¨ä¸€æ¬¡ç§»åŠ¨ä¸­æŠŠä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°å®ƒçš„æœ€ç»ˆä½ç½®ã€‚</p>
<p>è¿™å‡ ä¹æ€»æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºæ‰€æœ‰å‰å‘è¿­ä»£å™¨æä¾›äº†è¿™ä¸ªåŠŸèƒ½ï¼Œè€Œä¸”å‰å‘è¿­ä»£å™¨å‡ ä¹åˆ°å¤„éƒ½æ˜¯ã€‚</p>
<p>æ‰€æœ‰ç”¨äºæ ‡å‡†å®¹å™¨çš„è¿­ä»£å™¨éƒ½æä¾›äº†å‰å‘è¿­ä»£å™¨çš„åŠŸèƒ½ã€‚éæ ‡å‡†çš„æ•£åˆ—å®¹å™¨çš„è¿­ä»£å™¨ä¹Ÿæ˜¯ã€‚</p>
<p>åœ¨æ•°ç»„ä¸­è¡¨ç°ä¸ºè¿­ä»£å™¨çš„æŒ‡é’ˆä¹Ÿæä¾›äº†è¿™æ ·çš„åŠŸèƒ½ã€‚äº‹å®ä¸Šï¼Œå”¯ä¸€ä¸æä¾›å‰å‘è¿­ä»£å™¨èƒ½åŠ›çš„æ ‡å‡†è¿­ä»£å™¨æ˜¯è¾“å…¥å’Œè¾“å‡ºè¿­ä»£å™¨ã€‚</p>
<p><strong>å•å…ƒç´ æ’å…¥çš„é—®é¢˜</strong></p>
<ul>
<li>
<p>å½“ä½ è¯•å›¾å»æŠŠä¸€ä¸ªå…ƒç´ æ’å…¥å†…å­˜å·²ç»æ»¡äº†çš„vectoræ—¶ï¼Œè¿™ä¸ªvectorä¼šåˆ†é…å…·æœ‰æ›´å¤šå®¹é‡çš„æ–°å†…å­˜ï¼Œä»æ—§å†…å­˜æŠŠå®ƒçš„å…ƒç´ æ‹·è´åˆ°æ–°å†…å­˜ï¼Œé”€æ¯æ—§å†…å­˜é‡Œçš„å…ƒç´ ï¼Œå›æ”¶æ—§å†…å­˜ã€‚ç„¶åå®ƒæ·»åŠ æ’å…¥çš„å…ƒç´ ã€‚</p>
</li>
<li>
<p>æ¯å½“ç”¨å®Œå†…å­˜æ—¶ï¼Œå¤§éƒ¨åˆ†vectorå®ç°éƒ½ä½¿å®ƒä»¬çš„å®¹é‡ç¿»å€ï¼Œæ‰€ä»¥æ’å…¥numValuesä¸ªæ–°å…ƒç´ ä¼šå¯¼è‡´æœ€å¤š$\log_2{numValues}$æ¬¡æ–°å†…å­˜çš„åˆ†é…ã€‚</p>
</li>
<li>
<p>æ¯æ¬¡ä¸€ä¸ªåœ°æ’å…¥1000ä¸ªå…ƒç´ ä¼šå¯¼è‡´10æ¬¡æ–°çš„åˆ†é…ï¼ˆåŒ…æ‹¬å®ƒä»¬è´Ÿè´£çš„å…ƒç´ æ‹·è´ï¼‰ã€‚</p>
</li>
</ul>
<p>ä¸ä¹‹å¯¹æ¯”çš„æ˜¯ï¼Œä¸€ä¸ªåŒºé—´æ’å…¥å¯ä»¥åœ¨å¼€å§‹æ’å…¥ä¸œè¥¿å‰è®¡ç®—å‡ºéœ€è¦å¤šå°‘æ–°å†…å­˜ï¼ˆå‡è®¾ç»™çš„æ˜¯å‰å‘è¿­ä»£å™¨ï¼‰ï¼Œæ‰€ä»¥å®ƒä¸ç”¨å¤šäºä¸€æ¬¡åœ°é‡æ–°åˆ†é…vectorçš„å†…åœ¨å†…å­˜ã€‚</p>
<p>åˆšæ‰è¿›è¡Œåˆ†ææ˜¯ç”¨äºvectorçš„ï¼Œä½†åŒæ ·çš„ç†ç”±ä¹Ÿä½œç”¨äºstringã€‚</p>
<p><strong>deque</strong></p>
<p>å¯¹äºdequeï¼Œç†ç”±ä¹Ÿå¾ˆç›¸ä¼¼ï¼Œä½†dequeç®¡ç†å®ƒä»¬å†…å­˜çš„æ–¹å¼å’Œvectorå’Œstringä¸åŒï¼Œæ‰€ä»¥é‡å¤å†…å­˜åˆ†é…çš„è®ºç‚¹ä¸èƒ½åº”ç”¨ã€‚</p>
<p>ä½†æ˜¯ï¼Œå…³äº<strong>å¾ˆå¤šæ¬¡ä¸å¿…è¦çš„å…ƒç´ ç§»åŠ¨</strong>çš„è®ºç‚¹é€šå¸¸é€šè¿‡å¯¹å‡½æ•°è°ƒç”¨æ¬¡æ•°çš„è§‚å¯Ÿä¹Ÿåº”ç”¨åˆ°äº†ï¼ˆè™½ç„¶ç»†èŠ‚ä¸åŒï¼‰ã€‚</p>
<p><strong>list</strong></p>
<p>åœ¨è¿™é‡Œä½¿ç”¨insertåŒºé—´å½¢å¼ä»£æ›¿å•å…ƒç´ å½¢å¼ä¹Ÿæœ‰ä¸€ä¸ªæ€§èƒ½ä¼˜åŠ¿ã€‚</p>
<p>å…³äºé‡å¤å‡½æ•°è°ƒç”¨çš„è®ºç‚¹å½“ç„¶ç»§ç»­æœ‰æ•ˆï¼Œä½†å› ä¸ºé“¾è¡¨çš„å·¥ä½œæ–¹å¼ï¼Œæ‹·è´å’Œå†…å­˜åˆ†é…é—®é¢˜æ²¡æœ‰å‘ç”Ÿã€‚</p>
<p>å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ–°é—®é¢˜ï¼šè¿‡å¤šé‡å¤åœ°å¯¹listä¸­çš„ä¸€äº›èŠ‚ç‚¹çš„nextå’ŒprevæŒ‡é’ˆèµ‹å€¼ã€‚</p>
<p>æ¯å½“ä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°ä¸€ä¸ªé“¾è¡¨æ—¶ï¼ŒæŒæœ‰å…ƒç´ çš„é“¾è¡¨èŠ‚ç‚¹å¿…é¡»æœ‰å®ƒçš„nextå’ŒprevæŒ‡é’ˆé›†ï¼Œè€Œä¸”å½“ç„¶æ–°èŠ‚ç‚¹å‰é¢çš„èŠ‚ç‚¹ï¼ˆæˆ‘ä»¬å«å®ƒBï¼Œå°±æ˜¯â€œbeforeâ€ï¼‰å¿…é¡»è®¾ç½®å®ƒçš„nextæŒ‡é’ˆï¼Œæ–°èŠ‚ç‚¹åé¢çš„èŠ‚ç‚¹ï¼ˆæˆ‘ä»¬å«å®ƒAï¼Œå°±æ˜¯â€œafterâ€ï¼‰å¿…é¡»è®¾ç½®å®ƒçš„prevæŒ‡é’ˆ</p>
<p></p>
<p>å½“ä¸€ç³»åˆ—æ–°èŠ‚ç‚¹é€šè¿‡è°ƒç”¨listçš„å•å…ƒç´ insertä¸€ä¸ªæ¥ä¸€ä¸ªæ·»åŠ æ—¶ï¼Œé™¤äº†æœ€åä¸€ä¸ªä»¥å¤–çš„å…¶ä»–æ–°èŠ‚ç‚¹éƒ½ä¼šè®¾ç½®å®ƒçš„nextæŒ‡é’ˆä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡æŒ‡å‘Aï¼Œç¬¬äºŒæ¬¡æŒ‡å‘åœ¨å®ƒåé¢æ’å…¥çš„å…ƒç´ ã€‚æ¯æ¬¡åœ¨Aå‰é¢æ’å…¥æ—¶ï¼Œå®ƒéƒ½ä¼šè®¾ç½®å®ƒçš„prevæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ–°èŠ‚ç‚¹ã€‚</p>
<p>å¦‚æœnumValuesä¸ªèŠ‚ç‚¹æ’å…¥Aå‰é¢ï¼Œæ’å…¥èŠ‚ç‚¹çš„nextæŒ‡é’ˆä¼šå‘ç”Ÿæ¬¡å¤šä½™çš„èµ‹å€¼ï¼Œè€Œä¸”Açš„prevæŒ‡é’ˆä¼šå‘ç”ŸnumValues-1æ¬¡å¤šä½™çš„èµ‹å€¼ã€‚åˆè®¡æ¬¡æ²¡æœ‰å¿…è¦çš„æŒ‡é’ˆèµ‹å€¼ã€‚å½“ç„¶ï¼ŒæŒ‡é’ˆèµ‹å€¼å¾ˆè½»é‡ï¼Œä½†å¦‚æœä¸æ˜¯å¿…é¡»ï¼Œä¸ºä»€ä¹ˆè¦ä¸ºå®ƒä»¬èŠ±è´¹å‘¢ï¼Ÿ</p>
<p>**é¿å…å¼€é”€çš„å…³é”®æ˜¯ä½¿ç”¨listçš„insertåŒºé—´å½¢å¼ã€‚**å› ä¸ºé‚£ä¸ªå‡½æ•°çŸ¥é“æœ€åæœ‰å¤šå°‘èŠ‚ç‚¹ä¼šè¢«æ’å…¥ï¼Œå®ƒå¯ä»¥é¿å…å¤šä½™çš„æŒ‡é’ˆèµ‹å€¼ï¼Œå¯¹æ¯ä¸ªæŒ‡é’ˆåªä½¿ç”¨ä¸€æ¬¡èµ‹å€¼å°±èƒ½è®¾ç½®å®ƒæ­£ç¡®çš„æ’å…¥åçš„å€¼</p>
<h2 id="åŒºé—´å‡½æ•°">åŒºé—´å‡½æ•°</h2>
<p>å‚æ•°ç±»å‹iteratoræ„æ€æ˜¯å®¹å™¨çš„è¿­ä»£å™¨ç±»å‹ï¼Œä¹Ÿå°±æ˜¯container::iteratorã€‚</p>
<p>å‚æ•°ç±»å‹InputIteratoræ„æ€æ˜¯å¯ä»¥æ¥å—ä»»ä½•è¾“å…¥è¿­ä»£å™¨ã€‚</p>
<ul>
<li><strong>åŒºé—´æ„é€ </strong></li>
</ul>
<p>æ‰€æœ‰æ ‡å‡†å®¹å™¨éƒ½æä¾›è¿™ç§å½¢å¼çš„æ„é€ å‡½æ•°ï¼š</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">container</span><span class="o">::</span><span class="n">container</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">begin</span><span class="p">,</span> <span class="c1">// åŒºé—´çš„èµ·ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">InputIterator</span> <span class="n">end</span><span class="p">);</span> <span class="c1">// åŒºé—´çš„ç»ˆç‚¹
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä¼ ç»™è¿™ä¸ªæ„é€ å‡½æ•°çš„è¿­ä»£å™¨æ˜¯<code>istream_iterators</code>æˆ–<code>istreambuf_iterators</code>ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°C++çš„æœ€æƒŠå¼‚çš„è§£æï¼ŒåŸå› ä¹‹ä¸€æ˜¯ä½ çš„ç¼–è¯‘å™¨å¯èƒ½ä¼šå› ä¸ºæŠŠè¿™ä¸ªæ„é€ çœ‹ä½œä¸€ä¸ªå‡½æ•°å£°æ˜è€Œä¸æ˜¯ä¸€ä¸ªæ–°å®¹å™¨å¯¹è±¡çš„å®šä¹‰è€Œä¸­æ–­ã€‚</p>
<ul>
<li><strong>åŒºé—´æ’å…¥</strong></li>
</ul>
<p>æ‰€æœ‰æ ‡å‡†åºåˆ—å®¹å™¨éƒ½æä¾›è¿™ç§å½¢å¼çš„insert:</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">container</span><span class="o">::</span><span class="n">insert</span><span class="p">(</span><span class="n">iterator</span> <span class="n">position</span><span class="p">,</span> <span class="c1">// åŒºé—´æ’å…¥çš„ä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">InputIterator</span> <span class="n">begin</span><span class="p">,</span> <span class="c1">// æ’å…¥åŒºé—´çš„èµ·ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">InputIterator</span> <span class="n">end</span><span class="p">);</span> <span class="c1">// æ’å…¥åŒºé—´çš„ç»ˆç‚¹
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…³è”å®¹å™¨ä½¿ç”¨å®ƒä»¬çš„æ¯”è¾ƒå‡½æ•°æ¥å†³å®šå…ƒç´ è¦æ”¾åœ¨å“ªé‡Œï¼Œæ‰€ä»¥å®ƒä»¬äº†çœç•¥positionå‚æ•°ã€‚</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">container</span><span class="o">::</span><span class="n">insert</span><span class="p">(</span><span class="n">lnputIterator</span> <span class="n">begin</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">end</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å½“å¯»æ‰¾ç”¨åŒºé—´ç‰ˆæœ¬ä»£æ›¿å•å…ƒç´ æ’å…¥çš„æ–¹æ³•æ—¶ï¼Œä¸è¦å¿˜è®°æœ‰äº›å•å…ƒç´ å˜é‡ç”¨é‡‡ç”¨ä¸åŒçš„å‡½æ•°åä¼ªè£…å®ƒä»¬è‡ªå·±ã€‚æ¯”å¦‚ï¼Œ<code>push_front</code>å’Œ<code>push_back</code>éƒ½æŠŠå•å…ƒç´ æ’å…¥å®¹å™¨ï¼Œå³ä½¿å®ƒä»¬ä¸å«<code>insert</code>ã€‚å¦‚æœä½ çœ‹è§ä¸€ä¸ªå¾ªç¯è°ƒç”¨<code>push_front</code>æˆ–<code>push_back</code>ï¼Œæˆ–å¦‚æœä½ çœ‹è§ä¸€ä¸ªç®—æ³•â€”â€”æ¯”å¦‚copyâ€”â€”çš„å‚æ•°æ˜¯<code>front_inserter</code>æˆ–è€…<code>back_inserter</code>ï¼Œä½ å°±å‘ç°äº†ä¸€ä¸ª<code>insert</code>çš„åŒºé—´å½¢å¼åº”è¯¥ä½œä¸ºä¼˜å…ˆç­–ç•¥çš„åœ°æ–¹ã€‚</p>
<ul>
<li><strong>åŒºé—´åˆ é™¤</strong></li>
</ul>
<p>æ¯ä¸ªæ ‡å‡†å®¹å™¨éƒ½æä¾›äº†ä¸€ä¸ªåŒºé—´å½¢å¼çš„<code>erase</code>ï¼Œä½†æ˜¯åºåˆ—å’Œå…³è”å®¹å™¨çš„è¿”å›ç±»å‹ä¸åŒã€‚</p>
<p><strong>åºåˆ—å®¹å™¨</strong>æä¾›äº†è¿™ä¸ªï¼š</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">iterator</span> <span class="n">container</span><span class="o">::</span><span class="n">erase</span><span class="p">(</span><span class="n">iterator</span> <span class="n">begin</span><span class="p">,</span> <span class="n">iterator</span> <span class="n">end</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…³è”å®¹å™¨æä¾›è¿™ä¸ª:</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">container</span><span class="o">::</span><span class="n">erase</span><span class="p">(</span><span class="n">iterator</span> <span class="n">begin</span><span class="p">,</span> <span class="n">iterator</span> <span class="n">end</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Qï¼šä¸ºä»€ä¹ˆä¸åŒï¼Ÿ</p>
<p>Aï¼šè§£é‡Šæ˜¯ï¼Œå¦‚æœeraseçš„å…³è”å®¹å™¨ç‰ˆæœ¬è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆè¢«åˆ é™¤çš„é‚£ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªï¼‰ä¼š<strong>æ‹›è‡´ä¸€ä¸ªæ— æ³•æ¥å—çš„æ€§èƒ½ä¸‹é™</strong>ã€‚</p>
<p>è¿™ä¸ªæ¡æ¬¾çš„å¯¹insertçš„æ€§èƒ½åˆ†æå¤§éƒ¨åˆ†ä¹ŸåŒæ ·å¯ä»¥ç”¨äºeraseã€‚å•å…ƒç´ åˆ é™¤çš„å‡½æ•°è°ƒç”¨æ¬¡æ•°ä»ç„¶å¤§äºä¸€æ¬¡è°ƒç”¨åŒºé—´åˆ é™¤ã€‚å½“ä½¿ç”¨å•å…ƒç´ åˆ é™¤æ—¶ï¼Œæ¯ä¸€æ¬¡å…ƒç´ å€¼ä»ç„¶å¿…é¡»å‘å®ƒä»¬çš„ç›®çš„åœ°ç§»åŠ¨ä¸€ä½ï¼Œè€ŒåŒºé—´åˆ é™¤å¯ä»¥åœ¨ä¸€ä¸ªå•ç‹¬çš„ç§»åŠ¨ä¸­æŠŠå®ƒä»¬ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®ã€‚</p>
<p>å…³äºvectorå’Œstringçš„æ’å…¥å’Œåˆ é™¤çš„ä¸€ä¸ªè®ºç‚¹æ˜¯å¿…é¡»åšå¾ˆå¤šé‡å¤çš„åˆ†é…ã€‚ï¼ˆå½“ç„¶å¯¹äºåˆ é™¤ï¼Œä¼šå‘ç”Ÿé‡å¤çš„å›æ”¶ã€‚ï¼‰é‚£æ˜¯å› ä¸ºç”¨äºvectorå’Œstringçš„å†…å­˜è‡ªåŠ¨å¢é•¿æ¥é€‚åº”äºæ–°å…ƒç´ ï¼Œä½†å½“å…ƒç´ çš„æ•°ç›®å‡å°‘æ—¶å®ƒä¸è‡ªåŠ¨æ”¶ç¼©ã€‚</p>
<ul>
<li><strong>åŒºé—´èµ‹å€¼</strong></li>
</ul>
<p>æ‰€æœ‰æ ‡å‡†åˆ—å®¹å™¨éƒ½æä¾›äº†åŒºé—´å½¢å¼çš„assign:</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">container</span><span class="o">::</span><span class="n">assign</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">begin</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">end</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç»“è®º">ç»“è®º</h2>
<p>å‡ ä¹æ‰€æœ‰ç›®æ ‡åŒºé—´è¢«æ’å…¥è¿­ä»£å™¨æŒ‡å®šçš„copyçš„ä½¿ç”¨éƒ½å¯ä»¥ç”¨è°ƒç”¨çš„åŒºé—´æˆå‘˜å‡½æ•°çš„æ¥ä»£æ›¿ ã€‚</p>
<p>å°½é‡ä½¿ç”¨åŒºé—´æˆå‘˜å‡½æ•°æ¥ä»£æ›¿å•å…ƒç´ å…„å¼Ÿçš„ä¸‰ä¸ªå¯é çš„è®ºç‚¹ã€‚åŒºé—´æˆå‘˜å‡½æ•°æ›´å®¹æ˜“å†™ï¼Œå®ƒä»¬æ›´æ¸…æ¥šåœ°è¡¨è¾¾ä½ çš„æ„å›¾ï¼Œè€Œä¸”å®ƒä»¬æä¾›äº†æ›´é«˜çš„æ€§èƒ½ã€‚é‚£æ˜¯å¾ˆéš¾æ‰“è´¥çš„ä¸‰é©¾é©¬è½¦ã€‚</p>
<p>ref:</br>
[1]. <a href="https://mp.weixin.qq.com/s?__biz=MzUyMDc2MDMxNg==&amp;mid=2247490705&amp;idx=1&amp;sn=830797e69b61fe9693bf4aaea72df4b3&amp;chksm=f9e42202ce93ab1437ad36c37e141b0794328495c0c584d808d0f4ad36251680dbfba257b060&amp;cur_album_id=3009999611861975043&amp;scene=189#wechat_redirect"target="_blank" rel="external nofollow noopener noreferrer">https://mp.weixin.qq.com/s?__biz=MzUyMDc2MDMxNg==&mid=2247490705&idx=1&sn=830797e69b61fe9693bf4aaea72df4b3&chksm=f9e42202ce93ab1437ad36c37e141b0794328495c0c584d808d0f4ad36251680dbfba257b060&cur_album_id=3009999611861975043&scene=189#wechat_redirect<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>Effective STL [6] | è­¦æƒ•C++æœ€ä»¤äººæ¼æ€’çš„è§£æ</title><link>https://jianye0428.github.io/posts/clause_6/</link><pubDate>Mon, 24 Jul 2023 13:15:53 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_6/</guid><description><![CDATA[<h2 id="å‡½æ•°å£°æ˜çš„å‡ ç§æ–¹å¼">å‡½æ•°å£°æ˜çš„å‡ ç§æ–¹å¼</h2>
<ol>
<li>å£°æ˜ä¸€ä¸ªå‡½æ•°få¸¦æœ‰ä¸€ä¸ªdoubleè€Œä¸”è¿”å›ä¸€ä¸ªintï¼š</li>
</ol>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">f</span><span class="p">(</span><span class="kt">double</span> <span class="n">d</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>åä¸ºdçš„å‚æ•°å·¦å³çš„æ‹¬å·æ˜¯å¤šä½™çš„ï¼Œè¢«å¿½ç•¥ï¼š</li>
</ol>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">f</span><span class="p">(</span><span class="kt">double</span> <span class="p">(</span><span class="n">d</span><span class="p">));</span> <span class="c1">// åŒä¸Šï¼›då·¦å³çš„æ‹¬å·è¢«å¿½ç•¥
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>çœç•¥äº†å‚æ•°åï¼š</li>
</ol>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">f</span><span class="p">(</span><span class="kt">double</span><span class="p">);</span> <span class="c1">// åŒä¸Šï¼›å‚æ•°åè¢«çœç•¥
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>ç¬¬ä¸€ä¸ªå£°æ˜äº†ä¸€ä¸ªå‡½æ•°gï¼Œå®ƒå¸¦æœ‰ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¸ªå‚æ•°æ˜¯æŒ‡å‘ä¸€ä¸ªæ²¡æœ‰å‚æ•°ã€è¿”å›doubleçš„å‡½æ•°çš„æŒ‡é’ˆï¼š</li>
</ol>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">g</span><span class="p">(</span><span class="kt">double</span> <span class="p">(</span><span class="o">*</span><span class="n">pf</span><span class="p">)());</span> <span class="c1">// gå¸¦æœ‰ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆä½œä¸ºå‚æ•°
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>å”¯ä¸€çš„ä¸åŒæ˜¯pfä½¿ç”¨éæŒ‡é’ˆè¯­æ³•æ¥å£°æ˜(ä¸€ä¸ªåœ¨Cå’ŒC++ä¸­éƒ½æœ‰æ•ˆçš„è¯­æ³•):</li>
</ol>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">g</span><span class="p">(</span><span class="kt">double</span> <span class="n">pf</span><span class="p">());</span> <span class="c1">// åŒä¸Šï¼›pfå…¶å®æ˜¯ä¸€ä¸ªæŒ‡é’ˆ
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="6">
<li>ç…§å¸¸ï¼Œå‚æ•°åå¯ä»¥çœç•¥ï¼Œæ‰€ä»¥è¿™æ˜¯gçš„ç¬¬ä¸‰ç§å£°æ˜ï¼Œå»æ‰äº†pfè¿™ä¸ªåå­—ï¼š</li>
</ol>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">g</span><span class="p">(</span><span class="kt">double</span> <span class="p">());</span> <span class="c1">// åŒä¸Šï¼›å‚æ•°åçœç•¥
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„å‚æ•°åå·¦å³çš„æ‹¬å·ï¼ˆå°±åƒfçš„ç¬¬äºŒç§å£°æ˜ä¸­çš„dï¼‰å’Œå•ç‹¬çš„æ‹¬å·ï¼ˆæ­£å¦‚æœ¬ä¾‹ï¼‰ä¹‹é—´çš„åŒºåˆ«ã€‚</p>
<p><strong>å‚æ•°åå·¦å³çš„æ‹¬å·è¢«å¿½ç•¥ï¼Œä½†å•ç‹¬çš„æ‹¬å·æŒ‡å‡ºå­˜åœ¨ä¸€ä¸ªå‚æ•°åˆ—è¡¨ï¼šå®ƒä»¬å£°æ˜äº†å­˜åœ¨æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆçš„å‚æ•°ã€‚</strong></p>
<h2 id="é—®é¢˜æ¢è®¨">é—®é¢˜æ¢è®¨</h2>
<p>å‡è®¾æœ‰ä¸€ä¸ªintçš„æ–‡ä»¶ï¼Œæƒ³è¦æŠŠé‚£äº›intæ‹·è´åˆ°ä¸€ä¸ªlistä¸­ï¼Œå¯èƒ½ä¼šä½¿ç”¨ä¸‹é¢ä»£ç ï¼š</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">ifstream</span> <span class="nf">dataFile</span><span class="p">(</span><span class="s">&#34;ints.dat&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è­¦å‘Šï¼è¿™å®Œæˆçš„å¹¶ä¸æ˜¯åƒä½ æƒ³è±¡çš„é‚£æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">(</span><span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dataFile</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„æƒ³æ³•æ˜¯ä¼ ä¸€å¯¹<code>istream_iterator</code>ç»™<code>list</code>çš„åŒºé—´æ„é€ å‡½æ•°ï¼Œå› æ­¤æŠŠintä»æ–‡ä»¶æ‹·è´åˆ°listä¸­ã€‚</p>
<p>è¿™æ®µä»£ç å¯ä»¥ç¼–è¯‘ï¼Œä½†æ˜¯è¿è¡Œæ—¶ä»€ä¹ˆéƒ½ä¸ä¼šåšï¼Œä¸ä¼šä»æ–‡ä»¶ä¸­è¯»å‡ºä»»ä½•æ•°æ®ï¼Œç”šè‡³ä¸ä¼šæ„å»º1ä¸ª<code>list</code>ã€‚</p>
<p>ç¬¬äºŒå¥å¹¶ä¸å£°æ˜listï¼Œä¹Ÿä¸è°ƒç”¨æ„é€ å‡½æ•°ã€‚</p>
<p>è¿™å£°æ˜äº†ä¸€ä¸ªå‡½æ•°dataï¼Œå®ƒçš„è¿”å›ç±»å‹æ˜¯<code>list&lt;int&gt;</code>ã€‚è¿™ä¸ªå‡½æ•°dataå¸¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼š</p>
<p>â— ç¬¬1ä¸ªå‚æ•°å«åšdataFileã€‚å®ƒçš„ç±»å‹æ˜¯<code>istream_iterator&lt;int&gt;</code>ã€‚dataFileå·¦å³çš„æ‹¬å·æ˜¯å¤šä½™çš„è€Œä¸”è¢«å¿½ç•¥ã€‚</p>
<p>â— ç¬¬2ä¸ªå‚æ•°æ²¡æœ‰åå­—ã€‚å®ƒçš„ç±»å‹æ˜¯æŒ‡å‘ä¸€ä¸ªæ²¡æœ‰å‚æ•°è€Œä¸”è¿”å›<code>istream_iterator&lt;int&gt;</code>çš„å‡½æ•°çš„æŒ‡é’ˆã€‚</p>
<p>å°±åƒä¸‹é¢å…·æœ‰è¿™æ¡è§„åˆ™çš„ä»£ç ï¼š</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{...};</span> <span class="c1">// å‡è®¾Widgetæœ‰é»˜è®¤æ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Widget</span> <span class="nf">w</span><span class="p">();</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™å¹¶æ²¡æœ‰å£°æ˜ä¸€ä¸ªå«åšwçš„Widgetï¼Œå®ƒå£°æ˜äº†ä¸€ä¸ªå«ä½œwçš„æ²¡æœ‰å‚æ•°ä¸”è¿”å›Widgetçš„å‡½æ•°ã€‚</p>
<p>æœ¬æ¥ä»£ç çš„åˆè¡·ï¼Œæ˜¯ç”¨ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ¥åˆå§‹åŒ–ä¸€ä¸ª<code>list&lt;int&gt;</code>å¯¹è±¡ï¼Œç°åœ¨å¹¶æ²¡æœ‰è¾¾åˆ°æˆ‘ä»¬çš„æœŸæœ›ã€‚</p>
<h2 id="è§£å†³åŠæ³•">è§£å†³åŠæ³•</h2>
<ol>
<li>å‡½æ•°è°ƒç”¨å‰åå¢åŠ æ‹¬å·
ç”¨æ‹¬å·åŒ…å›´ä¸€ä¸ªå®å‚çš„å£°æ˜æ˜¯ä¸åˆæ³•çš„ï¼Œä½†ç”¨æ‹¬å·åŒ…å›´ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„è§‚ç‚¹æ˜¯åˆæ³•çš„ï¼Œæ‰€ä»¥é€šè¿‡å¢åŠ ä¸€å¯¹æ‹¬å·ï¼Œä»£ç å˜ä¸ºï¼š</li>
</ol>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">((</span><span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dataFile</span><span class="p">)),</span> <span class="c1">// æ³¨æ„åœ¨listæ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå®å‚å·¦å³çš„æ–°æ‹¬å·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ˜¯å¯èƒ½çš„å£°æ˜æ•°æ®æ–¹æ³•ï¼Œç»™äºˆ<code>istream_iterators</code>çš„å®ç”¨æ€§å’ŒåŒºé—´æ„é€ å‡½æ•°ã€‚</p>
<ol start="2">
<li>å‘½åè¿­ä»£å™¨å¯¹è±¡</li>
</ol>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">ifstream</span> <span class="nf">dataFile</span><span class="p">(</span><span class="s">&#34;ints.dat&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dataBegin</span><span class="p">(</span><span class="n">dataFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dataEnd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">(</span><span class="n">dataBegin</span><span class="p">,</span> <span class="n">dataEnd</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å‘½åè¿­ä»£å™¨å¯¹è±¡çš„ä½¿ç”¨å’Œæ™®é€šçš„STLç¼–ç¨‹é£æ ¼ç›¸åï¼Œä½†æ˜¯ä½ å¾—åˆ¤æ–­è¿™ç§æ–¹æ³•å¯¹ç¼–è¯‘å™¨å’Œå¿…é¡»ä½¿ç”¨ç¼–è¯‘å™¨çš„äººéƒ½æ¨¡æ£±ä¸¤å¯çš„ä»£ç æ˜¯ä¸€ä¸ªå€¼å¾—ä»˜å‡ºçš„ä»£ä»·ã€‚</p>
]]></description></item><item><title>Transformer Q &amp; A</title><link>https://jianye0428.github.io/posts/transformerqanda/</link><pubDate>Mon, 21 Aug 2023 07:59:36 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/transformerqanda/</guid><description><![CDATA[<h2 id="1-2017å¹´æ·±åº¦å­¦ä¹ é¢†åŸŸçš„é‡å¤§çªç ´æ˜¯ä»€ä¹ˆ">1. 2017å¹´æ·±åº¦å­¦ä¹ é¢†åŸŸçš„é‡å¤§çªç ´æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>Transformerã€‚æœ‰ä¸¤æ–¹é¢çš„åŸå› :</p>
<p>1.1 ä¸€æ–¹é¢ï¼ŒTransformeræ˜¯æ·±åº¦å­¦ä¹ é¢†åŸŸç»§MLPã€RNNã€CNNä¹‹åçš„ç¬¬4å¤§ç‰¹å¾æå–å™¨(ä¹Ÿè¢«ç§°ä¸ºåŸºç¡€æ¨¡å‹)ã€‚</br>
<strong>ä»€ä¹ˆæ˜¯ç‰¹å¾æå–å™¨ï¼Ÿ</strong></br>
ç‰¹å¾æå–å™¨æ˜¯è®¡ç®—æœºæ¨¡ä»¿å¤§è„‘ï¼Œä¸å¤–éƒ¨ä¸–ç•Œ(å›¾åƒã€æ–‡å­—ã€è¯­éŸ³ç­‰)äº¤äº’çš„æ–¹å¼ï¼Œå¦‚å›¾1æ‰€ç¤ºã€‚ä¸¾ä¾‹è€Œè¨€: Imagenetæ•°æ®é›†ä¸­åŒ…å«1000ç±»å›¾åƒï¼Œäººä»¬å·²ç»æ ¹æ®è‡ªå·±çš„ç»éªŒæŠŠè¿™ä¸€ç™¾ä¸‡å¼ å›¾åƒåˆ†å¥½1000ç±»ï¼Œæ¯ä¸€ç±»å›¾åƒ(å¦‚ç¾æ´²è±¹)éƒ½æœ‰ç‹¬ç‰¹çš„ç‰¹å¾ã€‚è¿™æ—¶ï¼Œç¥ç»ç½‘ç»œ(å¦‚ResNet18)ä¹Ÿæ˜¯æƒ³é€šè¿‡è¿™ç§åˆ†ç±»çš„æ–¹å¼ï¼ŒæŠŠæ¯ä¸€ç±»å›¾åƒçš„ç‰¹å¾å°½å¯èƒ½æå–æˆ–è¯†åˆ«å‡ºæ¥ã€‚åˆ†ç±»ä¸æ˜¯æœ€ç»ˆç›®çš„ï¼Œè€Œæ˜¯ä¸€ç§æå–å›¾åƒç‰¹å¾çš„æ‰‹æ®µï¼Œæ©ç è¡¥å…¨å›¾åƒä¹Ÿæ˜¯ä¸€ç§æå–ç‰¹å¾çš„æ–¹å¼ï¼Œå›¾åƒå—é¡ºåºæ‰“ä¹±ä¹Ÿæ˜¯ä¸€ç§æå–ç‰¹å¾çš„æ–¹å¼ã€‚</p>
<p></p>
<p>1.2 å¦ä¸€æ–¹é¢ï¼ŒTransformeråœ¨æ·±åº¦å­¦ä¹ é¢†åŸŸæ‰®æ¼”çš„è§’è‰²: ç¬¬3æ¬¡å’Œç¬¬4æ¬¡çƒ­æ½®çš„åŸºçŸ³ï¼Œå¦‚ä¸‹å›¾2æ‰€ç¤ºã€‚</p>
<p></p>
<h2 id="2-transformerçš„æå‡ºèƒŒæ™¯æ˜¯ä»€ä¹ˆ">2. Transformerçš„æå‡ºèƒŒæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><strong>2.1 åœ¨é¢†åŸŸå‘å±•èƒŒæ™¯å±‚é¢</strong>: å½“æ—¶æ—¶å¤„2017å¹´ï¼Œæ·±åº¦å­¦ä¹ åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸå·²ç»ç«äº†å‡ å¹´ã€‚ä»Alexnetã€VGGã€GoogleNetã€ResNetã€DenseNet;ä»å›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹å†åˆ°è¯­ä¹‰åˆ†å‰²;ä½†åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸå¹¶æ²¡æœ‰å¼•èµ·å¾ˆå¤§åå“ã€‚</p>
<p><strong>2.2 æŠ€æœ¯èƒŒæ™¯å±‚é¢</strong>:
(1)å½“æ—¶ä¸»æµçš„åºåˆ—è½¬å½•ä»»åŠ¡(å¦‚æœºå™¨ç¿»è¯‘)çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹å›¾3æ‰€ç¤ºï¼Œåœ¨Sequence to Sequenceæ¶æ„ä¸‹(Encoder-Decoderçš„ä¸€ç§)ï¼ŒRNNæ¥æå–ç‰¹å¾ï¼ŒAttentionæœºåˆ¶å°†Encoderæå–åˆ°çš„ç‰¹å¾é«˜æ•ˆä¼ é€’ç»™Decoderã€‚
(2)è¿™ç§åšæ³•æœ‰ä¸¤ä¸ªä¸è¶³ä¹‹å¤„ï¼Œä¸€æ–¹é¢æ˜¯åœ¨æå–ç‰¹å¾æ—¶çš„RNNå¤©ç”Ÿ<strong>ä»å‰å‘åæ—¶åºä¼ é€’</strong>çš„ç»“æ„å†³å®šäº†å…¶æ— æ³•å¹¶è¡Œè¿ç®—ï¼Œå…¶æ¬¡æ˜¯å½“åºåˆ—é•¿åº¦è¿‡é•¿æ—¶ï¼Œæœ€å‰é¢åºåˆ—çš„ä¿¡æ¯æœ‰å¯èƒ½è¢«é—å¿˜æ‰ã€‚å› æ­¤å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæ¡†æ¶ä¸‹ï¼ŒRNNæ˜¯ç›¸å¯¹è–„å¼±æ€¥éœ€æ”¹è¿›çš„åœ°æ–¹ã€‚</p>
<p></p>
<h2 id="3-transformeråˆ°åº•æ˜¯ä»€ä¹ˆ">3. Transformeråˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>3.1 Transformeræ˜¯ä¸€ç§ç”±Encoderå’ŒDecoderç»„æˆçš„æ¶æ„ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯æ¶æ„å‘¢ï¼Ÿæœ€ç®€å•çš„æ¶æ„å°±æ˜¯A + B + Cã€‚</p>
<p>3.2 Transformerä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ˜¯â€œæˆ‘çˆ±å­¦ä¹ â€ï¼Œè¾“å‡ºæ˜¯â€œI love studyâ€ã€‚</p>
<p>3.3 å¦‚æœæŠŠTransformerçš„æ¶æ„è¿›è¡Œåˆ†æ‹†ï¼Œå¦‚å›¾4æ‰€ç¤ºã€‚</p>
<p></p>
<h2 id="4-ä»€ä¹ˆæ˜¯transformer-encoder">4. ä»€ä¹ˆæ˜¯Transformer Encoderï¼Ÿ</h2>
<p>4.1 ä»<font color=red>åŠŸèƒ½è§’åº¦</font>ï¼ŒTransformer Encoderçš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>æå–ç‰¹å¾</strong>ï¼Œä¹Ÿæœ‰ä½¿ç”¨Transformer Decoderæ¥æå–ç‰¹å¾ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªäººå­¦ä¹ è·³èˆï¼ŒEncoderæ˜¯çœ‹åˆ«äººæ˜¯å¦‚ä½•è·³èˆçš„ï¼ŒDecoderæ˜¯å°†å­¦ä¹ åˆ°çš„ç»éªŒå’Œè®°å¿†(keyå’Œvalueçš„åŒ¹é…ç¨‹åº¦)ï¼Œå±•ç°å‡ºæ¥</p>
<p>4.2 ä»<font color=red>ç»“æ„è§’åº¦</font>ï¼Œå¦‚å›¾5æ‰€ç¤ºï¼ŒTransformer Encoder = Embedding + Positional Embedding + N * (å­Encoder block1 + å­Encoder block2);</p>
<p>å­Encoder block1 = Multi head attention + ADD + Norm;</p>
<p>å­Encoder block2 = Feed Forward + ADD + Norm;</p>
<p>4.3 ä»<font color=red>è¾“å…¥è¾“å‡ºè§’åº¦</font>ï¼ŒNä¸ªTransformer Encoder blockä¸­çš„ç¬¬ä¸€ä¸ªEncoder blockçš„è¾“å…¥ä¸ºä¸€ç»„å‘é‡ X = (Embedding + Positional Embedding)ï¼Œå‘é‡ç»´åº¦é€šå¸¸ä¸º512*512ï¼Œå…¶ä»–Nä¸ªTransformerEncoder blockçš„è¾“å…¥ä¸ºä¸Šä¸€ä¸ª Transformer Encoder blockçš„è¾“å‡ºï¼Œè¾“å‡ºå‘é‡çš„ç»´åº¦ä¹Ÿä¸º<code>512*512</code>(è¾“å…¥è¾“å‡ºå¤§å°ç›¸åŒ)ã€‚</p>
<p>4.4 ä¸ºä»€ä¹ˆæ˜¯<code>512*512</code>ï¼Ÿ<font color=red>å‰è€…æ˜¯æŒ‡tokençš„ä¸ªæ•°</font>ï¼Œå¦‚â€œæˆ‘çˆ±å­¦ä¹ â€æ˜¯4ä¸ªtokenï¼Œè¿™é‡Œè®¾ç½®ä¸º512æ˜¯ä¸ºäº†å›Šæ‹¬ä¸åŒçš„åºåˆ—é•¿åº¦ï¼Œä¸å¤Ÿæ—¶paddingã€‚<font color=red>åè€…æ˜¯æŒ‡æ¯ä¸€ä¸ªtokenç”Ÿæˆçš„å‘é‡ç»´åº¦</font>ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªtokenä½¿ç”¨ä¸€ä¸ªåºåˆ—é•¿åº¦ä¸º512çš„å‘é‡è¡¨ç¤ºã€‚äººä»¬å¸¸è¯´ï¼ŒTransformerä¸èƒ½è¶…è¿‡512ï¼Œå¦åˆ™ç¡¬ä»¶å¾ˆéš¾æ”¯æ’‘;å…¶å®512æ˜¯æŒ‡å‰è€…ï¼Œä¹Ÿå°±æ˜¯tokençš„ä¸ªæ•°ï¼Œå› ä¸ºæ¯ä¸€ä¸ªtokenè¦åšself attentionæ“ä½œ;ä½†æ˜¯åè€…çš„512ä¸å®œè¿‡å¤§ï¼Œå¦åˆ™è®¡ç®—èµ·æ¥ä¹Ÿå¾ˆæ…¢ã€‚</p>
<p></p>
<h2 id="5-ä»€ä¹ˆæ˜¯transformer-decoder">5. ä»€ä¹ˆæ˜¯Transformer Decoderï¼Ÿ</h2>
<p>5.1 ä»åŠŸèƒ½è§’åº¦ï¼Œç›¸æ¯”äºTransformer Encoderï¼ŒTransformer Decoderæ›´æ“…é•¿åš<strong>ç”Ÿæˆå¼ä»»åŠ¡</strong>ï¼Œå°¤å…¶å¯¹äºè‡ªç„¶è¯­è¨€å¤„ç†é—®é¢˜ã€‚</p>
<p>5.2 ä»ç»“æ„è§’åº¦ï¼Œå¦‚å›¾6æ‰€ç¤ºï¼ŒTransformer Decoder = Embedding + Positional Embedding + N*(å­Decoder block1 + å­Decoder block2 + å­Decoder block3)+ Linear + Softmax;</p>
<p>å­Decoder block1 = Mask Multi head attention + ADD + Norm;</p>
<p>å­Decoder block2 = Multi head attention + ADD + Norm;</p>
<p>å­Decoder block3 = Feed Forward + ADD + Norm;</p>
<p></p>
<p>5.3 ä»(Embedding+Positional Embedding)(Nä¸ªDecoder block)(Linear + softmax) è¿™ä¸‰ä¸ªæ¯ä¸€ä¸ªå•ç‹¬ä½œç”¨è§’åº¦:</p>
<p>Embedding + Positional Embedding: ä»¥æœºå™¨ç¿»è¯‘ä¸ºä¾‹ï¼Œè¾“å…¥â€œMachine Learningâ€ï¼Œè¾“å‡ºâ€œæœºå™¨å­¦ä¹ â€; è¿™é‡Œçš„Embeddingæ˜¯æŠŠâ€œæœºå™¨å­¦ä¹ â€ä¹Ÿè½¬åŒ–æˆå‘é‡çš„å½¢å¼ã€‚</p>
<p>Nä¸ªDecoder block: ç‰¹å¾å¤„ç†å’Œä¼ é€’è¿‡ç¨‹ã€‚</p>
<p>Linear + softmax: softmaxæ˜¯é¢„æµ‹ä¸‹ä¸€ä¸ªè¯å‡ºç°çš„æ¦‚ç‡ï¼Œå¦‚å›¾7æ‰€ç¤ºï¼Œå‰é¢çš„Linearå±‚ç±»ä¼¼äºåˆ†ç±»ç½‘ç»œ(ResNet18)æœ€ååˆ†ç±»å±‚å‰æ¥çš„MLPå±‚ã€‚</p>
<p></p>
<p>5.4 Transformer Decoderçš„è¾“å…¥ã€è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿåœ¨Trainå’ŒTestæ—¶æ˜¯ä¸åŒçš„ã€‚</p>
<p>åœ¨Trainé˜¶æ®µï¼Œå¦‚å›¾8æ‰€ç¤ºã€‚è¿™æ—¶æ˜¯çŸ¥é“labelçš„ï¼Œdecoderçš„ç¬¬ä¸€ä¸ªè¾“å…¥æ˜¯beginå­—ç¬¦ï¼Œè¾“å‡ºç¬¬ä¸€ä¸ªå‘é‡ä¸labelä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦ä½¿ç”¨cross entropy lossã€‚Decoderçš„ç¬¬äºŒä¸ªè¾“å…¥æ˜¯ç¬¬ä¸€ä¸ªå‘é‡çš„labelï¼ŒDecoderçš„ç¬¬Nä¸ªè¾“å…¥å¯¹åº”çš„è¾“å‡ºæ˜¯Endå­—ç¬¦ï¼Œåˆ°æ­¤ç»“æŸã€‚è¿™é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œåœ¨Trainé˜¶æ®µæ˜¯å¯ä»¥è¿›è¡Œ<strong>å¹¶è¡Œè®­ç»ƒ</strong>çš„ã€‚</p>
<p></p>
<p>åœ¨Testé˜¶æ®µï¼Œä¸‹ä¸€ä¸ªæ—¶åˆ»çš„è¾“å…¥æ˜¯å‰ä¸€ä¸ªæ—¶åˆ»çš„è¾“å‡ºï¼Œå¦‚å›¾9æ‰€ç¤ºã€‚å› æ­¤ï¼ŒTrainå’ŒTestæ—¶å€™ï¼ŒDecoderçš„è¾“å…¥ä¼šå‡ºç°Mismatchï¼Œåœ¨Testæ—¶å€™ç¡®å®æœ‰å¯èƒ½ä¼šå‡ºç°ä¸€æ­¥é”™ï¼Œæ­¥æ­¥é”™çš„æƒ…å†µã€‚æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ: ä¸€ç§æ˜¯trainæ—¶å¶å°”ç»™ä¸€äº›é”™è¯¯ï¼Œå¦ä¸€ç§æ˜¯Scheduled samplingã€‚</p>
<p></p>
<p>5.5 Transformer Decoder blockå†…éƒ¨çš„è¾“å…¥å’Œè¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å‰é¢æåˆ°çš„æ˜¯åœ¨æ•´ä½“trainå’Œtesté˜¶æ®µï¼ŒDecoderçš„è¾“å…¥å’Œè¾“å‡ºï¼Œé‚£ä¹ˆTransformer Decoderå†…éƒ¨çš„Transformer Decoder blockï¼Œå¦‚å›¾10æ‰€ç¤ºï¼Œçš„è¾“å…¥è¾“å‡ºåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p></p>
<p>å¯¹äºN=6ä¸­çš„ç¬¬1æ¬¡å¾ªç¯(N=1æ—¶): å­Decoder block1 çš„è¾“å…¥æ˜¯ embedding +Positional Embeddingï¼Œå­Decoder block2 çš„è¾“å…¥çš„Qæ¥è‡ªå­Decoder block1çš„è¾“å‡ºï¼ŒKVæ¥è‡ªTransformer Encoderæœ€åä¸€å±‚çš„è¾“å‡ºã€‚</p>
<p>å¯¹äºN=6çš„ç¬¬2æ¬¡å¾ªç¯: å­Decoder block1çš„è¾“å…¥æ˜¯N=1æ—¶ï¼Œå­Decoder block3çš„è¾“å‡ºï¼ŒKVåŒæ ·æ¥è‡ªTransformer Encoderçš„æœ€åä¸€å±‚çš„è¾“å‡ºã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºåœ¨Trainè¿˜æ˜¯Testæ—¶ï¼ŒTransformer Decoderçš„è¾“å…¥ä¸ä»…æ¥è‡ª(ground truthæˆ–è€…ä¸Šä¸€ä¸ªæ—¶åˆ»Decoderçš„è¾“å‡º)ï¼Œè¿˜æ¥è‡ªTransformer Encoderçš„æœ€åä¸€å±‚ã€‚</p>
<p>è®­ç»ƒæ—¶: ç¬¬iä¸ªdecoderçš„è¾“å…¥ = encoderè¾“å‡º + ground truth embeddingã€‚</p>
<p>é¢„æµ‹æ—¶: ç¬¬iä¸ªdecoderçš„è¾“å…¥ = encoderè¾“å‡º + ç¬¬(i-1)ä¸ªdecoderè¾“å‡º.</p>
<h2 id="6-transformer-encoderå’Œtransformer-decoderæœ‰å“ªäº›ä¸åŒ">6. Transformer Encoderå’ŒTransformer Decoderæœ‰å“ªäº›ä¸åŒï¼Ÿ</h2>
<p>6.1 ä½œç”¨ä¸Šï¼ŒTransformer Encoderå¸¸ç”¨æ¥<strong>æå–ç‰¹å¾</strong>ï¼ŒTransformer Decoderå¸¸ç”¨äº<strong>ç”Ÿæˆå¼ä»»åŠ¡</strong>ã€‚Transformer Encoderå’ŒTransformer Decoderæ˜¯ä¸¤æ¡ä¸åŒçš„æŠ€æœ¯è·¯çº¿ï¼Œ<strong>Berté‡‡ç”¨çš„å‰è€…ï¼ŒGPTç³»åˆ—æ¨¡å‹é‡‡ç”¨çš„æ˜¯åè€…</strong>ã€‚</p>
<p>6.2 ç»“æ„ä¸Šï¼ŒTransformer Decoder blockåŒ…æ‹¬äº†3ä¸ªå­Decoder blockï¼Œè€ŒTransformer Encoder block åŒ…æ‹¬2ä¸ªå­Encoder blockï¼Œä¸”Transformer Decoderä¸­ä½¿ç”¨äº†Mask multi-head Attentionã€‚</p>
<p>6.3 ä»äºŒè€…çš„è¾“å…¥è¾“å‡ºè§’åº¦ï¼ŒNä¸ªTransformer Encoderè¿ç®—å®Œæˆä¹‹åï¼Œå®ƒçš„è¾“å‡ºæ‰æ­£å¼è¾“å…¥è¿›Transformer Decoderï¼Œä½œä¸ºQKVä¸­çš„Kå’ŒVï¼Œç»™Transformer Decoderä½¿ç”¨ã€‚é‚£ä¹ˆTransformerEncoderæœ€åå±‚çš„è¾“å‡ºæ˜¯å¦‚ä½•é€ç»™Decoderå‘¢ï¼Ÿå¦‚å›¾11æ‰€ç¤ºã€‚</p>
<p></p>
<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆEncoderå’ŒDecoderå¿…é¡»è¦ç”¨è¿™ç§äº¤äº’çš„æ–¹å¼å‘¢ï¼Ÿå…¶å®ä¹Ÿå¹¶ä¸ä¸€å®šï¼Œåç»­æœ‰ä¸åŒäº¤äº’æ–¹å¼çš„æå‡ºï¼Œå¦‚å›¾12ã€‚</p>
<p></p>
<h2 id="7-ä»€ä¹ˆæ˜¯embedding">7. ä»€ä¹ˆæ˜¯Embeddingï¼Ÿ</h2>
<p>7.1 Embeddingåœ¨Transformeræ¶æ„ä¸­çš„ä½ç½®å¦‚å›¾13æ‰€ç¤ºã€‚</p>
<p>7.2 æå‡ºèƒŒæ™¯:  è®¡ç®—æœºæ— æ³•ç›´æ¥å¤„ç†ä¸€ä¸ªå•è¯æˆ–è€…ä¸€ä¸ªæ±‰å­—ï¼Œéœ€è¦æŠŠä¸€ä¸ªtokenè½¬åŒ–æˆè®¡ç®—æœºå¯ä»¥è¯†åˆ«çš„å‘é‡ï¼Œè¿™ä¹Ÿå°±æ˜¯embeddingè¿‡ç¨‹ã€‚</p>
<p>7.3 å®ç°æ–¹å¼:  æœ€ç®€å•çš„embeddingæ“ä½œå°±æ˜¯one hot vectorï¼Œä½†one hot vectoræœ‰ä¸€ä¸ªå¼Šç«¯å°±æ˜¯æ²¡æœ‰è€ƒè™‘è¯è¯­å‰åä¹‹é—´çš„å…³ç³»ï¼Œåæ¥ä¹Ÿå°±äº§ç”Ÿäº†WordEmbeddingï¼Œå¦‚å›¾13ã€‚</p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">wordembeddingå°†å•è¯tokenå‘é‡åŒ–ï¼Œå¹¶ä¸”è€ƒè™‘çš„å•è¯ä¸å•è¯ä¹‹é—´çš„ç›¸å…³æ€§ã€‚</div>
    </div>
  </div>
<p></p>
<h2 id="8-ä»€ä¹ˆæ˜¯positional-embedding">8. ä»€ä¹ˆæ˜¯Positional Embeddingï¼Ÿ</h2>
<p>8.1 Positional Embeddingåœ¨Transformeræ¶æ„ä¸­çš„ä½ç½®å¦‚å›¾14æ‰€ç¤ºã€‚</p>
<p>8.2 æå‡ºèƒŒæ™¯:  RNNä½œä¸ºç‰¹å¾æå–å™¨ï¼Œæ˜¯è‡ªå¸¦è¯çš„å‰åé¡ºåºä¿¡æ¯çš„;è€ŒAttentionæœºåˆ¶å¹¶æ²¡æœ‰è€ƒè™‘å…ˆåé¡ºåºä¿¡æ¯ï¼Œä½†å‰åé¡ºåºä¿¡æ¯å¯¹è¯­ä¹‰å½±å“å¾ˆå¤§ï¼Œå› æ­¤éœ€è¦é€šè¿‡Positional Embeddingè¿™ç§æ–¹å¼æŠŠå‰åä½ç½®ä¿¡æ¯åŠ åœ¨è¾“å…¥çš„Embeddingä¸Šã€‚</p>
<p>8.3 å®ç°æ–¹å¼:  ä¼ ç»Ÿä½ç½®ç¼–ç å’Œç¥ç»ç½‘ç»œè‡ªåŠ¨è®­ç»ƒå¾—åˆ°ã€‚</p>
<p></p>
<h2 id="9-ä»€ä¹ˆæ˜¯attention">9. ä»€ä¹ˆæ˜¯Attentionï¼Ÿ</h2>
<p>9.1 ä»‹ç»Transformerï¼Œä¸ºä»€ä¹ˆè¦ä»‹ç»Attentionå‘¢ï¼Ÿå› ä¸ºåœ¨Transformerä¸­æœ€å¤šçš„multi head attentionå’ŒMask multi head attentionæ¥è‡ªScaled dot product attentionï¼Œè€Œscaled dot product attentionæ¥è‡ªself attentionï¼Œè€Œself attentionæ˜¯attentionçš„ä¸€ç§ï¼Œå› æ­¤é¦–å…ˆéœ€è¦äº†è§£Attentionï¼Œå¦‚å›¾15æ‰€ç¤ºã€‚</p>
<p></p>
<p>9.2 Attentionåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>
<p>å¯¹äºå›¾åƒè€Œè¨€ï¼Œattentionå°±æ˜¯äººä»¬çœ‹åˆ°å›¾åƒä¸­çš„æ ¸å¿ƒå…³æ³¨çš„åŒºåŸŸï¼Œæ˜¯å›¾åƒä¸­çš„é‡ç‚¹ï¼Œå¦‚å›¾16æ‰€ç¤ºã€‚å¯¹äºåºåˆ—è€Œè¨€ï¼ŒAttentionæœºåˆ¶æœ¬è´¨ä¸Šæ˜¯ä¸ºäº†æ‰¾åˆ°<strong>è¾“å…¥ä¸­ä¸åŒtokenä¹‹é—´çš„ç›¸äº’å…³ç³»</strong>ï¼Œé€šè¿‡æƒé‡çŸ©é˜µæ¥è‡ªå‘åœ°æ‰¾åˆ°è¯ä¸è¯ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p></p>
<p>9.3 Attentionæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<p>æ˜¯é€šè¿‡QKVå®ç°çš„ã€‚</p>
<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯QKVå‘¢ï¼ŸQæ˜¯queryï¼ŒKæ˜¯keysï¼ŒVæ˜¯valuesã€‚å¦‚å›¾17æ‰€ç¤ºï¼Œä¸¾ä¾‹è€Œè¨€ï¼ŒQæ˜¯å¤§è„‘å‘å‡ºçš„ä¿¡å·ï¼Œæˆ‘å£æ¸´äº†;Kæ˜¯ç¯å¢ƒä¿¡æ¯ï¼Œçœ¼ç›çœ‹åˆ°çš„ä¸–ç•Œ;Væ˜¯å¯¹ç¯å¢ƒä¸­ä¸åŒçš„ç‰©å“èµ‹äºˆä¸åŒçš„æ¯”é‡ï¼Œæ°´çš„æ¯”é‡åŠ å¤§ã€‚</p>
<p>æ€»ä¹‹ï¼ŒAttentionå°±æ˜¯é€šè¿‡è®¡ç®—QKçš„ç›¸ä¼¼åº¦ï¼Œä¸Vç›¸ä¹˜å¾—åˆ°æ³¨æ„åŠ›æ•°å€¼ã€‚</p>
<p>$$\text{Attention}(\mathrm{Query},\mathrm{Source})=\sum\text{Similarity}(\mathrm{Query},\mathrm{Key}<em>\mathrm{i})*\mathrm{Value}</em>\mathrm{i}$$</p>
<p></p>
<p>9.4 ä¸ºä»€ä¹ˆå¿…é¡»è¦æœ‰QKVä¸‰è€…ï¼Ÿ</p>
<p>ä¸ºä»€ä¹ˆä¸æ˜¯åªæœ‰Qï¼Ÿå› ä¸ºQ1ä¸Q2ä¹‹é—´çš„å…³ç³»æƒé‡ï¼Œä¸æ­¢éœ€è¦a12ï¼Œä¹Ÿéœ€è¦a21ã€‚ä½ å¯èƒ½ä¼šé—®ï¼Ÿæˆ‘ä»¬è®©a12=a21ä¸è¡Œå—ï¼Ÿä¹Ÿå¯ä»¥å°è¯•ï¼Œä½†ä»åŸç†ä¸Šè®²æ•ˆæœåº”è¯¥æ²¡æœ‰a12å’Œa21æ•ˆæœå¥½ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸æ˜¯åªæœ‰QKï¼Ÿæ±‚å¾—çš„æƒé‡ç³»æ•°éœ€è¦æ”¾åˆ°è¾“å…¥ä¸­ï¼Œå¯ä»¥ä¹˜Qï¼Œä¹Ÿå¯ä»¥ä¹˜Kï¼Œä¸ºä»€ä¹ˆè¦é‡æ–°ä¹˜Vå‘¢ï¼Ÿæˆ‘è§‰å¾—å¯èƒ½æ˜¯å¤šäº†ä¸€ç»„å¯è®­ç»ƒå‚æ•°$W_V$ï¼Œä½¿ç½‘ç»œå…·æœ‰æ›´å¼ºçš„å­¦ä¹ èƒ½åŠ›ã€‚</p>
<h2 id="10-ä»€ä¹ˆæ˜¯self-attention">10. ä»€ä¹ˆæ˜¯Self Attentionï¼Ÿ</h2>
<p>10.1 ä»‹ç»Transformerï¼Œä¸ºä»€ä¹ˆè¦ä»‹ç»self Attentionå‘¢ï¼Ÿå› ä¸ºåœ¨Transformerä¸­æœ€å¤šçš„multi head attentionå’ŒMask multi head attentionæ¥è‡ªScaled dot product attentionï¼Œè€Œscaled dot product attentionæ¥è‡ªself attentionï¼Œå¦‚å›¾15æ‰€ç¤ºã€‚</p>
<p>10.2 ä»€ä¹ˆæ˜¯Self Attentionå‘¢ï¼Ÿself attentionå’Œlocal attentionã€stride attentionéƒ½æ˜¯attentionçš„ä¸€ç§;self attentionæ˜¯æ¯ä¸€ä¸ªQä¸æ¯ä¸€ä¸ªKä¾æ¬¡è®¡ç®—æ³¨æ„åŠ›ç³»æ•°ï¼Œå¦‚å›¾18æ‰€ç¤ºï¼Œè€Œåƒlocal attentionæ˜¯Qåªä¸ç›¸é‚»çš„Kè®¡ç®—æ³¨æ„åŠ›ç³»æ•°ï¼Œstride attentionæ˜¯Qé€šè¿‡è·³è¿çš„æ–¹å¼ä¸Kè®¡ç®—æ³¨æ„åŠ›ç³»æ•°ã€‚</p>
<p></p>
<p>10.3 Self attentionä¸ºä»€ä¹ˆå¯ä»¥ç”¨äºå¤„ç†åƒæœºå™¨ç¿»è¯‘è¿™ç§åºåˆ—æ•°æ®?</p>
<p>è¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸€ä¸ªä½ç½®çš„æ•°æ®ï¼Œå¯ä»¥å…³æ³¨å…¶ä»–ä½ç½®çš„ä¿¡æ¯ï¼Œç”±æ­¤é€šè¿‡Attention scoreæ¥æå–ç‰¹å¾æˆ–è€…æ•è·è¾“å…¥åºåˆ—æ¯ä¸€ä¸ªtokenä¹‹é—´çš„å…³ç³»ã€‚</p>
<p>10.4 Self attentionæ˜¯å¦‚ä½•å…·ä½“å®ç°çš„? æ€»å…±åˆ†ä¸º4æ­¥ï¼Œå¦‚å›¾19æ‰€ç¤º</p>
<p></p>
<h2 id="11-ä»€ä¹ˆæ˜¯scaled-dot-product-attention">11. ä»€ä¹ˆæ˜¯Scaled dot product attentionï¼Ÿ</h2>
<p>11.1 self attentionæœ€å¸¸è§çš„æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯dot product attentionã€å¦ä¸€ç§æ˜¯additive attentionï¼Œå¦‚å›¾20æ‰€ç¤ºï¼Œå‰è€…çš„è®¡ç®—æ•ˆç‡æ›´é«˜ã€‚</p>
<p></p>
<p>11.2 ä»€ä¹ˆæ˜¯Scaled ?</p>
<p>scaledçš„å…·ä½“å®ç°æ–¹å¼å¦‚å›¾21æ‰€ç¤ºï¼Œè¿™ä¸€æ“ä½œçš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å†…ç§¯è¿‡å¤§ï¼Œä»æ¢¯åº¦è§’åº¦è€ƒè™‘ï¼Œé¿å…é è¿‘1ï¼Œæ˜“è®­ç»ƒ;ä¸batch normalizationæœ‰ä¸€äº›ç›¸ä¼¼çš„åŠŸèƒ½ã€‚</p>
<p>$$\text{Attention}(Q,K,V)=\text{softmax}(\frac{QK^T}{\sqrt{d_k}})V$$</p>
<h2 id="12-ä»€ä¹ˆæ˜¯multi-head-attention">12. ä»€ä¹ˆæ˜¯Multi head attentionï¼Ÿ</h2>
<p>12.1 Multi head attentionåœ¨Transformeræ¶æ„ä¸­çš„ä½ç½®å¦‚å›¾15æ‰€ç¤ºã€‚</p>
<p>12.2 æå‡ºèƒŒæ™¯: CNNå…·æœ‰å¤šä¸ªchannelï¼Œå¯ä»¥æå–å›¾åƒä¸åŒç»´åº¦çš„ç‰¹å¾ä¿¡æ¯ï¼Œé‚£ä¹ˆSelf attentionæ˜¯å¦å¯ä»¥æœ‰ç±»ä¼¼æ“ä½œï¼Œå¯ä»¥æå–ä¸åŒè·ç¦»tokençš„å¤šä¸ªç»´åº¦ä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>12.3 ä»€ä¹ˆæ˜¯group å·ç§¯ï¼Ÿå¦‚å›¾22æ‰€ç¤ºï¼Œå°†è¾“å…¥çš„ç‰¹å¾å¤šä¸ªchannelåˆ†æˆå‡ ä¸ªgroupå•ç‹¬åšå·ç§¯ï¼Œæœ€åå†è¿›è¡Œcon cæ“ä½œã€‚</p>
<p></p>
<p>12.4 Multi head attentionçš„å®ç°æ–¹å¼ï¼Ÿä¸self attentionæ ¹æœ¬ä¸åŒæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å¦‚å›¾23æ‰€ç¤ºï¼Œä»¥2ä¸ªheadçš„ä¸ºä¾‹ï¼Œå°†è¾“å…¥çš„Qã€Kã€Våˆ†æˆä¸¤ä»½ï¼Œæ¯ä¸€å°ä»½çš„Qä¸å¯¹åº”çš„Kã€Våˆ†åˆ«æ“ä½œï¼Œæœ€åè®¡ç®—å¾—åˆ°çš„å‘é‡å†è¿›è¡Œconcæ“ä½œï¼Œç”±æ­¤å¯ä»¥çœ‹å‡ºï¼ŒMulti head attentionä¸groupå·ç§¯æœ‰ç€ç›¸ä¼¼çš„å®ç°æ–¹å¼ã€‚</p>
<p></p>
<p>12.5 å¦‚ä½•ä»è¾“å…¥è¾“å‡ºçš„ç»´åº¦æ¥ç†è§£Multi head attentionï¼Ÿå¦‚å›¾24æ‰€ç¤ºã€‚</p>
<p></p>
<h2 id="13-ä»€ä¹ˆæ˜¯mask-multi-head-attention">13. ä»€ä¹ˆæ˜¯Mask Multi head attentionï¼Ÿ</h2>
<p>13.1 Mask Multi head attentionåœ¨transformeræ¶æ„ä¸­çš„ä½ç½®å¦‚å›¾15æ‰€ç¤ºã€‚</p>
<p>13.2 ä¸ºä»€ä¹ˆè¦æœ‰Maskè¿™ç§æ“ä½œï¼Ÿ</p>
<p>Transformeré¢„æµ‹ç¬¬Tä¸ªæ—¶åˆ»çš„è¾“å‡ºï¼Œä¸èƒ½çœ‹åˆ°Tæ—¶åˆ»ä¹‹åçš„é‚£äº›è¾“å…¥ï¼Œä»è€Œä¿è¯è®­ç»ƒå’Œé¢„æµ‹ä¸€è‡´ã€‚</p>
<p>é€šè¿‡ Masked æ“ä½œå¯ä»¥é˜²æ­¢ç¬¬ i ä¸ªå•è¯çŸ¥é“ i+1 ä¸ªå•è¯ä¹‹åçš„ä¿¡æ¯ï¼Œå¦‚å›¾25æ‰€ç¤ºã€‚</p>
<p></p>
<p>13.3 Maskæ“ä½œæ˜¯å¦‚ä½•å…·ä½“å®ç°çš„å‘¢ï¼Ÿ</p>
<p>Q1åªè·ŸK1è®¡ç®—ï¼ŒQ2åªè·ŸK1ã€K2è®¡ç®—ï¼Œè€Œå¯¹äºK3ã€K4ç­‰ï¼Œåœ¨softmaxä¹‹å‰ç»™ä¸€ä¸ªéå¸¸å¤§çš„è´Ÿæ•°ï¼Œç”±æ­¤ç»è¿‡softmaxä¹‹åå˜ä¸º0ï¼Œå…¶åœ¨çŸ©é˜µä¸Šçš„è®¡ç®—åŸç†å®ç°å¦‚å›¾26æ‰€ç¤ºã€‚</p>
<p></p>
<h2 id="14-ä»€ä¹ˆæ˜¯add">14. ä»€ä¹ˆæ˜¯ADDï¼Ÿ</h2>
<p>14.1 Addå°±æ˜¯æ®‹å·®è¿æ¥ï¼Œç”±2015å¹´ResNetè¿™ç¯‡æ–‡ç« å‘æ‰¬å…‰å¤§(ç›®å‰å¼•ç”¨é‡å·²è¶…è¿‡16ä¸‡)ï¼Œä¸Skip connectionçš„åŒºåˆ«åœ¨äºéœ€è¦å¤§å°ç»´åº¦å…¨éƒ¨ç›¸åŒã€‚</p>
<p>14.2 ä½œä¸ºå¤§é“è‡³ç®€æƒ³æ³•çš„æè‡´ï¼Œå‡ ä¹æ¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¨¡å‹éƒ½ä¼šç”¨åˆ°è¿™ä¸ªæŠ€æœ¯ï¼Œå¯ä»¥<strong>é˜²æ­¢ç½‘ç»œé€€åŒ–</strong>ï¼Œå¸¸ç”¨äºè§£å†³å¤šå±‚ç½‘ç»œéš¾è®­ç»ƒçš„é—®é¢˜ã€‚</p>
<p></p>
<h2 id="15-ä»€ä¹ˆæ˜¯norm">15. ä»€ä¹ˆæ˜¯Normï¼Ÿ</h2>
<p>15.1 Normå°±æ˜¯layer normalizationã€‚</p>
<p>15.2 æ ¸å¿ƒä½œç”¨: ä¸ºäº†è®­ç»ƒæ›´åŠ ç¨³å®šï¼Œå’Œbatch normalizationæœ‰ç›¸åŒçš„ä½œç”¨ï¼Œéƒ½æ˜¯ä¸ºäº†ä½¿è¾“å…¥çš„æ ·æœ¬å‡å€¼ä¸ºé›¶ï¼Œæ–¹å·®ä¸º1ã€‚</p>
<p>15.3 ä¸ºä»€ä¹ˆä¸ä½¿ç”¨batch normalizationï¼Œä½¿ç”¨çš„æ˜¯layer normalizationå‘¢ï¼Ÿå› ä¸ºä¸€ä¸ªæ—¶åºæ•°æ®ï¼Œå¥å­è¾“å…¥é•¿åº¦æœ‰é•¿æœ‰çŸ­ï¼Œå¦‚æœä½¿ç”¨batch normalizationï¼Œåˆ™å¾ˆå®¹æ˜“é€ æˆå› æ ·æœ¬é•¿çŸ­ä¸ä¸€é€ æˆâ€œè®­ç»ƒä¸ç¨³å®šâ€ã€‚BNæ˜¯å¯¹åŒä¸€ä¸ªbatchå†…çš„æ‰€æœ‰æ•°æ®çš„åŒä¸€ä¸ªç‰¹å¾æ•°æ®è¿›è¡Œæ“ä½œ;è€ŒLNæ˜¯å¯¹åŒä¸€ä¸ªæ ·æœ¬è¿›è¡Œæ“ä½œã€‚</p>
<p></p>
<ol start="16">
<li>ä»€ä¹ˆæ˜¯FFNï¼Ÿ</li>
</ol>
<p>16.1 FFNå°±æ˜¯feed forward networksã€‚</p>
<p>16.2 ä¸ºä»€ä¹ˆæœ‰äº†Self attentionå±‚ï¼Œè¿˜è¦æœ‰FFNï¼ŸAttentionå·²ç»æœ‰äº†æƒ³è¦çš„åºåˆ—ä¿¡æ¯ç‰¹å¾ï¼ŒMLPçš„ä½œç”¨æ˜¯æŠŠä¿¡æ¯æŠ•å½±åˆ°ç‰¹å®šçš„ç©ºé—´é‡Œï¼Œå†åšä¸€æ¬¡éçº¿æ€§æ˜ å°„ï¼Œå’ŒSelf attentionäº¤æ›¿ä½¿ç”¨ã€‚</p>
<p>16.3 ç»“æ„ä¸Š: åŒ…æ‹¬ä¸¤å±‚MLPï¼Œç¬¬ä¸€å±‚çš„ç»´åº¦ä¸º$512<em>2048$ï¼Œç¬¬äºŒå±‚çš„ç»´åº¦ä¸º$2048</em>512$ï¼Œä¸”ç¬¬äºŒå±‚MLPæ²¡æœ‰ä½¿ç”¨æ¿€æ´»å‡½æ•°ï¼Œå¦‚å›¾29æ‰€ç¤ºã€‚</p>
<p></p>
<h2 id="17-transformeræ˜¯å¦‚ä½•è®­ç»ƒå‡ºæ¥çš„">17. Transformeræ˜¯å¦‚ä½•è®­ç»ƒå‡ºæ¥çš„ï¼Ÿ</h2>
<p>17.1 æ•°æ®ä¸Šï¼Œåœ¨Transformerè®ºæ–‡ä¸­æœ‰æåˆ°ï¼Œç”¨åˆ°äº†4.5Må’Œ36Mçš„ç¿»è¯‘å¥å­å¯¹ã€‚</p>
<p>17.2 ç¡¬ä»¶ä¸Šï¼Œbaseæ¨¡å‹æ˜¯8ä¸ªP100 GPUè®­ç»ƒäº†12ä¸ªå°æ—¶ï¼Œå¤§æ¨¡å‹æ˜¯è®­ç»ƒäº†3.5å¤©ã€‚</p>
<p>17.3 æ¨¡å‹å‚æ•°å’Œè°ƒå‚å±‚é¢:</p>
<p>ç¬¬ä¸€ï¼Œå¯è®­ç»ƒçš„å‚æ•°åŒ…æ‹¬$W_Q$ã€$W_K$ã€$W_V$ã€$W_O$ï¼Œæ¢åŒ…æ‹¬$FFN$å±‚çš„å‚æ•°ã€‚</p>
<p>ç¬¬äºŒï¼Œå¯è°ƒçš„å‚æ•°åŒ…æ‹¬: æ¯ä¸€ä¸ªtokenå‘é‡è¡¨ç¤ºçš„ç»´åº¦(d_model)ã€headçš„å¤´æ•°ã€Encoderå’ŒDecoderä¸­blocké‡å¤çš„æ¬¡æ•°Nã€FFNä¸­é—´å±‚å‘é‡çš„ç»´åº¦ã€Label smoothing(ç½®ä¿¡åº¦0.1)å’Œdropout(0.1)ã€‚</p>
<h2 id="18-transformerä¸ºä»€ä¹ˆæ•ˆæœå¥½">18. Transformerä¸ºä»€ä¹ˆæ•ˆæœå¥½ï¼Ÿ</h2>
<p>18.1 è™½ç„¶é¢˜ç›®æ˜¯Attention is all you needï¼Œä½†åç»­ä¸€äº›ç ”ç©¶è¡¨æ˜ï¼ŒAttentionã€æ®‹å·®è¿æ¥ã€layer normalizationã€FFNï¼Œè¿™äº›å› ç´ å…±åŒæˆå°±äº†Transformerã€‚</p>
<p>18.2 Transformerä¼˜ç‚¹åŒ…æ‹¬:</p>
<p>ç¬¬ä¸€ï¼Œæå‡ºæ·±åº¦å­¦ä¹ ç»§MLPã€CNNã€RNNåçš„ç¬¬4å¤§ç‰¹å¾æå–å™¨ã€‚</p>
<p>ç¬¬äºŒï¼Œä¸€å¼€å§‹ç”¨åœ¨æœºå™¨ç¿»è¯‘ï¼Œéšç€GPTå’ŒBertå½»åº•å‡ºåœˆ;æ˜¯ä¸€ä¸ªè½¬æŠ˜ç‚¹ï¼Œåœ¨è¿™ä¸ªç‚¹ä¹‹åï¼ŒNLPé¢†åŸŸå¿«é€Ÿå‘å±•ï¼Œä¹‹åå¤šæ¨¡æ€ã€å¤§æ¨¡å‹ã€è§†è§‰Transformerç­‰å¼€å§‹å…´èµ·ã€‚</p>
<p>ç¬¬ä¸‰ï¼Œç»™äººä»¬ä¿¡å¿ƒï¼ŒåŸæ¥CNNå’ŒRNNä¹‹åï¼Œè¿˜å¯ä»¥æœ‰æ•ˆæœæ›´å¥½çš„ç‰¹å¾æå–å™¨ã€‚</p>
<p>18.3 Transformerçš„ä¸è¶³ä¹‹å¤„ï¼Ÿ</p>
<p>ç¬¬ä¸€ï¼Œè®¡ç®—é‡å¤§ï¼Œå¯¹ç¡¬ä»¶è¦æ±‚é«˜ã€‚</p>
<p>ç¬¬äºŒï¼Œå› ä¸ºæ— å½’çº³åç½®ï¼Œéœ€è¦å¾ˆå¤šæ•°æ®æ‰å¯ä»¥å–å¾—å¾ˆå¥½çš„æ•ˆæœã€‚</p>
<p>Ref:</br>
[1]. <a href="https://mp.weixin.qq.com/s/sNyh3SzhIdsk8feYfQlTSA"target="_blank" rel="external nofollow noopener noreferrer">https://mp.weixin.qq.com/s/sNyh3SzhIdsk8feYfQlTSA<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>Effective STL [31] | äº†è§£ä½ çš„æ’åºé€‰æ‹©</title><link>https://jianye0428.github.io/posts/clause_31/</link><pubDate>Sat, 26 Aug 2023 10:19:35 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_31/</guid><description><![CDATA[<h2 id="ç¨³å®šæ’åº-vs-ä¸ç¨³å®šæ’åº">ç¨³å®šæ’åº VS ä¸ç¨³å®šæ’åº</h2>
<p>æœ‰äº›æ’åºç®—æ³•æ˜¯ç¨³å®šçš„ã€‚åœ¨ç¨³å®šæ’åºä¸­ï¼Œå¦‚æœä¸€ä¸ªåŒºé—´ä¸­çš„ä¸¤ä¸ªå…ƒç´ æœ‰ç­‰ä»·çš„å€¼ï¼Œå®ƒä»¬çš„ç›¸å¯¹ä½ç½®åœ¨æ’åºåä¸æ”¹å˜ã€‚ä¸ç¨³å®šçš„ç®—æ³•æ²¡åšè¿™ä¸ªä¿è¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ï¼ˆæœªæ’åºçš„ï¼‰widgets vectorä¸­Widget Aåœ¨Widget Bä¹‹å‰ï¼Œè€Œä¸”ä¸¤è€…éƒ½æœ‰ç›¸åŒçš„è´¨é‡ç­‰çº§ï¼Œé‚£ä¹ˆç¨³å®šæ’åºç®—æ³•ä¼šä¿è¯åœ¨è¿™ä¸ªvectoræ’åºåï¼ŒWidget Aä»ç„¶åœ¨Widget Bä¹‹å‰ã€‚</p>
<h2 id="partial_sort"><code>partial_sort</code></h2>
<p>sortæ˜¯ä¸ªä»¤äººç§°èµçš„ç®—æ³•ï¼Œå¦‚æœä¸éœ€è¦å®Œå…¨æ’åºæ—¶ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªå­˜æœ‰Widget çš„vectorï¼Œä½ æƒ³é€‰æ‹©20ä¸ªè´¨é‡æœ€é«˜çš„Widgetå‘é€ç»™å®¢æˆ·ï¼Œ20ä¸ªä¹‹å¤–çš„Widgetå¯ä»¥ä¿æŒæ— åºï¼Œä¹Ÿå°±æ˜¯ä½ éœ€è¦çš„æ˜¯éƒ¨åˆ†æ’åºï¼Œè¿™æ—¶å°±å¯ä»¥ç”¨partial_sortã€‚</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">qualityCompare</span><span class="p">(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¿”å›lhsçš„è´¨é‡æ˜¯ä¸æ˜¯æ¯”rhsçš„è´¨é‡å¥½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠæœ€å¥½çš„20ä¸ªå…ƒç´ ï¼ˆæŒ‰é¡ºåºï¼‰æ”¾åœ¨widgetsçš„å‰ç«¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">partial_sort</span><span class="p">(</span><span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">widgets</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">qualityCompare</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨widgets...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨å®Œpartial_sortåï¼Œwidgetsçš„å‰20ä¸ªå…ƒç´ æ˜¯å®¹å™¨ä¸­æœ€å¥½çš„è€Œä¸”å®ƒä»¬æŒ‰é¡ºåºæ’åˆ—ï¼Œè´¨é‡æœ€é«˜çš„Widgetæ˜¯widgets[0]ï¼Œç¬¬äºŒé«˜çš„æ˜¯widgets[1]ç­‰ã€‚</p>
<p>partial_sortæ˜¯ä¸ç¨³å®šçš„ã€‚</p>
<h2 id="nth_element">nth_element</h2>
<p>å¦‚æœä½ ä¸å…³å¿ƒå“ªä¸ªWidgetç»™å“ªä¸ªå®¢æˆ·ï¼Œä½ éœ€è¦çš„åªæ˜¯ä»»æ„é¡ºåºçš„20ä¸ªæœ€å¥½çš„Widgetã€‚STLä¸­nth_elementå¯ä»¥ç²¾ç¡®åœ°å®Œæˆäº†ä½ éœ€è¦çš„ã€‚</p>
<p>nth_elementæ’åºä¸€ä¸ªåŒºé—´ï¼Œåœ¨nä½ç½®ï¼ˆä½ æŒ‡å®šçš„ï¼‰çš„å…ƒç´ æ˜¯å¦‚æœåŒºé—´è¢«å®Œå…¨æ’åºåä¼šå‡ºç°åœ¨é‚£å„¿çš„å…ƒç´ ã€‚</p>
<p><strong>Example</strong></p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">randy</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="c1">//é»˜è®¤æ±‚ç¬¬må¤§çš„å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">nth_element</span><span class="p">(</span><span class="n">randy</span><span class="p">,</span> <span class="n">randy</span><span class="o">+</span><span class="n">m</span><span class="p">,</span> <span class="n">randy</span><span class="o">+</span><span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//å®šä¹‰cmpå¯æ±‚ç¬¬må°çš„å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="nf">cmp</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">){</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="n">a</span><span class="o">&gt;</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">nth_element</span><span class="p">(</span><span class="n">randy</span><span class="p">,</span> <span class="n">randy</span><span class="o">+</span><span class="n">m</span><span class="p">,</span> <span class="n">randy</span><span class="o">+</span><span class="n">n</span><span class="p">,</span> <span class="n">cmp</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å‡½æ•°æ˜¯å°†ç¬¬ m å¤§çš„å…ƒç´ æ”¾åœ¨ arr æ•°ç»„æ•°ç»„ä¸­é€‚å½“ä½ç½®ï¼Œå…¶ä»–å…ƒç´ æŒ‰ç…§ç¬¬ m å…ƒç´ çš„å¤§å°åˆ’åˆ†ã€‚ åœ¨[ 0, n ]è¿™ä¸ªèŒƒå›´å†…ï¼Œåœ¨ç¬¬ m ä¸ªå…ƒç´ ä¹‹å‰çš„å…ƒç´ éƒ½å°äºæˆ–ç­‰äºç¬¬ m ä¸ªå…ƒç´ ï¼Œè€Œä¸”ç¬¬ m ä¸ªå…ƒç´ åé¢çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šæ¯”å®ƒå¤§ã€‚</p>
<p><code>nth_element()</code>å‡½æ•°ä»…å°†ç¬¬ m å¤§/å°çš„æ•°åœ¨ randy æ•°ç»„ä¸­æ’å¥½äº†ä½ç½®ï¼Œå¹¶ä¸è¿”å›å€¼ã€‚è¾“å‡º randy[m] å³æ˜¯ç¬¬ m å¤§/å°çš„æ•°ã€‚</p>
<p><strong>æ’åºWidgetæ•°ç»„</strong></p>
<p>ä½¿ç”¨nth_elementæ¥ä¿è¯æœ€å¥½çš„20ä¸ªWidgetåœ¨widgets vectorçš„å‰ç«¯ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">nth_element</span><span class="p">(</span><span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">19</span><span class="p">,</span> <span class="n">widgets</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">qualityCompare</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠæœ€å¥½çš„20ä¸ªå…ƒç´ æ”¾åœ¨widgetså‰ç«¯ï¼Œä½†ä¸ç”¨æ‹…å¿ƒå®ƒä»¬çš„é¡ºåº
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨nth_elementæœ¬è´¨ä¸Šç­‰ä»·äºè°ƒç”¨partial_sortï¼Œä¸¤ä¸ªç®—æ³•éƒ½æŠŠ20ä¸ªè´¨é‡æœ€é«˜çš„Widgetç§»åŠ¨åˆ°vectorå‰ç«¯ã€‚</p>
<p>å®ƒä»¬ç»“æœçš„å”¯ä¸€åŒºåˆ«æ˜¯partial_sortæ’åºäº†åœ¨ä½ç½®1-20çš„å…ƒç´ ï¼Œè€Œnth_elementä¸æ’åºã€‚</p>
<p><strong>å…¶ä»–ç”¨æ³•</strong></p>
<p>é™¤äº†èƒ½å¸®ä½ æ‰¾åˆ°åŒºé—´é¡¶éƒ¨çš„nä¸ªå…ƒç´ ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨äºæ‰¾åˆ°åŒºé—´çš„ä¸­å€¼æˆ–è€…æ‰¾åˆ°åœ¨æŒ‡å®šç™¾åˆ†ç‚¹çš„å…ƒç´ ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// è¿­ä»£å™¨çš„å˜é‡æ–¹ä¾¿åœ°è¡¨ç¤ºwidgetsçš„èµ·ç‚¹å’Œç»ˆç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">begin</span><span class="p">(</span><span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">end</span><span class="p">(</span><span class="n">widgets</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è¿™ä¸ªè¿­ä»£å™¨æŒ‡ç¤ºäº†ä¸‹é¢ä»£ç è¦æ‰¾çš„ä¸­ç­‰è´¨é‡ç­‰çº§çš„Widgetçš„ä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">goalPosition</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å…´è¶£çš„Widgetä¼šæ˜¯æœ‰åºçš„vectorçš„ä¸­é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">goalPosition</span> <span class="o">=</span> <span class="n">begin</span> <span class="o">+</span> <span class="n">widgets</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰¾åˆ°widgetsä¸­ä¸­ç­‰è´¨é‡ç­‰çº§çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">nth_element</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">goalPosition</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">qualityCompare</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// goalPositionç°åœ¨æŒ‡å‘ä¸­ç­‰è´¨é‡ç­‰çº§çš„Widget
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸‹é¢çš„ä»£ç èƒ½æ‰¾åˆ°è´¨é‡ç­‰çº§ä¸º75%çš„Widget
</span></span></span><span class="line"><span class="cl"><span class="c1">// æŒ‡å‡ºå…´è¶£çš„Widgetç¦»å¼€å§‹æœ‰å¤šè¿œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">size_type</span> <span class="n">goalOffset</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">widgets</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰¾åˆ°è´¨é‡å€¼ä¸º75%çš„Widget
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">nth_element</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">begin</span> <span class="o">+</span> <span class="n">goalOffset</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">qualityCompare</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// begin + goalOffsetç°åœ¨æŒ‡å‘è´¨é‡ç­‰çº§ä¸º75%çš„Widget
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…ƒç´ æœ‰åŒæ ·è´¨é‡">å…ƒç´ æœ‰åŒæ ·è´¨é‡</h2>
<p>å‡è®¾æœ‰12ä¸ªå…ƒç´ è´¨é‡æ˜¯1çº§ï¼ˆå¯èƒ½æ˜¯æœ€å¥½çš„ï¼‰ï¼Œ15ä¸ªå…ƒç´ è´¨é‡æ˜¯2çº§ï¼ˆç¬¬äºŒå¥½çš„ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€‰æ‹©20ä¸ªæœ€å¥½çš„Widgetå°±æ˜¯é€‰æ‹©12ä¸ª1çº§çš„å’Œ15ä¸ªä¸­çš„8ä¸ª2çº§çš„ã€‚partial_sortå’Œnth_elementæ€ä¹ˆåˆ¤æ–­15ä¸ªä¸­çš„å“ªäº›è¦æ”¾åˆ°æœ€å¥½çš„20ä¸ªä¸­ï¼Ÿå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå½“å¤šä¸ªå…ƒç´ æœ‰ç­‰ä»·çš„å€¼æ—¶sortæ€ä¹ˆåˆ¤æ–­å…ƒç´ çš„é¡ºåºï¼Ÿ</p>
<p>partial_sortå’Œnth_elementä»¥ä»»ä½•å®ƒä»¬å–œæ¬¢çš„æ–¹å¼æ’åºå€¼ç­‰ä»·çš„å…ƒç´ ï¼Œè€Œä¸”ä½ ä¸èƒ½æ§åˆ¶å®ƒä»¬åœ¨è¿™æ–¹é¢è¡Œä¸ºã€‚</p>
<p>nth_elementã€sortä¹Ÿæ²¡æœ‰æä¾›ç¨³å®šæ€§ã€‚</p>
<h2 id="stable_sort">stable_sort</h2>
<p>stable_sort æ˜¯ç¨³å®šæ’åºï¼ŒSTLå¹¶ä¸åŒ…å«partial_sortå’Œnth_elementçš„ç¨³å®šç‰ˆæœ¬ã€‚</p>
<p>å½“æŒ‡å®šèŒƒå›´å†…åŒ…å«å¤šä¸ªç›¸ç­‰çš„å…ƒç´ æ—¶ï¼Œsort() æ’åºå‡½æ•°æ— æ³•ä¿è¯ä¸æ”¹å˜å®ƒä»¬çš„ç›¸å¯¹ä½ç½®ã€‚é‚£ä¹ˆï¼Œå¦‚æœæ—¢è¦å®Œæˆæ’åºåˆè¦ä¿è¯ç›¸ç­‰å…ƒç´ çš„ç›¸å¯¹ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨stable_sort()å‡½æ•°</p>
<p>stable_sort() å‡½æ•°å®Œå…¨å¯ä»¥çœ‹ä½œæ˜¯ sort() å‡½æ•°åœ¨åŠŸèƒ½æ–¹é¢çš„å‡çº§ç‰ˆã€‚stable_sort() å’Œ sort() å…·æœ‰ç›¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œå°±è¿è¯­æ³•æ ¼å¼ä¹Ÿæ˜¯ç›¸åŒçš„ï¼ˆåç»­ä¼šè®²ï¼‰ï¼Œåªä¸è¿‡å‰è€…åœ¨åŠŸèƒ½ä¸Šé™¤äº†å¯ä»¥å®ç°æ’åºï¼Œè¿˜å¯ä»¥ä¿è¯ä¸æ”¹å˜ç›¸ç­‰å…ƒç´ çš„ç›¸å¯¹ä½ç½®ã€‚</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//å¯¹ [first, last) åŒºåŸŸå†…çš„å…ƒç´ åšé»˜è®¤çš„å‡åºæ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">stable_sort</span> <span class="p">(</span> <span class="n">RandomAccessIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">RandomAccessIterator</span> <span class="n">last</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æŒ‰ç…§æŒ‡å®šçš„ comp æ’åºè§„åˆ™ï¼Œå¯¹ [first, last) åŒºåŸŸå†…çš„å…ƒç´ è¿›è¡Œæ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">stable_sort</span> <span class="p">(</span> <span class="n">RandomAccessIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">RandomAccessIterator</span> <span class="n">last</span><span class="p">,</span> <span class="n">Compare</span> <span class="n">comp</span> <span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;     // std::cout</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;    // std::stable_sort</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;       // std::vector</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">//ä»¥æ™®é€šå‡½æ•°çš„æ–¹å¼å®ç°è‡ªå®šä¹‰æ’åºè§„åˆ™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="nf">randy_comp</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ä»¥å‡½æ•°å¯¹è±¡çš„æ–¹å¼å®ç°è‡ªå®šä¹‰æ’åºè§„åˆ™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">kim_comp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">jeff_num</span><span class="p">{</span><span class="mi">88</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">33</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">stable_sort</span><span class="p">(</span><span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span>  <span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>  <span class="c1">// 2 13 22 88 1 30 3 33
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="c1">//åˆ©ç”¨STLæ ‡å‡†åº“æä¾›greater&lt;T&gt;è¿›è¡Œæ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">stable_sort</span><span class="p">(</span><span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">greater</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span>  <span class="c1">// 88 22 13 2 1 30 3 33
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="c1">//é€šè¿‡è‡ªå®šä¹‰æ¯”è¾ƒè§„åˆ™è¿›è¡Œæ’åº,è¿™é‡Œä¹Ÿå¯ä»¥æ¢æˆ kim_comp()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">stable_sort</span><span class="p">(</span><span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">jeff_num</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">randy_comp</span><span class="p">);</span>  <span class="c1">// 1 2 3 13 22 30 33 88
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">jeff_num</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="partition">partition</h2>
<p>ä½†æ˜¯å®Œå…¨æ’åºéœ€è¦å¾ˆå¤šå·¥ä½œï¼Œè€Œä¸”å¯¹äºè¿™ä¸ªä»»åŠ¡åšäº†å¾ˆå¤šä¸å¿…è¦çš„å·¥ä½œã€‚ä¸€ä¸ªæ›´å¥½çš„ç­–ç•¥æ˜¯ä½¿ç”¨partitionç®—æ³•ï¼Œå®ƒé‡æ’åŒºé—´ä¸­çš„å…ƒç´ ä»¥ä½¿æ‰€æœ‰æ»¡è¶³æŸä¸ªæ ‡å‡†çš„å…ƒç´ éƒ½åœ¨åŒºé—´çš„å¼€å¤´ã€‚</p>
<p>æ¯”å¦‚ï¼Œç§»åŠ¨æ‰€æœ‰è´¨é‡ç­‰çº§ä¸º2æˆ–æ›´å¥½çš„Widgetåˆ°widgetså‰ç«¯ï¼š</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">hasAcceptableQuality</span><span class="p">(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">w</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="c1">// è¿”å›wè´¨é‡ç­‰çº§æ˜¯å¦æ˜¯2æˆ–æ›´é«˜;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠæ‰€æœ‰æ»¡è¶³hasAcceptableQualityçš„widgetsç§»åŠ¨åˆ°widgetså‰ç«¯ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¹¶ä¸”è¿”å›ä¸€ä¸ªæŒ‡å‘ç¬¬ä¸€ä¸ªä¸æ»¡è¶³çš„widgetçš„è¿­ä»£å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">goodEnd</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">widgets</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">hasAcceptableQuality</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤è°ƒç”¨å®Œæˆåï¼Œä»widgets.begin()åˆ°goodEndçš„åŒºé—´å®¹çº³äº†æ‰€æœ‰è´¨é‡æ˜¯1æˆ–2çš„Widgetï¼Œä»goodEndåˆ°widgets.end()çš„åŒºé—´åŒ…å«äº†æ‰€æœ‰è´¨é‡ç­‰çº§æ›´ä½çš„Widgetã€‚</p>
<p>å¦‚æœåœ¨åˆ†å‰²æ—¶ä¿æŒåŒæ ·è´¨é‡ç­‰çº§çš„Widgetçš„ç›¸å¯¹ä½ç½®å¾ˆé‡è¦ï¼Œæˆ‘ä»¬è‡ªç„¶ä¼šç”¨stable_partitionæ¥ä»£æ›¿partitionã€‚</p>
<p><strong>listæ’åº</strong></p>
<p>å”¯ä¸€æˆ‘ä»¬å¯èƒ½ä¼šä½†ä¸èƒ½ä½¿ç”¨<code>sort</code>ã€<code>stable_sort</code>ã€<code>partial_sort</code>æˆ–<code>nth_element</code>çš„å®¹å™¨æ˜¯<code>list</code>ï¼Œ<code>list</code>é€šè¿‡æä¾›<code>sort</code>æˆå‘˜å‡½æ•°åšäº†ä¸€äº›è¡¥å¿ã€‚ï¼ˆæœ‰è¶£çš„æ˜¯ï¼Œlist::sortæä¾›äº†<u>ç¨³å®šæ’åº</u>ã€‚ï¼‰</p>
<p>å¦‚æœä½ æƒ³è¦å¯¹listä¸­çš„å¯¹è±¡è¿›è¡Œpartial_sortæˆ–nth_elementï¼Œä½ å¿…é¡»é—´æ¥å®Œæˆï¼š</p>
<ol>
<li>æŠŠå…ƒç´ æ‹·è´åˆ°ä¸€ä¸ªæ”¯æŒéšæœºè®¿é—®è¿­ä»£å™¨çš„å®¹å™¨ä¸­ï¼Œç„¶åå¯¹å®ƒåº”ç”¨éœ€è¦çš„ç®—æ³•;</li>
<li>å»ºç«‹ä¸€ä¸ªlist::iteratorçš„å®¹å™¨ï¼Œå¯¹é‚£ä¸ªå®¹å™¨ä½¿ç”¨ç®—æ³•ï¼Œç„¶åé€šè¿‡è¿­ä»£å™¨è®¿é—®listå…ƒç´ ;</li>
<li>ä½¿ç”¨æœ‰åºçš„è¿­ä»£å™¨å®¹å™¨çš„ä¿¡æ¯æ¥è¿­ä»£åœ°æŠŠlistçš„å…ƒç´ æ¥åˆåˆ°ä½ æƒ³è®©å®ƒä»¬æ‰€å¤„çš„ä½ç½®ã€‚</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p><strong>ç®—æ³•sortã€stable_sortã€partial_sortå’Œnth_elementéœ€è¦éšæœºè®¿é—®è¿­ä»£å™¨ï¼Œæ‰€ä»¥å®ƒä»¬å¯èƒ½åªèƒ½ç”¨äºvectorã€stringã€dequeå’Œæ•°ç»„ã€‚</strong></p>
<p>å¯¹æ ‡å‡†å…³è”å®¹å™¨æ’åºå…ƒç´ æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºè¿™æ ·çš„å®¹å™¨ä½¿ç”¨å®ƒä»¬çš„æ¯”è¾ƒå‡½æ•°æ¥åœ¨ä»»ä½•æ—¶å€™ä¿æŒæœ‰åºã€‚</p>
<p>partitionå’Œstable_partitionä¸sortã€stable_sortã€partial_sortå’Œnth_elementä¸åŒï¼Œå®ƒä»¬åªéœ€è¦åŒå‘è¿­ä»£å™¨ã€‚å› æ­¤ä½ å¯ä»¥åœ¨ä»»ä½•æ ‡å‡†åºåˆ—è¿­ä»£å™¨ä¸Šä½¿ç”¨partitionå’Œstable_partitionã€‚</p>
<ol>
<li>å¦‚æœéœ€è¦åœ¨vectorã€stringã€dequeæˆ–æ•°ç»„ä¸Šè¿›è¡Œ<strong>å®Œå…¨æ’åº</strong>ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>sort</code>æˆ–<code>stable_sort</code>ã€‚</li>
<li>å¦‚æœä½ æœ‰ä¸€ä¸ªvectorã€stringã€dequeæˆ–æ•°ç»„ï¼Œ<strong>åªéœ€è¦æ’åºå‰nä¸ªå…ƒç´ </strong>ï¼Œåº”è¯¥ç”¨<code>partial_sort</code>ã€‚</li>
<li>å¦‚æœä½ æœ‰ä¸€ä¸ªvectorã€stringã€dequeæˆ–æ•°ç»„ï¼Œ<strong>éœ€è¦é‰´åˆ«å‡ºç¬¬nä¸ªå…ƒç´ æˆ–ä½ éœ€è¦é‰´åˆ«å‡ºæœ€å‰çš„nä¸ªå…ƒç´ ï¼Œè€Œä¸ç”¨çŸ¥é“å®ƒä»¬çš„é¡ºåº</strong>ï¼Œnth_elementæ˜¯ä½ åº”è¯¥æ³¨æ„å’Œè°ƒç”¨çš„ã€‚</li>
<li>å¦‚æœä½ éœ€è¦<strong>æŠŠæ ‡å‡†åºåˆ—å®¹å™¨çš„å…ƒç´ æˆ–æ•°ç»„åˆ†éš”ä¸ºæ»¡è¶³å’Œä¸æ»¡è¶³æŸä¸ªæ ‡å‡†</strong>ï¼Œä½ å¤§æ¦‚å°±è¦æ‰¾partitionæˆ–stable_partitionã€‚</li>
<li>å¦‚æœä½ çš„æ•°æ®æ˜¯åœ¨listä¸­ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨partitionå’Œstable_partitionï¼Œä½ å¯ä»¥ä½¿ç”¨listçš„sortæ¥ä»£æ›¿sortå’Œstable_sortã€‚å¦‚æœä½ éœ€è¦partial_sortæˆ–nth_elementæä¾›çš„æ•ˆæœï¼Œä½ å°±å¿…é¡»é—´æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚</li>
</ol>
<p>ä½ å¯ä»¥é€šè¿‡æŠŠæ•°æ®æ”¾åœ¨æ ‡å‡†å…³è”å®¹å™¨ä¸­çš„æ–¹æ³•ä»¥<strong>ä¿æŒåœ¨ä»»ä½•æ—¶å€™ä¸œè¥¿éƒ½æœ‰åº</strong>ã€‚ä½ ä¹Ÿå¯èƒ½ä¼šè€ƒè™‘æ ‡å‡†éSTLå®¹å™¨priority_queueï¼Œå®ƒä¹Ÿå¯ä»¥æ€»æ˜¯ä¿æŒå®ƒçš„å…ƒç´ æœ‰åºã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œ<font color=blue>åšæ›´å¤šå·¥ä½œçš„ç®—æ³•æ¯”åšå¾—å°‘çš„è¦èŠ±æ›´é•¿æ—¶é—´ï¼Œè€Œå¿…é¡»ç¨³å®šæ’åºçš„ç®—æ³•æ¯”å¿½ç•¥ç¨³å®šæ€§çš„ç®—æ³•è¦èŠ±æ›´é•¿æ—¶é—´</font>ã€‚</p>
<p>æœ¬èŠ‚è®¨è®ºçš„ç®—æ³•éœ€è¦æ›´å°‘èµ„æºï¼ˆæ—¶é—´å’Œç©ºé—´ï¼‰çš„ç®—æ³•æ’åºï¼š</p>
<ol>
<li>partition</li>
<li>partial_sort</li>
<li>stable_partition</li>
<li>sort</li>
<li>nth_element</li>
<li>stable_sort</li>
</ol>
]]></description></item><item><title>Effective STL [32] | å¦‚æœä½ çœŸçš„æƒ³åˆ é™¤ä¸œè¥¿çš„è¯å°±åœ¨ç±»ä¼¼removeçš„ç®—æ³•åæ¥ä¸Šerase</title><link>https://jianye0428.github.io/posts/clause_32/</link><pubDate>Sat, 26 Aug 2023 10:55:50 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_32/</guid><description><![CDATA[<h2 id="removeå®é™…ä½œç”¨">removeå®é™…ä½œç”¨</h2>
<h3 id="removeçš„å£°æ˜">removeçš„å£°æ˜</h3>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">ForwardIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">ForwardIterator</span> <span class="n">remove</span><span class="p">(</span><span class="n">ForwardIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">ForwardIterator</span> <span class="n">last</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>removeæ¥æ”¶æŒ‡å®šå®ƒæ“ä½œçš„å…ƒç´ åŒºé—´çš„ä¸€å¯¹è¿­ä»£å™¨ã€‚å®ƒä¸æ¥æ”¶ä¸€ä¸ªå®¹å™¨ï¼Œæ‰€ä»¥<strong>removeä¸çŸ¥é“å®ƒä½œç”¨äºå“ªä¸ªå®¹å™¨</strong>ã€‚</p>
<p>æ­¤å¤–ï¼Œremoveä¹Ÿä¸å¯èƒ½å‘ç°å®¹å™¨ï¼Œå› ä¸ºæ²¡æœ‰åŠæ³•ä»ä¸€ä¸ªè¿­ä»£å™¨è·å–å¯¹åº”äºå®ƒçš„å®¹å™¨ã€‚</p>
<h3 id="removeä¸åšä»€ä¹ˆ">removeä¸åšä»€ä¹ˆ</h3>
<p>ä»å®¹å™¨ä¸­é™¤å»ä¸€ä¸ªå…ƒç´ ï¼Œå”¯ä¸€çš„æ–¹æ³•æ˜¯è°ƒç”¨é‚£ä¸ªå®¹å™¨çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œå‡ ä¹éƒ½æ˜¯eraseçš„æŸä¸ªå½¢å¼ï¼Œ(listæœ‰å‡ ä¸ªé™¤å»å…ƒç´ çš„æˆå‘˜å‡½æ•°ä¸å«eraseï¼Œä½†å®ƒä»¬ä»ç„¶æ˜¯æˆå‘˜å‡½æ•°ã€‚)å› ä¸ºå”¯ä¸€ä»å®¹å™¨ä¸­é™¤å»ä¸€ä¸ªå…ƒç´ çš„æ–¹æ³•æ˜¯åœ¨é‚£ä¸ªå®¹å™¨ä¸Šè°ƒç”¨ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œè€Œä¸”å› ä¸ºremoveæ— æ³•çŸ¥é“å®ƒæ­£åœ¨æ“ä½œçš„å®¹å™¨ï¼Œæ‰€ä»¥removeä¸å¯èƒ½ä»ä¸€ä¸ªå®¹å™¨ä¸­é™¤å»å…ƒç´ ã€‚</p>
<p>ä»ä¸€ä¸ªå®¹å™¨ä¸­removeå…ƒç´ ä¸ä¼šæ”¹å˜å®¹å™¨ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹ä¸€ä¸ªvector&lt;int&gt; ç”¨1-10å¡«å……å®ƒ(è°ƒç”¨reserveçš„è§£é‡Šåœ¨æ¡æ¬¾14)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰“å°10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è®¾ç½®3ä¸ªå…ƒç´ ä¸º99
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">remove</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">99</span><span class="p">);</span> <span class="c1">// åˆ é™¤æ‰€æœ‰ç­‰äº99çš„å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="c1">// ä»ç„¶æ˜¯10ï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><font color=blue>removeå¹¶ä¸â€œçœŸçš„â€åˆ é™¤ä¸œè¥¿ï¼Œå› ä¸ºå®ƒåšä¸åˆ°ã€‚</font></p>
<p><strong>removeä¸çŸ¥é“å®ƒè¦ä»å“ªä¸ªå®¹å™¨åˆ é™¤ä¸œè¥¿ï¼Œè€Œæ²¡æœ‰å®¹å™¨ï¼Œå®ƒå°±æ²¡æœ‰åŠæ³•è°ƒç”¨æˆå‘˜å‡½æ•°ã€‚</strong></p>
<h3 id="remove-åšäº†ä»€ä¹ˆ">remove åšäº†ä»€ä¹ˆ</h3>
<p>removeç§»åŠ¨æŒ‡å®šåŒºé—´ä¸­çš„å…ƒç´ ç›´åˆ°æ‰€æœ‰â€œä¸åˆ é™¤çš„â€å…ƒç´ åœ¨åŒºé—´çš„å¼€å¤´(ç›¸å¯¹ä½ç½®å’ŒåŸæ¥å®ƒä»¬çš„ä¸€æ ·)ã€‚å®ƒè¿”å›ä¸€ä¸ªæŒ‡å‘æœ€åä¸€ä¸ªçš„ä¸‹ä¸€ä¸ªâ€œä¸åˆ é™¤çš„â€å…ƒç´ çš„è¿­ä»£å™¨ã€‚è¿”å›å€¼æ˜¯åŒºé—´çš„â€œæ–°é€»è¾‘ç»ˆç‚¹â€ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œè¿™æ˜¯våœ¨è°ƒç”¨removeå‰çœ‹èµ·æ¥çš„æ ·å­ï¼š</p>
<p></p>
<p>å¦‚æœæˆ‘ä»¬æŠŠremoveçš„è¿”å›å€¼å­˜æ”¾åœ¨ä¸€ä¸ªå«åšnewEndçš„æ–°è¿­ä»£å™¨ä¸­:</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">newEnd</span><span class="p">(</span><span class="n">remove</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">99</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ˜¯è°ƒç”¨åvçœ‹èµ·æ¥çš„æ ·å­:</p>
<p></p>
<p>å¦‚æœâ€œä¸åˆ é™¤çš„â€å…ƒç´ åœ¨vä¸­çš„v.begin()å’ŒnewEndä¹‹é—´ï¼Œâ€œåˆ é™¤çš„â€å…ƒç´ å°±å¿…é¡»åœ¨newEndå’Œv.end()ä¹‹é—´ã€‚</p>
<p><strong>removeå¹¶æ²¡æœ‰æ”¹å˜åŒºé—´ä¸­å…ƒç´ çš„é¡ºåºï¼Œæ‰€ä»¥ä¸ä¼šæŠŠæ‰€æœ‰â€œåˆ é™¤çš„â€å…ƒç´ æ”¾åœ¨ç»“å°¾ï¼Œå¹¶å®‰æ’æ‰€æœ‰â€œä¸åˆ é™¤çš„â€å€¼åœ¨å¼€å¤´ã€‚</strong></p>
<p>å¦‚æœä½ ä¸æƒ³å¤±å»ä»»ä½•å€¼ï¼Œä½ å¯èƒ½åº”è¯¥è°ƒç”¨partitionæˆ–stable_partitionè€Œä¸æ˜¯removeã€‚</p>
<h3 id="remove-å®é™…æ“ä½œæµç¨‹">remove å®é™…æ“ä½œæµç¨‹</h3>
<p>åœ¨å†…éƒ¨ï¼Œremoveéå†è¿™ä¸ªåŒºé—´ï¼ŒæŠŠè¦â€œåˆ é™¤çš„â€å€¼è¦†ç›–ä¸ºåé¢è¦ä¿ç•™çš„å€¼ã€‚è¿™ä¸ªè¦†ç›–é€šè¿‡å¯¹æŒæœ‰è¢«è¦†ç›–çš„å€¼çš„å…ƒç´ èµ‹å€¼æ¥å®Œæˆã€‚</p>
<ol>
<li>removeæ£€æµ‹v[0]ï¼Œå‘ç°å®ƒçš„å€¼ä¸æ˜¯è¦è¢«åˆ é™¤çš„ï¼Œç„¶åç§»åŠ¨åˆ°v[1]ã€‚åŒæ ·çš„æƒ…å†µå‘ç”Ÿåœ¨v[1]å’Œv[2]ã€‚</li>
<li>å‘ç°v[3]åº”è¯¥è¢«åˆ é™¤ï¼Œæ‰€ä»¥å®ƒè®°å½•ä¸‹v[3]çš„å€¼åº”è¯¥è¢«è¦†ç›–ï¼Œç„¶åå®ƒç§»åŠ¨åˆ°v[4]ã€‚è¿™ç±»ä¼¼è®°å½•v[3]æ˜¯ä¸€ä¸ªéœ€è¦å¡«å……çš„â€œæ´â€ã€‚</li>
<li>å‘ç°v[4]çš„å€¼åº”è¯¥è¢«ä¿æŒï¼Œæ‰€ä»¥å®ƒæŠŠv[4]èµ‹ç»™v[3]ï¼Œè®°å½•ä¸‹v[4]åº”è¯¥è¢«è¦†ç›–ï¼Œç„¶åç§»åŠ¨åˆ°v[5]ã€‚ç»§ç»­ç±»ä¼¼çš„å‹ç¼©ï¼Œå®ƒç”¨v[4]â€œå¡«å……â€v[3]è€Œä¸”è®°å½•v[4]ç°åœ¨æ˜¯ä¸€ä¸ªæ´ã€‚</li>
<li>å‘ç°v[5]åº”è¯¥è¢«åˆ é™¤ï¼Œæ‰€ä»¥å¿½ç•¥å¹¶å®ƒç§»åŠ¨åˆ°v[6]ã€‚ä»ç„¶è®°å¾—v[4]æ˜¯ä¸€ä¸ªç­‰å¾…å¡«å……çš„æ´ã€‚</li>
<li>å‘ç°v[6]æ˜¯ä¸€ä¸ªåº”è¯¥ä¿ç•™çš„å€¼ï¼Œæ‰€ä»¥æŠŠv[6]èµ‹ç»™v[4]ã€‚è®°å¾—v[5]ç°åœ¨æ˜¯ä¸‹ä¸€ä¸ªè¦è¢«å¡«å……çš„æ´ï¼Œç„¶åç§»åˆ°v[7]ã€‚</li>
<li>åœ¨æŸç§æ„ä¹‰ä¸Šç±»ä¼¼ä¸Šé¢çš„ï¼Œæ£€æŸ¥v[7]ã€v[8]å’Œv[9]ã€‚æŠŠv[7]èµ‹ç»™v[5]ï¼Œv[8]èµ‹ç»™v[6]ï¼Œå¿½ç•¥v[9]ï¼Œå› ä¸ºv[9]çš„å€¼æ˜¯è¦è¢«åˆ é™¤çš„ã€‚</li>
<li>è¿”å›æŒ‡å®šä¸‹ä¸€ä¸ªè¦è¢«è¦†ç›–çš„å…ƒç´ çš„è¿­ä»£å™¨ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­è¿™ä¸ªå…ƒç´ æ˜¯v[7]ã€‚</li>
</ol>
<p></p>
<p>äº‹å®ä¸Šå½“removeåœ¨åˆ é™¤æ—¶è¦†ç›–çš„å€¼æ˜¯æŒ‡é’ˆæ—¶ï¼Œä¼šæœ‰é‡è¦çš„å½±å“ã€‚ä½†æ˜¯å¯¹äºæœ¬æ¡æ¬¾ï¼ŒçŸ¥é“removeä¸ä»å®¹å™¨ä¸­é™¤å»ä»»ä½•å…ƒç´ å› ä¸ºå®ƒåšä¸åˆ°å°±å¤Ÿäº†ã€‚</p>
<h2 id="åº”è¯¥åœ¨removeåé¢æ¥ä¸Šerase">åº”è¯¥åœ¨removeåé¢æ¥ä¸Šerase</h2>
<p>åªæœ‰å®¹å™¨æˆå‘˜å‡½æ•°å¯ä»¥é™¤å»å®¹å™¨å…ƒç´ ï¼Œè€Œé‚£æ˜¯æœ¬æ¡æ¬¾çš„æ•´ä¸ªè¦ç‚¹ï¼š<strong>å¦‚æœä½ çœŸçš„è¦åˆ é™¤ä¸œè¥¿çš„è¯ï¼Œä½ åº”è¯¥åœ¨removeåé¢æ¥ä¸Šerase</strong>ã€‚</p>
<p>è¦é™¤å»é‚£äº›å…ƒç´ ï¼Œä½ è¦åšçš„æ‰€æœ‰äº‹æƒ…å°±æ˜¯ç”¨é‚£ä¸¤ä¸ªè¿­ä»£å™¨è°ƒç”¨eraseçš„åŒºé—´å½¢å¼ã€‚å› ä¸ºremoveæœ¬èº«å¾ˆæ–¹ä¾¿åœ°è¿”å›äº†åŒºé—´æ–°é€»è¾‘ç»ˆç‚¹çš„è¿­ä»£å™¨:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ­£å¦‚ä»å‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">remove</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">99</span><span class="p">),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// çœŸçš„åˆ é™¤æ‰€æœ‰ç­‰äº99çš„å…ƒç´ ï¼Œç°åœ¨è¿”å›7
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>äº‹å®ä¸Šï¼Œremoveå’Œeraseæ˜¯äº²å¯†è”ç›Ÿï¼Œè¿™ä¸¤ä¸ªæ•´åˆåˆ°listæˆå‘˜å‡½æ•°removeä¸­ã€‚è¿™æ˜¯STLä¸­å”¯ä¸€åå«removeåˆèƒ½ä»å®¹å™¨ä¸­é™¤å»å…ƒç´ çš„å‡½æ•°ï¼š</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">li</span><span class="p">;</span>  <span class="c1">// å»ºç«‹ä¸€ä¸ªlistæ”¾ä¸€äº›å€¼è¿›å»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">li</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">99</span><span class="p">);</span> <span class="c1">// é™¤å»æ‰€æœ‰ç­‰äº99çš„å…ƒç´ ï¼šçœŸçš„åˆ é™¤å…ƒç´ ï¼Œæ‰€ä»¥å®ƒçš„å¤§å°å¯èƒ½æ”¹å˜äº†
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨è¿™ä¸ªremoveå‡½æ•°æ˜¯ä¸€ä¸ªSTLä¸­çš„çŸ›ç›¾ã€‚åœ¨å…³è”å®¹å™¨ä¸­ç±»ä¼¼çš„å‡½æ•°å«eraseï¼Œlistçš„removeä¹Ÿå¯ä»¥å«åšeraseã€‚ä½†å®ƒæ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éƒ½å¿…é¡»ä¹ æƒ¯å®ƒã€‚</p>
<p><strong>å¯¹äºlistï¼Œè°ƒç”¨removeæˆå‘˜å‡½æ•°æ¯”åº”ç”¨erase-removeæƒ¯ç”¨æ³•æ›´é«˜æ•ˆã€‚</strong></p>
<h2 id="ç±»ä¼¼removeçš„ç®—æ³•">ç±»ä¼¼removeçš„ç®—æ³•</h2>
<p><code>remove_if</code>å’Œ<code>unique</code>ã€‚ removeå’Œremove_ifä¹‹é—´çš„ç›¸ä¼¼æ€§å¾ˆç›´æˆªäº†å½“ã€‚</p>
<p>uniqueè¡Œä¸ºä¹Ÿåƒremoveã€‚å®ƒç”¨æ¥ä»ä¸€ä¸ªåŒºé—´åˆ é™¤ä¸œè¥¿(é‚»è¿‘çš„é‡å¤å€¼)è€Œä¸ç”¨è®¿é—®æŒæœ‰åŒºé—´å…ƒç´ çš„å®¹å™¨ã€‚å¦‚æœä½ çœŸçš„è¦ä»å®¹å™¨ä¸­åˆ é™¤å…ƒç´ ï¼Œä½ ä¹Ÿå¿…é¡»æˆå¯¹è°ƒç”¨uniqueå’Œeraseï¼Œuniqueåœ¨listä¸­ä¹Ÿç±»ä¼¼äºremoveã€‚æ­£åƒlist::removeçœŸçš„åˆ é™¤ä¸œè¥¿(è€Œä¸”æ¯”erase-removeæƒ¯ç”¨æ³•é«˜æ•ˆå¾—å¤š)ã€‚</p>
<p><code>list::unique</code>ä¹ŸçœŸçš„åˆ é™¤é‚»è¿‘çš„é‡å¤å€¼(ä¹Ÿæ¯”erase-uniqueé«˜æ•ˆ)ã€‚</p>
]]></description></item><item><title>Effective STL [34] | æ³¨æ„å“ªä¸ªç®—æ³•éœ€è¦æœ‰åºåŒºé—´</title><link>https://jianye0428.github.io/posts/clause_34/</link><pubDate>Sat, 26 Aug 2023 10:55:58 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_34/</guid><description><![CDATA[<p>ä¸æ˜¯æ‰€æœ‰ç®—æ³•å¯ä»¥ç”¨äºä»»æ„åŒºé—´ã€‚æ¯”å¦‚ï¼Œ<strong>removeéœ€è¦å‰å‘è¿­ä»£å™¨å’Œå¯ä»¥é€šè¿‡è¿™äº›è¿­ä»£å™¨èµ‹å€¼çš„èƒ½åŠ›</strong>ã€‚æ‰€ä»¥ï¼Œå®ƒä¸èƒ½åº”ç”¨äºç”±è¾“å…¥è¿­ä»£å™¨åˆ’åˆ†çš„åŒºé—´ï¼Œä¹Ÿä¸èƒ½æ˜¯mapæˆ–multimapï¼Œä¹Ÿä¸èƒ½æ˜¯setå’Œmultisetçš„ä¸€äº›å®ç°ã€‚</p>
<p>åŒæ ·ï¼Œ<strong>å¾ˆå¤šæ’åºç®—æ³•éœ€è¦éšæœºè®¿é—®è¿­ä»£å™¨</strong>ï¼Œæ‰€ä»¥ä¸å¯èƒ½åœ¨ä¸€ä¸ªlistçš„å…ƒç´ ä¸Šè°ƒç”¨è¿™äº›ç®—æ³•ã€‚</p>
<p>æœ€å¸¸è§çš„å°±æ˜¯ä¸€äº›ç®—æ³•<strong>éœ€è¦æœ‰åºå€¼çš„åŒºé—´</strong>ã€‚æ— è®ºä½•æ—¶éƒ½åº”è¯¥åšæŒè¿™ä¸ªéœ€æ±‚ï¼Œå› ä¸ºå†’çŠ¯å®ƒä¸ä»…ä¼šå¯¼è‡´ç¼–è¯‘å™¨è¯Šæ–­ï¼Œè€Œä¸”ä¼šé€ æˆæœªå®šä¹‰çš„è¿è¡ŒæœŸè¡Œä¸ºã€‚</p>
<p>æ—¢å¯ä»¥å’Œæœ‰åºåˆå¯ä»¥å’Œæ— åºåŒºé—´åˆä½œçš„ç®—æ³•å¾ˆå°‘ï¼Œä½†<strong>å½“æ“ä½œæœ‰åºåŒºé—´çš„æ—¶å€™å®ƒä»¬æœ€æœ‰ç”¨</strong>ã€‚</p>
<h2 id="åªèƒ½æ“ä½œæœ‰åºæ•°æ®çš„ç®—æ³•çš„è¡¨">åªèƒ½æ“ä½œæœ‰åºæ•°æ®çš„ç®—æ³•çš„è¡¨</h2>
<ul>
<li>binary_search</li>
<li>lower_bound</li>
<li>upper_bound</li>
<li>equal_range</li>
<li>set_union</li>
<li>set_intersection</li>
<li>set_difference</li>
<li>set_symmetric_difference</li>
<li>merge</li>
<li>inplace_merge</li>
<li>includes</li>
</ul>
<h2 id="ä¸€èˆ¬ç”¨äºæœ‰åºåŒºé—´ä½†ä¸å¼ºåˆ¶è¦æ±‚">ä¸€èˆ¬ç”¨äºæœ‰åºåŒºé—´ï¼Œä½†ä¸å¼ºåˆ¶è¦æ±‚</h2>
<ul>
<li>unique</li>
<li>unique_copy</li>
</ul>
<h2 id="binary_searchlower_boundupper_boundå’Œequal_range"><code>binary_search</code>ã€<code>lower_bound</code>ã€<code>upper_bound</code>å’Œ<code>equal_range</code></h2>
<p>æœç´¢ç®—æ³•binary_searchã€lower_boundã€upper_boundå’Œequal_rangeéœ€è¦<strong>æœ‰åºåŒºé—´</strong>ï¼Œå› ä¸ºå®ƒä»¬<strong>ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾æ¥æœç´¢</strong>å€¼ã€‚åƒCåº“ä¸­çš„bsearchï¼Œè¿™äº›ç®—æ³•ä¿è¯äº†<strong>å¯¹æ•°æ—¶é—´çš„æŸ¥æ‰¾</strong>ï¼Œä½†ä½œä¸ºäº¤æ¢çš„æ˜¯ï¼Œä½ å¿…é¡»ç»™å®ƒä»¬å·²ç»æ’è¿‡åºçš„å€¼ã€‚</p>
<p>å®é™…ä¸Šï¼Œä»…å½“ä¼ ç»™å®ƒä»¬çš„æ˜¯éšæœºè®¿é—®è¿­ä»£å™¨æ—¶å®ƒä»¬æ‰èƒ½ä¿è¯æœ‰é‚£æ ·çš„æ€§èƒ½ã€‚</p>
<p>å¦‚æœç»™å®ƒä»¬å¨åŠ›æ¯”è¾ƒå°çš„è¿­ä»£å™¨ï¼ˆæ¯”å¦‚åŒå‘è¿­ä»£å™¨ï¼‰ï¼Œå®ƒä»¬ä»ç„¶è¿›è¡Œå¯¹æ•°æ¬¡æ¯”è¾ƒï¼Œä½†è¿è¡Œæ˜¯çº¿æ€§æ—¶é—´çš„ã€‚é‚£æ˜¯å› ä¸ºï¼Œç¼ºä¹è¿›è¡Œâ€œ<strong>è¿­ä»£å™¨ç®—æœ¯ï¼ˆarithmeticï¼‰</strong>â€çš„èƒ½åŠ›ã€‚å®ƒä»¬åœ¨æœç´¢çš„åŒºé—´ä¸­éœ€è¦èŠ±è´¹çº¿æ€§æ—¶é—´æ¥ä»ä¸€ä¸ªåœ°æ–¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚</p>
<h2 id="unionset_intersectionset_differenceå’Œset_symmetric_difference"><code>union</code>ã€<code>set_intersection</code>ã€<code>set_difference</code>å’Œ<code>set_symmetric_difference</code></h2>
<p>ç®—æ³•<code>set_union</code>ã€<code>set_intersection</code>ã€<code>set_difference</code>å’Œ<code>set_symmetric_difference</code>çš„å››äººç»„æä¾›äº†çº¿æ€§æ—¶é—´è®¾ç½®å®ƒä»¬åå­—æ‰€æå‡ºçš„æ“ä½œçš„æ€§èƒ½ã€‚</p>
<p>ä¸ºä»€ä¹ˆå®ƒä»¬éœ€è¦æœ‰åºåŒºé—´ï¼Ÿå› ä¸ºå¦‚æœä¸æ˜¯çš„è¯ï¼Œå®ƒä»¬ä¸èƒ½ä»¥çº¿æ€§æ—¶é—´å®Œæˆå®ƒä»¬çš„å·¥ä½œã€‚</p>
<p>ä½ ä¼šå‘ç°ï¼Œ<strong>éœ€è¦æœ‰åºåŒºé—´çš„ç®—æ³•ä¸ºäº†æ¯”å®ƒä»¬ç”¨äºå¯èƒ½æ— åºåŒºé—´æä¾›æ›´å¥½çš„æ€§èƒ½è€Œè¿™ä¹ˆåš</strong>ã€‚</p>
<h2 id="mergeå’Œinplace_merge">mergeå’Œinplace_merge</h2>
<p>mergeå’Œinplace_mergeæ‰§è¡Œäº†æœ‰æ•ˆçš„å•éåˆå¹¶æ’åºç®—æ³•ï¼šå®ƒä»¬è¯»å–ä¸¤ä¸ªæœ‰åºåŒºé—´ï¼Œç„¶åäº§ç”Ÿä¸€ä¸ªåŒ…å«äº†ä¸¤ä¸ªæºåŒºé—´æ‰€æœ‰å…ƒç´ çš„æ–°æœ‰åºåŒºé—´ã€‚</p>
<p>å®ƒä»¬ä»¥çº¿æ€§æ—¶é—´æ‰§è¡Œï¼Œå¦‚æœå®ƒä»¬ä¸çŸ¥é“æºåŒºé—´å·²ç»æœ‰åºå°±ä¸èƒ½å®Œæˆã€‚</p>
<h2 id="includes">includes</h2>
<p>includes ç”¨æ¥æ£€æµ‹æ˜¯å¦ä¸€ä¸ªåŒºé—´çš„æ‰€æœ‰å¯¹è±¡ä¹Ÿåœ¨å¦ä¸€ä¸ªåŒºé—´ä¸­ã€‚</p>
<p>å› ä¸ºincludeså¯èƒ½å‡è®¾å®ƒçš„ä¸¤ä¸ªåŒºé—´éƒ½å·²ç»æœ‰åºï¼Œæ‰€ä»¥å®ƒä¿è¯äº†çº¿æ€§æ—¶é—´æ€§èƒ½ã€‚æ²¡æœ‰é‚£ä¸ªä¿è¯ï¼Œä¸€èˆ¬æ¥è¯´å®ƒä¼šå˜æ…¢ã€‚</p>
<h2 id="uniqueå’Œunique_copy">uniqueå’Œunique_copy</h2>
<p>uniqueå’Œunique_copyç”šè‡³åœ¨æ— åºåŒºé—´ä¸Šä¹Ÿæä¾›äº†å®šä¹‰è‰¯å¥½çš„è¡Œä¸ºã€‚</p>
<p>çœ‹çœ‹æ ‡å‡†æ˜¯æ€ä¹ˆæè¿°uniqueçš„è¡Œä¸ºçš„ï¼š</p>
<blockquote>
<p>ä»æ¯ä¸ªç›¸ç­‰å…ƒç´ çš„è¿ç»­ç»„ä¸­å»é™¤ç¬¬ä¸€ä¸ªä»¥å¤–æ‰€æœ‰çš„å…ƒç´ ã€‚</p>
</blockquote>
<p>å¦‚æœä½ è¦uniqueä»ä¸€ä¸ªåŒºé—´å»é™¤æ‰€æœ‰é‡å¤å€¼ï¼ˆä¹Ÿå°±æ˜¯ï¼Œè®©åŒºé—´ä¸­æ‰€æœ‰å€¼â€œå”¯ä¸€â€ï¼‰ï¼Œä½ å¿…é¡»å…ˆç¡®ä¿æ‰€æœ‰é‡å¤å€¼ä¸€ä¸ªæ¥ç€ä¸€ä¸ªã€‚é‚£æ˜¯æ’åºå®Œæˆçš„ä¸œè¥¿ä¹‹ä¸€ã€‚</p>
<p>å®é™…ä¸Šï¼Œuniqueä¸€èˆ¬ç”¨äºä»åŒºé—´ä¸­å»é™¤æ‰€æœ‰é‡å¤å€¼ï¼Œæ‰€ä»¥ä½ å‡ ä¹æ€»æ˜¯è¦ç¡®ä¿ä½ ä¼ é€’ç»™uniqueï¼ˆæˆ–unique_copyï¼‰çš„åŒºé—´æ˜¯æœ‰åºçš„ã€‚Unixå¼€å‘è€…ä¼šå‘ç°STLçš„uniqueå’ŒUnixçš„uniqä¹‹é—´æœ‰æƒŠäººçš„ç›¸ä¼¼ã€‚</p>
<p>é¡ºä¾¿è¯´è¯´ï¼Œuniqueä»ä¸€ä¸ªåŒºé—´é™¤å»å…ƒç´ çš„æ–¹å¼å’Œremoveä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªæ˜¯åŒºåˆ†å‡ºä¸é™¤å»çš„å…ƒç´ ã€‚</p>
<h2 id="æ’åº">æ’åº</h2>
<p>å› ä¸ºSTLå…è®¸ä½ æŒ‡å®šç”¨äºæ’åºçš„æ¯”è¾ƒå‡½æ•°ï¼Œ<strong>ä¸åŒçš„åŒºé—´å¯èƒ½ä»¥ä¸åŒçš„æ–¹å¼æ’åº</strong>ã€‚</p>
<p>æ¯”å¦‚ï¼Œç»™å®šä¸¤ä¸ªintçš„åŒºé—´ï¼Œä¸€ä¸ªå¯èƒ½ä»¥é»˜è®¤æ–¹å¼æ’åºï¼ˆä¹Ÿå°±æ˜¯å‡åºï¼‰ï¼Œè€Œå¦ä¸€ä¸ªä½¿ç”¨<code>greater&lt;int&gt;</code>æ’åºï¼Œå› æ­¤æ˜¯é™åºã€‚</p>
<p>ç»™å®šWidgetçš„ä¸¤ä¸ªåŒºé—´ï¼Œä¸€ä¸ªå¯èƒ½ä»¥ä»·æ ¼æ’åºè€Œå¦ä¸€ä¸ªå¯èƒ½ä»¥å¹´é¾„æ’åºã€‚å› ä¸ºæœ‰å¾ˆå¤šä¸åŒçš„æ–¹å¼æ¥æ’åºï¼Œæ‰€ä»¥ä¿è¯ç»™STLæ‰€ä½¿ç”¨çš„æ’åºç›¸å…³ä¿¡æ¯ä¸€è‡´æ˜¯å¾ˆé‡è¦çš„ã€‚</p>
<p><strong>å¦‚æœä½ ä¼ ä¸€ä¸ªåŒºé—´ç»™ä¸€ä¸ªä¹Ÿå¸¦æœ‰æ¯”è¾ƒå‡½æ•°çš„ç®—æ³•ï¼Œç¡®ä¿ä½ ä¼ é€’çš„æ¯”è¾ƒå‡½æ•°è¡Œä¸ºå’Œä½ ç”¨äºæ’åºè¿™ä¸ªåŒºé—´çš„ä¸€æ ·ã€‚</strong></p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹ä¸€ä¸ªvectorï¼ŒæŠŠä¸€äº›æ•°æ®æ”¾è¿›å»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">sort</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">greater</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span> <span class="c1">// é™åºæ’åˆ—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨è¿™ä¸ªvectorï¼ˆæ²¡æœ‰æ”¹å˜å®ƒï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1">// åœ¨è¿™ä¸ªvectorä¸­æœç´¢5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="n">is3Exists</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="n">binary_search</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// å‡è®¾å®ƒæ˜¯å‡åºæ’åˆ—ï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œbinary_searchå‡è®¾å®ƒæœç´¢çš„åŒºé—´æ˜¯ä»¥â€œ&lt;â€æ’åºï¼ˆä¹Ÿå°±æ˜¯ï¼Œå€¼æ˜¯å‡åºï¼‰ï¼Œä½†åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™ä¸ªvectoræ˜¯é™åºã€‚å½“ä½ åœ¨å€¼çš„æ’åˆ—é¡ºåºå’Œç®—æ³•æ‰€æœŸæœ›çš„ä¸åŒçš„åŒºé—´ä¸Šè°ƒç”¨binary_search (æˆ–lower_boundç­‰ï¼‰ä¼šå¯¼è‡´æœªå®šä¹‰çš„ç»“æœã€‚</p>
<h3 id="æ­£ç¡®æ’åºæ–¹å¼">æ­£ç¡®æ’åºæ–¹å¼</h3>
<p>è¦è®©ä»£ç è¡Œä¸ºæ­£ç¡®ï¼Œä½ å¿…é¡»å‘Šè¯‰binary_searchè¦ä½¿ç”¨å’ŒsortåŒæ ·çš„æ¯”è¾ƒå‡½æ•°ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="n">is3Exists</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æœç´¢3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">binary_search</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">3</span><span class="p">,</span> <span class="n">greater</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ¯”è¾ƒå‡½æ•°æŠŠgreaterä½œä¸º
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><font color=blue>æ‰€æœ‰éœ€è¦æœ‰åºåŒºé—´çš„ç®—æ³•ï¼ˆä¹Ÿå°±æ˜¯é™¤äº†uniqueå’Œunique_copyå¤–æœ¬æ¡æ¬¾çš„æ‰€æœ‰ç®—æ³•ï¼‰é€šè¿‡ç­‰ä»·æ¥åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦â€œç›¸åŒâ€ï¼Œå°±åƒæ ‡å‡†å…³è”å®¹å™¨ï¼ˆå®ƒä»¬æœ¬èº«æ˜¯æœ‰åºçš„ï¼‰ã€‚ç›¸åï¼Œuniqueå’Œunique_copyåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡â€œç›¸åŒâ€çš„é»˜è®¤æ–¹å¼æ˜¯é€šè¿‡ç›¸ç­‰</font>ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡ä¼ ç»™è¿™äº›ç®—æ³•ä¸€ä¸ªå®šä¹‰äº†â€œç›¸åŒâ€çš„æ„ä¹‰çš„åˆ¤æ–­å¼æ¥è¦†ç›–è¿™ä¸ªé»˜è®¤æƒ…å†µã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>11ä¸ªéœ€è¦æœ‰åºåŒºé—´çš„ç®—æ³•ä¸ºäº†æ¯”å…¶ä»–å¯èƒ½æ€§æä¾›æ›´å¥½çš„æ€§èƒ½è€Œ<font color=blue>éœ€è¦ä¼ ç»™å®ƒä»¬æœ‰åºåŒºé—´ï¼Œéœ€è¦ä¿è¯ç”¨äºç®—æ³•çš„æ¯”è¾ƒå‡½æ•°å’Œç”¨äºæ’åºçš„ä¸€è‡´</font>ã€‚</p>
]]></description></item><item><title>C++ åŸºç¡€çŸ¥è¯†[ä¸€]</title><link>https://jianye0428.github.io/posts/basics_one/</link><pubDate>Tue, 11 Jul 2023 19:37:05 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/basics_one/</guid><description><![CDATA[<div class="details admonition quote">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-quote-right fa-fw" aria-hidden="true"></i>quote<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">c++ å…«è‚¡æ–‡ ç¬¬ä¸€éƒ¨åˆ†</div>
    </div>
  </div>
<h2 id="1-åŸºç¡€çŸ¥è¯†ä¸€">1. åŸºç¡€çŸ¥è¯†(ä¸€)</h2>
<h3 id="11-cè¯­è¨€çš„ç‰¹ç‚¹">1.1 C++è¯­è¨€çš„ç‰¹ç‚¹</h3>
<blockquote>
<p>â‘ C++åœ¨Cçš„åŸºç¡€ä¸Šå¼•å…¥äº†<u><font color=red><strong>é¢å‘å¯¹è±¡</strong></font></u>æœºåˆ¶ï¼ŒåŒæ—¶ä¹Ÿå…¼å®¹Cè¯­è¨€ï¼›</br>
â‘¡C++ä¸‰å¤§ç‰¹æ€§ï¼š<font color=red><em>å°è£…</em>ã€<em>ç»§æ‰¿</em>ã€<em>å¤šæ€</em></font>ï¼›</br>
â‘¢C++ç¨‹åºç»“æ„æ¸…æ™°ã€æ˜“äºæ‰©å……ã€ç¨‹åºå¯è¯»æ€§å¥½ï¼›</br>
â‘£C++ä»£ç è´¨é‡é«˜ï¼Œ<strong>è¿è¡Œæ•ˆç‡é«˜</strong>ã€ä»…æ¯”æ±‡ç¼–è¯­è¨€æ…¢10%~20%ï¼›</br>
â‘¥C++<strong>å¯å¤ç”¨æ€§é«˜</strong>ï¼ŒC++å¼•å…¥äº†æ¨¡æ¿çš„æ¦‚å¿µï¼Œæœ‰ä¸“é—¨çš„æ¨¡æ¿åº“(STL)ï¼›</br>
â‘¦C++æ˜¯ä¸æ–­å‘å±•çš„è¯­è¨€ï¼ŒC++11ä¸­æ–°å¼•å…¥äº†nullptrã€autoå˜é‡ã€LambdaåŒ¿åå‡½æ•°ã€å³å€¼å¼•ç”¨ã€æ™ºèƒ½æŒ‡é’ˆã€‚</br></p>
</blockquote>
<p><strong>C++é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾</strong></p>
<blockquote>
<p><font color=red><strong>å°è£…æ€§ï¼š</strong></font> å°†å®¢è§‚äº‹ç‰©æŠ½è±¡æˆç±»ï¼Œæ¯ä¸ªç±»å¯¹è‡ªèº«çš„<u>æ•°æ®</u>å’Œ<u>æ–¹æ³•</u>å®è¡Œ<font color=darkblue>è®¿é—®æ§åˆ¶</font>ï¼ŒåŒ…æ‹¬(privateï¼Œprotectedï¼Œpublic)ã€‚</br>
<font color=red><strong>ç»§æ‰¿æ€§ï¼š</strong></font> å¹¿ä¹‰çš„ç»§æ‰¿æœ‰ä¸‰ç§å®ç°å½¢å¼ï¼š<u>å®ç°ç»§æ‰¿</u>(ä½¿ç”¨åŸºç±»çš„å±æ€§å’Œæ–¹æ³•è€Œæ— éœ€é¢å¤–ç¼–ç çš„èƒ½åŠ›)ã€<u>å¯è§†ç»§æ‰¿</u>(å­çª—ä½“ä½¿ç”¨çˆ¶çª—ä½“çš„å¤–è§‚å’Œå®ç°ä»£ç )ã€<u>æ¥å£ç»§æ‰¿</u>(ä»…ä½¿ç”¨å±æ€§å’Œæ–¹æ³•ï¼Œå®ç°æ»ååˆ°å­ç±»å®ç°)ã€‚</br>
<font color=red><strong>å¤šæ€æ€§ï¼š</strong></font> æ˜¯å°†çˆ¶ç±»å¯¹è±¡è®¾ç½®æˆä¸ºå’Œä¸€ä¸ªæˆ–æ›´å¤šå®ƒçš„å­å¯¹è±¡ç›¸ç­‰çš„æŠ€æœ¯ã€‚ç”¨å­ç±»å¯¹è±¡ç»™çˆ¶ç±»å¯¹è±¡èµ‹å€¼ä¹‹åï¼Œçˆ¶ç±»å¯¹è±¡å°±å¯ä»¥æ ¹æ®å½“å‰èµ‹å€¼ç»™å®ƒçš„å­å¯¹è±¡çš„ç‰¹æ€§ä»¥ä¸åŒçš„æ–¹å¼è¿ä½œã€‚</br></p>
</blockquote>
<h3 id="12-cå’Œcè¯­è¨€çš„åŒºåˆ«">1.2 C++å’ŒCè¯­è¨€çš„åŒºåˆ«</h3>
<blockquote>
<p>â‘  Cè¯­è¨€æ˜¯C++çš„å­é›†ï¼ŒC++å¯ä»¥å¾ˆå¥½<strong>å…¼å®¹Cè¯­è¨€</strong>ã€‚ä½†æ˜¯C++åˆæœ‰å¾ˆå¤šæ–°ç‰¹æ€§ï¼Œå¦‚å¼•ç”¨ã€æ™ºèƒ½æŒ‡é’ˆã€autoå˜é‡ç­‰ï¼›</br>
â‘¡ C++æ˜¯é¢å¯¹<strong>å¯¹è±¡</strong>(object-oriented)çš„ç¼–ç¨‹è¯­è¨€ï¼›Cè¯­è¨€æ˜¯é¢å¯¹<strong>è¿‡ç¨‹</strong>(process-oriented)çš„ç¼–ç¨‹è¯­è¨€ï¼›</br>
â‘¢ Cè¯­è¨€æœ‰ä¸€äº›ä¸å®‰å…¨çš„è¯­è¨€ç‰¹æ€§ï¼Œå¦‚æŒ‡é’ˆä½¿ç”¨çš„æ½œåœ¨å±é™©ã€å¼ºåˆ¶è½¬æ¢çš„ä¸ç¡®å®šæ€§ã€å†…å­˜æ³„éœ²ç­‰ã€‚è€ŒC++å¯¹æ­¤å¢åŠ äº†ä¸å°‘æ–°ç‰¹æ€§æ¥æ”¹å–„å®‰å…¨æ€§ï¼Œå¦‚constå¸¸é‡ã€å¼•ç”¨ã€castè½¬æ¢ã€æ™ºèƒ½æŒ‡é’ˆã€tryâ€”catchç­‰ç­‰ï¼›</br>
â‘£ C++å¯å¤ç”¨æ€§é«˜ï¼ŒC++å¼•å…¥äº†æ¨¡æ¿çš„æ¦‚å¿µï¼Œåé¢åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå®ç°äº†æ–¹ä¾¿å¼€å‘çš„æ ‡å‡†æ¨¡æ¿åº“STLã€‚C++çš„STLåº“ç›¸å¯¹äºCè¯­è¨€çš„å‡½æ•°åº“æ›´çµæ´»ã€æ›´é€šç”¨ã€‚</br></p>
</blockquote>
<h3 id="13-cä¸­-struct-å’Œ-class-çš„åŒºåˆ«">1.3 C++ä¸­ struct å’Œ class çš„åŒºåˆ«</h3>
<blockquote>
<p>â‘  struct ä¸€èˆ¬ç”¨äºæè¿°ä¸€ä¸ª<u>æ•°æ®ç»“æ„é›†åˆ</u>ï¼Œè€Œ class æ˜¯<u>å¯¹ä¸€ä¸ªå¯¹è±¡æ•°æ®çš„<strong>å°è£…</strong></u>ï¼›</br>
â‘¡ struct ä¸­é»˜è®¤çš„è®¿é—®æ§åˆ¶æƒé™æ˜¯ public çš„ï¼Œè€Œ class ä¸­é»˜è®¤çš„è®¿é—®æ§åˆ¶æƒé™æ˜¯ private çš„ï¼›</br>
â‘¢ åœ¨<u>ç»§æ‰¿å…³ç³»</u>ä¸­ï¼Œstruct é»˜è®¤æ˜¯å…¬æœ‰ç»§æ‰¿ï¼Œè€Œ class æ˜¯ç§æœ‰ç»§æ‰¿ï¼›</br>
â‘£ classå…³é”®å­—å¯ä»¥ç”¨äºå®š<strong>ä¹‰æ¨¡æ¿å‚æ•°</strong>ï¼Œå°±åƒtypenameï¼Œè€Œ struct ä¸èƒ½ç”¨äºå®šä¹‰æ¨¡æ¿å‚æ•°ã€‚</br></p>
</blockquote>
<h3 id="14-includeå¤´æ–‡ä»¶çš„é¡ºåºä»¥åŠåŒå¼•å·å’Œå°–æ‹¬å·çš„åŒºåˆ«">1.4 includeå¤´æ–‡ä»¶çš„é¡ºåºä»¥åŠåŒå¼•å·&quot;&ldquo;å’Œå°–æ‹¬å·&lt;&gt;çš„åŒºåˆ«</h3>
<blockquote>
<p>åŒºåˆ«ï¼š</br>
â‘  å°–æ‹¬å·<code>&lt; &gt;</code>çš„å¤´æ–‡ä»¶æ˜¯<font color=red>ç³»ç»Ÿæ–‡ä»¶</font>ï¼ŒåŒå¼•å·<code>&quot; &quot;</code>çš„å¤´æ–‡ä»¶æ˜¯è‡ªå®šä¹‰æ–‡ä»¶ï¼›</br>
â‘¡ ç¼–è¯‘å™¨é¢„å¤„ç†é˜¶æ®µæŸ¥æ‰¾å¤´æ–‡ä»¶çš„è·¯å¾„ä¸ä¸€æ ·ï¼›</br>
æŸ¥æ‰¾è·¯å¾„ï¼š</br>
â‘  ä½¿ç”¨å°–æ‹¬å·<code>&lt;  &gt;</code>(ç³»ç»Ÿæ–‡ä»¶)çš„å¤´æ–‡ä»¶çš„æŸ¥æ‰¾è·¯å¾„ï¼šç¼–è¯‘å™¨è®¾ç½®çš„å¤´æ–‡ä»¶è·¯å¾„$\rightarrow$ç³»ç»Ÿå˜é‡;</br>
â‘¡ ä½¿ç”¨åŒå¼•å·<code>&quot;  &quot;</code>(è‡ªå®šä¹‰æ–‡ä»¶)çš„å¤´æ–‡ä»¶çš„æŸ¥æ‰¾è·¯å¾„ï¼šå½“å‰å¤´æ–‡ä»¶ç›®å½•$\rightarrow$ç¼–è¯‘å™¨è®¾ç½®çš„å¤´æ–‡ä»¶è·¯å¾„$\rightarrow$ç³»ç»Ÿå˜é‡ã€‚</br></p>
</blockquote>
<h3 id="15-cç»“æ„ä½“å’Œcç»“æ„ä½“çš„åŒºåˆ«">1.5 C++ç»“æ„ä½“å’ŒCç»“æ„ä½“çš„åŒºåˆ«</h3>
<blockquote>
<p>â‘ Cçš„ç»“æ„ä½“å†…ä¸å…è®¸æœ‰å‡½æ•°å­˜åœ¨ï¼ŒC++å…è®¸æœ‰å†…éƒ¨æˆå‘˜å‡½æ•°ï¼Œä¸”å…è®¸è¯¥å‡½æ•°æ˜¯è™šå‡½æ•°ï¼›</br>
â‘¡Cçš„ç»“æ„ä½“å¯¹å†…éƒ¨æˆå‘˜å˜é‡çš„è®¿é—®æƒé™<strong>åªèƒ½æ˜¯public</strong>ï¼Œè€ŒC++å…è®¸publicï¼Œprotectedï¼Œprivateä¸‰ç§ï¼›</br>
â‘¢C ä¸­ä½¿ç”¨ç»“æ„ä½“éœ€è¦åŠ ä¸Š struct å…³é”®å­—ï¼Œæˆ–è€…å¯¹ç»“æ„ä½“ä½¿ç”¨ typedef å–åˆ«åï¼Œè€Œ C++ ä¸­å¯ä»¥çœç•¥ struct å…³é”®å­—ç›´æ¥ä½¿ç”¨ï¼›</br>
â‘£Cè¯­è¨€çš„ç»“æ„ä½“æ˜¯<strong>ä¸å¯ä»¥ç»§æ‰¿çš„</strong>ï¼ŒC++çš„ç»“æ„ä½“æ˜¯å¯ä»¥ä»å…¶ä»–çš„ç»“æ„ä½“æˆ–è€…ç±»ç»§æ‰¿è¿‡æ¥çš„ã€‚</br></p>
</blockquote>
<h3 id="16-å¯¼å…¥cå‡½æ•°çš„å…³é”®å­—æ˜¯ä»€ä¹ˆcç¼–è¯‘æ—¶å’Œcæœ‰ä»€ä¹ˆä¸åŒ">1.6 å¯¼å…¥Cå‡½æ•°çš„å…³é”®å­—æ˜¯ä»€ä¹ˆï¼ŒC++ç¼–è¯‘æ—¶å’ŒCæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h3>
<blockquote>
<p><strong>å…³é”®å­—ï¼š</strong> åœ¨C++ä¸­ï¼Œå¯¼å…¥Cå‡½æ•°çš„å…³é”®å­—æ˜¯externï¼Œè¡¨è¾¾å½¢å¼ä¸º<code>extern &quot;C&quot;</code>ï¼Œ <code>extern &quot;C&quot;</code> çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®å®ç°C++ä»£ç è°ƒç”¨å…¶ä»–Cè¯­è¨€ä»£ç ã€‚<font color=red>åŠ ä¸Š<code>extern &quot;C&quot;</code>åï¼Œä¼šæŒ‡ç¤ºç¼–è¯‘å™¨è¿™éƒ¨åˆ†ä»£ç æŒ‰Cè¯­è¨€çš„è¿›è¡Œç¼–è¯‘</font>ï¼Œè€Œä¸æ˜¯C++çš„ã€‚</br></p>
</blockquote>
<blockquote>
<p><strong>ç¼–è¯‘åŒºåˆ«ï¼š</strong> ç”±äºC++æ”¯æŒå‡½æ•°é‡è½½ï¼Œå› æ­¤<u>ç¼–è¯‘å™¨ç¼–è¯‘å‡½æ•°çš„è¿‡ç¨‹ä¸­ä¼šå°†å‡½æ•°çš„å‚æ•°ç±»å‹ä¹ŸåŠ åˆ°ç¼–è¯‘åçš„ä»£ç ä¸­</u>ï¼Œè€Œä¸ä»…ä»…æ˜¯å‡½æ•°åï¼›è€ŒCè¯­è¨€å¹¶ä¸æ”¯æŒå‡½æ•°é‡è½½ï¼Œå› æ­¤ç¼–è¯‘Cè¯­è¨€ä»£ç çš„å‡½æ•°æ—¶ä¸ä¼šå¸¦ä¸Šå‡½æ•°çš„å‚æ•°ç±»å‹ï¼Œä¸€èˆ¬åªåŒ…æ‹¬å‡½æ•°åã€‚</br>
æ€»ç»“: åŒºåˆ«åœ¨äº<font color=red>åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æ˜¯å¦å¸¦ä¸Šå‡½æ•°çš„å‚æ•°ç±»å‹ï¼Œc++å¸¦ï¼Œcä¸å¸¦</font>ã€‚</p>
</blockquote>
<h3 id="17-ç®€è¿°cä»ä»£ç åˆ°å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„è¿‡ç¨‹">1.7 ç®€è¿°C++ä»ä»£ç åˆ°å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„è¿‡ç¨‹</h3>
<blockquote>
<p><strong>é¢„ç¼–è¯‘ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥</strong> </br>
â‘ é¢„ç¼–è¯‘ï¼šè¿™ä¸ªè¿‡ç¨‹ä¸»è¦çš„å¤„ç†æ“ä½œå¦‚ä¸‹ï¼š</br>
<tab>(1) å°†æ‰€æœ‰çš„#defineåˆ é™¤ï¼Œå¹¶ä¸”å±•å¼€æ‰€æœ‰çš„å®å®šä¹‰</br>
<tab>(2) å¤„ç†æ‰€æœ‰çš„<u><font color=purple>æ¡ä»¶é¢„ç¼–è¯‘æŒ‡ä»¤</font></u>ï¼Œå¦‚#ifã€#ifdef</br>
<tab>(3) å¤„ç†#includeé¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œå°†è¢«åŒ…å«çš„æ–‡ä»¶æ’å…¥åˆ°è¯¥é¢„ç¼–è¯‘æŒ‡ä»¤çš„ä½ç½®ã€‚</br>
<tab>(4) è¿‡æ»¤æ‰€æœ‰çš„æ³¨é‡Š</br>
<tab>(5) æ·»åŠ è¡Œå·å’Œæ–‡ä»¶åæ ‡è¯†</br>
â‘¡ç¼–è¯‘ï¼šè¿™ä¸ªè¿‡ç¨‹ä¸»è¦çš„å¤„ç†æ“ä½œå¦‚ä¸‹ï¼š</br>
<tab>(1) è¯æ³•åˆ†æï¼šå°†æºä»£ç çš„å­—ç¬¦åºåˆ—åˆ†å‰²æˆä¸€ç³»åˆ—çš„è®°å·ã€‚</br>
<tab>(2) è¯­æ³•åˆ†æï¼šå¯¹è®°å·è¿›è¡Œè¯­æ³•åˆ†æï¼Œäº§ç”Ÿè¯­æ³•æ ‘ã€‚</br>
<tab>(3) è¯­ä¹‰åˆ†æï¼šåˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦æœ‰æ„ä¹‰ã€‚</br>
<tab>(4) ä»£ç ä¼˜åŒ–ï¼š</br>
<tab>(5) ç›®æ ‡ä»£ç ç”Ÿæˆï¼šç”Ÿæˆæ±‡ç¼–ä»£ç ã€‚</br>
<tab>(6) ç›®æ ‡ä»£ç ä¼˜åŒ–</br>
â‘¢æ±‡ç¼–ï¼šè¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ˜¯å°†æ±‡ç¼–ä»£ç è½¬å˜æˆæœºå™¨å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</br>
â‘£é“¾æ¥ï¼šå°†ä¸åŒçš„æºæ–‡ä»¶äº§ç”Ÿçš„ç›®æ ‡æ–‡ä»¶è¿›è¡Œé“¾æ¥ï¼Œä»è€Œå½¢æˆä¸€ä¸ªå¯ä»¥æ‰§è¡Œçš„ç¨‹åºã€‚</br>
â€‹ <strong>é“¾æ¥åˆ†ä¸º<font color=red>é™æ€é“¾æ¥</font>å’Œ<font color=red>åŠ¨æ€é“¾æ¥</font>ã€‚</strong></br>
â€‹<tab> (1) <strong>é™æ€é“¾æ¥</strong>ï¼Œæ˜¯åœ¨é“¾æ¥çš„æ—¶å€™å°±å·²ç»æŠŠè¦è°ƒç”¨çš„å‡½æ•°æˆ–è€…è¿‡ç¨‹é“¾æ¥åˆ°äº†ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œå°±ç®—ä½ å†å»æŠŠé™æ€åº“åˆ é™¤ä¹Ÿä¸ä¼šå½±å“å¯æ‰§è¡Œç¨‹åºçš„æ‰§è¡Œï¼›ç”Ÿæˆçš„é™æ€é“¾æ¥åº“ï¼ŒWindowsä¸‹ä»¥.libä¸ºåç¼€ï¼ŒLinuxä¸‹ä»¥.aä¸ºåç¼€ã€‚</br></p>
</blockquote>
<p><tab>â€‹ (2) <strong>åŠ¨æ€é“¾æ¥</strong>ï¼Œæ˜¯åœ¨é“¾æ¥çš„æ—¶å€™æ²¡æœ‰æŠŠè°ƒç”¨çš„å‡½æ•°ä»£ç é“¾æ¥è¿›å»ï¼Œè€Œæ˜¯<font color=red>åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­</font>ï¼Œå†å»æ‰¾è¦é“¾æ¥çš„å‡½æ•°ï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­æ²¡æœ‰å‡½æ•°ä»£ç ï¼ŒåªåŒ…å«å‡½æ•°çš„é‡å®šä½ä¿¡æ¯ï¼Œæ‰€ä»¥å½“ä½ åˆ é™¤åŠ¨æ€åº“æ—¶ï¼Œå¯æ‰§è¡Œç¨‹åºå°±ä¸èƒ½è¿è¡Œã€‚ç”Ÿæˆçš„åŠ¨æ€é“¾æ¥åº“ï¼ŒWindowsä¸‹ä»¥.dllä¸ºåç¼€ï¼ŒLinuxä¸‹ä»¥.soä¸ºåç¼€ã€‚</br></p>
<h3 id="18-staticå…³é”®å­—çš„ä½œç”¨">1.8 staticå…³é”®å­—çš„ä½œç”¨</h3>
<blockquote>
<p>â‘ <strong>å®šä¹‰å…¨å±€é™æ€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡</strong>ï¼šåœ¨å˜é‡å‰é¢åŠ ä¸Šstaticå…³é”®å­—ã€‚staticçš„å˜é‡é»˜è®¤åˆå§‹åŒ–ä¸º0ã€‚åˆå§‹åŒ–çš„é™æ€å˜é‡ä¼šåœ¨<font color=red><strong>æ•°æ®æ®µ</strong></font>åˆ†é…å†…å­˜ï¼Œæœªåˆå§‹åŒ–çš„é™æ€å˜é‡ä¼šåœ¨<font color=red><strong>BSSæ®µ</strong></font>åˆ†é…å†…å­˜ã€‚ç›´åˆ°ç¨‹åºç»“æŸï¼Œé™æ€å˜é‡å§‹ç»ˆä¼šç»´æŒå‰å€¼ã€‚åªä¸è¿‡å…¨å±€é™æ€å˜é‡(åœ¨æ•´ä¸ªå·¥ç¨‹æ–‡ä»¶æœ‰æ•ˆ)å’Œå±€éƒ¨é™æ€å˜é‡(åœ¨å½“å‰å®šä¹‰çš„æ–‡ä»¶å†…æœ‰æ•ˆ)çš„ä½œç”¨åŸŸä¸ä¸€æ ·ï¼›</br>
â‘¡<strong>å®šä¹‰é™æ€å‡½æ•°</strong>ï¼šåœ¨å‡½æ•°è¿”å›ç±»å‹å‰åŠ ä¸Šstaticå…³é”®å­—ï¼Œå‡½æ•°å³è¢«å®šä¹‰ä¸ºé™æ€å‡½æ•°ã€‚é™æ€å‡½æ•°åªèƒ½åœ¨æœ¬æºæ–‡ä»¶ä¸­ä½¿ç”¨ï¼›<code>static int func()</code></br>
â‘¢åœ¨å˜é‡ç±»å‹å‰åŠ ä¸Šstaticå…³é”®å­—ï¼Œå˜é‡å³è¢«å®šä¹‰ä¸ºé™æ€å˜é‡ã€‚é™æ€å˜é‡åªèƒ½åœ¨æœ¬æºæ–‡ä»¶ä¸­ä½¿ç”¨;</br>
â‘£<font color=red><strong>ç±»å†…é™æ€æˆå‘˜å˜é‡:</strong></font> åœ¨c++ä¸­ï¼Œstaticå…³é”®å­—å¯ä»¥ç”¨äºå®šä¹‰<strong>ç±»ä¸­çš„é™æ€æˆå‘˜å˜é‡</strong>ï¼šä½¿ç”¨é™æ€æ•°æ®æˆå‘˜ï¼Œå®ƒæ—¢å¯ä»¥è¢«å½“æˆå…¨å±€å˜é‡é‚£æ ·å»å­˜å‚¨ï¼Œä½†åˆè¢«éšè—åœ¨ç±»çš„å†…éƒ¨ã€‚ç±»ä¸­çš„staticé™æ€æ•°æ®æˆå‘˜æ‹¥<strong>æœ‰ä¸€å—å•ç‹¬çš„å­˜å‚¨åŒº</strong>ï¼Œè€Œ<u>ä¸ç®¡åˆ›å»ºäº†å¤šå°‘ä¸ªè¯¥ç±»çš„å¯¹è±¡ã€‚æ‰€æœ‰è¿™äº›å¯¹è±¡çš„é™æ€æ•°æ®æˆå‘˜éƒ½å…±äº«è¿™ä¸€å—é™æ€å­˜å‚¨ç©ºé—´ï¼Œstaticä¿®é¥°çš„å˜é‡è¦åœ¨<font color=purplr><a href="https://blog.csdn.net/sevenjoin/article/details/81772792"target="_blank" rel="external nofollow noopener noreferrer">ç±»å¤–åˆå§‹åŒ–<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></font></u>ã€‚</br>
â‘¤<font color=red><strong>ç±»å†…é™æ€æˆå‘˜å‡½æ•°:</strong></font>åœ¨c++ä¸­ï¼Œstaticå…³é”®å­—å¯ä»¥ç”¨äºå®šä¹‰<strong>ç±»ä¸­çš„é™æ€æˆå‘˜å‡½æ•°</strong>ï¼šä¸é™æ€æˆå‘˜å˜é‡ç±»ä¼¼ï¼Œç±»é‡Œé¢åŒæ ·å¯ä»¥å®šä¹‰é™æ€æˆå‘˜å‡½æ•°ã€‚åªéœ€è¦åœ¨å‡½æ•°å‰åŠ ä¸Šå…³é”®å­—staticå³å¯ã€‚å¦‚é™æ€æˆå‘˜å‡½æ•°ä¹Ÿæ˜¯ç±»çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„ä¸€éƒ¨åˆ†ã€‚æ‰€æœ‰è¿™äº›å¯¹è±¡çš„é™æ€æ•°æ®æˆå‘˜éƒ½å…±äº«è¿™ä¸€å—é™æ€å­˜å‚¨ç©ºé—´ï¼Œåªèƒ½è®¿é—®ç±»çš„staticæˆå‘˜å˜é‡ï¼Œstaticä¿®é¥°çš„å˜é‡è¦åœ¨ç±»å¤–åˆå§‹åŒ–ã€‚</br></p>
</blockquote>
<h3 id="19-æ•°ç»„å’ŒæŒ‡é’ˆçš„åŒºåˆ«">1.9 æ•°ç»„å’ŒæŒ‡é’ˆçš„åŒºåˆ«</h3>
<blockquote>
<p><strong>æ¦‚å¿µï¼š</strong></br>
(1)æ•°ç»„ï¼šæ•°ç»„æ˜¯ç”¨äºå‚¨å­˜å¤šä¸ª<strong>ç›¸åŒç±»å‹æ•°æ®</strong>çš„é›†åˆã€‚æ•°ç»„åæ˜¯é¦–å…ƒç´ çš„åœ°å€ã€‚</br>
(2)æŒ‡é’ˆï¼šæŒ‡é’ˆç›¸å½“äºä¸€ä¸ªå˜é‡ï¼Œä½†æ˜¯å®ƒå’Œä¸€èˆ¬å˜é‡ä¸ä¸€æ ·ï¼Œå®ƒå­˜æ”¾çš„æ˜¯å…¶å®ƒå˜é‡åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚æŒ‡é’ˆåæŒ‡å‘äº†å†…å­˜çš„é¦–åœ°å€ã€‚</br>
<strong>åŒºåˆ«ï¼š</strong></br>
èµ‹å€¼ï¼šåŒç±»å‹æŒ‡é’ˆå˜é‡å¯ä»¥ç›¸äº’èµ‹å€¼ï¼›æ•°ç»„ä¸è¡Œï¼Œåªèƒ½ä¸€ä¸ªä¸€ä¸ªå…ƒç´ çš„èµ‹å€¼æˆ–æ‹·è´ï¼›</br>
<strong>å­˜å‚¨æ–¹å¼ï¼š</strong></br>
æ•°ç»„ï¼šæ•°ç»„åœ¨<strong>å†…å­˜ä¸­æ˜¯è¿ç»­</strong>å­˜æ”¾çš„ï¼Œå¼€è¾Ÿä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ã€‚æ•°ç»„æ˜¯æ ¹æ®æ•°ç»„çš„ä¸‹æ ‡è¿›è¡Œè®¿é—®çš„ï¼Œæ•°ç»„çš„å­˜å‚¨ç©ºé—´ï¼Œä¸æ˜¯åœ¨é™æ€åŒºå°±æ˜¯åœ¨æ ˆä¸Šã€‚</br>
æŒ‡é’ˆï¼šæŒ‡é’ˆå¾ˆçµæ´»ï¼Œå®ƒå¯ä»¥æŒ‡å‘ä»»æ„ç±»å‹çš„æ•°æ®ã€‚æŒ‡é’ˆçš„ç±»å‹è¯´æ˜äº†å®ƒæ‰€æŒ‡å‘åœ°å€ç©ºé—´çš„å†…å­˜ã€‚ç”±äºæŒ‡é’ˆæœ¬èº«å°±æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå†åŠ ä¸Šå®ƒæ‰€å­˜æ”¾çš„ä¹Ÿæ˜¯å˜é‡ï¼Œæ‰€ä»¥æŒ‡é’ˆçš„å­˜å‚¨ç©ºé—´ä¸èƒ½ç¡®å®šã€‚</br></p>
</blockquote>
<h3 id="110-ä»€ä¹ˆæ˜¯å‡½æ•°æŒ‡é’ˆå¦‚ä½•å®šä¹‰å‡½æ•°æŒ‡é’ˆæœ‰ä»€ä¹ˆä½¿ç”¨åœºæ™¯">1.10 ä»€ä¹ˆæ˜¯å‡½æ•°æŒ‡é’ˆï¼Œå¦‚ä½•å®šä¹‰å‡½æ•°æŒ‡é’ˆï¼Œæœ‰ä»€ä¹ˆä½¿ç”¨åœºæ™¯</h3>
<blockquote>
<p><strong>æ¦‚å¿µï¼š</strong> å‡½æ•°æŒ‡é’ˆå°±æ˜¯æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆå˜é‡ã€‚æ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ªå…¥å£åœ°å€ï¼Œè¯¥å‡½æ•°å…¥å£åœ°å€å°±æ˜¯å‡½æ•°æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€ã€‚</br>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">å‡½æ•°æŒ‡é’ˆæŒ‡å‘å‡½æ•°çš„å…¥å£åœ°å€ï¼</div>
    </div>
  </div></p>
</blockquote>
<blockquote>
<p><strong>å®šä¹‰å½¢å¼ï¼š</strong></br></p>
</blockquote>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">func</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="p">)(</span><span class="kt">int</span> <span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">func</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä½¿ç”¨åœºæ™¯ï¼š å›è°ƒ(callback)ã€‚æˆ‘ä»¬è°ƒç”¨åˆ«äººæä¾›çš„ APIå‡½æ•°(Application Programming Interface,åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£)ï¼Œç§°ä¸ºCallï¼›å¦‚æœåˆ«äººçš„åº“é‡Œé¢è°ƒç”¨æˆ‘ä»¬çš„å‡½æ•°ï¼Œå°±å«Callbackã€‚</p>
</blockquote>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//ä»¥åº“å‡½æ•°qsortæ’åºå‡½æ•°ä¸ºä¾‹ï¼Œå®ƒçš„åŸå‹å¦‚ä¸‹ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">qsort</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">base</span><span class="p">,</span><span class="c1">//void*ç±»å‹ï¼Œä»£è¡¨åŸå§‹æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="n">size_t</span> <span class="n">nmemb</span><span class="p">,</span> <span class="c1">//ç¬¬äºŒä¸ªæ˜¯size_tç±»å‹ï¼Œä»£è¡¨æ•°æ®æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="n">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="c1">//ç¬¬ä¸‰ä¸ªæ˜¯size_tç±»å‹ï¼Œä»£è¡¨å•ä¸ªæ•°æ®å ç”¨ç©ºé—´å¤§å°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="kt">int</span><span class="p">(</span><span class="o">*</span><span class="n">compar</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="c1">//ç¬¬å››ä¸ªå‚æ•°æ˜¯å‡½æ•°æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ç¬¬å››ä¸ªå‚æ•°å‘Šè¯‰qsortï¼Œåº”è¯¥ä½¿ç”¨å“ªä¸ªå‡½æ•°æ¥æ¯”è¾ƒå…ƒç´ ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1">//å³åªè¦æˆ‘ä»¬å‘Šè¯‰qsortæ¯”è¾ƒå¤§å°çš„è§„åˆ™ï¼Œå®ƒå°±å¯ä»¥å¸®æˆ‘ä»¬å¯¹ä»»æ„æ•°æ®ç±»å‹çš„æ•°ç»„è¿›è¡Œæ’åºã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">//åœ¨åº“å‡½æ•°qsortè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°ï¼Œè¿™å°±æ˜¯å›è°ƒçš„åº”ç”¨ã€‚
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//ç¤ºä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">num</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">cmp_int</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">_a</span> <span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">_b</span><span class="p">){</span><span class="c1">//å‚æ•°æ ¼å¼å›ºå®š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span><span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">_a</span><span class="p">;</span>    <span class="c1">//å¼ºåˆ¶ç±»å‹è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span><span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">_b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="n">a</span> <span class="o">-</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>ã€€ã€€
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">qsort</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmp_int</span><span class="p">);</span> <span class="c1">//å›è°ƒ
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="111-é™æ€å˜é‡ä»€ä¹ˆæ—¶å€™åˆå§‹åŒ–">1.11 é™æ€å˜é‡ä»€ä¹ˆæ—¶å€™åˆå§‹åŒ–</h3>
<blockquote>
<p>å¯¹äºCè¯­è¨€çš„å…¨å±€å’Œé™æ€å˜é‡ï¼Œåˆå§‹åŒ–å‘ç”Ÿåœ¨ä»»ä½•ä»£ç æ‰§è¡Œä¹‹å‰ï¼Œå±äº<font color=red><strong>ç¼–è¯‘æœŸ</strong></font>åˆå§‹åŒ–ã€‚</br>
è€ŒC++æ ‡å‡†è§„å®šï¼šå…¨å±€æˆ–é™æ€å¯¹è±¡å½“ä¸”ä»…å½“å¯¹è±¡<font color=red>é¦–æ¬¡ç”¨åˆ°æ—¶</font>æ‰è¿›è¡Œæ„é€ ã€‚</p>
</blockquote>
<h3 id="112-nullptrè°ƒç”¨æˆå‘˜å‡½æ•°å¯ä»¥å—ä¸ºä»€ä¹ˆ">1.12 nullptrè°ƒç”¨æˆå‘˜å‡½æ•°å¯ä»¥å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h3>
<p>å¯ä»¥ã€‚å› ä¸º<font color=red>åœ¨ç¼–è¯‘æ—¶å¯¹è±¡å°±ç»‘å®šäº†å‡½æ•°åœ°å€</font>ï¼Œå’ŒæŒ‡é’ˆç©ºä¸ç©ºæ²¡å…³ç³»ã€‚</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//ç»™å‡ºå®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">animal</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">sleep</span><span class="p">()</span> <span class="p">{</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;animal sleep&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">breathe</span><span class="p">()</span> <span class="p">{</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;animal breathe haha&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">fish</span> <span class="o">:</span><span class="k">public</span> <span class="n">animal</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">breathe</span><span class="p">(){</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;fish bubble&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">animal</span> <span class="o">*</span><span class="n">pAn</span><span class="o">=</span><span class="k">nullptr</span><span class="p">;</span>    <span class="c1">//ç±»æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">pAn</span><span class="o">-&gt;</span><span class="n">breathe</span><span class="p">();</span>   <span class="c1">// è¾“å‡ºï¼šanimal breathe haha
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">fish</span> <span class="o">*</span><span class="n">pFish</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">pFish</span><span class="o">-&gt;</span><span class="n">breathe</span><span class="p">();</span> <span class="c1">// è¾“å‡ºï¼šfish bubble
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// åŸå› ï¼šå› ä¸ºåœ¨ç¼–è¯‘æ—¶å¯¹è±¡å°±ç»‘å®šäº†å‡½æ•°åœ°å€ï¼Œå’ŒæŒ‡é’ˆç©ºä¸ç©ºæ²¡å…³ç³»ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// pAn-&gt;breathe();ç¼–è¯‘çš„æ—¶å€™ï¼Œå‡½æ•°çš„åœ°å€å°±å’ŒæŒ‡é’ˆpAnç»‘å®šäº†ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1">// è°ƒç”¨breath(*this), thiså°±ç­‰äºpAnã€‚ç”±äºå‡½æ•°ä¸­æ²¡æœ‰éœ€è¦è§£å¼•ç”¨thisçš„åœ°æ–¹ï¼Œæ‰€ä»¥å‡½æ•°è¿è¡Œä¸ä¼šå‡ºé”™ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1">// ä½†æ˜¯è‹¥ç”¨åˆ°thisï¼Œå› ä¸ºthis=nullptrï¼Œè¿è¡Œå‡ºé”™ã€‚
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="113-ä»€ä¹ˆæ˜¯é‡æŒ‡é’ˆæ€ä¹ˆäº§ç”Ÿçš„å¦‚ä½•é¿å…">1.13 ä»€ä¹ˆæ˜¯é‡æŒ‡é’ˆï¼Œæ€ä¹ˆäº§ç”Ÿçš„ï¼Œå¦‚ä½•é¿å…ï¼Ÿ</h3>
<blockquote>
<p><strong>æ¦‚å¿µï¼š</strong> é‡æŒ‡é’ˆå°±æ˜¯æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®æ˜¯ä¸å¯çŸ¥çš„(éšæœºçš„ã€ä¸æ­£ç¡®çš„ã€æ²¡æœ‰æ˜ç¡®é™åˆ¶çš„)ï¼›</p>
</blockquote>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æŒ‡å‘ä½ç½®ä¸å¯çŸ¥ç§°ä¸ºé‡æŒ‡é’ˆï¼</div>
    </div>
  </div>
<blockquote>
<p>äº§ç”ŸåŸå› ï¼š<u>é‡Šæ”¾å†…å­˜åæŒ‡é’ˆä¸åŠæ—¶ç½®ç©º(é‡æŒ‡é’ˆ)</u>ï¼Œä¾ç„¶æŒ‡å‘äº†è¯¥å†…å­˜ï¼Œé‚£ä¹ˆå¯èƒ½å‡ºç°éæ³•è®¿é—®çš„é”™è¯¯ã€‚è¿™äº›æˆ‘ä»¬éƒ½è¦æ³¨æ„é¿å…ã€‚(å†…å­˜æ³„éœ²)</p>
</blockquote>
<blockquote>
<p>é¿å…åŠæ³•ï¼š</br>
(1)åˆå§‹åŒ–ç½®NULL</br>
(2)ç”³è¯·å†…å­˜ååˆ¤ç©º</br>
(3)æŒ‡é’ˆé‡Šæ”¾åç½®NULL</br>
(4)ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ</br></p>
</blockquote>
<h3 id="114-é™æ€å±€éƒ¨å˜é‡å…¨å±€å˜é‡å±€éƒ¨å˜é‡çš„ç‰¹ç‚¹ä»¥åŠä½¿ç”¨åœºæ™¯">1.14 é™æ€å±€éƒ¨å˜é‡ï¼Œå…¨å±€å˜é‡ï¼Œå±€éƒ¨å˜é‡çš„ç‰¹ç‚¹ï¼Œä»¥åŠä½¿ç”¨åœºæ™¯</h3>
<blockquote>
<p>â‘ é¦–å…ˆä»ä½œç”¨åŸŸè€ƒè™‘ï¼š</br>
C++é‡Œä½œç”¨åŸŸå¯åˆ†ä¸º6ç§ï¼šå…¨å±€ï¼Œå±€éƒ¨ï¼Œç±»ï¼Œè¯­å¥ï¼Œå‘½åç©ºé—´å’Œæ–‡ä»¶ä½œç”¨åŸŸã€‚</br>
å…¨å±€å˜é‡ï¼šå…¨å±€ä½œç”¨åŸŸï¼Œå¯ä»¥é€šè¿‡externä½œç”¨äºå…¶ä»–éå®šä¹‰çš„æºæ–‡ä»¶ã€‚</br>
é™æ€å…¨å±€å˜é‡ ï¼šå…¨å±€ä½œç”¨åŸŸ+æ–‡ä»¶ä½œç”¨åŸŸï¼Œæ‰€ä»¥æ— æ³•åœ¨å…¶ä»–æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚</br>
å±€éƒ¨å˜é‡ï¼šå±€éƒ¨ä½œç”¨åŸŸï¼Œæ¯”å¦‚å‡½æ•°çš„å‚æ•°ï¼Œå‡½æ•°å†…çš„å±€éƒ¨å˜é‡ç­‰ç­‰ã€‚</br>
é™æ€å±€éƒ¨å˜é‡ ï¼šå±€éƒ¨ä½œç”¨åŸŸï¼Œåªè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œç›´åˆ°ç¨‹åºç»“æŸã€‚</br></p>
</blockquote>
<blockquote>
<p>â‘¡ä»æ‰€åœ¨ç©ºé—´è€ƒè™‘ï¼šé™¤äº†å±€éƒ¨å˜é‡åœ¨æ ˆä¸Šå¤–ï¼Œå…¶ä»–éƒ½åœ¨é™æ€å­˜å‚¨åŒºã€‚å› ä¸ºé™æ€å˜é‡éƒ½åœ¨é™æ€å­˜å‚¨åŒºï¼Œæ‰€ä»¥ä¸‹æ¬¡è°ƒç”¨å‡½æ•°çš„æ—¶å€™è¿˜æ˜¯èƒ½å–åˆ°åŸæ¥çš„å€¼ã€‚</br></p>
</blockquote>
<blockquote>
<p>â‘¢ç”Ÿå‘½å‘¨æœŸï¼š å±€éƒ¨å˜é‡åœ¨æ ˆä¸Šï¼Œå‡ºäº†ä½œç”¨åŸŸå°±å›æ”¶å†…å­˜ï¼›è€Œå…¨å±€å˜é‡ã€é™æ€å…¨å±€å˜é‡ã€é™æ€å±€éƒ¨å˜é‡éƒ½åœ¨é™æ€å­˜å‚¨åŒºï¼Œç›´åˆ°ç¨‹åºç»“æŸæ‰ä¼šå›æ”¶å†…å­˜ã€‚</br></p>
</blockquote>
<blockquote>
<p>â‘£ä½¿ç”¨åœºæ™¯ï¼šä»å®ƒä»¬å„è‡ªç‰¹ç‚¹å°±å¯ä»¥çœ‹å‡ºå„è‡ªçš„åº”ç”¨åœºæ™¯ï¼Œä¸å†èµ˜è¿°ã€‚</br></p>
</blockquote>
<h3 id="115-cç»§æ‰¿">1.15 C++ç»§æ‰¿</h3>
<blockquote>
<p>â‘ <strong>å…¬æœ‰ç»§æ‰¿public</strong>ï¼šåŸºç±»çš„å…¬æœ‰æˆå‘˜å’Œä¿æŠ¤æˆå‘˜ä½œä¸ºæ´¾ç”Ÿç±»çš„æˆå‘˜æ—¶ï¼Œå®ƒä»¬éƒ½ä¿æŒåŸæœ‰çš„çŠ¶æ€ï¼Œè€ŒåŸºç±»çš„ç§æœ‰æˆå‘˜ä»ç„¶æ˜¯ç§æœ‰çš„ï¼Œä¸èƒ½è¢«è¿™ä¸ªæ´¾ç”Ÿç±»çš„å­ç±»æ‰€è®¿é—®ã€‚</br>
â‘¡<strong>ç§æœ‰ç»§æ‰¿private</strong>ï¼šç§æœ‰ç»§æ‰¿çš„ç‰¹ç‚¹æ˜¯åŸºç±»çš„å…¬æœ‰æˆå‘˜å’Œä¿æŠ¤æˆå‘˜éƒ½ä½œä¸ºæ´¾ç”Ÿç±»çš„ç§æœ‰æˆå‘˜ï¼Œå¹¶ä¸”ä¸èƒ½è¢«è¿™ä¸ªæ´¾ç”Ÿç±»çš„å­ç±»æ‰€è®¿é—®ã€‚</br>
â‘¢<strong>ä¿æŠ¤ç»§æ‰¿protect</strong>ï¼šä¿æŠ¤ç»§æ‰¿çš„ç‰¹ç‚¹æ˜¯åŸºç±»çš„æ‰€æœ‰å…¬æœ‰æˆå‘˜å’Œä¿æŠ¤æˆå‘˜éƒ½æˆä¸ºæ´¾ç”Ÿç±»çš„ä¿æŠ¤æˆå‘˜ï¼Œå¹¶ä¸”åªèƒ½è¢«å®ƒçš„æ´¾ç”Ÿç±»æˆå‘˜å‡½æ•°æˆ–å‹å…ƒè®¿é—®ï¼ŒåŸºç±»çš„ç§æœ‰æˆå‘˜ä»ç„¶æ˜¯ç§æœ‰çš„</br></p>
</blockquote>
<h3 id="116-å¸¸é‡æŒ‡é’ˆå’ŒæŒ‡é’ˆå¸¸é‡">1.16 å¸¸é‡æŒ‡é’ˆå’ŒæŒ‡é’ˆå¸¸é‡</h3>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">å¸¸é‡æŒ‡é’ˆ: å†…å­˜é‡Œçš„å€¼ä¸å˜</br>
æŒ‡é’ˆå¸¸é‡: æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ°å€ä¸å˜</br></div>
    </div>
  </div>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="mf">1.</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>     <span class="c1">//æŒ‡çš„æ˜¯aæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä¸å…è®¸ä¿®æ”¹ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mf">2.</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">;</span>    <span class="c1">//aæŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜é‡Œçš„å€¼ä¸å˜ï¼Œå³(*a)ä¸å˜  å¸¸é‡æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mf">3.</span> <span class="kt">int</span> <span class="k">const</span> <span class="o">*</span><span class="n">a</span><span class="p">;</span>    <span class="c1">//åŒconst int *a;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="mf">4.</span> <span class="kt">int</span> <span class="o">*</span><span class="k">const</span> <span class="n">a</span><span class="p">;</span>    <span class="c1">//aæŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜åœ°å€ä¸å˜ï¼Œå³aä¸å˜     æŒ‡é’ˆå¸¸é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mf">5.</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="k">const</span> <span class="n">a</span><span class="p">;</span>   <span class="c1">//éƒ½ä¸å˜ï¼Œå³(*a)ä¸å˜ï¼Œaä¹Ÿä¸å˜
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="117-å†…è”å‡½æ•°å’Œå‡½æ•°çš„åŒºåˆ«">1.17 å†…è”å‡½æ•°å’Œå‡½æ•°çš„åŒºåˆ«</h3>
<blockquote>
<p>â‘ å†…è”å‡½æ•°æ¯”æ™®é€šå‡½æ•°å¤šäº†å…³é”®å­—inlineï¼›</br>
â‘¡å†…è”å‡½æ•°é¿å…äº†<strong>å‡½æ•°è°ƒç”¨çš„å¼€é”€</strong>ï¼›æ™®é€šå‡½æ•°æœ‰è°ƒç”¨çš„å¼€é”€ï¼›</br>
â‘¢æ™®é€šå‡½æ•°åœ¨è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œéœ€è¦å¯»å€(å‡½æ•°å…¥å£åœ°å€)ï¼›<u>å†…è”å‡½æ•°ä¸éœ€è¦å¯»å€</u>ã€‚</br>
â‘£å†…è”å‡½æ•°æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œå†…è”å‡½æ•°ä½“è¦æ±‚ä»£ç ç®€å•ï¼Œä¸èƒ½åŒ…å«å¤æ‚çš„ç»“æ„æ§åˆ¶è¯­å¥(å†…è”å‡½æ•°å†…ä¸å…è®¸ç”¨å¾ªç¯è¯­å¥å’Œå¼€å…³è¯­å¥ã€‚æ™®é€šå‡½æ•°æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚</br></p>
</blockquote>
<h3 id="118-ç®€è¿°cæœ‰å‡ ç§ä¼ å€¼æ–¹å¼ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ">1.18 ç®€è¿°C++æœ‰å‡ ç§ä¼ å€¼æ–¹å¼ï¼Œä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<blockquote>
<p><strong>å€¼ä¼ é€’ã€å¼•ç”¨ä¼ é€’ã€æŒ‡é’ˆä¼ é€’</strong></br>
â‘ å€¼ä¼ é€’ï¼šå½¢å‚å³ä½¿åœ¨å‡½æ•°ä½“å†…å€¼å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¸ä¼šå½±å“å®å‚çš„å€¼ï¼›</br>
â‘¡å¼•ç”¨ä¼ é€’ï¼šå½¢å‚åœ¨å‡½æ•°ä½“å†…å€¼å‘ç”Ÿå˜åŒ–ï¼Œä¼šå½±å“å®å‚çš„å€¼ï¼›</br>
â‘¢æŒ‡é’ˆä¼ é€’ï¼šåœ¨æŒ‡é’ˆæŒ‡å‘æ²¡æœ‰å‘ç”Ÿæ”¹å˜çš„å‰æä¸‹ï¼Œå½¢å‚åœ¨å‡½æ•°ä½“å†…å€¼å‘ç”Ÿå˜åŒ–ï¼Œä¼šå½±å“å®å‚çš„å€¼ï¼›</br></p>
</blockquote>
<h3 id="119-å†…è”å‡½æ•°å’Œå®å‡½æ•°çš„åŒºåˆ«">1.19 å†…è”å‡½æ•°å’Œå®å‡½æ•°çš„åŒºåˆ«</h3>
<blockquote>
<p><strong>å®å¸¸é‡&amp;å®å‡½æ•°</strong></br></p>
</blockquote>
<p>å®šä¹‰:</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// a. å®šä¹‰ä¸€ä¸ªå®å¸¸é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define MAX 1024 </span><span class="c1">// å®å¸¸é‡  MAXç§°ä¸ºç¬¦å·å¸¸é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// b. å®šä¹‰ä¸€ä¸ªå®å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1">// å®å‡½æ•°:å®å‡½æ•°å°±æ˜¯ä½¿ç”¨å®å®šä¹‰å®šä¹‰å‡ºæ¥çš„å‡½æ•°,å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„å‡½æ•°ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define GETSUM(x, y) ((x) + (y)) </span><span class="c1">// å®å‡½æ•°
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨å®å‡½æ•°çš„æ³¨æ„äº‹é¡¹: </br></p>
<blockquote>
<ol>
<li>è¦ä¿è¯è¿ç®—çš„å®Œæ•´æ€§ï¼›</br></li>
<li>å®å‡½æ•°çš„ä½¿ç”¨åœºæ™¯:é¢‘ç¹è°ƒç”¨å’ŒçŸ­å°çš„å‡½æ•°,å°è£…æˆå®å‡½æ•°ï¼›</br></li>
<li>ä½¿ç”¨å®å‡½æ•°çš„ä¼˜ç‚¹:ä»¥ç©ºé—´æ¢æ—¶é—´ï¼›</br></li>
</ol>
</blockquote>
<p>å®å®šä¹‰å’Œå‡½æ•°çš„åŒºåˆ«:</br></p>
<blockquote>
<ol>
<li>å®åœ¨é¢„å¤„ç†é˜¶æ®µå®Œæˆæ›¿æ¢ï¼Œä¹‹åè¢«æ›¿æ¢çš„æ–‡æœ¬å‚ä¸ç¼–è¯‘ï¼Œç›¸å½“äºç›´æ¥æ’å…¥äº†ä»£ç ï¼Œè¿è¡Œæ—¶ä¸å­˜åœ¨å‡½æ•°è°ƒç”¨ï¼Œæ‰§è¡Œèµ·æ¥æ›´å¿«ï¼›å‡½æ•°è°ƒç”¨åœ¨è¿è¡Œæ—¶éœ€è¦è·³è½¬åˆ°å…·ä½“è°ƒç”¨å‡½æ•°ï¼›</br></li>
<li>å®å®šä¹‰å±äºåœ¨ç»“æ„ä¸­æ’å…¥ä»£ç ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼›å‡½æ•°è°ƒç”¨å…·æœ‰è¿”å›å€¼ï¼›</br></li>
<li>å®å®šä¹‰å‚æ•°æ²¡æœ‰ç±»å‹ï¼Œä¸è¿›è¡Œç±»å‹æ£€æŸ¥ï¼›å‡½æ•°å‚æ•°å…·æœ‰ç±»å‹ï¼Œéœ€è¦æ£€æŸ¥ç±»å‹ï¼›</br></li>
<li>å®å®šä¹‰ä¸è¦åœ¨æœ€ååŠ åˆ†å·ï¼›</br></li>
</ol>
</blockquote>
<p>å®å®šä¹‰å’Œtypedefçš„åŒºåˆ«:</br></p>
<blockquote>
<ol>
<li>å®ä¸»è¦ç”¨äºå®šä¹‰å¸¸é‡åŠä¹¦å†™å¤æ‚çš„å†…å®¹ï¼›typedefä¸»è¦ç”¨äºå®šä¹‰ç±»å‹åˆ«åï¼›</br></li>
<li>å®æ›¿æ¢å‘ç”Ÿåœ¨<strong>é¢„ç¼–è¯‘é˜¶æ®µ</strong>ï¼Œå±äºæ–‡æœ¬æ’å…¥æ›¿æ¢ï¼›typedefæ˜¯<strong>ç¼–è¯‘</strong>çš„ä¸€éƒ¨åˆ†ï¼›</br></li>
<li>å®ä¸æ£€æŸ¥ç±»å‹ï¼›typedefä¼šæ£€æŸ¥æ•°æ®ç±»å‹ï¼›</br></li>
<li>å®ä¸æ˜¯è¯­å¥ï¼Œä¸åœ¨åœ¨æœ€ååŠ åˆ†å·ï¼›typedefæ˜¯è¯­å¥ï¼Œè¦åŠ åˆ†å·æ ‡è¯†ç»“æŸï¼›</br></li>
<li>æ³¨æ„å¯¹æŒ‡é’ˆçš„æ“ä½œï¼Œ<code>typedef char * p_char</code>å’Œ<code>#define p_char char *</code>åŒºåˆ«å·¨å¤§ï¼›</br></li>
</ol>
</blockquote>
<p>å®å‡½æ•°å’Œå†…è”å‡½æ•°çš„åŒºåˆ«:</br></p>
<blockquote>
<p>1.åœ¨ä½¿ç”¨æ—¶ï¼Œå®åªåšç®€å•å­—ç¬¦ä¸²æ›¿æ¢(ç¼–è¯‘å‰æˆ–è€…é¢„ç¼–è¯‘é˜¶æ®µ)ã€‚è€Œå†…è”å‡½æ•°å¯ä»¥è¿›è¡Œå‚æ•°ç±»å‹æ£€æŸ¥(ç¼–è¯‘æ—¶)ï¼Œä¸”å…·æœ‰è¿”å›å€¼ï¼›</br>
2.å†…è”å‡½æ•°åœ¨ç¼–è¯‘æ—¶ç›´æ¥å°†å‡½æ•°ä»£ç åµŒå…¥åˆ°ç›®æ ‡ä»£ç ä¸­ï¼Œçœå»å‡½æ•°è°ƒç”¨çš„å¼€é”€æ¥æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œå¹¶ä¸”è¿›è¡Œå‚æ•°ç±»å‹æ£€æŸ¥ï¼Œå…·æœ‰è¿”å›å€¼ï¼Œå¯ä»¥å®ç°é‡è½½ï¼›</br>
3.å®å®šä¹‰æ—¶è¦æ³¨æ„ä¹¦å†™(å‚æ•°è¦æ‹¬èµ·æ¥)å¦åˆ™å®¹æ˜“å‡ºç°æ­§ä¹‰(ä¿è¯è¿ç®—çš„å®Œæ•´æ€§)ï¼Œå†…è”å‡½æ•°ä¸ä¼šäº§ç”Ÿæ­§ä¹‰ï¼›</br>
4.å†…è”å‡½æ•°æœ‰ç±»å‹æ£€æµ‹ã€è¯­æ³•åˆ¤æ–­ç­‰åŠŸèƒ½ï¼Œè€Œå®æ²¡æœ‰ï¼›</br></p>
</blockquote>
<p>defineå®å®šä¹‰å’Œconstçš„åŒºåˆ«:</br></p>
<blockquote>
<p>å¤„ç†é˜¶æ®µï¼šdefineæ˜¯åœ¨ç¼–è¯‘çš„é¢„å¤„ç†é˜¶æ®µèµ·ä½œç”¨ï¼Œè€Œconstæ˜¯åœ¨ç¼–è¯‘ã€è¿è¡Œçš„æ—¶å€™èµ·ä½œç”¨ï¼›</p>
</blockquote>
<blockquote>
<p>å®‰å…¨æ€§ï¼š</br></p>
<blockquote>
<ol>
<li>defineåªåšæ›¿æ¢ï¼Œä¸åšç±»å‹æ£€æŸ¥å’Œè®¡ç®—ï¼Œä¹Ÿä¸æ±‚è§£ï¼Œå®¹æ˜“äº§ç”Ÿé”™è¯¯ï¼Œä¸€èˆ¬æœ€å¥½åŠ ä¸Šä¸€ä¸ªå¤§æ‹¬å·åŒ…å«ä½å…¨éƒ¨çš„å†…å®¹ï¼Œè¦ä¸ç„¶å¾ˆå®¹æ˜“å‡ºé”™ï¼›</br></li>
<li>constå¸¸é‡æœ‰æ•°æ®ç±»å‹ï¼Œç¼–è¯‘å™¨å¯ä»¥å¯¹å…¶è¿›è¡Œç±»å‹å®‰å…¨æ£€æŸ¥ï¼›</br></li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<p>å†…å­˜å ç”¨ï¼š</br></p>
<blockquote>
<ol>
<li>defineåªæ˜¯å°†å®åç§°è¿›è¡Œæ›¿æ¢ï¼Œåœ¨å†…å­˜ä¸­ä¼šäº§ç”Ÿå¤šä»½ç›¸åŒçš„å¤‡ä»½ã€‚conståœ¨ç¨‹åºè¿è¡Œä¸­åªæœ‰ä¸€ä»½å¤‡ä»½ï¼Œä¸”å¯ä»¥æ‰§è¡Œå¸¸é‡æŠ˜å ï¼Œèƒ½å°†å¤æ‚çš„çš„è¡¨è¾¾å¼è®¡ç®—å‡ºç»“æœæ”¾å…¥å¸¸é‡è¡¨ï¼›</br></li>
<li>å®å®šä¹‰çš„æ•°æ®æ²¡æœ‰åˆ†é…å†…å­˜ç©ºé—´ï¼Œåªæ˜¯æ’å…¥æ›¿æ¢æ‰ï¼›constå®šä¹‰çš„å˜é‡åªæ˜¯å€¼ä¸èƒ½æ”¹å˜ï¼Œä½†è¦åˆ†é…å†…å­˜ç©ºé—´ï¼›</br></li>
</ol>
</blockquote>
</blockquote>
<h3 id="120å››ç§castç±»å‹è½¬æ¢">1.20Â å››ç§castç±»å‹è½¬æ¢</h3>
<blockquote>
<p>ä½œç”¨ï¼šå…‹æœcè¯­è¨€ä¸­å¼ºåˆ¶ç±»å‹è½¬åŒ–å¸¦æ¥çš„é£é™©ï¼ŒC++å¼•å…¥å››ç§æ›´åŠ å®‰å…¨çš„å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦(æ˜ç¡®è½¬æ¢çš„ç›®çš„ï¼Œä¾¿äºç¨‹åºçš„ç»´æŠ¤å’Œåˆ†æ)</p>
</blockquote>
<ol>
<li>const_castï¼šå»é™¤constå±æ€§</li>
</ol>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// 1.å»é™¤constå±æ€§ï¼Œå°†åªè¯»å˜ä¸ºåªè¯»å†™
</span></span></span><span class="line"><span class="cl"><span class="c1">// 2.é’ˆå¯¹å¸¸é‡æŒ‡é’ˆã€å¸¸é‡å¼•ç”¨å’Œå¸¸é‡å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="o">*</span><span class="n">p1</span> <span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>static_cast: å†…ç½®æ•°æ®ç±»å‹ã€åŸºç±»-æ´¾ç”Ÿç±»ä¹‹é—´çš„è½¬æ¢</li>
</ol>
<blockquote>
<ul>
<li>å†…ç½®æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢ï¼Œintè½¬doubleï¼Œcharè½¬int</br></li>
<li>åŸºç±»æŒ‡é’ˆä¸æ´¾ç”Ÿç±»ä¹‹é—´çš„è½¬æ¢ï¼Œåªèƒ½è½¬æ¢æœ‰ç»§æ‰¿æˆ–æ´¾ç”Ÿå…³ç³»çš„ç±»ã€‚ç”¨äºç±»å±‚æ¬¡ç»“æ„ä¹‹é—´åŸºç±»å’Œæ´¾ç”Ÿç±»æŒ‡é’ˆå’Œå¼•ç”¨ä¹‹é—´çš„è½¬æ¢ï¼Œè¿›è¡Œå‘ä¸Šè½¬å‹æ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯è¿›è¡Œå‘ä¸‹è½¬å‹æ˜¯ä¸å®‰å…¨çš„ï¼Œä½†æ˜¯æ˜¯å¯ä»¥è½¬æ¢çš„;
<ul>
<li>å‘ä¸Šè½¬å‹(å‘åŸºç±»è½¬æ¢ -&gt; å®‰å…¨)ï¼šæˆ‘ä»¬çŸ¥é“åŸºç±»çš„å¼•ç”¨å’ŒæŒ‡é’ˆéƒ½å¯ä»¥æŒ‡å‘æ´¾ç”Ÿç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°†æ´¾ç”Ÿç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨å¼ºè½¬ä¸ºåŸºç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯å‘ä¸Šè½¬å‹ï¼Œä¹Ÿå°±æ˜¯å‘çˆ¶ç±»è½¬;</br></li>
<li>å‘ä¸‹è½¬å‹(å‘æ´¾ç”Ÿç±»è½¬æ¢ -&gt; ä¸å®‰å…¨)ï¼šå‘ä¸‹è½¬å‹å°±å’Œå‘ä¸Šè½¬å‹ç›¸åï¼Œå®ƒæ˜¯å°†çˆ¶ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼Œå¼ºåˆ¶è½¬æ¢ä¸ºå­ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨</br></li>
</ul>
</li>
<li>æŠŠvoidç±»å‹æŒ‡é’ˆè½¬æ¢ä¸ºç›®æ ‡ç±»å‹çš„æŒ‡é’ˆ</br></li>
<li>ä»»ä½•ç±»å‹çš„è¡¨è¾¾å¼è½¬åŒ–ä¸ºvoidç±»å‹</br></li>
</ul>
</blockquote>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// æ•´å½¢è½¬æµ®ç‚¹å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">double</span> <span class="n">b</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//åŸºç±»æŒ‡é’ˆè½¬æ´¾ç”Ÿç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">A</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span> <span class="o">:</span> <span class="k">public</span> <span class="n">A</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">A</span> <span class="o">*</span><span class="n">pA</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">*</span><span class="n">pB</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">B</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">pA</span><span class="p">);</span> <span class="c1">// å‘ä¸‹è½¬æ¢ä¸å®‰å…¨
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>reinterpret_cast:</li>
</ol>
<blockquote>
<ul>
<li>å¯ä»¥å°†ä¸€ä¸ªç±»å‹çš„<strong>æŒ‡é’ˆ</strong>è½¬æ¢ä¸ºå…¶å®ƒä»»æ„ç±»å‹çš„æŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨æŒ‡é’ˆå’Œæ•´å½¢æ•°æ®ä¹‹é—´çš„è½¬æ¢ã€‚å®ƒæ˜¯å¾ˆå±é™©çš„ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨å®ƒçš„å……åˆ†ç†ç”±ï¼Œé‚£ä¹ˆå°±ä¸è¦ä½¿ç”¨å®ƒ</br></li>
<li>ä¸ºè¿ç®—å¯¹è±¡çš„ä½æ¨¡å¼æä¾›è¾ƒä½å±‚æ¬¡ä¸Šçš„é‡æ–°è§£é‡Š</br></li>
<li>ç”¨äºåº•å±‚çš„å¼ºåˆ¶è½¬æ¢ï¼Œä¾èµ–äºæœºå™¨ï¼Œä¸€èˆ¬ä½¿ç”¨è¾ƒå°‘</br></li>
</ul>
</blockquote>
<ol start="4">
<li>dynamic_cast: è¿è¡Œæ—¶å¤„ç†ï¼›åŸºç±»å‘æ´¾ç”Ÿç±»è½¬æ¢æ—¶æ¯”static_castæ›´å®‰å…¨</li>
</ol>
<blockquote>
<ul>
<li>dynamic_castæ˜¯<font color=red>è¿è¡Œæ—¶å¤„ç†</font>çš„ï¼Œè¿è¡Œæ—¶è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œå…¶ä»–ä¸‰ç§æ˜¯ç¼–è¯‘æ—¶å¤„ç†çš„</br></li>
<li>ä¸èƒ½ç”¨äºå†…ç½®æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢</br></li>
<li>dynamic_caståœ¨è¿›è¡Œä¸Šè¡Œè½¬æ¢æ—¶å’Œstatic_castæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è¿›è¡Œä¸‹è¡Œè½¬æ¢æ—¶ä¼šè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œæ¯”static_castæ›´åŠ å®‰å…¨ï¼Œä¸‹è¡Œè½¬æ¢æ˜¯å¦æˆåŠŸå–å†³äºè½¬æ¢å¯¹è±¡çš„å®é™…ç±»å‹ä¸ç›®æ ‡ç±»å‹æ˜¯å¦ç›¸åŒ</br></li>
<li>è¦æ±‚åŸºç±»å¿…é¡»å…·æœ‰è™šå‡½æ•°ï¼Œå¦åˆ™ç¼–è¯‘ä¸é€šè¿‡</br></li>
<li>è‹¥è½¬æ¢æˆåŠŸï¼Œè¿”å›çš„æ˜¯æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œä¸æˆåŠŸè¿”å›NULL</br></li>
</ul>
</blockquote>
<h2 id="2-åŸºç¡€çŸ¥è¯†äºŒ">2. åŸºç¡€çŸ¥è¯†(äºŒ)</h2>
<h3 id="21-å†™å‡º-int-bool-float-æŒ‡é’ˆå˜é‡ä¸-é›¶å€¼æ¯”è¾ƒçš„if-è¯­å¥">2.1 å†™å‡º int ã€boolã€ float ã€æŒ‡é’ˆå˜é‡ä¸ â€œé›¶å€¼â€æ¯”è¾ƒçš„if è¯­å¥</h3>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//intä¸é›¶å€¼æ¯”è¾ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//boolä¸é›¶å€¼æ¯”è¾ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="c1">// è¡¨ç¤ºflagä¸ºçœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">)</span> <span class="c1">// è¡¨ç¤ºflagä¸ºå‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//floatä¸é›¶å€¼æ¯”è¾ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="kt">float</span> <span class="n">EPSINON</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="o">-</span> <span class="n">EPSINON</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">EPSINON</span><span class="p">)</span> <span class="c1">//å…¶ä¸­EPSINONæ˜¯å…è®¸çš„è¯¯å·®(å³ç²¾åº¦)ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//æŒ‡é’ˆå˜é‡ä¸é›¶å€¼æ¯”è¾ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-å˜é‡çš„å£°æ˜å’Œå®šä¹‰æœ‰ä»€ä¹ˆåŒºåˆ«">2.2 å˜é‡çš„å£°æ˜å’Œå®šä¹‰æœ‰ä»€ä¹ˆåŒºåˆ«</h3>
<blockquote>
<p>â‘  å˜é‡çš„å®šä¹‰ä¸ºå˜é‡<u><em>åˆ†é…åœ°å€å’Œå­˜å‚¨ç©ºé—´</em></u>ï¼Œ å˜é‡çš„å£°æ˜ä¸åˆ†é…åœ°å€ã€‚</br>
â‘¡ ä¸€ä¸ªå˜é‡å¯ä»¥åœ¨å¤šä¸ªåœ°æ–¹å£°æ˜ï¼Œ ä½†æ˜¯åªåœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰ã€‚<font color=red>å£°æ˜å¤šæ¬¡ï¼Œå®šä¹‰ä¸€æ¬¡ã€‚</font></br>
â‘¢ åŠ å…¥extern ä¿®é¥°çš„æ˜¯å˜é‡çš„å£°æ˜ï¼Œè¯´æ˜æ­¤å˜é‡å°†åœ¨æ–‡ä»¶å¤–éƒ¨æˆ–åœ¨æ–‡ä»¶åé¢éƒ¨åˆ†å®šä¹‰ã€‚</br>
â‘£ è¯´æ˜ï¼šå¾ˆå¤šæ—¶å€™ä¸€ä¸ªå˜é‡ï¼Œåªæ˜¯å£°æ˜ï¼Œä¸åˆ†é…å†…å­˜ç©ºé—´ï¼Œç›´åˆ°å…·ä½“ä½¿ç”¨æ—¶æ‰åˆå§‹åŒ–ï¼Œåˆ†é…å†…å­˜ç©ºé—´ï¼Œ å¦‚å¤–éƒ¨å˜é‡ã€‚</br></p>
</blockquote>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">extern</span> <span class="kt">int</span> <span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//è¿™æ˜¯ä¸ªå£°æ˜è€Œä¸æ˜¯å®šä¹‰ï¼Œå£°æ˜Aæ˜¯ä¸€ä¸ªå·²ç»å®šä¹‰äº†çš„å¤–éƒ¨å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//æ³¨æ„ï¼šå£°æ˜å¤–éƒ¨å˜é‡æ—¶å¯ä»¥æŠŠå˜é‡ç±»å‹å»æ‰å¦‚ï¼šextern A;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">dosth</span><span class="p">();</span> <span class="c1">//æ‰§è¡Œå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">A</span><span class="p">;</span> <span class="c1">//æ˜¯å®šä¹‰ï¼Œå®šä¹‰äº†Aä¸ºæ•´å‹çš„å¤–éƒ¨å˜é‡
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="23-ç®€è¿°-ifdefelseendifå’Œifndefçš„ä½œç”¨">2.3 ç®€è¿° <code>#ifdef</code>ã€<code>#else</code>ã€<code>#endif</code>å’Œ<code>#ifndef</code>çš„ä½œç”¨</h3>
<p>åˆ©ç”¨ <code>#ifdef</code>ã€<code>#endif</code> <u>å°†æŸç¨‹åºåŠŸèƒ½æ¨¡å—åŒ…æ‹¬è¿›å»ï¼Œä»¥å‘ç‰¹å®šç”¨æˆ·æä¾›è¯¥åŠŸèƒ½</u>ã€‚åœ¨ä¸éœ€è¦æ—¶ç”¨æˆ·å¯è½»æ˜“å°†å…¶å±è”½ã€‚</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">  <span class="cp">#ifdef MATH
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="cp">#include</span> <span class="cpf">â€œmath.câ€</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">  <span class="c1">//åœ¨å­ç¨‹åºå‰åŠ ä¸Šæ ‡è®°ï¼Œä»¥ä¾¿äºè¿½è¸ªå’Œè°ƒè¯•ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="cp">#ifdef DEBUG
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="n">printf</span> <span class="p">(</span><span class="err">â€œ</span><span class="n">Indebugging</span><span class="err">â€¦</span><span class="o">!</span><span class="err">â€</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="cp">#endif</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åº”å¯¹ç¡¬ä»¶çš„é™åˆ¶ã€‚ç”±äºä¸€äº›å…·ä½“åº”ç”¨ç¯å¢ƒçš„ç¡¬ä»¶ä¸ä¸€æ ·ï¼Œé™äºæ¡ä»¶ï¼Œæœ¬åœ°ç¼ºä¹è¿™ç§è®¾å¤‡ï¼Œåªèƒ½ç»•è¿‡ç¡¬ä»¶ï¼Œç›´æ¥å†™å‡ºé¢„æœŸç»“æœã€‚</br>
æ³¨æ„ï¼šè™½ç„¶ä¸ç”¨æ¡ä»¶ç¼–è¯‘å‘½ä»¤è€Œç›´æ¥ç”¨ifè¯­å¥ä¹Ÿèƒ½è¾¾åˆ°è¦æ±‚ï¼Œä½†é‚£æ ·åšç›®æ ‡ç¨‹åºé•¿(å› ä¸ºæ‰€æœ‰è¯­å¥éƒ½ç¼–è¯‘)ï¼Œè¿è¡Œæ—¶é—´é•¿(å› ä¸ºåœ¨ç¨‹åºè¿è¡Œæ—¶é—´å¯¹ifè¯­å¥è¿›è¡Œæµ‹è¯•)ã€‚è€Œé‡‡ç”¨<u><strong>æ¡ä»¶ç¼–è¯‘</strong></u>ï¼Œå¯ä»¥å‡å°‘è¢«ç¼–è¯‘çš„è¯­å¥ï¼Œä»è€Œå‡å°‘ç›®æ ‡ç¨‹åºçš„é•¿åº¦ï¼Œå‡å°‘è¿è¡Œæ—¶é—´ã€‚</p>
<h3 id="24-ç»“æ„ä½“å¯ä»¥ç›´æ¥èµ‹å€¼å—">2.4 ç»“æ„ä½“å¯ä»¥ç›´æ¥èµ‹å€¼å—?</h3>
<blockquote>
<p>â‘ ç»“æ„ä½“å£°æ˜æ—¶å¯ä»¥ç›´æ¥åˆå§‹åŒ–ï¼ŒåŒä¸€ç»“æ„ä½“çš„ä¸åŒå¯¹è±¡ä¹‹é—´ä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œä½†æ˜¯å½“ç»“æ„ä½“ä¸­å«æœ‰æŒ‡é’ˆâ€œæˆå‘˜â€æ—¶ä¸€å®šè¦å°å¿ƒã€‚</br>
â‘¡æ³¨æ„ï¼šå½“æœ‰å¤šä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€æ®µå†…å­˜æ—¶ï¼ŒæŸä¸ªæŒ‡é’ˆé‡Šæ”¾è¿™æ®µå†…å­˜å¯èƒ½ä¼šå¯¼è‡´å…¶ä»–æŒ‡é’ˆçš„éæ³•æ“ä½œã€‚å› æ­¤åœ¨é‡Šæ”¾å‰ä¸€å®šè¦ç¡®ä¿å…¶ä»–æŒ‡é’ˆä¸å†ä½¿ç”¨è¿™æ®µå†…å­˜ç©ºé—´ã€‚</p>
</blockquote>
<h3 id="25-sizeof-å’Œstrlen-çš„åŒºåˆ«">2.5 sizeof å’Œstrlen çš„åŒºåˆ«</h3>
<blockquote>
<p>â‘ sizeofæ˜¯ä¸€ä¸ª<strong>æ“ä½œç¬¦</strong>ï¼Œstrlenæ˜¯<strong>åº“å‡½æ•°</strong>ã€‚</br>
â‘¡sizeofçš„å‚æ•°å¯ä»¥æ˜¯<strong>æ•°æ®çš„ç±»å‹</strong>ï¼Œä¹Ÿå¯ä»¥æ˜¯<strong>å˜é‡</strong>ï¼Œè€Œstrlenåªèƒ½ä»¥ç»“å°¾ä¸ºâ€˜\0â€™çš„å­—ç¬¦ä¸²ä½œå‚æ•°ã€‚</br>
â‘¢ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±è®¡ç®—å‡ºäº†sizeofçš„ç»“æœï¼Œè€Œstrlenå‡½æ•°å¿…é¡»åœ¨è¿è¡Œæ—¶æ‰èƒ½è®¡ç®—å‡ºæ¥ã€‚å¹¶ä¸”sizeofè®¡ç®—çš„æ˜¯æ•°æ®ç±»å‹å å†…å­˜çš„å¤§å°ï¼Œè€Œstrlenè®¡ç®—çš„æ˜¯å­—ç¬¦ä¸²å®é™…çš„é•¿åº¦ã€‚</br>
â‘£æ•°ç»„åšsizeofçš„å‚æ•°ä¸é€€åŒ–ï¼Œä¼ é€’ç»™strlenå°±é€€åŒ–ä¸ºæŒ‡é’ˆäº†</br></p>
</blockquote>
<h3 id="26-sizeofæ±‚ç±»å‹å¤§å°">2.6 sizeofæ±‚ç±»å‹å¤§å°</h3>
<p>ref: <a href="https://www.cnblogs.com/maji233/p/11439880.html"target="_blank" rel="external nofollow noopener noreferrer">https://www.cnblogs.com/maji233/p/11439880.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<blockquote>
<p>â‘ ç±»çš„å¤§å°ä¸ºç±»çš„éé™æ€æˆå‘˜æ•°æ®çš„ç±»å‹å¤§å°ä¹‹å’Œï¼Œä¹Ÿå°±æ˜¯è¯´<font color=red>é™æ€æˆå‘˜æ•°æ®ä¸ä½œè€ƒè™‘</font>ã€‚
æ™®é€šæˆå‘˜å‡½æ•°ä¸sizeofæ— å…³ã€‚</br>
â‘¡è™šå‡½æ•°ç”±äºè¦ç»´æŠ¤è™šå‡½æ•°è¡¨ï¼Œæ‰€ä»¥è¦å æ®ä¸€ä¸ªæŒ‡é’ˆå¤§å°ï¼Œä¹Ÿå°±æ˜¯4å­—èŠ‚ã€‚
ç±»çš„æ€»å¤§å°ä¹Ÿéµå®ˆç±»ä¼¼classå­—èŠ‚å¯¹é½çš„ï¼Œè°ƒæ•´è§„åˆ™ã€‚</br></p>
</blockquote>
<p>ref:</br></p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(32 ä½)
</span></span><span class="line"><span class="cl">æŒ‡é’ˆéƒ½æ˜¯  4ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">char     1ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">short ä¸¤ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">int      4ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">long     4ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">long int 4ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">float    4ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">double    8ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">long double  8ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">(64 å­—èŠ‚)
</span></span><span class="line"><span class="cl">æŒ‡é’ˆéƒ½æ˜¯ä¸€ä¸ªå­—é•¿, 8ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">char    1ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">short   2ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">int     4ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">long    8ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">long int  8ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">double    8ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">long double ä¹Ÿå¯ä»¥å˜é•¿äº†, 16ä¸ªå­—èŠ‚</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¾‹å¦‚æœ‰å¦‚ä¸‹ç»“æ„ä½“ï¼š</p>
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">    <span class="k">struct</span> <span class="nc">Stu</span>  <span class="c1">//è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œå…è®¸ç”¨æˆ·å­˜å‚¨ä¸åŒçš„æ•°æ®ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">char</span> <span class="n">sex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">float</span> <span class="n">hight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆä¸€ä¸ªè¿™æ ·çš„ç»“æ„ä½“å˜é‡å å¤šå¤§å†…å­˜å‘¢ï¼Ÿä¹Ÿå°±æ˜¯ <code>cout&lt;&lt;sizeof(Stu)&lt;&lt;endl;</code>  ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ
åœ¨äº†è§£å­—èŠ‚å¯¹é½æ–¹å¼ä¹‹å‰æƒ³å½“ç„¶çš„ä¼šä»¥ä¸ºï¼šsizeof(Stu) = sizeof(int)+sizeof(char)+sizeof(float) = 9.
ç„¶è€Œäº‹å®å¹¶éå¦‚æ­¤ï¼</p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>å­—èŠ‚å¯¹é½åŸåˆ™<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">åœ¨ç³»ç»Ÿé»˜è®¤çš„å¯¹é½æ–¹å¼ä¸‹ï¼šæ¯ä¸ªæˆå‘˜ç›¸å¯¹äºè¿™ä¸ªç»“æ„ä½“å˜é‡åœ°å€çš„åç§»é‡æ­£å¥½æ˜¯è¯¥æˆå‘˜ç±»å‹æ‰€å å­—èŠ‚çš„æ•´æ•°å€ï¼Œä¸”æœ€ç»ˆå ç”¨å­—èŠ‚æ•°ä¸ºæˆå‘˜ç±»å‹ä¸­æœ€å¤§å ç”¨å­—èŠ‚æ•°çš„æ•´æ•°å€ã€‚</div>
    </div>
  </div>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œidçš„åç§»é‡ä¸º0(0=4x0)ï¼Œsexçš„åç§»é‡ä¸º4(4=1x4)ï¼Œheightçš„åç§»é‡ä¸º8(8=2x4)ï¼Œæ­¤æ—¶å ç”¨12å­—èŠ‚ï¼Œä¹ŸåŒæ—¶æ»¡è¶³12=3x4.æ‰€ä»¥sizeof(Stu)=12.</p>
<blockquote>
<p>æ€»ç»“ï¼š</br>
â‘ æœ€ç»ˆå¤§å°ä¸€å®šæ˜¯æœ€å¤§æ•°æ®ç±»å‹çš„æ•´æ•°å€ï¼›</br>
â‘¡é™æ€å˜é‡ä¸å ç©ºé—´</br>
â‘¢æ¯ç§ç±»å‹çš„åç§»é‡ä¸ºè‡ªèº«çš„nå€ï¼›</br>
è¯¦ç»†è¯·æŸ¥é˜…ï¼š<a href="https://blog.csdn.net/weixin_30412577/article/details/95141536?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task"target="_blank" rel="external nofollow noopener noreferrer">struct/classç­‰å†…å­˜å­—èŠ‚å¯¹é½é—®é¢˜è¯¦è§£<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></p>
</blockquote>
<p>ref:</br>
<a href="https://www.cnblogs.com/always-chang/p/6084973.html#:~:text=1.%E5%B1%95%E5%BC%80%E5%90%8E%E7%9A%84%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%88%90%E5%91%98%E7%9A%84%E5%81%8F%E7%A7%BB%E9%87%8F%EF%BC%88%E5%B5%8C%E5%A5%97%E7%9A%84%E7%BB%93%E6%9E%84%E4%BD%93%E5%81%8F%E7%A7%BB%E9%87%8F%EF%BC%89%E5%BA%94%E5%BD%93%E6%98%AF%E8%A2%AB%E5%B1%95%E5%BC%80%E7%9A%84%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%AD%E6%9C%80%E5%A4%A7%E6%88%90%E5%91%98%E7%9A%84%E6%95%B4%E6%95%B0%E5%80%8D%EF%BC%9B,2.%E7%BB%93%E6%9E%84%E4%BD%93%E5%A4%A7%E5%B0%8F%E5%BF%85%E9%A1%BB%E6%98%AF%E6%89%80%E6%9C%89%E6%88%90%E5%91%98%E5%A4%A7%E5%B0%8F%E7%9A%84%E6%95%B4%E6%95%B0%E5%80%8D%EF%BC%8C%E8%BF%99%E9%87%8C%E8%AE%A1%E7%AE%97%E7%9A%84%E6%98%AF%E5%B1%95%E5%BC%80%E5%90%8E%E7%9A%84%E6%88%90%E5%91%98%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E5%B0%86%E5%B5%8C%E5%A5%97%E7%9A%84%E7%BB%93%E6%9E%84%E4%BD%93%E7%9C%8B%E4%BD%9C%E4%B8%80%E4%B8%AA%E6%95%B4%E4%BD%93%E3%80%82"target="_blank" rel="external nofollow noopener noreferrer">structåœ°å€åç§»é‡è®¡ç®—<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<h3 id="27-cè¯­è¨€çš„å…³é”®å­—staticå’Œcçš„å…³é”®å­—staticæœ‰ä»€ä¹ˆåŒºåˆ«">2.7 Cè¯­è¨€çš„å…³é”®å­—<code>static</code>å’ŒC++çš„å…³é”®å­—<code>static</code>æœ‰ä»€ä¹ˆåŒºåˆ«</h3>
<blockquote>
<p>â‘ åœ¨ C ä¸­ static ç”¨æ¥ä¿®é¥°å±€éƒ¨é™æ€å˜é‡å’Œå¤–éƒ¨é™æ€å˜é‡ã€å‡½æ•°ã€‚è€Œ C++ä¸­é™¤äº†ä¸Šè¿°åŠŸèƒ½å¤–ï¼Œè¿˜ç”¨æ¥å®šä¹‰ç±»çš„æˆå‘˜å˜é‡å’Œå‡½æ•°ã€‚å³é™æ€æˆå‘˜å’Œé™æ€æˆå‘˜å‡½æ•°ã€‚</br>
â‘¡æ³¨æ„ï¼šç¼–ç¨‹æ—¶ static çš„è®°å¿†æ€§å’Œå…¨å±€æ€§çš„ç‰¹ç‚¹å¯ä»¥è®©åœ¨ä¸åŒæ—¶æœŸè°ƒç”¨çš„å‡½æ•°è¿›è¡Œé€šä¿¡ï¼Œä¼ é€’ä¿¡æ¯ï¼Œè€Œ C++çš„é™æ€æˆå‘˜åˆ™å¯ä»¥åœ¨å¤šä¸ªå¯¹è±¡å®ä¾‹é—´è¿›è¡Œé€šä¿¡ï¼Œä¼ é€’ä¿¡æ¯ã€‚</br></p>
</blockquote>
<h3 id="28-ï½ƒè¯­è¨€çš„mallocå’Œï½ƒä¸­çš„newæœ‰ä»€ä¹ˆåŒºåˆ«">2.8 ï¼£è¯­è¨€çš„<code>malloc</code>å’Œï¼£ï¼‹ï¼‹ä¸­çš„<code>new</code>æœ‰ä»€ä¹ˆåŒºåˆ«</h3>
<blockquote>
<p>â‘ new ã€delete æ˜¯æ“ä½œç¬¦ï¼Œå¯ä»¥é‡è½½ï¼Œåªèƒ½åœ¨C++ ä¸­ä½¿ç”¨ã€‚</br>
â‘¡mallocã€free æ˜¯å‡½æ•°ï¼Œå¯ä»¥è¦†ç›–ï¼ŒCã€C++ ä¸­éƒ½å¯ä»¥ä½¿ç”¨ã€‚</br>
â‘¢new å¯ä»¥è°ƒç”¨å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œå¯¹åº”çš„delete è°ƒç”¨ç›¸åº”çš„ææ„å‡½æ•°ã€‚</br>
â‘£malloc ä»…ä»…åˆ†é…å†…å­˜ï¼Œfree ä»…ä»…å›æ”¶å†…å­˜ï¼Œå¹¶ä¸æ‰§è¡Œæ„é€ å’Œææ„å‡½æ•°ã€‚</br>
â‘¤new ã€delete è¿”å›çš„æ˜¯<strong>æŸç§æ•°æ®ç±»å‹æŒ‡é’ˆ</strong>ï¼Œmallocã€free è¿”å›çš„æ˜¯**<code>void</code>æŒ‡é’ˆ**ã€‚</br>
æ³¨æ„ï¼š<code>malloc</code>ç”³è¯·çš„å†…å­˜ç©ºé—´è¦ç”¨<code>free</code>é‡Šæ”¾ï¼Œè€Œ<code>new</code>ç”³è¯·çš„å†…å­˜ç©ºé—´è¦ç”¨<code>delete</code>é‡Šæ”¾ï¼Œä¸è¦æ··ç”¨ã€‚</br></p>
</blockquote>
<p>ref: <a href="https://jianye0428.github.io/posts/basics_one/#211-new%E5%92%8Cmalloc%E7%9A%84%E5%8C%BA%E5%88%AB%E5%90%84%E8%87%AA%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-delete-%E5%92%8C-free%E7%B1%BB%E4%BC%BC"target="_blank" rel="external nofollow noopener noreferrer">2.11 new å’Œ mallocçš„åŒºåˆ«<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<h3 id="29-å†™ä¸€ä¸ª-æ ‡å‡†-å®min">2.9 å†™ä¸€ä¸ª â€œæ ‡å‡†â€ å®MIN</h3>
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#define min(a,b) ((a)&lt;=(b)?(a):(b))</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="210-iå’Œiçš„åŒºåˆ«">2.10 ++iå’Œi++çš„åŒºåˆ«</h3>
<blockquote>
<p>++iå…ˆè‡ªå¢1ï¼Œå†è¿”å›ï¼›i++å…ˆè¿”å›i,å†è‡ªå¢1</br>
å‰ç½®ç‰ˆæœ¬å°†å¯¹è±¡æœ¬èº«ä½œä¸ºå·¦å€¼è¿”å›ï¼Œåç½®ç‰ˆæœ¬å°†å¯¹è±¡åŸå§‹å€¼çš„å‰¯æœ¬ä½œä¸ºå³å€¼è¿”å›ã€‚</p>
</blockquote>
<h3 id="211-newå’Œmallocçš„åŒºåˆ«å„è‡ªåº•å±‚å®ç°åŸç†deleteå’Œfreeç±»ä¼¼">2.11 <code>new</code>å’Œ<code>malloc</code>çš„åŒºåˆ«ï¼Œå„è‡ªåº•å±‚å®ç°åŸç†(<code>delete</code>å’Œ<code>free</code>ç±»ä¼¼)</h3>
<blockquote>
<p>â‘ new(delete)æ˜¯æ“ä½œç¬¦ï¼Œè€Œmalloc(free)æ˜¯å‡½æ•°ã€‚</br>
â‘¡newåœ¨è°ƒç”¨çš„æ—¶å€™å…ˆåˆ†é…å†…å­˜ï¼Œå†è°ƒç”¨æ„é€ å‡½æ•°ï¼Œé‡Šæ”¾çš„æ—¶å€™è°ƒç”¨ææ„å‡½æ•°ï¼›è€Œmallocæ²¡æœ‰æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ã€‚</br>
â‘¢mallocéœ€è¦ç»™å®šç”³è¯·å†…å­˜çš„å¤§å°ï¼Œè¿”å›çš„æŒ‡é’ˆéœ€è¦å¼ºè½¬ï¼›newä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼Œä¸ç”¨æŒ‡å®šå†…å­˜çš„å¤§å°ï¼Œè¿”å›æŒ‡é’ˆä¸ç”¨å¼ºè½¬ã€‚</br>
â‘£newå¯ä»¥è¢«é‡è½½; mallocä¸è¡Œ</br>
â‘¤newåˆ†é…å†…å­˜, æ›´ç›´æ¥å’Œå®‰å…¨ã€‚</br>
â‘¥newå‘ç”Ÿé”™è¯¯æŠ›å‡ºå¼‚å¸¸ï¼Œmallocè¿”å›null</br></p>
</blockquote>
<h3 id="212-const-å’Œ-define-çš„åŒºåˆ«">2.12 const å’Œ define çš„åŒºåˆ«</h3>
<p><strong>åŒºåˆ«</strong></br></p>
<blockquote>
<p>(1)å°±<font color=red>èµ·ä½œç”¨çš„é˜¶æ®µ</font>è€Œè¨€ï¼š<code>#define</code>æ˜¯åœ¨ç¼–è¯‘çš„é¢„å¤„ç†é˜¶æ®µèµ·ä½œç”¨ï¼Œè€Œ<code>const</code>æ˜¯åœ¨ ç¼–è¯‘ã€è¿è¡Œçš„æ—¶å€™èµ·ä½œç”¨ã€‚</br>
(2)å°±<font color=red>èµ·ä½œç”¨çš„æ–¹å¼</font>è€Œè¨€ï¼š<code>#define</code>åªæ˜¯<u>ç®€å•çš„å­—ç¬¦ä¸²æ›¿æ¢ï¼Œæ²¡æœ‰ç±»å‹æ£€æŸ¥</u>ã€‚è€Œ<code>const</code>æœ‰å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œæ˜¯è¦è¿›è¡Œåˆ¤æ–­çš„ï¼Œå¯ä»¥é¿å…ä¸€äº›ä½çº§çš„é”™è¯¯ã€‚</br>
(3)å°±<font color=red>å­˜å‚¨æ–¹å¼</font>è€Œè¨€ï¼š<code>#define</code>åªæ˜¯è¿›è¡Œå±•å¼€ï¼Œæœ‰å¤šå°‘åœ°æ–¹ä½¿ç”¨ï¼Œå°±æ›¿æ¢å¤šå°‘æ¬¡ï¼Œå®ƒå®šä¹‰çš„å®å¸¸é‡åœ¨å†…å­˜ä¸­æœ‰è‹¥å¹²ä¸ªå¤‡ä»½ï¼›constå®šä¹‰çš„åªè¯»å˜é‡åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªæœ‰ä¸€ä»½å¤‡ä»½ã€‚</br>
(4)ä»<font color=red>ä»£ç è°ƒè¯•çš„æ–¹ä¾¿ç¨‹åº¦</font>è€Œè¨€ï¼š <code>const</code>å¸¸é‡å¯ä»¥è¿›è¡Œè°ƒè¯•çš„ï¼Œ<code>define</code>æ˜¯ä¸èƒ½è¿›è¡Œè°ƒè¯•çš„ï¼Œå› ä¸ºåœ¨é¢„ç¼–è¯‘é˜¶æ®µå°±å·²ç»æ›¿æ¢æ‰äº†ã€‚</br></p>
</blockquote>
<p><strong>constä¼˜ç‚¹ï¼š</strong></p>
<blockquote>
<p>(1)constå¸¸é‡æœ‰æ•°æ®ç±»å‹ï¼Œè€Œå®å¸¸é‡æ²¡æœ‰æ•°æ®ç±»å‹ã€‚ç¼–è¯‘å™¨å¯ä»¥å¯¹å‰è€…è¿›è¡Œç±»å‹å®‰å…¨æ£€æŸ¥ã€‚è€Œå¯¹åè€…åªè¿›è¡Œå­—ç¬¦æ›¿æ¢ï¼Œæ²¡æœ‰ç±»å‹å®‰å…¨æ£€æŸ¥ï¼Œå¹¶ä¸”åœ¨å­—ç¬¦æ›¿æ¢å¯èƒ½ä¼šäº§ç”Ÿæ„æ–™ä¸åˆ°çš„é”™è¯¯ã€‚</br>
(2)æœ‰äº›é›†æˆåŒ–çš„è°ƒè¯•å·¥å…·å¯ä»¥å¯¹constå¸¸é‡è¿›è¡Œè°ƒè¯•ï¼Œä½†æ˜¯ä¸èƒ½å¯¹å®å¸¸é‡è¿›è¡Œè°ƒè¯•ã€‚</br>
(3)constå¯èŠ‚çœç©ºé—´ï¼Œé¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…ï¼Œæé«˜æ•ˆç‡</br></p>
</blockquote>
<h3 id="213cä¸­å‡½æ•°æŒ‡é’ˆå’ŒæŒ‡é’ˆå‡½æ•°çš„åŒºåˆ«">2.13Â C++ä¸­å‡½æ•°æŒ‡é’ˆå’ŒæŒ‡é’ˆå‡½æ•°çš„åŒºåˆ«</h3>
<ol>
<li>å®šä¹‰ä¸åŒ</li>
</ol>
<blockquote>
<p>æŒ‡é’ˆå‡½æ•°æœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶è¿”å›å€¼ä¸ºæŒ‡é’ˆã€‚</br>
å‡½æ•°æŒ‡é’ˆæœ¬è´¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå…¶æŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚</br></p>
</blockquote>
<ol start="2">
<li>å†™æ³•ä¸åŒ</li>
</ol>
<blockquote>
<p>æŒ‡é’ˆå‡½æ•°ï¼šint *fun(int x, int y);</br>
å‡½æ•°æŒ‡é’ˆï¼šint (*fun)(int x, int y);</br></p>
</blockquote>
<ol start="3">
<li>ç”¨æ³•ä¸åŒ</li>
</ol>
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//æŒ‡é’ˆå‡½æ•°ç¤ºä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="k">struct</span> <span class="nc">_Data</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="n">Data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æŒ‡é’ˆå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Data</span><span class="o">*</span> <span class="nf">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="n">Data</span> <span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//è°ƒç”¨æŒ‡é’ˆå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Data</span> <span class="o">*</span> <span class="n">myData</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//Data * myData = static_cast&lt;Data*&gt;(f(4,5));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//å‡½æ•°æŒ‡é’ˆç¤ºä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">y</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å‡½æ•°æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fun</span><span class="p">)(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//èµ‹å€¼, å‡½æ•°æŒ‡é’ˆæŒ‡å‘å‡½æ•°add
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">fun</span> <span class="o">=</span> <span class="n">add</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;(*fun)(1,2) = &#34;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="o">*</span><span class="n">fun</span><span class="p">)(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è¾“å‡ºç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1">//(*fun)(1,2) =  3
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="214ä½¿ç”¨æŒ‡é’ˆéœ€è¦æ³¨æ„ä»€ä¹ˆ">2.14Â ä½¿ç”¨æŒ‡é’ˆéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h3>
<blockquote>
<p>â‘ å®šä¹‰æŒ‡é’ˆæ—¶ï¼Œå…ˆåˆå§‹åŒ–ä¸ºNULLç©ºæŒ‡é’ˆã€‚</br>
â‘¡ç”¨mallocæˆ–newç”³è¯·å†…å­˜ä¹‹åï¼Œåº”è¯¥ç«‹å³æ£€æŸ¥æŒ‡é’ˆå€¼æ˜¯å¦ä¸ºNULLã€‚é˜²æ­¢ä½¿ç”¨æŒ‡é’ˆå€¼ä¸ºNULLçš„å†…å­˜ã€‚</br>
â‘¢ä¸è¦å¿˜è®°ä¸ºæ•°ç»„å’ŒåŠ¨æ€å†…å­˜èµ‹åˆå€¼ã€‚é˜²æ­¢å°†æœªè¢«åˆå§‹åŒ–çš„å†…å­˜ä½œä¸ºå³å€¼ä½¿ç”¨ã€‚</br>
â‘£é¿å…æ•°å­—æˆ–æŒ‡é’ˆçš„ä¸‹æ ‡è¶Šç•Œï¼Œç‰¹åˆ«è¦å½“å¿ƒå‘ç”Ÿâ€œå¤š1â€æˆ–è€…â€œå°‘1â€æ“ä½œã€‚</br>
â‘¤åŠ¨æ€å†…å­˜çš„ç”³è¯·ä¸é‡Šæ”¾å¿…é¡»é…å¯¹ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</br>
â‘¥ç”¨freeæˆ–deleteé‡Šæ”¾äº†å†…å­˜ä¹‹åï¼Œç«‹å³å°†æŒ‡é’ˆè®¾ç½®ä¸ºNULLï¼Œé˜²æ­¢â€œé‡æŒ‡é’ˆâ€ã€‚</br></p>
</blockquote>
<h3 id="215volatileæœ‰ä»€ä¹ˆä½œç”¨">2.15Â volatileæœ‰ä»€ä¹ˆä½œç”¨</h3>
<blockquote>
<p>â‘ volatileä¸ºçŠ¶æ€å¯„å­˜å™¨ä¸€ç±»çš„å¹¶è¡Œè®¾å¤‡ç¡¬ä»¶å¯„å­˜å™¨ã€‚</br>
â‘¡ä¸€ä¸ªä¸­æ–­æœåŠ¡å­ç¨‹åºä¼šè®¿é—®åˆ°çš„éè‡ªåŠ¨å˜é‡ã€‚</br>
â‘¢å¤šçº¿ç¨‹é—´è¢«å‡ ä¸ªä»»åŠ¡å…±äº«çš„å˜é‡ã€‚</br>
æ³¨æ„ï¼šè™½ç„¶volatileåœ¨åµŒå…¥å¼æ–¹é¢åº”ç”¨æ¯”è¾ƒå¤šï¼Œä½†æ˜¯åœ¨PCè½¯ä»¶çš„å¤šçº¿ç¨‹ä¸­ï¼Œvolatileä¿®é¥°çš„ä¸´ç•Œå˜é‡ä¹Ÿæ˜¯éå¸¸å®ç”¨çš„ã€‚</p>
</blockquote>
<p>C++ä¸­volatileçš„ä½œç”¨:</br>
<font color=red>æ€»ç»“: å»ºè®®ç¼–è¯‘å™¨ä¸è¦å¯¹è¯¥å˜é‡è¿›è¡Œä¼˜åŒ–ï¼Œæ¯æ¬¡éƒ½ä»å†…å­˜ä¸­è¯»å–è¯¥å˜é‡ï¼Œè€Œä¸æ˜¯ä»ç¼“å­˜(å¯„å­˜å™¨)ä¸­è¯»å–å˜é‡ã€‚</font></p>
<blockquote>
<p>volatileæ˜¯â€œæ˜“å˜/ä¸ç¨³å®šâ€çš„æ„æ€ã€‚volatileæ˜¯Cçš„ä¸€ä¸ªè¾ƒä¸ºå°‘ç”¨çš„å…³é”®å­—ï¼Œè§£å†³å˜é‡åœ¨â€œå…±äº«â€ç¯å¢ƒä¸‹å®¹æ˜“å‡ºç°è¯»å–é”™è¯¯çš„é—®é¢˜ã€‚</br></p>
</blockquote>
<blockquote>
<p>å®šä¹‰ä¸ºvolatileçš„å˜é‡æ˜¯è¯´è¿™å˜é‡å¯èƒ½ä¼šè¢«æ„æƒ³ä¸åˆ°åœ°æ”¹å˜ï¼Œå³åœ¨ä½ ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¸€ç›´ä¼šå˜ï¼Œ<font color=red>ä½ å¸Œæœ›è¿™ä¸ªå€¼è¢«æ­£ç¡®åœ°å¤„ç†ï¼Œæ¯æ¬¡ä»å†…å­˜ä¸­å»è¯»è¿™ä¸ªå€¼ï¼Œè€Œä¸æ˜¯å› ç¼–è¯‘å™¨ä¼˜åŒ–ä»ç¼“å­˜çš„åœ°æ–¹è¯»å–</font>ï¼Œæ¯”å¦‚è¯»å–ç¼“å­˜åœ¨å¯„å­˜å™¨ä¸­çš„æ•°å€¼ï¼Œä»è€Œä¿è¯volatileå˜é‡è¢«æ­£ç¡®çš„è¯»å–ã€‚</br></p>
</blockquote>
<blockquote>
<p>åœ¨å•ä»»åŠ¡çš„ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªå‡½æ•°ä½“å†…éƒ¨ï¼Œå¦‚æœåœ¨ä¸¤æ¬¡è¯»å–å˜é‡çš„å€¼ä¹‹é—´çš„è¯­å¥æ²¡æœ‰å¯¹å˜é‡çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šè®¾æ³•å¯¹å¯æ‰§è¡Œä»£ç è¿›è¡Œä¼˜åŒ–ã€‚ç”±äºè®¿é—®å¯„å­˜å™¨çš„é€Ÿåº¦è¦å¿«è¿‡RAM(ä»RAMä¸­è¯»å–å˜é‡çš„å€¼åˆ°å¯„å­˜å™¨)ï¼Œä»¥ååªè¦å˜é‡çš„å€¼æ²¡æœ‰æ”¹å˜ï¼Œå°±ä¸€ç›´ä»å¯„å­˜å™¨ä¸­è¯»å–å˜é‡çš„å€¼ï¼Œè€Œä¸å¯¹RAMè¿›è¡Œè®¿é—®ã€‚</br></p>
</blockquote>
<blockquote>
<p>è€Œåœ¨å¤šä»»åŠ¡ç¯å¢ƒä¸­ï¼Œè™½ç„¶åœ¨ä¸€ä¸ªå‡½æ•°ä½“å†…éƒ¨ï¼Œåœ¨ä¸¤æ¬¡è¯»å–å˜é‡ä¹‹é—´æ²¡æœ‰å¯¹å˜é‡çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œä½†æ˜¯è¯¥å˜é‡ä»ç„¶æœ‰å¯èƒ½è¢«å…¶ä»–çš„ç¨‹åº(å¦‚ä¸­æ–­ç¨‹åºã€å¦å¤–çš„çº¿ç¨‹ç­‰)æ‰€ä¿®æ”¹ã€‚å¦‚æœè¿™æ—¶è¿˜æ˜¯ä»å¯„å­˜å™¨è€Œä¸æ˜¯ä»RAMä¸­è¯»å–ï¼Œå°±ä¼šå‡ºç°è¢«ä¿®æ”¹äº†çš„å˜é‡å€¼ä¸èƒ½å¾—åˆ°åŠæ—¶ååº”çš„é—®é¢˜ã€‚</br></p>
</blockquote>
<h3 id="216-ä¸€ä¸ªå‚æ•°å¯ä»¥æ—¢æ˜¯conståˆæ˜¯volatileå—">2.16 ä¸€ä¸ªå‚æ•°å¯ä»¥æ—¢æ˜¯conståˆæ˜¯volatileå—</h3>
<blockquote>
<p>å¯ä»¥ã€‚ç”¨constå’ŒvolatileåŒæ—¶ä¿®é¥°å˜é‡ï¼Œè¡¨ç¤ºè¿™ä¸ªå˜é‡åœ¨ç¨‹åºå†…éƒ¨æ˜¯åªè¯»çš„ï¼Œä¸èƒ½æ”¹å˜çš„ï¼Œåªåœ¨ç¨‹åºå¤–éƒ¨æ¡ä»¶å˜åŒ–ä¸‹æ”¹å˜ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨ä¸ä¼šä¼˜åŒ–è¿™ä¸ªå˜é‡ã€‚æ¯æ¬¡ä½¿ç”¨è¿™ä¸ªå˜é‡æ—¶ï¼Œéƒ½è¦å°å¿ƒåœ°å»å†…å­˜è¯»å–è¿™ä¸ªå˜é‡çš„å€¼ï¼Œè€Œä¸æ˜¯å»å¯„å­˜å™¨è¯»å–å®ƒçš„å¤‡ä»½ã€‚</br>
æ³¨æ„ï¼šåœ¨æ­¤ä¸€å®šè¦æ³¨æ„constçš„æ„æ€ï¼Œconståªæ˜¯ä¸å…è®¸ç¨‹åºä¸­çš„ä»£ç æ”¹å˜æŸä¸€å˜é‡ï¼Œå…¶åœ¨ç¼–è¯‘æœŸå‘æŒ¥ä½œç”¨ï¼Œå®ƒå¹¶<font color=red>æ²¡æœ‰å®é™…åœ°ç¦æ­¢æŸæ®µå†…å­˜çš„è¯»å†™ç‰¹æ€§</font><br></p>
</blockquote>
<h3 id="217aå’Œaæœ‰ä»€ä¹ˆåŒºåˆ«">2.17Â <code>a</code>å’Œ<code>&amp;a</code>æœ‰ä»€ä¹ˆåŒºåˆ«</h3>
<p>&lt;1&gt; <code>&amp;a</code>ï¼šå…¶å«ä¹‰å°±æ˜¯â€œå˜é‡açš„åœ°å€â€ã€‚</br>
&lt;2&gt; <code>*a</code>ï¼šç”¨åœ¨ä¸åŒçš„åœ°æ–¹ï¼Œå«ä¹‰ä¹Ÿä¸ä¸€æ ·ã€‚</br></p>
<ul>
<li>â‘ åœ¨å£°æ˜è¯­å¥ä¸­ï¼Œ<code>*a</code>åªè¯´æ˜aæ˜¯ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œå¦‚<code>int *a</code>ï¼›</li>
<li>â‘¡åœ¨å…¶ä»–è¯­å¥ä¸­ï¼Œ<code>*a</code>å‰é¢æ²¡æœ‰æ“ä½œæ•°ä¸”aæ˜¯ä¸€ä¸ªæŒ‡é’ˆæ—¶ï¼Œ<code>*a</code>ä»£è¡¨æŒ‡é’ˆaæŒ‡å‘çš„åœ°å€å†…å­˜æ”¾çš„æ•°æ®(è§£å¼•ç”¨)ï¼Œå¦‚<code>b=*a</code>ï¼›</li>
<li>â‘¢<code>*a</code>å‰é¢æœ‰æ“ä½œæ•°ä¸”aæ˜¯ä¸€ä¸ªæ™®é€šå˜é‡æ—¶ï¼Œaä»£è¡¨ä¹˜ä»¥aï¼Œå¦‚c=ba</li>
</ul>
<h3 id="218-ç”¨c-ç¼–å†™ä¸€ä¸ªæ­»å¾ªç¯ç¨‹åº">2.18 ç”¨C ç¼–å†™ä¸€ä¸ªæ­»å¾ªç¯ç¨‹åº</h3>
<div class="highlight" id="id-16"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨æ„ï¼šå¾ˆå¤šç§é€”å¾„éƒ½å¯å®ç°åŒä¸€ç§åŠŸèƒ½ï¼Œä½†æ˜¯ä¸åŒçš„æ–¹æ³•æ—¶é—´å’Œç©ºé—´å ç”¨åº¦ä¸åŒï¼Œç‰¹åˆ«æ˜¯å¯¹äºåµŒå…¥å¼è½¯ä»¶ï¼Œå¤„ç†å™¨é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå­˜å‚¨ç©ºé—´è¾ƒå°ï¼Œæ‰€ä»¥æ—¶é—´å’Œç©ºé—´ä¼˜åŠ¿æ˜¯é€‰æ‹©å„ç§æ–¹æ³•çš„é¦–è¦è€ƒè™‘æ¡ä»¶ã€‚</p>
</blockquote>
<h3 id="219å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡æœ‰ä»€ä¹ˆåŒºåˆ«æ˜¯æ€ä¹ˆå®ç°çš„æ“ä½œç³»ç»Ÿå’Œç¼–è¯‘å™¨æ˜¯æ€ä¹ˆçŸ¥é“çš„">2.19Â å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿæ“ä½œç³»ç»Ÿå’Œç¼–è¯‘å™¨æ˜¯æ€ä¹ˆçŸ¥é“çš„ï¼Ÿ</h3>
<blockquote>
<p>â‘ å…¨å±€å˜é‡æ˜¯æ•´ä¸ªç¨‹åºéƒ½å¯è®¿é—®çš„å˜é‡ï¼Œè°éƒ½å¯ä»¥è®¿é—®ï¼Œç”Ÿå­˜æœŸåœ¨æ•´ä¸ªç¨‹åºä»è¿è¡Œåˆ°ç»“æŸ(åœ¨ç¨‹åºç»“æŸæ—¶æ‰€å å†…å­˜é‡Šæ”¾)ï¼›</br>
â‘¡è€Œå±€éƒ¨å˜é‡å­˜åœ¨äºæ¨¡å—(å­ç¨‹åºï¼Œå‡½æ•°)ä¸­ï¼Œåªæœ‰æ‰€åœ¨æ¨¡å—å¯ä»¥è®¿é—®ï¼Œå…¶ä»–æ¨¡å—ä¸å¯ç›´æ¥è®¿é—®ï¼Œæ¨¡å—ç»“æŸ(å‡½æ•°è°ƒç”¨å®Œæ¯•)ï¼Œå±€éƒ¨å˜é‡æ¶ˆå¤±ï¼Œæ‰€å æ®çš„å†…å­˜é‡Šæ”¾ã€‚</br>
â‘¢æ“ä½œç³»ç»Ÿå’Œç¼–è¯‘å™¨ï¼Œå¯èƒ½æ˜¯é€šè¿‡å†…å­˜åˆ†é…çš„ä½ç½®æ¥çŸ¥é“çš„ï¼Œå…¨å±€å˜é‡åˆ†é…åœ¨å…¨å±€æ•°æ®æ®µå¹¶ä¸”åœ¨ç¨‹åºå¼€å§‹è¿è¡Œçš„æ—¶å€™è¢«åŠ è½½.å±€éƒ¨å˜é‡åˆ™åˆ†é…åœ¨å †æ ˆé‡Œé¢ã€‚</br></p>
</blockquote>
<h3 id="220-ç»“æ„ä½“å†…å­˜å¯¹é½é—®é¢˜">2.20 ç»“æ„ä½“å†…å­˜å¯¹é½é—®é¢˜</h3>
<p>è¯·å†™å‡ºä»¥ä¸‹ä»£ç çš„è¾“å‡ºç»“æœï¼š</p>
<div class="highlight" id="id-17"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**************************************************************
</span></span></span><span class="line"><span class="cl"><span class="cm">*		ç»“æ„ä½“å†…å­˜å¯¹â»¬é—®é¢˜
</span></span></span><span class="line"><span class="cl"><span class="cm">*   ä»åç§»ä¸º0çš„ä½ç½®å¼€å§‹å­˜å‚¨ï¼›
</span></span></span><span class="line"><span class="cl"><span class="cm">*	å¦‚æœæ²¡æœ‰å®šä¹‰ #pragma pack(n)
</span></span></span><span class="line"><span class="cl"><span class="cm">*	sizeof çš„æœ€ç»ˆç»“æœå¿…ç„¶æ˜¯ç»“æ„å†…éƒ¨æœ€â¼¤æˆå‘˜çš„æ•´æ•°å€ï¼Œä¸å¤Ÿè¡¥â»¬ï¼›
</span></span></span><span class="line"><span class="cl"><span class="cm">*	ç»“æ„å†…éƒ¨å„ä¸ªæˆå‘˜çš„â¾¸åœ°å€å¿…ç„¶æ˜¯â¾ƒèº«â¼¤â¼©çš„æ•´æ•°å€ï¼›
</span></span></span><span class="line"><span class="cl"><span class="cm">*
</span></span></span><span class="line"><span class="cl"><span class="cm">***************************************************************/</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">S1</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">i</span> <span class="p">;</span>  <span class="c1">//èµ·å§‹åç§»0ï¼Œsizeof(i)=4; åœ°å€0ã€1ã€2ã€3åˆ†é…ç»™æˆå‘˜i
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">char</span> <span class="n">j</span> <span class="p">;</span> <span class="c1">//èµ·å§‹åç§»4ï¼Œsizeof(j)=1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">a</span> <span class="p">;</span>	 <span class="c1">//sizeof(a)=4,å†…å­˜å¯¹é½åˆ°8ä¸ªå­—èŠ‚ï¼Œä»åç§»é‡ä¸º8å¤„å­˜æ”¾a;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">b</span><span class="p">;</span><span class="c1">//sizeof(b)=8,å†…å­˜å¯¹é½åˆ°16ä¸ªå­—èŠ‚ï¼Œå†å­˜æ”¾b,ç»“æ„ä½“æ€»å¤§å°24;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ç»“æ„ä½“æˆå‘˜çš„é¦–åœ°å€å¿…é¡»æ˜¯è‡ªèº«å¤§å°çš„æ•´æ•°å€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">S3</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">j</span><span class="p">;</span><span class="c1">//èµ·å§‹åç§»0ï¼Œsizeof(j)=1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">float</span> <span class="n">i</span><span class="p">;</span><span class="c1">//sizeof(i)=4ï¼Œå†…å­˜å¯¹é½åˆ°4ï¼Œèµ·å§‹åç§»é‡ä¸º4,å†å­˜æ”¾i
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">b</span><span class="p">;</span><span class="c1">//å½“å‰åœ°å€ä¸º8ï¼Œæ˜¯bå¤§å°çš„æ•´æ•°å€ï¼Œæ— éœ€å¯¹é½ï¼Œç›´æ¥å­˜æ”¾æˆå‘˜b 8ä¸ªå­—èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">a</span><span class="p">;</span><span class="c1">//sizeof(a)=4,å†…å­˜å¯¹é½åˆ°20ï¼Œå†å­˜æ”¾a,æ€»å¤§å°24å­—èŠ‚ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">S1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">S3</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å‡º:</p>
<div class="highlight" id="id-18"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">24
</span></span><span class="line"><span class="cl">24</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼š</br></p>
<blockquote>
<p>â‘ ç»“æ„ä½“ä½œä¸ºä¸€ç§å¤åˆæ•°æ®ç±»å‹ï¼Œå…¶æ„æˆå…ƒç´ æ—¢å¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€äº›å¤åˆå‹ç±»å‹æ•°æ®ã€‚å¯¹æ­¤ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œæˆå‘˜å˜é‡çš„å¯¹é½ä»¥æé«˜è¿ç®—æ•ˆç‡ã€‚</br>
â‘¡é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŒ‰è‡ªç„¶å¯¹é½æ¡ä»¶åˆ†é…ç©ºé—´ã€‚å„ä¸ªæˆå‘˜æŒ‰ç…§å®ƒä»¬è¢«å£°æ˜çš„é¡ºåºåœ¨å†…å­˜ä¸­é¡ºåºå­˜å‚¨ï¼Œç¬¬ä¸€ä¸ªæˆå‘˜çš„åœ°å€å’Œæ•´ä¸ªç»“æ„çš„åœ°å€ç›¸åŒï¼Œå‘ç»“æ„ä½“æˆå‘˜ä¸­sizeæœ€å¤§çš„æˆå‘˜å¯¹é½ã€‚</br>
â‘¢è®¸å¤šå®é™…çš„è®¡ç®—æœºç³»ç»Ÿå¯¹åŸºæœ¬ç±»å‹æ•°æ®åœ¨å†…å­˜ä¸­å­˜æ”¾çš„ä½ç½®æœ‰é™åˆ¶ï¼Œå®ƒä»¬ä¼šè¦æ±‚è¿™äº›æ•°æ®çš„é¦–åœ°å€çš„å€¼æ˜¯æŸä¸ªæ•°k(é€šå¸¸å®ƒä¸º4æˆ–8)çš„å€æ•°ï¼Œè€Œè¿™ä¸ªkåˆ™è¢«ç§°ä¸ºè¯¥æ•°æ®ç±»å‹çš„å¯¹é½æ¨¡æ•°ã€‚</br></p>
</blockquote>
<h2 id="3-åŸºç¡€çŸ¥è¯†ä¸‰">3 åŸºç¡€çŸ¥è¯†(ä¸‰)</h2>
<h3 id="31-ç®€è¿°ccç¨‹åºç¼–è¯‘çš„å†…å­˜åˆ†é…æƒ…å†µ">3.1 ç®€è¿°Cã€C++ç¨‹åºç¼–è¯‘çš„å†…å­˜åˆ†é…æƒ…å†µ</h3>
<blockquote>
<p>â‘ ä»é™æ€å­˜å‚¨åŒºåŸŸåˆ†é…ï¼š</br>
å†…å­˜åœ¨ç¨‹åºç¼–è¯‘æ—¶å°±å·²ç»åˆ†é…å¥½ï¼Œè¿™å—å†…å­˜åœ¨ç¨‹åºçš„æ•´ä¸ªè¿è¡ŒæœŸé—´éƒ½å­˜åœ¨ã€‚é€Ÿåº¦å¿«ã€ä¸å®¹æ˜“å‡ºé”™ï¼Œ å› ä¸ºæœ‰ç³»ç»Ÿä¼šå–„åã€‚ä¾‹å¦‚å…¨å±€å˜é‡ï¼Œstatic å˜é‡ï¼Œå¸¸é‡å­—ç¬¦ä¸²ç­‰ã€‚</p>
</blockquote>
<blockquote>
<p>â‘¡åœ¨æ ˆä¸Šåˆ†é…ï¼š</br>
åœ¨æ‰§è¡Œå‡½æ•°æ—¶ï¼Œå‡½æ•°å†…å±€éƒ¨å˜é‡çš„å­˜å‚¨å•å…ƒéƒ½åœ¨æ ˆä¸Šåˆ›å»ºï¼Œå‡½æ•°æ‰§è¡Œç»“æŸæ—¶è¿™äº›å­˜å‚¨å•å…ƒè‡ªåŠ¨è¢«é‡Šæ”¾ã€‚æ ˆå†…å­˜åˆ†é…è¿ç®—å†…ç½®äºå¤„ç†å™¨çš„æŒ‡ä»¤é›†ä¸­ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯åˆ†é…çš„å†…å­˜å®¹é‡æœ‰é™ã€‚å¤§å°ä¸º2Mã€‚</p>
</blockquote>
<blockquote>
<p>â‘¢ä»å †ä¸Šåˆ†é…ï¼š</br>
å³åŠ¨æ€å†…å­˜åˆ†é…ã€‚ç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™ç”¨ malloc æˆ–new ç”³è¯·ä»»æ„å¤§å°çš„å†…å­˜ï¼Œç¨‹åºå‘˜è‡ªå·±è´Ÿè´£åœ¨ä½• æ—¶ç”¨free æˆ–delete é‡Šæ”¾å†…å­˜ã€‚åŠ¨æ€å†…å­˜çš„ç”Ÿå­˜æœŸç”±ç¨‹åºå‘˜å†³å®šï¼Œä½¿ç”¨éå¸¸çµæ´»ã€‚å¦‚æœåœ¨å †ä¸Šåˆ†é…äº†ç©ºé—´ï¼Œå°±æœ‰è´£ä»»å›æ”¶å®ƒï¼Œå¦åˆ™è¿è¡Œçš„ç¨‹åºä¼šå‡ºç°å†…å­˜æ³„æ¼ï¼Œå¦å¤–é¢‘ç¹åœ°åˆ†é…å’Œé‡Šæ”¾ä¸åŒå¤§å°çš„å †ç©ºé—´å°†ä¼šäº§ç”Ÿ å †å†…ç¢å—ã€‚</p>
</blockquote>
<p><strong>ä¸€ä¸ªCã€C++ç¨‹åºç¼–è¯‘æ—¶å†…å­˜åˆ†ä¸º5å¤§å­˜å‚¨åŒºï¼šå †åŒºã€æ ˆåŒºã€å…¨å±€åŒºã€æ–‡å­—å¸¸é‡åŒºã€ç¨‹åºä»£ç åŒºã€‚</strong></p>
<h3 id="32ç®€è¿°strcpysprintf-ä¸memcpy-çš„åŒºåˆ«">3.2Â ç®€è¿°strcpyã€sprintf ä¸memcpy çš„åŒºåˆ«</h3>
<blockquote>
<p>â‘ æ“ä½œå¯¹è±¡ä¸åŒï¼Œstrcpy çš„ä¸¤ä¸ªæ“ä½œå¯¹è±¡å‡ä¸ºå­—ç¬¦ä¸²ï¼Œsprintf çš„æ“ä½œæºå¯¹è±¡å¯ä»¥æ˜¯å¤šç§æ•°æ®ç±»å‹ï¼Œ ç›®çš„æ“ä½œå¯¹è±¡æ˜¯å­—ç¬¦ä¸²ï¼Œmemcpy çš„ä¸¤ä¸ªå¯¹è±¡å°±æ˜¯ä¸¤ä¸ªä»»æ„å¯æ“ä½œçš„å†…å­˜åœ°å€ï¼Œå¹¶ä¸é™äºä½•ç§æ•°æ®ç±»å‹ã€‚</br>
â‘¡æ‰§è¡Œæ•ˆç‡ä¸åŒï¼Œmemcpy æœ€é«˜ï¼Œstrcpy æ¬¡ä¹‹ï¼Œsprintf çš„æ•ˆç‡æœ€ä½ã€‚</br>
â‘¢å®ç°åŠŸèƒ½ä¸åŒï¼Œstrcpy ä¸»è¦å®ç°å­—ç¬¦ä¸²å˜é‡é—´çš„æ‹·è´ï¼Œsprintf ä¸»è¦å®ç°å…¶ä»–æ•°æ®ç±»å‹æ ¼å¼åˆ°å­—ç¬¦ä¸²çš„è½¬åŒ–ï¼Œmemcpy ä¸»è¦æ˜¯å†…å­˜å—é—´çš„æ‹·è´ã€‚</br>
æ³¨æ„ï¼šstrcpyã€sprintf ä¸memcpy éƒ½å¯ä»¥å®ç°æ‹·è´çš„åŠŸèƒ½ï¼Œä½†æ˜¯é’ˆå¯¹çš„å¯¹è±¡ä¸åŒï¼Œæ ¹æ®å®é™…éœ€æ±‚ï¼Œæ¥ é€‰æ‹©åˆé€‚çš„å‡½æ•°å®ç°æ‹·è´åŠŸèƒ½ã€‚</p>
</blockquote>
<h3 id="è¯·è§£ævoid---0-çš„å«ä¹‰">è¯·è§£æ((void ()( ) )0)( )çš„å«ä¹‰</h3>
<blockquote>
<p><code>void (0)( )</code> ï¼šæ˜¯ä¸€ä¸ªè¿”å›å€¼ä¸ºvoidï¼Œå‚æ•°ä¸ºç©ºçš„å‡½æ•°æŒ‡é’ˆ0ã€‚</br>
<code>(void ()( ))0</code>ï¼šæŠŠ0è½¬å˜æˆä¸€ä¸ªè¿”å›å€¼ä¸ºvoidï¼Œå‚æ•°ä¸ºç©ºçš„å‡½æ•°æŒ‡é’ˆã€‚</br>
<code>((void ()( ))0()</code>ï¼šåœ¨ä¸Šå¥çš„åŸºç¡€ä¸ŠåŠ è¡¨ç¤ºæ•´ä¸ªæ˜¯ä¸€ä¸ªè¿”å›å€¼ä¸ºvoidï¼Œæ— å‚æ•°ï¼Œå¹¶ä¸”èµ·å§‹åœ°å€ä¸º0çš„å‡½æ•°çš„åå­—ã€‚</br>
<code>((void (*)( ))0)( )</code>ï¼šè¿™å°±æ˜¯ä¸Šå¥çš„å‡½æ•°åæ‰€å¯¹åº”çš„å‡½æ•°çš„è°ƒç”¨ã€‚</br></p>
</blockquote>
<h3 id="34-typedef-å’Œdefine-æœ‰ä»€ä¹ˆåŒºåˆ«">3.4 typedef å’Œdefine æœ‰ä»€ä¹ˆåŒºåˆ«</h3>
<blockquote>
<p>â‘ ç”¨æ³•ä¸åŒï¼š</br>
typedef ç”¨æ¥å®šä¹‰ä¸€ç§æ•°æ®ç±»å‹çš„åˆ«åï¼Œå¢å¼ºç¨‹åºçš„å¯è¯»æ€§ã€‚define ä¸»è¦ç”¨æ¥å®šä¹‰å¸¸é‡ï¼Œä»¥åŠä¹¦å†™å¤æ‚ä½¿ç”¨é¢‘ç¹çš„å®ã€‚</br>
â‘¡æ‰§è¡Œæ—¶é—´ä¸åŒï¼š</br>
typedef æ˜¯ç¼–è¯‘è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæœ‰ç±»å‹æ£€æŸ¥çš„åŠŸèƒ½ã€‚define æ˜¯å®å®šä¹‰ï¼Œæ˜¯é¢„ç¼–è¯‘çš„éƒ¨åˆ†ï¼Œå…¶å‘ç”Ÿåœ¨ç¼–è¯‘ä¹‹å‰ï¼Œåªæ˜¯ç®€å•çš„è¿›è¡Œå­—ç¬¦ä¸²çš„æ›¿æ¢ï¼Œä¸è¿›è¡Œç±»å‹çš„æ£€æŸ¥ã€‚</br>
â‘¢ä½œç”¨åŸŸä¸åŒï¼š</br>
typedef æœ‰ä½œç”¨åŸŸé™å®šï¼šdefine ä¸å—ä½œç”¨åŸŸçº¦æŸï¼Œåªè¦åœ¨define å£°æ˜åçš„å¼•ç”¨éƒ½æ˜¯æ­£ç¡®çš„ã€‚</br>
â‘£å¯¹æŒ‡é’ˆçš„æ“ä½œä¸åŒï¼š</br>
typedef å’Œdefine å®šä¹‰çš„æŒ‡é’ˆæ—¶æœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚</br>
æ³¨æ„ï¼štypedef å®šä¹‰æ˜¯è¯­å¥ï¼Œå› ä¸ºå¥å°¾è¦åŠ ä¸Šåˆ†å·ã€‚è€Œdefine ä¸æ˜¯è¯­å¥ï¼Œåƒä¸‡ä¸èƒ½åœ¨å¥å°¾åŠ åˆ†å·ã€‚</br></p>
</blockquote>
<h3 id="35æŒ‡é’ˆå¸¸é‡ä¸å¸¸é‡æŒ‡é’ˆåŒºåˆ«">3.5Â æŒ‡é’ˆå¸¸é‡ä¸å¸¸é‡æŒ‡é’ˆåŒºåˆ«</h3>
<blockquote>
<p>æŒ‡é’ˆå¸¸é‡æ˜¯æŒ‡å®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆçš„å€¼åªèƒ½åœ¨å®šä¹‰æ—¶åˆå§‹åŒ–ï¼Œå…¶ä»–åœ°æ–¹ä¸èƒ½æ”¹å˜ã€‚</br>
å¸¸é‡æŒ‡é’ˆæ˜¯æŒ‡å®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªåªè¯»çš„å¯¹è±¡ï¼Œä¸èƒ½é€šè¿‡å¸¸é‡æŒ‡é’ˆæ¥æ”¹å˜è¿™ä¸ªå¯¹è±¡çš„å€¼ã€‚</br></p>
<blockquote>
<p>æŒ‡é’ˆå¸¸é‡å¼ºè°ƒçš„æ˜¯æŒ‡é’ˆçš„ä¸å¯æ”¹å˜æ€§ï¼Œè€Œå¸¸é‡æŒ‡é’ˆå¼ºè°ƒçš„æ˜¯æŒ‡é’ˆå¯¹å…¶æ‰€æŒ‡å¯¹è±¡çš„ä¸å¯æ”¹å˜æ€§ã€‚</br></p>
</blockquote>
</blockquote>
<blockquote>
<p>æ³¨æ„ï¼šæ— è®ºæ˜¯æŒ‡é’ˆå¸¸é‡è¿˜æ˜¯å¸¸é‡æŒ‡é’ˆï¼Œå…¶æœ€å¤§çš„ç”¨é€”å°±æ˜¯ä½œä¸ºå‡½æ•°çš„å½¢å¼å‚æ•°ï¼Œä¿è¯å®å‚åœ¨è¢«è°ƒç”¨å‡½æ•°ä¸­çš„ä¸å¯æ”¹å˜ç‰¹æ€§ã€‚</p>
</blockquote>
<h3 id="36ç®€è¿°é˜Ÿåˆ—å’Œæ ˆçš„å¼‚åŒ">3.6Â ç®€è¿°é˜Ÿåˆ—å’Œæ ˆçš„å¼‚åŒ</h3>
<blockquote>
<p>é˜Ÿåˆ—å’Œæ ˆéƒ½æ˜¯çº¿æ€§å­˜å‚¨ç»“æ„ï¼Œä½†æ˜¯ä¸¤è€…çš„æ’å…¥å’Œåˆ é™¤æ•°æ®çš„æ“ä½œä¸åŒï¼Œé˜Ÿåˆ—æ˜¯â€œå…ˆè¿›å…ˆå‡ºâ€ï¼Œæ ˆæ˜¯ â€œåè¿›å…ˆå‡ºâ€ã€‚
æ³¨æ„ï¼šåŒºåˆ«æ ˆåŒºå’Œå †åŒºã€‚å †åŒºçš„å­˜å–æ˜¯â€œé¡ºåºéšæ„â€ï¼Œè€Œæ ˆåŒºæ˜¯â€œåè¿›å…ˆå‡ºâ€ã€‚æ ˆç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…é‡Šæ”¾ ï¼Œå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡çš„å€¼ç­‰ã€‚å…¶æ“ä½œæ–¹å¼ç±»ä¼¼äºæ•°æ®ç»“æ„ä¸­çš„æ ˆã€‚å †ä¸€èˆ¬ç”±ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾ï¼Œ è‹¥ç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸæ—¶å¯èƒ½ç”±OS å›æ”¶ã€‚åˆ†é…æ–¹å¼ç±»ä¼¼äºé“¾è¡¨ã€‚ å®ƒä¸æœ¬é¢˜ä¸­çš„å †å’Œæ ˆæ˜¯ä¸¤å›äº‹ã€‚å †æ ˆåªæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œè€Œå †åŒºå’Œæ ˆåŒºæ˜¯ç¨‹åºçš„ä¸åŒå†…å­˜å­˜å‚¨åŒºåŸŸã€‚</p>
</blockquote>
<h3 id="37è®¾ç½®åœ°å€ä¸º0x67a9-çš„æ•´å‹å˜é‡çš„å€¼ä¸º0xaa66">3.7Â è®¾ç½®åœ°å€ä¸º0x67a9 çš„æ•´å‹å˜é‡çš„å€¼ä¸º0xaa66</h3>
<div class="highlight" id="id-19"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x67a9</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="mh">0xaa66</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨æ„ï¼šè¿™é“é¢˜å°±æ˜¯å¼ºåˆ¶ç±»å‹è½¬æ¢çš„å…¸å‹ä¾‹å­ï¼Œæ— è®ºåœ¨ä»€ä¹ˆå¹³å°ï¼Œåœ°å€é•¿åº¦å’Œæ•´å‹æ•°æ®çš„é•¿åº¦æ˜¯ä¸€æ ·çš„ï¼Œ å³ä¸€ä¸ªæ•´å‹æ•°æ®å¯ä»¥å¼ºåˆ¶è½¬æ¢æˆåœ°å€æŒ‡é’ˆç±»å‹ï¼Œåªè¦æœ‰æ„ä¹‰å³å¯ã€‚</p>
</blockquote>
<h3 id="38ç¼–ç å®ç°å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•°å­—">3.8Â ç¼–ç å®ç°å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•°å­—</h3>
<blockquote>
<p>ç¼–ç å®ç°å‡½æ•°atoi()ï¼Œè®¾è®¡ä¸€ä¸ªç¨‹åºï¼ŒæŠŠä¸€ä¸ªå­—ç¬¦ä¸²è½¬åŒ–ä¸ºä¸€ä¸ªæ•´å‹æ•°å€¼ã€‚ä¾‹å¦‚æ•°å­—ï¼šâ€œ5486321 â€ï¼Œ è½¬åŒ–æˆå­—ç¬¦ï¼š5486321ã€‚</p>
</blockquote>
<div class="highlight" id="id-20"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">myAtoi</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//ä¿å­˜è½¬æ¢åçš„æ•°å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="kt">int</span> <span class="n">isNegative</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//è®°å½•å­—ç¬¦ä¸²ä¸­æ˜¯å¦æœ‰è´Ÿå·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">   <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="c1">//åˆ¤æ–­æŒ‡é’ˆçš„åˆæ³•æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">!=</span> <span class="sc">&#39;\0&#39;</span><span class="p">)</span> <span class="c1">//è®¡ç®—æ•°å­—ç¬¦ä¸²åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">n</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="n">p</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="c1">//åˆ¤æ–­æ•°ç»„æ˜¯å¦æœ‰è´Ÿå·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">isNegative</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kt">char</span> <span class="n">temp</span> <span class="o">=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kt">char</span> <span class="n">temp</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="sc">&#39;9&#39;</span> <span class="o">||</span><span class="n">temp</span> <span class="o">&lt;</span> <span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="c1">//æ»¤é™¤éæ•°å­—å­—ç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span><span class="p">(</span><span class="n">num</span> <span class="o">!=</span><span class="mi">0</span> <span class="o">||</span> <span class="n">temp</span> <span class="o">!=</span> <span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="c1">//æ»¤é™¤å­—ç¬¦ä¸²å¼€å§‹çš„0 å­—ç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="n">temp</span> <span class="o">-=</span> <span class="mh">0x30</span><span class="p">;</span> <span class="c1">//å°†æ•°å­—å­—ç¬¦è½¬æ¢ä¸ºæ•°å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="n">num</span> <span class="o">+=</span> <span class="n">temp</span> <span class="o">*</span><span class="kt">int</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="mi">10</span> <span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span><span class="p">(</span><span class="n">isNegative</span><span class="p">)</span> <span class="c1">//å¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰è´Ÿå·ï¼Œå°†æ•°å€¼å–å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">num</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">else</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">num</span><span class="p">;</span> <span class="c1">//è¿”å›è½¬æ¢åçš„æ•°å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="39cè¯­è¨€çš„ç»“æ„ä½“structå’Œcçš„ç±»classæœ‰ä»€ä¹ˆåŒºåˆ«">3.9Â Cè¯­è¨€çš„ç»“æ„ä½“(struct)å’ŒC++çš„ç±»(class)æœ‰ä»€ä¹ˆåŒºåˆ«</h3>
<blockquote>
<p>â‘ Cè¯­è¨€çš„ç»“æ„ä½“æ˜¯ä¸èƒ½æœ‰æˆå‘˜å‡½æ•°çš„ï¼Œè€ŒC++çš„ç±»å¯ä»¥æœ‰ã€‚</br>
â‘¡Cè¯­è¨€çš„ç»“æ„ä½“ä¸­æ•°æ®æˆå‘˜æ˜¯æ²¡æœ‰privateã€publicå’Œprotectedè®¿é—®é™å®šçš„ã€‚è€ŒC++çš„ç±»çš„æˆå‘˜æœ‰è¿™äº›è®¿é—®æƒé™é™å®šã€‚</br>
â‘¢Cè¯­è¨€çš„ç»“æ„ä½“æ˜¯æ²¡æœ‰ç»§æ‰¿å…³ç³»çš„ï¼Œè€ŒC++çš„ç±»å´æœ‰ä¸°å¯Œçš„ç»§æ‰¿å…³ç³»ã€‚</br>
æ³¨æ„ï¼šè™½ç„¶Cçš„ç»“æ„ä½“å’ŒC++çš„ç±»æœ‰å¾ˆå¤§çš„ç›¸ä¼¼åº¦ï¼Œä½†æ˜¯ç±»æ˜¯å®ç°é¢å‘å¯¹è±¡çš„åŸºç¡€ã€‚è€Œç»“æ„ä½“åªå¯ä»¥ç®€å•åœ°ç†è§£ä¸ºç±»çš„å‰èº«ã€‚</br></p>
</blockquote>
<h3 id="310-ç®€è¿°æŒ‡é’ˆå¸¸é‡ä¸å¸¸é‡æŒ‡é’ˆçš„åŒºåˆ«">3.10 ç®€è¿°æŒ‡é’ˆå¸¸é‡ä¸å¸¸é‡æŒ‡é’ˆçš„åŒºåˆ«</h3>
<blockquote>
<p>â‘ æŒ‡é’ˆå¸¸é‡æ˜¯æŒ‡å®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆçš„å€¼åªèƒ½åœ¨å®šä¹‰æ—¶åˆå§‹åŒ–ï¼Œå…¶ä»–åœ°æ–¹ä¸èƒ½æ”¹å˜ã€‚å¸¸é‡æŒ‡é’ˆæ˜¯æŒ‡å®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªåªè¯»çš„å¯¹è±¡ï¼Œä¸èƒ½é€šè¿‡å¸¸é‡æŒ‡é’ˆæ¥æ”¹å˜è¿™ä¸ªå¯¹è±¡çš„å€¼ã€‚æŒ‡é’ˆå¸¸é‡çš„å€¼åªèƒ½åœ¨å®šä¹‰æ—¶åˆå§‹åŒ–ï¼Œå¸¸é‡æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªåªè¯»çš„å¯¹è±¡</br>
â‘¡æŒ‡é’ˆå¸¸é‡å¼ºè°ƒçš„æ˜¯æŒ‡é’ˆçš„ä¸å¯æ”¹å˜æ€§ï¼Œè€Œå¸¸é‡æŒ‡é’ˆå¼ºè°ƒçš„æ˜¯æŒ‡é’ˆå¯¹å…¶æ‰€æŒ‡å¯¹è±¡çš„ä¸å¯æ”¹å˜æ€§ã€‚</br>
æ³¨æ„ï¼šæ— è®ºæ˜¯æŒ‡é’ˆå¸¸é‡è¿˜æ˜¯å¸¸é‡æŒ‡é’ˆï¼Œå…¶æœ€å¤§çš„ç”¨é€”å°±æ˜¯ä½œä¸ºå‡½æ•°çš„å½¢å¼å‚æ•°ï¼Œä¿è¯å®å‚åœ¨è¢«è°ƒç”¨å‡½æ•°ä¸­çš„ä¸å¯æ”¹å˜ç‰¹æ€§ã€‚</br></p>
</blockquote>
<h3 id="311-å¦‚ä½•é¿å…é‡æŒ‡é’ˆ">3.11 å¦‚ä½•é¿å…â€œé‡æŒ‡é’ˆâ€</h3>
<blockquote>
<p>â‘ æŒ‡é’ˆå˜é‡å£°æ˜æ—¶æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚è§£å†³åŠæ³•ï¼šæŒ‡é’ˆå£°æ˜æ—¶åˆå§‹åŒ–ï¼Œå¯ä»¥æ˜¯å…·ä½“çš„åœ°å€å€¼ï¼Œä¹Ÿå¯è®©å®ƒæŒ‡å‘NULLã€‚</br>
â‘¡æŒ‡é’ˆpè¢«freeæˆ–è€…deleteä¹‹åï¼Œæ²¡æœ‰ç½®ä¸ºNULLã€‚è§£å†³åŠæ³•ï¼šæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ç©ºé—´è¢«é‡Šæ”¾åæŒ‡é’ˆåº”è¯¥æŒ‡å‘NULLã€‚</br>
â‘¢æŒ‡é’ˆæ“ä½œè¶…è¶Šäº†å˜é‡çš„ä½œç”¨èŒƒå›´ã€‚è§£å†³åŠæ³•ï¼šåœ¨å˜é‡çš„ä½œç”¨åŸŸç»“æŸå‰é‡Šæ”¾æ‰å˜é‡çš„åœ°å€ç©ºé—´å¹¶ä¸”è®©æŒ‡é’ˆæŒ‡å‘NULLã€‚</br></p>
</blockquote>
<h3 id="312å¥æŸ„å’ŒæŒ‡é’ˆçš„åŒºåˆ«å’Œè”ç³»æ˜¯ä»€ä¹ˆ">3.12Â å¥æŸ„å’ŒæŒ‡é’ˆçš„åŒºåˆ«å’Œè”ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>å¥æŸ„å’ŒæŒ‡é’ˆå…¶å®æ˜¯ä¸¤ä¸ªæˆªç„¶ä¸åŒçš„æ¦‚å¿µã€‚Windowsç³»ç»Ÿç”¨å¥æŸ„æ ‡è®°ç³»ç»Ÿèµ„æºï¼Œéšè—ç³»ç»Ÿçš„ä¿¡æ¯ã€‚ä½ åªè¦çŸ¥é“æœ‰è¿™ä¸ªä¸œè¥¿ï¼Œç„¶åå»è°ƒç”¨å°±è¡Œäº†ï¼Œå®ƒæ˜¯ä¸ª32bitçš„uintã€‚æŒ‡é’ˆåˆ™æ ‡è®°æŸä¸ªç‰©ç†å†…å­˜åœ°å€ï¼Œä¸¤è€…æ˜¯ä¸åŒçš„æ¦‚å¿µã€‚</p>
<h3 id="313newdeleteä¸mallocfreeçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ">3.13Â new/deleteä¸malloc/freeçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</h3>
<blockquote>
<p>newèƒ½è‡ªåŠ¨è®¡ç®—éœ€è¦åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œè€Œmallocéœ€è¦æ‰‹å·¥è®¡ç®—å­—èŠ‚æ•°ã€‚</p>
</blockquote>
<div class="highlight" id="id-21"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">2</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>â‘ newä¸deleteç›´æ¥å¸¦å…·ä½“ç±»å‹çš„æŒ‡é’ˆï¼Œmallocå’Œfreeè¿”å›voidç±»å‹çš„æŒ‡é’ˆã€‚</br>
â‘¡newç±»å‹æ˜¯å®‰å…¨çš„ï¼Œè€Œmallocä¸æ˜¯ã€‚ä¾‹å¦‚int *p = new float[2];å°±ä¼šæŠ¥é”™ï¼›è€Œint p = malloc(2sizeof(int))ç¼–è¯‘æ—¶ç¼–è¯‘å™¨å°±æ— æ³•æŒ‡å‡ºé”™è¯¯æ¥ã€‚</br>
â‘¢newä¸€èˆ¬åˆ†ä¸ºä¸¤æ­¥ï¼šnewæ“ä½œå’Œæ„é€ ã€‚newæ“ä½œå¯¹åº”ä¸mallocï¼Œä½†newæ“ä½œå¯ä»¥é‡è½½ï¼Œå¯ä»¥è‡ªå®šä¹‰å†…å­˜åˆ†é…ç­–ç•¥ï¼Œä¸åšå†…å­˜åˆ†é…ï¼Œç”šè‡³åˆ†é…åˆ°éå†…å­˜è®¾å¤‡ä¸Šï¼Œè€Œmallocä¸è¡Œã€‚</br>
â‘£newè°ƒç”¨æ„é€ å‡½æ•°ï¼Œmallocä¸èƒ½ï¼›deleteè°ƒç”¨ææ„å‡½æ•°ï¼Œè€Œfreeä¸èƒ½ã€‚</br>
â‘¤malloc/freeéœ€è¦åº“æ–‡ä»¶stdlib.hçš„æ”¯æŒï¼Œnew/deleteåˆ™ä¸éœ€è¦ï¼</br>
æ³¨æ„ï¼šdeleteå’Œfreeè¢«è°ƒç”¨åï¼Œå†…å­˜ä¸ä¼šç«‹å³å›æ”¶ï¼ŒæŒ‡é’ˆä¹Ÿä¸ä¼šæŒ‡å‘ç©ºï¼Œdeleteæˆ–freeä»…ä»…æ˜¯å‘Šè¯‰æ“ä½œç³»ç»Ÿï¼Œè¿™ä¸€å—å†…å­˜è¢«é‡Šæ”¾äº†ï¼Œå¯ä»¥ç”¨ä½œå…¶ä»–ç”¨é€”ã€‚ä½†æ˜¯ç”±äºæ²¡æœ‰é‡æ–°å¯¹è¿™å—å†…å­˜è¿›è¡Œå†™æ“ä½œï¼Œæ‰€ä»¥å†…å­˜ä¸­çš„å˜é‡æ•°å€¼å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå‡ºç°é‡æŒ‡é’ˆçš„æƒ…å†µã€‚å› æ­¤ï¼Œé‡Šæ”¾å®Œå†…å­˜åï¼Œåº”è¯¥è®²è¯¥æŒ‡é’ˆæŒ‡å‘NULLã€‚</br></p>
</blockquote>
<h3 id="314è¯´ä¸€è¯´externc">3.14Â è¯´ä¸€è¯´externâ€œCâ€</h3>
<blockquote>
<p>extern &ldquo;C&quot;çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®å®ç°C++ä»£ç è°ƒç”¨å…¶ä»–Cè¯­è¨€ä»£ç ã€‚åŠ ä¸Šextern &ldquo;C&quot;åï¼Œä¼šæŒ‡ç¤ºç¼–è¯‘å™¨è¿™éƒ¨åˆ†ä»£ç æŒ‰Cè¯­è¨€(è€Œä¸æ˜¯C++)çš„æ–¹å¼è¿›è¡Œç¼–è¯‘ã€‚ç”±äºC++æ”¯æŒå‡½æ•°é‡è½½ï¼Œå› æ­¤ç¼–è¯‘å™¨ç¼–è¯‘å‡½æ•°çš„è¿‡ç¨‹ä¸­ä¼šå°†å‡½æ•°çš„å‚æ•°ç±»å‹ä¹ŸåŠ åˆ°ç¼–è¯‘åçš„ä»£ç ä¸­ï¼Œè€Œä¸ä»…ä»…æ˜¯å‡½æ•°åï¼›è€ŒCè¯­è¨€å¹¶ä¸æ”¯æŒå‡½æ•°é‡è½½ï¼Œå› æ­¤ç¼–è¯‘Cè¯­è¨€ä»£ç çš„å‡½æ•°æ—¶ä¸ä¼šå¸¦ä¸Šå‡½æ•°çš„å‚æ•°ç±»å‹ï¼Œä¸€èˆ¬åªåŒ…æ‹¬å‡½æ•°åã€‚</br></p>
</blockquote>
<blockquote>
<p>è¿™ä¸ªåŠŸèƒ½ååˆ†æœ‰ç”¨å¤„ï¼Œå› ä¸ºåœ¨C++å‡ºç°ä»¥å‰ï¼Œå¾ˆå¤šä»£ç éƒ½æ˜¯Cè¯­è¨€å†™çš„ï¼Œè€Œä¸”å¾ˆåº•å±‚çš„åº“ä¹Ÿæ˜¯Cè¯­è¨€å†™çš„ï¼Œä¸ºäº†æ›´å¥½çš„æ”¯æŒåŸæ¥çš„Cä»£ç å’Œå·²ç»å†™å¥½çš„Cè¯­è¨€åº“ï¼Œéœ€è¦åœ¨C++ä¸­å°½å¯èƒ½çš„æ”¯æŒCï¼Œè€Œextern &ldquo;C&quot;å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ªç­–ç•¥ã€‚</br></p>
</blockquote>
<blockquote>
<p>C++ä»£ç è°ƒç”¨Cè¯­è¨€ä»£ç åœ¨C++çš„å¤´æ–‡ä»¶ä¸­ä½¿ç”¨åœ¨å¤šä¸ªäººååŒå¼€å‘æ—¶ï¼Œå¯èƒ½æœ‰çš„äººæ¯”è¾ƒæ“…é•¿Cè¯­è¨€ï¼Œè€Œæœ‰çš„äººæ“…é•¿C++ï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ä¹Ÿä¼šæœ‰ç”¨åˆ°ã€‚</br></p>
</blockquote>
<h3 id="315è¯·ä½ æ¥è¯´ä¸€ä¸‹cä¸­structå’Œclassçš„åŒºåˆ«">3.15Â è¯·ä½ æ¥è¯´ä¸€ä¸‹C++ä¸­structå’Œclassçš„åŒºåˆ«</h3>
<p>åœ¨C++ä¸­ï¼Œclasså’Œstructåšç±»å‹å®šä¹‰æ˜¯åªæœ‰ä¸¤ç‚¹åŒºåˆ«ï¼š</p>
<blockquote>
<p>â‘ é»˜è®¤ç»§æ‰¿æƒé™ä¸åŒï¼Œclassç»§æ‰¿é»˜è®¤æ˜¯privateç»§æ‰¿ï¼Œè€Œstructé»˜è®¤æ˜¯publicç»§æ‰¿</br>
â‘¡classè¿˜å¯ç”¨äºå®šä¹‰æ¨¡æ¿å‚æ•°ï¼Œåƒtypenameï¼Œä½†æ˜¯å…³é”®å­—structä¸èƒ½åŒäºå®šä¹‰æ¨¡æ¿å‚æ•° </br>
â‘¢C++ä¿ç•™structå…³é”®å­—ï¼ŒåŸå› ï¼šä¿è¯ä¸Cè¯­è¨€çš„å‘ä¸‹å…¼å®¹æ€§ï¼ŒC++å¿…é¡»æä¾›ä¸€ä¸ªstruct</br>
â‘£C++ä¸­çš„structå®šä¹‰å¿…é¡»ç™¾åˆ†ç™¾åœ°ä¿è¯ä¸Cè¯­è¨€ä¸­çš„structçš„å‘ä¸‹å…¼å®¹æ€§ï¼ŒæŠŠC++ä¸­çš„æœ€åŸºæœ¬çš„å¯¹è±¡å•å…ƒè§„å®šä¸ºclassè€Œä¸æ˜¯structï¼Œå°±æ˜¯ä¸ºäº†é¿å…å„ç§å…¼å®¹æ€§è¦æ±‚çš„é™åˆ¶</br>
â‘¤å¯¹structå®šä¹‰çš„æ‰©å±•ä½¿Cè¯­è¨€çš„ä»£ç èƒ½å¤Ÿæ›´å®¹æ˜“çš„è¢«ç§»æ¤åˆ°C++ä¸­</br></p>
</blockquote>
<h3 id="316cç±»å†…å¯ä»¥å®šä¹‰å¼•ç”¨æ•°æ®æˆå‘˜å—">3.16Â C++ç±»å†…å¯ä»¥å®šä¹‰å¼•ç”¨æ•°æ®æˆå‘˜å—ï¼Ÿ</h3>
<blockquote>
<p>å¯ä»¥ï¼Œå¿…é¡»é€šè¿‡æˆå‘˜å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨åˆå§‹åŒ–ã€‚</p>
</blockquote>
<h3 id="317cä¸­ç±»æˆå‘˜çš„è®¿é—®æƒé™">3.17Â C++ä¸­ç±»æˆå‘˜çš„è®¿é—®æƒé™</h3>
<blockquote>
<p>â‘ C++é€šè¿‡ publicã€protectedã€private ä¸‰ä¸ªå…³é”®å­—æ¥æ§åˆ¶æˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°çš„è®¿é—®æƒé™ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºå…¬æœ‰çš„ã€å—ä¿æŠ¤çš„ã€ç§æœ‰çš„ï¼Œè¢«ç§°ä¸ºæˆå‘˜è®¿é—®é™å®šç¬¦ã€‚</br>
â‘¡åœ¨ç±»çš„å†…éƒ¨(å®šä¹‰ç±»çš„ä»£ç å†…éƒ¨)ï¼Œæ— è®ºæˆå‘˜è¢«å£°æ˜ä¸º publicã€protected è¿˜æ˜¯ privateï¼Œéƒ½æ˜¯å¯ä»¥äº’ç›¸è®¿é—®çš„ï¼Œæ²¡æœ‰è®¿é—®æƒé™çš„é™åˆ¶ã€‚</br>
â‘¢åœ¨ç±»çš„å¤–éƒ¨(å®šä¹‰ç±»çš„ä»£ç ä¹‹å¤–)ï¼Œåªèƒ½é€šè¿‡å¯¹è±¡è®¿é—®æˆå‘˜ï¼Œå¹¶ä¸”é€šè¿‡å¯¹è±¡åªèƒ½è®¿é—® public å±æ€§çš„æˆå‘˜ï¼Œä¸èƒ½è®¿é—® privateã€protected å±æ€§çš„æˆå‘˜</br></p>
</blockquote>
<h3 id="318ä»€ä¹ˆæ˜¯å³å€¼å¼•ç”¨è·Ÿå·¦å€¼åˆæœ‰ä»€ä¹ˆåŒºåˆ«">3.18Â ä»€ä¹ˆæ˜¯å³å€¼å¼•ç”¨ï¼Œè·Ÿå·¦å€¼åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p>å·¦å€¼å’Œå³å€¼çš„æ¦‚å¿µï¼š</p>
<blockquote>
<p>â‘ å·¦å€¼ï¼š</br>
èƒ½å–åœ°å€ï¼Œæˆ–è€…å…·åå¯¹è±¡ï¼Œè¡¨è¾¾å¼ç»“æŸåä¾ç„¶å­˜åœ¨çš„æŒä¹…å¯¹è±¡ï¼›</br>
å³å€¼ï¼šä¸èƒ½å–åœ°å€ï¼ŒåŒ¿åå¯¹è±¡ï¼Œè¡¨è¾¾å¼ç»“æŸåå°±ä¸å†å­˜åœ¨çš„ä¸´æ—¶å¯¹è±¡ï¼›</br>
â‘¡åŒºåˆ«ï¼š</br>
å·¦å€¼èƒ½å¯»å€ï¼Œå³å€¼ä¸èƒ½ï¼›</br>
å·¦å€¼èƒ½èµ‹å€¼ï¼Œå³å€¼ä¸èƒ½ï¼›</br>
å·¦å€¼å¯å˜ï¼Œå³å€¼ä¸èƒ½(ä»…å¯¹åŸºç¡€ç±»å‹é€‚ç”¨ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»å‹å³å€¼å¼•ç”¨å¯ä»¥é€šè¿‡æˆå‘˜å‡½æ•°æ”¹å˜)ï¼›</br></p>
</blockquote>
<h3 id="319é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾">3.19Â é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾</h3>
<blockquote>
<p>å°è£…æ€§ï¼šå°†å®¢è§‚äº‹ç‰©æŠ½è±¡æˆç±»ï¼Œæ¯ä¸ªç±»å¯¹è‡ªèº«çš„æ•°æ®å’Œæ–¹æ³•å®è¡Œ protection (private ï¼Œ protected ï¼Œ public )ã€‚</br>
ç»§æ‰¿æ€§ï¼šå¹¿ä¹‰çš„ç»§æ‰¿æœ‰ä¸‰ç§å®ç°å½¢å¼ï¼šå®ç°ç»§æ‰¿(ä½¿ç”¨åŸºç±»çš„å±æ€§å’Œæ–¹æ³•è€Œæ— éœ€é¢å¤–ç¼–ç çš„èƒ½åŠ›)ã€å¯è§†ç»§æ‰¿(å­çª—ä½“ä½¿ç”¨çˆ¶çª—ä½“çš„å¤–è§‚å’Œå®ç°ä»£ç )ã€æ¥å£ç»§æ‰¿(ä»…ä½¿ç”¨å±æ€§å’Œæ–¹æ³•,å®ç°æ»ååˆ°å­ç±»å®ç°)ã€‚</br>
å¤šæ€æ€§ï¼šæ˜¯å°†çˆ¶ç±»å¯¹è±¡è®¾ç½®æˆä¸ºå’Œä¸€ä¸ªæˆ–æ›´å¤šå®ƒçš„å­å¯¹è±¡ç›¸ç­‰çš„æŠ€æœ¯ã€‚ç”¨å­ç±»å¯¹è±¡ç»™çˆ¶ç±»å¯¹è±¡èµ‹å€¼ä¹‹åï¼Œçˆ¶ç±»å¯¹è±¡å°±å¯ä»¥æ ¹æ®å½“å‰èµ‹å€¼ç»™å®ƒçš„å­å¯¹è±¡çš„ç‰¹æ€§ä»¥ä¸åŒçš„æ–¹å¼è¿ä½œã€‚</br></p>
</blockquote>
<h3 id="320cçš„ç©ºç±»æœ‰å“ªäº›æˆå‘˜å‡½æ•°">3.20Â C++çš„ç©ºç±»æœ‰å“ªäº›æˆå‘˜å‡½æ•°</h3>
<p><a href="https://blog.csdn.net/weixin_45805339/article/details/128089198"target="_blank" rel="external nofollow noopener noreferrer">C++ç©ºç±»æˆå‘˜å‡½æ•°<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼š</p>
<blockquote>
<p>ç¼ºçœæ„é€ å‡½æ•°ã€‚</br>
ç¼ºçœæ‹·è´æ„é€ å‡½æ•°ã€‚</br>
ç¼ºçœææ„å‡½æ•°ã€‚</br>
ç¼ºçœèµ‹å€¼è¿ç®—ç¬¦ã€‚</br>
ç¼ºçœå–å€è¿ç®—ç¬¦ã€‚</br>
ç¼ºçœå–å€è¿ç®—ç¬¦ const ã€‚</br>
æ³¨æ„ï¼šæœ‰äº›ä¹¦ä¸Šåªæ˜¯ç®€å•çš„ä»‹ç»äº†å‰å››ä¸ªå‡½æ•°ã€‚æ²¡æœ‰æåŠåé¢è¿™ä¸¤ä¸ªå‡½æ•°ã€‚ä½†åé¢è¿™ä¸¤ä¸ªå‡½æ•°ä¹Ÿæ˜¯ç©ºç±»çš„é»˜è®¤å‡½æ•°ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰å½“å®é™…ä½¿ç”¨è¿™äº›ç©ºç±»æˆå‘˜å‡½æ•°çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨æ‰ä¼šå»å®šä¹‰å®ƒä»¬ã€‚</br></p>
</blockquote>
<h2 id="4-åŸºç¡€çŸ¥è¯†å››">4. åŸºç¡€çŸ¥è¯†(å››)</h2>
<h3 id="41-è¯´ä¸€è¯´cä¸­å››ç§castè½¬æ¢">4.1 è¯´ä¸€è¯´c++ä¸­å››ç§castè½¬æ¢</h3>
<p>C++ä¸­å››ç§ç±»å‹è½¬æ¢æ˜¯ï¼š<code>static_cast</code>, <code>dynamic_cast</code>, <code>const_cast</code>, <code>reinterpret_cast</code></p>
<blockquote>
<p>1ã€const_cast</br>
ç”¨äºå°†constå˜é‡è½¬ä¸ºéconst</br>
2ã€static_cast</br>
ç”¨äºå„ç§éšå¼è½¬æ¢ï¼Œæ¯”å¦‚éconstè½¬constï¼Œvoid*è½¬æŒ‡é’ˆç­‰, static_castèƒ½ç”¨äºå¤šæ€å‘ä¸Šè½¬åŒ–ï¼Œå¦‚æœå‘ä¸‹è½¬èƒ½æˆåŠŸä½†æ˜¯ä¸å®‰å…¨ï¼Œç»“æœæœªçŸ¥ï¼›</br>
3ã€dynamic_cast</br>
ç”¨äºåŠ¨æ€ç±»å‹è½¬æ¢ã€‚åªèƒ½ç”¨äºå«æœ‰è™šå‡½æ•°çš„ç±»ï¼Œç”¨äºç±»å±‚æ¬¡é—´çš„å‘ä¸Šå’Œå‘ä¸‹è½¬åŒ–ã€‚åªèƒ½è½¬æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚å‘ä¸‹è½¬åŒ–æ—¶ï¼Œå¦‚æœæ˜¯éæ³•çš„å¯¹äºæŒ‡é’ˆè¿”å›NULLï¼Œå¯¹äºå¼•ç”¨æŠ›å¼‚å¸¸ã€‚è¦æ·±å…¥äº†è§£å†…éƒ¨è½¬æ¢çš„åŸç†ã€‚</br></p>
<ul>
<li>å‘ä¸Šè½¬æ¢ï¼šæŒ‡çš„æ˜¯å­ç±»å‘åŸºç±»çš„è½¬æ¢</br></li>
<li>å‘ä¸‹è½¬æ¢ï¼šæŒ‡çš„æ˜¯åŸºç±»å‘å­ç±»çš„è½¬æ¢</br>
å®ƒé€šè¿‡åˆ¤æ–­åœ¨æ‰§è¡Œåˆ°è¯¥è¯­å¥çš„æ—¶å€™å˜é‡çš„è¿è¡Œæ—¶ç±»å‹å’Œè¦è½¬æ¢çš„ç±»å‹æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿè¿›è¡Œå‘ä¸‹è½¬æ¢ã€‚</br></li>
</ul>
<p>4ã€reinterpret_cast</br>
å‡ ä¹ä»€ä¹ˆéƒ½å¯ä»¥è½¬ï¼Œæ¯”å¦‚å°†intè½¬æŒ‡é’ˆï¼Œå¯èƒ½ä¼šå‡ºé—®é¢˜ï¼Œå°½é‡å°‘ç”¨ï¼›</br>
5ã€ä¸ºä»€ä¹ˆä¸ä½¿ç”¨Cçš„å¼ºåˆ¶è½¬æ¢ï¼Ÿ</br>
Cçš„å¼ºåˆ¶è½¬æ¢è¡¨é¢ä¸Šçœ‹èµ·æ¥åŠŸèƒ½å¼ºå¤§ä»€ä¹ˆéƒ½èƒ½è½¬ï¼Œä½†æ˜¯è½¬åŒ–ä¸å¤Ÿæ˜ç¡®ï¼Œä¸èƒ½è¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼Œå®¹æ˜“å‡ºé”™ã€‚</br></p>
</blockquote>
<h3 id="42-å¯¹cä¸­çš„smart-pointerå››ä¸ªæ™ºèƒ½æŒ‡é’ˆçš„ç†è§£shared_ptrunique_ptrweak_ptrauto_ptr">4.2 å¯¹c++ä¸­çš„smart pointerå››ä¸ªæ™ºèƒ½æŒ‡é’ˆçš„ç†è§£ï¼šshared_ptr,unique_ptr,weak_ptr,auto_ptr</h3>
<blockquote>
<p>â‘ C++é‡Œé¢çš„å››ä¸ªæ™ºèƒ½æŒ‡é’ˆ: auto_ptr, shared_ptr, weak_ptr, unique_ptr å…¶ä¸­åä¸‰ä¸ªæ˜¯c++11æ”¯æŒï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå·²ç»è¢«C++11å¼ƒç”¨ã€‚</br>
â‘¡æ™ºèƒ½æŒ‡é’ˆçš„ä½œç”¨æ˜¯ç®¡ç†ä¸€ä¸ªæŒ‡é’ˆï¼Œå› ä¸ºå­˜åœ¨ä»¥ä¸‹è¿™ç§æƒ…å†µï¼š</br>
ç”³è¯·çš„ç©ºé—´åœ¨å‡½æ•°ç»“æŸæ—¶å¿˜è®°é‡Šæ”¾ï¼Œé€ æˆ<strong>å†…å­˜æ³„æ¼</strong>ã€‚ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šçš„é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ™ºèƒ½æŒ‡é’ˆå°±æ˜¯ä¸€ä¸ªç±»ï¼Œå½“è¶…å‡ºäº†ç±»çš„ä½œç”¨åŸŸæ˜¯ï¼Œç±»ä¼šè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°ï¼Œææ„å‡½æ•°ä¼šè‡ªåŠ¨é‡Šæ”¾èµ„æºã€‚æ‰€ä»¥æ™ºèƒ½æŒ‡é’ˆçš„ä½œç”¨åŸç†å°±æ˜¯åœ¨å‡½æ•°ç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚</br>
â‘¢auto_ptr(c++98çš„æ–¹æ¡ˆï¼Œcpp11å·²ç»æŠ›å¼ƒ)</p>
</blockquote>
<p><font color=red>é‡‡ç”¨æ‰€æœ‰æƒæ¨¡å¼ã€‚</font></p>
<div class="highlight" id="id-22"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">unique_ptr</span> <span class="nf">p3</span> <span class="p">(</span><span class="k">new</span> <span class="n">string</span> <span class="p">(</span><span class="err">â€œ</span><span class="k">auto</span><span class="err">â€</span><span class="p">));</span> <span class="c1">//#4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">unique_ptr</span> <span class="n">p4</span><span class="err">ï¼›</span> <span class="c1">//#5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">p4</span> <span class="o">=</span> <span class="n">p3</span><span class="p">;</span><span class="c1">//æ­¤æ—¶ä¼šæŠ¥é”™ï¼ï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–è¯‘å™¨è®¤ä¸ºp4=p3éæ³•ï¼Œé¿å…äº†p3ä¸å†æŒ‡å‘æœ‰æ•ˆæ•°æ®çš„é—®é¢˜ã€‚å› æ­¤ï¼Œunique_ptræ¯”auto_ptræ›´å®‰å…¨ã€‚</br></p>
<p>å¦å¤–unique_ptrè¿˜æœ‰æ›´èªæ˜çš„åœ°æ–¹ï¼šå½“ç¨‹åºè¯•å›¾å°†ä¸€ä¸ª unique_ptr èµ‹å€¼ç»™å¦ä¸€ä¸ªæ—¶ï¼Œå¦‚æœæº unique_ptr æ˜¯ä¸ªä¸´æ—¶å³å€¼ï¼Œç¼–è¯‘å™¨å…è®¸è¿™ä¹ˆåšï¼›å¦‚æœæº unique_ptr å°†å­˜åœ¨ä¸€æ®µæ—¶é—´ï¼Œç¼–è¯‘å™¨å°†ç¦æ­¢è¿™ä¹ˆåšï¼Œæ¯”å¦‚ï¼š</p>
<div class="highlight" id="id-23"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">unique_ptr</span> <span class="nf">pu1</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span> <span class="p">(</span><span class="err">â€œ</span><span class="n">hello</span> <span class="n">world</span><span class="err">â€</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_ptr</span> <span class="n">pu2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">pu2</span> <span class="o">=</span> <span class="n">pu1</span><span class="p">;</span> <span class="c1">// #1 not allowed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">unique_ptr</span> <span class="n">pu3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">pu3</span> <span class="o">=</span> <span class="n">unique_ptr</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span> <span class="p">(</span><span class="err">â€œ</span><span class="n">You</span><span class="err">â€</span><span class="p">));</span> <span class="c1">// #2 allowed
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­#1ç•™ä¸‹æ‚¬æŒ‚çš„ unique_ptr(pu1)ï¼Œè¿™å¯èƒ½å¯¼è‡´å±å®³ã€‚è€Œ#2ä¸ä¼šç•™ä¸‹æ‚¬æŒ‚çš„unique_ptrï¼Œå› ä¸ºå®ƒè°ƒç”¨ unique_ptr çš„æ„é€ å‡½æ•°ï¼Œè¯¥æ„é€ å‡½æ•°åˆ›å»ºçš„ä¸´æ—¶å¯¹è±¡åœ¨å…¶æ‰€æœ‰æƒè®©ç»™ pu3 åå°±ä¼šè¢«é”€æ¯ã€‚è¿™ç§éšæƒ…å†µè€Œå·²çš„è¡Œä¸ºè¡¨æ˜ï¼Œunique_ptr ä¼˜äºå…è®¸ä¸¤ç§èµ‹å€¼çš„auto_ptr ã€‚</p>
<p>æ³¨ï¼šå¦‚æœç¡®å®æƒ³æ‰§è¡Œç±»ä¼¼ä¸#1çš„æ“ä½œï¼Œè¦å®‰å…¨çš„é‡ç”¨è¿™ç§æŒ‡é’ˆï¼Œå¯ç»™å®ƒèµ‹æ–°å€¼ã€‚C++æœ‰ä¸€ä¸ªæ ‡å‡†åº“å‡½æ•°std::move()ï¼Œè®©ä½ èƒ½å¤Ÿå°†ä¸€ä¸ªunique_ptrèµ‹ç»™å¦ä¸€ä¸ªã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight" id="id-24"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">unique_ptr</span> <span class="n">ps1</span><span class="p">,</span> <span class="n">ps2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ps1</span> <span class="o">=</span> <span class="n">demo</span><span class="p">(</span><span class="err">â€œ</span><span class="n">hello</span><span class="err">â€</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ps2</span> <span class="o">=</span> <span class="n">move</span><span class="p">(</span><span class="n">ps1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ps1</span> <span class="o">=</span> <span class="n">demo</span><span class="p">(</span><span class="err">â€œ</span><span class="n">alexia</span><span class="err">â€</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">ps2</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">ps1</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>shared_ptrå®ç°å…±äº«å¼æ‹¥æœ‰æ¦‚å¿µã€‚</strong><u>å¤šä¸ªæ™ºèƒ½æŒ‡é’ˆå¯ä»¥æŒ‡å‘ç›¸åŒå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å’Œå…¶ç›¸å…³èµ„æºä¼šåœ¨â€œæœ€åä¸€ä¸ªå¼•ç”¨è¢«é”€æ¯â€æ—¶å€™é‡Šæ”¾ã€‚</u>ä»åå­—shareå°±å¯ä»¥çœ‹å‡ºäº†èµ„æºå¯ä»¥è¢«å¤šä¸ªæŒ‡é’ˆå…±äº«ï¼Œå®ƒä½¿ç”¨è®¡æ•°æœºåˆ¶æ¥è¡¨æ˜èµ„æºè¢«å‡ ä¸ªæŒ‡é’ˆå…±äº«ã€‚å¯ä»¥é€šè¿‡æˆå‘˜å‡½æ•°use_count()æ¥æŸ¥çœ‹èµ„æºçš„æ‰€æœ‰è€…ä¸ªæ•°ã€‚é™¤äº†å¯ä»¥é€šè¿‡newæ¥æ„é€ ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¼ å…¥auto_ptr, unique_ptr,weak_ptræ¥æ„é€ ã€‚å½“æˆ‘ä»¬è°ƒç”¨release()æ—¶ï¼Œå½“å‰æŒ‡é’ˆä¼šé‡Šæ”¾èµ„æºæ‰€æœ‰æƒï¼Œè®¡æ•°å‡ä¸€ã€‚å½“è®¡æ•°ç­‰äº0æ—¶ï¼Œèµ„æºä¼šè¢«é‡Šæ”¾ã€‚</p>
<p>shared_ptr æ˜¯ä¸ºäº†è§£å†³ auto_ptr åœ¨å¯¹è±¡æ‰€æœ‰æƒä¸Šçš„å±€é™æ€§(auto_ptr æ˜¯ç‹¬å çš„), åœ¨ä½¿ç”¨å¼•ç”¨è®¡æ•°çš„æœºåˆ¶ä¸Šæä¾›äº†å¯ä»¥å…±äº«æ‰€æœ‰æƒçš„æ™ºèƒ½æŒ‡é’ˆã€‚</p>
<p><strong>æˆå‘˜å‡½æ•°ï¼š</strong></p>
<blockquote>
<p>use_count è¿”å›å¼•ç”¨è®¡æ•°çš„ä¸ªæ•°</br>
unique è¿”å›æ˜¯å¦æ˜¯ç‹¬å æ‰€æœ‰æƒ( use_count ä¸º 1)</br>
swap äº¤æ¢ä¸¤ä¸ª shared_ptr å¯¹è±¡(å³äº¤æ¢æ‰€æ‹¥æœ‰çš„å¯¹è±¡)</br>
reset æ”¾å¼ƒå†…éƒ¨å¯¹è±¡çš„æ‰€æœ‰æƒæˆ–æ‹¥æœ‰å¯¹è±¡çš„å˜æ›´, ä¼šå¼•èµ·åŸæœ‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°çš„å‡å°‘</br>
get è¿”å›å†…éƒ¨å¯¹è±¡(æŒ‡é’ˆ), ç”±äºå·²ç»é‡è½½äº†()æ–¹æ³•, å› æ­¤å’Œç›´æ¥ä½¿ç”¨å¯¹è±¡æ˜¯ä¸€æ ·çš„.å¦‚ shared_ptrsp(new int(1)); sp ä¸ sp.get()æ˜¯ç­‰ä»·çš„</br></p>
</blockquote>
<p><strong>weak_ptr:</strong></p>
<blockquote>
<p>weak_ptr æ˜¯ä¸€ç§ä¸æ§åˆ¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„æ™ºèƒ½æŒ‡é’ˆ, å®ƒæŒ‡å‘ä¸€ä¸ª shared_ptr ç®¡ç†çš„å¯¹è±¡. è¿›è¡Œè¯¥å¯¹è±¡çš„å†…å­˜ç®¡ç†çš„æ˜¯é‚£ä¸ªå¼ºå¼•ç”¨çš„shared_ptr. weak_ptråªæ˜¯æä¾›äº†å¯¹ç®¡ç†å¯¹è±¡çš„ä¸€ä¸ªè®¿é—®æ‰‹æ®µã€‚</br></br>
weak_ptr è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºé…åˆ shared_ptr è€Œå¼•å…¥çš„ä¸€ç§æ™ºèƒ½æŒ‡é’ˆæ¥ååŠ© shared_ptr å·¥ä½œ, å®ƒåªå¯ä»¥ä»ä¸€ä¸ª shared_ptr æˆ–å¦ä¸€ä¸ª weak_ptr å¯¹è±¡æ„é€ , å®ƒçš„æ„é€ å’Œææ„ä¸ä¼šå¼•èµ·å¼•ç”¨è®°æ•°çš„å¢åŠ æˆ–å‡å°‘ã€‚</br></br>
weak_ptræ˜¯ç”¨æ¥<strong>è§£å†³shared_ptrç›¸äº’å¼•ç”¨æ—¶çš„æ­»é”é—®é¢˜</strong>,å¦‚æœè¯´ä¸¤ä¸ªshared_ptrç›¸äº’å¼•ç”¨,é‚£ä¹ˆè¿™ä¸¤ä¸ªæŒ‡é’ˆçš„å¼•ç”¨è®¡æ•°æ°¸è¿œä¸å¯èƒ½ä¸‹é™ä¸º0,èµ„æºæ°¸è¿œä¸ä¼šé‡Šæ”¾ã€‚å®ƒæ˜¯å¯¹å¯¹è±¡çš„ä¸€ç§å¼±å¼•ç”¨ï¼Œä¸ä¼šå¢åŠ å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œå’Œshared_pträ¹‹é—´å¯ä»¥ç›¸äº’è½¬åŒ–ï¼Œshared_ptrå¯ä»¥ç›´æ¥èµ‹å€¼ç»™å®ƒï¼Œå®ƒå¯ä»¥é€šè¿‡è°ƒç”¨lockå‡½æ•°æ¥è·å¾—shared_ptrã€‚</br></p>
</blockquote>
<div class="highlight" id="id-25"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span> <span class="n">pb_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">~</span><span class="n">A</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;A delete&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="n">pa_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">~</span><span class="n">B</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;B delete&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">fun</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span> <span class="n">pb</span><span class="p">(</span><span class="k">new</span> <span class="n">B</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="n">pa</span><span class="p">(</span><span class="k">new</span> <span class="n">A</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">pb</span><span class="o">-&gt;</span><span class="n">pa_</span> <span class="o">=</span> <span class="n">pa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">pa</span><span class="o">-&gt;</span><span class="n">pb_</span> <span class="o">=</span> <span class="n">pb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pb</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pa</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">fun</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°funå‡½æ•°ä¸­pa ï¼Œpbä¹‹é—´äº’ç›¸å¼•ç”¨ï¼Œä¸¤ä¸ªèµ„æºçš„å¼•ç”¨è®¡æ•°ä¸º2ï¼Œå½“è¦è·³å‡ºå‡½æ•°æ—¶ï¼Œæ™ºèƒ½æŒ‡é’ˆpaï¼Œpbææ„æ—¶ä¸¤ä¸ªèµ„æºå¼•ç”¨è®¡æ•°ä¼šå‡ä¸€ï¼Œä½†æ˜¯ä¸¤è€…å¼•ç”¨è®¡æ•°è¿˜æ˜¯ä¸º1ï¼Œå¯¼è‡´è·³å‡ºå‡½æ•°æ—¶èµ„æºæ²¡æœ‰è¢«é‡Šæ”¾(A Bçš„ææ„å‡½æ•°æ²¡æœ‰è¢«è°ƒç”¨)ï¼Œå¦‚æœæŠŠå…¶ä¸­ä¸€ä¸ªæ”¹ä¸ºweak_ptrå°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬æŠŠç±»Aé‡Œé¢çš„shared_ptr pb_; æ”¹ä¸ºweak_ptr pb_; è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œè¿™æ ·çš„è¯ï¼Œèµ„æºBçš„å¼•ç”¨å¼€å§‹å°±åªæœ‰1ï¼Œå½“pbææ„æ—¶ï¼ŒBçš„è®¡æ•°å˜ä¸º0ï¼ŒBå¾—åˆ°é‡Šæ”¾ï¼ŒBé‡Šæ”¾çš„åŒæ—¶ä¹Ÿä¼šä½¿Açš„è®¡æ•°å‡ä¸€ï¼ŒåŒæ—¶paææ„æ—¶ä½¿Açš„è®¡æ•°å‡ä¸€ï¼Œé‚£ä¹ˆAçš„è®¡æ•°ä¸º0ï¼ŒAå¾—åˆ°é‡Šæ”¾ã€‚</br></p>
<p>æ³¨æ„ï¼šä¸èƒ½é€šè¿‡weak_ptrç›´æ¥è®¿é—®å¯¹è±¡çš„æ–¹æ³•ï¼Œæ¯”å¦‚Bå¯¹è±¡ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•print(),æˆ‘ä»¬ä¸èƒ½è¿™æ ·è®¿é—®ï¼Œpa-&gt;pb_-&gt;print(); è‹±æ–‡pb_æ˜¯ä¸€ä¸ªweak_ptrï¼Œåº”è¯¥å…ˆæŠŠå®ƒè½¬åŒ–ä¸ºshared_ptr,å¦‚ï¼šshared_ptr p = pa-&gt;pb_.lock(); p-&gt;print();</br></p>
<h3 id="43-è¯´è¯´å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦">4.3 è¯´è¯´å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦</h3>
<p><strong>â‘ static_castÂ ç”¨äºéå¤šæ€ç±»å‹çš„è½¬æ¢</strong></p>
<blockquote>
<p>ç”¨äºéå¤šæ€ç±»å‹çš„è½¬æ¢</br>
ä¸æ‰§è¡Œè¿è¡Œæ—¶ç±»å‹æ£€æŸ¥(è½¬æ¢å®‰å…¨æ€§ä¸å¦‚ dynamic_cast)</br>
é€šå¸¸ç”¨äºè½¬æ¢æ•°å€¼æ•°æ®ç±»å‹(å¦‚ float -&gt; int)</br>
å¯ä»¥åœ¨æ•´ä¸ªç±»å±‚æ¬¡ç»“æ„ä¸­ç§»åŠ¨æŒ‡é’ˆï¼Œå­ç±»è½¬åŒ–ä¸ºçˆ¶ç±»å®‰å…¨(å‘ä¸Šè½¬æ¢)ï¼Œçˆ¶ç±»è½¬åŒ–ä¸ºå­ç±»ä¸å®‰å…¨(å› ä¸ºå­ç±»å¯èƒ½æœ‰ä¸åœ¨çˆ¶ç±»çš„å­—æ®µæˆ–æ–¹æ³•)</br></p>
</blockquote>
<p><strong>â‘¡dynamic_castÂ ç”¨äºå¤šæ€ç±»å‹çš„è½¬æ¢</strong></p>
<blockquote>
<p>ç”¨äºå¤šæ€ç±»å‹çš„è½¬æ¢
æ‰§è¡Œè¡Œè¿è¡Œæ—¶ç±»å‹æ£€æŸ¥
åªé€‚ç”¨äºæŒ‡é’ˆæˆ–å¼•ç”¨
å¯¹ä¸æ˜ç¡®çš„æŒ‡é’ˆçš„è½¬æ¢å°†å¤±è´¥(è¿”å› nullptr)ï¼Œä½†ä¸å¼•å‘å¼‚å¸¸
å¯ä»¥åœ¨æ•´ä¸ªç±»å±‚æ¬¡ç»“æ„ä¸­ç§»åŠ¨æŒ‡é’ˆï¼ŒåŒ…æ‹¬å‘ä¸Šè½¬æ¢ã€å‘ä¸‹è½¬æ¢</p>
</blockquote>
<p><strong>â‘¢const_cast</strong></p>
<blockquote>
<p>ç”¨äºåˆ é™¤ constã€volatile å’Œ __unaligned ç‰¹æ€§(å¦‚å°† const int ç±»å‹è½¬æ¢ä¸º int ç±»å‹ )</p>
</blockquote>
<p><strong>â‘£reinterpret_cast</strong></p>
<blockquote>
<ul>
<li>ç”¨äºä½çš„ç®€å•é‡æ–°è§£é‡Š</br></li>
<li>æ»¥ç”¨ reinterpret_cast è¿ç®—ç¬¦å¯èƒ½å¾ˆå®¹æ˜“å¸¦æ¥é£é™©ã€‚é™¤éæ‰€éœ€è½¬æ¢æœ¬èº«æ˜¯ä½çº§åˆ«çš„ï¼Œå¦åˆ™åº”ä½¿ç”¨å…¶ä»–å¼ºåˆ¶è½¬æ¢è¿ç®—ç¬¦ä¹‹ä¸€ã€‚</br></li>
<li>å…è®¸å°†ä»»ä½•æŒ‡é’ˆè½¬æ¢ä¸ºä»»ä½•å…¶ä»–æŒ‡é’ˆç±»å‹(å¦‚ char* åˆ° int* æˆ– One_class* åˆ° Unrelated_class* ä¹‹ç±»çš„è½¬æ¢ï¼Œä½†å…¶æœ¬èº«å¹¶ä¸å®‰å…¨)
ä¹Ÿå…è®¸å°†ä»»ä½•æ•´æ•°ç±»å‹è½¬æ¢ä¸ºä»»ä½•æŒ‡é’ˆç±»å‹ä»¥åŠåå‘è½¬æ¢ã€‚</br></li>
<li>reinterpret_cast è¿ç®—ç¬¦ä¸èƒ½ä¸¢æ‰ constã€volatile æˆ– __unaligned ç‰¹æ€§ã€‚</br></li>
<li>reinterpret_cast çš„ä¸€ä¸ªå®é™…ç”¨é€”æ˜¯åœ¨å“ˆå¸Œå‡½æ•°ä¸­ï¼Œå³ï¼Œé€šè¿‡è®©ä¸¤ä¸ªä¸åŒçš„å€¼å‡ ä¹ä¸ä»¥ç›¸åŒçš„ç´¢å¼•ç»“å°¾çš„æ–¹å¼å°†å€¼æ˜ å°„åˆ°ç´¢å¼•ã€‚</br></li>
</ul>
</blockquote>
<p><strong>â‘¤bad_cast</strong></p>
<blockquote>
<p>ç”±äºå¼ºåˆ¶è½¬æ¢ä¸ºå¼•ç”¨ç±»å‹å¤±è´¥ï¼Œdynamic_cast è¿ç®—ç¬¦å¼•å‘ bad_cast å¼‚å¸¸ã€‚
bad_cast ä½¿ç”¨:</p>
</blockquote>
<div class="highlight" id="id-26"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Circle</span><span class="o">&amp;</span> <span class="n">ref_circle</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">ref_shape</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">catch</span> <span class="p">(</span><span class="n">bad_cast</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Caught: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">what</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="44-è°ˆè°ˆä½ å¯¹æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦çš„è®¤è¯†">4.4 è°ˆè°ˆä½ å¯¹æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦çš„è®¤è¯†</h3>
<p>æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦é‡è½½æœ‰ä»¥ä¸‹ä¸¤ä¸ªä¸åŒä¹‹å¤„ï¼š</br></p>
<blockquote>
<p>â‘ æ‹·è´æ„é€ å‡½æ•°ç”Ÿæˆæ–°çš„ç±»å¯¹è±¡ï¼Œè€Œèµ‹å€¼è¿ç®—ç¬¦ä¸èƒ½ã€‚</br>
â‘¡ç”±äºæ‹·è´æ„é€ å‡½æ•°æ˜¯ç›´æ¥æ„é€ ä¸€ä¸ªæ–°çš„ç±»å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–è¿™ä¸ªå¯¹ä¹‹å‰ä¸ç”¨æ£€éªŒåŸå¯¹è±¡æ˜¯å¦å’Œæ–°å»ºå¯¹è±¡ç›¸åŒï¼Œè€Œèµ‹å€¼è¿ç®—ç¬¦åˆ™éœ€è¦è¿™ä¸ªæ“ä½œï¼Œ</br>
â‘¢å¦å¤–ï¼Œèµ‹å€¼è¿ç®—ä¸­ï¼Œå¦‚æœåŸæ¥çš„å¯¹è±¡ä¸­æœ‰å†…å­˜åˆ†é…è¦å…ˆæŠŠå†…å­˜é‡Šæ”¾æ‰ã€‚</br>
æ³¨æ„ï¼šå½“æœ‰ç±»ä¸­æœ‰æŒ‡é’ˆç±»å‹çš„æˆå‘˜å˜é‡æ—¶ï¼Œä¸€å®šè¦é‡å†™æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ï¼Œä¸è¦ä½¿ç”¨é»˜è®¤çš„ã€‚</p>
</blockquote>
<h3 id="45-åœ¨cä¸­ä½¿ç”¨mallocç”³è¯·çš„å†…å­˜èƒ½å¦é€šè¿‡deleteé‡Šæ”¾ä½¿ç”¨newç”³è¯·çš„å†…å­˜èƒ½å¦ç”¨free">4.5 åœ¨C++ä¸­ï¼Œä½¿ç”¨mallocç”³è¯·çš„å†…å­˜èƒ½å¦é€šè¿‡deleteé‡Šæ”¾ï¼Ÿä½¿ç”¨newç”³è¯·çš„å†…å­˜èƒ½å¦ç”¨freeï¼Ÿ</h3>
<blockquote>
<p>ä¸èƒ½ï¼Œmalloc /freeä¸»è¦ä¸ºäº†å…¼å®¹Cï¼Œnewå’Œdelete å®Œå…¨å¯ä»¥å–ä»£malloc /freeçš„ã€‚</br>
â‘ malloc /freeçš„æ“ä½œå¯¹è±¡éƒ½æ˜¯å¿…é¡»æ˜ç¡®å¤§å°çš„ã€‚<font color=red>è€Œä¸”ä¸èƒ½ç”¨åœ¨åŠ¨æ€ç±»ä¸Š</font>ã€‚</br>
â‘¡new å’Œdeleteä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹æ£€æŸ¥å’Œå¤§å°ï¼Œmalloc/freeä¸èƒ½æ‰§è¡Œæ„é€ å‡½æ•°ä¸ææ„å‡½æ•°ï¼Œæ‰€ä»¥åŠ¨æ€å¯¹è±¡å®ƒæ˜¯ä¸è¡Œçš„ã€‚</br></p>
</blockquote>
<p>å½“ç„¶ä»ç†è®ºä¸Šè¯´ä½¿ç”¨mallocç”³è¯·çš„å†…å­˜æ˜¯å¯ä»¥é€šè¿‡deleteé‡Šæ”¾çš„ã€‚ä¸è¿‡ä¸€èˆ¬ä¸è¿™æ ·å†™çš„ã€‚è€Œä¸”ä¹Ÿä¸èƒ½ä¿è¯æ¯ä¸ªC++çš„è¿è¡Œæ—¶éƒ½èƒ½æ­£å¸¸ã€‚</p>
<h3 id="46-ç”¨cè®¾è®¡ä¸€ä¸ªä¸èƒ½è¢«ç»§æ‰¿çš„ç±»">4.6 ç”¨C++è®¾è®¡ä¸€ä¸ªä¸èƒ½è¢«ç»§æ‰¿çš„ç±»</h3>
<p>ref: <a href="https://blog.csdn.net/wei_cheng18/article/details/81043858"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/wei_cheng18/article/details/81043858<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<div class="highlight" id="id-27"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">A</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">friend</span> <span class="n">T</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">     <span class="n">A</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">A</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span> <span class="o">:</span> <span class="k">virtual</span> <span class="k">public</span> <span class="n">A</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">B</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">   <span class="o">~</span><span class="n">B</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">C</span> <span class="o">:</span> <span class="k">virtual</span> <span class="k">public</span> <span class="n">B</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">     <span class="n">C</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">C</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">void</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">B</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//C c;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼š<font color=red>æ„é€ å‡½æ•°æ˜¯ç»§æ‰¿å®ç°çš„å…³é”®</font>ï¼Œæ¯æ¬¡å­ç±»å¯¹è±¡æ„é€ æ—¶ï¼Œé¦–å…ˆè°ƒç”¨çš„æ˜¯çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œç„¶åæ‰ æ˜¯è‡ªå·±çš„ã€‚</p>
<h3 id="48-è®¿é—®åŸºç±»çš„ç§æœ‰è™šå‡½æ•°">4.8 è®¿é—®åŸºç±»çš„ç§æœ‰è™šå‡½æ•°</h3>
<p>å†™å‡ºä»¥ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœï¼š</p>
<div class="highlight" id="id-28"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">A</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">g</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;A::g&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="n">f</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;A::f&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span> <span class="o">:</span> <span class="k">public</span> <span class="n">A</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">g</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;B::g&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">h</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;B::h&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="nf">void</span><span class="p">(</span> <span class="o">*</span><span class="n">Fun</span> <span class="p">)(</span> <span class="kt">void</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="n">B</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="n">Fun</span> <span class="n">pFun</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">pFun</span> <span class="o">=</span> <span class="p">(</span> <span class="n">Fun</span> <span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span> <span class="kt">int</span><span class="o">*</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="kt">int</span><span class="o">*</span> <span class="p">)(</span> <span class="o">&amp;</span><span class="n">b</span> <span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">pFun</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å‡ºç»“æœ:</p>
<div class="highlight" id="id-29"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">B</span><span class="o">::</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">A</span><span class="o">::</span><span class="n">f</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span><span class="o">::</span><span class="n">h</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨æ„ï¼šè€ƒå¯Ÿäº†é¢è¯•è€…å¯¹è™šå‡½æ•°çš„ç†è§£ç¨‹åº¦ã€‚ä¸€ä¸ªå¯¹è™šå‡½æ•°ä¸äº†è§£çš„äººå¾ˆéš¾æ­£ç¡®çš„åšå‡ºæœ¬é¢˜ã€‚ åœ¨å­¦ä¹ é¢å‘å¯¹è±¡çš„å¤šæ€æ€§æ—¶ä¸€å®šè¦æ·±åˆ»ç†è§£è™šå‡½æ•°è¡¨çš„å·¥ä½œåŸç†ã€‚</p>
</blockquote>
<blockquote>
<p>è™šå‡½æ•°ï¼šé€šè¿‡åŸºç±»è®¿é—®æ´¾ç”Ÿç±»å®šä¹‰çš„å‡½æ•°ï¼Œå¤šæ€æ—¶ä½¿ç”¨ï¼Œä½¿ç”¨è™šå‡½æ•°åŠ ä¸Švirtualå…³é”®å­—ã€‚</br>
è™šå‡½æ•°å°±æ˜¯åœ¨åŸºç±»å®šä¹‰ä¸€ä¸ªæœªå®ç°çš„å‡½æ•°åï¼Œä¸ºäº†æé«˜ç¨‹åºçš„å¯è¯»æ€§</br>
<a href="https://blog.csdn.net/weixin_45138932/article/details/125667041"target="_blank" rel="external nofollow noopener noreferrer">è™šå‡½æ•°è¯¦è§£<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>
<a href="https://blog.csdn.net/qq_42048450/article/details/117282640?spm=1001.2014.3001.5502"target="_blank" rel="external nofollow noopener noreferrer">C++è™šå‡½æ•°è¯¦è§£_ç–¯ç‹‚çš„éº¦å…‹æ–¯_maxçš„åšå®¢-CSDNåšå®¢_c++è™šå‡½æ•°<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
</blockquote>
<p><a href="https://blog.csdn.net/weixin_43700340/article/details/89471069"target="_blank" rel="external nofollow noopener noreferrer">è±å½¢ç»§æ‰¿1<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>
<a href="https://blog.csdn.net/Y673789476/article/details/128271855#t9"target="_blank" rel="external nofollow noopener noreferrer">è±å½¢ç»§æ‰¿2<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<h3 id="49-å¯¹è™šå‡½æ•°å’Œå¤šæ€çš„ç†è§£">4.9 å¯¹è™šå‡½æ•°å’Œå¤šæ€çš„ç†è§£</h3>
<blockquote>
<p>â‘ å¤šæ€çš„å®ç°ä¸»è¦åˆ†ä¸ºé™æ€å¤šæ€å’ŒåŠ¨æ€å¤šæ€ï¼Œé™æ€å¤šæ€ä¸»è¦æ˜¯é‡è½½ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™å°±å·²ç»ç¡®å®šï¼›åŠ¨æ€å¤šæ€æ˜¯ç”¨è™šå‡½æ•°æœºåˆ¶å®ç°çš„ï¼Œåœ¨è¿è¡ŒæœŸé—´åŠ¨æ€ç»‘å®šã€‚
ä¸¾ä¸ªä¾‹å­: ä¸€ä¸ªçˆ¶ç±»ç±»å‹çš„æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå­ç±»å¯¹è±¡æ—¶å€™ï¼Œä½¿ç”¨çˆ¶ç±»çš„æŒ‡é’ˆå»è°ƒç”¨å­ç±»ä¸­é‡å†™äº†çš„çˆ¶ç±»ä¸­çš„è™šå‡½æ•°çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨å­ç±»é‡å†™è¿‡åçš„å‡½æ•°ï¼Œåœ¨çˆ¶ç±»ä¸­å£°æ˜ä¸ºåŠ äº†virtualå…³é”®å­—çš„å‡½æ•°ï¼Œåœ¨å­ç±»ä¸­é‡å†™æ—¶å€™ä¸éœ€è¦åŠ virtualä¹Ÿæ˜¯è™šå‡½æ•°ã€‚</br>
â‘¡è™šå‡½æ•°çš„å®ç°: åœ¨æœ‰è™šå‡½æ•°çš„ç±»ä¸­ï¼Œç±»çš„æœ€å¼€å§‹éƒ¨åˆ†æ˜¯ä¸€ä¸ªè™šå‡½æ•°è¡¨çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼Œè¡¨ä¸­æ”¾äº†è™šå‡½æ•°çš„åœ°å€ï¼Œå®é™…çš„è™šå‡½æ•°åœ¨ä»£ç æ®µ(.text)ä¸­ã€‚å½“å­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„æ—¶å€™ä¹Ÿä¼šç»§æ‰¿å…¶è™šå‡½æ•°è¡¨ï¼Œå½“å­ç±»é‡å†™çˆ¶ç±»ä¸­è™šå‡½æ•°æ—¶å€™ï¼Œä¼šå°†å…¶ç»§æ‰¿åˆ°çš„è™šå‡½æ•°è¡¨ä¸­çš„åœ°å€æ›¿æ¢ä¸ºé‡æ–°å†™çš„å‡½æ•°åœ°å€ã€‚ä½¿ç”¨äº†è™šå‡½æ•°ï¼Œä¼šå¢åŠ è®¿é—®å†…å­˜å¼€é”€ï¼Œé™ä½æ•ˆç‡ã€‚</br></p>
</blockquote>
<h3 id="410-ç®€è¿°ç±»æˆå‘˜å‡½æ•°çš„é‡å†™overwriteé‡è½½overloadå’Œéšè—çš„åŒºåˆ«">4.10 ç®€è¿°ç±»æˆå‘˜å‡½æ•°çš„é‡å†™(overwrite)ã€é‡è½½(overload)å’Œéšè—çš„åŒºåˆ«</h3>
<p>(1)é‡å†™å’Œé‡è½½ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ä¸åŒã€‚</p>
<blockquote>
<p>â‘ èŒƒå›´çš„åŒºåˆ«ï¼šè¢«é‡å†™çš„å’Œé‡å†™çš„å‡½æ•°åœ¨ä¸¤ä¸ªç±»ä¸­ï¼Œè€Œé‡è½½å’Œè¢«é‡è½½çš„å‡½æ•°åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚</br>
â‘¡å‚æ•°çš„åŒºåˆ«ï¼šè¢«é‡å†™å‡½æ•°å’Œé‡å†™å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸€å®šç›¸åŒï¼Œè€Œè¢«é‡è½½å‡½æ•°å’Œé‡è½½å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸€å®šä¸åŒã€‚</br>
â‘¢virtualçš„åŒºåˆ«ï¼šé‡å†™çš„åŸºç±»ä¸­è¢«é‡å†™çš„å‡½æ•°å¿…é¡»è¦æœ‰virtualä¿®é¥°ï¼Œè€Œé‡è½½å‡½æ•°å’Œè¢«é‡è½½å‡½æ•°å¯ä»¥è¢«virtualä¿®é¥°ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚</br></p>
</blockquote>
<p>(2)éšè—å’Œé‡å†™ã€é‡è½½æœ‰ä»¥ä¸‹å‡ ç‚¹ä¸åŒã€‚</p>
<blockquote>
<p>ä¸é‡è½½çš„èŒƒå›´ä¸åŒï¼šå’Œé‡å†™ä¸€æ ·ï¼Œéšè—å‡½æ•°å’Œè¢«éšè—å‡½æ•°ä¸åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚</br>
å‚æ•°çš„åŒºåˆ«ï¼šéšè—å‡½æ•°å’Œè¢«éšè—çš„å‡½æ•°çš„å‚æ•°åˆ—è¡¨å¯ä»¥ç›¸åŒï¼Œä¹Ÿå¯ä¸åŒï¼Œä½†æ˜¯å‡½æ•°åè‚¯å®šè¦ç›¸åŒã€‚ å½“å‚æ•°ä¸ç›¸åŒæ—¶ï¼Œæ— è®ºåŸºç±»ä¸­çš„å‚æ•°æ˜¯å¦è¢«virtual ä¿®é¥°ï¼ŒåŸºç±»çš„å‡½æ•°éƒ½æ˜¯è¢«éšè—ï¼Œè€Œä¸æ˜¯è¢«é‡å†™ã€‚</br>
æ³¨æ„ï¼šè™½ç„¶é‡è½½å’Œè¦†ç›–éƒ½æ˜¯å®ç°å¤šæ€çš„åŸºç¡€ï¼Œä½†æ˜¯ä¸¤è€…å®ç°çš„æŠ€æœ¯å®Œå…¨ä¸ç›¸åŒï¼Œè¾¾åˆ°çš„ç›®çš„ä¹Ÿæ˜¯å®Œå…¨ä¸åŒçš„ï¼Œè¦†ç›–æ˜¯åŠ¨æ€æ€ç»‘å®šçš„å¤šæ€ï¼Œè€Œé‡è½½æ˜¯é™æ€ç»‘å®šçš„å¤šæ€ã€‚</p>
</blockquote>
<h3 id="411-é“¾è¡¨å’Œæ•°ç»„æœ‰ä»€ä¹ˆåŒºåˆ«">4.11 é“¾è¡¨å’Œæ•°ç»„æœ‰ä»€ä¹ˆåŒºåˆ«</h3>
<p><strong>å­˜å‚¨å½¢å¼:</strong></p>
<blockquote>
<p>æ•°ç»„æ˜¯ä¸€å—è¿ç»­çš„ç©ºé—´ï¼Œå£°æ˜æ—¶å°±è¦ç¡®å®šé•¿åº¦ã€‚</br>
é“¾è¡¨æ˜¯ä¸€å—å¯ä¸è¿ç»­çš„åŠ¨æ€ç©ºé—´ï¼Œ é•¿åº¦å¯å˜ï¼Œæ¯ä¸ªç»“ç‚¹è¦ä¿å­˜ç›¸é‚»ç»“ç‚¹æŒ‡é’ˆã€‚</br></p>
</blockquote>
<p><strong>æ•°æ®æŸ¥æ‰¾:</strong></p>
<blockquote>
<p>æ•°ç»„çš„çº¿æ€§æŸ¥æ‰¾é€Ÿåº¦å¿«ï¼ŒæŸ¥æ‰¾æ“ä½œç›´æ¥ä½¿ç”¨åç§»åœ°å€ã€‚</br>
é“¾è¡¨éœ€è¦æŒ‰é¡ºåºæ£€ç´¢ç»“ç‚¹ï¼Œ æ•ˆç‡ä½ã€‚</br>
æ•°æ®æ’å…¥æˆ–åˆ é™¤ï¼šé“¾è¡¨å¯ä»¥å¿«é€Ÿæ’å…¥å’Œåˆ é™¤ç»“ç‚¹ï¼Œè€Œæ•°ç»„åˆ™å¯èƒ½éœ€è¦å¤§é‡æ•°æ®ç§»åŠ¨ã€‚</br></p>
</blockquote>
<p><strong>è¶Šç•Œé—®é¢˜ï¼š</strong></p>
<blockquote>
<p>é“¾è¡¨ä¸å­˜åœ¨è¶Šç•Œé—®é¢˜ï¼Œæ•°ç»„æœ‰è¶Šç•Œé—®é¢˜ã€‚</p>
</blockquote>
<p><strong>æ³¨æ„ï¼š</strong></p>
<blockquote>
<p>åœ¨é€‰æ‹©æ•°ç»„æˆ–é“¾è¡¨æ•°æ®ç»“æ„æ—¶ï¼Œä¸€å®šè¦æ ¹æ®å®é™…éœ€è¦è¿›è¡Œé€‰æ‹©ã€‚æ•°ç»„ä¾¿äºæŸ¥è¯¢ï¼Œé“¾è¡¨ä¾¿äºæ’å…¥åˆ é™¤ã€‚æ•°ç»„èŠ‚çœç©ºé—´ä½†æ˜¯é•¿åº¦å›ºå®šï¼Œé“¾è¡¨è™½ç„¶å˜é•¿ä½†æ˜¯å äº†æ›´å¤šçš„å­˜å‚¨ç©ºé—´ã€‚</p>
</blockquote>
<h3 id="412-ç”¨ä¸¤ä¸ªæ ˆå®ç°ä¸€ä¸ªé˜Ÿåˆ—çš„åŠŸèƒ½">4.12 ç”¨ä¸¤ä¸ªæ ˆå®ç°ä¸€ä¸ªé˜Ÿåˆ—çš„åŠŸèƒ½</h3>
<div class="highlight" id="id-30"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="nc">node</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="kt">int</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="n">node</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="n">node</span><span class="p">,</span><span class="o">*</span><span class="n">LinkStack</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//åˆ›å»ºç©ºæ ˆï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">LinkStack</span> <span class="nf">CreateNULLStack</span><span class="p">(</span> <span class="n">LinkStack</span> <span class="o">&amp;</span><span class="n">S</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">S</span> <span class="o">=</span> <span class="p">(</span><span class="n">LinkStack</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span> <span class="k">sizeof</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span> <span class="p">);</span> <span class="c1">// ç”³è¯·æ–°ç»“ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">S</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Fail to malloc a new node.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="n">S</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//åˆå§‹åŒ–æ–°ç»“ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="n">S</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="n">S</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//æ ˆçš„æ’å…¥å‡½æ•°ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">LinkStack</span> <span class="nf">Push</span><span class="p">(</span> <span class="n">LinkStack</span> <span class="o">&amp;</span><span class="n">S</span><span class="p">,</span> <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">S</span><span class="p">)</span> <span class="c1">//æ£€éªŒæ ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;There no node in stack!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">LinkStack</span> <span class="n">p</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">LinkStack</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span> <span class="k">sizeof</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span> <span class="p">);</span> <span class="c1">// ç”³è¯·æ–°ç»“ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Fail to malloc a new node.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">S</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">S</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="k">else</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">S</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="n">p</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span> <span class="c1">//åˆå§‹åŒ–æ–°ç»“ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="n">S</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span> <span class="c1">//æ’å…¥æ–°ç»“ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="k">return</span> <span class="n">S</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//å‡ºæ ˆå‡½æ•°ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">node</span> <span class="nf">Pop</span><span class="p">(</span> <span class="n">LinkStack</span> <span class="o">&amp;</span><span class="n">S</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">node</span> <span class="n">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="n">temp</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="n">temp</span><span class="p">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">S</span><span class="p">)</span> <span class="c1">//æ£€éªŒæ ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;There no node in stack!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="n">temp</span> <span class="o">=</span> <span class="o">*</span><span class="n">S</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">if</span><span class="p">(</span> <span class="n">S</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;The stack is NULL,can&#39;t pop!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="n">LinkStack</span> <span class="n">p</span> <span class="o">=</span> <span class="n">S</span> <span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span> <span class="c1">//èŠ‚ç‚¹å‡ºæ ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"> <span class="n">S</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">S</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="n">temp</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="n">free</span><span class="p">(</span> <span class="n">p</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">p</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//åŒæ ˆå®ç°é˜Ÿåˆ—çš„å…¥é˜Ÿå‡½æ•°ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">LinkStack</span> <span class="nf">StackToQueuPush</span><span class="p">(</span> <span class="n">LinkStack</span> <span class="o">&amp;</span><span class="n">S</span><span class="p">,</span> <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">node</span> <span class="n">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="n">LinkStack</span> <span class="n">S1</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="n">CreateNULLStack</span><span class="p">(</span> <span class="n">S1</span> <span class="p">);</span> <span class="c1">//åˆ›å»ºç©ºæ ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"> <span class="k">while</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">!=</span> <span class="n">S</span><span class="o">-&gt;</span><span class="n">next</span> <span class="p">)</span> <span class="c1">//S å‡ºæ ˆå…¥S1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">n</span> <span class="o">=</span> <span class="n">Pop</span><span class="p">(</span> <span class="n">S</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">Push</span><span class="p">(</span> <span class="n">S1</span><span class="p">,</span> <span class="n">n</span><span class="p">.</span><span class="n">data</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="n">Push</span><span class="p">(</span> <span class="n">S1</span><span class="p">,</span> <span class="n">data</span> <span class="p">);</span> <span class="c1">//æ–°ç»“ç‚¹å…¥æ ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"> <span class="k">while</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">!=</span> <span class="n">S1</span><span class="o">-&gt;</span><span class="n">next</span> <span class="p">)</span> <span class="c1">//S1 å‡ºæ ˆå…¥S
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">n</span> <span class="o">=</span> <span class="n">Pop</span><span class="p">(</span> <span class="n">S1</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">Push</span><span class="p">(</span> <span class="n">S</span><span class="p">,</span> <span class="n">n</span><span class="p">.</span><span class="n">data</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="n">S</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼šç”¨ä¸¤ä¸ªæ ˆèƒ½å¤Ÿå®ç°ä¸€ä¸ªé˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œé‚£ç”¨ä¸¤ä¸ªé˜Ÿåˆ—èƒ½å¦å®ç°ä¸€ä¸ªé˜Ÿåˆ—çš„åŠŸèƒ½å‘¢ï¼Ÿç»“æœæ˜¯å¦å®šçš„ï¼Œå› ä¸ºæ ˆæ˜¯å…ˆè¿›åå‡ºï¼Œå°†ä¸¤ä¸ªæ ˆè¿åœ¨ä¸€èµ·ï¼Œå°±æ˜¯å…ˆè¿›å…ˆå‡ºã€‚è€Œé˜Ÿåˆ—æ˜¯ç°å…ˆè¿›å…ˆå‡ºï¼Œæ— è®ºå¤šå°‘ä¸ªè¿åœ¨ä¸€èµ·éƒ½æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œè€Œæ— æ³•å®ç°å…ˆè¿›åå‡ºã€‚</p>
<h3 id="413-å…±äº«æ•°æ®çš„ä¿æŠ¤">4.13 å…±äº«æ•°æ®çš„ä¿æŠ¤</h3>
<p>â‘ å¸¸å¼•ç”¨ï¼šä½¿æ‰€å¼•ç”¨çš„å½¢å‚ä¸èƒ½è¢«æ›´æ–°</p>
<div class="highlight" id="id-31"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">display</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¡å¸¸å¯¹è±¡ï¼šåœ¨ç”Ÿå­˜æœŸå†…ä¸èƒ½è¢«æ›´æ–°ï¼Œä½†å¿…é¡»è¢«åˆå§‹åŒ–</p>
<div class="highlight" id="id-32"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">A</span> <span class="k">const</span> <span class="nf">a</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>â‘¢å¸¸æˆå‘˜å‡½æ•°ï¼š
ä¸èƒ½ä¿®æ”¹å¯¹è±¡ä¸­æ•°æ®æˆå‘˜ï¼Œä¹Ÿä¸èƒ½è°ƒç”¨ç±»ä¸­æ²¡æœ‰è¢«const ä¿®é¥°çš„æˆå‘˜å‡½æ•°(å¸¸å¯¹è±¡å”¯ä¸€çš„å¯¹å¤–æ¥å£).å¦‚æœå£°æ˜äº†ä¸€ä¸ªå¸¸å¯¹è±¡ï¼Œåˆ™è¯¥å¯¹è±¡åªèƒ½è°ƒç”¨ä»–çš„å¸¸å‡½æ•°ï¼-&gt;å¯ä»¥ç”¨äºå¯¹é‡è½½å‡½æ•°çš„åŒºåˆ†;</p>
<div class="highlight" id="id-33"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">print</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>â‘£extern int a:ä½¿å…¶ä»–æ–‡ä»¶ä¹Ÿèƒ½è®¿é—®è¯¥å˜é‡
å£°æ˜ä¸€ä¸ªå‡½æ•°æˆ–å®šä¹‰å‡½æ•°æ—¶ï¼Œå† ä»¥staticçš„è¯ï¼Œå‡½æ•°çš„ä½œç”¨åŸŸå°±è¢«é™åˆ¶åœ¨äº†å½“å‰ç¼–è¯‘å•å…ƒï¼Œå½“å‰ç¼–è¯‘å•å…ƒå†…ä¹Ÿå¿…é¡»åŒ…å«å‡½æ•°çš„å®šä¹‰ï¼Œä¹Ÿåªåœ¨å…¶ç¼–è¯‘å•å…ƒå¯è§ï¼Œå…¶ä»–å•å…ƒä¸èƒ½è°ƒç”¨è¿™ä¸ªå‡½æ•°(æ¯ä¸€ä¸ªcpp æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªç¼–è¯‘å•å…ƒ)ã€‚</p>
<h3 id="414-ç¨‹åºå†…å­˜åˆ†é…æ–¹å¼ä»¥åŠå®ƒä»¬çš„åŒºåˆ«">4.14 ç¨‹åºå†…å­˜åˆ†é…æ–¹å¼ä»¥åŠå®ƒä»¬çš„åŒºåˆ«</h3>
<p>å†…å­˜åˆ†é…å¤§è‡´ä¸Šå¯ä»¥åˆ†æˆ5å—ï¼š</p>
<blockquote>
<p><strong>æ ˆåŒº(stack)</strong></br>
æ ˆï¼Œå°±æ˜¯é‚£äº›ç”±ç¼–è¯‘å™¨åœ¨éœ€è¦æ—¶åˆ†é…ï¼Œåœ¨ä¸éœ€è¦çš„æ—¶å€™è‡ªåŠ¨æ¸…é™¤çš„å˜é‡çš„å­˜å‚¨åŒºã€‚é‡Œé¢çš„å˜é‡é€šå¸¸æ˜¯<u>å±€éƒ¨å˜é‡</u>ã€<u>å‡½æ•°å‚æ•°</u>ç­‰ã€‚(ç”±ç¼–è¯‘å™¨ç®¡ç†)</br>
<strong>å †åŒº(heap)</strong></br>
ä¸€èˆ¬ç”±ç¨‹åºå‘˜åˆ†é…ã€é‡Šæ”¾ï¼Œè‹¥ç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸæ—¶å¯èƒ½ç”±ç³»ç»Ÿå›æ”¶ã€‚æ³¨æ„ï¼Œå®ƒä¸æ•°æ®ç»“æ„ä¸­çš„å †æ˜¯ä¸¤å›äº‹ï¼Œåˆ†é…æ–¹å¼ç±»ä¼¼äºé“¾è¡¨ã€‚</br>
<strong>å…¨å±€åŒº(é™æ€åŒº)(static)</strong></br>
å…¨å±€å˜é‡å’Œé™æ€å˜é‡è¢«åˆ†é…åˆ°åŒä¸€å—å†…å­˜ä¸­ã€‚ç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ã€‚</br>
<strong>å¸¸é‡å­˜å‚¨åŒº</strong></br>
å¸¸é‡å­—ç¬¦ä¸²å°±æ˜¯æ”¾åœ¨è¿™é‡Œçš„ï¼Œä¸å…è®¸ä¿®æ”¹ï¼Œç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ã€‚</br>
<strong>ç¨‹åºä»£ç åŒº</strong></br>
å­˜æ”¾å‡½æ•°ä½“çš„äºŒè¿›åˆ¶ä»£ç ã€‚</br></p>
</blockquote>
<p>C++ç¨‹åºåœ¨æ‰§è¡Œæ—¶ï¼Œå°†å†…å­˜å¤§æ–¹å‘åˆ’åˆ†ä¸º4ä¸ªåŒºåŸŸ:</p>
<blockquote>
<p>ç¨‹åºè¿è¡Œå‰</p>
<blockquote>
<ul>
<li>ä»£ç åŒºï¼šå­˜æ”¾å‡½æ•°ä½“çš„äºŒè¿›åˆ¶ä»£ç ï¼Œç”±æ“ä½œç³»ç»Ÿè¿›è¡Œç®¡ç†çš„</br></li>
<li>å…¨å±€åŒºï¼šå­˜æ”¾å…¨å±€å˜é‡å’Œé™æ€å˜é‡ä»¥åŠå¸¸é‡</br></li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<p>ç¨‹åºè¿è¡Œå</p>
<blockquote>
<ul>
<li>æ ˆåŒºï¼šç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…é‡Šæ”¾, å­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼,å±€éƒ¨å˜é‡ç­‰</br></li>
<li>å †åŒºï¼šç”±ç¨‹åºå‘˜åˆ†é…å’Œé‡Šæ”¾,è‹¥ç¨‹åºå‘˜ä¸é‡Šæ”¾,ç¨‹åºç»“æŸæ—¶ç”±æ“ä½œç³»ç»Ÿå›æ”¶</br></li>
</ul>
</blockquote>
</blockquote>
<p>å†…å­˜å››åŒºæ„ä¹‰ï¼š</p>
<blockquote>
<p>ä¸åŒåŒºåŸŸå­˜æ”¾çš„æ•°æ®ï¼Œèµ‹äºˆä¸åŒçš„ç”Ÿå‘½å‘¨æœŸ, ç»™æˆ‘ä»¬æ›´å¤§çš„çµæ´»ç¼–ç¨‹</p>
</blockquote>
<h3 id="415-explicit">4.15 explicit</h3>
<p>å‡½æ•°å£°æ˜æ—¶åŠ ä¸Šexplicitå¯ä»¥<u>é˜»æ­¢å‡½æ•°å‚æ•°è¢«éšå¼è½¬æ¢</u>ã€‚</p>
<div class="highlight" id="id-34"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">    <span class="n">Class</span> <span class="n">A</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">explicit</span> <span class="nf">A</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">A</span> <span class="n">a1</span><span class="o">=</span><span class="mi">12</span><span class="p">;</span>   <span class="c1">//ä¸åŠ explicitæ—¶ä¼šè¢«éšå¼è½¬æ¢ä½ A a1=A(12);åŠ äº†æ­¤æ—¶ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¢«å£°æ˜ä¸ºexplicitçš„æ„é€ å‡½æ•°é€šå¸¸æ¯”non-explicit å‡½æ•°æ›´å—æ¬¢è¿ã€‚</p>
<h3 id="416-mutableå…³é”®å­—">4.16 mutableå…³é”®å­—</h3>
<blockquote>
<p>mutableçš„ä¸­æ–‡æ„æ€æ˜¯â€œå¯å˜çš„ï¼Œæ˜“å˜çš„â€ï¼Œè·Ÿconstant(æ—¢C++ä¸­çš„const)æ˜¯åä¹‰è¯ã€‚åœ¨C++ä¸­ï¼Œmutableä¹Ÿæ˜¯ä¸ºäº†çªç ´constçš„é™åˆ¶è€Œè®¾ç½®çš„ã€‚</br>
è¢«mutableä¿®é¥°çš„å˜é‡(mutableåªèƒ½ç”¨äºä¿®é¥°ç±»çš„éé™æ€æ•°æ®æˆå‘˜)ï¼Œå°†æ°¸è¿œå¤„äºå¯å˜çš„çŠ¶æ€ï¼Œå³ä½¿åœ¨ä¸€ä¸ªconstå‡½æ•°ä¸­ã€‚</br>
æˆ‘ä»¬çŸ¥é“ï¼Œå‡å¦‚ç±»çš„æˆå‘˜å‡½æ•°ä¸ä¼šæ”¹å˜å¯¹è±¡çš„çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸ªæˆå‘˜å‡½æ•°ä¸€èˆ¬ä¼šå£°æ˜ä¸ºconstã€‚ä½†æ˜¯ï¼Œæœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬<font color=purple>éœ€è¦åœ¨constçš„å‡½æ•°é‡Œé¢ä¿®æ”¹ä¸€äº›è·Ÿç±»çŠ¶æ€æ— å…³çš„æ•°æ®æˆå‘˜ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®æˆå‘˜å°±åº”è¯¥è¢«mutalbeæ¥ä¿®é¥°</font>ã€‚(ä½¿ç”¨mutableä¿®é¥°çš„æ•°æ®æˆå‘˜å¯ä»¥è¢«constæˆå‘˜å‡½æ•°ä¿®æ”¹)ã€‚</br></p>
</blockquote>
<h3 id="417-ç”¨constä¿®é¥°å‡½æ•°çš„è¿”å›å€¼">4.17 ç”¨constä¿®é¥°å‡½æ•°çš„è¿”å›å€¼</h3>
<p>å¦‚æœç»™ä»¥â€œæŒ‡é’ˆä¼ é€’â€æ–¹å¼çš„å‡½æ•°è¿”å›å€¼åŠ constä¿®é¥°ï¼Œé‚£ä¹ˆå‡½æ•°è¿”å›å€¼(å³æŒ‡é’ˆ)çš„å†…å®¹ä¸èƒ½è¢«ä¿®æ”¹ï¼Œè¯¥è¿”å›å€¼åªèƒ½è¢«èµ‹ç»™åŠ constä¿®é¥°çš„åŒç±»å‹æŒ‡é’ˆã€‚ä¾‹å¦‚å‡½æ•°ï¼š</p>
<div class="highlight" id="id-35"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="nf">GetString</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å¦‚ä¸‹è¯­å¥å°†å‡ºç°ç¼–è¯‘é”™è¯¯ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span><span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">GetString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// æ­£ç¡®çš„ç”¨æ³•æ˜¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span><span class="n">GetString</span><span class="p">();</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="418-å®constå’Œenum">4.18 å®ã€constå’Œenum</h3>
<blockquote>
<p>#defineä¸è¢«è§†ä¸ºè¯­è¨€çš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºå•çº¯å¸¸é‡ï¼Œæœ€å¥½ç”¨constå¯¹è±¡æˆ–è€…enumæ›¿æ¢#defineã€‚</br>
å¯¹äºç±»ä¼¼å‡½æ•°çš„å®ï¼Œå°½é‡ä½¿ç”¨å†…è”å‡½æ•°inlineæ›¿æ¢æ‰#define</br>
enumæšä¸¾ç±»å‹æ˜¯è¢«å½“åš int æˆ–è€… unsigned int ç±»å‹æ¥å¤„ç†çš„ã€‚</br></p>
</blockquote>
<h3 id="419-stackçš„ç”Ÿå­˜æœŸ">4.19 stackçš„ç”Ÿå­˜æœŸ</h3>
<blockquote>
<p>â‘ C++ä¸­çš„staticå¯¹è±¡æ˜¯æŒ‡å­˜å‚¨åŒºä¸å±äºstackå’Œheapã€&ldquo;å¯¿å‘½&quot;ä»è¢«æ„é€ å‡ºæ¥ç›´è‡³ç¨‹åºç»“æŸä¸ºæ­¢çš„å¯¹è±¡ã€‚</br>
â‘¡è¿™äº›å¯¹è±¡åŒ…æ‹¬å…¨å±€å¯¹è±¡ï¼Œå®šä¹‰äºnamespaceä½œç”¨åŸŸçš„å¯¹è±¡ï¼Œåœ¨classã€functionä»¥åŠfileä½œç”¨åŸŸä¸­è¢«å£°æ˜ä¸ºstaticçš„å¯¹è±¡ã€‚</br>
â‘¢å…¶ä¸­ï¼Œå‡½æ•°å†…çš„staticå¯¹è±¡ç§°ä¸ºlocal staticå¯¹è±¡ï¼Œè€Œå…¶å®ƒstaticå¯¹è±¡ç§°ä¸ºnon-local staticå¯¹è±¡ã€‚</br></p>
</blockquote>
<p>è¿™ä¸¤è€…åœ¨ä½•æ—¶è¢«åˆå§‹åŒ–(æ„é€ )è¿™ä¸ªé—®é¢˜ä¸Šå­˜åœ¨ç»†å¾®çš„å·®åˆ«ï¼š</p>
<blockquote>
<p>â‘ å¯¹äºlocal staticå¯¹è±¡ï¼Œåœ¨å…¶æ‰€å±çš„å‡½æ•°è¢«è°ƒç”¨ä¹‹å‰ï¼Œè¯¥å¯¹è±¡å¹¶ä¸å­˜åœ¨ï¼Œå³åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å¯¹åº”å‡½æ•°æ—¶ï¼Œlocal staticå¯¹è±¡æ‰è¢«æ„é€ å‡ºæ¥ã€‚</br>
â‘¡è€Œå¯¹äºnon-local staticå¯¹è±¡ï¼Œåœ¨main()å‡½æ•°å¼€å§‹å‰å°±å·²ç»è¢«æ„é€ å‡ºæ¥ï¼Œå¹¶åœ¨main()å‡½æ•°ç»“æŸåè¢«ææ„ã€‚</br></p>
</blockquote>
<p>&lt;/font color=red&gt;å»ºè®®ï¼š</font></p>
<blockquote>
<p>1.å¯¹å†…ç½®å¯¹è±¡è¿›è¡Œæ‰‹å·¥åˆå§‹åŒ–ï¼Œå› ä¸ºC++ä¸ä¿è¯åˆå§‹åŒ–å®ƒä»¬ã€‚</br>
2.æ„é€ å‡½æ•°æœ€å¥½ä½¿ç”¨æˆå‘˜åˆå€¼åˆ—ï¼Œè€Œä¸è¦åœ¨æ„é€ å‡½æ•°æœ¬ä½“ä¸­ä½¿ç”¨èµ‹å€¼æ“ä½œã€‚åˆå€¼åˆ—ä¸­åˆ—å‡ºçš„æˆå‘˜å˜é‡ï¼Œå…¶æ’åºæ¬¡åºåº”è¯¥å’Œå®ƒä»¬åœ¨classä¸­çš„å£°æ˜æ¬¡åºç›¸åŒ(åˆå§‹åŒ–é¡ºåºä¸å£°æ˜å˜é‡é¡ºåºä¸€è‡´)ã€‚</br>
3.ä¸ºå…é™¤â€œè·¨ç¼–è¯‘å•å…ƒçš„åˆå§‹åŒ–æ¬¡åºé—®é¢˜â€ï¼Œå°½é‡ä»¥local staticå¯¹è±¡æ›¿æ¢non-local staticå¯¹è±¡ã€‚</br></p>
</blockquote>
<h3 id="420-å…¨å±€å˜é‡å’Œstaticå˜é‡çš„åŒºåˆ«">4.20 å…¨å±€å˜é‡å’Œstaticå˜é‡çš„åŒºåˆ«</h3>
<blockquote>
<p>â‘ å…¨å±€å˜é‡æœ¬èº«å°±æ˜¯é™æ€å­˜å‚¨æ–¹å¼ï¼Œ é™æ€å…¨å±€å˜é‡å½“ç„¶ä¹Ÿæ˜¯é™æ€å­˜å‚¨æ–¹å¼ã€‚ è¿™ä¸¤è€…åœ¨å­˜å‚¨æ–¹å¼ä¸Šå¹¶æ— ä¸åŒã€‚</br>
â‘¡è¿™ä¸¤è€…çš„åŒºåˆ«åœ¨äºéé™æ€å…¨å±€å˜é‡çš„ä½œç”¨åŸŸæ˜¯æ•´ä¸ªæºç¨‹åºï¼Œ å½“ä¸€ä¸ªæºç¨‹åºç”±å¤šä¸ªæºæ–‡ä»¶ç»„æˆæ—¶ï¼Œéé™æ€çš„å…¨å±€å˜é‡åœ¨å„ä¸ªæºæ–‡ä»¶ä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</br>
â‘¢è€Œé™æ€å…¨å±€å˜é‡åˆ™é™åˆ¶äº†å…¶ä½œç”¨åŸŸï¼Œ å³åªåœ¨å®šä¹‰è¯¥å˜é‡çš„æºæ–‡ä»¶å†…æœ‰æ•ˆï¼Œ åœ¨åŒä¸€æºç¨‹åºçš„å…¶å®ƒæºæ–‡ä»¶ä¸­ä¸èƒ½ä½¿ç”¨å®ƒã€‚</br>
â‘£ç”±äºé™æ€å…¨å±€å˜é‡çš„ä½œç”¨åŸŸå±€é™äºä¸€ä¸ªæºæ–‡ä»¶å†…ï¼Œåªèƒ½ä¸ºè¯¥æºæ–‡ä»¶å†…çš„å‡½æ•°å…¬ç”¨ï¼Œ å› æ­¤å¯ä»¥é¿å…åœ¨å…¶å®ƒæºæ–‡ä»¶ä¸­å¼•èµ·é”™è¯¯ã€‚</br></p>
</blockquote>
<h2 id="5-åŸºç¡€çŸ¥è¯†äº”">5 åŸºç¡€çŸ¥è¯†(äº”)</h2>
<h3 id="51-ä¸ºä»€ä¹ˆæ ˆè¦æ¯”å †é€Ÿåº¦è¦å¿«">5.1 ä¸ºä»€ä¹ˆæ ˆè¦æ¯”å †é€Ÿåº¦è¦å¿«</h3>
<blockquote>
<p>â‘ é¦–å…ˆ, æ ˆæ˜¯æœ¬ç€LIFOåŸåˆ™çš„å­˜å‚¨æœºåˆ¶, å¯¹æ ˆæ•°æ®çš„å®šä½ç›¸å¯¹æ¯”è¾ƒå¿«é€Ÿ, è€Œå †åˆ™æ˜¯éšæœºåˆ†é…çš„ç©ºé—´, å¤„ç†çš„æ•°æ®æ¯”è¾ƒå¤š, æ— è®ºå¦‚ä½•, è‡³å°‘è¦ä¸¤æ¬¡å®šä½.
â‘¡å…¶æ¬¡, æ ˆæ˜¯ç”±CPUæä¾›æŒ‡ä»¤æ”¯æŒçš„, åœ¨æŒ‡ä»¤çš„å¤„ç†é€Ÿåº¦ä¸Š, å¯¹æ ˆæ•°æ®è¿›è¡Œå¤„ç†çš„é€Ÿåº¦è‡ªç„¶è¦ä¼˜äºç”±æ“ä½œç³»ç»Ÿæ”¯æŒçš„å †æ•°æ®.
â‘¢å†è€…, æ ˆæ˜¯åœ¨ä¸€çº§ç¼“å­˜ä¸­åšç¼“å­˜çš„, è€Œå †åˆ™æ˜¯åœ¨äºŒçº§ç¼“å­˜ä¸­, ä¸¤è€…åœ¨ç¡¬ä»¶æ€§èƒ½ä¸Šå·®å¼‚å·¨å¤§.
æœ€å, å„è¯­è¨€å¯¹æ ˆçš„ä¼˜åŒ–æ”¯æŒè¦ä¼˜äºå¯¹å †çš„æ”¯æŒ, æ¯”å¦‚swiftè¯­è¨€ä¸­, ä¸‰ä¸ªå­—åŠä»¥å†…çš„structç»“æ„, å¯ä»¥åœ¨æ ˆä¸­å†…è”, ä»è€Œè¾¾åˆ°æ›´å¿«çš„å¤„ç†é€Ÿåº¦.</p>
</blockquote>
<h3 id="52-c-ææ„å‡½æ•°è°ƒç”¨æ—¶é—´">5.2 c++ ææ„å‡½æ•°è°ƒç”¨æ—¶é—´</h3>
<blockquote>
<p>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œè¢«é”€æ¯æ—¶
deleteæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆæ—¶ï¼Œæˆ–deleteæŒ‡å‘å¯¹è±¡çš„åŸºç±»ç±»å‹æŒ‡é’ˆï¼Œè€Œå…¶åŸºç±»ææ„å‡½æ•°æ˜¯è™šå‡½æ•°æ—¶
å¯¹è±¡iæ˜¯å¯¹è±¡oçš„æˆå‘˜ï¼Œoçš„ææ„å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå¯¹è±¡içš„ææ„å‡½æ•°ä¹Ÿè¢«è°ƒç”¨</p>
</blockquote>
<h3 id="53-é™æ€ç»‘å®š-åŠ¨æ€ç»‘å®š-ä¹Ÿå«åŠ¨æ€è¿ç¼–é™æ€è¿ç¼–">5.3 é™æ€ç»‘å®š åŠ¨æ€ç»‘å®š (ä¹Ÿå«åŠ¨æ€è¿ç¼–ï¼Œé™æ€è¿ç¼–)</h3>
<blockquote>
<p>å¦‚æœçˆ¶ç±»ä¸­å­˜åœ¨æœ‰è™šå‡½æ•°ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¾¿ä¼šä¸ºä¹‹ç”Ÿæˆè™šè¡¨(å±äºç±»)ä¸è™šæŒ‡é’ˆ(å±äºæŸä¸ªå¯¹è±¡)ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œæ ¹æ®è™šæŒ‡é’ˆçš„æŒ‡å‘ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸ªè™šå‡½æ•°ï¼Œè¿™ç§°ä¹‹ä¸åŠ¨æ€ç»‘å®šï¼Œä¸ä¹‹ç›¸å¯¹çš„æ˜¯é™æ€ç»‘å®šï¼Œé™æ€ç»‘å®šåœ¨ç¼–è¯‘æœŸå°±å†³å®šäº†ã€‚</p>
</blockquote>
<p>classå’Œtemplateéƒ½æ”¯æŒæ¥å£ä¸å¤šæ€ï¼›
â‘ å¯¹classesè€Œè¨€ï¼Œæ¥å£æ˜¯æ˜¾å¼çš„ï¼Œä»¥å‡½æ•°ç­¾åä¸ºä¸­å¿ƒã€‚å¤šæ€åˆ™æ˜¯é€šè¿‡virtualå‡½æ•°(è™šå‡½æ•°)å‘ç”Ÿäºè¿è¡ŒæœŸï¼›
â‘¡å¯¹templateå‚æ•°è€Œè¨€ï¼Œæ¥å£æ˜¯éšå¼çš„ï¼Œå¥ åŸºäºæœ‰æ•ˆè¡¨è¾¾å¼ã€‚å¤šæ€åˆ™æ˜¯é€šè¿‡templateå…·ç°åŒ–å’Œå‡½æ•°é‡è½½è§£æå‘ç”Ÿäºç¼–è¯‘æœŸã€‚
<strong>æ³›å‹</strong>
æ³›å‹æ˜¯é€šè¿‡å‚æ•°åŒ–ç±»å‹æ¥å®ç°åœ¨åŒä¸€ä»½ä»£ç ä¸Šæ“ä½œå¤šç§æ•°æ®ç±»å‹ã€‚åˆ©ç”¨â€œå‚æ•°åŒ–ç±»å‹â€å°†ç±»å‹æŠ½è±¡åŒ–ï¼Œä»è€Œå®ç°çµæ´»çš„å¤ç”¨ã€‚</p>
<h3 id="54-cè¯­è¨€çš„æŒ‡é’ˆå’Œcçš„å¼•ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«">5.4 Cè¯­è¨€çš„æŒ‡é’ˆå’Œc++çš„å¼•ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<blockquote>
<ul>
<li>æŒ‡é’ˆæœ‰è‡ªå·±çš„ä¸€å—ç©ºé—´ï¼ŒæŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡ï¼Œåªä¸è¿‡è¿™ä¸ªå˜é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼ŒæŒ‡å‘å†…å­˜çš„ä¸€ä¸ªå­˜å‚¨å•å…ƒï¼Œå³æŒ‡é’ˆæ˜¯ä¸€ä¸ªå®ä½“ã€‚è€Œå¼•ç”¨åªæ˜¯ä¸€ä¸ªåˆ«åï¼›</br></li>
<li>ä½¿ç”¨sizeofçœ‹ä¸€ä¸ªæŒ‡é’ˆçš„å¤§å°æ˜¯4ï¼Œè€Œå¼•ç”¨åˆ™æ˜¯è¢«å¼•ç”¨å¯¹è±¡çš„å¤§å°ï¼›</br></li>
<li>æŒ‡é’ˆå¯ä»¥è¢«åˆå§‹åŒ–ä¸ºNULLï¼Œè€Œå¼•ç”¨å¿…é¡»è¢«åˆå§‹åŒ–ä¸”å¿…é¡»æ˜¯ä¸€ä¸ªå·²æœ‰å¯¹è±¡çš„å¼•ç”¨ï¼›</br></li>
<li>ä½œä¸ºå‚æ•°ä¼ é€’æ—¶ï¼ŒæŒ‡é’ˆéœ€è¦è¢«è§£å¼•ç”¨æ‰å¯ä»¥å¯¹å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œè€Œç›´æ¥å¯¹å¼•ç”¨çš„ä¿®æ”¹éƒ½ä¼šæ”¹å˜å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡ï¼›</br></li>
</ul>
</blockquote>
<h3 id="55-è¯·ä½ è¯´è¯´cè¯­è¨€æ˜¯æ€ä¹ˆè¿›è¡Œå‡½æ•°è°ƒç”¨çš„">5.5 è¯·ä½ è¯´è¯´Cè¯­è¨€æ˜¯æ€ä¹ˆè¿›è¡Œå‡½æ•°è°ƒç”¨çš„</h3>
<blockquote>
<p>æ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨éƒ½ä¼šåˆ†é…å‡½æ•°æ ˆï¼Œåœ¨æ ˆå†…è¿›è¡Œå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ã€‚è°ƒç”¨å‰ï¼Œå…ˆæŠŠè¿”å›åœ°å€å‹æ ˆï¼Œç„¶åæŠŠå½“å‰å‡½æ•°çš„espæŒ‡é’ˆå‹æ ˆã€‚(ESP(Extended Stack Pointer)ä¸ºæ‰©å±•æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼Œæ˜¯æŒ‡é’ˆå¯„å­˜å™¨çš„ä¸€ç§ï¼Œç”¨äºå­˜æ”¾å‡½æ•°æ ˆé¡¶æŒ‡é’ˆ)</br></p>
</blockquote>
<p>Cè¯­è¨€å‚æ•°å‹æ ˆé¡ºåºï¼Ÿï¼šä»å³åˆ°å·¦</p>
<h3 id="56-cä¸­æ‹·è´èµ‹å€¼å‡½æ•°çš„å½¢å‚èƒ½å¦è¿›è¡Œå€¼ä¼ é€’">5.6 C++ä¸­æ‹·è´èµ‹å€¼å‡½æ•°çš„å½¢å‚èƒ½å¦è¿›è¡Œå€¼ä¼ é€’ï¼Ÿ</h3>
<p>ä¸èƒ½ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œé¦–å…ˆè¦å°†å®å‚ä¼ é€’ç»™å½¢å‚ï¼Œè¿™ä¸ªä¼ é€’çš„æ—¶å€™åˆè¦è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°(aa = ex.aa; //æ­¤å¤„è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°)ã€‚å¦‚æ­¤å¾ªç¯ï¼Œæ— æ³•å®Œæˆæ‹·è´ï¼Œæ ˆä¹Ÿä¼šæ»¡ã€‚</p>
<h3 id="57-includeå¤´æ–‡ä»¶çš„é¡ºåºä»¥åŠåŒå¼•å·å’Œå°–æ‹¬å·çš„åŒºåˆ«">5.7 includeå¤´æ–‡ä»¶çš„é¡ºåºä»¥åŠåŒå¼•å·â€â€å’Œå°–æ‹¬å·&lt;&gt;çš„åŒºåˆ«</h3>
<p>ç¼–è¯‘å™¨é¢„å¤„ç†é˜¶æ®µæŸ¥æ‰¾å¤´æ–‡ä»¶çš„è·¯å¾„ä¸ä¸€æ ·</p>
<blockquote>
<p>ä½¿ç”¨åŒå¼•å·åŒ…å«çš„å¤´æ–‡ä»¶ï¼ŒæŸ¥æ‰¾å¤´æ–‡ä»¶è·¯å¾„çš„é¡ºåºä¸ºï¼š
â‘ å½“å‰å¤´æ–‡ä»¶ç›®å½•
â‘¡ç¼–è¯‘å™¨è®¾ç½®çš„å¤´æ–‡ä»¶è·¯å¾„(ç¼–è¯‘å™¨å¯ä½¿ç”¨-Iæ˜¾å¼æŒ‡å®šæœç´¢è·¯å¾„)
â‘¢ç³»ç»Ÿå˜é‡CPLUS_INCLUDE_PATH/C_INCLUDE_PATHæŒ‡å®šçš„å¤´æ–‡ä»¶è·¯å¾„
å¯¹äºä½¿ç”¨å°–æ‹¬å·åŒ…å«çš„å¤´æ–‡ä»¶ï¼ŒæŸ¥æ‰¾å¤´æ–‡ä»¶çš„è·¯å¾„é¡ºåºä¸ºï¼š
â‘ ç¼–è¯‘å™¨è®¾ç½®çš„å¤´æ–‡ä»¶è·¯å¾„(ç¼–è¯‘å™¨å¯ä½¿ç”¨-Iæ˜¾å¼æŒ‡å®šæœç´¢è·¯å¾„)
â‘¡ç³»ç»Ÿå˜é‡CPLUS_INCLUDE_PATH/C_INCLUDE_PATHæŒ‡å®šçš„å¤´æ–‡ä»¶è·¯å¾„</p>
</blockquote>
<h3 id="58-ä¸€ä¸ªcæºæ–‡ä»¶ä»æ–‡æœ¬åˆ°å¯æ‰§è¡Œæ–‡ä»¶ç»å†çš„è¿‡ç¨‹">5.8 ä¸€ä¸ªC++æºæ–‡ä»¶ä»æ–‡æœ¬åˆ°å¯æ‰§è¡Œæ–‡ä»¶ç»å†çš„è¿‡ç¨‹</h3>
<p>å¯¹äºC/C++ç¼–å†™çš„ç¨‹åºï¼Œä»æºä»£ç åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸€èˆ¬ç»è¿‡ä¸‹é¢å››ä¸ªæ­¥éª¤ï¼š</br></p>
<ul>
<li>é¢„ç¼–è¯‘ï¼Œé¢„ç¼–è¯‘çš„æ—¶å€™åšä¸€äº›ç®€å•çš„æ–‡æœ¬æ›¿æ¢ï¼Œæ¯”å¦‚å®æ›¿æ¢ï¼Œè€Œä¸è¿›è¡Œè¯­æ³•çš„æ£€æŸ¥ï¼›</li>
<li>ç¼–è¯‘ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼Œç¼–è¯‘å™¨å°†æ£€æŸ¥ä¸€äº›è¯­æ³•é”™è¯¯ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨çš„å‡½æ•°äº‹å…ˆæ²¡æœ‰å®šä¹‰è¿™ç§æƒ…å†µï¼Œä¸å†è¿™ä¸€é˜¶æ®µæ£€æŸ¥ï¼Œç¼–è¯‘åï¼Œå¾—åˆ°.sæ–‡ä»¶</li>
<li>æ±‡ç¼–ï¼Œå°†C/C++ä»£ç å˜ä¸ºæ±‡ç¼–ä»£ç ï¼Œå¾—åˆ°.oæˆ–è€….objæ–‡ä»¶</li>
<li>é“¾æ¥ï¼Œå°†æ‰€ç”¨åˆ°çš„å¤–éƒ¨æ–‡ä»¶é“¾æ¥åœ¨ä¸€èµ·ï¼Œåœ¨è¿™ä¸€é˜¶æ®µï¼Œå°±ä¼šæ£€æŸ¥ä½¿ç”¨çš„å‡½æ•°æœ‰æ²¡æœ‰å®šä¹‰</li>
</ul>
<p>é“¾æ¥è¿‡åï¼Œå½¢æˆå¯æ‰§è¡Œæ–‡ä»¶.exe
è¯¦ç»†è¯·å‚é˜…: <a href="https://blog.csdn.net/daaikuaichuan/article/details/89060957"target="_blank" rel="external nofollow noopener noreferrer">ä¸€ä¸ªC++æºæ–‡ä»¶ä»æ–‡æœ¬åˆ°å¯æ‰§è¡Œæ–‡ä»¶ç»å†çš„è¿‡ç¨‹<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<h3 id="59-å†…å­˜æ³„æ¼åŸå› å’Œåˆ¤æ–­æ–¹æ³•">5.9 å†…å­˜æ³„æ¼åŸå› å’Œåˆ¤æ–­æ–¹æ³•</h3>
<p>å†…å­˜æ³„æ¼é€šå¸¸æ˜¯å› ä¸ºè°ƒç”¨äº†malloc/newç­‰å†…å­˜ç”³è¯·æ“ä½œï¼Œä½†æ˜¯ç¼ºå°‘äº†å¯¹åº”çš„free/deleteã€‚
ä¸ºäº†åˆ¤æ–­å†…å­˜æ˜¯å¦æ³„æ¼ï¼Œæˆ‘ä»¬ä¸€æ–¹é¢å¯ä»¥ä½¿ç”¨Linuxç¯å¢ƒä¸‹çš„å†…å­˜æ³„æ¼æ£€æŸ¥å·¥å…·Valgrindï¼Œå¦ä¸€æ–¹é¢æˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™ï¼Œå¯ä»¥æ·»åŠ å†…å­˜ç”³è¯·å’Œé‡Šæ”¾çš„ç»Ÿè®¡åŠŸèƒ½ï¼Œç»Ÿè®¡å½“å‰ç”³è¯·å’Œé‡Šæ”¾çš„å†…å­˜æ˜¯å¦ä¸€è‡´ï¼Œä»¥æ­¤æ¥åˆ¤æ–­å†…å­˜æ˜¯å¦æœ‰æ³„æ¼ã€‚</p>
<p>å†…å­˜æ³„æ¼åˆ†ç±»ï¼š</p>
<ul>
<li>å †å†…å­˜æ³„æ¼(heap leak)ã€‚å †å†…å­˜å€¼å¾—æ˜¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ ¹æ®éœ€è¦åˆ†é…é€šè¿‡malloc\realloc\newç­‰ä»å †ä¸­åˆ†é…çš„ä¸€å—å†…å­˜ï¼Œå†å®Œæˆä¹‹åå¿…é¡»è¦é€šè¿‡è°ƒç”¨å¯¹åº”çš„freeæˆ–è€…deleteåˆ é™¤ã€‚</li>
<li>å¦‚æœç¨‹åºçš„è®¾è®¡çš„é”™è¯¯å¯¼è‡´è¿™éƒ¨åˆ†å†…å­˜æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œé‚£ä¹ˆæ­¤åè¿™å—å†…å­˜å°†ä¸ä¼šè¢«ä½¿ç”¨ï¼Œå°±ä¼šäº§ç”ŸHeap Leakã€‚</li>
<li>ç³»ç»Ÿèµ„æºæ³„éœ²(Resource Leak)ã€‚ä¸»è¦æŒ‡ç¨‹åºä½¿ç”¨ç³»ç»Ÿåˆ†é…çš„èµ„æºæ¯”å¦‚ Bitmapï¼Œhandleï¼ŒSOCKETç­‰æ²¡æœ‰ä½¿ç”¨ç›¸åº”çš„å‡½æ•°é‡Šæ”¾æ‰ï¼Œå¯¼è‡´ç³»ç»Ÿèµ„æºçš„æµªè´¹ï¼Œä¸¥é‡å¯å¯¼è‡´ç³»ç»Ÿæ•ˆèƒ½é™ä½ï¼Œç³»ç»Ÿè¿è¡Œä¸ç¨³å®šã€‚</li>
<li>æ²¡æœ‰å°†åŸºç±»çš„ææ„å‡½æ•°å®šä¹‰ä¸ºè™šå‡½æ•°ã€‚å½“åŸºç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡æ—¶ï¼Œå¦‚æœåŸºç±»çš„ææ„å‡½æ•°ä¸æ˜¯virtualï¼Œé‚£ä¹ˆå­ç±»çš„ææ„å‡½æ•°å°†ä¸ä¼šè¢«è°ƒç”¨ï¼Œå­ç±»çš„èµ„æºæ²¡æœ‰æ­£ç¡®çš„é‡Šæ”¾ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚</li>
</ul>
<h3 id="510-æ®µé”™è¯¯çš„äº§ç”ŸåŸå› ">5.10 æ®µé”™è¯¯çš„äº§ç”ŸåŸå› </h3>
<p><strong>æ®µé”™è¯¯æ˜¯ä»€ä¹ˆ?</strong></p>
<blockquote>
<p>ä¸€å¥è¯æ¥è¯´ï¼Œæ®µé”™è¯¯æ˜¯æŒ‡è®¿é—®çš„å†…å­˜è¶…å‡ºäº†ç³»ç»Ÿç»™è¿™ä¸ªç¨‹åºæ‰€è®¾å®šçš„å†…å­˜ç©ºé—´ï¼Œä¾‹å¦‚è®¿é—®äº†ä¸å­˜åœ¨çš„å†…å­˜åœ°å€ã€è®¿é—®äº†ç³»ç»Ÿä¿æŠ¤çš„å†…å­˜åœ°å€ã€è®¿é—®äº†åªè¯»çš„å†…å­˜åœ°å€ç­‰ç­‰æƒ…å†µã€‚è¿™é‡Œè´´ä¸€ä¸ªå¯¹äºâ€œæ®µé”™è¯¯â€çš„å‡†ç¡®å®šä¹‰ã€‚</br></p>
</blockquote>
<p><strong>æ®µé”™è¯¯äº§ç”Ÿçš„åŸå› </strong></p>
<blockquote>
<p>è®¿é—®ä¸å­˜åœ¨çš„å†…å­˜åœ°å€</br>
è®¿é—®ç³»ç»Ÿä¿æŠ¤çš„å†…å­˜åœ°å€</br>
è®¿é—®åªè¯»çš„å†…å­˜åœ°å€</br>
æ ˆæº¢å‡º</br>
è¯¦ç»†è¯·å‚é˜…ï¼š<a href="https://www.cnblogs.com/lidabo/p/4545625.html"target="_blank" rel="external nofollow noopener noreferrer">Linuxç¯å¢ƒä¸‹æ®µé”™è¯¯çš„äº§ç”ŸåŸå› åŠè°ƒè¯•æ–¹æ³•å°ç»“<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></p>
</blockquote>
<h3 id="511-c-å‡½æ•°è°ƒç”¨è¿‡ç¨‹">5.11 C++ å‡½æ•°è°ƒç”¨è¿‡ç¨‹</h3>
<p>æ€»ç»“èµ·æ¥æ•´ä¸ªè¿‡ç¨‹å°±ä¸‰æ­¥ï¼š</p>
<blockquote>
<p>1)æ ¹æ®è°ƒç”¨çš„å‡½æ•°åæ‰¾åˆ°å‡½æ•°å…¥å£ï¼›</br>
2)åœ¨æ ˆä¸­ç”³è¯·è°ƒç”¨å‡½æ•°ä¸­çš„å‚æ•°åŠå‡½æ•°ä½“å†…å®šä¹‰çš„å˜é‡çš„å†…å­˜ç©ºé—´</br>
3)å‡½æ•°æ‰§è¡Œå®Œåï¼Œé‡Šæ”¾å‡½æ•°åœ¨æ ˆä¸­çš„ç”³è¯·çš„å‚æ•°å’Œå˜é‡çš„ç©ºé—´ï¼Œæœ€åè¿”å›å€¼(å¦‚æœæœ‰çš„è¯)</br></p>
</blockquote>
<p>è¯¦ç»†è¯·æŸ¥é˜…ï¼š<a href="https://www.cnblogs.com/biyeymyhjob/archive/2012/07/20/2601204.html"target="_blank" rel="external nofollow noopener noreferrer">å‡½æ•°è°ƒç”¨è¿‡ç¨‹ / C/C++å‡½æ•°è°ƒç”¨è¿‡ç¨‹åˆ†æ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<h3 id="512-å¦‚ä½•è°ƒè¯•cå¤šçº¿ç¨‹ç¨‹åº">5.12 å¦‚ä½•è°ƒè¯•c++å¤šçº¿ç¨‹ç¨‹åºï¼Ÿ</h3>
<ol>
<li>æ‰“å°æ—¥å¿—ï¼Œæ—¥å¿—ä¸­åŠ ä¸Šçº¿ç¨‹IDï¼›(ç®€å•ç²—æš´)
gdbæœ‰threadç›¸å…³å‘½ä»¤ï¼Œå¦‚infothread(ç®€å†™infoth)æ˜¾ç¤ºçº¿ç¨‹æ¶ˆæ¯ï¼Œbxxthreadyyå¯ä»¥</br></li>
<li>å¯¹æŸä¸ªthreadè®¾ç½®æ–­ç‚¹ï¼Œthreadxx(ç®€å†™æˆthrxx)åˆ‡æ¢åˆ°æŸä¸ªthreadã€‚å†é…åˆframe(ç®€å†™f)ç›¸å…³çš„å‘½ä»¤(æ¯”å¦‚upï¼Œdownåœ¨ä¸åŒframeé—´è·³è½¬)ï¼ŒåŸºæœ¬å¯ä»¥å¤„ç†è‹¥å¹²ä¸ªä¸åŒçš„çº¿ç¨‹é—´çš„debugâ€¦â€¦</br>
è¯¦ç»†è¯·æŸ¥é˜…ï¼š<a href="https://www.cnblogs.com/LuckCoder/p/10948242.html"target="_blank" rel="external nofollow noopener noreferrer">C++(vs)å¤šçº¿ç¨‹è°ƒè¯• (è½¬)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
</ol>
<h3 id="513é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«">5.13Â é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«</h3>
<blockquote>
<p>â‘ é¢å‘å¯¹è±¡æ–¹æ³•ä¸­ï¼ŒæŠŠæ•°æ®å’Œæ•°æ®æ“ä½œæ”¾åœ¨ä¸€èµ·ï¼Œç»„æˆå¯¹è±¡ï¼›å¯¹åŒç±»çš„å¯¹è±¡æŠ½è±¡å‡ºå…¶å…±æ€§ç»„æˆç±»ï¼›ç±»é€šè¿‡ç®€å•çš„æ¥å£ä¸å¤–ç•Œå‘ç”Ÿè”ç³»ï¼Œå¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´é€šè¿‡æ¶ˆæ¯è¿›è¡Œé€šä¿¡ã€‚</br>
â‘¡é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§æ˜¯&quot;å°è£…ã€â€œå¤šæ€â€ã€â€œç»§æ‰¿â€ï¼Œäº”å¤§åŸåˆ™æ˜¯&quot;å•ä¸€èŒè´£åŸåˆ™&rdquo;ã€â€œå¼€æ”¾å°é—­åŸåˆ™â€ã€â€œé‡Œæ°æ›¿æ¢åŸåˆ™â€ã€â€œä¾èµ–å€’ç½®åŸåˆ™â€ã€â€œæ¥å£åˆ†ç¦»åŸåˆ™â€ã€‚</br>
â‘¢è€Œé¢å‘è¿‡ç¨‹æ–¹æ³•æ˜¯ä»¥è¿‡ç¨‹ä¸ºä¸­å¿ƒçš„å¼€å‘æ–¹æ³•ï¼Œå®ƒè‡ªé¡¶å‘ä¸‹é¡ºåºè¿›è¡Œï¼Œ ç¨‹åºç»“æ„æŒ‰ç…§åŠŸèƒ½åˆ’åˆ†æˆè‹¥å¹²ä¸ªåŸºæœ¬æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å½¢æˆæ ‘çŠ¶ç»“æ„ã€‚</br></p>
</blockquote>
<p><strong>(è¿‡ç¨‹)ä¼˜ç‚¹ï¼š</strong></p>
<p>æ€§èƒ½æ¯”é¢å‘å¯¹è±¡é«˜ï¼Œå› ä¸ºç±»è°ƒç”¨æ—¶éœ€è¦å®ä¾‹åŒ–ï¼Œå¼€é”€æ¯”è¾ƒå¤§ï¼Œæ¯”è¾ƒæ¶ˆè€—æº;æ¯”å¦‚åµŒå…¥å¼å¼€å‘ã€Linux/Unixç­‰ä¸€èˆ¬é‡‡ç”¨é¢å‘è¿‡ç¨‹å¼€å‘ï¼Œæ€§èƒ½æ˜¯æœ€é‡è¦çš„å› ç´ ã€‚ç¼ºç‚¹ï¼šæ²¡æœ‰é¢å‘å¯¹è±¡æ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•ã€‚</p>
<p><strong>(å¯¹è±¡)ä¼˜ç‚¹ï¼š</strong></p>
<p>æ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•ï¼Œç”±äºé¢å‘å¯¹è±¡æœ‰å°è£…ã€ç»§æ‰¿ã€å¤šæ€æ€§çš„ç‰¹æ€§ï¼Œå¯ä»¥è®¾è®¡å‡ºä½è€¦åˆçš„ç³»ç»Ÿã€‚ç¼ºç‚¹ï¼šæ€§èƒ½æ¯”é¢å‘è¿‡ç¨‹ä½ã€‚</p>
<h3 id="514-å…³äºå¼•ç”¨èµ‹å€¼çš„å¤šæ€">5.14 å…³äºå¼•ç”¨èµ‹å€¼çš„å¤šæ€ï¼š</h3>
<div class="highlight" id="id-36"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">Class</span> <span class="n">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Class</span> <span class="nl">D</span> <span class="p">:</span> <span class="k">public</span> <span class="n">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">B</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">D</span><span class="o">&amp;</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span><span class="o">&amp;</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">d</span> <span class="p">;</span>  <span class="c1">//çˆ¶ç±»å¯ä»¥ä½œä¸ºå­ç±»çš„å¼•ç”¨ï¼Œæ­¤æ—¶b1è¡¨ç°å’ŒæŒ‡é’ˆå½¢å¼ä¸€è‡´(ä¼šè°ƒç”¨Bçš„éè™šå‡½æ•°)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">D</span><span class="o">&amp;</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">b</span><span class="err">ï¼›</span> <span class="c1">//é”™è¯¯ï¼Œä¸èƒ½å°†å­ç±»ä½œä¸ºçˆ¶ç±»çš„å¼•ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1">//çˆ¶ç±»å¯ä»¥ä½œä¸ºå­ç±»çš„å¼•ç”¨ï¼Œæ­¤æ—¶b1è¡¨ç°å’ŒæŒ‡é’ˆå½¢å¼ä¸€è‡´(ä¼šè°ƒç”¨Bçš„éè™šå‡½æ•°)Â 
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="515-æ¨¡æ¿çš„å£°æ˜å’Œå®ç°ä¸èƒ½åˆ†å¼€çš„åŸå› ">5.15 æ¨¡æ¿çš„å£°æ˜å’Œå®ç°ä¸èƒ½åˆ†å¼€çš„åŸå› </h3>
<blockquote>
<p>é“¾æ¥çš„æ—¶å€™ï¼Œéœ€è¦å®ä¾‹åŒ–æ¨¡æ¿ï¼Œè¿™æ—¶å€™å°±éœ€è¦æ‰¾æ¨¡æ¿çš„å…·ä½“å®ç°äº†ã€‚å‡è®¾åœ¨mainå‡½æ•°ä¸­è°ƒç”¨äº†ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œè¿™æ—¶å€™å°±éœ€è¦å»å®ä¾‹åŒ–è¯¥ç±»å‹çš„æ¨¡æ¿ã€‚æ³¨æ„mainå‡½æ•°é‡Œé¢åªåŒ…å«äº†.hæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯åªæœ‰æ¨¡æ¿çš„å£°æ˜ï¼Œæ²¡æœ‰å…·ä½“å®ç°ã€‚å°±ä¼šæŠ¥é”™ã€‚
è€Œæ¨¡æ¿çš„å®ç°.cppé‡Œé¢ï¼Œè™½ç„¶æœ‰æ¨¡æ¿çš„å…·ä½“å®ç°ï¼Œä½†æ˜¯æ²¡æœ‰è°åœ¨è¯¥.cppé‡Œé¢ä½¿ç”¨ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œå°±ä¸ä¼šç”Ÿæˆä¸€ä¸ªå…·ä½“åŒ–çš„å®ä¾‹
è¯¦ç»†è¯·å‚é˜…ï¼š<a href="https://www.cnblogs.com/callme/articles/6142129.html"target="_blank" rel="external nofollow noopener noreferrer">C++ æ¨¡æ¿ç±»çš„å£°æ˜ä¸å®ç°åˆ†ç¦»é—®é¢˜<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a> / â€‹â€‹â€‹â€‹â€‹<a href="https://blog.csdn.net/weixin_40539125/article/details/83375452?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param"target="_blank" rel="external nofollow noopener noreferrer">â€‹C++ æ¨¡æ¿ç±»çš„å£°æ˜ä¸å®ç°åˆ†ç¦»é—®é¢˜(æ¨¡æ¿å®ä¾‹åŒ–)â€‹â€‹â€‹â€‹â€‹â€‹<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
</blockquote>
<h3 id="516-cç±»ä¸­å¼•ç”¨æˆå‘˜å’Œå¸¸é‡æˆå‘˜çš„åˆå§‹åŒ–åˆå§‹åŒ–åˆ—è¡¨">5.16 C++ç±»ä¸­å¼•ç”¨æˆå‘˜å’Œå¸¸é‡æˆå‘˜çš„åˆå§‹åŒ–(åˆå§‹åŒ–åˆ—è¡¨)</h3>
<p>å¦‚æœä¸€ä¸ªç±»æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>
<div class="highlight" id="id-37"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Class</span> <span class="n">A</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">          <span class="n">A</span><span class="p">(</span><span class="kt">int</span> <span class="n">pram1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pram2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pram3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">     <span class="nl">privite</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">          <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="kt">int</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">const</span> <span class="kt">int</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å‡å¦‚åœ¨æ„é€ å‡½æ•°ä¸­å¯¹ä¸‰ä¸ªç§æœ‰å˜é‡è¿›è¡Œèµ‹å€¼åˆ™é€šå¸¸ä¼šè¿™æ ·å†™ï¼š</p>
<div class="highlight" id="id-38"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">A</span><span class="o">::</span><span class="n">A</span><span class="p">(</span><span class="kt">int</span> <span class="n">pram1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pram2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pram3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="n">a</span><span class="o">=</span><span class="n">pram1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span><span class="o">=</span><span class="n">pram2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="n">c</span><span class="o">=</span><span class="n">pram3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯ï¼Œè¿™æ ·æ˜¯ç¼–è¯‘ä¸è¿‡çš„ã€‚å› ä¸ºå¸¸é‡å’Œå¼•ç”¨åˆå§‹åŒ–å¿…é¡»èµ‹å€¼ã€‚æ‰€ä»¥ä¸Šé¢çš„æ„é€ å‡½æ•°çš„å†™æ³•åªæ˜¯ç®€å•çš„èµ‹å€¼ï¼Œå¹¶ä¸æ˜¯åˆå§‹åŒ–ã€‚
æ­£ç¡®å†™æ³•åº”è¯¥æ˜¯ï¼š</p>
<div class="highlight" id="id-39"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">  <span class="n">A</span><span class="o">::</span><span class="n">A</span><span class="p">(</span><span class="kt">int</span> <span class="n">pram1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pram2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pram3</span><span class="p">)</span><span class="o">:</span><span class="n">b</span><span class="p">(</span><span class="n">pram2</span><span class="p">),</span><span class="n">c</span><span class="p">(</span><span class="n">pram3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">a</span><span class="o">=</span><span class="n">pram1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>é‡‡ç”¨åˆå§‹åŒ–åˆ—è¡¨å®ç°äº†å¯¹å¸¸é‡å’Œå¼•ç”¨çš„åˆå§‹åŒ–ã€‚é‡‡ç”¨æ‹¬å·èµ‹å€¼çš„æ–¹æ³•ï¼Œæ‹¬å·èµ‹å€¼åªèƒ½ç”¨åœ¨å˜é‡çš„åˆå§‹åŒ–è€Œä¸èƒ½ç”¨åœ¨å®šä¹‰ä¹‹åçš„èµ‹å€¼ã€‚
å‡¡æ˜¯æœ‰å¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡æˆ–è€…å¸¸é‡ç±»å‹çš„å˜é‡çš„ç±»ï¼Œä¸èƒ½æœ‰ç¼ºçœæ„é€ å‡½æ•°ã€‚é»˜è®¤æ„é€ å‡½æ•°æ²¡æœ‰å¯¹å¼•ç”¨æˆå‘˜æä¾›é»˜è®¤çš„åˆå§‹åŒ–æœºåˆ¶ï¼Œä¹Ÿå› æ­¤é€ æˆå¼•ç”¨æœªåˆå§‹åŒ–çš„ç¼–è¯‘é”™è¯¯ã€‚å¹¶ä¸”å¿…é¡»ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨è¿›è¡Œåˆå§‹åŒ–constå¯¹è±¡ã€å¼•ç”¨å¯¹è±¡ã€‚</p>
</blockquote>
<h3 id="517-memsetä¸ºintå‹æ•°ç»„åˆå§‹åŒ–é—®é¢˜">5.17 memsetä¸ºintå‹æ•°ç»„åˆå§‹åŒ–é—®é¢˜ï¼š</h3>
<p>å¤´æ–‡ä»¶ï¼š<code>#include &lt;string.h&gt;</code>
memset() å‡½æ•°ç”¨æ¥å°†æŒ‡å®šå†…å­˜çš„å‰nä¸ªå­—èŠ‚è®¾ç½®ä¸ºç‰¹å®šçš„å€¼ï¼Œå…¶åŸå‹ä¸ºï¼š</p>
<div class="highlight" id="id-40"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span> <span class="nf">memset</span><span class="p">(</span> <span class="kt">void</span> <span class="o">*</span> <span class="n">ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">value</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">num</span> <span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å‚æ•°è¯´æ˜ï¼š</br>
ptr ä¸ºè¦æ“ä½œçš„å†…å­˜çš„æŒ‡é’ˆã€‚</br>
value ä¸ºè¦è®¾ç½®çš„å€¼ã€‚ä½ æ—¢å¯ä»¥å‘ value ä¼ é€’ int ç±»å‹çš„å€¼ï¼Œä¹Ÿå¯ä»¥ä¼ é€’ char ç±»å‹çš„å€¼ï¼Œint å’Œ char å¯ä»¥æ ¹æ® ASCII ç ç›¸äº’è½¬æ¢ã€‚</br>
num ä¸º ptr çš„å‰ num ä¸ªå­—èŠ‚ï¼Œsize_t å°±æ˜¯unsigned intã€‚</br></p>
</blockquote>
<p>ã€å‡½æ•°è¯´æ˜ã€‘memset() ä¼šå°† ptr æ‰€æŒ‡çš„å†…å­˜åŒºåŸŸçš„å‰ num ä¸ªå­—èŠ‚çš„å€¼éƒ½è®¾ç½®ä¸º valueï¼Œç„¶åè¿”å›æŒ‡å‘ ptr çš„æŒ‡é’ˆã€‚</p>
<p>æ— æ³•ä¸‹é¢è¿™æ ·åˆå§‹åŒ–ï¼Œè¿™æ ·çš„ç»“æœæ˜¯aè¢«èµ‹å€¼æˆ168430090ï¼Œ168430090&hellip;..</p>
<div class="highlight" id="id-41"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="n">memset</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ˜¯å› ä¸ºintç”±4ä¸ªå­—èŠ‚(è¯´)è¡¨ç¤ºï¼Œå¹¶ä¸”ä¸èƒ½å¾—åˆ°æ•°ç»„aä¸­æ•´æ•°çš„æœŸæœ›å€¼ã€‚
ä½†æˆ‘ç»å¸¸çœ‹åˆ°ç¨‹åºå‘˜ä½¿ç”¨memsetå°†intæ•°ç»„å…ƒç´ è®¾ç½®ä¸º0æˆ–-1ã€‚å…¶ä»–å€¼ä¸è¡Œï¼</p>
<div class="highlight" id="id-42"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">b</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="n">memset</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">memset</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å‡è®¾aä¸ºintå‹æ•°ç»„ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">memset</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="c1">//aæ•°ç»„æ¯ä¸ªç©ºé—´å°†è¢«åˆå§‹åŒ–ä¸º0x7f7f7f7f,åŸå› æ˜¯Cå‡½æ•°ä¼ å‚è¿‡ç¨‹ä¸­çš„æŒ‡é’ˆé™çº§ï¼Œå¯¼è‡´sizeof(a)ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª something*æŒ‡é’ˆç±»å‹å¤§å°çš„çš„å­—èŠ‚æ•°ï¼Œå¦‚æœæ˜¯32ä½ï¼Œå°±æ˜¯4å­—èŠ‚ã€‚æ‰€ä»¥memsetæŒ‰å­—èŠ‚èµ‹å€¼ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">memset</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mh">0xaf</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="c1">//aæ•°ç»„æ¯ä¸ªç©ºé—´å°†è¢«åˆå§‹åŒ–ä¸º0xafafafaf
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="518-ç¼–è¯‘å™¨å¯¹-inline-å‡½æ•°çš„å¤„ç†æ­¥éª¤">5.18 ç¼–è¯‘å™¨å¯¹ inline å‡½æ•°çš„å¤„ç†æ­¥éª¤</h3>
<blockquote>
<p>å°† inline å‡½æ•°ä½“å¤åˆ¶åˆ° inline å‡½æ•°è°ƒç”¨ç‚¹å¤„ï¼›</br>
ä¸ºæ‰€ç”¨ inline å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼›</br>
å°† inline å‡½æ•°çš„çš„è¾“å…¥å‚æ•°å’Œè¿”å›å€¼æ˜ å°„åˆ°è°ƒç”¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ç©ºé—´ä¸­ï¼›</br>
å¦‚æœ inline å‡½æ•°æœ‰å¤šä¸ªè¿”å›ç‚¹ï¼Œå°†å…¶è½¬å˜ä¸º inline å‡½æ•°ä»£ç å—æœ«å°¾çš„åˆ†æ”¯(ä½¿ç”¨ GOTO)</br></p>
</blockquote>
<p>ä¼˜ç‚¹:</p>
<blockquote>
<p>å†…è”å‡½æ•°åŒå®å‡½æ•°ä¸€æ ·å°†åœ¨è¢«è°ƒç”¨å¤„è¿›è¡Œä»£ç å±•å¼€ï¼Œçœå»äº†å‚æ•°å‹æ ˆã€æ ˆå¸§å¼€è¾Ÿä¸å›æ”¶ï¼Œç»“æœè¿”å›ç­‰ï¼Œä»è€Œæé«˜ç¨‹åºè¿è¡Œé€Ÿåº¦ã€‚</br>
å†…è”å‡½æ•°ç›¸æ¯”å®å‡½æ•°æ¥è¯´ï¼Œåœ¨ä»£ç å±•å¼€æ—¶ï¼Œä¼šåšå®‰å…¨æ£€æŸ¥æˆ–è‡ªåŠ¨ç±»å‹è½¬æ¢(åŒæ™®é€šå‡½æ•°)ï¼Œè€Œå®å®šä¹‰åˆ™ä¸ä¼šã€‚</br>
åœ¨ç±»ä¸­å£°æ˜åŒæ—¶å®šä¹‰çš„æˆå‘˜å‡½æ•°ï¼Œè‡ªåŠ¨è½¬åŒ–ä¸ºå†…è”å‡½æ•°ï¼Œå› æ­¤å†…è”å‡½æ•°å¯ä»¥è®¿é—®ç±»çš„æˆå‘˜å˜é‡ï¼Œå®å®šä¹‰åˆ™ä¸èƒ½ã€‚</br>
å†…è”å‡½æ•°åœ¨è¿è¡Œæ—¶å¯è°ƒè¯•ï¼Œè€Œå®å®šä¹‰ä¸å¯ä»¥ã€‚</br></p>
</blockquote>
<p>ç¼ºç‚¹:</p>
<blockquote>
<p>ä»£ç è†¨èƒ€ã€‚å†…è”æ˜¯ä»¥ä»£ç è†¨èƒ€(å¤åˆ¶)ä¸ºä»£ä»·ï¼Œæ¶ˆé™¤å‡½æ•°è°ƒç”¨å¸¦æ¥çš„å¼€é”€ã€‚å¦‚æœæ‰§è¡Œå‡½æ•°ä½“å†…ä»£ç çš„æ—¶é—´ï¼Œç›¸æ¯”äºå‡½æ•°è°ƒç”¨çš„å¼€é”€è¾ƒå¤§ï¼Œé‚£ä¹ˆæ•ˆç‡çš„æ”¶è·ä¼šå¾ˆå°‘ã€‚å¦ä¸€æ–¹é¢ï¼Œæ¯ä¸€å¤„å†…è”å‡½æ•°çš„è°ƒç”¨éƒ½è¦å¤åˆ¶ä»£ç ï¼Œå°†ä½¿ç¨‹åºçš„æ€»ä»£ç é‡å¢å¤§ï¼Œæ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚</br>
inline å‡½æ•°æ— æ³•éšç€å‡½æ•°åº“å‡çº§è€Œå‡çº§ã€‚inlineå‡½æ•°çš„æ”¹å˜éœ€è¦é‡æ–°ç¼–è¯‘ï¼Œä¸åƒ non-inline å¯ä»¥ç›´æ¥é“¾æ¥ã€‚</br>
æ˜¯å¦å†…è”ï¼Œç¨‹åºå‘˜ä¸å¯æ§ã€‚å†…è”å‡½æ•°åªæ˜¯å¯¹ç¼–è¯‘å™¨çš„å»ºè®®ï¼Œæ˜¯å¦å¯¹å‡½æ•°å†…è”ï¼Œå†³å®šæƒåœ¨äºç¼–è¯‘å™¨ã€‚</br></p>
</blockquote>
<h3 id="519-è™šå‡½æ•°virtualå¯ä»¥æ˜¯å†…è”å‡½æ•°inlineå—">5.19 è™šå‡½æ•°(virtual)å¯ä»¥æ˜¯å†…è”å‡½æ•°(inline)å—ï¼Ÿ</h3>
<blockquote>
<p>è™šå‡½æ•°å¯ä»¥æ˜¯å†…è”å‡½æ•°ï¼Œå†…è”æ˜¯å¯ä»¥ä¿®é¥°è™šå‡½æ•°çš„ï¼Œä½†æ˜¯å½“è™šå‡½æ•°è¡¨ç°å¤šæ€æ€§çš„æ—¶å€™ä¸èƒ½å†…è”ã€‚</br>
å†…è”æ˜¯åœ¨ç¼–è¯‘å™¨å»ºè®®ç¼–è¯‘å™¨å†…è”ï¼Œè€Œè™šå‡½æ•°çš„å¤šæ€æ€§åœ¨è¿è¡ŒæœŸï¼Œç¼–è¯‘å™¨æ— æ³•çŸ¥é“è¿è¡ŒæœŸè°ƒç”¨å“ªä¸ªä»£ç ï¼Œå› æ­¤è™šå‡½æ•°è¡¨ç°ä¸ºå¤šæ€æ€§æ—¶(è¿è¡ŒæœŸ)ä¸å¯ä»¥å†…è”ã€‚</br>
inline virtual å”¯ä¸€å¯ä»¥å†…è”çš„æ—¶å€™æ˜¯ï¼šç¼–è¯‘å™¨çŸ¥é“æ‰€è°ƒç”¨çš„å¯¹è±¡æ˜¯å“ªä¸ªç±»(å¦‚ Base::who())ï¼Œè¿™åªæœ‰åœ¨ç¼–è¯‘å™¨å…·æœ‰å®é™…å¯¹è±¡è€Œä¸æ˜¯å¯¹è±¡çš„æŒ‡é’ˆæˆ–å¼•ç”¨æ—¶æ‰ä¼šå‘ç”Ÿ;</br></p>
</blockquote>
<h3 id="520é™æ€åº“å’ŒåŠ¨æ€åº“æ¯”è¾ƒ">5.20Â é™æ€åº“å’ŒåŠ¨æ€åº“æ¯”è¾ƒ</h3>
<p>é™æ€åº“Â (.aã€.lib):</p>
<blockquote>
<p>å°†é™æ€åº“çš„å†…å®¹æ·»åŠ åˆ°ç¨‹åºä¸­ï¼Œæ­¤æ—¶ç¨‹åºçš„ç©ºé—´ï¼Œå˜æˆäº†æºç¨‹åºç©ºé—´å¤§å°+é™æ€åº“ç©ºé—´å¤§å°ã€‚</p>
</blockquote>
<p>åŠ¨æ€åº“(å…±äº«åº“)(.soã€.dll):</p>
<blockquote>
<p>å¸¸é©»å†…å­˜ï¼Œå½“ç¨‹åºéœ€è¦è°ƒç”¨ç›¸å…³å‡½æ•°æ—¶ï¼Œä¼šä»å†…å­˜è°ƒç”¨ã€‚</p>
</blockquote>
<p>åŒºåˆ«:</p>
<blockquote>
<p>é™æ€åº“ï¼šå¯¹ç©ºé—´è¦æ±‚è¾ƒä½ï¼Œè€Œæ—¶é—´è¦æ±‚è¾ƒé«˜çš„æ ¸å¿ƒç¨‹åºä¸­ã€‚(.aã€.lib) </br>
åŠ¨æ€åº“ï¼šå¯¹æ—¶é—´è¦æ±‚è¾ƒä½ï¼Œå¯¹ç©ºé—´è¦æ±‚è¾ƒé«˜ã€‚(.soã€.dll)Â </br></p>
</blockquote>
<p><a href="https://blog.csdn.net/m0_46245582/article/details/124027320"target="_blank" rel="external nofollow noopener noreferrer">hash<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<h2 id="6-åŸºç¡€çŸ¥è¯†å…­">6 åŸºç¡€çŸ¥è¯†(å…­)</h2>
<h3 id="61-æ„é€ å‡½æ•°ä¸ºä»€ä¹ˆä¸èƒ½å®šä¹‰ä¸ºè™šå‡½æ•°-ææ„å‡½æ•°èˆ¬å†™æˆè™šå‡½æ•°çš„åŸå› -">6.1 æ„é€ å‡½æ•°ä¸ºä»€ä¹ˆä¸èƒ½å®šä¹‰ä¸ºè™šå‡½æ•°ï¼Ÿ â½½ææ„å‡½æ•°â¼€èˆ¬å†™æˆè™šå‡½æ•°çš„åŸå›  ï¼Ÿ</h3>
<p>æ„é€ å‡½æ•°ä¸èƒ½å£°æ˜ä¸ºè™šå‡½æ•°çš„åŸå› æ˜¯:</p>
<blockquote>
<p>1 æ„é€ ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¿…é¡»çŸ¥é“å¯¹è±¡çš„å®é™…ç±»å‹ï¼Œè€Œè™šå‡½æ•°è¡Œä¸ºæ˜¯åœ¨è¿è¡ŒæœŸé—´ç¡®å®šå®é™…ç±»å‹çš„ã€‚è€Œåœ¨æ„é€ ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œç”±äºå¯¹è±¡è¿˜æœªæ„é€ æˆåŠŸã€‚ç¼–è¯‘å™¨æ— æ³•çŸ¥é“å¯¹è±¡ çš„å®é™…ç±»å‹ï¼Œæ˜¯è¯¥ç±»æœ¬èº«ï¼Œè¿˜æ˜¯è¯¥ç±»çš„ä¸€ä¸ªæ´¾ç”Ÿç±»ï¼Œæˆ–æ˜¯æ›´æ·±å±‚æ¬¡çš„æ´¾ç”Ÿç±»ã€‚æ— æ³•ç¡®å®šã€‚</br>
2 è™šå‡½æ•°çš„æ‰§è¡Œä¾èµ–äºè™šå‡½æ•°è¡¨ã€‚è€Œè™šå‡½æ•°è¡¨åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œåˆå§‹åŒ–å·¥ä½œï¼Œå³åˆå§‹åŒ–vptrï¼Œè®©ä»–æŒ‡å‘æ­£ç¡®çš„è™šå‡½æ•°è¡¨ã€‚è€Œåœ¨æ„é€ å¯¹è±¡æœŸé—´ï¼Œè™šå‡½æ•°è¡¨è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå°†æ— æ³•è¿›è¡Œã€‚</br></p>
</blockquote>
<p>è™šå‡½æ•°çš„æ„æ€å°±æ˜¯å¼€å¯åŠ¨æ€ç»‘å®šï¼Œç¨‹åºä¼šæ ¹æ®å¯¹è±¡çš„åŠ¨æ€ç±»å‹æ¥é€‰æ‹©è¦è°ƒç”¨çš„æ–¹æ³•ã€‚ç„¶è€Œåœ¨æ„é€ å‡½æ•°è¿è¡Œçš„æ—¶å€™ï¼Œè¿™ä¸ªå¯¹è±¡çš„åŠ¨æ€ç±»å‹è¿˜ä¸å®Œæ•´ï¼Œæ²¡æœ‰åŠæ³•ç¡®å®šå®ƒåˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹ï¼Œæ•…æ„é€ å‡½æ•°ä¸èƒ½åŠ¨æ€ç»‘å®šã€‚(åŠ¨æ€ç»‘å®šæ˜¯æ ¹æ®å¯¹è±¡çš„åŠ¨æ€ç±»å‹è€Œä¸æ˜¯å‡½æ•°åï¼Œåœ¨è°ƒç”¨æ„é€ å‡½æ•°ä¹‹å‰ï¼Œè¿™ä¸ªå¯¹è±¡æ ¹æœ¬å°±ä¸å­˜åœ¨ï¼Œå®ƒæ€ä¹ˆåŠ¨æ€ç»‘å®šï¼Ÿ)
ç¼–è¯‘å™¨åœ¨è°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°çš„æ—¶å€™å¹¶ä¸çŸ¥é“ä½ è¦æ„é€ çš„æ˜¯ä¸€ä¸ªåŸºç±»çš„å¯¹è±¡è¿˜æ˜¯ä¸€ä¸ªæ´¾ç”Ÿç±»çš„å¯¹è±¡ã€‚</p>
<blockquote>
<p>ææ„å‡½æ•°è®¾ä¸ºè™šå‡½æ•°çš„ä½œç”¨:
è§£é‡Šï¼šåœ¨ç±»çš„ç»§æ‰¿ä¸­ï¼Œå¦‚æœæœ‰åŸºç±»æŒ‡é’ˆæŒ‡å‘æ´¾ç”Ÿç±»ï¼Œé‚£ä¹ˆç”¨åŸºç±»æŒ‡é’ˆdeleteæ—¶ï¼Œå¦‚æœä¸å®šä¹‰æˆè™šå‡½æ•°ï¼Œæ´¾ç”Ÿç±»ä¸­æ´¾ç”Ÿçš„é‚£éƒ¨åˆ†æ— æ³•ææ„ã€‚(å¦‚æœåŸºç±»çš„ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°ï¼Œé‚£ä¹ˆåœ¨delete åŸºç±»æŒ‡é’ˆæ—¶ï¼Œåªè°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°ï¼Œä¸ä¼šè°ƒç”¨æ´¾ç”Ÿç±»çš„ææ„å‡½æ•°ï¼Œæ•…æ´¾ç”Ÿç±»éƒ¨åˆ†ä¸ä¼šè¢«ææ„ã€‚)</p>
</blockquote>
<p>ref:</br>
[1]. <a href="https://blog.csdn.net/Yangy_Jiaojiao/article/details/127588598"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/Yangy_Jiaojiao/article/details/127588598<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[2]. <a href="https://blog.csdn.net/Yangy_Jiaojiao/article/details/128145609"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/Yangy_Jiaojiao/article/details/128145609<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></p>
<p>å‚è€ƒ(å¾…è¡¥å……):</br>
[1]. <a href="https://zhuanlan.zhihu.com/p/401341063"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/401341063<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[2]. <a href="https://zhuanlan.zhihu.com/p/602866792"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/602866792<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></p>
<p>ref: <a href="https://blog.csdn.net/m0_46245582/category_11569287.html"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/m0_46245582/category_11569287.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>]]></description></item><item><title>Effective STL [29] | éœ€è¦ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦è¾“å…¥æ—¶è€ƒè™‘ä½¿ç”¨istreambuf_iterator</title><link>https://jianye0428.github.io/posts/clause_29/</link><pubDate>Fri, 18 Aug 2023 07:55:51 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_29/</guid><description><![CDATA[<h2 id="istream_iterator-æ‹·è´æ–‡ä»¶">istream_iterator æ‹·è´æ–‡ä»¶</h2>
<p>å‡è®¾è¦æŠŠä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æ‹·è´åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ä¸­ã€‚ä¼¼ä¹å¯ä»¥ç”¨ä¸€ç§å¾ˆæœ‰é“ç†çš„æ–¹æ³•å®Œæˆï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">ifstream</span> <span class="nf">inputFile</span><span class="p">(</span><span class="s">&#34;interestingData.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="nf">fileData</span><span class="p">((</span><span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">inputFile</span><span class="p">)),</span> <span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠinputFileè¯»å…¥fileDataï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1">// å…³äºä¸ºä»€ä¹ˆå®ƒä¸æ˜¯å¾ˆæ­£ç¡®è¯·çœ‹ä¸‹æ–‡å…³äºè¿™ä¸ªè¯­æ³•çš„è­¦å‘Šå‚è§æ¡æ¬¾6
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¾ˆå¿«ä½ å°±ä¼šå‘ç°è¿™ç§æ–¹æ³•æ— æ³•æŠŠæ–‡ä»¶ä¸­çš„ç©ºæ ¼æ‹·è´åˆ°å­—ç¬¦ä¸²ä¸­ã€‚</p>
<p>é‚£æ˜¯å› ä¸º<code>istream_iterators</code>ä½¿ç”¨<code>operator&gt;&gt;</code>å‡½æ•°æ¥è¿›è¡ŒçœŸçš„è¯»å–ï¼Œè€Œä¸”<code>operator&gt;&gt;</code>å‡½æ•°åœ¨é»˜è®¤æƒ…å†µä¸‹å¿½ç•¥ç©ºæ ¼ã€‚</p>
<p>å‡å¦‚ä½ æƒ³ä¿ç•™ç©ºæ ¼ï¼Œä½ è¦çš„åšå°±æ˜¯è¦†ç›–é»˜è®¤æƒ…å†µã€‚åªè¦æ¸…é™¤è¾“å…¥æµçš„skipwsæ ‡å¿—å°±è¡Œäº†ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">ifstream</span> <span class="nf">inputFile</span><span class="p">(</span><span class="s">&#34;interestingData.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">inputFile</span><span class="p">.</span><span class="n">unset</span><span class="p">(</span><span class="n">ios</span><span class="o">::</span><span class="n">skipws</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å…³é—­inputFileçš„å¿½ç•¥ç©ºæ ¼æ ‡å¿—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">string</span> <span class="nf">fileData</span><span class="p">((</span><span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">inputFile</span><span class="p">)),</span> <span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨inputFileä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ‹·è´åˆ°fileDataä¸­äº†ã€‚</p>
<p><strong>æ‹·è´é€Ÿåº¦</strong></p>
<p>ä½ ä¼šå‘ç°å®ƒä»¬çš„æ‹·è´é€Ÿåº¦ä¸åƒä½ æƒ³è±¡çš„é‚£ä¹ˆå¿«ã€‚</p>
<p><code>istream_iterators</code>æ‰€ä¾é çš„<code>operator&gt;&gt;</code>å‡½æ•°è¿›è¡Œçš„æ˜¯æ ¼å¼åŒ–è¾“å…¥ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡ä½ è°ƒç”¨çš„æ—¶å€™å®ƒä»¬éƒ½å¿…é¡»åšå¤§é‡å·¥ä½œï¼š</p>
<ol>
<li>
<p>å¿…é¡»å»ºç«‹å’Œé”€æ¯å²—å“¨ï¼ˆsentryï¼‰å¯¹è±¡ï¼ˆä¸ºæ¯ä¸ª<code>operator&gt;&gt;</code>è°ƒç”¨è¿›è¡Œå»ºç«‹å’Œæ¸…é™¤æ´»åŠ¨çš„ç‰¹æ®Šçš„<code>iostream</code>å¯¹è±¡ï¼‰ï¼›</p>
</li>
<li>
<p>å¿…é¡»æ£€æŸ¥å¯èƒ½å½±å“å®ƒä»¬è¡Œä¸ºçš„æµæ ‡å¿—ï¼ˆæ¯”å¦‚skipwsï¼‰ï¼›</p>
</li>
<li>
<p>å¿…é¡»è¿›è¡Œå…¨é¢çš„è¯»å–é”™è¯¯æ£€æŸ¥ï¼›</p>
</li>
<li>
<p>å¦‚æœå®ƒä»¬é‡åˆ°é—®é¢˜ï¼Œå®ƒä»¬å¿…é¡»æ£€æŸ¥æµçš„å¼‚å¸¸æ©ç æ¥å†³å®šæ˜¯å¦è¯¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</p>
</li>
</ol>
<p>å¦‚æœè¿›è¡Œæ ¼å¼åŒ–è¾“å…¥ï¼Œé‚£äº›éƒ½æ˜¯é‡è¦çš„æ´»åŠ¨ï¼Œä½†å¦‚æœä½ éœ€è¦çš„åªæ˜¯ä»è¾“å…¥æµä¸­æŠ“å–ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£å°±è¿‡åº¦äº†ã€‚</p>
<h2 id="istreambuf_iterators-æ‹·è´æ–‡ä»¶">istreambuf_iterators æ‹·è´æ–‡ä»¶</h2>
<p>ä½ å¯ä»¥åƒ<code>istream_iterator</code>ä¸€æ ·ä½¿ç”¨<code>istreambuf_iterator</code>ï¼Œä½†<code>istream_iterator&lt;char&gt;</code>å¯¹è±¡ä½¿ç”¨<code>operator&gt;&gt;</code>æ¥ä»è¾“å…¥æµä¸­è¯»å–å•ä¸ªå­—ç¬¦ã€‚ <code>istreambuf_iterator</code>å¯¹è±¡è¿›å…¥æµçš„ç¼“å†²åŒºå¹¶ç›´æ¥è¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚ï¼ˆæ›´æ˜ç¡®åœ°è¯´ï¼Œ<code>istreambuf_iterator&lt;char&gt;</code> å¯¹è±¡ä»ä¸€ä¸ª<code>istream s</code>ä¸­è¯»å–ä¼šè°ƒç”¨<code>s.rdbuf()-&gt;sgetc()</code>æ¥è¯»<code>s</code>çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚ï¼‰æŠŠæˆ‘ä»¬çš„æ–‡ä»¶è¯»å–ä»£ç æ”¹ä¸ºä½¿ç”¨<code>istreambuf_iterator</code>ç›¸å½“ç®€å•ï¼Œå¤§å¤šæ•°Visual Basicç¨‹åºå‘˜éƒ½å¯ä»¥åœ¨ä¸¤æ¬¡å°è¯•å†…åšå¯¹ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">ifstream</span> <span class="nf">inputFile</span><span class="p">(</span><span class="s">&#34;interestingData.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="nf">fileData</span><span class="p">((</span><span class="n">istreambuf_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">inputFile</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl"><span class="n">istreambuf_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„è¿™é‡Œä¸éœ€è¦â€œ<code>unset</code>â€ <code>skipws</code>æ ‡å¿—ï¼Œ<code>istreambuf_iterator</code>ä¸å¿½ç•¥ä»»ä½•å­—ç¬¦ã€‚å®ƒä»¬åªæŠ“å–æµç¼“å†²åŒºçš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚</p>
<p>ç›¸å¯¹äº<code>istream_iterator</code>ï¼Œå®ƒä»¬æŠ“å–å¾—æ›´å¿«ã€‚</p>
<p>å¦‚æœä½ éœ€è¦ä¸€ä¸ªä¸€ä¸ªåœ°è¯»å–æµä¸­çš„å­—ç¬¦ï¼Œä½ ä¸éœ€è¦æ ¼å¼åŒ–è¾“å…¥çš„å¨åŠ›ï¼Œä½ å…³å¿ƒçš„æ˜¯å®ƒä»¬èŠ±å¤šå°‘æ—¶é—´æ¥è¯»å–æµï¼Œå’Œæ˜æ˜¾çš„æ€§èƒ½æé«˜ç›¸æ¯”ï¼Œä¸ºæ¯ä¸ªè¿­ä»£å™¨å¤šé”®å…¥ä¸‰ä¸ªå­—ç¬¦çš„ä»£ä»·æ˜¯å¾®å¼±çš„ã€‚å¯¹äºæ— æ ¼å¼çš„ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦è¾“å…¥ï¼Œä½ æ€»æ˜¯åº”è¯¥è€ƒè™‘ä½¿ç”¨<code>istreambuf_iterator</code>ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>å½“ä½ äº†è§£å®ƒä¹‹åï¼Œä½ ä¹Ÿåº”è¯¥è€ƒè™‘æŠŠ<code>ostreambuf_iterator</code>ç”¨äºç›¸åº”çš„æ— æ ¼å¼ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦è¾“å‡ºçš„ä½œã€‚</p>
<p>å®ƒä»¬æ²¡æœ‰äº†<code>ostream_iterator</code>çš„å¼€é”€ï¼ˆå’Œçµæ´»æ€§ï¼‰ï¼Œæ‰€ä»¥å®ƒä»¬é€šå¸¸ä¹Ÿåšå¾—æ›´å¥½ã€‚</p>
]]></description></item><item><title>Transformer | å¦‚ä½•ç†è§£attentionä¸­çš„Q,K,Vï¼Ÿ</title><link>https://jianye0428.github.io/posts/attentionaqkv/</link><pubDate>Sun, 20 Aug 2023 17:44:07 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/attentionaqkv/</guid><description><![CDATA[<h2 id="è§£ç­”ä¸€">è§£ç­”ä¸€</h2>
<p>æˆ‘ä»¬ç›´æ¥ç”¨torchå®ç°ä¸€ä¸ªSelfAttentionæ¥è¯´ä¸€è¯´ï¼š</p>
<ol>
<li>é¦–å…ˆå®šä¹‰ä¸‰ä¸ªçº¿æ€§å˜æ¢çŸ©é˜µï¼Œquery, key, valueï¼š</li>
</ol>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BertSelfAttention</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼Œè¿™é‡Œçš„query, key, valueåªæ˜¯ä¸€ç§æ“ä½œ(çº¿æ€§å˜æ¢)çš„åç§°ï¼Œå®é™…çš„Q/K/Væ˜¯å®ƒä»¬ä¸‰ä¸ªçš„è¾“å‡º
2. å‡è®¾ä¸‰ç§æ“ä½œçš„è¾“å…¥éƒ½æ˜¯åŒä¸€ä¸ªçŸ©é˜µ(æš‚ä¸”å…ˆåˆ«ç®¡ä¸ºä»€ä¹ˆè¾“å…¥æ˜¯åŒä¸€ä¸ªçŸ©é˜µ)ï¼Œè¿™é‡Œæš‚ä¸”å®šä¸ºé•¿åº¦ä¸ºLçš„å¥å­ï¼Œæ¯ä¸ªtokençš„ç‰¹å¾ç»´åº¦æ˜¯768ï¼Œé‚£ä¹ˆè¾“å…¥å°±æ˜¯(L, 768)ï¼Œæ¯ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªå­—ï¼Œåƒè¿™æ ·ï¼š

ä¹˜ä»¥ä¸Šé¢ä¸‰ç§æ“ä½œå°±å¾—åˆ°äº†Q/K/Vï¼Œ(L, 768)*(768,768) = (L,768)ï¼Œç»´åº¦å…¶å®æ²¡å˜ï¼Œå³æ­¤åˆ»çš„Q/K/Våˆ†åˆ«ä¸ºï¼š

ä»£ç ä¸º:</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BertSelfAttention</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"> <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden_states</span><span class="p">):</span> <span class="c1"># hidden_states ç»´åº¦æ˜¯(L, 768)</span>
</span></span><span class="line"><span class="cl">     <span class="n">Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>
<p>ç„¶åæ¥å®ç°è¿™ä¸ªæ“ä½œ:
$$Attention(Q,K_i,V_i)\color{red}{\boxed{=softmax(\frac{Q^TK_i}{\sqrt{d_k}})V_i}}$$
â‘  é¦–å…ˆæ˜¯Qå’ŒKçŸ©é˜µä¹˜ï¼Œ(L, 768)*(L, 768)çš„è½¬ç½®=(L,L)ï¼Œçœ‹å›¾ï¼š

é¦–å…ˆç”¨Qçš„ç¬¬ä¸€è¡Œï¼Œå³â€œæˆ‘â€å­—çš„768ç‰¹å¾å’ŒKä¸­â€œæˆ‘â€å­—çš„768ä¸ºç‰¹å¾ç‚¹ä¹˜æ±‚å’Œï¼Œå¾—åˆ°è¾“å‡º(0ï¼Œ0)ä½ç½®çš„æ•°å€¼ï¼Œè¿™ä¸ªæ•°å€¼å°±ä»£è¡¨äº†â€œæˆ‘æƒ³åƒé…¸èœé±¼â€ä¸­â€œæˆ‘â€å­—å¯¹â€œæˆ‘â€å­—çš„æ³¨æ„åŠ›æƒé‡ï¼Œç„¶åæ˜¾è€Œæ˜“è§è¾“å‡ºçš„ç¬¬ä¸€è¡Œå°±æ˜¯â€œæˆ‘â€å­—å¯¹â€œæˆ‘æƒ³åƒé…¸èœé±¼â€é‡Œé¢æ¯ä¸ªå­—çš„æ³¨æ„åŠ›æƒé‡ï¼›æ•´ä¸ªç»“æœè‡ªç„¶å°±æ˜¯â€œæˆ‘æƒ³åƒé…¸èœé±¼â€é‡Œé¢æ¯ä¸ªå­—å¯¹å…¶å®ƒå­—(åŒ…æ‹¬è‡ªå·±)çš„æ³¨æ„åŠ›æƒé‡(å°±æ˜¯ä¸€ä¸ªæ•°å€¼)äº†~</p>
<p>â‘¡ ç„¶åæ˜¯é™¤ä»¥æ ¹å·dimï¼Œè¿™ä¸ªdimå°±æ˜¯768ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦é™¤ä»¥è¿™ä¸ªæ•°å€¼ï¼Ÿä¸»è¦æ˜¯ä¸ºäº†ç¼©å°ç‚¹ç§¯èŒƒå›´ï¼Œç¡®ä¿softmaxæ¢¯åº¦ç¨³å®šæ€§ï¼Œå…·ä½“æ¨å¯¼å¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://zhuanlan.zhihu.com/p/149903065"target="_blank" rel="external nofollow noopener noreferrer">è²ç”Ÿä¸‰åäºŒï¼šSelf-attentionä¸­dot-productæ“ä½œä¸ºä»€ä¹ˆè¦è¢«ç¼©æ”¾<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼Œç„¶åå°±æ˜¯ä¸ºä»€ä¹ˆè¦softmaxï¼Œä¸€ç§è§£é‡Šæ˜¯ä¸ºäº†ä¿è¯æ³¨æ„åŠ›æƒé‡çš„éè´Ÿæ€§ï¼ŒåŒæ—¶å¢åŠ éçº¿æ€§ï¼Œè¿˜æœ‰ä¸€äº›å·¥ä½œå¯¹å»æ‰softmaxè¿›è¡Œäº†å®éªŒï¼Œå¦‚<a href="https://zhuanlan.zhihu.com/p/157490738"target="_blank" rel="external nofollow noopener noreferrer">PaperWeeklyï¼šçº¿æ€§Attentionçš„æ¢ç´¢ï¼šAttentionå¿…é¡»æœ‰ä¸ªSoftmaxå—ï¼Ÿ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>â‘¢ ç„¶åå°±æ˜¯åˆšæ‰çš„æ³¨æ„åŠ›æƒé‡å’ŒVçŸ©é˜µä¹˜äº†ï¼Œå¦‚å›¾ï¼š
</p>
<p>æ³¨æ„åŠ›æƒé‡ x VALUEçŸ©é˜µ = æœ€ç»ˆç»“æœ </br>
é¦–å…ˆæ˜¯â€œæˆ‘â€è¿™ä¸ªå­—å¯¹â€œæˆ‘æƒ³åƒé…¸èœé±¼â€è¿™å¥è¯é‡Œé¢æ¯ä¸ªå­—çš„æ³¨æ„åŠ›æƒé‡ï¼Œå’ŒVä¸­â€œæˆ‘æƒ³åƒé…¸èœé±¼â€é‡Œé¢æ¯ä¸ªå­—çš„ç¬¬ä¸€ç»´ç‰¹å¾è¿›è¡Œç›¸ä¹˜å†æ±‚å’Œï¼Œè¿™ä¸ªè¿‡ç¨‹å…¶å®å°±ç›¸å½“äºç”¨æ¯ä¸ªå­—çš„æƒé‡å¯¹æ¯ä¸ªå­—çš„ç‰¹å¾è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œç„¶åå†ç”¨â€œæˆ‘â€è¿™ä¸ªå­—å¯¹å¯¹â€œæˆ‘æƒ³åƒé…¸èœé±¼â€è¿™å¥è¯é‡Œé¢æ¯ä¸ªå­—çš„æ³¨æ„åŠ›æƒé‡å’ŒVä¸­â€œæˆ‘æƒ³åƒé…¸èœé±¼â€é‡Œé¢æ¯ä¸ªå­—çš„ç¬¬äºŒç»´ç‰¹å¾è¿›è¡Œç›¸ä¹˜å†æ±‚å’Œï¼Œä¾æ¬¡ç±»æ¨~æœ€ç»ˆä¹Ÿå°±å¾—åˆ°äº†(L,768)çš„ç»“æœçŸ©é˜µï¼Œå’Œè¾“å…¥ä¿æŒä¸€è‡´~</p>
<p>æ•´ä¸ªè¿‡ç¨‹åœ¨è‰ç¨¿çº¸ä¸Šç”»ä¸€ç”»ç®€å•çš„çŸ©é˜µä¹˜å°±å‡ºæ¥äº†ï¼Œä¸€ç›®äº†ç„¶~æœ€åä¸Šä»£ç ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BertSelfAttention</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"> <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">hidden_states</span><span class="p">):</span> <span class="c1"># hidden_states ç»´åº¦æ˜¯(L, 768)</span>
</span></span><span class="line"><span class="cl">     <span class="n">Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">attention_scores</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">     <span class="n">attention_scores</span> <span class="o">=</span> <span class="n">attention_scores</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attention_head_size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">attention_probs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span><span class="n">attention_scores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">attention_probs</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="n">out</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä¸ºä»€ä¹ˆå«<strong>è‡ªæ³¨æ„åŠ›ç½‘ç»œ</strong>ï¼Ÿ</br>
å› ä¸ºå¯ä»¥çœ‹åˆ°Q/K/Véƒ½æ˜¯é€šè¿‡åŒä¸€å¥è¯çš„è¾“å…¥ç®—å‡ºæ¥çš„ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æµç¨‹ä¹Ÿå°±æ˜¯ä¸€å¥è¯å†…æ¯ä¸ªå­—å¯¹å…¶å®ƒå­—(åŒ…æ‹¬è‡ªå·±)çš„æƒé‡åˆ†é…ï¼›é‚£å¦‚æœä¸æ˜¯è‡ªæ³¨æ„åŠ›å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼ŒQæ¥è‡ªäºå¥Aï¼ŒKã€Væ¥è‡ªäºå¥Bå³å¯~</br></p>
</li>
<li>
<p>æ³¨æ„ï¼ŒK/Vä¸­ï¼Œå¦‚æœåŒæ—¶æ›¿æ¢ä»»æ„ä¸¤ä¸ªå­—çš„ä½ç½®ï¼Œå¯¹æœ€ç»ˆçš„ç»“æœæ˜¯ä¸ä¼šæœ‰å½±å“çš„ï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œå¯ä»¥è‡ªå·±åœ¨è‰ç¨¿çº¸ä¸Šç”»ä¸€ç”»çŸ©é˜µä¹˜ï¼›ä¹Ÿå°±æ˜¯è¯´æ³¨æ„åŠ›æœºåˆ¶æ˜¯æ²¡æœ‰ä½ç½®ä¿¡æ¯çš„ï¼Œä¸åƒCNN/RNN/LSTMï¼›è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦å¼•å…¥positional embedingçš„åŸå› ã€‚</p>
</li>
</ol>
<h2 id="è§£ç­”äºŒ">è§£ç­”äºŒ</h2>
<p>å…¶å®ç›´æ¥ç”¨é‚±é”¡é¹è€å¸ˆPPTé‡Œçš„ä¸€å¼ å›¾å°±å¯ä»¥ç›´è§‚ç†è§£â€”â€”å‡è®¾Dæ˜¯è¾“å…¥åºåˆ—çš„å†…å®¹ï¼Œå®Œå…¨å¿½ç•¥çº¿æ€§å˜æ¢çš„è¯å¯ä»¥è¿‘ä¼¼è®¤ä¸ºQ=K=V=D(æ‰€ä»¥å«åšSelf-Attentionï¼Œå› ä¸ºè¿™æ˜¯è¾“å…¥çš„åºåˆ—å¯¹å®ƒè‡ªå·±çš„æ³¨æ„åŠ›)ï¼Œäºæ˜¯åºåˆ—ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ç»è¿‡Self-Attentionä¹‹åçš„è¡¨ç¤ºå°±å¯ä»¥è¿™æ ·å±•ç°ï¼š</p>
<p></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒTheè¿™ä¸ªè¯çš„è¡¨ç¤ºï¼Œå®é™…ä¸Šæ˜¯æ•´ä¸ªåºåˆ—åŠ æƒæ±‚å’Œçš„ç»“æœâ€”â€”æƒé‡ä»å“ªæ¥ï¼Ÿç‚¹ç§¯ä¹‹åSoftmaxå¾—åˆ°â€”â€”è¿™é‡ŒSoftmax(QK)å°±æ˜¯æ±‚æƒé‡çš„ä½“ç°ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå‘é‡ç‚¹ç§¯çš„å€¼å¯ä»¥è¡¨å¾è¯ä¸è¯ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œè€Œæ­¤å¤„çš„â€œæ•´ä¸ªåºåˆ—â€åŒ…æ‹¬Theè¿™ä¸ªè¯è‡ªå·±(å†ä¸€æ¬¡å¼ºè°ƒè¿™æ˜¯Self-Attention)ï¼Œæ‰€ä»¥æœ€åè¾“å‡ºçš„è¯çš„è¡¨ç¤ºï¼Œå…¶â€œä¸»è¦æˆåˆ†â€å°±ä¸»è¦åœ°åŒ…å«å®ƒè‡ªèº«å’Œè·Ÿå®ƒç›¸ä¼¼çš„è¯çš„è¡¨ç¤ºï¼Œå…¶ä»–æ— å…³çš„è¯çš„è¡¨ç¤ºå¯¹åº”çš„æƒé‡å°±ä¼šæ¯”è¾ƒä½ã€‚</p>
<h2 id="è§£ç­”ä¸‰">è§£ç­”ä¸‰</h2>
<p>é¦–å…ˆé™„ä¸Šé“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/37601161"target="_blank" rel="external nofollow noopener noreferrer">å¼ ä¿Šæ—ï¼šæ·±åº¦å­¦ä¹ ä¸­çš„æ³¨æ„åŠ›æ¨¡å‹(2017ç‰ˆ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a> ã€‚è¿™ä¸ªå‡ ä¹æ˜¯æˆ‘è¯»åˆ°è¿‡çš„è®²è§£Attentionæœ€ä¸ºé€å½»çš„ç¯‡ç« ä¹‹ä¸€äº†ã€‚</p>
<p>Q(Querry)ä»£è¡¨æŸ¥è¯¢å€¼ï¼Œå¯¹åº”Decoderçš„H(t-1)çŠ¶æ€ã€‚è¿™é‡Œè¦æ­£ç¡®ç†è§£H(t-1)ï¼Œæƒ³è¦è§£ç å‡ºtæ—¶åˆ»çš„è¾“å‡ºï¼Œä½ é€å…¥Decoderçš„å¿…ç„¶æœ‰å‰ä¸€æ—¶åˆ»è®¡ç®—å‡ºçš„éšçŠ¶æ€ã€‚å¥½äº†ï¼Œæ‰€è°“æŸ¥è¯¢ï¼Œå°±æ˜¯ä½ è¦æ‹¿ç€è¿™ä¸ªDecoderä¸­çš„H(t-1)å»å’ŒEncoderä¸­å„ä¸ªæ—¶åˆ»çš„éšçŠ¶æ€<a href="%e4%b9%9f%e5%b0%b1%e6%98%af%e5%90%84%e4%b8%aaKey">H(1), H(2), &hellip; , H(T)</a>å»æ¯”ï¼Œä¹Ÿå°±æ˜¯äºŒè€…è®¡ç®—ç›¸ä¼¼åº¦(å¯¹åº”äºæ–‡çŒ®ä¸­çš„å„ç§energyå‡½æ•°)ã€‚æœ€åç®—å‡ºæ¥çš„ç»“æœç”¨Softmaxå½’ä¸€åŒ–ï¼Œè¿™ä¸ªç®—å‡ºæ¥çš„æƒé‡å°±æ˜¯å¸¦æœ‰æ³¨æ„åŠ›æœºåˆ¶çš„æƒé‡ï¼Œå…¶å®åœ¨ç¿»è¯‘ä»»åŠ¡ä¸­ï¼ŒKeyå’ŒValueæ˜¯ç›¸ç­‰çš„ã€‚åœ¨Transformerçš„å®ç°æºç ä¸­ï¼ŒKeyå’ŒValueçš„åˆå§‹å€¼ä¹Ÿæ˜¯ç›¸ç­‰çš„ã€‚æœ‰äº†è¿™ä¸ªæƒé‡ä¹‹åï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªæƒé‡å¯¹Valueè¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œç”Ÿæˆçš„è¿™ä¸ªæ–°çš„å‘é‡å°±æ˜¯å¸¦æœ‰æ³¨æ„åŠ›æœºåˆ¶çš„è¯­ä¹‰å‘é‡ Context vectorï¼Œè€Œè¿™ä¸ªè¯­ä¹‰å‘é‡ä¼šæƒè¡¡Targetä¸Sourceçš„tokenä¸tokençš„å…³ç³»ï¼Œä»è€Œå®ç°è§£ç è¾“å‡ºæ—¶ï¼Œä¸Sourceä¸­â€œçœŸæ­£æœ‰å†³å®šæ„ä¹‰â€çš„tokenå…³è”ã€‚</p>
<p>å§‘ä¸”ç”»è›‡æ·»è¶³çš„å†è¯´å‡ å¥ï¼š
é¦–å…ˆï¼ŒAttentionæœºåˆ¶æ˜¯ç”±Encoder-Decoderæ¶æ„è€Œæ¥ï¼Œä¸”æœ€åˆæ˜¯ç”¨äºå®ŒæˆNLPé¢†åŸŸä¸­çš„ç¿»è¯‘(Translation)ä»»åŠ¡ã€‚é‚£ä¹ˆè¾“å…¥è¾“å‡ºå°±æ˜¯éå¸¸æ˜æ˜¾çš„ Source-Targetçš„å¯¹åº”å…³ç³»ï¼Œç»å…¸çš„Seq2Seqç»“æ„æ˜¯ä»Encoderç”Ÿæˆå‡ºä¸€ä¸ªè¯­ä¹‰å‘é‡(Context vector)è€Œä¸å†å˜åŒ–ï¼Œç„¶åå°†è¿™ä¸ªè¯­ä¹‰å‘é‡é€å…¥Decoderé…åˆè§£ç è¾“å‡ºã€‚è¿™ç§æ–¹æ³•çš„æœ€å¤§é—®é¢˜å°±æ˜¯è¿™ä¸ªè¯­ä¹‰å‘é‡ï¼Œæˆ‘ä»¬æ˜¯å¸Œæœ›å®ƒä¸€æˆä¸å˜å¥½å‘¢ï¼Ÿè¿˜æ˜¯å®ƒæœ€å¥½èƒ½é…åˆDecoderåŠ¨æ€è°ƒæ•´è‡ªå·±ï¼Œæ¥ä½¿Targetä¸­çš„æŸäº›tokenä¸Sourceä¸­çš„çœŸæ­£â€œæœ‰å†³å®šæ„ä¹‰â€çš„tokenå…³è”èµ·æ¥å¥½å‘¢ï¼Ÿ
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰Attentionæœºåˆ¶çš„åŸå› ã€‚è¯´åˆ°åº•ï¼ŒAttentionæœºåˆ¶å°±æ˜¯æƒ³ç”Ÿæˆä¼šåŠ¨æ€å˜åŒ–çš„è¯­ä¹‰å‘é‡æ¥é…åˆè§£ç è¾“å‡ºã€‚è€Œæ–°è´µ Self-Attentionåˆ™æ˜¯ä¸ºäº†è§£å†³Targetä¸Sourceå„è‡ªå†…éƒ¨tokenä¸tokençš„å…³ç³»ã€‚åœ¨Transformerä¸­ï¼Œè¿™ä¸¤ç§æ³¨æ„åŠ›æœºåˆ¶å¾—åˆ°äº†æœ‰æœºçš„ç»Ÿä¸€ï¼Œé‡Šæ”¾å‡ºäº†å¼‚å¸¸æƒŠäººçš„æ½œåŠ›ã€‚</p>
<p>ref:</br>
[1]. <a href="https://mp.weixin.qq.com/s/v7N3lhMBSdoGCz4K3TmsmA"target="_blank" rel="external nofollow noopener noreferrer">https://mp.weixin.qq.com/s/v7N3lhMBSdoGCz4K3TmsmA<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [2]</title><link>https://jianye0428.github.io/posts/parttwo/</link><pubDate>Sun, 30 Jul 2023 17:08:51 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/parttwo/</guid><description><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1>
<blockquote>
<p>Effective-C++æ€»ç»“ç³»åˆ—åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬äºŒéƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬3~4ç« ï¼Œå†…å®¹èŒƒå›´Rule13~25ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule13ç®€å†™ä¸ºR13ã€‚</p>
</blockquote>
<div class="details admonition Note">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Effective-C++ç³»åˆ—List<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partone/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/parttwo/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partthree/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partfour/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></div>
    </div>
  </div>
<p>ç”±äºåŸä¹¦åœ¨C++11ä¹‹å‰å†™æˆï¼Œæœ‰äº›ç°ä»£C++ç‰¹æ€§ä¸ä¼šæåŠï¼Œæ‰€ä»¥ä¼šæ ¹æ®æœ¬äºº<code>å¼€å‘ç»éªŒ</code>æ–°å¢ä¸€äº›ä¸ªäººæ„Ÿæ‚ŸğŸ‘‰<code>By the way</code>ç¯èŠ‚ã€‚</p>
<h2 id="ch3èµ„æºç®¡ç†">CH3.èµ„æºç®¡ç†</h2>
<h3 id="r13-ä»¥å¯¹è±¡ç®¡ç†èµ„æº">R13 ä»¥å¯¹è±¡ç®¡ç†èµ„æº</h3>
<ul>
<li>
<p>ä¸ºé˜²æ­¢èµ„æºæ³„éœ²ï¼Œå°½é‡ä½¿ç”¨<code>RAII</code>å¯¹è±¡(èµ„æºè·å–å³åˆå§‹åŒ–ï¼ŒResource Acquisition Is Initialization)
å¦‚æœç”¨è€å¼çš„new-deleteç»„åˆæ‰‹åŠ¨ç®¡ç†èµ„æºï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼Œå¤„ç†ä»£ç ä¸­æœ‰å¤šå¤„return/breakä¹‹ç±»çš„åˆ†æ”¯è¯­å¥ï¼Œæ¯å¤„éƒ½æ‰‹åŠ¨æ·»åŠ deleteå›æ”¶èµ„æºéš¾å…ä¼šæœ‰é—æ¼é£é™©ã€‚</p>
<ol>
<li>
<p>auto_ptr
æœ¬ä¹¦æåŠçš„æ™ºèƒ½æŒ‡é’ˆå¯¹è±¡<code>std::auto_ptr</code>å¯ä»¥åœ¨èµ„æºAåˆå§‹åŒ–åŒ–æ—¶æ¥ç®¡å¯¹è±¡Aï¼Œå¯¹è±¡è„±ç¦»ä½œç”¨åŸŸï¼Œææ„æ—¶é‡Šæ”¾æ¥ç®¡çš„Aã€‚
ä¸ºé¿å…é‡å¤åˆ é™¤èµ„æºï¼Œ<code>std::auto_ptrç‰¹æ€§:</code> é€šè¿‡copyæ„é€ å‡½æ•°æˆ–copy-assignmentæ“ä½œç¬¦ï¼Œæ“ä½œå®ƒä»¬ï¼Œå®ƒä»¬è‡ªèº«ä¼šå¤±å»èµ„æºæ‰€æœ‰æƒï¼Œå˜æˆNULL ï¼</p>
</li>
<li>
<p>shared_ptr
ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼Œåæ¥æ¨å‡ºäº†å¼•ç”¨è®¡æ•°ç®¡ç†èµ„æºï¼Œå³<code>RCSP(Reference-counting smart poiner)</code>ï¼Œstd::shared_ptr ã€‚(ä¹¦ä¸­å½“æ—¶è¿˜æ˜¯tr1::shared_ptr)ç‰¹ç‚¹æ˜¯shared_ptråœ¨ä½¿ç”¨copyæ„é€ å‡½æ•°æˆ–copy-assignmentæ“ä½œç¬¦æ—¶ï¼Œä¸ä¼šå¤±å»èµ„æºæ‰€æœ‰æƒï¼Œè€Œæ˜¯è‡ªèº«å¼•ç”¨è®¡æ•°åŠ 1ã€‚
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><ul>
<li>
<p>auto_ptrç›®å‰å·²ç»è¢«å¼ƒç”¨ï¼Œè½¬è€Œä½¿ç”¨ std::unique_ptræ¥æŒ‡æ¶‰ç‹¬å èµ„æºçš„æ™ºèƒ½æŒ‡é’ˆï¼Œä¸å¯è¢«å¤åˆ¶å’Œèµ‹å€¼ã€‚</p>
</li>
<li>
<p>shared_ptrå­˜åœ¨çš„é—®é¢˜æ˜¯ç¯å½¢å¾ªç¯åº”ç”¨ï¼Œäº’ç›¸æŒæœ‰å¯¹æ–¹ï¼Œåˆ™æ— æ³•é‡Šæ”¾ï¼Œé’ˆå¯¹è¿™ä¸€é—®é¢˜ï¼Œéœ€è¦å¼•å…¥std::weak_ptræ¥ç ´å±€ã€‚</p>
</li>
<li>
<p>è¿™äº›æ™ºèƒ½æŒ‡é’ˆçš„å¤´æ–‡ä»¶æ”¯æŒï¼š#include <memory></p>
</li>
</ul>
</div>
    </div>
  </div></p>
</li>
</ol>
</li>
<li>
<p>å¸¸ç”¨çš„RAIIæ–¹å¼å­˜åœ¨çš„é—®é¢˜
ä¸Šè¿°çš„shared_ptræ˜¯<strong>ä¸æ”¯æŒæ•°ç»„èµ„æºçš„é‡Šæ”¾</strong>çš„ï¼Œåœ¨ææ„æ—¶é»˜è®¤è°ƒç”¨deleteï¼Œè€Œä¸æ˜¯delete[] ã€‚å¦‚æœè¦èƒ½é‡Šæ”¾ï¼Œéœ€è¦æ‰‹åŠ¨ä¼ å…¥ææ„å‡½æ•°ã€‚</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Investment</span><span class="o">&gt;</span> <span class="n">instSpMan</span><span class="p">(</span><span class="k">new</span> <span class="n">Investment</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="p">[](</span><span class="n">Investment</span><span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span><span class="k">delete</span><span class="p">[]</span> <span class="n">p</span><span class="p">;</span> <span class="p">});</span> <span class="c1">// ä½¿ç”¨lamdaå‡½æ•°ï¼Œè¿˜å¯ä»¥ä¼ å…¥æ™®é€šå‡½æ•°æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Investment</span><span class="p">[]</span><span class="o">&gt;</span> <span class="n">instSp</span><span class="p">(</span><span class="k">new</span> <span class="n">Investment</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span><span class="c1">// shared_ptré‡è½½äº†[]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span> <span class="n">intUp</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span> <span class="c1">// unique_ptré‡è½½äº†[]
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>PS: é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœèƒ½ç”¨vectorä»£æ›¿çš„åœºæ™¯ï¼Œå°±ä¸éœ€è¦è¿™æ ·ä½¿ç”¨å¯¹è±¡æ•°ç»„ã€‚</p>
</li>
</ul>
<h3 id="r14-åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopingè¡Œä¸º">R14 åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopingè¡Œä¸º</h3>
<p>å¹¶éæ‰€æœ‰èµ„æºéƒ½æ˜¯å †ä¸Šç®¡ç†(heap-based)ï¼Œæ‰€ä»¥ä¹Ÿæœ‰æ™ºèƒ½æŒ‡é’ˆä¸é€‚åˆçš„åœºæ™¯ï¼Œè¿™æ—¶éœ€è¦è‡ªå·±å®ç°ä¸€ä¸ªèµ„æºç®¡ç†ç±»ã€‚</p>
<p>æ¯”å¦‚æœ‰ä¸ªç±»CMutex ï¼Œåªæœ‰2ä¸ªå‡½æ•°lockå’Œunlockï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªç®¡ç†ç±»CLockï¼Œæ¥ç®¡ç†Mutexç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CMutex</span> <span class="p">{</span><span class="cm">/*çœç•¥ç±»å®ç°*/</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">lock</span><span class="p">(</span><span class="n">CMutex</span> <span class="o">*</span><span class="n">mtx</span><span class="p">)</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;has lock...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span><span class="cm">/*other operation...*/</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">unlock</span><span class="p">(</span><span class="n">CMutex</span> <span class="o">*</span><span class="n">mtx</span><span class="p">)</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;release lock...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span><span class="cm">/*other operation...*/</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CLock</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">CLock</span><span class="p">(</span><span class="n">CMutex</span> <span class="o">*</span><span class="n">mtx</span><span class="p">)</span> <span class="o">:</span><span class="n">mtx_</span><span class="p">(</span><span class="n">mtx</span><span class="p">)</span> <span class="p">{</span> <span class="n">lock</span><span class="p">(</span><span class="n">mtx_</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">CLock</span><span class="p">()</span> <span class="p">{</span> <span class="n">unlock</span><span class="p">(</span><span class="n">mtx_</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> <span class="n">CMutex</span> <span class="o">*</span><span class="n">mtx_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ¶‰åŠCLockçš„copingç›¸å…³å‡½æ•°ï¼Œé‚£ä¹ˆæœ‰ä»¥ä¸‹å‡ ç§é€‰æ‹©ï¼š</p>
<ul>
<li>ç¦æ­¢å¤åˆ¶
å‚è€ƒæœ¬ä¹¦Part1-Rule06ï¼Œç¦æ­¢copingå‡½æ•°çš„ç”Ÿæˆã€‚</li>
<li>å¯¹åº•å±‚èµ„æºä½¿ç”¨â€œå¼•ç”¨è®¡æ•°æ³•â€
ä»¥shared_ptr<CMutex>ä»£æ›¿è£¸æŒ‡é’ˆï¼Œå¹¶ä¸”ä¼ å…¥unlockå‡½æ•°ä½œä¸ºè¯¥æŒ‡é’ˆçš„â€œåˆ é™¤å™¨â€ã€‚</li>
<li>å¤åˆ¶åº•éƒ¨èµ„æº
å³â€œæ·±åº¦æ‹·è´â€ï¼Œå¤åˆ¶èµ„æºç®¡ç†å¯¹è±¡æ—¶ï¼ŒåŒæ—¶å¤åˆ¶å…¶åŒ…è£¹çš„èµ„æºã€‚</li>
<li>è½¬ç§»åº•éƒ¨èµ„æºæ‰€æœ‰æƒ
å³æµ…å¤åˆ¶ï¼Œä¸æ‹·è´åŒ…è£¹çš„èµ„æºï¼Œè€Œæ˜¯è½¬ç§»æ‰€æœ‰æƒï¼Œå’Œå‰æ–‡æåˆ°çš„auto_ptréå¸¸å¥‘åˆã€‚</li>
</ul>
<h3 id="r15-åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®">R15 åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®</h3>
<p>æ™ºèƒ½æŒ‡é’ˆ<code>auto_ptr</code>, <code>unique_ptr</code>, <code>shared_ptr</code>éƒ½æä¾›äº†æ¥å£è®¿é—®åŸå§‹èµ„æºï¼Œæ–¹æ³•åç§°ä¸º<code>get()</code>ï¼Œå¯¹ç±»Aèµ„æºå¾—åˆ°è£¸æŒ‡é’ˆ<code>A*</code>ã€‚</p>
<p>æ™ºèƒ½æŒ‡é’ˆä¹Ÿé‡è½½äº†æ“ä½œç¬¦<code>operator -&gt;</code> å’Œ <code>operator *</code> ï¼Œè®¿é—®ç±»æˆå‘˜å‡½æ•°éƒ½å¯ä»¥åƒæ™®é€šæŒ‡é’ˆé‚£æ ·ä½¿ç”¨ã€‚</p>
<p>å¦‚æœè‡ªè¡Œè®¾è®¡èµ„æºç®¡ç†ç±»ï¼Œä¹Ÿè¦åƒä¸Šè¿°çš„æ™ºèƒ½æŒ‡é’ˆé‚£æ ·ï¼Œåšåˆ°èƒ½å¤Ÿè½»æ¾è®¿é—®åŸå§‹èµ„æºã€‚</p>
<p>æŸäº›æƒ…å†µï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨getæˆå‘˜å‡½æ•°<strong>æ˜¾å¼è½¬æ¢</strong>ï¼Œè½¬è€Œä½¿ç”¨<strong>éšå¼ç±»å‹è½¬æ¢</strong>ï¼Œæ–¹ä¾¿å®¢æˆ·è°ƒç”¨:</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Font</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// éšå¼è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">operator</span> <span class="n">FontHandle</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span> <span class="k">return</span> <span class="n">f</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// æ˜¾å¼è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">FontHandle</span> <span class="nf">get</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">f</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">FontHandle</span> <span class="n">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="r16-æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡å–ç›¸åŒå½¢å¼">R16 æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡å–ç›¸åŒå½¢å¼</h3>
<p>å…ˆçœ‹ä¸€æ®µé”™è¯¯ä»£ç ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">*</span><span class="n">stringArray</span> <span class="o">=</span> <span class="k">new</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">delete</span> <span class="n">stringArray</span><span class="p">;</span><span class="c1">// undefined behavior,æœªå®šä¹‰è¡Œä¸ºï¼›æœ‰å¯èƒ½åªåˆ é™¤äº†ç¬¬ä¸€ä¸ªå…ƒç´ 
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>æ³¨æ„<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><ul>
<li>new å’Œ deleteå¯¹åº”</li>
<li>new[] å’Œ delete[]å¯¹åº”
ä¸å¯é—æ¼æˆ–è€…äº¤å‰é”™é…ï¼</li>
</ul>
</div>
    </div>
  </div>
<p>ç®€å•æ¢ç©¶ <code>delete[]</code>çš„åŸç†ï¼šå®é™…ä¸Šï¼Œåœ¨ç¼–è¯‘å™¨çš„å®ç°ä¸­ï¼Œå¯¹è±¡æ•°ç»„çš„èµ·å§‹å†…å­˜ä¼šå­˜æ”¾â€œæ•°ç»„é•¿åº¦â€è¿™ä¸€å˜é‡ï¼Œä»¥ä¾¿å‘ŠçŸ¥<code>delete[]</code>åº”è¯¥è°ƒç”¨å¤šå°‘æ¬¡ææ„ï¼Œåˆ é™¤å¤šå°‘èµ„æºã€‚</p>
<p>ğŸ‘‰ è°¨æ…å¯¹æ•°ç»„ä½¿ç”¨typedefï¼Œå®¹æ˜“äº§ç”Ÿnew-deleteçš„åŒ¹é…è¯¯è§£ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">AddressLines</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">*</span><span class="n">pal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AddressLines</span><span class="p">;</span><span class="c1">//æ³¨æ„ï¼šè¿™é‡Œå…¶å®å°±æ˜¯ new string[4]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">delete</span> <span class="n">pal</span><span class="p">;</span>     <span class="c1">// è¡Œä¸ºæœªå®šä¹‰ï¼ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">delete</span> <span class="p">[]</span> <span class="n">pal</span><span class="p">;</span>  <span class="c1">// æ­£è§£ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1">// è¿™é‡Œå»ºè®®çš„æ›¿ä»£æ–¹æ³•ï¼švector&lt;string&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="r17-ä»¥ç‹¬ç«‹è¯­å¥å°†newedå¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆ">R17 ä»¥ç‹¬ç«‹è¯­å¥å°†newedå¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆ</h3>
<p><strong>ä¸è¦å°†ç”³è¯·èµ„æºçš„newè¯­å¥ç›´æ¥å½“ä½œå‡½æ•°å…¥å‚</strong>ï¼Œè€Œæ˜¯åº”è¯¥å…ˆä»¥å•ç‹¬è¯­å¥ç”³è¯·åä¼ å…¥ã€‚</p>
<p>è€ƒè™‘ä¸‹è¿°é—®é¢˜ä»£ç ï¼š</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">priority</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">processWidget</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="n">pw</span><span class="p">,</span><span class="kt">int</span> <span class="n">pri</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å‡½æ•°è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">processWidget</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">Widget</span><span class="p">),</span><span class="n">priority</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ä»£ç ç¬¬4è¡Œï¼Œåœ¨processWidgetå‡½æ•°ä½“æ‰§è¡Œä¹‹å‰ï¼Œè‡³å°‘æœ‰3ä¸ªæ­¥éª¤(å¹¶éä¸¥æ ¼æ¬¡åº)ï¼š</p>
<ol>
<li>æ‰§è¡Œ&quot;new Widget&quot;</li>
<li>è°ƒç”¨std::shared_ptrçš„æ„é€ å‡½æ•°</li>
<li>è°ƒç”¨priorityå‡½æ•°</li>
</ol>
<p>C++ç¼–è¯‘å™¨èƒ½ä¿è¯1-&gt;2çš„æ¬¡åº(2éœ€è¦1åšå…¥å‚)ï¼Œä½†æ˜¯æ— æ³•ä¿è¯3çš„æ¬¡åºä¸åœ¨1ï¼Œ2ä¹‹é—´ï¼Œå¦‚æœæ­¥éª¤3æŠ›å‡ºå¼‚å¸¸ï¼Œå°†ä¼šç›´æ¥å¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ­£ç¡®ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span>  <span class="n">pw</span><span class="p">(</span><span class="k">new</span> <span class="n">Widget</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">processWidget</span><span class="p">(</span><span class="n">pw</span><span class="p">,</span><span class="n">priority</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ch4è®¾è®¡ä¸å£°æ˜">CH4.è®¾è®¡ä¸å£°æ˜</h2>
<h3 id="r18-è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨ä¸æ˜“è¢«è¯¯ç”¨">R18 è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨ï¼Œä¸æ˜“è¢«è¯¯ç”¨</h3>
<p>è¦æƒ³è®¾è®¡ä¸€ä¸ªä¸å®¹æ˜“è¯¯ç”¨çš„æ¥å£ï¼Œ<strong>å°±è¦å…ˆè€ƒè™‘ä½¿ç”¨è€…å¯èƒ½çŠ¯ä»€ä¹ˆé”™è¯¯</strong>ã€‚</p>
<ul>
<li><code>é¿å…â€œæ¥å£è¯¯ç”¨â€ï¼Œå¯ä»¥å¯¼å…¥æ–°ç±»å‹è¿›è¡Œé™åˆ¶</code>
æ¯”å¦‚è®¾è®¡ä¸€ä¸ªDateç±»ï¼Œå‚æ•°ä¼ é€’å°±å¯èƒ½å‡ºé”™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Date</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Date</span><span class="p">(</span><span class="kt">int</span> <span class="n">month</span><span class="p">,</span><span class="kt">int</span> <span class="n">day</span><span class="p">,</span><span class="kt">int</span> <span class="n">year</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div>å®é™…ä½¿ç”¨æ—¶ï¼Œä½¿ç”¨è€…å¯èƒ½å†™å‡º<code>Date date(30,4,2021)</code>;è¿™æ ·çš„é”™è¯¯ä»£ç ï¼Œå¦‚ä½•é˜²èŒƒå‘¢ï¼Ÿ
æ–¹æ³•ä¹‹ä¸€ï¼šå°è£…å‡ºMonth,Day,Yearè¿™3ä¸ªStruct/Classï¼Œä½œä¸ºå‚æ•°å…¥å‚ï¼Œå¹¶<strong>æ·»åŠ æœˆä»½é™åˆ¶</strong>ï¼Œä»£ç ï¼š
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Month</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="n">Month</span> <span class="n">Jan</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">Month</span><span class="p">(</span><span class="mi">1</span><span class="p">);}</span> <span class="c1">// ...çœç•¥å…¶ä»–11ä¸ªæœˆä»½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="nf">Month</span><span class="p">(</span><span class="kt">int</span> <span class="n">m</span><span class="p">)</span><span class="o">:</span><span class="n">val</span><span class="p">(</span><span class="n">m</span><span class="p">){}</span> <span class="c1">//å¯è¢«class-staticè°ƒç”¨ï¼Œä¸èƒ½è¢«å¤–éƒ¨è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Day</span> <span class="p">{</span><span class="k">explicit</span> <span class="nf">Day</span><span class="p">(</span><span class="kt">int</span> <span class="n">d</span><span class="p">)</span> <span class="o">:</span><span class="n">day</span><span class="p">(</span><span class="n">d</span><span class="p">){}</span>    <span class="kt">int</span> <span class="n">day</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>  <span class="c1">//çœç•¥ struct Yearå®šä¹‰ï¼Œå’ŒDayç±»ä¼¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Date</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Date</span><span class="p">(</span><span class="k">const</span> <span class="n">Month</span><span class="o">&amp;</span> <span class="n">month</span><span class="p">,</span><span class="k">const</span> <span class="n">Day</span><span class="o">&amp;</span> <span class="n">day</span><span class="p">,</span><span class="k">const</span> <span class="n">Year</span><span class="o">&amp;</span> <span class="n">year</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div>æœ€ç»ˆå®¢æˆ·ä»£ç ä½¿ç”¨çš„æƒ…å†µå¦‚ä¸‹ï¼š
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">Date</span> <span class="nf">date</span><span class="p">(</span><span class="n">Month</span><span class="o">::</span><span class="n">Jan</span><span class="p">(),</span><span class="n">Day</span><span class="p">(</span><span class="mi">13</span><span class="p">),</span><span class="n">Year</span><span class="p">(</span><span class="mi">2022</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><pre><code>  C++11 æ”¯æŒå¯¹æšä¸¾çš„å¼ºåŒ–ï¼Œå³ç±»å‹å®‰å…¨çš„`enum class`ï¼Œå®ƒä¸èƒ½éšå¼åœ°è½¬æ¢ä¸ºæ•´æ•°ï¼›ä¹Ÿæ— æ³•ä¸æ•´æ•°æ•°å€¼åšæ¯”è¾ƒã€‚æ­¤å¤„å¯ä»¥è€ƒè™‘å®šä¹‰ä¸€ä¸ªMonthEmæ¥ä»£æ›¿Monthï¼š
  ```c++
  enum  class MonthEm {
  Jan = 1,
  Feb = 2, //... çœç•¥å…¶å®ƒçš„æœˆä»½å®šä¹‰
  };
  // ä¿®æ”¹Dateçš„æ„é€ å‡½æ•°ï¼ŒMonthEmæ¥ä»£æ›¿Month
  Date(const MonthEm&amp; monthEm, const Day&amp; day, const Year&amp; year) {}
  // æ„é€ å¯¹è±¡
  Date date2(MonthEm::Feb, Day(23), Year(2021));
  ```
</code></pre>
</div>
    </div>
  </div></li>
<li><code>é™åˆ¶ç±»å‹å†…ä»€ä¹ˆäº‹æ˜¯å¯ä¸å¯åšçš„</code>
å¸¸è§æ“ä½œæ˜¯åŠ ä¸Šconsté™åˆ¶ï¼Œæ¯”å¦‚â€œä»¥const ä¿®é¥°operator * çš„è¿”å›ç±»å‹â€å¯ä»¥é˜»æ­¢è¿™ä¸ªé”™è¯¯ï¼š
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//æœ¬æ„æ˜¯æƒ³åšæ¯”è¾ƒï¼Œå†™æˆäº†èµ‹å€¼ï¼Œä½†æ˜¯èµ‹ç»™constï¼ŒæŠ¥é”™ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><code>æ™ºèƒ½æŒ‡é’ˆä¼ å…¥åˆ é™¤å™¨å¯é¿å…&quot;Cross-dll-problem&quot;</code>
std::shared_ptrç®¡ç†èµ„æºæ—¶ï¼Œä¼ å…¥åˆ é™¤å™¨ï¼Œå¯é¿å…åœ¨A-Dllä¸­newï¼Œç»“æœåœ¨å¦ä¸€ä¸ªB-Dllä¸­deleteçš„æƒ…å†µï¼Œè¿™ä¼šå¯¼è‡´Runtime-Errorã€‚</li>
</ul>
<h3 id="r19-è®¾è®¡classçŠ¹å¦‚è®¾è®¡type">R19 è®¾è®¡ClassçŠ¹å¦‚è®¾è®¡Type</h3>
<p>è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„Classå¹¶ä¸å®¹æ˜“ï¼Œå¾ˆå¤šC++ä¹¦ç±éƒ½åƒæœ¬ä¹¦ä¸€æ ·æåˆ°â€œCheck-Tableâ€ï¼Œè®¾è®¡Class/Typeå‰ï¼Œé—®è‡ªå·±ä¸€äº›é‡è¦é—®é¢˜ï¼š</p>
<ul>
<li>æ–°typeçš„å¯¹è±¡åº”è¯¥å¦‚ä½•è¢«åˆ›å»ºå’Œé”€æ¯ï¼Ÿ</li>
<li>å¯¹è±¡çš„åˆå§‹åŒ–å’Œèµ‹å€¼è¯¥æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ</li>
<li>æ–°typeçš„å¯¹è±¡å¦‚æœå€¼ä¼ é€’(pass-by-value)ï¼Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿ
copyæ„é€ å‡½æ•°ç”¨æ¥å®šä¹‰ä¸€ä¸ªtypeçš„å€¼ä¼ é€’å…·ä½“å®ç°ã€‚</li>
<li>ä»€ä¹ˆæ˜¯æ–°typeçš„â€œåˆæ³•å€¼â€ï¼Ÿ
æƒ³æ¸…æ¥šçº¦æŸæ¡ä»¶ï¼Œç‰¹åˆ«æ˜¯æ„é€ å‡½æ•°ã€èµ‹å€¼æ“ä½œç¬¦ä»¥åŠ<strong>setter</strong>å‡½æ•°ï¼Œæ¶‰åŠçš„é”™è¯¯æ£€æŸ¥ä¸éæ³•å€¼æ‹¦æˆªã€‚</li>
<li>æ–°typeéœ€è¦é…åˆæŸä¸ªç»§æ‰¿å›¾è°±å—ï¼Ÿ
å¦‚æœç»§æ‰¿è‡ªæŸBaseç±»ï¼Œé‚£ä¹ˆå°±ä¼šæ”¶åˆ°virtual,non-virtualå‡½æ•°çš„çº¦æŸï¼›å¦‚æœè¦åšåç»­ç±»çš„åŸºç±»ï¼Œåˆ™è¯¥typeå°±è¦æ³¨æ„<strong>è™šææ„</strong>çš„è®¾è®¡ã€‚</li>
<li>æ–°typeæ¶‰åŠä»€ä¹ˆæ ·çš„è½¬æ¢ï¼Ÿ
ä¸å…¶ä»–typeä¹‹é—´å¦‚æœ‰è½¬æ¢éœ€æ±‚ï¼Œåˆ™éœ€è¦è‡ªè¡Œå®ç°ç›¸å…³å‡½æ•°ï¼Œå¯å‚è€ƒ<code>Rule15</code>ã€‚</li>
<li>æ–°typeéœ€è¦æ€æ ·çš„æ“ä½œç¬¦å’Œå‡½æ•°ï¼Ÿ
ç¡®å®šå“ªäº›æ˜¯memberå‡½æ•°ï¼Œå“ªäº›ä¸æ˜¯ã€‚å‚è€ƒ<code>Rule23</code>ï¼Œ<code>Rule24</code>ï¼Œ<code>Rule26</code>ã€‚</li>
<li>æ˜¯å¦æœ‰éœ€è¦ç«‹å³é©³å›çš„æ ‡å‡†å‡½æ•°ï¼Ÿ
æ¯”å¦‚<strong>æ˜¯å¦ç¦æ­¢</strong>copyæ„é€ ï¼Œcopy-assignmentæ“ä½œç¬¦ç­‰å‡½æ•°ï¼Œå¯ä»¥å£°æ˜ä¸ºprivateï¼›æˆ–è€…ä½¿ç”¨C++æ–°ç‰¹æ€§&quot;=delete&quot;ã€‚å‚è€ƒ<code>Rule6</code>ã€‚</li>
<li>æ–°typeæˆå‘˜çš„è®¿é—®å±æ€§æ§åˆ¶ï¼Ÿ
æˆå‘˜å˜é‡éƒ½åº”ä¸ºprivateï¼Œè€ƒè™‘å…¶ä»–memberå‡½æ•°è¯¥ä¸ºprivate/public/protectedã€‚ä»¥åŠå¯ç”¨å‹å…ƒfriendçš„è€ƒè™‘ã€‚</li>
<li>ä»€ä¹ˆæ˜¯æ–°typeçš„â€œæœªå£°æ˜æ¥å£â€?
å‚è€ƒ<code>Rule29</code>ã€‚</li>
<li>æ–°typeæœ‰å¤šä¹ˆä¸€èˆ¬åŒ–ï¼Ÿ
å¦‚æœæ˜¯ä¸€èˆ¬åŒ–çš„é—®é¢˜å¤„ç†ï¼Œè¯¥è€ƒè™‘æ˜¯å¦è¯¥å®šä¹‰Class-Templateã€‚</li>
<li>çœŸçš„éœ€è¦ä¸€ä¸ªæ–°typeå—ï¼Ÿ</li>
</ul>
<h3 id="r20-ä»¥pass-by-reference-to-constä»£æ›¿pass-by-value">R20 ä»¥pass-by-reference-to-constä»£æ›¿pass-by-value</h3>
<ul>
<li>å°½é‡ä»¥pass-by-reference-to-constä»£æ›¿pass-by-value
å‰è€…é€šå¸¸æ›´<strong>é«˜æ•ˆ</strong>ï¼Œå¹¶å¯<strong>é¿å…â€œå¯¹è±¡åˆ‡å‰²â€é—®é¢˜</strong>ã€‚
å¦‚æœå¯¹è±¡å…¥å‚ä»¥å€¼ä¼ é€’ï¼Œå°±ä¼šåœ¨å…¥å‚æ—¶åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œå‡½æ•°å®Œæˆåä¸´æ—¶å¯¹è±¡ææ„ï¼Œæ¶‰åŠæ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„è°ƒç”¨ï¼Œè¿™äº›éƒ½å¯èƒ½æ˜¯ä¸å°çš„å¼€é”€ï¼
<code>å¦‚æœæ˜¯ä»¥const referenceå½¢å¼ï¼Œåˆ™ä¸ä¼šæœ‰ä»»ä½•æ„é€ /ææ„çš„å¼€é”€</code>ã€‚constçš„ä½œç”¨æ˜¯è®©ä½¿ç”¨è€…æ”¾å¿ƒï¼Œä¸ä¼šæ”¹å˜å…¥å‚çš„å€¼ã€‚
â€œå¯¹è±¡åˆ‡å‰²&quot;é—®é¢˜ï¼š
å¦‚æœæ˜¯å€¼ä¼ é€’ï¼ŒDerived-Objä¼ é€’ç»™Base-Paramï¼Œä¼šä¸¢å¤±Derivedç‹¬æœ‰çš„ç‰¹æ€§ï¼Œåªä¿ç•™Baseçš„é‚£éƒ¨åˆ†ã€‚</li>
<li>å¯¹äºC++å†…ç½®ç±»å‹ï¼Œå€¼ä¼ é€’å¾€å¾€æ›´é«˜æ•ˆ
ä»C++ç¼–è¯‘å™¨çš„åº•å±‚å®ç°è§’åº¦æ¥çœ‹ï¼Œreferenceså¼•ç”¨å¾€å¾€æ˜¯ä»¥æŒ‡é’ˆçš„å½¢å¼å®ç°ã€‚æ‰€ä»¥å¦‚æœæ˜¯å†…ç½®æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚intç±»å‹ ï¼Œç›´æ¥å€¼ä¼ é€’åè€Œæ•ˆç‡æ›´é«˜ã€‚
<blockquote>
<p>æ­¤è§„åˆ™è¿˜é€‚ç”¨äºSTLè¿­ä»£å™¨å’Œå‡½æ•°å¯¹è±¡ã€‚</p>
</blockquote>
</li>
</ul>
<h3 id="r21-å¿…é¡»è¿”å›å¯¹è±¡æ—¶ä¸è¦éšæ„è¿”å›reference">R21 å¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œä¸è¦éšæ„è¿”å›reference</h3>
<p><strong>ä¸è¦è¿”å›æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘ä»¥ä¸‹å¯¹è±¡</strong>:</p>
<ul>
<li>å±€éƒ¨æ ˆå¯¹è±¡(local stack)
å‡½æ•°å†…éƒ¨æ–°å»ºçš„æ ˆå˜é‡å¯¹è±¡ï¼Œå‡ºäº†å‡½æ•°å°±é¢ä¸´æ¶ˆäº¡ï¼Œä»æŒæœ‰å®ƒçš„å¼•ç”¨/æŒ‡é’ˆï¼Œæ˜¯å…¸å‹çš„æœªå®šä¹‰è¡Œä¸ºã€‚</li>
<li>å †åˆ†é…å¯¹è±¡(heap allocated)
å†…éƒ¨newï¼Œç„¶åreturnå‡ºå»ä½¿ç”¨ï¼Œä¸€æ¥ä¼šå¢åŠ å¤–éƒ¨deleteçš„è´Ÿæ‹…ï¼ŒäºŒæ¥å¯èƒ½deleteçš„æœºä¼šéƒ½æ²¡æœ‰ã€‚ä»£ç å¦‚ä¸‹ï¼š
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="n">Rational</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rational</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">n</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">n</span><span class="p">,</span><span class="n">lhs</span><span class="p">.</span><span class="n">d</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">d</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¦‚ä¸‹ä½¿ç”¨è¿ä¹˜ï¼Œåˆ™æ²¡æœ‰deleteçš„æœºä¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Rational</span> <span class="n">w</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">w</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span><span class="p">;</span> <span class="c1">// å†…å­˜æ³„æ¼ï¼ï¼ï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div>ä¸Šè¿°ä»£ç è¿”å›çš„æ˜¯å¼•ç”¨ï¼Œè¿”å›æŒ‡é’ˆä¹Ÿæ˜¯ä¸€æ ·çš„è´Ÿä½œç”¨ã€‚</li>
<li>å±€éƒ¨staticå¯¹è±¡(local static)
å‡½æ•°å†…éƒ¨çš„staticå¯¹è±¡ï¼Œåªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¸”åªæœ‰ä¸€ä»½ï¼Œæœ‰è®°å¿†åŠŸèƒ½ï¼Œå¯ä»¥è¢«æ›´æ–°ã€‚é‚£ä¹ˆä¸‹è¿°ä»£ç å°±ä¼šå‡ºç°é—®é¢˜ï¼š
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">static</span> <span class="n">Rational</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span> <span class="o">=</span> <span class="n">Rational</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">n</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">n</span><span class="p">,</span><span class="n">lhs</span><span class="p">.</span><span class="n">d</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">result</span><span class="p">;</span> <span class="c1">//åœ¨è°ƒç”¨è€…çœ‹æ¥ï¼Œå› ä¸ºæ˜¯å¼•ç”¨ï¼Œæ°¸è¿œåªçœ‹åˆ°ç‹¬ä¸€ä»½çš„resultçš„â€œæœ€æ–°å€¼ â€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸‹æ–¹çš„æ¯”è¾ƒæ°¸è¿œéƒ½æ˜¯trueï¼Œæ°¸è¿œèµ°ifåˆ†æ”¯  ï¼ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Rational</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">((</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">d</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//ä¹˜ç§¯ç›¸ç­‰ï¼Œèµ°ifåˆ†æ”¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//ä¹˜ç§¯ä¸ç›¸ç­‰ï¼Œèµ°elseåˆ†æ”¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Tips<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><blockquote>
<p>é‚£æ˜¯ä¸æ˜¯æ°¸è¿œä¸èƒ½ä»¥referenceä½œä¸ºè¿”å›å€¼å‘¢ ï¼Ÿ
å½“ç„¶ä¸æ˜¯ï¼Œ*thiså¯ä»¥è¿”å›å…¶å¼•ç”¨ï¼Œå‚è€ƒRule10ï¼›æˆ–è€…ç±»æˆå‘˜ä½œä¸ºè¿”å›å€¼æ—¶ï¼Œå¯ä»¥è¿”å›å…¶å¼•ç”¨ï¼Œä½†æœ€å¥½æ˜¯constã€‚</p>
</blockquote>
</div>
    </div>
  </div>
<h3 id="r22-å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate">R22 å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate</h3>
<ul>
<li>
<p>æˆå‘˜å˜é‡ä¸ºprivateè·å¾—çš„å¥½å¤„</p>
<ol>
<li>å®¢æˆ·è®¿é—®æ•°æ®çš„ä¸€è‡´æ€§ã€‚éƒ½æ˜¯ç”¨getterå‡½æ•°ï¼ˆéœ€è¦åŠ æ‹¬å·ï¼‰ï¼Œè€Œä¸æ˜¯æ··ç”¨å‡½æ•°è·å–å’Œç›´æ¥è®¿é—®ï¼›</li>
<li>ç»†åŒ–æˆå‘˜å˜é‡çš„è®¿é—®æƒé™ã€‚æ ¹æ®æ˜¯å¦æœ‰getterã€setterå‡½æ•°å¯ä»¥ç²¾å‡†æ§åˆ¶read/write/noneè¿™æ ·çš„ç»†åŒ–ã€‚</li>
<li>ä¿æŒå®ç°å¼¹æ€§ã€‚æ¯”å¦‚è·å–æŸç³»ç»ŸæŒ‡æ ‡ï¼Œå¯ä»¥åœ¨getterå‡½æ•°ä¸­ä¿®æ”¹å„ç§çµæ´»çš„ç­–ç•¥å’Œç®—æ³•ï¼Œè€Œè°ƒç”¨è€…æ„ŸçŸ¥ä¸åˆ°ã€‚</li>
<li>å°è£…æ€§ã€‚å°è£…æ€§æ˜¯æŒ‡â˜ <code>è¶Šå¤šå‡½æ•°å¯ä»¥è®¿é—®è¯¥æ•°æ®ï¼Œå°è£…æ€§è¶Šä½</code>ã€‚
å®¢æˆ·è°ƒç”¨ç«¯æ„ŸçŸ¥ä¸åˆ°classå†…éƒ¨çš„å®ç°ï¼Œè¿™äº›ç¡®å®ä¹Ÿæ˜¯ä¸å¿…æš´éœ²çš„ã€‚å¹¶ä¸”ï¼Œå¦‚æœæ˜¯è¦ä¿®æ”¹æŸä¸ªå˜é‡ï¼Œä½¿ç”¨setterå‡½æ•°ä¹Ÿæ›´æ–¹ä¾¿è°ƒè¯•ï¼Œä¸è‡³äºè¢«éšæ„ä¿®æ”¹ã€‚</li>
</ol>
</li>
<li>
<p>protectedå’Œpublicå·®ä¸å¤šï¼Œéƒ½ä¸å…·å¤‡å°è£…æ€§
å¦‚æœæŸä¸ªpublic/protectedå˜é‡æƒé™è¢«å–æ¶ˆï¼ˆæ¯”å¦‚æ”¹ä¸ºprivateï¼‰ï¼Œå°†ä¼šå¯¼è‡´å¤§é¢ç§¯çš„ç¼–è¯‘é”™è¯¯ï¼Œèƒ½è®¿é—®çš„å˜æˆunaccessibleï¼Œéœ€è¦å¯¹åº”ä¿®æ”¹è®¸å¤šä»£ç ã€‚</p>
</li>
</ul>
<h3 id="r23-å®å¯ç”¨non-membernon-friendä»£æ›¿memberå‡½æ•°">R23 å®å¯ç”¨non-member,non-friendä»£æ›¿memberå‡½æ•°</h3>
<ul>
<li>å®é™…ä¸Šï¼Œnon-member/non-friendå‡½æ•°å…·æœ‰æ›´å¤§çš„å°è£…æ€§
è€ƒè™‘ä¸‹è¿°ä¸€ä¸ªç±»WebBrowserï¼Œmemberå‡½æ•°å’Œnon-memberå‡½æ•°ï¼Œå®é™…ä¸Šï¼Œ<strong>memberå‡½æ•°</strong>WebBrowser::clearEverythingå…·æœ‰å…¶ä»–privateæ•°æ®çš„è®¿é—®æƒé™ï¼Œ<strong>å°è£…æ€§æ˜¯æ›´å·®çš„</strong>ï¼
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WebBrowser</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">clearCache</span><span class="p">()</span> <span class="p">{</span><span class="cm">/*to clear cache*/</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">clearHistory</span><span class="p">()</span> <span class="p">{</span><span class="cm">/*to clear history*/</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">removeCookies</span><span class="p">()</span> <span class="p">{</span><span class="cm">/*to clear cookies*/</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">clearEverything</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">clearCache</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">clearHistory</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">removeCookies</span><span class="p">();}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">clearBrowser</span><span class="p">(</span><span class="n">WebBrowser</span> <span class="o">&amp;</span><span class="n">wb</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">wb</span><span class="p">.</span><span class="n">clearCache</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">wb</span><span class="p">.</span><span class="n">clearHistory</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">wb</span><span class="p">.</span><span class="n">removeCookies</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>å·¥ç¨‹ç»“æ„å®‰æ’
å¯¹äºä¸Šè¿°WebBrowserçš„ä¾‹å­ï¼Œnon-memberå‡½æ•°æ”¾å“ªé‡Œå‘¢ï¼Œé™¤äº†å¯ä»¥æ˜¯å…¶ä»–classçš„memberå‡½æ•°ï¼Œæ›´é€‚ç”¨è‡ªç„¶çš„ç­”æ¡ˆæ˜¯ç”¨<code>namespaceåŒ…è£¹èµ·æ¥</code>ã€‚ä»£ç å¦‚ä¸‹ï¼š
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">WebBrowserStuff</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">WebBrowser</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">clearBrowser</span><span class="p">(</span><span class="n">WebBrowser</span> <span class="o">&amp;</span><span class="n">wb</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>æ³¨æ„ï¼š<code>namespaceå¯ä»¥è·¨è¶Šå¤šä¸ªæºç æ–‡ä»¶ï¼Œè€Œclassä¸èƒ½</code>ã€‚
<strong>é€šå¸¸çš„ç»„ç»‡æ–¹å¼</strong>ï¼šå¤šä¸ª.hå¤´æ–‡ä»¶éƒ½ä½¿ç”¨åŒä¸€ä¸ªnamespaceï¼Œç®¡ç†ä¸åŒçš„åŠŸèƒ½æ¨¡å—ã€‚é™¤äº†è®©æ¨¡å—æ›´æ¸…æ™°ï¼Œè¿˜èƒ½é™ä½ä¸å¿…è¦çš„ç¼–è¯‘ä¾èµ–å…³ç³»ã€‚</li>
<li>å¯¹äºprivateæ•°æ®ï¼Œmemberå’Œfriendå‡½æ•°å…·æœ‰ç›¸åŒçš„è®¿é—®æƒé™
åŸºäºæ­¤ï¼Œè¿™é‡Œè®¨è®ºçš„å°è£…æ€§ä¸åœ¨äºmemberä¸å¦ï¼Œè€Œæ˜¯memberå’Œnon-member ï¼Œnon-friendå‡½æ•°ä¹‹é—´ã€‚</li>
</ul>
<h3 id="r24-è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢è¯·é‡‡ç”¨non-member">R24 è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢ï¼Œè¯·é‡‡ç”¨non-member</h3>
<p>æ ‡é¢˜éœ€æ˜æ™°ï¼šæ‰€æœ‰å‚æ•°ï¼Œæ˜¯æŒ‡<strong>åŒ…å«äº†è¢«thisæŒ‡é’ˆæ‰€æŒ‡å‘çš„é‚£ä¸ªéšå«å‚æ•°</strong>ï¼ˆnon-explicitæ„é€ å‡½æ•°è°ƒç”¨éšå¼ç±»å‹è½¬æ¢æ—¶ï¼‰ã€‚</p>
<p><strong>åº”å¯¹å…·ä½“åœºæ™¯</strong>ï¼šæ„é€ å‡½æ•°å…è®¸éšå¼ç±»å‹è½¬æ¢ï¼Œä¸”éœ€è¦è¿™ä¸ªæ„é€ å¥½çš„å¯¹è±¡ç«‹å³è°ƒç”¨æŸmemberå‡½æ•°foo(æ¯”å¦‚operatorå‡½æ•°)ï¼Œæ­¤æ—¶è¿™ä¸ªfooå‡½æ•°åº”è¯¥æ”¹ä¸ºnon-memberçš„fooå‡½æ•°ã€‚</p>
<p>è€ƒè™‘ä¸€ä¸ªæœ‰ç†æ•°ç±»Rationalï¼Œå…è®¸éšå¼ç±»å‹è½¬æ¢æ„é€ ï¼ˆå³non-explicitï¼‰ï¼Œå¦‚æœ<code>operator*</code>æ˜¯memberå‡½æ•°åˆ™ä¼šå‡ºç°é—®é¢˜ã€‚Rationalç±»å®ç°ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-16"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Rational</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Rational</span><span class="p">(</span><span class="kt">int</span> <span class="n">numerator</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">denominator</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span><span class="n">numerator_</span><span class="p">(</span><span class="n">numerator</span><span class="p">),</span> <span class="n">denominator_</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">Rational</span> <span class="k">operator</span><span class="o">*</span> <span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span><span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nf">Rational</span><span class="p">(</span><span class="n">numerator_</span><span class="o">*</span><span class="n">rhs</span><span class="p">.</span><span class="n">numerator_</span><span class="p">,</span> <span class="n">denominator_</span><span class="o">*</span><span class="n">rhs</span><span class="p">.</span><span class="n">denominator_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">numerator</span><span class="p">()</span><span class="k">const</span>  <span class="p">{</span> <span class="k">return</span> <span class="n">numerator_</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">denominator</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">denominator_</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">numerator_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">denominator_</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ä»£ç å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸èƒ½æ··åˆè¿ç®—ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-17"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">Rational</span> <span class="nf">rat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Rational</span> <span class="n">rat3Tm</span> <span class="o">=</span> <span class="n">rat</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>   <span class="c1">//èƒ½æˆåŠŸè°ƒç”¨member-operator*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Rational</span> <span class="n">rat3Tm2</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">rat</span><span class="p">;</span>  <span class="c1">//ç¼–è¯‘æŠ¥é”™ï¼ï¼ï¼ æœ¬èŠ‚çš„åœºæ™¯å°±åœ¨äºæ­¤.
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè¦è®©è¿™ç§æ··åˆè¿ç®—æ— éšœç¢ï¼ŒæŠŠ<code>operator*</code>å‡½æ•°æ”¹æˆnon-memberå³å¯ï¼Œæ³¨æ„è¦<strong>åˆ æ‰åŸæ¥memberå†…çš„<code>operator*</code></strong>ï¼Œä¸èƒ½åŒæ—¶å­˜åœ¨è¿™2ä¸ªoperator*ã€‚</p>
<div class="highlight" id="id-18"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Rational</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//... æ³¨æ„ï¼Œè¦åˆ é™¤ç±»å†…çš„memberå‡½æ•°operator*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">Rational</span> <span class="k">operator</span><span class="o">*</span> <span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nf">Rational</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">numerator</span><span class="p">()</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">numerator</span><span class="p">(),</span> <span class="n">lhs</span><span class="p">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">denominator</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="r25-è€ƒè™‘å†™ä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„swapå‡½æ•°">R25 è€ƒè™‘å†™ä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„swapå‡½æ•°</h3>
<ul>
<li>å½“ std::swapå¯¹æŸä¸ªç±»å‹æ•ˆç‡ä¸é«˜æ—¶ï¼Œæä¾›ä¸€ä¸ªswapæˆå‘˜å‡½æ•°ï¼Œä¸”è¯¥swapä¸æŠ›å¼‚å¸¸
å…ˆçœ‹ä¸€ä¸‹æ•ˆç‡ä¸é«˜çš„std::swapå®ç°ï¼š
<div class="highlight" id="id-19"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>  <span class="c1">//std::swapçš„å…¸å‹å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//ç½®æ¢ a å’Œ b çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">T</span> <span class="nf">temp</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>   <span class="c1">//è‹¥Tæ˜¯classï¼Œæ­¤å¤„è°ƒç”¨copyæ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>       <span class="c1">//è‹¥Tæ˜¯classï¼Œæ­¤å¤„è°ƒç”¨copy assignmentæ“ä½œç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">b</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>è€ƒè™‘è¿™æ ·çš„ä½¿ç”¨åœºæ™¯ï¼šéœ€è¦swapä¸€ä¸ª&quot;pimplæ‰‹æ³•â€(pointer to implementation)å®ç°çš„ç±»ï¼Œè¿™ç§ä¼ ç»Ÿçš„std::swapå¿…ç„¶æ˜¯æ•ˆç‡ä¸é«˜(æ·±å¤åˆ¶implç±»çš„æ•°æ®è€—æ—¶è¾ƒé•¿)ã€‚
<div class="highlight" id="id-20"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WidgetSwImpl</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span> <span class="c1">//å¾ˆå¤§çš„vector,æ„å‘³ç€å¤åˆ¶æ—¶é—´å¾ˆé•¿
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WidgetSw</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">WidgetSw</span><span class="p">(</span><span class="n">WidgetSwImpl</span><span class="o">*</span> <span class="n">pImpl</span><span class="p">)</span> <span class="o">:</span><span class="n">pImpl_</span><span class="p">(</span><span class="n">pImpl</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">WidgetSw</span><span class="p">(</span><span class="k">const</span> <span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span><span class="cm">/*å…¶ä»–copy&amp;initialæ“ä½œ*/</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="n">pImpl_</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">pImpl_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//public-memberå‡½æ•°swap
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>   <span class="c1">//ä»¤std::swapåœ¨æ­¤å‡½æ•°å¯ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">swap</span><span class="p">(</span><span class="n">pImpl_</span><span class="p">,</span><span class="n">other</span><span class="p">.</span><span class="n">pImpl_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">WidgetSwImpl</span><span class="o">*</span> <span class="n">pImpl_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div>è°ƒç”¨æ—¶ä»£ç å¦‚ä¸‹ï¼š
<div class="highlight" id="id-21"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">WidgetSw</span> <span class="nf">wSw1</span><span class="p">(</span><span class="k">new</span> <span class="n">WidgetSwImpl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">WidgetSw</span> <span class="nf">wSw2</span><span class="p">(</span><span class="k">new</span> <span class="n">WidgetSwImpl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">wSw1</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="n">wSw2</span><span class="p">);</span> <span class="c1">//æˆåŠŸè¿è¡Œ
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>å¦‚æœæä¾›äº†member swapï¼Œéœ€æä¾›ä¸€ä¸ªnon-memberçš„swapè°ƒç”¨å‰è€…
æ³¨æ„ï¼Œå…¶å®ä¸Šè¿°swapæˆå‘˜å‡½æ•°ä½¿ç”¨èµ·æ¥ä¸ç®—ç›´è§‚å’Œç»Ÿä¸€ï¼Œå¯ä»¥å…¨ç‰¹åŒ–std::swapè®©ä½¿ç”¨æ›´ç›´è§‚æ–¹ä¾¿ï¼Œä»£ç å¦‚ä¸‹ï¼š
<div class="highlight" id="id-22"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="o">&lt;&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="n">swap</span><span class="o">&lt;</span><span class="n">WidgetSw</span><span class="o">&gt;</span><span class="p">(</span><span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">a</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å®¢æˆ·ç«¯åº”ç”¨ä»£ç å¯ä»¥å¦‚ä¸‹è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1">// æ³¨æ„ï¼Œä¸åº”è¯¥ï¼Œä¹Ÿæ²¡å¿…è¦åŠ  std::ï¼Œä¼šé™åˆ¶ç¼–è¯‘å™¨åªä½¿ç”¨stdå‘½åç©ºé—´çš„swap
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">swap</span><span class="p">(</span><span class="n">wSw1</span><span class="p">,</span><span class="n">wSw2</span><span class="p">);</span><span class="c1">//ç¼–è¯‘å™¨ä¼šä¼˜å…ˆæŒ‘ä¸­å…¨ç‰¹åŒ–ç‰ˆæœ¬çš„std::swap
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>å¦‚æœæ˜¯Class-Templateï¼Œåˆ™ä¸è¦ç‰¹åŒ–stdå‘½åç©ºé—´çš„swapï¼Œè€Œæ˜¯ç§»åˆ°å…¶å®ƒå‘½åç©ºé—´
<div class="highlight" id="id-23"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">WidgetStuff</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">WidgetSw</span><span class="p">{</span> <span class="cm">/*çœç•¥ç±»å®šä¹‰*/</span><span class="p">}</span> <span class="c1">// ç±»å†…å«æœ‰swapæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">WidgetSw</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">WidgetSw</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Notice<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><ul>
<li>stdå‘½åç©ºé—´çš„å‡½æ•°ä¸è¦å°è¯•é‡è½½ï¼Œä¹Ÿä¸è¦å¢åŠ ä»»ä½•æ–°ä¸œè¥¿</li>
<li>C++åªå…è®¸å¯¹<code>Class-Template</code>ç›´æ¥åç‰¹åŒ–ï¼Œä¸èƒ½å¯¹<code>Function-Template</code>åç‰¹åŒ–(å‡½æ•°æ¨¡æ¿å¯ä»¥é€šè¿‡é‡è½½é—´æ¥å®ç°â€œåç‰¹åŒ–â€çš„ä½œç”¨)</li>
<li><strong>æˆå‘˜ç‰ˆswapç»å¯¹ä¸è¦æŠ›å‡ºå¼‚å¸¸</strong>ï¼Œéæˆå‘˜swapå¯ä»¥(å› ä¸ºæˆå‘˜swapçš„ä¸€ä¸ªæœ€å¥½åº”ç”¨å°±æ˜¯æä¾›å¼‚å¸¸å®‰å…¨æ€§)</li>
</ul>
</div>
    </div>
  </div></li>
</ul>
<p>ref:</br>
[1]. <a href="https://blog.csdn.net/cltcj/category_12098441.html"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/cltcj/category_12098441.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[2]. <a href="https://kissingfire123.github.io/2022/01/11_effective-c-%e4%b9%8b%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93%e4%ba%8c/"target="_blank" rel="external nofollow noopener noreferrer">https://kissingfire123.github.io/2022/01/11_effective-c-%e4%b9%8b%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93%e4%ba%8c/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></p>
]]></description></item><item><title>Effective STL [30] | ç¡®ä¿ç›®æ ‡åŒºé—´è¶³å¤Ÿå¤§</title><link>https://jianye0428.github.io/posts/clause_30/</link><pubDate>Sat, 19 Aug 2023 15:32:43 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_30/</guid><description><![CDATA[<p>STLå®¹å™¨åœ¨è¢«æ·»åŠ æ—¶ï¼ˆé€šè¿‡insertã€push_frontã€push_backç­‰ï¼‰è‡ªåŠ¨æ‰©å±•å®ƒä»¬è‡ªå·±æ¥å®¹çº³æ–°å¯¹è±¡ã€‚</p>
<h2 id="æ’å…¥æ•°æ®">æ’å…¥æ•°æ®</h2>
<p><strong>å°¾éƒ¨æ’å…¥ back_inserter</strong></p>
<p>å½“ä½ æƒ³å‘å®¹å™¨ä¸­æ’å…¥å¯¹è±¡ä½†å¹¶æ²¡æœ‰å‘Šè¯‰STLä»–ä»¬æ‰€æƒ³çš„æ—¶ï¼Œé—®é¢˜å‡ºç°äº†:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">transmogrify</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">);</span> <span class="c1">// è‡ªå®šä¹‰çš„è¿™ä¸ªå‡½æ•°ä»xäº§ç”Ÿä¸€äº›æ–°å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠæ•°æ®æ”¾å…¥values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠtransmogrifyåº”ç”¨äºvaluesä¸­çš„æ¯ä¸ªå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1">// æŠŠè¿™ä¸ªè¿”å›çš„valuesé™„åŠ åˆ°results
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">results</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">transmogrify</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è¿™æ®µä»£ç æœ‰bugï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>transformè¢«å‘ŠçŸ¥å®ƒçš„ç›®çš„åŒºé—´æ˜¯ä»<code>results.end()</code>å¼€å§‹çš„ï¼Œæ‰€ä»¥é‚£å°±æ˜¯å¼€å§‹å†™åœ¨valuesçš„æ¯ä¸ªå…ƒç´ ä¸Šè°ƒç”¨<code>transmogrify</code>çš„ç»“æœçš„åœ°æ–¹ã€‚</p>
<p>å°±åƒæ‰€æœ‰ä½¿ç”¨ç›®æ ‡åŒºé—´çš„ç®—æ³•ï¼Œ<code>transform</code>é€šè¿‡å¯¹ç›®æ ‡åŒºé—´çš„å…ƒç´ èµ‹å€¼çš„æ–¹æ³•å†™å…¥ç»“æœï¼Œ<code>transform</code>ä¼šæŠŠ<code>transmogrify</code>åº”ç”¨äº<code>values[0]</code>å¹¶æŠŠç»“æœèµ‹ç»™<code>*results.end()</code>ã€‚</p>
<p>ç„¶åå®ƒä¼šæŠŠ<code>transmogrify</code>åº”ç”¨äº<code>value[1]</code>å¹¶æŠŠç»“æœèµ‹ç»™<code>*(results.end()+1)</code>ã€‚</p>
<p>é‚£åªèƒ½å¸¦æ¥ç¾éš¾ï¼Œå› ä¸ºåœ¨<code>*results.end()</code>æ²¡æœ‰å¯¹è±¡ï¼Œ<code>*(results.end()+1)</code>ä¹Ÿæ²¡æœ‰ï¼å› ä¸º<code>transform</code>å¹¶æ²¡æœ‰åœ¨å°¾éƒ¨åˆ›é€ æ–°çš„å¯¹è±¡ã€‚</p>
<p>è°ƒç”¨<code>transform</code>æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºå®ƒä¼šç»™ä¸å­˜åœ¨çš„å¯¹è±¡èµ‹å€¼ã€‚</p>
<p><strong>æ­£ç¡®åšæ³•</strong></p>
<p>æŠŠ<code>transform</code>çš„ç»“æœæ”¾å…¥<code>results</code>å®¹å™¨çš„ç»“å°¾çš„æ–¹å¼æ˜¯è°ƒç”¨<code>back_inserter</code>æ¥äº§ç”ŸæŒ‡å®šç›®æ ‡åŒºé—´èµ·ç‚¹çš„è¿­ä»£å™¨:</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠtransmogrifyåº”ç”¨äºvaluesä¸­çš„æ¯ä¸ªå¯¹è±¡ï¼Œåœ¨resultsçš„ç»“å°¾æ’å…¥è¿”å›çš„values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">back_inserter</span><span class="p">(</span><span class="n">results</span><span class="p">),</span><span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å†…éƒ¨ï¼Œ<code>back_inserter</code>è¿”å›çš„è¿­ä»£å™¨ä¼šè°ƒç”¨<code>push_back</code>ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ä»»ä½•æä¾›<code>push_back</code>çš„å®¹å™¨ä¸Šä½¿ç”¨<code>back_inserter</code>(ä¹Ÿå°±æ˜¯ä»»ä½•æ ‡å‡†åºåˆ—å®¹å™¨: <code>vector</code>ã€<code>string</code>ã€<code>deque</code>å’Œ<code>list</code>)ã€‚</p>
<p><strong>å‰ç«¯æ’å…¥ front_inserter</strong></p>
<p>å¦‚æœä½ æƒ³è®©ä¸€ä¸ªç®—æ³•åœ¨å®¹å™¨çš„å‰ç«¯æ’å…¥ä¸œè¥¿ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>front_inserter</code>ã€‚</p>
<p>åœ¨å†…éƒ¨ï¼Œ<code>front_inserter</code>åˆ©ç”¨äº†<code>push_front</code>ï¼Œæ‰€ä»¥<code>front_insert</code>åªå’Œæä¾›é‚£ä¸ªæˆå‘˜å‡½æ•°çš„å®¹å™¨é…åˆ(ä¹Ÿå°±æ˜¯<code>deque</code>å’Œ<code>list</code>):</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// resultsç°åœ¨æ˜¯list
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">front_inserter</span><span class="p">(</span><span class="n">results</span><span class="p">),</span><span class="n">transmogrify</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åœ¨resultså‰ç«¯   ä»¥ååº   æ’å…¥transformçš„ç»“æœ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸º<code>front_inserter</code>ç”¨<code>push_front</code>æŠŠæ¯ä¸ªå¯¹è±¡æ·»åŠ åˆ°<code>results</code>ï¼Œ<code>results</code>ä¸­çš„å¯¹è±¡é¡ºåºä¼šå’Œ<code>values</code>ä¸­å¯¹åº”çš„å¯¹è±¡é¡ºåºç›¸åã€‚</p>
<p><code>vector</code>ä¸æä¾›<code>push_front</code>ï¼Œæ‰€ä»¥<code>front_inserter</code>ä¸èƒ½ç”¨äº<code>vector</code>ã€‚</p>
<p><strong>åŒåºæ’å…¥</strong></p>
<p>å¦‚æœä½ è¦<code>transform</code>æŠŠè¾“å‡ºç»“æœæ”¾åœ¨<code>results</code>å‰ç«¯ï¼Œä½†ä½ ä¹Ÿè¦è¾“å‡ºå’Œ<code>values</code>ä¸­å¯¹åº”çš„å¯¹è±¡é¡ºåºç›¸åŒï¼Œåªè¦ä»¥ç›¸åçš„é¡ºåºè¿­ä»£<code>values</code>:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1">// åœ¨resultså‰ç«¯ æ’å…¥transformçš„ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">rbegin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">rend</span><span class="p">(),</span><span class="n">front_inserter</span><span class="p">(</span><span class="n">results</span><span class="p">),</span><span class="n">transmogrify</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä¿æŒç›¸å¯¹çš„å¯¹è±¡é¡ºåº
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä»»æ„ä½ç½®æ’å…¥ inserter</strong></p>
<p><code>front_inserter</code>è®©ä½ å¼ºåˆ¶ç®—æ³•åœ¨å®¹å™¨å‰ç«¯æ’å…¥å®ƒä»¬çš„ç»“æœï¼Œ<code>back_inserter</code>è®©ä½ å‘Šè¯‰å®ƒä»¬æŠŠç»“æœæ”¾åœ¨å®¹å™¨åç«¯ï¼Œæœ‰ç‚¹æƒŠäººçš„æ˜¯<code>inserter</code>å…è®¸ä½ å¼ºåˆ¶ç®—æ³•æŠŠå®ƒä»¬çš„ç»“æœæ’å…¥å®¹å™¨ä¸­çš„ä»»æ„ä½ç½®:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Šï¼Œé™¤äº†ç°åœ¨åœ¨è°ƒç”¨transformå‰ resultså·²ç»æœ‰ä¸€äº›æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠtransmogrifyçš„ç»“æœæ’å…¥resultsçš„ä¸­é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">inserter</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">results</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">results</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ’å…¥æ•ˆç‡">æ’å…¥æ•ˆç‡</h2>
<p>ä¸ç®¡ä½ æ˜¯å¦ä½¿ç”¨äº†<code>back_inserter</code>ã€<code>front_inserter</code>æˆ–<code>inserter</code>ï¼Œ<code>transform</code>ä¼šå¯¹ç›®çš„åŒºé—´æ¯æ¬¡å†™å…¥ä¸€ä¸ªå€¼ï¼Œä½ æ— æ³•æ”¹å˜ã€‚</p>
<p>å½“ä½ è¦æ’å…¥çš„å®¹å™¨æ˜¯<code>vector</code>æˆ–<code>string</code>æ—¶ï¼Œä½ å¯ä»¥æœ€å°åŒ–è¿™ä¸ªä»£ä»·ï¼Œ<strong>é¢„å…ˆè°ƒç”¨<code>reserve</code></strong>ã€‚</p>
<p>ä½ ä»ç„¶è¦æ‰¿å—æ¯æ¬¡å‘ç”Ÿæ’å…¥æ—¶ç§»åŠ¨å…ƒç´ çš„å¼€é”€ï¼Œä½†è‡³å°‘ä½ é¿å…äº†é‡æ–°åˆ†é…å®¹å™¨çš„å†…åœ¨å†…å­˜:</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">results</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç¡®å®šresultsè‡³å°‘è¿˜èƒ½è£…å¾—ä¸‹values.size()ä¸ªå…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Šï¼Œä½†resultsæ²¡æœ‰ä»»ä½•é‡æ–°åˆ†é…æ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">inserter</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">results</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">results</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ä½¿ç”¨<code>reserve</code>æ¥æé«˜ä¸€è¿ä¸²æ’å…¥çš„æ•ˆç‡æ—¶ï¼Œæ€»æ˜¯åº”è¯¥è®°ä½<code>reserve</code><strong>åªå¢åŠ å®¹å™¨çš„å®¹é‡ï¼šå®¹å™¨çš„å¤§å°ä»ç„¶æ²¡æœ‰æ”¹å˜</strong>ã€‚</p>
<p>å³ä½¿è°ƒç”¨å®Œ<code>reserve</code>ï¼Œå½“ä½ æƒ³è¦è®©å®¹å™¨æŠŠæ–°å…ƒç´ åŠ å…¥åˆ°<code>vector</code>æˆ–<code>string</code>æ—¶ï¼Œä½ ä¹Ÿå¿…é¡»å¯¹ç®—æ³•ä½¿ç”¨æ’å…¥è¿­ä»£å™¨(æ¯”å¦‚ï¼Œä»<code>back_inserter</code>ã€<code>front_inserter</code>æˆ–<code>inserter</code>è¿”å›çš„è¿­ä»£å™¨ä¹‹ä¸€)ï¼Œå› ä¸ºèµ‹å€¼åªåœ¨ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æ“ä½œæ—¶æœ‰æ„ä¹‰ï¼Œè€Œä¸æ˜¯åœ¨ä¸€ä¸ªå¯¹è±¡å’Œä¸€å—åŸå§‹çš„æ¯”ç‰¹ä¹‹é—´ã€‚</p>
<p>ç¬¬ä¸€ä¸ªä¾‹å­æ­£ç¡®çš„å†™æ³•:</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">results</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1">// æŠŠtransmogrifyçš„ç»“æœå†™å…¥resultsçš„ç»“å°¾ï¼Œå¤„ç†æ—¶é¿å…äº†é‡æ–°åˆ†é…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">back_inserter</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="p">,</span> <span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è¦†ç›–åŸå§‹æ•°æ®">è¦†ç›–åŸå§‹æ•°æ®</h2>
<p>æœ‰æ—¶å€™ä½ è¦è¦†ç›–ç°æœ‰å®¹å™¨çš„å…ƒç´ è€Œä¸æ˜¯æ’å…¥æ–°çš„ã€‚</p>
<p><strong>å½“è¿™ç§æƒ…å†µæ—¶ï¼Œä½ ä¸éœ€è¦æ’å…¥è¿­ä»£å™¨ï¼Œä½†ä½ ä»ç„¶éœ€è¦æŒ‰ç…§æœ¬æ¡æ¬¾çš„å»ºè®®æ¥ç¡®ä¿ä½ çš„ç›®çš„åŒºé—´è¶³å¤Ÿå¤§ã€‚</strong></p>
<p>å‡è®¾ä½ è®©<code>transform</code>è¦†ç›–<code>results</code>çš„å…ƒç´ ã€‚å¦‚æœ<code>results</code>è‡³å°‘æœ‰å’Œ<code>values</code>ä¸€æ ·å¤šçš„å…ƒç´ ï¼Œé‚£å¾ˆç®€å•ã€‚å¦‚æœæ²¡æœ‰ï¼Œ ä½ ä¹Ÿå¿…é¡»ä½¿ç”¨<code>resize</code>æ¥ç¡®ä¿å®ƒæœ‰ã€‚</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç¡®ä¿resultsè‡³å°‘å’Œvaluesä¸€æ ·å¤§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">()){</span>
</span></span><span class="line"><span class="cl"> <span class="n">results</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è¦†ç›–values.size()ä¸ª resultsçš„å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">results</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…ä½ å¯ä»¥æ¸…ç©ºresultsç„¶åç”¨é€šå¸¸çš„æ–¹å¼ä½¿ç”¨æ’å…¥è¿­ä»£å™¨:</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// é”€æ¯resultsä¸­çš„æ‰€æœ‰å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">results</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä¿ç•™è¶³å¤Ÿç©ºé—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">results</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠtransformåœ°è¿”å›å€¼// æ”¾å…¥results
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">back_inserter</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç»“è®º">ç»“è®º</h2>
<p>æ— è®ºä½•æ—¶ä½ ä½¿ç”¨ä¸€ä¸ªè¦æ±‚æŒ‡å®šç›®çš„åŒºé—´çš„ç®—æ³•ï¼Œç¡®ä¿ç›®çš„åŒºé—´å·²ç»è¶³å¤Ÿå¤§æˆ–è€…åœ¨ç®—æ³•æ‰§è¡Œæ—¶å¯ä»¥å¢åŠ å¤§å°ã€‚</p>
<p>å¦‚æœä½ é€‰æ‹©å¢åŠ å¤§å°ï¼Œå°±ä½¿ç”¨æ’å…¥è¿­ä»£å™¨ï¼Œæ¯”å¦‚<code>ostream_iterators</code>æˆ–ä»<code>back_inserter</code>ã€<code>front_inserter</code>æˆ–<code>inserter</code>è¿”å›çš„è¿­ä»£å™¨ã€‚</p>
]]></description></item><item><title>Effective STL [28] | äº†è§£å¦‚ä½•é€šè¿‡reverse_iteratorçš„baseå¾—åˆ°iterator</title><link>https://jianye0428.github.io/posts/clause_28/</link><pubDate>Thu, 17 Aug 2023 20:04:40 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_28/</guid><description><![CDATA[<h2 id="example">Example</h2>
<p>é€šè¿‡reverse_iteratorçš„baseåˆå§‹åŒ–ä¸€ä¸ªiterator:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// å‚è§æ¡æ¬¾14
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="err">ï¼›</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// å‘vectoræ’å…¥1åˆ°5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">reverse_iterator</span> <span class="n">ri</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">rbegin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">rend</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ä½¿riæŒ‡å‘3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">i</span><span class="p">(</span><span class="n">ri</span><span class="p">.</span><span class="n">base</span><span class="p">());</span> <span class="c1">// ä½¿iå’Œriçš„baseä¸€æ ·
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œä¸Šè¿°ä»£ç åï¼Œå¯ä»¥æƒ³åˆ°äº§ç”Ÿçš„ç»“æœå°±åƒè¿™æ ·:</p>
<p></p>
<p>ä¸Šå›¾æ˜¾ç¤ºäº†<code>reverse_iterator</code>å’Œå®ƒå¯¹åº”çš„<code>base iterator</code>ä¹‹é—´ç‰¹æœ‰çš„åç§»é‡ï¼Œå°±åƒ<code>rbegin()</code>å’Œ<code>rend()</code>ä¸ç›¸å…³çš„<code>begin()</code>å’Œ<code>end()</code>ä¸€æ ·ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰è§£é‡Šæ€æ ·åœ¨<code>ri</code>ä¸Šå®ç°ä½ åœ¨iä¸Šæƒ³è¦å®Œæˆçš„æ“ä½œã€‚</p>
<p>æ­£å¦‚æ¡æ¬¾26è§£é‡Šçš„ï¼Œæœ‰äº›å®¹å™¨çš„æˆå‘˜å‡½æ•°åªæ¥å—<code>iterator</code>ç±»å‹çš„å‚æ•°ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³è¦åœ¨<code>ri</code>æ‰€æŒ‡çš„ä½ç½®æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œä½ ä¸èƒ½ç›´æ¥è¿™ä¹ˆåšï¼Œå› ä¸º<code>vector</code>çš„<code>insert</code>å‡½æ•°ä¸æ¥å—<code>reverse_iterator</code>ã€‚</p>
<p>å¦‚æœä½ æƒ³è¦åˆ é™¤riæ‰€æŒ‡ä½ç½®ä¸Šçš„å…ƒç´ ä¹Ÿä¼šæœ‰åŒæ ·çš„é—®é¢˜ã€‚<code>erase</code>æˆå‘˜å‡½æ•°ä¼šæ‹’ç»<code>reverse_iterator</code>ï¼ŒåšæŒè¦æ±‚<code>iterator</code>ã€‚</p>
<h2 id="reverse_iteratorè½¬æ¢æˆiterator">reverse_iteratorè½¬æ¢æˆiterator</h2>
<p>ä¸ºäº†å®Œæˆåˆ é™¤å’Œä¸€äº›å½¢å¼çš„æ’å…¥æ“ä½œï¼Œä½ å¿…é¡»å…ˆé€šè¿‡baseå‡½æ•°å°†reverse_iteratorè½¬æ¢æˆiteratorï¼Œç„¶åç”¨iteratoræ¥å®Œæˆå·¥ä½œã€‚</p>
<p><strong>æ’å…¥æ“ä½œ</strong></p>
<p>å‡è®¾ä½ è¦åœ¨riæŒ‡å‡ºçš„ä½ç½®ä¸ŠæŠŠä¸€ä¸ªæ–°å…ƒç´ æ’å…¥vã€‚å‡è®¾ä½ è¦æ’å…¥çš„å€¼æ˜¯99ã€‚</p>
<p>**riåœ¨ä¸Šå›¾ä¸­éå†çš„é¡ºåºæ˜¯è‡ªå³å‘å·¦ï¼Œè€Œä¸”æ’å…¥æ“ä½œä¼šå°†æ–°å…ƒç´ æ’å…¥åˆ°riä½ç½®ï¼Œå¹¶ä¸”å°†åŸå…ˆriä½ç½®çš„å…ƒç´ ç§»åˆ°éå†è¿‡ç¨‹çš„â€œä¸‹ä¸€ä¸ªâ€ä½ç½®ï¼Œæˆ‘ä»¬è®¤ä¸º3åº”è¯¥å‡ºç°åœ¨99çš„å·¦ä¾§ã€‚**æ’å…¥æ“ä½œä¹‹åï¼Œvçœ‹èµ·æ¥åƒè¿™æ ·:</p>
<p></p>
<p>æˆ‘ä»¬ä¸èƒ½ç”¨<code>ri</code>æ¥æŒ‡å®šæ’å…¥çš„åœ°æ–¹ï¼Œå› ä¸ºå®ƒä¸æ˜¯ä¸€ä¸ª<code>iterator</code>ã€‚æˆ‘ä»¬å¿…é¡»ç”¨<code>i</code>æ¥ä»£æ›¿ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œå½“<code>ri</code>æŒ‡å‘3æ—¶ï¼Œ<code>i</code>ï¼ˆå°±æ˜¯<code>ri.base()</code>ï¼‰æŒ‡å‘4ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ç”¨<code>ri</code>æ¥æŒ‡å®šæ’å…¥ä½ç½®ï¼Œé‚£ä¹ˆç”¨iæŒ‡å‘æ’å…¥ä½ç½®ï¼Œé‚£ä¸ªå‡è®¾å°±æ˜¯æ­£ç¡®çš„ã€‚</p>
<p><strong>ç»“è®º</strong></p>
<blockquote>
<p>è¦å®ç°åœ¨ä¸€ä¸ªreverse_iterator riæŒ‡å‡ºçš„ä½ç½®ä¸Šæ’å…¥æ–°å…ƒç´ ï¼Œåœ¨ri.base()æŒ‡å‘çš„ä½ç½®æ’å…¥å°±è¡Œäº†ã€‚
å¯¹äºinsertæ“ä½œè€Œè¨€ï¼Œriå’Œri.base()æ˜¯ç­‰ä»·çš„ï¼Œè€Œä¸”ri.base()çœŸçš„æ˜¯riå¯¹åº”çš„iteratorã€‚</p>
</blockquote>
<p><strong>åˆ é™¤æ“ä½œ</strong></p>
<p>å¦‚æœä½ è¦åˆ é™¤riæŒ‡å‘çš„å…ƒç´ ï¼Œä½ ä¸èƒ½ç›´æ¥ä½¿ç”¨iäº†ï¼Œå› ä¸ºiä¸riä¸æ˜¯æŒ‡å‘åŒä¸€ä¸ªå…ƒç´ ã€‚å› æ­¤ï¼Œä½ è¦åˆ é™¤çš„æ˜¯içš„å‰ä¸€ä¸ªå…ƒç´ ã€‚</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// å‘væ’å…¥1åˆ°5ï¼ŒåŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vecot</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">reverse_iterator</span> <span class="n">ri</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">rbegin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">rend</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// åŒä¸Šï¼ŒriæŒ‡å‘3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="o">--</span><span class="n">ri</span><span class="p">.</span><span class="n">base</span><span class="p">());</span> <span class="c1">// å°è¯•åˆ é™¤ri.base()å‰é¢çš„å…ƒç´ ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¯¹äºvectorï¼Œä¸€èˆ¬æ¥è¯´ç¼–è¯‘ä¸é€šè¿‡
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¡¨è¾¾å¼<code>--ri.base()</code>ç¡®å®èƒ½å¤ŸæŒ‡å‡ºæˆ‘ä»¬éœ€è¦åˆ é™¤çš„å…ƒç´ ã€‚è€Œä¸”ï¼Œå®ƒä»¬èƒ½å¤Ÿå¤„ç†é™¤äº†<code>vector</code>å’Œ<code>string</code>ä¹‹å¤–çš„å…¶ä»–æ‰€æœ‰å®¹å™¨ã€‚</p>
<p>å®ƒå¯èƒ½ä¹Ÿèƒ½å¤„ç†vectorå’Œstringï¼Œä½†å¯¹äºå¤§å¤šæ•°vectorå’Œstringçš„å®ç°ï¼Œå®ƒæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</p>
<p>åœ¨è¿™æ ·çš„å®ç°ä¸‹ï¼Œ<code>iterator</code>(å’Œ<code>const_iterator</code>)ä¼šé‡‡ç”¨å†…å»ºçš„æŒ‡é’ˆæ¥å®ç°ï¼Œæ‰€ä»¥<code>ri.base()</code>çš„ç»“æœæ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚</p>
<p><strong>åŸå› å‰–æ</strong></p>
<p>Cå’ŒC++éƒ½è§„å®šäº†ä¸èƒ½ç›´æ¥ä¿®æ”¹å‡½æ•°è¿”å›çš„æŒ‡é’ˆï¼Œæ‰€ä»¥åœ¨stringå’Œvectorçš„è¿­ä»£å™¨æ˜¯æŒ‡é’ˆçš„STLå¹³å°ä¸Šï¼Œåƒ<code>--ri.base()</code>è¿™æ ·çš„è¡¨è¾¾å¼æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</p>
<p>è¦ç§»æ¤ä»ä¸€ä¸ªç”±<code>reverse_iterator</code>æŒ‡å‡ºçš„ä½ç½®åˆ é™¤å…ƒç´ æ—¶ï¼Œä½ åº”è¯¥å°½é‡é¿å…ä¿®æ”¹baseçš„è¿”å›å€¼ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœä½ ä¸èƒ½å‡å°‘è°ƒç”¨<code>base</code>çš„è¿”å›å€¼ï¼Œåªéœ€è¦å…ˆå¢åŠ <code>reverse_iterator</code>çš„å€¼ï¼Œç„¶åå†è°ƒç”¨<code>base</code>ï¼</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">((</span><span class="o">++</span><span class="n">ri</span><span class="p">).</span><span class="n">base</span><span class="p">());</span> <span class="c1">// åˆ é™¤riæŒ‡å‘çš„å…ƒç´ ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1">// è¿™ä¸‹ç¼–è¯‘æ²¡é—®é¢˜äº†ï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºæ‰€æœ‰çš„æ ‡å‡†å®¹å™¨ï¼Œè¿™æ˜¯åˆ é™¤ä¸€ä¸ªç”±reverse_iteratoræŒ‡å‡ºçš„å…ƒç´ æ—¶é¦–é€‰çš„æŠ€å·§</strong></p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p><code>reverse_iterator</code>çš„<code>base</code>æˆå‘˜å‡½æ•°è¿”å›ä¸€ä¸ªâ€œå¯¹åº”çš„â€<code>iterator</code>çš„è¯´æ³•å¹¶ä¸å‡†ç¡®ï¼šå¯¹äºæ’å…¥æ“ä½œè€Œè¨€ï¼Œçš„ç¡®å¦‚æ­¤; ä½†æ˜¯å¯¹äºåˆ é™¤æ“ä½œï¼Œå¹¶éå¦‚æ­¤ã€‚</p>
<p>å½“éœ€è¦æŠŠ<code>reverse_iterator</code>è½¬æ¢æˆ<code>iterator</code>çš„æ—¶å€™ï¼Œæœ‰ä¸€ç‚¹éå¸¸é‡è¦çš„æ˜¯ä½ å¿…é¡»çŸ¥é“ä½ å‡†å¤‡æ€ä¹ˆå¤„ç†è¿”å›çš„<code>iterator</code>ï¼Œå› ä¸ºåªæœ‰è¿™æ ·ä½ æ‰èƒ½å†³å®šä½ å¾—åˆ°çš„<code>iterator</code>æ˜¯å¦æ˜¯ä½ éœ€è¦çš„ã€‚</p>
]]></description></item><item><title>Transformer è¯¦è§£</title><link>https://jianye0428.github.io/posts/transformerdetailedexplanation/</link><pubDate>Mon, 24 Jul 2023 17:37:50 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/transformerdetailedexplanation/</guid><description><![CDATA[<h2 id="transformer-è¯¦è§£">Transformer è¯¦è§£</h2>
<p>Transformer æ˜¯è°·æ­Œå¤§è„‘åœ¨ 2017 å¹´åº•å‘è¡¨çš„è®ºæ–‡ <a href="https://arxiv.org/pdf/1706.03762.pdf"target="_blank" rel="external nofollow noopener noreferrer">attention is all you need<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a> ä¸­æ‰€æå‡ºçš„ seq2seq æ¨¡å‹ã€‚ç°åœ¨å·²ç»å–å¾—äº†å¤§èŒƒå›´çš„åº”ç”¨å’Œæ‰©å±•ï¼Œè€Œ BERT å°±æ˜¯ä» Transformer ä¸­è¡ç”Ÿå‡ºæ¥çš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹</p>
<p>è¿™ç¯‡æ–‡ç« åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†</p>
<ul>
<li>Transformer ç›´è§‚è®¤è¯†</br></li>
<li>Positional Encoding</br></li>
<li>Self Attention Mechanism</br></li>
<li>æ®‹å·®è¿æ¥å’Œ Layer Normalization</br></li>
<li>Transformer Encoder æ•´ä½“ç»“æ„</br></li>
<li>Transformer Decoder æ•´ä½“ç»“æ„</br></li>
<li>æ€»ç»“</br></li>
<li>å‚è€ƒæ–‡ç« </br></li>
</ul>
<h3 id="0-transformer-ç›´è§‚è®¤è¯†">0. Transformer ç›´è§‚è®¤è¯†</h3>
<p>Transformer å’Œ LSTM çš„æœ€å¤§åŒºåˆ«ï¼Œå°±æ˜¯ <font color=green>LSTM çš„è®­ç»ƒæ˜¯è¿­ä»£çš„ã€ä¸²è¡Œçš„ï¼Œå¿…é¡»è¦ç­‰å½“å‰å­—å¤„ç†å®Œï¼Œæ‰å¯ä»¥å¤„ç†ä¸‹ä¸€ä¸ªå­—</font>ã€‚è€Œ Transformer çš„è®­ç»ƒæ—¶<strong>å¹¶è¡Œ</strong>çš„ï¼Œå³æ‰€æœ‰å­—æ˜¯åŒæ—¶è®­ç»ƒçš„ï¼Œè¿™æ ·å°±å¤§å¤§å¢åŠ äº†è®¡ç®—æ•ˆç‡ã€‚<font color=green>Transformer ä½¿ç”¨äº†ä½ç½®åµŒå…¥ (Positional Encoding) æ¥ç†è§£è¯­è¨€çš„é¡ºåº</font>ï¼Œä½¿ç”¨è‡ªæ³¨æ„åŠ›æœºåˆ¶(Self Attention Mechanism)å’Œå…¨è¿æ¥å±‚è¿›è¡Œè®¡ç®—ï¼Œè¿™äº›åé¢ä¼šè®²åˆ°ã€‚</p>
<p>Transformer æ¨¡å‹ä¸»è¦åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ Encoder å’Œ Decoderã€‚<font color=red>Encoder è´Ÿè´£æŠŠè¾“å…¥(è¯­è¨€åºåˆ—)æ˜ å°„æˆéšè—å±‚(ä¸‹å›¾ä¸­ç¬¬ 2 æ­¥ç”¨ä¹å®«æ ¼ä»£è¡¨çš„éƒ¨åˆ†)ï¼Œç„¶åè§£ç å™¨å†æŠŠéšè—å±‚æ˜ å°„ä¸ºè‡ªç„¶è¯­è¨€åºåˆ—</font>ã€‚ä¾‹å¦‚ä¸‹å›¾æœºå™¨ç¿»è¯‘çš„ä¾‹å­(Decoder è¾“å‡ºçš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡ N å±‚ Decoder Layer æ‰è¾“å‡ºä¸€ä¸ª tokenï¼Œå¹¶ä¸æ˜¯é€šè¿‡ä¸€å±‚ Decoder Layer å°±è¾“å‡ºä¸€ä¸ª token)ã€‚</p>
<p></p>
<p>æœ¬ç¯‡æ–‡ç« å¤§éƒ¨åˆ†å†…å®¹åœ¨äºè§£é‡Š Encoder éƒ¨åˆ†ï¼Œå³æŠŠè‡ªç„¶è¯­è¨€åºåˆ—æ˜ å°„ä¸ºéšè—å±‚çš„æ•°å­¦è¡¨è¾¾çš„è¿‡ç¨‹ã€‚ç†è§£äº† Encoder çš„ç»“æ„ï¼Œå†ç†è§£ Decoder å°±å¾ˆç®€å•äº†</p>
<p></p>
<p>ä¸Šå›¾ä¸º Transformer Encoder Block ç»“æ„å›¾ï¼Œæ³¨æ„ï¼šä¸‹é¢çš„å†…å®¹æ ‡é¢˜ç¼–å·åˆ†åˆ«å¯¹åº”ç€å›¾ä¸­ 1,2,3,4 ä¸ªæ–¹æ¡†çš„åºå·</p>
<h3 id="1-positional-encoding">1. Positional Encoding</h3>
<p>ç”±äº Transformer æ¨¡å‹æ²¡æœ‰å¾ªç¯ç¥ç»ç½‘ç»œçš„è¿­ä»£æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æä¾›æ¯ä¸ªå­—çš„ä½ç½®ä¿¡æ¯ç»™ Transformerï¼Œè¿™æ ·å®ƒæ‰èƒ½<font color=red>è¯†åˆ«å‡ºè¯­è¨€ä¸­çš„é¡ºåºå…³ç³»</font>ã€‚</p>
<p>ç°åœ¨å®šä¹‰ä¸€ä¸ª<strong>ä½ç½®åµŒå…¥</strong>çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯ Positional Encodingï¼Œä½ç½®åµŒå…¥çš„ç»´åº¦ä¸º [max_sequence_length, embedding_dimension], ä½ç½®åµŒå…¥çš„ç»´åº¦ä¸è¯å‘é‡çš„ç»´åº¦æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯ embedding_dimensionã€‚max_sequence_length å±äºè¶…å‚æ•°ï¼ŒæŒ‡çš„æ˜¯é™å®šæ¯ä¸ªå¥å­æœ€é•¿ç”±å¤šå°‘ä¸ªè¯æ„æˆ</p>
<p>æ³¨æ„ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä»¥å­—ä¸ºå•ä½è®­ç»ƒ Transformer æ¨¡å‹ã€‚é¦–å…ˆåˆå§‹åŒ–å­—ç¼–ç çš„å¤§å°ä¸º [vocab_size, embedding_dimension]ï¼Œvocab_size ä¸ºå­—åº“ä¸­æ‰€æœ‰å­—çš„æ•°é‡ï¼Œembedding_dimension ä¸ºå­—å‘é‡çš„ç»´åº¦ï¼Œå¯¹åº”åˆ° PyTorch ä¸­ï¼Œå…¶å®å°±æ˜¯ nn.Embedding(vocab_size, embedding_dimension)</p>
<p>è®ºæ–‡ä¸­ä½¿ç”¨äº† sin å’Œ cos å‡½æ•°çš„çº¿æ€§å˜æ¢æ¥æä¾›ç»™æ¨¡å‹ä½ç½®ä¿¡æ¯:</p>
<p>$$\left{\begin{aligned}
PE(pos, 2i) = \sin (pos/10000^{2i/d_{model}}) \cr
PE(pos, 2i + 1) = \cos (pos/10000^{2i/d_{model}}) \cr
\end{aligned}\right.$$</p>
<p>ä¸Šå¼ä¸­ $pos$ æŒ‡çš„æ˜¯ä¸€å¥è¯ä¸­æŸä¸ªå­—çš„ä½ç½®ï¼Œå–å€¼èŒƒå›´æ˜¯ $[0, \text{max _ sequence_ length}]$ ï¼Œ $i$ æŒ‡çš„æ˜¯å­—å‘é‡çš„ç»´åº¦åºå·ï¼Œå–å€¼èŒƒå›´æ˜¯ $[0, \text{embedding_ dimension} / 2]$ ï¼Œ $d_{model}$ æŒ‡çš„æ˜¯ embedding_dimensionâ€‹çš„å€¼</p>
<p>ä¸Šé¢æœ‰ sin å’Œ cos ä¸€ç»„å…¬å¼ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€ embedding_dimension ç»´åº¦çš„ä¸€ç»„å¥‡æ•°å’Œå¶æ•°çš„åºå·çš„ç»´åº¦ï¼Œä¾‹å¦‚ 0,1 ä¸€ç»„ï¼Œ2,3 ä¸€ç»„ï¼Œåˆ†åˆ«ç”¨ä¸Šé¢çš„ sin å’Œ cos å‡½æ•°åšå¤„ç†ï¼Œä»è€Œäº§ç”Ÿä¸åŒçš„å‘¨æœŸæ€§å˜åŒ–ï¼Œè€Œä½ç½®åµŒå…¥åœ¨ embedding_dimensionâ€‹ç»´åº¦ä¸Šéšç€ç»´åº¦åºå·å¢å¤§ï¼Œå‘¨æœŸå˜åŒ–ä¼šè¶Šæ¥è¶Šæ…¢ï¼Œæœ€ç»ˆäº§ç”Ÿä¸€ç§åŒ…å«ä½ç½®ä¿¡æ¯çš„çº¹ç†ï¼Œå°±åƒè®ºæ–‡åŸæ–‡ä¸­ç¬¬å…­é¡µè®²çš„ï¼Œä½ç½®åµŒå…¥å‡½æ•°çš„å‘¨æœŸä» $ 2\pi $ åˆ° $10000 * 2 \pi$ å˜åŒ–ï¼Œè€Œæ¯ä¸€ä¸ªä½ç½®åœ¨ embedding_dimension â€‹ç»´åº¦ä¸Šéƒ½ä¼šå¾—åˆ°ä¸åŒå‘¨æœŸçš„ $ \sin $ å’Œ $ \cos $ å‡½æ•°çš„å–å€¼ç»„åˆï¼Œä»è€Œäº§ç”Ÿç‹¬ä¸€çš„çº¹ç†ä½ç½®ä¿¡æ¯ï¼Œæœ€ç»ˆä½¿å¾—æ¨¡å‹å­¦åˆ°<strong>ä½ç½®ä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œè‡ªç„¶è¯­è¨€çš„æ—¶åºç‰¹æ€§</strong>ã€‚</p>
<p>å¦‚æœä¸ç†è§£è¿™é‡Œä¸ºä½•è¿™ä¹ˆè®¾è®¡ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç«  <a href="https://wmathor.com/index.php/archives/1453/"target="_blank" rel="external nofollow noopener noreferrer">Transformer ä¸­çš„ Positional Encoding<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>ä¸‹é¢ç”»ä¸€ä¸‹ä½ç½®åµŒå…¥ï¼Œçºµå‘è§‚å¯Ÿï¼Œå¯è§éšç€ embedding_dimensionâ€‹åºå·å¢å¤§ï¼Œä½ç½®åµŒå…¥å‡½æ•°çš„å‘¨æœŸå˜åŒ–è¶Šæ¥è¶Šå¹³ç¼“</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_positional_encoding</span><span class="p">(</span><span class="n">max_seq_len</span><span class="p">,</span> <span class="n">embed_dim</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># åˆå§‹åŒ–ä¸€ä¸ªpositional encoding</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># embed_dim: å­—åµŒå…¥çš„ç»´åº¦</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># max_seq_len: æœ€å¤§çš„åºåˆ—é•¿åº¦</span>
</span></span><span class="line"><span class="cl">        <span class="n">positional_encoding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="n">pos</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">embed_dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">embed_dim</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">embed_dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_seq_len</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">positional_encoding</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">positional_encoding</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># dim 2i å¶æ•°</span>
</span></span><span class="line"><span class="cl">        <span class="n">positional_encoding</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">positional_encoding</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># dim 2i+1 å¥‡æ•°</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">positional_encoding</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">positional_encoding</span> <span class="o">=</span> <span class="n">get_positional_encoding</span><span class="p">(</span><span class="n">max_seq_len</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">embed_dim</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">positional_encoding</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Sinusoidal Function&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;hidden dimension&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;sequence length&#34;</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positional_encoding</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&#34;dimension 1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positional_encoding</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&#34;dimension 2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positional_encoding</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&#34;dimension 3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;Sequence length&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Period of Positional Encoding&#34;</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<h3 id="2-self-attention-mechanism">2. Self Attention Mechanism</h3>
<p>å¯¹äºè¾“å…¥çš„å¥å­ $ X $ï¼Œé€šè¿‡ WordEmbedding å¾—åˆ°è¯¥å¥å­ä¸­æ¯ä¸ªå­—çš„å­—å‘é‡ï¼ŒåŒæ—¶é€šè¿‡ Positional Encoding å¾—åˆ°æ‰€æœ‰å­—çš„ä½ç½®å‘é‡ï¼Œå°†å…¶ç›¸åŠ (ç»´åº¦ç›¸åŒï¼Œå¯ä»¥ç›´æ¥ç›¸åŠ )ï¼Œå¾—åˆ°è¯¥å­—çœŸæ­£çš„å‘é‡è¡¨ç¤ºã€‚ç¬¬ $ t $ ä¸ªå­—çš„å‘é‡è®°ä½œ $ x_t $ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬å®šä¹‰ä¸‰ä¸ªçŸ©é˜µ $ W_Q $, $ W_K $, $ W_V $ï¼Œä½¿ç”¨è¿™ä¸‰ä¸ªçŸ©é˜µåˆ†åˆ«å¯¹æ‰€æœ‰çš„å­—å‘é‡è¿›è¡Œä¸‰æ¬¡çº¿æ€§å˜æ¢ï¼Œäºæ˜¯æ‰€æœ‰çš„å­—å‘é‡åˆè¡ç”Ÿå‡ºä¸‰ä¸ªæ–°çš„å‘é‡ $ q_t $, $ k_t $, $ v_t $ã€‚æˆ‘ä»¬å°†æ‰€æœ‰çš„ $ q_t $ å‘é‡æ‹¼æˆä¸€ä¸ªå¤§çŸ©é˜µï¼Œè®°ä½œæŸ¥è¯¢çŸ©é˜µ $ Q $ ï¼Œå°†æ‰€æœ‰çš„ $ k_t $ å‘é‡æ‹¼æˆä¸€ä¸ªå¤§çŸ©é˜µï¼Œè®°ä½œé”®çŸ©é˜µ $ K $  ï¼Œå°†æ‰€æœ‰çš„ $ v_t $ å‘é‡æ‹¼æˆä¸€ä¸ªå¤§çŸ©é˜µï¼Œè®°ä½œå€¼çŸ©é˜µ $ V $ (è§ä¸‹å›¾)</p>
<p></p>
<p>ä¸ºäº†è·å¾—ç¬¬ä¸€ä¸ªå­—çš„æ³¨æ„åŠ›æƒé‡ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ç¬¬ä¸€ä¸ªå­—çš„æŸ¥è¯¢å‘é‡ $ q_1 $ ä¹˜ä»¥é”®çŸ©é˜µ $ K $(è§ä¸‹å›¾)</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">                [0, 4, 2]
</span></span><span class="line"><span class="cl">    [1, 0, 2] x [1, 4, 3] = [2, 4, 4]
</span></span><span class="line"><span class="cl">                [1, 0, 1]</span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<p>ä¹‹åè¿˜éœ€è¦å°†å¾—åˆ°çš„å€¼ç»è¿‡ softmaxï¼Œä½¿å¾—å®ƒä»¬çš„å’Œä¸º 1(è§ä¸‹å›¾)</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> softmax([2, 4, 4]) = [0.0, 0.5, 0.5]</span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<p>æœ‰äº†æƒé‡ä¹‹åï¼Œå°†æƒé‡å…¶åˆ†åˆ«ä¹˜ä»¥å¯¹åº”å­—çš„å€¼å‘é‡ $ v_t $(è§ä¸‹å›¾)</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">    0.0 * [1, 2, 3] = [0.0, 0.0, 0.0]
</span></span><span class="line"><span class="cl">    0.5 * [2, 8, 0] = [1.0, 4.0, 0.0]
</span></span><span class="line"><span class="cl">    0.5 * [2, 6, 3] = [1.0, 3.0, 1.5]</span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<p>æœ€åå°†è¿™äº›<strong>æƒé‡åŒ–åçš„å€¼å‘é‡æ±‚å’Œ</strong>ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªå­—çš„è¾“å‡º(è§ä¸‹å›¾)</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">      [0.0, 0.0, 0.0]
</span></span><span class="line"><span class="cl">    + [1.0, 4.0, 0.0]
</span></span><span class="line"><span class="cl">    + [1.0, 3.0, 1.5]
</span></span><span class="line"><span class="cl">    -----------------
</span></span><span class="line"><span class="cl">    = [2.0, 7.0, 1.5]</span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<p>å¯¹å…¶å®ƒçš„è¾“å…¥å‘é‡ä¹Ÿæ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œå³å¯å¾—åˆ°é€šè¿‡ self-attention åçš„æ‰€æœ‰è¾“å‡º</p>
<p></p>
<p><strong>çŸ©é˜µè®¡ç®—</strong></p>
<p>ä¸Šé¢ä»‹ç»çš„æ–¹æ³•éœ€è¦ä¸€ä¸ªå¾ªç¯éå†æ‰€æœ‰çš„å­—$ x_t $ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„å‘é‡è®¡ç®—å˜æˆçŸ©é˜µçš„å½¢å¼ï¼Œä»è€Œä¸€æ¬¡è®¡ç®—å‡ºæ‰€æœ‰æ—¶åˆ»çš„è¾“å‡º</p>
<p>ç¬¬ä¸€æ­¥å°±ä¸æ˜¯è®¡ç®—æŸä¸ªæ—¶åˆ»çš„$ q_t $, $ k_t $, $ v_t $äº†ï¼Œè€Œæ˜¯ä¸€æ¬¡è®¡ç®—æ‰€æœ‰æ—¶åˆ»çš„ $
Q $, $ K $, $ V $ã€‚è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™é‡Œçš„è¾“å…¥æ˜¯ä¸€ä¸ªçŸ©é˜µ $ X $ï¼ŒçŸ©é˜µç¬¬ $ t $ è¡Œä¸ºç¬¬ $ t $ ä¸ªè¯çš„å‘é‡è¡¨ç¤º $x_t$</p>
<p></p>
<p>æ¥ä¸‹æ¥å°† $ Q $ å’Œ $K_T$ ç›¸ä¹˜ï¼Œç„¶åé™¤ä»¥ $ \sqrt{d_k} $(è¿™æ˜¯è®ºæ–‡ä¸­æåˆ°çš„ä¸€ä¸ª trick)ï¼Œç»è¿‡ softmax ä»¥åå†ä¹˜ä»¥ $ V $ å¾—åˆ°è¾“å‡º</p>
<p></p>
<p><strong>Multi-Head Attention</strong></p>
<p>è¿™ç¯‡è®ºæ–‡è¿˜æå‡ºäº† Multi-Head Attention çš„æ¦‚å¿µã€‚å…¶å®å¾ˆç®€å•ï¼Œå‰é¢å®šä¹‰çš„ä¸€ç»„ $Q $, $ K $, $ V $, å¯ä»¥è®©ä¸€ä¸ªè¯ attend to ç›¸å…³çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¤šç»„ $Q $, $ K $, $ V $ï¼Œè®©å®ƒä»¬åˆ†åˆ«å…³æ³¨ä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚è®¡ç®— $Q $, $ K $, $ V $ çš„è¿‡ç¨‹è¿˜æ˜¯ä¸€æ ·ï¼Œåªä¸è¿‡çº¿æ€§å˜æ¢çš„çŸ©é˜µä»ä¸€ç»„ $ W^Q $, $ W^K $, $ W^V $ å˜æˆäº†å¤šç»„$ W^Q_0 $, $ W^K_0 $, $ W^V_0 $  ï¼Œ$ W^Q_1 $, $ W^K_1 $, $ W^V_1 $ ï¼Œâ€¦ å¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p></p>
<p>å¯¹äºè¾“å…¥çŸ©é˜µ $ X $ ï¼Œæ¯ä¸€ç»„ $ Q $ ã€$ K $ å’Œ $ V $ éƒ½å¯ä»¥å¾—åˆ°ä¸€ä¸ªè¾“å‡ºçŸ©é˜µ $ Z $ ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p></p>
<p><strong>Padding Mask</strong>
</p>
<p>ä¸Šé¢ Self Attention çš„è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ mini-batch æ¥è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡è®¡ç®—å¤šå¥è¯ï¼Œå³ $ X $ çš„ç»´åº¦æ˜¯ <code>[batch_size, sequence_length]</code>ï¼Œsequence_lengthâ€‹æ˜¯å¥é•¿ï¼Œè€Œä¸€ä¸ª mini-batch æ˜¯ç”±å¤šä¸ªä¸ç­‰é•¿çš„å¥å­ç»„æˆçš„ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§è¿™ä¸ª mini-batch ä¸­æœ€å¤§çš„å¥é•¿å¯¹å‰©ä½™çš„å¥å­è¿›è¡Œè¡¥é½ï¼Œä¸€èˆ¬ç”¨ 0 è¿›è¡Œå¡«å……ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš padding</p>
<p>ä½†è¿™æ—¶åœ¨è¿›è¡Œ softmax å°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚å›é¡¾ softmax å‡½æ•° $\sigma(z_i) = \frac{e^{z_i}}{\sum_K^{j=i} e^{z_j}}$ï¼Œ$e^0$ æ˜¯ 1ï¼Œæ˜¯æœ‰å€¼çš„ï¼Œè¿™æ ·çš„è¯ softmax ä¸­è¢« padding çš„éƒ¨åˆ†å°±å‚ä¸äº†è¿ç®—ï¼Œç›¸å½“äºè®©æ— æ•ˆçš„éƒ¨åˆ†å‚ä¸äº†è¿ç®—ï¼Œè¿™å¯èƒ½ä¼šäº§ç”Ÿå¾ˆå¤§çš„éšæ‚£ã€‚å› æ­¤éœ€è¦åšä¸€ä¸ª mask æ“ä½œï¼Œè®©è¿™äº›æ— æ•ˆçš„åŒºåŸŸä¸å‚ä¸è¿ç®—ï¼Œä¸€èˆ¬æ˜¯ç»™æ— æ•ˆåŒºåŸŸåŠ ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ•°åç½®ï¼Œå³</p>
<p>$$
\begin{aligned}Z_{illegal}&amp;=Z_{illegal}+bias_{illegal}\cr
bias_{illegal}&amp;\to-\infty\end{aligned}
$$</p>
<h3 id="3-æ®‹å·®è¿æ¥å’Œ-layer-normalization">3. æ®‹å·®è¿æ¥å’Œ Layer Normalization</h3>
<p><strong>æ®‹å·®è¿æ¥</strong></p>
<p>æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥å¾—åˆ°äº†ç»è¿‡ self-attention åŠ æƒä¹‹åè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯$\text{Self-Attention(Q, K, V)}$ï¼Œç„¶åæŠŠä»–ä»¬åŠ èµ·æ¥åšæ®‹å·®è¿æ¥</p>
<p>$$X_{\text{embedding}} + \text{Self-Attention(Q, K, V)}$$</p>
<p><strong>Layer Normalization</strong></p>
<p>Layer Normalization çš„ä½œç”¨æ˜¯<strong>æŠŠç¥ç»ç½‘ç»œä¸­éšè—å±‚å½’ä¸€ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒ</strong>ï¼Œä¹Ÿå°±æ˜¯ $i.i.d$ ç‹¬ç«‹åŒåˆ†å¸ƒï¼Œä»¥èµ·åˆ°<strong>åŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼ŒåŠ é€Ÿæ”¶æ•›</strong>çš„ä½œç”¨</p>
<p>$$\mu_j=\frac1m\sum_{i=1}^mx_{ij}$$</p>
<p>ä¸Šå¼ä»¥çŸ©é˜µçš„åˆ—(column)ä¸ºå•ä½æ±‚å‡å€¼ï¼›</p>
<p>$$\sigma^2_{j} = \frac{1}{m}\sum^m_{i=1}(x_{ij} - \mu_j)^2$$</p>
<p>ä¸Šå¼ä»¥çŸ©é˜µçš„åˆ—(column)ä¸ºå•ä½æ±‚æ–¹å·®</p>
<p>$$LayerNorm(x) = \frac{x_{ij} - \mu_{j}}{\sqrt{\sigma^2 + \epsilon}}$$</p>
<p>ç„¶åç”¨æ¯ä¸€åˆ—çš„æ¯ä¸€ä¸ªå…ƒç´ å‡å»è¿™åˆ—çš„å‡å€¼ï¼Œå†é™¤ä»¥è¿™åˆ—çš„æ ‡å‡†å·®ï¼Œä»è€Œå¾—åˆ°å½’ä¸€åŒ–åçš„æ•°å€¼ï¼ŒåŠ  $\epsilon$ æ˜¯ä¸ºäº†é˜²æ­¢åˆ†æ¯ä¸º 0ã€‚</p>
<p></p>
<p>ä¸‹å›¾å±•ç¤ºäº†æ›´å¤šç»†èŠ‚ï¼šè¾“å…¥ $x_1, x_2$ ç» self-attention å±‚ä¹‹åå˜æˆ $z_1, z_2$ï¼Œç„¶åå’Œè¾“å…¥ $x_1, x_2$ è¿›è¡Œæ®‹å·®è¿æ¥ï¼Œç»è¿‡ LayerNorm åè¾“å‡ºç»™å…¨è¿æ¥å±‚ã€‚å…¨è¿æ¥å±‚ä¹Ÿæœ‰ä¸€ä¸ªæ®‹å·®è¿æ¥å’Œä¸€ä¸ª LayerNormï¼Œæœ€åå†è¾“å‡ºç»™ä¸‹ä¸€ä¸ª Encoder(æ¯ä¸ª Encoder Block ä¸­çš„ FeedForward å±‚æƒé‡éƒ½æ˜¯å…±äº«çš„)</p>
<p></p>
<h3 id="4-transformer-encoder-æ•´ä½“ç»“æ„">4. Transformer Encoder æ•´ä½“ç»“æ„</h3>
<p>ç»è¿‡ä¸Šé¢ 3 ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£äº† Encoder çš„ä¸»è¦æ„æˆéƒ¨åˆ†ï¼Œä¸‹é¢æˆ‘ä»¬ç”¨å…¬å¼æŠŠä¸€ä¸ª Encoder block çš„è®¡ç®—è¿‡ç¨‹æ•´ç†ä¸€ä¸‹ï¼š</p>
<p>(1). å­—å‘é‡ä¸ä½ç½®ç¼–ç </p>
<p>$$X = \text{Embedding-Lookup(X)} + \text{Positional-Encoding}$$</p>
<p>(2). è‡ªæ³¨æ„åŠ›æœºåˆ¶</p>
<p>$$Q = Linear_{q}(X) = XW_{Q}$$
$$K = Linear_{k}(X) = XW_{K}$$
$$V = Linear_{v}(X) = XW_{V}$$
$$X_{attention} = \text{Self-Attention(Q, K, V)}$$</p>
<p>(3). self-attention æ®‹å·®è¿æ¥ä¸ Layer Normalization</p>
<p>$$X_{attention} = X + X_{attention}$$
$$X_{attention} = LayerNorm(attention)$$</p>
<p>(4). ä¸‹é¢è¿›è¡Œ Encoder block ç»“æ„å›¾ä¸­çš„ç¬¬ 4 éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ FeedForwardï¼Œå…¶å®å°±æ˜¯ä¸¤å±‚çº¿æ€§æ˜ å°„å¹¶ç”¨æ¿€æ´»å‡½æ•°æ¿€æ´»ï¼Œæ¯”å¦‚è¯´ $ReLU$</p>
<p>$$X_{hidden} = Linear(ReLU(Linear(X_{attention})))$$</p>
<p>(5). FeedForward æ®‹å·®è¿æ¥ä¸ Layer Normalization</p>
<p>$$X_{hidden} = X_{attention} + X_{hidden}$$
$$X_{hidden} = LayerNorm(X_{hidden})$$</p>
<p>å…¶ä¸­
$$X_{hidden} \in \mathbb{R}^{batch_size * seq_len * embed_dim}$$</p>
<h3 id="5-transformer-decoder-æ•´ä½“ç»“æ„">5. Transformer Decoder æ•´ä½“ç»“æ„</h3>
<p>æˆ‘ä»¬å…ˆä» HighLevel çš„è§’åº¦è§‚å¯Ÿä¸€ä¸‹ Decoder ç»“æ„ï¼Œä»ä¸‹åˆ°ä¸Šä¾æ¬¡æ˜¯ï¼š</p>
<ul>
<li>Masked Multi-Head Self-Attention</li>
<li>Multi-Head Encoder-Decoder Attention</li>
<li>FeedForward Network</li>
</ul>
<p>å’Œ Encoder ä¸€æ ·ï¼Œä¸Šé¢ä¸‰ä¸ªéƒ¨åˆ†çš„æ¯ä¸€ä¸ªéƒ¨åˆ†ï¼Œéƒ½æœ‰ä¸€ä¸ªæ®‹å·®è¿æ¥ï¼Œåæ¥ä¸€ä¸ª Layer Normalizationã€‚Decoder çš„ä¸­é—´éƒ¨ä»¶å¹¶ä¸å¤æ‚ï¼Œå¤§éƒ¨åˆ†åœ¨å‰é¢ Encoder é‡Œæˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†ï¼Œä½†æ˜¯ Decoder ç”±äºå…¶ç‰¹æ®Šçš„åŠŸèƒ½ï¼Œå› æ­¤åœ¨è®­ç»ƒæ—¶ä¼šæ¶‰åŠåˆ°ä¸€äº›ç»†èŠ‚</p>
<p></p>
<p><strong>Masked Self-Attention</strong></p>
<p>å…·ä½“æ¥è¯´ï¼Œä¼ ç»Ÿ Seq2Seq ä¸­ Decoder ä½¿ç”¨çš„æ˜¯ RNN æ¨¡å‹ï¼Œå› æ­¤åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¾“å…¥ $t$ æ—¶åˆ»çš„è¯ï¼Œæ¨¡å‹æ— è®ºå¦‚ä½•ä¹Ÿçœ‹ä¸åˆ°æœªæ¥æ—¶åˆ»çš„è¯ï¼Œå› ä¸ºå¾ªç¯ç¥ç»ç½‘ç»œæ˜¯æ—¶é—´é©±åŠ¨çš„ï¼Œåªæœ‰å½“ $t$ æ—¶åˆ»è¿ç®—ç»“æŸäº†ï¼Œæ‰èƒ½çœ‹åˆ° $t + 1$ æ—¶åˆ»çš„è¯ã€‚è€Œ Transformer Decoder æŠ›å¼ƒäº† RNNï¼Œæ”¹ä¸º Self-Attentionï¼Œç”±æ­¤å°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œ<font color=red>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ•´ä¸ª ground truth éƒ½æš´éœ²åœ¨ Decoder ä¸­</font>ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ Decoder çš„è¾“å…¥è¿›è¡Œä¸€äº›å¤„ç†ï¼Œè¯¥å¤„ç†è¢«ç§°ä¸º Mask
</br>
ä¸¾ä¸ªä¾‹å­ï¼ŒDecoder çš„ ground truth ä¸º &ldquo;<start> I am fine&rdquo;ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå¥å­è¾“å…¥åˆ° Decoder ä¸­ï¼Œç»è¿‡ WordEmbedding å’Œ Positional Encoding ä¹‹åï¼Œå°†å¾—åˆ°çš„çŸ©é˜µåšä¸‰æ¬¡çº¿æ€§å˜æ¢ $(W_Q, W_K, W_V)$ã€‚ç„¶åè¿›è¡Œ self-attention æ“ä½œï¼Œé¦–å…ˆé€šè¿‡å¾—åˆ° Scaled Scoresï¼Œæ¥ä¸‹æ¥éå¸¸å…³é”®ï¼Œæˆ‘ä»¬è¦<strong>å¯¹ Scaled Scores è¿›è¡Œ Mask</strong>ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬è¾“å…¥ &ldquo;I&rdquo; æ—¶ï¼Œæ¨¡å‹ç›®å‰ä»…çŸ¥é“åŒ…æ‹¬ &ldquo;I&rdquo; åœ¨å†…ä¹‹å‰æ‰€æœ‰å­—çš„ä¿¡æ¯ï¼Œå³ &ldquo;<start>&rdquo; å’Œ &ldquo;I&rdquo; çš„ä¿¡æ¯ï¼Œä¸åº”è¯¥è®©å…¶çŸ¥é“ &ldquo;I&rdquo; ä¹‹åè¯çš„ä¿¡æ¯ã€‚é“ç†å¾ˆç®€å•ï¼Œæˆ‘ä»¬åšé¢„æµ‹çš„æ—¶å€™æ˜¯æŒ‰ç…§é¡ºåºä¸€ä¸ªå­—ä¸€ä¸ªå­—çš„é¢„æµ‹ï¼Œæ€ä¹ˆèƒ½è¿™ä¸ªå­—éƒ½æ²¡é¢„æµ‹å®Œï¼Œå°±å·²ç»çŸ¥é“åé¢å­—çš„ä¿¡æ¯äº†å‘¢ï¼ŸMask éå¸¸ç®€å•ï¼Œé¦–å…ˆç”Ÿæˆä¸€ä¸ªä¸‹ä¸‰è§’å…¨ 0ï¼Œä¸Šä¸‰è§’å…¨ä¸ºè´Ÿæ— ç©·çš„çŸ©é˜µï¼Œç„¶åå°†å…¶ä¸ Scaled Scores ç›¸åŠ å³å¯</p>
<p></p>
<p>ä¹‹åå†åš softmaxï¼Œå°±èƒ½å°† - inf å˜ä¸º 0ï¼Œå¾—åˆ°çš„è¿™ä¸ªçŸ©é˜µå³ä¸ºæ¯ä¸ªå­—ä¹‹é—´çš„æƒé‡</p>
<p></p>
<p>Multi-Head Self-Attention æ— éå°±æ˜¯å¹¶è¡Œçš„å¯¹ä¸Šè¿°æ­¥éª¤å¤šåšå‡ æ¬¡ï¼Œå‰é¢ Encoder ä¹Ÿä»‹ç»äº†ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†</p>
<p><strong>Masked Encoder-Decoder Attention</strong></p>
<p>å…¶å®è¿™ä¸€éƒ¨åˆ†çš„è®¡ç®—æµç¨‹å’Œå‰é¢ Masked Self-Attention å¾ˆç›¸ä¼¼ï¼Œç»“æ„ä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯è¿™é‡Œçš„ K, Vä¸º Encoder çš„è¾“å‡ºï¼ŒQ ä¸º Decoder ä¸­ Masked Self-Attention çš„è¾“å‡º</p>
<p></p>
<h3 id="6-æ€»ç»“">6. æ€»ç»“</h3>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼ŒTransformer ä¸­ 95% çš„å†…å®¹å·²ç»ä»‹ç»å®Œäº†ï¼Œæˆ‘ä»¬ç”¨ä¸€å¼ å›¾å±•ç¤ºå…¶å®Œæ•´ç»“æ„ã€‚ä¸å¾—ä¸è¯´ï¼ŒTransformer è®¾è®¡çš„ååˆ†å·§å¤ºå¤©å·¥ã€‚</p>
<p></p>
<p>ä¸‹é¢æœ‰å‡ ä¸ªé—®é¢˜ï¼Œæ˜¯æˆ‘ä»ç½‘ä¸Šæ‰¾çš„ï¼Œæ„Ÿè§‰çœ‹å®Œä¹‹åèƒ½å¯¹ Transformer æœ‰ä¸€ä¸ªæ›´æ·±çš„ç†è§£</p>
<p><font color=red>Transformer ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œ Multi-head Attentionï¼Ÿ</font></p>
<ul>
<li>åŸè®ºæ–‡ä¸­è¯´åˆ°è¿›è¡Œ Multi-head Attention çš„åŸå› æ˜¯å°†æ¨¡å‹åˆ†ä¸ºå¤šä¸ªå¤´ï¼Œå½¢æˆå¤šä¸ªå­ç©ºé—´ï¼Œå¯ä»¥è®©æ¨¡å‹å»å…³æ³¨ä¸åŒæ–¹é¢çš„ä¿¡æ¯ï¼Œæœ€åå†å°†å„ä¸ªæ–¹é¢çš„ä¿¡æ¯ç»¼åˆèµ·æ¥ã€‚å…¶å®ç›´è§‚ä¸Šä¹Ÿå¯ä»¥æƒ³åˆ°ï¼Œå¦‚æœè‡ªå·±è®¾è®¡è¿™æ ·çš„ä¸€ä¸ªæ¨¡å‹ï¼Œå¿…ç„¶ä¹Ÿä¸ä¼šåªåšä¸€æ¬¡ attentionï¼Œå¤šæ¬¡ attention ç»¼åˆçš„ç»“æœè‡³å°‘èƒ½å¤Ÿèµ·åˆ°å¢å¼ºæ¨¡å‹çš„ä½œç”¨ï¼Œä¹Ÿå¯ä»¥ç±»æ¯” CNN ä¸­åŒæ—¶ä½¿ç”¨å¤šä¸ªå·ç§¯æ ¸çš„ä½œç”¨ï¼Œç›´è§‚ä¸Šè®²ï¼Œå¤šå¤´çš„æ³¨æ„åŠ›æœ‰åŠ©äºç½‘ç»œæ•æ‰åˆ°æ›´ä¸°å¯Œçš„ç‰¹å¾ / ä¿¡æ¯</li>
</ul>
<p><font color=red>Transformer ç›¸æ¯”äº RNN/LSTMï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</font></p>
<ul>
<li>RNN ç³»åˆ—çš„æ¨¡å‹ï¼Œæ— æ³•å¹¶è¡Œè®¡ç®—ï¼Œå› ä¸º T æ—¶åˆ»çš„è®¡ç®—ä¾èµ– T-1 æ—¶åˆ»çš„éšå±‚è®¡ç®—ç»“æœï¼Œè€Œ T-1 æ—¶åˆ»çš„è®¡ç®—ä¾èµ– T-2 æ—¶åˆ»çš„éšå±‚è®¡ç®—ç»“æœ</li>
<li>Transformer çš„ç‰¹å¾æŠ½å–èƒ½åŠ›æ¯” RNN ç³»åˆ—çš„æ¨¡å‹è¦å¥½</li>
</ul>
<p><font color=red>ä¸ºä»€ä¹ˆè¯´ Transformer å¯ä»¥ä»£æ›¿ seq2seqï¼Ÿ</font></p>
<ul>
<li>è¿™é‡Œç”¨ä»£æ›¿è¿™ä¸ªè¯ç•¥æ˜¾ä¸å¦¥å½“ï¼Œseq2seq è™½å·²è€ï¼Œä½†å§‹ç»ˆè¿˜æ˜¯æœ‰å…¶ç”¨æ­¦ä¹‹åœ°ï¼Œseq2seq æœ€å¤§çš„é—®é¢˜åœ¨äº<strong>å°†Encoderç«¯çš„æ‰€æœ‰ä¿¡æ¯å‹ç¼©åˆ°ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å‘é‡ä¸­</strong>ï¼Œå¹¶å°†å…¶ä½œä¸º Decoder ç«¯é¦–ä¸ªéšè—çŠ¶æ€çš„è¾“å…¥ï¼Œæ¥é¢„æµ‹ Decoder ç«¯ç¬¬ä¸€ä¸ªå•è¯ (token) çš„éšè—çŠ¶æ€ã€‚åœ¨è¾“å…¥åºåˆ—æ¯”è¾ƒé•¿çš„æ—¶å€™ï¼Œè¿™æ ·åšæ˜¾ç„¶ä¼šæŸå¤± Encoder ç«¯çš„å¾ˆå¤šä¿¡æ¯ï¼Œè€Œä¸”è¿™æ ·ä¸€è‚¡è„‘çš„æŠŠè¯¥å›ºå®šå‘é‡é€å…¥ Decoder ç«¯ï¼ŒDecoder ç«¯ä¸èƒ½å¤Ÿå…³æ³¨åˆ°å…¶æƒ³è¦å…³æ³¨çš„ä¿¡æ¯ã€‚</li>
<li>Transformer ä¸ä½†å¯¹ seq2seq æ¨¡å‹è¿™ä¸¤ç‚¹ç¼ºç‚¹æœ‰äº†å®è´¨æ€§çš„æ”¹è¿› (å¤šå¤´äº¤äº’å¼ attention æ¨¡å—)ï¼Œè€Œä¸”è¿˜å¼•å…¥äº† self-attention æ¨¡å—ï¼Œè®©æºåºåˆ—å’Œç›®æ ‡åºåˆ—é¦–å…ˆ â€œè‡ªå…³è”â€ èµ·æ¥ï¼Œè¿™æ ·çš„è¯ï¼Œæºåºåˆ—å’Œç›®æ ‡åºåˆ—è‡ªèº«çš„ embedding è¡¨ç¤ºæ‰€è•´å«çš„ä¿¡æ¯æ›´åŠ ä¸°å¯Œï¼Œè€Œä¸”åç»­çš„ FFN å±‚ä¹Ÿå¢å¼ºäº†æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ï¼Œå¹¶ä¸” Transformer å¹¶è¡Œè®¡ç®—çš„èƒ½åŠ›è¿œè¿œè¶…è¿‡äº† seq2seq ç³»åˆ—æ¨¡å‹</li>
</ul>
<h3 id="7-å‚è€ƒæ–‡ç« ">7. å‚è€ƒæ–‡ç« </h3>
<ul>
<li><a href="http://mantchs.com/2019/09/26/NLP/Transformer/"target="_blank" rel="external nofollow noopener noreferrer">Transformer<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
<li><a href="http://jalammar.github.io/illustrated-transformer/"target="_blank" rel="external nofollow noopener noreferrer">The Illustrated Transformer<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
<li><a href="http://www.peterbloem.nl/blog/transformers"target="_blank" rel="external nofollow noopener noreferrer">TRANSFORMERS FROM SCRATCH<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
<li><a href="https://medium.com/@bgg/seq2seq-pay-attention-to-self-attention-part-2-%E4%B8%AD%E6%96%87%E7%89%88-ef2ddf8597a4"target="_blank" rel="external nofollow noopener noreferrer">Seq2seq pay Attention to Self Attention: Part 2<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
</ul>
<p>ref:</br>
[1]. <a href="https://www.bilibili.com/video/BV1mk4y1q7eK?p=1"target="_blank" rel="external nofollow noopener noreferrer">Bç«™è®²è§£è§†é¢‘<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[2]. <a href="https://wmathor.com/index.php/archives/1438/"target="_blank" rel="external nofollow noopener noreferrer">https://wmathor.com/index.php/archives/1438/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[3]. <a href="https://wmathor.com/index.php/archives/1455/"target="_blank" rel="external nofollow noopener noreferrer">Transformerçš„pytorchå®ç°<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></p>
]]></description></item><item><title>Effective STL [26] | å°½é‡ç”¨iteratorä»£æ›¿const_iteratorï¼Œreverse_iteratorå’Œconst_reverse_iterator</title><link>https://jianye0428.github.io/posts/clause_26/</link><pubDate>Wed, 16 Aug 2023 19:06:25 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_26/</guid><description><![CDATA[<h2 id="4ç§è¿­ä»£å™¨">4ç§è¿­ä»£å™¨</h2>
<p>æ¯ä¸ªæ ‡å‡†å®¹å™¨ç±»éƒ½æä¾›4ç§è¿­ä»£å™¨ç±»å‹:<code>iterator</code>,<code>const_iterator</code>ï¼Œ<code>reverse_iterator</code>å’Œ<code>const_reverse_iterator</code></p>
<p>å¯¹äº<code>container&lt;T&gt;</code>è€Œè¨€ï¼Œ<code>iterator</code>çš„ä½œç”¨ç›¸å½“äº<code>T*</code>ï¼Œè€Œ<code>const_iterator</code>åˆ™ç›¸å½“äº<code>const T*</code>ã€‚</p>
<p>å¢åŠ ä¸€ä¸ª<code>iterator</code>æˆ–è€…<code>const_iterator</code>å¯ä»¥åœ¨ä¸€ä¸ªä»å®¹å™¨å¼€å¤´è¶‹å‘å°¾éƒ¨çš„éå†ä¸­è®©ä½ ç§»åŠ¨åˆ°å®¹å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p><code>reverse_iterator</code>ä¸<code>const_reverse_iterator</code>åŒæ ·ç›¸å½“äºå¯¹åº”çš„<code>T</code>å’Œ<code>const T</code>ï¼Œæ‰€ä¸åŒçš„æ˜¯ï¼Œå¢åŠ <code>reverse_iterator</code>æˆ–è€…<code>const_reverse_iterator</code>ä¼šåœ¨ä»å°¾åˆ°å¤´çš„éå†ä¸­è®©ä½ ç§»åŠ¨åˆ°å®¹å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p>
<h2 id="vectortçš„insertå’Œeraseçš„æ ·å¼">vector<T>çš„insertå’Œeraseçš„æ ·å¼</h2>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">iterator</span> <span class="nf">insert</span><span class="p">(</span><span class="n">iterator</span> <span class="n">position</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">iterator</span> <span class="nf">erase</span><span class="p">(</span><span class="n">iterator</span> <span class="n">position</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">iterator</span> <span class="nf">erase</span><span class="p">(</span><span class="n">iterator</span> <span class="n">rangeBegin</span><span class="p">,</span> <span class="n">iterator</span> <span class="n">rangeEnd</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™äº›æ–¹æ³•åªæ¥å—<code>iterator</code>ç±»å‹çš„å‚æ•°ï¼Œè€Œä¸æ˜¯<code>const_iterator</code>ã€<code>reverse_iterator</code>æˆ–<code>const_reverse_iterator</code>ã€‚æ€»æ˜¯<code>iterator</code>ã€‚</p>
<h2 id="è¿­ä»£å™¨ä¹‹é—´å­˜åœ¨çš„è½¬æ¢å…³ç³»">è¿­ä»£å™¨ä¹‹é—´å­˜åœ¨çš„è½¬æ¢å…³ç³»</h2>
<p></p>
<p>å›¾ä¸­æ˜¾ç¤ºäº†ä»<code>iterator</code>åˆ°<code>const_iterator</code>ã€ä»<code>iterator</code>åˆ°<code>reverse_iterator</code>å’Œä»<code>reverse_iterator</code>åˆ°<code>const_reverse_iterator</code>å¯ä»¥è¿›è¡Œéšå¼è½¬æ¢ã€‚</p>
<p>å¹¶ä¸”ï¼Œ<code>reverse_iterator</code>å¯ä»¥é€šè¿‡è°ƒç”¨å…¶<code>baseæˆå‘˜å‡½æ•°</code>è½¬æ¢ä¸º<code>iterator</code>ã€‚<code>const_reverse_iterator</code>ä¹Ÿå¯ä»¥ç±»ä¼¼åœ°é€šè¿‡<code>base</code>è½¬æ¢æˆä¸º<code>const_iterator</code>ã€‚</p>
<p>é€šè¿‡baseå¾—åˆ°çš„ä¹Ÿè®¸å¹¶éä½ æ‰€æœŸå¾…çš„iteratorã€‚</p>
<p>è€Œä¸”ï¼Œ<strong>æ²¡æœ‰åŠæ³•ä»ä¸€ä¸ªconst_iteratorè½¬æ¢å¾—åˆ°ä¸€ä¸ªiteratorï¼Œä¹Ÿæ— æ³•ä»const_reverse_iteratorå¾—åˆ°reverse_iterator</strong>ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“ä½ éœ€è¦æŒ‡å‡ºæ’å…¥ä½ç½®æˆ–åˆ é™¤çš„å…ƒç´ æ—¶ï¼Œconstè¿­ä»£å™¨å‡ ä¹æ²¡æœ‰ç”¨ã€‚</p>
<h2 id="å°½é‡ä½¿ç”¨iteratorå–ä»£constæˆ–è€…reverseç±»å‹çš„è¿­ä»£å™¨">å°½é‡ä½¿ç”¨iteratorå–ä»£constæˆ–è€…reverseç±»å‹çš„è¿­ä»£å™¨</h2>
<ol>
<li>
<p><code>insert</code>å’Œ<code>erase</code>çš„ä¸€äº›ç‰ˆæœ¬è¦æ±‚<code>iterator</code>ã€‚å¦‚æœä½ éœ€è¦è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œä½ å°±å¿…é¡»äº§ç”Ÿ<code>iterator</code>ï¼Œè€Œä¸èƒ½ç”¨<code>const</code>æˆ–<code>reverse iterators</code>ã€‚</p>
</li>
<li>
<p>ä¸å¯èƒ½æŠŠ<code>const_iterator</code>éšå¼è½¬æ¢æˆ<code>iterator</code>ã€‚ä»ä¸€ä¸ª<code>const_iterator</code>äº§ç”Ÿä¸€ä¸ª<code>iterator</code>çš„æŠ€æœ¯å¹¶ä¸æ™®éé€‚ç”¨ï¼Œè€Œä¸”ä¸ä¿è¯é«˜æ•ˆã€‚</p>
</li>
<li>
<p>ä»<code>reverse_iterator</code>è½¬æ¢è€Œæ¥çš„<code>iterator</code>åœ¨è½¬æ¢ä¹‹åå¯èƒ½éœ€è¦ç›¸åº”çš„è°ƒæ•´ã€‚</p>
</li>
</ol>
<p><code>iterator</code>ä¸<code>reverse_iterator</code>ä¹‹é—´çš„é€‰æ‹©æ˜¾è€Œæ˜“è§â€”â€”ä¾èµ–äºä»å‰åˆ°åæˆ–ä»ååˆ°å‰çš„éå†ã€‚</p>
<p><strong>è¿­ä»£å™¨æ¯”è¾ƒ</strong></p>
<p>å½“åœ¨<code>iterator</code>å’Œ<code>const_iterator</code>ä¹‹é—´ä½œé€‰æ‹©çš„æ—¶å€™ï¼Œä½ æœ‰æ›´å……åˆ†çš„ç†ç”±é€‰æ‹©<code>iterator</code>ï¼Œå³ä½¿<code>const_iterator</code>åŒæ ·å¯è¡Œè€Œä¸”å³ä½¿ä½ å¹¶ä¸éœ€è¦è°ƒç”¨å®¹å™¨ç±»çš„ä»»ä½•æˆå‘˜å‡½æ•°ã€‚å…¶ä¸­çš„ä»¤äººè®¨åŒçš„åŸå› åŒ…æ‹¬<code>iterator</code>ä¸<code>const_iterator</code>ä¹‹é—´çš„æ¯”è¾ƒï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">IntDeque</span><span class="p">;</span> <span class="c1">// typedefå¯ä»¥æå¤§åœ°ç®€åŒ–STLå®¹å™¨ç±»å’Œiteratorçš„æ“ä½œã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">iterator</span> <span class="n">Iter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">ConstIter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Iter</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ConstIter</span> <span class="n">ci</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// åŒä¸€ä¸ªå®¹å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">ci</span><span class="p">)</span> <span class="p">...</span> <span class="c1">// æ¯”è¾ƒiteratorå’Œconst_iterator
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å”¯ä¸€çš„å˜åŒ–æ˜¯ç­‰å·çš„ä¸€è¾¹çš„ç±»å‹æ˜¯<code>iterator</code>ï¼Œè€Œå¦ä¸€è¾¹çš„ç±»å‹æ˜¯<code>const_iterator</code>ã€‚</p>
<p><strong>å› ä¸º<code>iterator</code>åº”è¯¥åœ¨æ¯”è¾ƒä¹‹å‰éšå¼çš„è½¬æ¢æˆ<code>const_iterator</code>ï¼ŒçœŸæ­£çš„æ¯”è¾ƒåº”è¯¥åœ¨ä¸¤ä¸ª<code>const_iterator</code>ä¹‹é—´è¿›è¡Œã€‚</strong></p>
<p><strong>å¦‚æœä¸€äº›å®ç°å°†<code>const_iterator</code>çš„<code>operator==</code>ä½œä¸º<code>const_iterator</code>çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°è€Œä¸æ˜¯éæˆå‘˜å‡½æ•°ã€‚</strong></p>
<p>è€Œé—®é¢˜çš„è§£å†³ä¹‹é“æ˜¾å¾—éå¸¸æœ‰è¶£ï¼šåªè¦åƒè¿™æ ·äº¤æ¢ä¸¤ä¸ª<code>iterator</code>çš„ä½ç½®ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">ci</span> <span class="o">==</span> <span class="n">i</span><span class="p">)...</span> <span class="c1">// å½“ä¸Šé¢æ¯”è¾ƒæ— æ³•é€šè¿‡ç¼–è¯‘æ—¶çš„è§£å†³æ–¹æ³•
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è¿­ä»£å™¨æ··ç”¨</strong></p>
<p>ä¸ä»…æ˜¯æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ï¼Œåªè¦ä½ åœ¨åŒä¸€ä¸ªè¡¨è¾¾å¼ä¸­æ··ç”¨<code>iterator</code>å’Œ<code>const_iterator</code>ï¼ˆæˆ–è€…<code>reverse_iterator</code>å’Œ<code>const_reverse_iterator</code>ï¼‰ï¼Œè¿™æ ·çš„é—®é¢˜å°±å¯èƒ½ä¼šå‡ºç°:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">ci</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">...</span> <span class="c1">// å¦‚æœiä¸ciä¹‹é—´è‡³å°‘æœ‰ä¸‰ä¸ªå…ƒç´ ...
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè¿­ä»£å™¨çš„ç±»å‹ä¸åŒï¼Œä½ çš„æ­£ç¡®çš„ä»£ç å¯èƒ½ä¼šè¢«é”™è¯¯åœ°æ‹’ç»ã€‚</p>
<p>æœ¬ä¾‹ä¸­æœ€ç®€å•çš„è§£å†³æ–¹æ³•æ˜¯<strong>é€šè¿‡ä¸€ä¸ªï¼ˆå®‰å…¨çš„ï¼‰æ˜ å°„æŠŠiteratorè½¬æ¢ä¸ºconst_iterator</strong>:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">ConstIter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">ci</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">...</span> <span class="c1">// å½“ä¸Šé¢çš„ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘æ—¶çš„è§£å†³æ–¹æ³•
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é¿å…è¿™ç±»é—®é¢˜çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯å‡å°‘æ··ç”¨ä¸åŒç±»å‹çš„è¿­ä»£å™¨çš„æœºä¼šã€‚</strong></p>
]]></description></item><item><title>Effective STL [27] | ç”¨distanceå’ŒadvanceæŠŠconst_iteratorè½¬åŒ–æˆiterator</title><link>https://jianye0428.github.io/posts/clause_27/</link><pubDate>Thu, 17 Aug 2023 07:54:00 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_27/</guid><description><![CDATA[<h2 id="æŠŠconst_iteratorè½¬åŒ–ä¸ºiterator">æŠŠconst_iteratorè½¬åŒ–ä¸ºiterator</h2>
<p>æœ‰äº›å®¹å™¨æˆå‘˜å‡½æ•°åªæ¥å—iteratorä½œä¸ºå‚æ•°ï¼Œè€Œä¸æ˜¯const_iteratorã€‚å¦‚æœä½ åªæœ‰ä¸€ä¸ªconst_iteratorï¼Œè¦åœ¨å®ƒæ‰€æŒ‡å‘çš„å®¹å™¨ä½ç½®ä¸Šæ’å…¥æ–°å…ƒç´ å‘¢ï¼Ÿ</p>
<p>ä¸Šä¸€æ¡æ¬¾è¯´å¹¶ä¸å­˜åœ¨ä»const_iteratoråˆ°iteratorä¹‹é—´çš„éšå¼è½¬æ¢ï¼Œé‚£è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>çœ‹çœ‹å½“ä½ æŠŠä¸€ä¸ªconst_iteratoræ˜ å°„ä¸ºiteratoræ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">IntDeque</span><span class="p">;</span> <span class="c1">// æ–¹ä¾¿çš„typedef
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">iterator</span> <span class="n">Iter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">ConstIter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ConstIter</span> <span class="n">ci</span><span class="p">;</span> <span class="c1">// ciæ˜¯const_iterator
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">Iter</span> <span class="n">i</span><span class="p">(</span><span class="n">ci</span><span class="p">);</span> <span class="c1">// é”™è¯¯ï¼æ²¡æœ‰ä»const_iterator åˆ°iteratoréšå¼è½¬æ¢çš„é€”å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Iter</span> <span class="nf">i</span><span class="p">(</span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">Iter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ci</span><span class="p">));</span> <span class="c1">// ä»æ˜¯ä¸ªé”™è¯¯ï¼ä¸èƒ½ä»const_iterator æ˜ å°„ä¸ºiteratorï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œåªæ˜¯ä»¥dequeä¸ºä¾‹ï¼Œä½†æ˜¯ç”¨å…¶å®ƒå®¹å™¨ç±»â€”â€”listã€setã€multisetã€mapã€multimapç”šè‡³æ¡æ¬¾25æè¿°çš„æ•£åˆ—è¡¨å®¹å™¨â€”â€”çš„ç»“æœä¸€æ ·ã€‚ä½¿ç”¨æ˜ å°„çš„è¡Œä¹Ÿè®¸åœ¨vectoræˆ–stringçš„ä»£ç æ—¶èƒ½å¤Ÿç¼–è¯‘ï¼Œä½†è¿™æ˜¯æˆ‘ä»¬é©¬ä¸Šè¦è®¨è®ºçš„éå¸¸ç‰¹æ®Šçš„æƒ…å½¢ã€‚</p>
<p>ä¸Šè¿°ä»£ç ä¸èƒ½é€šè¿‡ç¼–è¯‘çš„åŸå› åœ¨äºï¼Œå¯¹äºè¿™äº›å®¹å™¨è€Œè¨€ï¼Œ<font color=red>iteratorå’Œconst_iteratoræ˜¯å®Œå…¨ä¸åŒçš„ç±»ã€‚</font></p>
<p>åœ¨ä¸¤ä¸ªæ¯«æ— å…³è”çš„ç±»ä¹‹é—´è¿›è¡Œ<code>const_cast</code>æ˜ å°„æ˜¯è’è°¬çš„ï¼Œæ‰€ä»¥<code>reinterpret_cast</code>ã€<code>static_cast</code>ç”šè‡³Cé£æ ¼çš„æ˜ å°„ä¹Ÿä¼šå¯¼è‡´åŒæ ·çš„ç»“æœã€‚</p>
<p><strong>ä¸èƒ½ç¼–è¯‘çš„ä»£ç å¯¹äºvectorå’Œstringå®¹å™¨æ¥è¯´ä¹Ÿè®¸èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘</strong></p>
<p>é‚£æ˜¯å› ä¸ºé€šå¸¸æƒ…å†µä¸‹å¤§å¤šæ•°å®ç°éƒ½ä¼šé‡‡ç”¨çœŸå®çš„æŒ‡é’ˆä½œä¸ºé‚£äº›å®¹å™¨çš„è¿­ä»£å™¨ã€‚</p>
<p>å°±è¿™ç§å®ç°è€Œè¨€ï¼Œ<code>vector&lt;T&gt;::iterator</code>æ˜¯<code>T*</code>çš„<code>typedef</code>ï¼Œè€Œ<code>vector&lt;T&gt;::const_iterator</code>æ˜¯<code>const T*</code>çš„<code>typedef</code>ï¼Œ<code>string::iterator</code>æ˜¯<code>char</code>çš„<code>typedef</code>ï¼Œè€Œ<code>string::const_iterator</code>æ˜¯<code>const char*</code>çš„<code>typedef</code>ã€‚</p>
<p>åœ¨è¿™ç§å®ç°çš„æƒ…å†µä¸‹ï¼Œç”¨<code>const_cast</code>æŠŠ<code>const_iterator</code>æ˜ å°„æˆ<code>iterator</code>å½“ç„¶å¯ä»¥ç¼–è¯‘è€Œä¸”æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸º<code>const_iterator</code>ä¸<code>iterator</code>ä¹‹é—´çš„<code>const_cast</code>æ˜ å°„è¢«æœ€ç»ˆè§£é‡Šæˆ<code>const T*</code>åˆ°<code>T*</code>çš„æ˜ å°„ã€‚ä½†æ˜¯ï¼Œå³ä½¿æ˜¯åœ¨è¿™ç§å®ç°ä¸­ï¼Œ<code>reverse_iterator</code>å’Œ<code>const_reverse_iterator</code>ä¹Ÿæ˜¯çœŸæ­£çš„ç±»ï¼Œæ‰€ä»¥ä½ ä»ç„¶ä¸èƒ½ç›´æ¥ç”¨<code>const_cast</code>æŠŠ<code>const_reverse_iterator</code>æ˜ å°„æˆ<code>reverse_iterator</code>ã€‚</p>
<p>è€Œä¸”è¿™äº›å®ç°é€šå¸¸åªä¼šåœ¨Releaseæ¨¡å¼æ—¶æ‰ä½¿ç”¨æŒ‡é’ˆè¡¨ç¤ºvectorå’Œstringçš„è¿­ä»£å™¨ã€‚</p>
<p>æ‰€æœ‰è¿™äº›äº‹å®è¡¨æ˜ï¼ŒæŠŠconstè¿­ä»£å™¨æ˜ å°„ä¸ºè¿­ä»£å™¨æ˜¯ç—…æ€çš„ï¼Œå³ä½¿æ˜¯å¯¹vectorå’Œstringæ¥è¯´ä¹Ÿæ—¶ï¼Œå› ä¸ºç§»æ¤æ€§å¾ˆå€¼å¾—æ€€ç–‘ã€‚</p>
<h2 id="const_iteratorè½¬æ¢ä¸ºiterator">const_iteratorè½¬æ¢ä¸ºiterator</h2>
<p>æœ‰ä¸€ç§å®‰å…¨çš„ã€å¯ç§»æ¤çš„æ–¹æ³•è·å–å®ƒæ‰€å¯¹åº”çš„iteratorï¼Œè€Œä¸”ï¼Œç”¨ä¸ç€é™·å…¥ç±»å‹ç³»ç»Ÿçš„è½¬æ¢ã€‚</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;deque&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">IntDeque</span><span class="p">;</span> <span class="c1">// å’Œä»¥å‰ä¸€æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">iterator</span> <span class="n">Iter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">ConstIter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">IntDeque</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ConstIter</span> <span class="n">ci</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// è®©ciæŒ‡å‘d
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Iter</span> <span class="n">i</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span> <span class="c1">// åˆå§‹åŒ–iä¸ºd.begin()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">advance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ci</span><span class="p">));</span> <span class="c1">// æŠŠiç§»åˆ°æŒ‡å‘ciä½ç½®ï¼ˆä½†è¯·ç•™æ„ä¸‹é¢å…³äºä¸ºä»€ä¹ˆåœ¨å®ƒç¼–è¯‘å‰è¦è°ƒæ•´çš„åŸå› ï¼‰
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦å¾—åˆ°ä¸const_iteratoræŒ‡å‘åŒä¸€ä½ç½®çš„iterator:</p>
<ol>
<li>å°†iteratoræŒ‡å‘å®¹å™¨çš„èµ·å§‹ä½ç½®ï¼Œ</li>
<li>æŠŠå®ƒå‘å‰ç§»åˆ°å’Œconst_iteratorè·ç¦»å®¹å™¨èµ·å§‹ä½ç½®çš„åç§»é‡ä¸€æ ·çš„ä½ç½®å³å¯</li>
</ol>
<p>è¿™ä¸ªä»»åŠ¡å¾—åˆ°äº†ä¸¤ä¸ªå‡½æ•°æ¨¡æ¿advanceå’Œdistanceçš„å¸®åŠ©ï¼Œå®ƒä»¬éƒ½åœ¨<iterator>ä¸­å£°æ˜:</p>
<ul>
<li>distanceè¿”å›ä¸¤ä¸ªæŒ‡å‘åŒä¸€ä¸ªå®¹å™¨çš„iteratorä¹‹é—´çš„è·ç¦»ï¼›</li>
<li>advanceåˆ™ç”¨äºå°†ä¸€ä¸ªiteratorç§»åŠ¨æŒ‡å®šçš„è·ç¦»ã€‚</li>
</ul>
<p>å¦‚æœ<code>i</code>å’Œ<code>ci</code>æŒ‡å‘åŒä¸€ä¸ªå®¹å™¨ï¼Œé‚£ä¹ˆè¡¨è¾¾å¼<code>advance(i, distance(i, ci))</code>ä¼šå°†<code>i</code>ç§»åŠ¨åˆ°ä¸<code>ci</code>ç›¸åŒçš„ä½ç½®ä¸Šã€‚</p>
<p>ä¸Šè¿°ä»£ç ç¼–è¯‘å­˜åœ¨é—®é¢˜ã€‚</p>
<p>å…ˆæ¥çœ‹çœ‹distanceçš„å®šä¹‰ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">_InputIterator</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">inline</span> <span class="n">_GLIBCXX17_CONSTEXPR</span>
</span></span><span class="line"><span class="cl">  <span class="k">typename</span> <span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">_InputIterator</span><span class="o">&gt;::</span><span class="n">difference_type</span>
</span></span><span class="line"><span class="cl">  <span class="n">distance</span><span class="p">(</span><span class="n">_InputIterator</span> <span class="n">__first</span><span class="p">,</span> <span class="n">_InputIterator</span> <span class="n">__last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// concept requirements -- taken care of in __distance
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">__distance</span><span class="p">(</span><span class="n">__first</span><span class="p">,</span> <span class="n">__last</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">__iterator_category</span><span class="p">(</span><span class="n">__first</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å½“é‡åˆ°<code>distance</code>è°ƒç”¨æ—¶ï¼Œä½ çš„ç¼–è¯‘å™¨éœ€è¦æ ¹æ®ä½¿ç”¨çš„å®å‚ç±»å‹æ¨æ–­å‡º<code>InputIterator</code>çš„ç±»å‹ã€‚</p>
<p>å†æ¥çœ‹çœ‹æˆ‘æ‰€è¯´çš„ä¸å¤ªæ­£ç¡®çš„<code>distance</code>è°ƒç”¨:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">advance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ci</span><span class="p">));</span> <span class="c1">// è°ƒæ•´iï¼ŒæŒ‡å‘ciä½ç½®
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰ä¸¤ä¸ªå‚æ•°ä¼ é€’ç»™distanceï¼Œiå’Œciã€‚içš„ç±»å‹æ˜¯Iterï¼Œå³<code>deque&lt;int&gt;::iterator</code>çš„typedefã€‚</p>
<p>å¯¹ç¼–è¯‘å™¨æ¥è¯´ï¼Œè¿™è¡¨æ˜è°ƒç”¨<code>distance</code>çš„<code>InputIterator</code>æ˜¯<code>deque::iterator</code>ã€‚ä½†<code>ci</code>æ˜¯<code>ConstIter</code>ï¼Œå³<code>deque::const_iterator</code>çš„<code>typedef</code>ã€‚</p>
<p>è¡¨æ˜é‚£ä¸ª<code>InputIterator</code>æ˜¯<code>deque&lt;int&gt;::const_iterator</code>ã€‚</p>
<p><code>InputIterator</code>ä¸å¯èƒ½åŒæ—¶æœ‰ä¸¤ç§ä¸åŒçš„ç±»å‹ï¼Œæ‰€ä»¥è°ƒç”¨<code>distance</code>å¤±è´¥ã€‚</p>
<p>ä¸€èˆ¬ä¼šé€ æˆä¸€äº›å†—é•¿çš„å‡ºé”™ä¿¡æ¯ï¼Œå¯èƒ½ä¼šä¹Ÿå¯èƒ½ä¸ä¼šè¯´æ˜æ˜¯ç¼–è¯‘å™¨æ— æ³•å¾—å‡º<code>InputIterator</code>æ˜¯ä»€ä¹ˆç±»å‹ã€‚</p>
<p>è¦é¡ºåˆ©åœ°è°ƒç”¨<code>distance</code>ï¼Œä½ éœ€è¦æ’é™¤æ­§ä¹‰ã€‚</p>
<p>æœ€ç®€å•çš„åŠæ³•å°±æ˜¯æ˜¾å¼çš„æŒ‡æ˜<code>distance</code>è°ƒç”¨çš„æ¨¡æ¿å‚æ•°ç±»å‹ï¼Œä»è€Œé¿å…ç¼–è¯‘å™¨è‡ªå·±å¾—å‡ºå®ƒä»¬çš„ç±»å‹:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">advance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">distance</span><span class="o">&lt;</span><span class="n">ConstIter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ci</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ç°åœ¨çŸ¥é“äº†æ€ä¹ˆé€šè¿‡<code>advance</code>å’Œ<code>distance</code>è·å–<code>const_iterator</code>ç›¸åº”çš„<code>iterator</code>äº†ã€‚</p>
<p><strong>æ•ˆç‡å¦‚ä½•ï¼Ÿ</strong></p>
<p>ç­”æ¡ˆå¾ˆç®€å•ã€‚<strong>å–å†³äºä½ æ‰€è½¬æ¢çš„ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ ·çš„è¿­ä»£å™¨ã€‚</strong></p>
<p>å¯¹äº<strong>éšæœºè®¿é—®çš„è¿­ä»£å™¨</strong>ï¼ˆæ¯”å¦‚<code>vector</code>ã€<code>string</code>å’Œ<code>deque</code>çš„ï¼‰è€Œè¨€ï¼Œè¿™æ˜¯<strong>å¸¸æ•°æ—¶é—´</strong>çš„æ“ä½œã€‚</p>
<p>å¯¹äº<strong>åŒå‘è¿­ä»£å™¨</strong>ï¼ˆä¹Ÿå°±æ˜¯ï¼Œæ‰€æœ‰å…¶å®ƒå®¹å™¨å’ŒåŒ…æ‹¬æ•£åˆ—å®¹å™¨çš„ä¸€äº›å®ç°ï¼‰è€Œè¨€ï¼Œè¿™æ˜¯<strong>çº¿æ€§æ—¶é—´</strong>çš„æ“ä½œã€‚</p>
<p>å› ä¸ºå®ƒå¯èƒ½èŠ±è´¹çº¿æ€§æ—¶é—´çš„ä»£ä»·æ¥äº§ç”Ÿä¸€ä¸ªå’Œ<code>const_iterator</code>ç­‰ä»·çš„<code>iterator</code>ï¼Œå¹¶ä¸”å› ä¸ºå¦‚æœä¸èƒ½è®¿é—®<code>const_iterator</code>æ‰€å±çš„å®¹å™¨è¿™ä¸ªæ“ä½œå°±æ— æ³•å®Œæˆã€‚</p>
<p>ä»è¿™ä¸ªè§’åº¦å‡ºå‘ï¼Œä¹Ÿè®¸ä½ éœ€è¦é‡æ–°å®¡è§†ä½ ä»<code>const_iterator</code>äº§ç”Ÿ<code>iterator</code>çš„è®¾è®¡ã€‚</p>
<p>å½“å¤„ç†å®¹å™¨æ—¶å°½é‡ç”¨<code>iterator</code>ä»£æ›¿<code>const</code>å’Œ<code>reverse</code>è¿­ä»£å™¨ã€‚</p>
]]></description></item><item><title>Effective STL [25] | ç†Ÿæ‚‰éæ ‡å‡†æ•£åˆ—å®¹å™¨</title><link>https://jianye0428.github.io/posts/clause_25/</link><pubDate>Wed, 16 Aug 2023 08:21:08 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_25/</guid><description><![CDATA[<p><strong>STLæ²¡æœ‰æ•£åˆ—è¡¨ã€‚</strong></p>
<p>å…¼å®¹STLçš„æ•£åˆ—å…³è”å®¹å™¨å¯ä»¥ä»å¤šä¸ªæ¥æºè·å¾—ï¼Œè€Œä¸”å®ƒä»¬ç”šè‡³æœ‰äº‹å®ä¸Šçš„æ ‡å‡†åå­—ï¼š<code>hash_set</code>ã€<code>hash_multiset</code>ã€<code>hash_map</code>å’Œ<code>hash_multimap</code>ã€‚åœ¨C++æ ‡å‡†å§”å‘˜ä¼šçš„è®®æ¡ˆä¸­ï¼Œæ•£åˆ—å®¹å™¨çš„åå­—æ˜¯<code>unordered_set</code>ã€ <code>unordered_multiset</code>ã€<code>unordered_map</code>å’Œ<code>unordered_multimap</code>ã€‚</p>
<p><strong>å®ƒä»¬åœ¨æ¥å£ã€èƒ½åŠ›ã€å†…åœ¨æ•°æ®ç»“æ„å’Œæ”¯æŒæ“ä½œçš„ç›¸å…³æ•ˆç‡æ–¹é¢ä¸åŒã€‚</strong></p>
<p>æœ€å¸¸è§çš„ä¸¤ä¸ªæ¥è‡ª<code>SGI</code>å’Œ<code>Dinkumware</code>ï¼Œ<code>STLport</code>ä¹Ÿæä¾›æ•£åˆ—å®¹å™¨ï¼Œä½†æ˜¯<code>STLport</code>çš„æ•£åˆ—å®¹å™¨æ˜¯åŸºäºæ¥è‡ª<code>SGI</code>çš„ã€‚</p>
<p>æ•£åˆ—å®¹å™¨æ˜¯å…³è”å®¹å™¨ï¼Œå®ƒä»¬éœ€è¦çŸ¥é“å‚¨å­˜åœ¨å®¹å™¨ä¸­çš„å¯¹è±¡ç±»å‹ï¼Œç”¨äºè¿™äº›å¯¹è±¡çš„æ¯”è¾ƒå‡½æ•°ï¼Œä»¥åŠç”¨äºè¿™äº›å¯¹è±¡çš„åˆ†é…å™¨ã€‚</p>
<h2 id="æ•£åˆ—å®¹å™¨å£°æ˜">æ•£åˆ—å®¹å™¨å£°æ˜</h2>
<p>æ•£åˆ—å®¹å™¨éœ€è¦æ•£åˆ—å‡½æ•°çš„è¯´æ˜ã€‚ä¸‹é¢æ˜¯æ•£åˆ—å®¹å™¨å£°æ˜ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">HashFunction</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">CompareFunction</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">Allocator</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">hash_container</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™éå¸¸æ¥è¿‘äºæ•£åˆ—å®¹å™¨çš„SGIå£°æ˜ï¼Œä¸»è¦å·®åˆ«æ˜¯SGIä¸ºHashFunctionå’ŒCompareFunctionæä¾›äº†é»˜è®¤ç±»å‹ã€‚</p>
<p><strong>SGI è®¾è®¡ä¸¾ä¾‹</strong></p>
<p><code>hash_set</code>çš„SGIå£°æ˜çœ‹èµ·æ¥åŸºæœ¬ä¸Šåƒè¿™æ ·ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">HashFunction</span> <span class="o">=</span> <span class="n">hash</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">CompareFunction</span> <span class="o">=</span> <span class="n">equa_to</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">Allocator</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">hash_set</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>SGI</code>è®¾è®¡çš„ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ–¹é¢æ˜¯ä½¿ç”¨<code>equal_to</code>ä½œä¸ºé»˜è®¤æ¯”è¾ƒå‡½æ•°ã€‚<strong>è¿™è¿èƒŒæ ‡å‡†å…³è”å®¹å™¨çš„çº¦å®šâ€”â€”é»˜è®¤æ¯”è¾ƒå‡½æ•°æ˜¯lessã€‚</strong></p>
<p><code>SGI</code>çš„æ•£åˆ—å®¹å™¨ç¡®å®šåœ¨ä¸€ä¸ªæ•£åˆ—å®¹å™¨ä¸­çš„ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æœ‰ç›¸åŒçš„å€¼æ˜¯é€šè¿‡ç›¸ç­‰æµ‹è¯•ï¼Œè€Œä¸æ˜¯ç­‰ä»·ã€‚</p>
<p>å› ä¸ºæ•£åˆ—å…³è”å®¹å™¨ï¼Œä¸åƒå®ƒä»¬åœ¨æ ‡å‡†ä¸­çš„ï¼ˆé€šå¸¸åŸºäºæ ‘ï¼‰å…„å¼Ÿï¼Œä¸éœ€è¦ä¿æŒæœ‰åºã€‚</p>
<p><strong>Dinkumware è®¾è®¡ä¸¾ä¾‹</strong></p>
<p>Dinkumwareè®¾è®¡çš„æ•£åˆ—å®¹å™¨é‡‡å–ä¸€äº›ä¸åŒçš„ç­–ç•¥ã€‚å®ƒä»ç„¶å…è®¸ä½ æŒ‡å®šå¯¹è±¡ç±»å‹ã€æ•£åˆ—å‡½æ•°ç±»å‹ã€æ¯”è¾ƒå‡½æ•°ç±»å‹å’Œåˆ†é…å™¨ç±»å‹ï¼Œä½†æ˜¯<strong>å®ƒæŠŠé»˜è®¤çš„æ•£åˆ—å’Œæ¯”è¾ƒå‡½æ•°ç§»è¿›ä¸€ä¸ªå•ç‹¬çš„ç±»ä¼¼ç‰¹æ€§çš„å«åšhash_compareçš„ç±»</strong>ï¼Œè€Œä¸”å®ƒæŠŠ<code>hash_compare</code>ä½œä¸ºå®¹å™¨æ¨¡æ¿çš„<code>HashingInfo</code>å®å‚çš„é»˜è®¤å€¼ã€‚</p>
<p>è¿™æ˜¯<code>Dinkumware</code>çš„hash_setå£°æ˜ï¼ˆå†æ¬¡ä¸ºæ¼”ç¤ºè€Œè°ƒæ•´è¿‡ï¼‰:</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">CompareFunction</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">hash_compare</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">HashingInfo</span> <span class="o">=</span> <span class="n">hash_compare</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">less</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">Allocator</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">hash_set</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æ¥å£è®¾è®¡æœ‰è¶£çš„åœ°æ–¹æ˜¯<code>HashingInfo</code>çš„ä½¿ç”¨ã€‚</p>
<p><strong>å®¹å™¨çš„æ•£åˆ—å’Œæ¯”è¾ƒå‡½æ•°å‚¨å­˜åœ¨<code>HashingInfo</code>ä¸­ï¼Œä½†HashingInfoç±»å‹ä¹Ÿå®¹çº³äº†æ§åˆ¶è¡¨ä¸­æ¡¶ï¼ˆbucketï¼‰æœ€å°æ•°é‡ï¼Œä»¥åŠå®¹å™¨å…ƒç´ å¯¹æ¡¶çš„æœ€å¤§å…è®¸æ¯”ç‡çš„æšä¸¾ã€‚</strong></p>
<p>å½“è¿™æ¯”ç‡è¢«è¶…è¿‡æ—¶ï¼Œè¡¨ä¸­æ¡¶çš„æ•°é‡å°±å¢åŠ ï¼Œè€Œè¡¨ä¸­çš„ä¸€äº›å…ƒç´ éœ€è¦é‡æ–°æ•£åˆ—ã€‚ï¼ˆSGIæä¾›å…·æœ‰ç±»ä¼¼æ§åˆ¶è¡¨ä¸­æ¡¶å’Œè¡¨ä¸­å…ƒç´ å¯¹æ¡¶æ¯”ç‡çš„æˆå‘˜å‡½æ•°ã€‚ï¼‰</p>
<p><strong>hash_compare</strong></p>
<p><code>hash_compare</code>ï¼ˆHashingInfoçš„é»˜è®¤å€¼ï¼‰çœ‹èµ·æ¥æˆ–å¤šæˆ–å°‘åƒè¿™æ ·:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">CompareFunction</span> <span class="o">=</span> <span class="n">less</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">hash_compare</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">enum</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">bucket_size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="c1">// å…ƒç´ å¯¹æ¡¶çš„æœ€å¤§æ¯”ç‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">min_buckets</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1">// æ¡¶çš„æœ€å°æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span> <span class="c1">// æ•£åˆ—å‡½æ•°æ¯”è¾ƒå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span> <span class="c1">// å¿½ç•¥ä¸€äº›ä¸œè¥¿ï¼ŒåŒ…æ‹¬ CompareFunctionçš„ä½¿ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‡è½½<code>operator()</code>ï¼ˆåœ¨è¿™é‡Œæ˜¯å®ç°æ•£åˆ—å’Œæ¯”è¾ƒå‡½æ•°ï¼‰æ˜¯æ¯”ä½ å¯ä»¥æƒ³è±¡çš„æ›´ç»å¸¸å‡ºç°çš„ä¸€ä¸ªç­–ç•¥ã€‚</p>
<p><code>Dinkumware</code>è®¾è®¡å…è®¸ä½ å†™ä½ è‡ªå·±çš„ç±»ä¼¼hash_compareçš„ç±»ï¼ˆä¹Ÿè®¸é€šè¿‡ä»<code>hash_compare</code>æœ¬èº«æ´¾ç”Ÿè€Œæ¥ï¼‰ï¼Œè€Œä¸”åªè¦ä½ çš„ç±»å®šä¹‰äº†<code>bucket_size</code>ã€<code>min_buckets</code>ã€ä¸¤ä¸ª<code>operator()</code>å‡½æ•°ï¼ˆä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªå®å‚ï¼Œä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªï¼‰ï¼ŒåŠ ä¸Šå·²ç»çœå»çš„ä¸€äº›ä¸œè¥¿ï¼Œå°±èƒ½ä½¿ç”¨å®ƒæ¥æ§åˆ¶Dinkumwareçš„<code>hash_set</code>æˆ–<code>hash_multiset</code>çš„é…ç½®å’Œè¡Œä¸ºã€‚</p>
<p><code>hash_map</code>å’Œ<code>hash_multimap</code>çš„é…ç½®æ§åˆ¶ä¹Ÿç›¸ä¼¼ã€‚</p>
<h2 id="å†³ç­–ç•™ç»™å®ç°">å†³ç­–ç•™ç»™å®ç°</h2>
<p>æ³¨æ„ä¸ç®¡æ˜¯SGIè¿˜æ˜¯Dinkumwareçš„è®¾è®¡ï¼Œä½ éƒ½èƒ½æŠŠå…¨éƒ¨å†³ç­–ç•™ç»™å®ç°:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// å»ºç«‹ä¸€ä¸ªintçš„æ•£åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">hash_set</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">intTable</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦è®©è¿™ä¸ªå¯ä»¥ç¼–è¯‘ï¼Œæ•£åˆ—è¡¨å¿…é¡»å®¹çº³ä¸€ä¸ªæ•´æ•°ç±»å‹ï¼ˆä¾‹å¦‚intï¼‰ï¼Œå› ä¸º<strong>é»˜è®¤æ•£åˆ—å‡½æ•°ä¸€èˆ¬å±€é™äºæ•´æ•°ç±»å‹ã€‚</strong></p>
<p><strong>å®ç°æ–¹æ³•ä¸åŒ</strong></p>
<p>åœ¨åç«¯ï¼ŒSGIå’ŒDinkumwareçš„å®ç°æ–¹æ³•éå¸¸ä¸åŒã€‚</p>
<ol>
<li>SGIåˆ©ç”¨å¸¸ç”¨çš„ä¸€ä¸ªå…ƒç´ çš„å•é“¾è¡¨çš„æŒ‡é’ˆæ•°ç»„ï¼ˆæ¡¶ï¼‰ç»„æˆçš„å¼€æ”¾æ•£åˆ—æ³•ã€‚</li>
<li>Dinkumwareä¹Ÿåˆ©ç”¨äº†å¼€æ”¾æ•£åˆ—æ³•ï¼Œä½†æ˜¯å®ƒçš„è®¾è®¡æ˜¯åŸºäºä¸€ç§æ–°é¢–çš„æ•°æ®ç»“æ„â€”â€”ç”±è¿­ä»£å™¨ï¼ˆæœ¬è´¨æ˜¯æ¡¶ï¼‰çš„æ•°ç»„ç»„æˆçš„å…ƒç´ åŒå‘é“¾è¡¨ï¼Œè¿­ä»£å™¨çš„ç›¸é‚»å¯¹è¡¨ç¤ºåœ¨æ¯ä¸ªæ¡¶é‡Œå…ƒç´ çš„èŒƒå›´ã€‚</li>
</ol>
<p><strong>é“¾è¡¨ä¸åŒ</strong></p>
<ol>
<li>SGIå®ç°åœ¨<strong>å•é“¾è¡¨</strong>ä¸­å‚¨å­˜è¡¨çš„å…ƒç´ </li>
<li>Dinkumwareå®ç°ä½¿ç”¨ä¸€ä¸ªåŒå‘é“¾è¡¨</li>
</ol>
<p><strong>è¿­ä»£å™¨ç§ç±»ä¸åŒ</strong></p>
<ol>
<li>SGIçš„æ•£åˆ—å®¹å™¨æä¾›äº†å‰å‘è¿­ä»£å™¨ï¼Œå› æ­¤ä½ å¾—æ”¾å¼ƒè¿›è¡Œåå‘è¿­ä»£çš„èƒ½åŠ›ï¼šåœ¨SGIçš„æ•£åˆ—å®¹å™¨ä¸­æ²¡æœ‰rbeginæˆ–è€…rendæˆå‘˜å‡½æ•°ã€‚</li>
<li>ç”¨äºDinkumwareæ•£åˆ—å®¹å™¨çš„è¿­ä»£å™¨æ˜¯åŒå‘çš„ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥æä¾›å‰å‘å’Œåå‘éå†ã€‚</li>
</ol>
<p><strong>å†…å­˜ä½¿ç”¨é‡æ–¹é¢ä¸åŒ</strong></p>
<p>SGIçš„è®¾è®¡æ¯”Dinkumwareçš„èŠ‚ä¿­ä¸€ç‚¹ç‚¹ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>è™½ç„¶STLæœ¬èº«ç¼ºä¹æ•£åˆ—å®¹å™¨ï¼Œå…¼å®¹STLçš„æ•£åˆ—å®¹å™¨ï¼ˆæœ‰ä¸åŒçš„æ¥å£ã€èƒ½åŠ›å’Œè¡Œä¸ºæƒè¡¡ï¼‰ä¸éš¾å¾—åˆ°ã€‚å°±SGIå’ŒSTLportçš„å®ç°è€Œè¨€ï¼Œä½ ç”šè‡³å¯ä»¥å…è´¹ä¸‹è½½å¾—åˆ°å®ƒä»¬ã€‚</p>
]]></description></item><item><title>Effective STL [24] | å½“å…³ä¹æ•ˆç‡æ—¶åº”è¯¥åœ¨map::operator[]å’Œmap-insertä¹‹é—´ä»”ç»†é€‰æ‹©</title><link>https://jianye0428.github.io/posts/clause_24/</link><pubDate>Tue, 15 Aug 2023 08:10:23 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_24/</guid><description><![CDATA[<h2 id="example-mapæ’å…¥">Example mapæ’å…¥</h2>
<p>å‡è®¾æœ‰ä¸€ä¸ªæ”¯æŒé»˜è®¤æ„é€ å‡½æ•°ä»¥åŠä»ä¸€ä¸ªdoubleæ„é€ å’Œèµ‹å€¼çš„Widgetç±»:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="n">Widget</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Widget</span><span class="p">(</span><span class="kt">double</span> <span class="n">weight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Widget</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="kt">double</span> <span class="n">weight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å‡è®¾æˆ‘ä»¬æƒ³å»ºç«‹ä¸€ä¸ªä»intåˆ°Widgetçš„mapï¼Œè€Œä¸”æˆ‘ä»¬æƒ³æœ‰åˆå§‹åŒ–æœ‰ç‰¹å®šå€¼çš„æ˜ å°„:</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Widget</span><span class="o">&gt;</span> <span class="n">m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.50</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.67</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mf">45.8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0003</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>map operator[] å·¥ä½œåŸç†</strong></p>
<p>mapçš„<code>operator[]</code>å‡½æ•°æ˜¯ä¸ªå¥‡æ€ªçš„ä¸œè¥¿ã€‚å®ƒä¸vectorã€dequeå’Œstringçš„<code>operator[]</code>å‡½æ•°æ— å…³ï¼Œä¹Ÿå’Œå†…å»ºçš„æ•°ç»„operator[]æ— å…³ã€‚</p>
<p><code>map::operator[]</code>è¢«è®¾è®¡ä¸ºç®€åŒ–â€œæ·»åŠ æˆ–æ›´æ–°â€åŠŸèƒ½ã€‚å³ï¼Œç»™å®š<code>map&lt;K, V&gt; m</code>;è¿™ä¸ªè¡¨è¾¾å¼</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æ£€æŸ¥é”®kæ˜¯å¦å·²ç»åœ¨mapé‡Œã€‚å¦‚æœä¸ï¼Œå°±æ·»åŠ ä¸Šï¼Œä»¥vä½œä¸ºå®ƒçš„å¯¹åº”å€¼ã€‚å¦‚æœkå·²ç»åœ¨mapé‡Œï¼Œå®ƒçš„å…³è”å€¼è¢«æ›´æ–°æˆvã€‚</strong></p>
<p>è¿™é¡¹å·¥ä½œçš„åŸç†æ˜¯<code>operator[]</code>è¿”å›ä¸€ä¸ªä¸kå…³è”çš„å€¼å¯¹è±¡çš„å¼•ç”¨ã€‚ç„¶åvèµ‹å€¼ç»™æ‰€å¼•ç”¨ï¼ˆ<code>ä»operator[]</code>è¿”å›çš„ï¼‰çš„å¯¹è±¡ã€‚</p>
<p>å½“è¦æ›´æ–°ä¸€ä¸ªå·²å­˜åœ¨çš„é”®çš„å…³è”å€¼æ—¶å¾ˆç›´æ¥ï¼Œå› ä¸ºå·²ç»æœ‰<code>operator[]</code>å¯ä»¥ç”¨æ¥è¿”å›å¼•ç”¨çš„å€¼å¯¹è±¡ã€‚</p>
<p>ä½†æ˜¯å¦‚æœkè¿˜ä¸åœ¨mapé‡Œï¼Œ<code>operator[]</code>å°±æ²¡æœ‰å¯ä»¥å¼•ç”¨çš„å€¼å¯¹è±¡ã€‚é‚£æ ·çš„è¯ï¼Œå®ƒä½¿ç”¨å€¼ç±»å‹çš„é»˜è®¤æ„é€ å‡½æ•°ä»å¤´å¼€å§‹å»ºç«‹ä¸€ä¸ªï¼Œç„¶å<code>operator[]</code>è¿”å›è¿™ä¸ªæ–°å»ºç«‹å¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<p>è®©æˆ‘ä»¬å†æ¬¡åœ°çœ‹çœ‹åŸå…ˆä¾‹å­çš„ç¬¬ä¸€éƒ¨åˆ†ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Widget</span><span class="o">&gt;</span> <span class="n">m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.50</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¡¨è¾¾å¼<code>m[1]</code>æ˜¯<code>m.operator[](1)</code>çš„ç®€åŒ–ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ª<code>map::operator[]</code>çš„è°ƒç”¨ã€‚</p>
<p>è¿™ä¸ªå‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªWidgetçš„å¼•ç”¨ï¼Œå› ä¸ºm çš„æ˜ å°„ç±»å‹æ˜¯Widgetã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œmé‡Œé¢è¿˜æ²¡æœ‰ä»»ä½•ä¸œè¥¿ï¼Œæ‰€ä»¥é”®1åœ¨mapé‡Œæ²¡æœ‰å…¥å£ã€‚å› æ­¤<code>operator[]</code>é»˜è®¤æ„é€ ä¸€ä¸ªWidgetæ¥ä½œä¸ºå…³è”åˆ°1çš„å€¼ï¼Œç„¶åè¿”å›åˆ°é‚£ä¸ªWidgetçš„å¼•ç”¨ã€‚</p>
<p>æœ€åï¼ŒWidgetæˆä¸ºèµ‹å€¼ç›®æ ‡ï¼šè¢«èµ‹å€¼çš„å€¼æ˜¯1.50ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸‹é¢è¿™ä¸ªè¯­å¥</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.50</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>åŠŸèƒ½ä¸Šç­‰ä»·äºè¿™ä¸ª:</strong></p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">// æ–¹ä¾¿çš„ typedef
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Widget</span><span class="o">&gt;</span> <span class="n">IntWidgetMap</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ç”¨é”®1å»ºç«‹æ–°æ˜ å°„å…¥å£å’Œä¸€ä¸ªé»˜è®¤æ„é€ çš„å€¼å¯¹è±¡ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pair</span><span class="o">&lt;</span><span class="n">IntWidgetMap</span><span class="o">::</span><span class="n">iterator</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"> <span class="n">m</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">IntWidgetMap</span><span class="o">::</span><span class="n">value_type</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Widget</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// èµ‹å€¼ç»™å€¼ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">result</span><span class="p">.</span><span class="n">first</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">=</span> <span class="mf">1.50</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç°åœ¨å·²ç»å¾ˆæ¸…æ¥šä¸ºä»€ä¹ˆè¿™ç§æ–¹æ³•å¯èƒ½é™ä½æ€§èƒ½äº†ï¼šå…ˆé»˜è®¤æ„é€ ä¸€ä¸ªWidgetï¼Œç„¶åæˆ‘ä»¬ç«‹å³èµ‹ç»™å®ƒæ–°å€¼ã€‚</strong></p>
<p><strong><code>map insert</code>æ›´é«˜æ•ˆ</strong></p>
<p>å¦‚æœ<strong>ç”¨æƒ³è¦çš„å€¼æ„é€ Widgetæ¯”é»˜è®¤æ„é€ Widgetç„¶åè¿›è¡Œèµ‹å€¼æ˜¾ç„¶æ›´é«˜æ•ˆ</strong>ï¼Œå°±åº”è¯¥ç”¨ç›´æˆªäº†å½“çš„insertè°ƒç”¨æ¥æ›¿æ¢operator[]çš„ä½¿ç”¨ï¼ˆåŒ…æ‹¬å®ƒçš„æ„é€ åŠ èµ‹å€¼ï¼‰:</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">m</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">IntWidgetMap</span><span class="o">::</span><span class="n">value_type</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ä¸Šé¢çš„é‚£äº›ä»£ç æœ‰ç›¸åŒçš„æœ€ç»ˆæ•ˆæœï¼Œé™¤äº†å®ƒ<strong>é€šå¸¸èŠ‚çœäº†3æ¬¡å‡½æ•°è°ƒç”¨</strong>ï¼š</p>
<ol>
<li>ä¸€ä¸ªå»ºç«‹ä¸´æ—¶çš„é»˜è®¤æ„é€ Widgetå¯¹è±¡</li>
<li>ä¸€ä¸ªé”€æ¯é‚£ä¸ªä¸´æ—¶çš„å¯¹è±¡</li>
<li>ä¸€ä¸ªå¯¹Widgetçš„èµ‹å€¼æ“ä½œã€‚</li>
</ol>
<p>è¿™äº›å‡½æ•°è°ƒç”¨è¶Šæ˜‚è´µï¼Œä½ é€šè¿‡ä½¿ç”¨map-insertä»£æ›¿<code>map::operator[]</code>å°±èƒ½èŠ‚çœè¶Šå¤šã€‚</p>
<p>ä¸Šé¢çš„ä»£ç åˆ©ç”¨äº†æ¯ä¸ªæ ‡å‡†å®¹å™¨éƒ½æä¾›çš„value_type typedefã€‚è¿™typedefæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«é‡è¦çš„ï¼Œä½†å¯¹äºmapå’Œmultimapï¼ˆä»¥åŠéæ ‡å‡†å®¹å™¨çš„hash_mapå’Œhash_multimapâ€”â€”å‚è§æ¡æ¬¾25ï¼‰ï¼Œè®°ä½å®ƒæ˜¯å¾ˆé‡è¦çš„ï¼Œå®¹å™¨å…ƒç´ çš„ç±»å‹æ€»æ˜¯æŸç§pairã€‚</p>
<p>ä¹‹å‰è°ˆåŠçš„<code>operator[]</code>è¢«è®¾è®¡ä¸ºç®€åŒ–â€œæ·»åŠ æˆ–æ›´æ–°â€åŠŸèƒ½ï¼Œè€Œä¸”ç°åœ¨æˆ‘ä»¬ç†è§£äº†å½“â€œå¢åŠ â€è¢«æ‰§è¡Œæ—¶ï¼Œ<code>insert</code>æ¯”<code>operator[]</code>æ›´é«˜æ•ˆã€‚å½“åšæ›´æ–°æ—¶ï¼Œæƒ…å½¢æ­£å¥½ç›¸åï¼Œä¹Ÿå°±æ˜¯ï¼Œå½“ä¸€ä¸ªç­‰ä»·çš„é”®è¿™å·²ç»åœ¨mapé‡Œæ—¶ã€‚</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨operator[]æ¥æŠŠkçš„å€¼æ›´æ–°ä¸ºv
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¥æŠŠkçš„å€¼æ›´æ–°ä¸ºvä½¿ç”¨insert
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">m</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">IntWidgetMap</span><span class="o">::</span><span class="n">value_type</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)).</span><span class="n">first</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="operator-ä¸-insert-æƒè¡¡">operator[] ä¸ insert æƒè¡¡</h2>
<p>insertçš„è°ƒç”¨éœ€è¦<code>IntWidgetMap::value_type</code>ç±»å‹çš„å®å‚ï¼ˆå³<code>pair&lt;int, Widget&gt;</code>ï¼‰ï¼Œæ‰€ä»¥å½“è°ƒç”¨insertæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æ„é€ å’Œææ„ä¸€ä¸ªé‚£ç§ç±»å‹çš„å¯¹è±¡ã€‚é‚£è€—è´¹äº†ä¸€å¯¹æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ï¼Œä¹Ÿä¼šé€ æˆä¸€ä¸ªWidgetçš„æ„é€ å’Œææ„ï¼Œå› ä¸º<code>pair&lt;int, Widget&gt;</code>æœ¬èº«åŒ…å«äº†ä¸€ä¸ªWidgetå¯¹è±¡ï¼Œ<strong>operator[]æ²¡æœ‰ä½¿ç”¨pairå¯¹è±¡ï¼Œæ‰€ä»¥æ²¡æœ‰æ„é€ å’Œææ„pairå’ŒWidgetã€‚</strong></p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>æƒ…å½¢é€‰æ‹©:</p>
<ol>
<li>å› æ­¤å‡ºäºå¯¹æ•ˆç‡çš„è€ƒè™‘ï¼Œå½“ç»™<code>map</code>æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬æ–­å®š<code>insert</code>æ¯”<code>operator[]</code>å¥½ï¼›</li>
<li>ä»æ•ˆç‡å’Œç¾å­¦è€ƒè™‘ï¼Œå½“æ›´æ–°å·²ç»åœ¨<code>map</code>é‡Œçš„å…ƒç´ å€¼æ—¶<code>operator[]</code>æ›´å¥½ã€‚</li>
</ol>
</div>
    </div>
  </div>
<p>å¦‚æœSTLæä¾›ä¸€ä¸ªä¸¤å…¨å…¶ç¾çš„å‡½æ•°ï¼Œå³ï¼Œåœ¨å¥æ³•ä¸Šå¸å¼•äººçš„åŒ…ä¸­çš„é«˜æ•ˆçš„â€œæ·»åŠ æˆ–æ›´æ–°â€åŠŸèƒ½:</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// å¦‚æœé”®kä¸å†map mä¸­ï¼›é«˜æ•ˆåœ°æŠŠpair(k, v)æ·»åŠ åˆ°mä¸­ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¦åˆ™é«˜æ•ˆåœ°æŠŠå’Œkå…³è”çš„å€¼æ›´æ–°ä¸ºvã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// è¿”å›ä¸€ä¸ªæŒ‡å‘æ·»åŠ æˆ–ä¿®æ”¹çš„pairçš„è¿­ä»£å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">iterator</span> <span class="n">affectedPair</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"> <span class="n">efficientAddOrUpdate</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯ï¼Œåœ¨STLå†…æ²¡æœ‰åƒè¿™æ ·çš„å‡½æ•°ï¼Œæ­£å¦‚ä¸‹é¢çš„ä»£ç æ‰€æ¼”ç¤ºçš„ï¼Œè‡ªå·±å†™ä¸€ä¸ªå¹¶ä¸éš¾ã€‚é‚£äº›æ³¨é‡Šæ€»ç»“äº†æ­£åœ¨åšä»€ä¹ˆï¼Œè€Œä¸”éšåçš„æ®µè½ä¹Ÿæä¾›äº†ä¸€äº›é™„åŠ çš„è§£é‡Šã€‚</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// mapçš„ç±»å‹KeyArgTypeå’ŒValueArgtypeæ˜¯ç±»å‹å‚æ•°çš„åŸå› è¯·çœ‹ä¸‹é¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">MapType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">KeyArgType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">ValueArgtype</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">MapType</span><span class="o">::</span><span class="n">iterator</span> <span class="n">efficientAddOrUpdate</span><span class="p">(</span><span class="n">MapType</span><span class="o">&amp;</span> <span class="n">m</span><span class="p">,</span> <span class="k">const</span> <span class="n">KeyArgType</span><span class="o">&amp;</span> <span class="n">k</span><span class="p">,</span> <span class="k">const</span> <span class="n">ValueArgtype</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="c1">// æ‰¾åˆ°kåœ¨æˆ–åº”è¯¥åœ¨å“ªé‡Œï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="k">typename</span> <span class="n">MapType</span><span class="o">::</span><span class="n">iterator</span> <span class="n">Ib</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¦‚æœIbæŒ‡å‘ä¸€ä¸ªpair, å®ƒçš„é”®ç­‰ä»·äºk...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="k">if</span><span class="p">(</span><span class="n">Ib</span> <span class="o">!=</span> <span class="n">m</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">key_comp</span><span class="p">()(</span><span class="n">k</span><span class="p">,</span> <span class="n">Ib</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// æ›´æ–°è¿™ä¸ªpairçš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">Ib</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// å¹¶è¿”å›æŒ‡å‘pairçš„è¿­ä»£å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="n">Ib</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">MapType</span><span class="o">::</span><span class="n">value_type</span> <span class="n">MVT</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">       <span class="c1">// æŠŠpair(k, v)æ·»åŠ åˆ°må¹¶// è¿”å›æŒ‡å‘æ–°mapå…ƒç´ çš„è¿­ä»£å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="n">m</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Ib</span><span class="p">,</span> <span class="n">MVT</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œä¸€ä¸ªé«˜æ•ˆçš„å¢åŠ æˆ–æ›´æ–°ï¼Œæˆ‘ä»¬éœ€è¦èƒ½<strong>æ‰¾å‡ºkçš„å€¼æ˜¯å¦åœ¨mapä¸­; å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£å®ƒåœ¨å“ªé‡Œ; å¦‚æœä¸æ˜¯ï¼Œå®ƒè¯¥è¢«æ’å…¥å“ªé‡Œã€‚</strong></p>
<p>è¿™ä¸ªå·¥ä½œæ˜¯ä¸º<code>low_bound</code>é‡èº«å®šåšçš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬è°ƒç”¨é‚£ä¸ªå‡½æ•°ã€‚ç¡®å®šlower_boundæ˜¯å¦ç”¨æˆ‘ä»¬è¦å¯»æ‰¾çš„é”®æ‰¾åˆ°äº†ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬å¯¹ååŠéƒ¨åˆ†è¿›è¡Œä¸€ä¸ªç­‰ä»·æµ‹è¯•ï¼Œä¸€å®šè¦å¯¹mapä½¿ç”¨æ­£ç¡®çš„æ¯”è¾ƒå‡½æ•°: é€šè¿‡<code>map::key_comp</code>æä¾›çš„æ¯”è¾ƒå‡½æ•°ã€‚ç­‰ä»·æµ‹è¯•çš„ç»“æœå‘Šè¯‰æˆ‘ä»¬åº”è¯¥è¿›è¡Œå¢åŠ è¿˜æ˜¯æ›´æ–°ã€‚</p>
<p>å¦‚æœæ˜¯æ›´æ–°ï¼Œä»£ç å¾ˆç›´æˆªäº†å½“ã€‚æ’å…¥åˆ†æ”¯æ›´æœ‰è¶£ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†insertçš„â€œæç¤ºâ€å½¢å¼ã€‚ç»“æ„<code>m.insert(Ibï¼ŒMVT(kï¼Œv))</code>â€œæç¤ºâ€äº†**<code>Ib</code>é‰´åˆ«å‡ºäº†é”®ç­‰ä»·äºkçš„æ–°å…ƒç´ æ­£ç¡®çš„æ’å…¥ä½ç½®ï¼Œè€Œä¸”ä¿è¯å¦‚æœæç¤ºæ­£ç¡®ï¼Œé‚£ä¹ˆæ’å…¥å°†åœ¨åˆ†æ‘Šçš„å¸¸æ•°æ—¶é—´å†…å‘ç”Ÿï¼Œè€Œä¸æ˜¯å¯¹æ•°æ—¶é—´**ã€‚åœ¨<code>efficientAddOrUpdate</code>é‡Œï¼Œæˆ‘ä»¬çŸ¥é“Ibé‰´åˆ«å‡ºäº†é€‚å½“çš„æ’å…¥ä½ç½®ï¼Œå› æ­¤insertçš„è°ƒç”¨è¢«ä¿è¯ä¸ºæ˜¯ä¸€æ¬¡å¸¸æ•°æ—¶é—´æ“ä½œã€‚</p>
<p><strong>KeyArgTypeå’ŒValueArgType</strong></p>
<p>è¿™ä¸ªå®ç°çš„ä¸€ä¸ªæœ‰è¶£æ–¹é¢æ˜¯<code>KeyArgType</code>å’Œ<code>ValueArgType</code>ä¸å¿…æ˜¯å‚¨å­˜åœ¨mapé‡Œçš„ç±»å‹ã€‚å®ƒä»¬åªéœ€è¦å¯ä»¥è½¬æ¢åˆ°å‚¨å­˜åœ¨mapé‡Œçš„ç±»å‹ã€‚</p>
<p>ä¸€ä¸ªå¯é€‰çš„æ–¹æ³•æ˜¯å»æ‰ç±»å‹å‚æ•°<code>KeyArgType</code>å’Œ<code>ValueArgType</code>ï¼Œæ”¹ä¸ºä½¿ç”¨<code>MapType::key_type</code>å’Œ<code>MapType::mapped_type</code>ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬é‚£ä¹ˆåšï¼Œ<strong>åœ¨è°ƒç”¨æ—¶æˆ‘ä»¬å¯èƒ½å¼ºè¿«å‘ç”Ÿä¸å¿…è¦çš„ç±»å‹è½¬æ¢</strong>:</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Widget</span><span class="o">&gt;</span> <span class="n">m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ«å¿˜äº†Widgetæ¥å—ä»ä¸€ä¸ªdoubleèµ‹å€¼ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">Widget</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="kt">double</span> <span class="n">weight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨è€ƒè™‘<code>efficientAddOrUpdate</code>çš„è°ƒç”¨:</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">efficientAddOrUpdate</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å‡è®¾æ˜¯ä¸€æ¬¡æ›´æ–°æ“ä½œï¼Œå³ï¼Œmå·²ç»åŒ…å«é”®æ˜¯10çš„å…ƒç´ ã€‚é‚£æ ·çš„è¯ï¼Œä¸Šé¢çš„æ¨¡æ¿æ¨æ–­å‡º<code>ValueArgType</code>æ˜¯<code>double</code>ï¼Œ<strong>å‡½æ•°ä½“ç›´æ¥æŠŠ1.5ä½œä¸ºdoubleèµ‹ç»™ä¸10ç›¸å…³çš„é‚£ä¸ªWidget</strong>ã€‚é‚£æ˜¯é€šè¿‡è°ƒç”¨<code>Widget::operator(double)</code>å®Œæˆçš„ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ç”¨äº†<code>MapType::mapped_type</code>ä½œä¸º<code>efficientAddOrUpdate</code>çš„ç¬¬3ä¸ªå‚æ•°çš„ç±»å‹ï¼Œåœ¨è°ƒç”¨æ—¶æˆ‘ä»¬å¾—æŠŠ1.5è½¬åŒ–æˆä¸€ä¸ªWidgetï¼Œé‚£æ ·çš„è¯æˆ‘ä»¬å°±å¾—<strong>èŠ±è´¹æœ¬æ¥ä¸éœ€è¦çš„ä¸€æ¬¡Widgetæ„é€ ï¼ˆä»¥åŠéšåçš„ææ„ï¼‰</strong>ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>å½“å…³ä¹æ•ˆç‡æ—¶åº”è¯¥åœ¨map::operator[]å’Œmap-insertä¹‹é—´ä»”ç»†é€‰æ‹©ã€‚</p>
<p><font color=red>å¦‚æœä½ è¦æ›´æ–°å·²å­˜åœ¨çš„mapå…ƒç´ ï¼Œoperator[]æ›´å¥½ï¼Œä½†å¦‚æœä½ è¦å¢åŠ ä¸€ä¸ªæ–°å…ƒç´ ï¼Œinsertåˆ™æœ‰ä¼˜åŠ¿ã€‚</font></p>
]]></description></item><item><title>Effective STL [17] | ä½¿ç”¨â€œäº¤æ¢æŠ€å·§â€æ¥ä¿®æ•´è¿‡å‰©å®¹é‡(ä»…é€‚ç”¨äºvectorå’Œstring)</title><link>https://jianye0428.github.io/posts/clause_17/</link><pubDate>Tue, 08 Aug 2023 08:48:22 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_17/</guid><description><![CDATA[<blockquote>
<p>æ³¨æ„: è¿™é‡Œçš„å®¹é‡æŒ‡çš„æ˜¯capacity</p>
</blockquote>
<p>å‡å¦‚æœ‰ä¸€ä¸ªæµ·é€‰ï¼Œéœ€è¦ä»ç”³è¯·è€…ä¸­æŒ‘é€‰ä¸€äº›äººè¿›å…¥åˆ°ä¸‹ä¸€è½®æ¯”èµ›å½“ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå»ºç«‹ä¸€ä¸ªvectorç”¨æ¥å­˜å‚¨ç”³è¯·è€…ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Contestant</span> <span class="p">{...};</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="n">Contestant</span><span class="o">&gt;</span> <span class="n">contestants</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>vector</code>ä¼šå¾ˆå¿«è·å¾—å¾ˆå¤šå…ƒç´ ï¼Œä½ å¯èƒ½ä¼šå°†èƒ½å¤Ÿè¿›å…¥åˆ°ä¸‹ä¸€è½®çš„ç”³è¯·è€…æ”¾åˆ° vector çš„å‰ç«¯ï¼ˆå¯èƒ½é€šè¿‡ <code>partial_sort</code>æˆ–<code>partition</code>ï¼‰ï¼Œå¦‚æœæ²¡æœ‰å‚ä¸åˆ°ä¸‹ä¸€è½®çš„ç”³è¯·è€…å°±ä¼šä»vector ä¸­åˆ é™¤ï¼ˆå…¸å‹çš„æ–¹æ³•å°±æ˜¯è°ƒç”¨ erase çš„åŒºé—´å½¢å¼ï¼Œå…·ä½“è§æ¡æ¬¾5ï¼‰ã€‚</p>
<p>è¿™æ ·å¾ˆå¥½åœ°å‡å°‘äº† vector çš„å¤§å°ï¼Œ<strong>ä½†æ˜¯æ²¡æœ‰å‡å°‘å®ƒçš„å®¹é‡</strong>ã€‚</p>
<p>å½“ç„¶å¯ä»¥é€šè¿‡resizeæ–¹æ³•å»æ”¹å˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä¸çŸ¥é“å¤§æ¦‚è¦å¤šå°‘ï¼Œæˆ‘åªçŸ¥é“æœ‰ä¸€äº›ç¬¦åˆæˆ‘çš„è¦æ±‚ï¼Œå¦‚æœç›´æ¥ç”¨resizeå¯èƒ½å¤§äº†å¾ˆå¤šï¼Œæˆ–è€…æŠ›å¼ƒäº†åŸæœ¬ç¬¦åˆè¦æ±‚çš„å…ƒç´ ã€‚æ‰€ä»¥æœ€å¥½æœ‰ä¸€ç§shrink_to_fitçš„æ–¹å¼ã€‚</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="n">Contestant</span><span class="o">&gt;</span> <span class="n">contestants</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="n">Contestant</span><span class="o">&gt;</span><span class="p">(</span><span class="n">contestants</span><span class="p">).</span><span class="n">swap</span><span class="p">(</span><span class="n">contestants</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p><font color=Aqua><strong>å…·ä½“å·¥ä½œåŸç†ï¼š</strong></font></p>
<ol>
<li>è¡¨è¾¾å¼<code>vector&lt;Contestant&gt;(contestants)</code>å»ºç«‹ä¸€ä¸ªä¸´æ—¶<code>vector</code>ï¼Œå®ƒæ˜¯<code>contestants</code>çš„ä¸€ä»½æ‹·è´ï¼š<code>vector</code>çš„æ‹·è´æ„é€ å‡½æ•°åšäº†è¿™ä¸ªå·¥ä½œã€‚<strong>vectorçš„æ‹·è´æ„é€ å‡½æ•°åªåˆ†é…æ‹·è´çš„å…ƒç´ éœ€è¦çš„å†…å­˜</strong>ï¼Œå°±æ˜¯è¯´<code>contestants</code>çœŸå®åŒ…å«å¤šå°‘å…ƒç´ ï¼Œå°±åˆ†é…å¤šå°‘å†…å­˜ç©ºé—´ï¼ŒæŒ‰ç…§<code>size()</code>çš„ä¸ªæ•°ï¼Œè€Œä¸æ˜¯capicatiyä¸ªæ•°ï¼Œæ‰€ä»¥è¿™ä¸ªä¸´æ—¶vectoræ²¡æœ‰å¤šä½™çš„å®¹é‡ã€‚</li>
<li>è®©ä¸´æ—¶<code>vector</code>å’Œ<code>contestants</code>äº¤æ¢æ•°æ®ï¼Œè¿™æ—¶contestantsåªæœ‰ä¸´æ—¶å˜é‡çš„ä¿®æ•´è¿‡çš„å®¹é‡(size)ï¼Œè€Œè¿™ä¸ªä¸´æ—¶å˜é‡åˆ™æŒæœ‰äº†æ›¾ç»åœ¨contestantsä¸­çš„å‘èƒ€çš„å®¹é‡(capacity)ã€‚åœ¨è¿™é‡Œï¼ˆè¿™ä¸ªè¯­å¥ç»“å°¾ï¼‰ï¼Œä¸´æ—¶vectorè¢«é”€æ¯ï¼Œå› æ­¤é‡Šæ”¾äº†ä»¥å‰contestantsä½¿ç”¨çš„å†…å­˜ã€‚  æ”¶ç¼©åˆ°åˆé€‚ã€‚</li>
<li>å®Œæˆæ”¶ç¼©å†…å­˜çš„åŒæ—¶ï¼Œä¹Ÿæ‹·è´äº†å®é™…<code>size()</code>ä¸ªå†…å­˜ï¼Œä¹Ÿæœ‰æ€§èƒ½æ¶ˆè€—ã€‚</li>
</ol>
<p><strong>TEST</strong></p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">r1</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// r1 åŒ…å«100ä¸ª1ï¼Œå³100ä¸ªç”³è¯·è€…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;r1 size: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; capacity: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">capacity</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">r1</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span> <span class="c1">// åªä¿ç•™å‰50åç”³è¯·è€…è¿›å…¥ä¸‹ä¸€è½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;r1 size: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; capacity: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">capacity</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">r1</span><span class="p">).</span><span class="n">swap</span><span class="p">(</span><span class="n">r1</span><span class="p">);</span> <span class="c1">// shrink to fit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;r1 size: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; capacity: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">capacity</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç»“æœ:</strong></p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">r1 size: <span class="m">100</span> capacity: <span class="m">100</span>
</span></span><span class="line"><span class="cl">r1 size: <span class="m">50</span> capacity: <span class="m">100</span>
</span></span><span class="line"><span class="cl">r1 size: <span class="m">50</span> capacity: <span class="m">50</span>
</span></span><span class="line"><span class="cl">r1 size: <span class="m">0</span> capacity: <span class="m">0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>stringä¹ŸåŒæ ·é€‚ç”¨ï¼š</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="n">Contestant</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="n">Contest</span><span class="o">&gt;</span><span class="p">().</span><span class="n">swap</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>	<span class="c1">//æ¸…æ¥švå¹¶æŠŠå®ƒçš„å®¹é‡å˜ä¸ºæœ€å°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">string</span><span class="p">().</span><span class="n">swap</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>			<span class="c1">//æ¸…æ¥šså¹¶æŠŠå®ƒçš„å®¹é‡å˜ä¸ºæœ€å°
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦å¤–ï¼Œåœ¨swapçš„æ—¶å€™ï¼Œä¸ä»…ä»…å®¹å™¨å†…å®¹è¢«äº¤æ¢ï¼Œå…¶è¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨ä¹Ÿè¢«äº¤æ¢(stringé™¤å¤–)ã€‚å› æ­¤ï¼Œåœ¨å‘ç”Ÿäº¤æ¢åï¼ŒåŸæ¥çš„è¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨ä¾ç„¶æœ‰æ•ˆï¼Œå¹¶æŒ‡å‘åŒæ ·çš„å…ƒç´ â€”â€”ä½†è¿™äº›å…ƒç´ å·²ç»åœ¨å¦å¤–ä¸€ä¸ªå®¹å™¨ä¸­ã€‚</p>
<h2 id="æ¸…ç©ºå®¹å™¨å¹¶å‡å°‘å®¹é‡åˆ°æœ€å°">æ¸…ç©ºå®¹å™¨å¹¶å‡å°‘å®¹é‡åˆ°æœ€å°</h2>
<p><strong>äº¤æ¢æŠ€å·§çš„å˜ä½“å¯ä»¥ç”¨äºæ¸…é™¤å®¹å™¨å’Œå‡å°‘å®ƒçš„å®¹é‡åˆ°ä½ çš„å®ç°æä¾›çš„æœ€å°å€¼ã€‚</strong></p>
<p>å¯ä»¥ç®€å•åœ°å’Œä¸€ä¸ªé»˜è®¤æ„é€ çš„ä¸´æ—¶vectoræˆ–stringåšä¸ªäº¤æ¢ï¼š</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="n">Contestant</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// ä½¿ç”¨vå’Œs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Contestant</span><span class="o">&gt;</span><span class="p">().</span><span class="n">swap</span><span class="p">(</span><span class="n">v</span><span class="p">);</span> <span class="c1">// æ¸…é™¤vè€Œä¸”æœ€å°åŒ–å®ƒçš„å®¹é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">string</span><span class="p">().</span><span class="n">swap</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="c1">// æ¸…é™¤sè€Œä¸”æœ€å°åŒ–å®ƒçš„å®¹é‡
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•ä»£ç ï¼š</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">r1</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// r1 åŒ…å«100ä¸ª1ï¼Œå³100ä¸ªç”³è¯·è€…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;r1 size: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; capacity: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">capacity</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">().</span><span class="n">swap</span><span class="p">(</span><span class="n">r1</span><span class="p">);</span> <span class="c1">// æ¸…ç©º r1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;r1 size: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; capacity: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">capacity</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœ:</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">r1</span> <span class="nl">size</span><span class="p">:</span> <span class="mi">100</span> <span class="nl">capacity</span><span class="p">:</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="n">r1</span> <span class="nl">size</span><span class="p">:</span> <span class="mi">0</span> <span class="nl">capacity</span><span class="p">:</span> <span class="mi">0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ref:</br>
[1]. <a href="https://blog.csdn.net/u011058765/article/details/51205757?spm=1001.2101.3001.6650.2&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-2-51205757-blog-18826.235%5Ev38%5Epc_relevant_anti_t3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-2-51205757-blog-18826.235%5Ev38%5Epc_relevant_anti_t3&amp;utm_relevant_index=3"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/u011058765/article/details/51205757?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-2-51205757-blog-18826.235%5Ev38%5Epc_relevant_anti_t3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-2-51205757-blog-18826.235%5Ev38%5Epc_relevant_anti_t3&utm_relevant_index=3<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>Effective STL [18] | é¿å…ä½¿ç”¨vector&lt;bool></title><link>https://jianye0428.github.io/posts/clause_18/</link><pubDate>Wed, 09 Aug 2023 14:39:18 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_18/</guid><description><![CDATA[<h2 id="vectorbool-é—®é¢˜">vector<bool> é—®é¢˜</h2>
<p>ä½œä¸ºä¸€ä¸ªSTLå®¹å™¨ï¼Œvector<bool>ç¡®å®åªæœ‰1ä¸ªé—®é¢˜:</p>
<ul>
<li>å®ƒä¸æ˜¯ä¸€ä¸ªSTLå®¹å™¨ï¼›</li>
<li>å®ƒå¹¶ä¸å®¹çº³boolã€‚</li>
</ul>
<h2 id="å‰–æ">å‰–æ</h2>
<p>ä¸€ä¸ªä¸œè¥¿è¦æˆä¸ºSTLå®¹å™¨å°±å¿…é¡»æ»¡è¶³æ‰€æœ‰åœ¨C++æ ‡å‡†23.1èŠ‚ä¸­åˆ—å‡ºçš„å®¹å™¨å¿…è¦æ¡ä»¶ã€‚</p>
<p>å¦‚æœcæ˜¯ä¸€ä¸ªTç±»å‹å¯¹è±¡çš„å®¹å™¨ï¼Œä¸”cæ”¯æŒoperator[]ï¼Œé‚£ä¹ˆä»¥ä¸‹ä»£ç å¿…é¡»èƒ½å¤Ÿç¼–è¯‘:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">T</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// æ— è®ºoperator[]è¿”å›ä»€ä¹ˆï¼Œéƒ½å¯ä»¥ç”¨è¿™ä¸ªåœ°å€åˆå§‹åŒ–ä¸€ä¸ªT*
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ ä½¿ç”¨<code>operator[]</code>æ¥å¾—åˆ°Containerä¸­çš„ä¸€ä¸ªTå¯¹è±¡ï¼Œä½ å¯ä»¥é€šè¿‡å–å®ƒçš„åœ°å€è€Œè·å¾—æŒ‡å‘é‚£ä¸ªå¯¹è±¡çš„æŒ‡é’ˆã€‚(å‡è®¾Tæ²¡æœ‰å€”å¼ºåœ°é‡è½½ä¸€äº›æ“ä½œç¬¦ã€‚) ç„¶è€Œå¦‚æœvectoræ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œè¿™æ®µä»£ç å¿…é¡»èƒ½å¤Ÿç¼–è¯‘ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="o">*</span><span class="n">pb</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// ç”¨vector&lt;bool&gt;::operator[]è¿”å›çš„ä¸œè¥¿çš„åœ°å€åˆå§‹åŒ–ä¸€ä¸ªbool*
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†å®ƒä¸èƒ½ç¼–è¯‘ã€‚</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">test_vector.cpp:154:19: error: taking address of rvalue <span class="o">[</span>-fpermissive<span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="m">154</span> <span class="p">|</span>   bool *pb <span class="o">=</span> <span class="p">&amp;</span>r2<span class="o">[</span>0<span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">|</span>                   ^
</span></span><span class="line"><span class="cl">test_vector.cpp:154:14: error: cannot convert â€˜std::vector&lt;bool&gt;::reference*â€™ <span class="o">{</span>aka â€˜std::_Bit_reference*â€™<span class="o">}</span> to â€˜bool*â€™ in initialization
</span></span><span class="line"><span class="cl">  <span class="m">154</span> <span class="p">|</span>   bool *pb <span class="o">=</span> <span class="p">&amp;</span>r2<span class="o">[</span>0<span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">|</span>              ^~~~~~
</span></span><span class="line"><span class="cl">      <span class="p">|</span>              <span class="p">|</span>
</span></span><span class="line"><span class="cl">      <span class="p">|</span>              std::vector&lt;bool&gt;::reference* <span class="o">{</span>aka std::_Bit_reference*<span class="o">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸º<code>vector&lt;bool&gt;</code>æ˜¯ä¸€ä¸ªä¼ªå®¹å™¨ï¼Œå¹¶ä¸ä¿å­˜çœŸæ­£çš„boolï¼Œè€Œæ˜¯æ‰“åŒ…boolä»¥èŠ‚çœç©ºé—´ã€‚åœ¨ä¸€ä¸ªå…¸å‹çš„å®ç°ä¸­ï¼Œæ¯ä¸ªä¿å­˜åœ¨â€œvectorâ€ä¸­çš„â€œboolâ€å ç”¨ä¸€ä¸ªå•ç‹¬çš„æ¯”ç‰¹ï¼Œè€Œä¸€ä¸ª8æ¯”ç‰¹çš„å­—èŠ‚å°†å®¹çº³8ä¸ªâ€œboolâ€ã€‚</p>
<p>åœ¨å†…éƒ¨ï¼Œ<code>vector&lt;bool&gt;</code>ä½¿ç”¨äº†ä¸ä½åŸŸï¼ˆbitfieldï¼‰ç­‰ä»·çš„æ€æƒ³æ¥è¡¨ç¤ºå®ƒå‡è£…å®¹çº³çš„boolã€‚</p>
<p><font color=blue>ä½åŸŸä¹Ÿåªè¡¨ç°ä¸ºä¸¤ç§å¯èƒ½çš„å€¼ï¼Œä½†çœŸçš„boolå’ŒåŒ–è£…æˆboolçš„ä½åŸŸä¹‹é—´æœ‰ä¸€ä¸ªé‡è¦çš„ä¸åŒï¼šä½ å¯ä»¥åˆ›å»ºæŒ‡å‘çœŸçš„boolçš„æŒ‡é’ˆï¼Œä½†å´ç¦æ­¢æœ‰æŒ‡å‘å•ä¸ªæ¯”ç‰¹çš„æŒ‡é’ˆã€‚</font></p>
<h2 id="å®é™…å®ç°">å®é™…å®ç°</h2>
<p>vector::operator[]è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶è¡Œä¸ºç±»ä¼¼äºæ¯”ç‰¹çš„å¼•ç”¨ï¼Œä¹Ÿç§°ä¸ºä»£ç†å¯¹è±¡ã€‚</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"> <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">_Alloc</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">vector</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="n">_Alloc</span><span class="o">&gt;</span> <span class="o">:</span> <span class="k">protected</span> <span class="n">_Bvector_base</span><span class="o">&lt;</span><span class="n">_Alloc</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">_Bvector_base</span><span class="o">&lt;</span><span class="n">_Alloc</span><span class="o">&gt;</span>   <span class="n">_Base</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">_Base</span><span class="o">::</span><span class="n">_Bit_pointer</span>  <span class="n">_Bit_pointer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">_Base</span><span class="o">::</span><span class="n">_Bit_alloc_traits</span>  <span class="n">_Bit_alloc_traits</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#if __cplusplus &gt;= 201103L
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>      <span class="k">friend</span> <span class="k">struct</span> <span class="nc">std</span><span class="o">::</span><span class="n">hash</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="kt">bool</span>     <span class="n">value_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">size_t</span>     <span class="n">size_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">ptrdiff_t</span>     <span class="n">difference_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">_Bit_reference</span>    <span class="n">reference</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="kt">bool</span>     <span class="n">const_reference</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">_Bit_reference</span><span class="o">*</span>    <span class="n">pointer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">const</span> <span class="kt">bool</span><span class="o">*</span>    <span class="n">const_pointer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">_Bit_iterator</span>    <span class="n">iterator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">_Bit_const_iterator</span>   <span class="n">const_iterator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">reverse_iterator</span><span class="o">&lt;</span><span class="n">const_iterator</span><span class="o">&gt;</span> <span class="n">const_reverse_iterator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">reverse_iterator</span><span class="o">&lt;</span><span class="n">iterator</span><span class="o">&gt;</span>  <span class="n">reverse_iterator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">_Alloc</span>     <span class="n">allocator_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">allocator_type</span>
</span></span><span class="line"><span class="cl">      <span class="nf">get_allocator</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span> <span class="k">return</span> <span class="n">_Base</span><span class="o">::</span><span class="n">get_allocator</span><span class="p">();</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">using</span> <span class="n">_Base</span><span class="o">::</span><span class="n">_M_allocate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">using</span> <span class="n">_Base</span><span class="o">::</span><span class="n">_M_deallocate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">using</span> <span class="n">_Base</span><span class="o">::</span><span class="n">_S_nword</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">using</span> <span class="n">_Base</span><span class="o">::</span><span class="n">_M_get_Bit_allocator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">         <span class="n">reference</span>
</span></span><span class="line"><span class="cl">      <span class="k">operator</span><span class="p">[](</span><span class="n">size_type</span> <span class="n">__n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="o">*</span><span class="nf">iterator</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">_M_impl</span><span class="p">.</span><span class="n">_M_start</span><span class="p">.</span><span class="n">_M_p</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="n">__n</span> <span class="o">/</span> <span class="kt">int</span><span class="p">(</span><span class="n">_S_word_bit</span><span class="p">),</span> <span class="n">__n</span> <span class="o">%</span> <span class="kt">int</span><span class="p">(</span><span class="n">_S_word_bit</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">const_reference</span>
</span></span><span class="line"><span class="cl">      <span class="k">operator</span><span class="p">[](</span><span class="n">size_type</span> <span class="n">__n</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="o">*</span><span class="nf">const_iterator</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">_M_impl</span><span class="p">.</span><span class="n">_M_start</span><span class="p">.</span><span class="n">_M_p</span>
</span></span><span class="line"><span class="cl">        <span class="o">+</span> <span class="n">__n</span> <span class="o">/</span> <span class="kt">int</span><span class="p">(</span><span class="n">_S_word_bit</span><span class="p">),</span> <span class="n">__n</span> <span class="o">%</span> <span class="kt">int</span><span class="p">(</span><span class="n">_S_word_bit</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ä»£ç ä¸èƒ½ç¼–è¯‘çš„åŸå› å¾ˆæ˜æ˜¾ï¼š<code>bool *pb = &amp;v[0]</code>å³è¾¹çš„è¡¨è¾¾å¼æ˜¯<code>vector&lt;bool&gt;::reference*</code>ç±»å‹ï¼Œä¸æ˜¯<code>bool*</code>ã€‚</p>
<h2 id="æ›¿ä»£å“">æ›¿ä»£å“</h2>
<h3 id="1-dequebool">1. deque<bool></h3>
<p><code>deque</code>æä¾›äº†å‡ ä¹æ‰€æœ‰<code>vector</code>æ‰€æä¾›çš„ï¼ˆå”¯ä¸€å€¼å¾—æ³¨æ„çš„æ˜¯<code>reserve</code>å’Œ<code>capacity</code>ï¼‰ï¼Œè€Œ<code>deque&lt;bool&gt;</code>æ˜¯ä¸€ä¸ªSTLå®¹å™¨ï¼Œå®ƒä¿å­˜çœŸæ­£çš„<code>bool</code>å€¼ã€‚</p>
<p><code>deque</code>å†…éƒ¨å†…å­˜ä¸æ˜¯è¿ç»­çš„ã€‚æ‰€ä»¥ä¸èƒ½ä¼ é€’<code>deque&lt;bool&gt;</code>ä¸­çš„æ•°æ®ç»™ä¸€ä¸ªå¸Œæœ›å¾—åˆ°<code>bool</code>æ•°ç»„çš„<code>C API</code>ã€‚</p>
<p>æ¡æ¬¾16ä¸­ç”¨äº<code>vector</code>çš„æŠ€æœ¯ä¸èƒ½åœ¨<code>vector&lt;bool&gt;</code>ä¸Šé€šè¿‡ç¼–è¯‘ï¼Œå› ä¸ºå®ƒä»¬ä¾èµ–äºèƒ½å¤Ÿå–å¾—æŒ‡å‘å®¹å™¨ä¸­åŒ…å«çš„å…ƒç´ ç±»å‹çš„æŒ‡é’ˆã€‚</p>
<h3 id="2-bitset">2. bitset</h3>
<p><code>bitset</code>ä¸æ˜¯ä¸€ä¸ªSTLå®¹å™¨ï¼Œä½†å®ƒæ˜¯C++æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ã€‚ä¸STLå®¹å™¨ä¸åŒï¼Œ<strong>å®ƒçš„å¤§å°ï¼ˆå…ƒç´ æ•°é‡ï¼‰åœ¨ç¼–è¯‘æœŸå›ºå®š</strong>ï¼Œå› æ­¤å®ƒä¸æ”¯æŒæ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚</p>
<p>å› ä¸ºå®ƒä¸æ˜¯ä¸€ä¸ªSTLå®¹å™¨ï¼Œå®ƒä¹Ÿä¸æ”¯æŒiteratorã€‚ä½†å°±åƒ<code>vector&lt;bool&gt;</code>ï¼Œ<strong>å®ƒä½¿ç”¨ä¸€ä¸ªå‹ç¼©çš„è¡¨ç¤ºæ³•ï¼Œä½¿å¾—å®ƒåŒ…å«çš„æ¯ä¸ªå€¼åªå ç”¨ä¸€æ¯”ç‰¹ã€‚</strong></p>
<p>å®ƒæä¾›<code>vector&lt;bool&gt;</code>ç‰¹æœ‰çš„<code>flip</code>æˆå‘˜å‡½æ•°ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—å…¶ä»–æ“ä½œä½é›†<code>(collection of bits)</code>æ‰€ç‰¹æœ‰çš„æˆå‘˜å‡½æ•°ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p><code>vector&lt;bool&gt;</code>ä¸æ»¡è¶³STLå®¹å™¨çš„å¿…è¦æ¡ä»¶ï¼Œä½ æœ€å¥½ä¸è¦ä½¿ç”¨å®ƒï¼›</p>
<p>è€Œ<code>deque&lt;bool&gt;</code>å’Œ<code>bitset</code>æ˜¯åŸºæœ¬èƒ½æ»¡è¶³ä½ å¯¹<code>vector&lt;bool&gt;</code>æä¾›çš„æ€§èƒ½çš„éœ€è¦çš„æ›¿ä»£æ•°æ®ç»“æ„ã€‚</p>
]]></description></item><item><title>Effective STL [23] | è€ƒè™‘ç”¨æœ‰åºvectorä»£æ›¿å…³è”å®¹å™¨</title><link>https://jianye0428.github.io/posts/clause_23/</link><pubDate>Mon, 14 Aug 2023 19:13:32 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_23/</guid><description><![CDATA[<p>å½“éœ€è¦ä¸€ä¸ªæä¾›å¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®ç»“æ„æ—¶ï¼Œå¾ˆå¤šSTLç¨‹åºå‘˜ç«‹åˆ»ä¼šæƒ³åˆ°æ ‡å‡†å…³è”å®¹å™¨ï¼š<code>set</code>ã€<code>multiset</code>ã€<code>map</code>å’Œ<code>multimap</code>ã€‚</p>
<p>å¦‚æœä½¿ç”¨äº†åˆé€‚çš„æ•£åˆ—å‡½æ•°ï¼Œåˆ™å¯ä»¥è®¤ä¸ºæ•£åˆ—å®¹å™¨æä¾›äº†å¸¸æ•°æ—¶é—´çš„æŸ¥æ‰¾ã€‚</p>
<p>å¯¹äºå¤šæ•°åº”ç”¨ï¼Œè¢«è®¤ä¸ºæ˜¯å¸¸æ•°æ—¶é—´æŸ¥æ‰¾çš„æ•£åˆ—å®¹å™¨è¦å¥½äºä¿è¯äº†å¯¹æ•°æ—¶é—´æŸ¥æ‰¾çš„<code>set</code>ã€<code>map</code>å’Œå®ƒä»¬çš„<code>multi</code>åŒäº‹ã€‚</p>
<p>å³ä½¿ä½ éœ€è¦çš„å°±åªæ˜¯==å¯¹æ•°æ—¶é—´==æŸ¥æ‰¾çš„ä¿è¯ï¼Œæ ‡å‡†å…³è”å®¹å™¨ä»ç„¶å¯èƒ½ä¸æ˜¯ä½ çš„æœ€ä½³é€‰æ‹©ã€‚å’Œç›´è§‰ç›¸åï¼Œå¯¹äºæ ‡å‡†å…³è”å®¹å™¨ï¼Œæ‰€æä¾›çš„æ€§èƒ½ä¹Ÿç»å¸¸åŠ£äºæœ¬è¯¥æ¯”è¾ƒæ¬¡çš„<code>vector</code>ã€‚</p>
<h2 id="å…³è”å®¹å™¨æ•°æ®ç»“æ„">å…³è”å®¹å™¨æ•°æ®ç»“æ„</h2>
<p>æ ‡å‡†å…³è”å®¹å™¨çš„å…¸å‹å®ç°æ˜¯<strong>å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘</strong>ã€‚</p>
<p>ä¸€ä¸ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸€ä¸ªå¯¹<strong>æ’å…¥</strong>ã€<strong>åˆ é™¤</strong>å’Œ<strong>æŸ¥æ‰¾</strong>çš„æ··åˆæ“ä½œä¼˜åŒ–çš„æ•°æ®ç»“æ„ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œå®ƒè¢«è®¾è®¡ä¸ºåº”ç”¨äºè¿›è¡Œä¸€äº›æ’å…¥ï¼Œç„¶åä¸€äº›æŸ¥æ‰¾ï¼Œç„¶åå¯èƒ½å†è¿›è¡Œä¸€äº›æ’å…¥ï¼Œç„¶åä¹Ÿè®¸ä¸€äº›åˆ é™¤ï¼Œç„¶åå†æ¥ä¸€äº›æŸ¥æ‰¾ï¼Œç„¶åæ›´å¤šçš„æ’å…¥æˆ–åˆ é™¤ï¼Œç„¶åæ›´å¤šçš„æŸ¥æ‰¾ç­‰ã€‚è¿™ä¸ªäº‹ä»¶åºåˆ—çš„å…³é”®ç‰¹å¾æ˜¯æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾éƒ½æ˜¯æ··åˆåœ¨ä¸€èµ·çš„ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ²¡æœ‰åŠæ³•é¢„æµ‹å¯¹æ ‘çš„ä¸‹ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆã€‚</p>
<p><strong>ä½¿ç”¨æ•°æ®ç»“æ„çš„3é˜¶æ®µ</strong></p>
<ol>
<li><strong>å»ºç«‹</strong>ã€‚é€šè¿‡æ’å…¥å¾ˆå¤šå…ƒç´ å»ºç«‹ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå‡ ä¹æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æ’å…¥å’Œåˆ é™¤ã€‚å‡ ä¹æ²¡æœ‰æˆ–æ ¹æœ¬æ²¡æœ‰æŸ¥æ‰¾ã€‚</li>
<li><strong>æŸ¥æ‰¾</strong>ã€‚åœ¨æ•°æ®ç»“æ„ä¸­æŸ¥æ‰¾æŒ‡å®šçš„ä¿¡æ¯ç‰‡ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå‡ ä¹æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æŸ¥æ‰¾ã€‚å‡ ä¹æ²¡æœ‰æˆ–æ ¹æœ¬æ²¡æœ‰æ’å…¥å’Œåˆ é™¤ã€‚</li>
<li><strong>é‡ç»„</strong>ã€‚ä¿®æ”¹æ•°æ®ç»“æ„çš„å†…å®¹ï¼Œé€šè¿‡åˆ é™¤æ‰€æœ‰ç°æœ‰æ•°æ®å’Œåœ¨åŸåœ°æ’å…¥æ–°æ•°æ®ã€‚ä»åŠ¨ä½œä¸Šè¯´ï¼Œè¿™ä¸ªé˜¶æ®µç­‰ä»·äºé˜¶æ®µ1ã€‚ä¸€æ—¦è¿™ä¸ªé˜¶æ®µå®Œæˆï¼Œåº”ç”¨ç¨‹åºè¿”å›é˜¶æ®µ2ã€‚</li>
</ol>
<h2 id="æœ‰åºvectoræ›´é«˜æ•ˆ">æœ‰åºvectoræ›´é«˜æ•ˆ</h2>
<p>ä¸€ä¸ªvectorå¯èƒ½æ¯”ä¸€ä¸ªå…³è”å®¹å™¨èƒ½æä¾›æ›´é«˜çš„æ€§èƒ½ï¼ˆæ—¶é—´å’Œç©ºé—´ä¸Šéƒ½æ˜¯ï¼‰ã€‚</p>
<p>ä½†ä¸æ˜¯ä»»æ„çš„<code>vector</code>éƒ½ä¼šï¼Œåªæœ‰æœ‰åºvectorã€‚å› ä¸ºåªæœ‰æœ‰åºå®¹å™¨æ‰èƒ½æ­£ç¡®åœ°ä½¿ç”¨æŸ¥æ‰¾ç®—æ³•â€”â€”<code>binary_search</code>ã€<code>lower_bound</code>ã€<code>equal_range</code>ç­‰ã€‚</p>
<p>Q: ä¸ºä»€ä¹ˆä¸€ä¸ªï¼ˆæœ‰åºçš„ï¼‰vectorçš„äºŒåˆ†æ³•æŸ¥æ‰¾æ¯”ä¸€ä¸ªäºŒå‰æ ‘çš„äºŒåˆ†æ³•æŸ¥æ‰¾æä¾›äº†æ›´å¥½çš„æ€§èƒ½ï¼Ÿ</p>
<p>A: å…¶ä¸­çš„ä¸€ä¸ªæ˜¯<strong>å¤§å°é—®é¢˜</strong>ï¼Œå…¶ä¸­çš„ä¸€ä¸ªæ˜¯<strong>å¼•ç”¨å±€éƒ¨æ€§é—®é¢˜</strong>ã€‚</p>
<p><strong>å¤§å°é—®é¢˜</strong></p>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¹å™¨æ¥å®¹çº³Widgetå¯¹è±¡ï¼Œè€Œä¸”ï¼Œå› ä¸ºæŸ¥æ‰¾é€Ÿåº¦å¯¹æˆ‘ä»¬å¾ˆé‡è¦ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªWidgetçš„å…³è”å®¹å™¨å’Œä¸€ä¸ªæœ‰åº<code>vector&lt;Widget&gt;</code>ã€‚</p>
<p><strong>å…³è”å®¹å™¨æ•°æ®ç»“æ„</strong></p>
<p>å¦‚æœé€‰æ‹©ä¸€ä¸ªå…³è”å®¹å™¨ï¼Œæˆ‘ä»¬å‡ ä¹ç¡®å®šäº†è¦ä½¿ç”¨å¹³è¡¡äºŒå‰æ ‘ã€‚è¿™æ ·çš„æ ‘æ˜¯ç”±æ ‘èŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªéƒ½ä¸ä»…å®¹çº³äº†ä¸€ä¸ªWidgetï¼Œè€Œä¸”ä¿å­˜äº†ä¸€ä¸ªè¯¥èŠ‚ç‚¹åˆ°å·¦å­©å­çš„æŒ‡é’ˆï¼Œä¸€ä¸ªåˆ°å®ƒå³å­©å­çš„æŒ‡é’ˆï¼Œå’Œï¼ˆå…¸å‹çš„ï¼‰ä¸€ä¸ªåˆ°å®ƒçˆ¶èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚</p>
<p>è¿™æ„å‘³ç€<strong>åœ¨å…³è”å®¹å™¨ä¸­ç”¨äºå­˜å‚¨ä¸€ä¸ªWidgetçš„ç©ºé—´å¼€é”€è‡³å°‘ä¼šæ˜¯ä¸‰ä¸ªæŒ‡é’ˆ</strong>ã€‚</p>
<p><strong>vectoræ•°æ®ç»“æ„</strong></p>
<p>ä¸ä¹‹ç›¸å¯¹çš„æ˜¯ï¼Œå½“åœ¨vectorä¸­å­˜å‚¨Widgetå¹¶æ²¡æœ‰å¼€é”€ï¼šç®€å•åœ°å­˜å‚¨ä¸€ä¸ªWidgetã€‚</p>
<p>å½“ç„¶ï¼Œ<strong>vectoræœ¬èº«æœ‰å¼€é”€</strong>ï¼Œåœ¨vectorç»“å°¾ä¹Ÿå¯èƒ½æœ‰ç©ºçš„ï¼ˆä¿ç•™ï¼‰ç©ºé—´ï¼Œä½†æ˜¯æ¯ä¸ªvectorå¼€é”€æ˜¯å¯ä»¥å¿½ç•¥çš„ï¼ˆé€šå¸¸æ˜¯ä¸‰ä¸ªæœºå™¨å­—ï¼Œæ¯”å¦‚ï¼Œä¸‰ä¸ªæŒ‡é’ˆæˆ–ä¸¤ä¸ªæŒ‡é’ˆå’Œä¸€ä¸ªintï¼‰ï¼Œè€Œä¸”å¦‚æœå¿…è¦çš„è¯ï¼Œæœ«å°¾ç©ºçš„ç©ºé—´å¯ä»¥é€šè¿‡â€œäº¤æ¢æŠ€å·§â€å»æ‰ã€‚å³ä½¿è¿™ä¸ªé™„åŠ çš„ç©ºé—´æ²¡æœ‰å»æ‰ï¼Œä¹Ÿå¹¶ä¸å½±å“ä¸‹é¢çš„åˆ†æï¼Œå› ä¸ºå½“æŸ¥æ‰¾æ—¶ä¸ä¼šå¼•ç”¨é‚£æ®µå†…å­˜ã€‚</p>
<p><strong>å†…å­˜å¤§å°</strong></p>
<p>å‡è®¾æˆ‘ä»¬çš„æ•°æ®ç»“æ„è¶³å¤Ÿå¤§ï¼Œå®ƒä»¬å¯ä»¥åˆ†æˆå¤šä¸ªå†…å­˜é¡µé¢ï¼Œä½†æ˜¯vectoræ¯”å…³è”å®¹å™¨éœ€è¦çš„é¡µé¢è¦å°‘ã€‚</p>
<p>å› ä¸ºvectorä¸éœ€è¦æ¯ä¸ªWidgetçš„å¼€é”€ï¼Œè€Œå…³è”å®¹å™¨ç»™æ¯ä¸ªWidgetä¸Šé™„åŠ äº†ä¸‰ä¸ªæŒ‡é’ˆã€‚</p>
<p>å‡è®¾åœ¨ä½ ä½¿ç”¨çš„ç³»ç»Ÿä¸Šä¸€ä¸ªWidgetçš„å¤§å°æ˜¯12ä¸ªå­—èŠ‚ï¼ŒæŒ‡é’ˆæ˜¯4ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå†…å­˜é¡µé¢æ˜¯4096ï¼ˆ4Kï¼‰å­—èŠ‚ã€‚</p>
<p>å¿½ç•¥æ¯ä¸ªå®¹å™¨çš„å¼€é”€ï¼Œå½“ç”¨vectorä¿å­˜æ—¶ï¼Œä½ å¯ä»¥åœ¨ä¸€é¡µé¢ä¸Šæ”¾ç½®341ä¸ªWidget $(4096\div12\approx341)$ï¼Œä½†ä½¿ç”¨å…³è”å®¹å™¨æ—¶ä½ æœ€å¤šåªèƒ½æ”¾170ä¸ª $4096\div(12+4\times3)\approx170)$ã€‚</p>
<p><strong>å› æ­¤å…³è”å®¹å™¨å’Œvectoræ¯”èµ·æ¥ï¼Œä½ å°†ä¼šä½¿ç”¨å¤§çº¦ä¸¤å€çš„å†…å­˜ã€‚</strong></p>
<p>å¦‚æœä½ ä½¿ç”¨çš„ç¯å¢ƒå¯ä»¥ç”¨<strong>è™šæ‹Ÿå†…å­˜</strong>ï¼Œå°±å¾ˆå¯ä»¥å®¹æ˜“åœ°çœ‹å‡ºé‚£ä¼š<strong>é€ æˆå¤§é‡çš„é¡µé¢é”™è¯¯ï¼Œå› æ­¤ä¸€ä¸ªç³»ç»Ÿä¼šå› ä¸ºå¤§æ•°æ®é‡è€Œæ˜æ˜¾æ…¢ä¸‹æ¥</strong>ã€‚</p>
<p><strong>å¼•ç”¨å±€éƒ¨æ€§é—®é¢˜</strong></p>
<p>å‡è®¾åœ¨äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹éƒ½ç¾¤é›†åœ¨ä¸€ä¸ªç›¸å…³çš„å°å†…å­˜é¡µé¢é›†ä¸­ï¼Œå®é™…æƒ…å†µä¸‹å…³è”å®¹å™¨å¾ˆä¹è§‚çš„ã€‚</p>
<p><strong>å¤§éƒ¨åˆ†STLå®ç°ä½¿ç”¨è‡ªå®šä¹‰å†…å­˜ç®¡ç†å™¨æ¥è¾¾åˆ°è¿™æ ·çš„ç¾¤é›†ï¼Œä½†æ˜¯å¦‚æœä½ çš„STLå®ç°æ²¡æœ‰æ”¹è¿›æ ‘èŠ‚ç‚¹ä¸­çš„å¼•ç”¨å±€éƒ¨æ€§ï¼Œè¿™äº›èŠ‚ç‚¹ä¼šåˆ†æ•£åœ¨æ‰€æœ‰ä½ çš„å†…å­˜ç©ºé—´ã€‚é‚£ä¼šå¯¼è‡´æ›´å¤šçš„é¡µé¢é”™è¯¯ã€‚</strong></p>
<p>å³ä½¿ä½¿ç”¨äº†è‡ªå®šä¹‰ç¾¤é›†å†…å­˜ç®¡ç†å™¨ï¼Œå…³è”å®¹å™¨ä¹Ÿä¼šå¯¼è‡´å¾ˆå¤šé¡µé¢é”™è¯¯ï¼Œå› ä¸ºï¼Œä¸åƒè¿ç»­å†…å­˜å®¹å™¨ï¼Œæ¯”å¦‚vectorï¼Œ<strong>åŸºäºèŠ‚ç‚¹çš„å®¹å™¨æ›´éš¾ä¿è¯åœ¨å®¹å™¨çš„éå†é¡ºåºä¸­ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªçš„å…ƒç´ åœ¨ç‰©ç†å†…å­˜ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªã€‚</strong></p>
<p><strong>å½“è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾æ—¶é‚£ç§å†…å­˜ç»„ç»‡æ–¹å¼ï¼ˆè¯‘æ³¨ï¼šéå†é¡ºåºä¸­ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªçš„å…ƒç´ åœ¨ç‰©ç†å†…å­˜ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªï¼‰æ­£å¥½æ˜¯é¡µé¢é”™è¯¯æœ€å°‘çš„ã€‚</strong></p>
<h2 id="vectorçš„ç¼ºç‚¹">vectorçš„ç¼ºç‚¹</h2>
<p><font color=red>æœ‰åºvectorçš„å¤§ç¼ºç‚¹æ˜¯å¿…é¡»ä¿æŒæœ‰åºï¼</font></p>
<p>å› ä¸ºvectorä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½å¿…é¡»æ‹·è´ï¼Œæ‰€ä»¥ï¼š</p>
<ol>
<li>
<p>å½“ä¸€ä¸ªæ–°å…ƒç´ æ’å…¥æ—¶ï¼Œå¤§äºè¿™ä¸ªæ–°å…ƒç´ çš„æ‰€æœ‰ä¸œè¥¿éƒ½å¿…é¡»å‘ä¸Šç§»ä¸€ä½ï¼Œéå¸¸æ˜‚è´µï¼›</p>
</li>
<li>
<p>å¦‚æœvectorå¿…é¡»é‡æ–°åˆ†é…å®ƒçš„å†…åœ¨å†…å­˜ï¼Œåˆ™ä¼šæ›´æ˜‚è´µï¼›</p>
</li>
<li>
<p>å¦‚æœä¸€ä¸ªå…ƒç´ ä»vectorä¸­è¢«åˆ é™¤ï¼Œæ‰€æœ‰å¤§äºå®ƒçš„å…ƒç´ éƒ½è¦å‘ä¸‹ç§»åŠ¨ã€‚</p>
</li>
</ol>
<p>vectorçš„æ’å…¥å’Œåˆ é™¤éƒ½å¾ˆæ˜‚è´µï¼Œä½†æ˜¯å…³è”å®¹å™¨çš„æ’å…¥å’Œåˆ é™¤åˆ™å¾ˆè½»é‡ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåªæœ‰å½“ä½ çŸ¥é“ä½ çš„æ•°æ®ç»“æ„ä½¿ç”¨çš„æ—¶å€™æŸ¥æ‰¾å‡ ä¹ä¸å’Œæ’å…¥å’Œåˆ é™¤æ··åˆæ—¶ï¼Œä½¿ç”¨æœ‰åºvectorä»£æ›¿å…³è”å®¹å™¨æ‰æœ‰æ„ä¹‰ã€‚</p>
<p><strong>æ¦‚è¦</strong></p>
<ol>
<li>
<p>åœ¨æœ‰åºvectorä¸­å­˜å‚¨æ•°æ®å¾ˆæœ‰å¯èƒ½æ¯”åœ¨æ ‡å‡†å…³è”å®¹å™¨ä¸­ä¿å­˜ç›¸åŒçš„æ•°æ®æ¶ˆè€—æ›´å°‘çš„å†…å­˜ï¼›</p>
</li>
<li>
<p>å½“é¡µé¢é”™è¯¯å€¼å¾—é‡è§†çš„æ—¶å€™ï¼Œåœ¨æœ‰åºvectorä¸­é€šè¿‡äºŒåˆ†æ³•æŸ¥æ‰¾å¯èƒ½æ¯”åœ¨ä¸€ä¸ªæ ‡å‡†å…³è”å®¹å™¨ä¸­æŸ¥æ‰¾æ›´å¿«ã€‚</p>
</li>
</ol>
<h2 id="example">Example</h2>
<blockquote>
<p>vectorä»£æ›¿set</p>
</blockquote>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"> <span class="c1">// ä»£æ›¿set&lt;Widget&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="n">vw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹é˜¶æ®µï¼šå¾ˆå¤šæ’å…¥ï¼Œå‡ ä¹æ²¡æœ‰æŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç»“æŸå»ºç«‹é˜¶æ®µã€‚ï¼ˆå½“æ¨¡æ‹Ÿä¸€ä¸ªmultisetæ—¶ï¼Œä½ å¯èƒ½æ›´å–œæ¬¢ç”¨stable_sort æ¥ä»£æ›¿ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">sort</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç”¨äºæŸ¥æ‰¾çš„å€¼çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Widget</span> <span class="n">w</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span><span class="c1">// å¼€å§‹æŸ¥æ‰¾é˜¶æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡binary_searchæŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">binary_search</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">w</span><span class="p">))...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡lower_boundæŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">w</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¡æ¬¾19è§£é‡Šäº†â€œ!(w &lt; *i)â€æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">i</span><span class="p">))...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡equal_rangeæŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pair</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="o">&gt;</span> <span class="n">range</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">                       <span class="n">equal_range</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">w</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">first</span> <span class="o">!=</span> <span class="n">range</span><span class="p">.</span><span class="n">second</span><span class="p">)...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// ç»“æŸæŸ¥æ‰¾é˜¶æ®µï¼Œå¼€å§‹é‡ç»„é˜¶æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¼€å§‹æ–°çš„æŸ¥æ‰¾é˜¶æ®µ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">sort</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‡Œé¢æœ€éš¾çš„ä¸œè¥¿å°±æ˜¯<strong>æ€ä¹ˆåœ¨æœç´¢ç®—æ³•ä¸­åšå‡ºé€‰æ‹©</strong>ï¼ˆæ¯”å¦‚ï¼Œ<code>binary_search</code>ã€<code>lower_bound</code>ç­‰ï¼‰</p>
<blockquote>
<p>vectorä»£æ›¿mapæˆ–multimap</p>
</blockquote>
<p>å½“ä½ å†³å®šç”¨vectorä»£æ›¿mapæˆ–multimapæ—¶ï¼Œäº‹æƒ…ä¼šå˜å¾—æ›´æœ‰è¶£ï¼Œå› ä¸º<strong>vectorå¿…é¡»å®¹çº³pairå¯¹è±¡</strong>ã€‚</p>
<p>ä½†æ˜¯è¦æ³¨æ„ï¼Œå¦‚æœä½ å£°æ˜ä¸€ä¸ªmap&lt;K, V&gt;çš„å¯¹è±¡ï¼ˆæˆ–è€…ç­‰ä»·çš„multimapï¼‰ï¼Œä¿å­˜åœ¨mapä¸­çš„å…ƒç´ ç±»å‹æ˜¯<code>pair&lt;const K, V&gt;</code>ã€‚</p>
<p>å¦‚æœè¦ç”¨vectoræ¨¡æ‹Ÿ<code>map</code>æˆ–è€…<code>multimap</code>ï¼Œ<strong>å¿…é¡»å»æ‰const</strong>ï¼Œå› ä¸ºå½“ä½ å¯¹vectoræ’åºæ—¶ï¼Œå…ƒç´ çš„å€¼å°†ä¼šé€šè¿‡èµ‹å€¼ç§»åŠ¨ï¼Œé‚£æ„å‘³ç€pairçš„ä¸¤ä¸ªç»„ä»¶éƒ½å¿…é¡»æ˜¯å¯èµ‹å€¼çš„ã€‚</p>
<p>å½“ä½¿ç”¨vectoræ¥æ¨¡æ‹Ÿmap&lt;K, V&gt;æ—¶ï¼Œ<strong>ä¿å­˜åœ¨vectorä¸­æ•°æ®çš„ç±»å‹å°†æ˜¯<code>pair&lt;K, V&gt;</code></strong>ï¼Œè€Œä¸æ˜¯<code>pair&lt;const K, V&gt;</code>ã€‚</p>
<p>mapå’Œmultimapä»¥é¡ºåºçš„æ–¹å¼ä¿å­˜ä»–ä»¬çš„å…ƒç´ ï¼Œä½†<strong>ç”¨äºæ’åºç›®çš„æ—¶å®ƒä»¬åªä½œç”¨äºå…ƒç´ çš„keyéƒ¨åˆ†</strong>ï¼ˆpairçš„ç¬¬ä¸€ä¸ªç»„ä»¶ï¼‰ï¼Œæ‰€ä»¥å½“æ’åºvectoræ—¶ä½ å¿…é¡»åšä¸€æ ·çš„äº‹æƒ…ã€‚</p>
<p>ä½ éœ€è¦ä¸ºä½ çš„pairå†™ä¸€ä¸ªè‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œå› ä¸º<code>pair</code>çš„<code>operator&lt;</code>ä½œç”¨äºpairçš„ä¸¤ä¸ªç»„ä»¶ã€‚</p>
<p><strong>2ä¸ªæ¯”è¾ƒå‡½æ•°æ¥è¿›è¡ŒæŸ¥æ‰¾</strong></p>
<p>ç”¨æ¥æ’åºçš„æ¯”è¾ƒå‡½æ•°å°†ä½œç”¨äºä¸¤ä¸ªpairå¯¹è±¡ï¼Œä½†æ˜¯æŸ¥æ‰¾åªç”¨åˆ°keyå€¼ã€‚</p>
<p>å¿…é¡»ä¼ ç»™ç”¨äºæŸ¥æ‰¾çš„æ¯”è¾ƒå‡½æ•°ä¸€ä¸ªkeyç±»å‹çš„å¯¹è±¡ï¼ˆè¦æŸ¥æ‰¾çš„å€¼ï¼‰å’Œä¸€ä¸ªpairï¼ˆå­˜å‚¨åœ¨vectorä¸­çš„ä¸€ä¸ªpairï¼‰â€”â€”ä¸¤ä¸ªä¸åŒçš„ç±»å‹ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªé™„åŠ çš„éº»çƒ¦ï¼Œä½ ä¸ä¼šçŸ¥é“keyè¿˜æ˜¯pairæ˜¯ä½œä¸ºç¬¬ä¸€ä¸ªå®å‚ä¼ é€’çš„ï¼Œæ‰€ä»¥ä½ çœŸçš„éœ€è¦ä¸¤ä¸ªç”¨äºæŸ¥æ‰¾çš„æ¯”è¾ƒå‡½æ•°ï¼š<strong>ä¸€ä¸ªkeyå€¼å…ˆä¼ é€’ï¼Œä¸€ä¸ªpairå…ˆä¼ é€’</strong></p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">Data</span><span class="p">;</span> <span class="c1">// åœ¨è¿™ä¸ªä¾‹å­é‡Œ&#34;map&#34;å®¹çº³çš„ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DataCompare</span> <span class="p">{</span> <span class="c1">// ç”¨äºæ¯”è¾ƒçš„ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ç”¨äºæ’åºçš„æ¯”è¾ƒå‡½æ•°keyLessåœ¨ä¸‹é¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Data</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Data</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nf">keyLess</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">rhs</span><span class="p">.</span><span class="n">first</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ç”¨äºæŸ¥æ‰¾çš„æ¯”è¾ƒå‡½æ•°ï¼ˆå½¢å¼1ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Data</span><span class="o">&amp;</span> <span class="n">Ihs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Data</span><span class="o">::</span><span class="n">first_type</span><span class="o">&amp;</span> <span class="n">k</span><span class="p">)</span> <span class="k">const</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">keyLess</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ç”¨äºæŸ¥æ‰¾çš„æ¯”è¾ƒå‡½æ•°ï¼ˆå½¢å¼2ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Data</span><span class="o">::</span><span class="n">first_type</span><span class="o">&amp;</span> <span class="n">k</span><span class="p">,</span>  <span class="k">const</span> <span class="n">Data</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">keyLessfk</span><span class="p">,</span> <span class="n">rhs</span><span class="p">.</span><span class="n">first</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// â€œçœŸçš„â€æ¯”è¾ƒå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">bool</span> <span class="n">keyLess</span><span class="p">(</span><span class="k">const</span> <span class="n">Data</span><span class="o">::</span><span class="n">first_type</span><span class="o">&amp;</span> <span class="n">k1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Data</span><span class="o">::</span><span class="n">first_type</span><span class="o">&amp;</span> <span class="n">k2</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">k1</span> <span class="o">&lt;</span> <span class="n">k2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å‡è®¾æœ‰åºvectorå°†æ¨¡æ‹Ÿ<code>map&lt;string, int&gt;</code>ã€‚</p>
<p>è¿™æ®µä»£ç å‡ ä¹æ˜¯ä¸Šé¢è®¨è®ºçš„å­—é¢è½¬æ¢ï¼Œé™¤äº†å­˜åœ¨æˆå‘˜å‡½æ•°<code>keyLess</code>ã€‚</p>
<p>é‚£ä¸ªå‡½æ•°çš„å­˜åœ¨æ˜¯ç”¨æ¥<strong>ä¿è¯å‡ ä¸ªä¸åŒçš„<code>operator()</code>å‡½æ•°ä¹‹é—´çš„ä¸€è‡´æ€§</strong>ã€‚</p>
<p>æ¯ä¸ªè¿™æ ·çš„å‡½æ•°åªæ˜¯ç®€å•åœ°æ¯”è¾ƒä¸¤ä¸ªkeyçš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ªæµ‹è¯•æ”¾åœ¨keyLessä¸­å¹¶è®©operator()å‡½æ•°è¿”å›keyLessæ‰€åšçš„äº‹æƒ…ï¼Œè¿™æ¯”å¤åˆ¶é‚£ä¸ªé€»è¾‘è¦å¥½ã€‚</p>
<p>è¿™ä¸ªè½¯ä»¶å·¥ç¨‹ä¸­ç»å¦™çš„åŠ¨ä½œå¢å¼ºäº†<code>DataCompare</code>çš„å¯ç»´æŠ¤æ€§ï¼Œä½†<strong>æœ‰ä¸€ä¸ªå°ç¼ºç‚¹ï¼Œå®ƒæä¾›äº†æœ‰ä¸åŒå‚æ•°ç±»å‹çš„operator()å‡½æ•°ï¼Œè¿™å°†å¯¼è‡´å‡½æ•°å¯¹è±¡æ— æ³•é€‚é…ã€‚</strong></p>
<p>æŠŠæœ‰åºvectorç”¨ä½œmapæœ¬è´¨ä¸Šå’Œç”¨ä½œsetä¸€æ ·ã€‚</p>
<p><strong>å”¯ä¸€å¤§çš„åŒºåˆ«æ˜¯å¿…é¡»æŠŠDataCompareå¯¹è±¡ç”¨ä½œæ¯”è¾ƒå‡½æ•°:</strong></p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// ä»£æ›¿map&lt;string, int&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;</span> <span class="n">vd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="c1">// å»ºç«‹é˜¶æ®µï¼šå¾ˆå¤šæ’å…¥ï¼Œå‡ ä¹æ²¡æœ‰æŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç»“æŸå»ºç«‹é˜¶æ®µã€‚ï¼ˆå½“æ¨¡æ‹Ÿmultimapæ—¶ï¼Œä½ å¯èƒ½æ›´å–œæ¬¢ç”¨stable_sortæ¥ä»£æ›¿ï¼‰ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">sort</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">DataCompare</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç”¨äºæŸ¥æ‰¾çš„å€¼çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// å¼€å§‹æŸ¥æ‰¾é˜¶æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡binary_searchæŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">binary_search</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">s</span><span class="p">,</span> <span class="n">DataCompare</span><span class="p">()))...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å†æ¬¡é€šè¿‡lower_boundæŸ¥æ‰¾ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">s</span><span class="p">,</span> <span class="n">DataCompare</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¡æ¬¾45è§£é‡Šäº†â€œ!DataCompare()(s, *i)â€æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">DataCompare</span><span class="p">()(</span><span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">))...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡equal_rangeæŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pair</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="o">&gt;</span> <span class="n">range</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="n">equal_range</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">s</span><span class="p">,</span> <span class="n">DataCompare</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">first</span> <span class="o">!=</span> <span class="n">range</span><span class="p">.</span><span class="n">second</span><span class="p">)...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// ç»“æŸæŸ¥æ‰¾é˜¶æ®µï¼Œå¼€å§‹é‡ç»„é˜¶æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¼€å§‹æ–°çš„æŸ¥æ‰¾é˜¶æ®µ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">sort</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">DataCompare</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£å¦‚ä½ æ‰€è§ï¼Œä¸€æ—¦ä½ å†™äº†DataCompareï¼Œä¸œè¥¿éƒ½å¾ˆå¥½åœ°ä¾åºæ’åˆ—äº†ã€‚</p>
<p>è€Œä¸€æ—¦ä½ç½®åˆé€‚äº†ï¼Œå®ƒä»¬å¾€å¾€æ¯”ç›¸åº”çš„ä½¿ç”¨çœŸçš„mapçš„è®¾è®¡è¿è¡Œå¾—æ›´å¿«è€Œä¸”ä½¿ç”¨æ›´å°‘å†…å­˜ã€‚</p>
<p>å¦‚æœä½ çš„ç¨‹åºä¸æ˜¯æŒ‰ç…§é˜¶æ®µçš„æ–¹å¼æ“ä½œæ•°æ®ç»“æ„ï¼Œé‚£ä¹ˆä½¿ç”¨æœ‰åºvectorä»£æ›¿æ ‡å‡†å…³è”å®¹å™¨å‡ ä¹å¯ä»¥ç¡®å®šæ˜¯åœ¨æµªè´¹æ—¶é—´ã€‚</p>
]]></description></item><item><title>Effective STL [21] | æ°¸è¿œè®©æ¯”è¾ƒå‡½æ•°å¯¹ç›¸ç­‰çš„å€¼è¿”å›false</title><link>https://jianye0428.github.io/posts/clause_21/</link><pubDate>Fri, 11 Aug 2023 17:11:35 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_21/</guid><description><![CDATA[<h2 id="example-set">Example set</h2>
<p>å»ºç«‹ä¸€ä¸ªsetï¼Œæ¯”è¾ƒç±»å‹ç”¨<code>less_equal</code>ï¼Œç„¶åæ’å…¥æ•´å‹æ•°å­—33(ç§°ä¸º $33_{A}$):</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">less_equal</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">s</span><span class="p">;</span> <span class="c1">// sä»¥â€œ&lt;=â€æ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">s</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">33</span><span class="p">);</span> <span class="c1">// æ’å…¥33
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨å°è¯•å†æ’å…¥ä¸€æ¬¡33(ç§°ä¸º $33_{B}$):</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">s</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">33</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºè¿™ä¸ªinsertçš„è°ƒç”¨ï¼Œsetå¿…é¡»å…ˆè¦åˆ¤æ–­å‡º $33_{A}$ æ˜¯å¦å·²ç»ä½äºå…¶ä¸­äº†ï¼ŒæŸ¥æ‰¾å“ªå„¿é€‚åˆæ’å…¥ $33_{B}$ã€‚æœ€ç»ˆï¼Œå®ƒæ€»è¦æ£€æŸ¥ $33_{B}$æ˜¯å¦ä¸ $33_{A}$ ç›¸åŒã€‚</p>
<p>å…³è”å®¹å™¨å¯¹â€œç›¸åŒâ€çš„å®šä¹‰æ˜¯ç­‰ä»·ï¼Œå› æ­¤setæµ‹è¯• $33_{B}$æ˜¯å¦ç­‰ä»·äº $33_{A}$ã€‚</p>
<p>å½“æ‰§è¡Œè¿™ä¸ªæµ‹è¯•æ—¶ï¼Œå®ƒè‡ªç„¶æ˜¯ä½¿ç”¨setçš„æ¯”è¾ƒå‡½æ•°ã€‚åœ¨è¿™ä¸€ä¾‹å­é‡Œï¼Œæ˜¯<code>operator&lt;=</code>ï¼Œå› ä¸ºæˆ‘ä»¬æŒ‡å®š<code>set</code>çš„æ¯”è¾ƒå‡½æ•°ä¸º<code>less_equal</code>ï¼Œè€Œ<code>less_equal</code>æ„æ€å°±æ˜¯<code>operator&lt;=</code>ã€‚</p>
<p>å¯ä»¥çœ‹çœ‹<code>less_equal</code>çš„æºç å®ç°ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">/// One of the @link comparison_functors comparison functors@endlink.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">_Tp</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">less_equal</span> <span class="o">:</span> <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="n">_Tp</span><span class="p">,</span> <span class="n">_Tp</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">_GLIBCXX14_CONSTEXPR</span>
</span></span><span class="line"><span class="cl">  <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">  <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">_Tp</span><span class="o">&amp;</span> <span class="n">__x</span><span class="p">,</span> <span class="k">const</span> <span class="n">_Tp</span><span class="o">&amp;</span> <span class="n">__y</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="k">return</span> <span class="n">__x</span> <span class="o">&lt;=</span> <span class="n">__y</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// æ­¤å¤„æ˜¯ &lt;=
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>äºæ˜¯ï¼Œsetå°†è®¡ç®—è¿™ä¸ªè¡¨è¾¾å¼æ˜¯å¦ä¸ºçœŸ:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="o">!</span><span class="p">(</span><span class="mi">33</span><span class="n">A</span> <span class="o">&lt;=</span> <span class="mi">33</span><span class="n">B</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="mi">33</span><span class="n">B</span> <span class="o">&lt;=</span> <span class="mi">33</span><span class="n">A</span><span class="p">)</span> <span class="c1">// æµ‹è¯•33Aå’Œ33Bæ˜¯å¦ç­‰ä»·
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>$33_{A}$ å’Œ $33_{B}$ éƒ½æ˜¯33ï¼Œå› æ­¤ï¼Œ $33_{A}$&lt;=$33_{B}$ è‚¯å®šä¸ºçœŸã€‚åŒæ ·æ¸…æ¥šçš„æ˜¯ï¼Œ$33_{B}$ &lt;= $33_{A}$ã€‚äºæ˜¯ä¸Šè¿°çš„è¡¨è¾¾å¼ç®€åŒ–ä¸º:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="o">!</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å†ç®€åŒ–å°±æ˜¯</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="nb">false</span> <span class="o">&amp;&amp;</span> <span class="nb">false</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœå½“ç„¶æ˜¯falseã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œsetå¾—å‡ºçš„ç»“è®ºæ˜¯ $33_{B}$ ä¸ $33_{B}$ ä¸ç­‰ä»·ï¼Œå› æ­¤ä¸ä¸€æ ·ï¼Œäºæ˜¯å®ƒå°† $33_{B}$ æ’å…¥å®¹å™¨ä¸­çš„æ—è¾¹ã€‚</p>
<p>åœ¨æŠ€æœ¯ä¸Šè€Œè¨€ï¼Œè¿™ä¸ªåšæ³•å¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºï¼Œä½†æ˜¯é€šå¸¸çš„ç»“æœæ˜¯setä»¥æ‹¥æœ‰äº†ä¸¤ä¸ªä¸º33çš„å€¼çš„æ‹·è´è€Œå‘Šç»ˆï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸å†æ˜¯ä¸€ä¸ªsetäº†ã€‚é€šè¿‡ä½¿ç”¨less_equalä½œä¸ºæˆ‘ä»¬çš„æ¯”è¾ƒç±»å‹ï¼Œæˆ‘ä»¬ç ´åäº†å®¹å™¨ï¼</p>
<p><strong>æµ‹è¯•</strong></p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">set</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">less_equal</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">snumber</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">snumber</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">33</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">snumber</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">33</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">for_each</span><span class="p">(</span><span class="n">snumber</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">snumber</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">print</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœ:</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="mi">33</span>
</span></span><span class="line"><span class="cl"><span class="mi">33</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="example-string">Example string*</h2>
<p><code>æ¡æ¬¾20</code>æè¿°äº†è¯¥å¦‚ä½•å†™ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ä»¥ä½¿å¾—å®¹çº³<code>string*</code>æŒ‡é’ˆçš„å®¹å™¨æ ¹æ®stringçš„å€¼æ’åºï¼Œè€Œä¸æ˜¯å¯¹æŒ‡é’ˆçš„å€¼æ’åºã€‚é‚£ä¸ªæ¯”è¾ƒå‡½æ•°æ˜¯æŒ‰å‡åºæ’åºçš„ï¼Œä½†ç°åœ¨å‡è®¾ä½ éœ€è¦<code>string*</code>æŒ‡é’ˆçš„å®¹å™¨çš„é™åºæ’åºçš„æ¯”è¾ƒå‡½æ•°ã€‚</p>
<p>è‡ªç„¶æ˜¯æŠ“ç°æˆçš„ä»£ç æ¥ä¿®æ”¹äº†ã€‚å¦‚æœä¸ç»†å¿ƒï¼Œå¯èƒ½ä¼šè¿™ä¹ˆå¹²:</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">StringPtrGreater</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span> <span class="c1">// è¿™ä»£ç æ˜¯æœ‰ç‘•ç–µçš„ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps1</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps2</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">ps1</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">ps2</span><span class="p">);</span> <span class="c1">// åªæ˜¯ç›¸åäº†æ—§çš„æµ‹è¯•ï¼›è¿™æ˜¯ä¸å¯¹çš„ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„æƒ³æ³•æ˜¯é€šè¿‡å°†æ¯”è¾ƒå‡½æ•°å†…éƒ¨ç»“æœå–åæ¥è¾¾åˆ°ååºçš„ç»“æœã€‚å¾ˆä¸å¹¸ï¼Œå–åâ€œ&lt;â€ä¸ä¼šç»™ä½ ï¼ˆä½ æ‰€æœŸæœ›çš„ï¼‰â€œ&gt;â€ï¼Œå®ƒç»™ä½ çš„æ˜¯ â€œ&gt;=â€ã€‚</p>
<p>è€Œä½ ç°åœ¨çŸ¥é“ï¼Œå› ä¸ºå®ƒå°†å¯¹ç›¸ç­‰çš„å€¼è¿”å›trueï¼Œå¯¹å…³è”å®¹å™¨æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ— æ•ˆçš„æ¯”è¾ƒå‡½æ•°ã€‚</p>
<p>ä½ çœŸæ­£éœ€è¦çš„æ¯”è¾ƒç±»å‹æ˜¯è¿™ä¸ª:</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">StringPtrGreater</span><span class="o">:</span> <span class="c1">// å¯¹å…³è”å®¹å™¨æ¥è¯´è¿™æ˜¯æœ‰æ•ˆçš„æ¯”è¾ƒç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps1</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps2</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="o">*</span><span class="n">ps2</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">ps1</span><span class="p">;</span> <span class="c1">// è¿”å›*ps2æ˜¯å¦å¤§äº*ps1ï¼ˆä¹Ÿå°±æ˜¯äº¤æ¢æ“ä½œæ•°çš„é¡ºåºï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦é¿å…æ‰å…¥è¿™ä¸ªé™·é˜±ï¼Œä½ æ‰€è¦è®°ä½çš„å°±æ˜¯æ¯”è¾ƒå‡½æ•°çš„è¿”å›å€¼è¡¨æ˜çš„æ˜¯åœ¨æ­¤å‡½æ•°å®šä¹‰çš„æ’åºæ–¹å¼ä¸‹ï¼Œä¸€ä¸ªå€¼æ˜¯å¦å¤§äºå¦ä¸€ä¸ªã€‚</p>
<p><strong>ç›¸ç­‰çš„å€¼ç»ä¸è¯¥ä¸€ä¸ªå¤§äºå¦ä¸€ä¸ªï¼Œæ‰€ä»¥æ¯”è¾ƒå‡½æ•°æ€»åº”è¯¥å¯¹ç›¸ç­‰çš„å€¼è¿”å›<code>false</code></strong></p>
<h2 id="example-multiset">Example multiset</h2>
<p>multisetå’Œmultimapé‚£äº›å®¹å™¨å¯ä»¥å®¹çº³å¤æœ¬å¯èƒ½åŒ…å«å‰¯æœ¬ï¼Œå¦‚æœå®¹å™¨è®¤ä¸ºä¸¤ä¸ªå€¼ç›¸ç­‰çš„å¯¹è±¡ä¸ç­‰ä»·ï¼Œå®ƒå°†ä¼šæŠŠä¸¤ä¸ªéƒ½å­˜å‚¨è¿›å»çš„ï¼Œè¿™æ­£æ˜¯multiç³»åˆ—å®¹å™¨çš„æ‰€è¦æ”¯æŒçš„äº‹æƒ…ã€‚</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">multiset</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">less_equal</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">msnum</span><span class="p">;</span> <span class="c1">// ä»ç„¶ä»¥â€œ&lt;=â€æ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">msnum</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span> <span class="c1">// æ’å…¥22A
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">msnum</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span> <span class="c1">// æ’å…¥22B
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">for_each</span><span class="p">(</span><span class="n">msnum</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">msnum</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">print</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœ:</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="mi">22</span>
</span></span><span class="line"><span class="cl"><span class="mi">22</span></span></span></code></pre></td></tr></table>
</div>
</div><p>sé‡Œæœ‰ä¸¤ä¸ª22çš„æ‹·è´ï¼Œ<strong>å› æ­¤æˆ‘ä»¬æœŸæœ›å¦‚æœæˆ‘ä»¬åœ¨å®ƒä¸Šé¢åšä¸€ä¸ª<code>equal_range</code>ï¼Œæˆ‘ä»¬å°†ä¼šå¾—åˆ°ä¸€å¯¹æŒ‡å‡ºåŒ…å«è¿™ä¸¤ä¸ªæ‹·è´çš„èŒƒå›´çš„è¿­ä»£å™¨ã€‚ä½†é‚£æ˜¯ä¸å¯èƒ½çš„ã€‚</strong></p>
<p><code>equal_range</code>ï¼Œè™½ç„¶å«è¿™ä¸ªåå­—ï¼Œä½†ä¸æ˜¯æŒ‡ç¤ºå‡ºç›¸ç­‰çš„å€¼çš„èŒƒå›´ï¼Œè€Œæ˜¯ç­‰ä»·çš„å€¼çš„èŒƒå›´ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œsçš„æ¯”è¾ƒå‡½æ•°è¯´22Aå’Œ22Bæ˜¯ä¸ç­‰ä»·çš„ï¼Œæ‰€ä»¥ä¸å¯èƒ½è®©å®ƒä»¬åŒæ—¶å‡ºç°åœ¨equal_rangeæ‰€æŒ‡ç¤ºçš„èŒƒå›´å†…ã€‚</p>
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">pair</span><span class="o">&lt;</span><span class="n">multiset</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="p">,</span> <span class="n">multiset</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="o">&gt;</span> <span class="n">range2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//åœ¨ myvector å®¹å™¨ä¸­æ‰¾åˆ°æ‰€æœ‰çš„å…ƒç´  22
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">range2</span> <span class="o">=</span> <span class="n">equal_range</span><span class="p">(</span><span class="n">msnum</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">msnum</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">22</span><span class="p">,</span> <span class="n">less_equal</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span>
</span></span><span class="line"><span class="cl"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">my multisetï¼š&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">range2</span><span class="p">.</span><span class="n">first</span><span class="p">;</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">range2</span><span class="p">.</span><span class="n">second</span><span class="p">;</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœæ²¡æœ‰å¾—åˆ°æœŸæœ›ç»“æœ:</p>
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">my multiset:</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ”¹ä¸º<code>less</code>æ¯”è¾ƒ:</p>
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">range2</span> <span class="o">=</span> <span class="n">equal_range</span><span class="p">(</span><span class="n">msnum</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">msnum</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">22</span><span class="p">,</span> <span class="n">less</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœ:</p>
<div class="highlight" id="id-16"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">my</span> <span class="n">multiset</span><span class="err">ï¼š</span><span class="mi">22</span> <span class="mi">22</span></span></span></code></pre></td></tr></table>
</div>
</div><p><font color=red><strong>é™¤éä½ çš„æ¯”è¾ƒå‡½æ•°æ€»æ˜¯ä¸ºç›¸ç­‰çš„å€¼è¿”å›falseï¼Œä½ å°†ä¼šæ‰“ç ´æ‰€æœ‰çš„æ ‡å‡†å…³è”å‹å®¹å™¨ï¼Œä¸ç®¡å®ƒä»¬æ˜¯å¦å…è®¸å­˜å‚¨å¤æœ¬ã€‚</strong></font></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ä»æŠ€æœ¯ä¸Šè¯´ï¼Œç”¨äºæ’åºå…³è”å®¹å™¨çš„æ¯”è¾ƒå‡½æ•°å¿…é¡»åœ¨å®ƒä»¬æ‰€æ¯”è¾ƒçš„å¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªâ€œ<strong>ä¸¥æ ¼çš„å¼±åºåŒ–(strict weakordering)</strong>â€ã€‚ï¼ˆä¼ ç»™sortç­‰ç®—æ³•ï¼ˆå‚è§æ¡æ¬¾31ï¼‰çš„æ¯”è¾ƒå‡½æ•°ä¹Ÿæœ‰åŒæ ·çš„é™åˆ¶ï¼‰ã€‚</p>
<p><strong>ä»»ä½•ä¸€ä¸ªå®šä¹‰äº†ä¸¥æ ¼çš„å¼±åºåŒ–çš„å‡½æ•°éƒ½å¿…é¡»åœ¨ä¼ å…¥ç›¸åŒçš„å€¼çš„ä¸¤ä¸ªæ‹·è´æ—¶è¿”å›falseã€‚</strong></p>
]]></description></item><item><title>Effective STL [22] | é¿å…åŸåœ°ä¿®æ”¹setå’Œmultisetçš„é”®</title><link>https://jianye0428.github.io/posts/clause_22/</link><pubDate>Mon, 14 Aug 2023 08:13:21 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_22/</guid><description><![CDATA[<p><strong>æ‰€æœ‰æ ‡å‡†å…³è”å®¹å™¨ï¼Œsetå’Œmultisetä¿æŒå®ƒä»¬çš„å…ƒç´ æœ‰åºï¼Œè¿™äº›å®¹å™¨çš„æ­£ç¡®è¡Œä¸ºä¾èµ–äºå®ƒä»¬ä¿æŒæœ‰åºã€‚</strong></p>
<p>å¦‚æœä½ æ”¹äº†å…³è”å®¹å™¨é‡Œçš„ä¸€ä¸ªå…ƒç´ çš„å€¼ï¼ˆä¾‹å¦‚ï¼ŒæŠŠ10å˜ä¸º1000ï¼‰ï¼Œæ–°å€¼å¯èƒ½ä¸åœ¨æ­£ç¡®çš„ä½ç½®ï¼Œè€Œä¸”é‚£å°†ç ´åå®¹å™¨çš„æœ‰åºæ€§ã€‚</p>
<h2 id="ä¿®æ”¹mapå’Œmultimapå€¼">ä¿®æ”¹mapå’Œmultimapå€¼</h2>
<p>è¯•å›¾æ”¹å˜è¿™äº›å®¹å™¨é‡Œçš„ä¸€ä¸ªé”®å€¼çš„ç¨‹åºå°†ä¸èƒ½ç¼–è¯‘:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span> <span class="n">m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// é”™è¯¯ï¼mapé”®ä¸èƒ½æ”¹å˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">multimap</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span> <span class="n">mm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">mm</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="c1">// é”™è¯¯ï¼multimapé”®ä¹Ÿä¸èƒ½æ”¹å˜
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition tip open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-lightbulb fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">å› ä¸º<code>map&lt;K, V&gt;</code>æˆ–<code>multimap&lt;K, V&gt;</code>ç±»å‹çš„å¯¹è±¡ä¸­å…ƒç´ çš„ç±»å‹æ˜¯<code>pair&lt;const K, V&gt;</code>ã€‚å› ä¸ºé”®çš„ç±»å‹const Kï¼Œå®ƒä¸èƒ½æ”¹å˜ã€‚</div>
    </div>
  </div>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">_Key</span><span class="p">,</span> <span class="k">typename</span> <span class="n">_Tp</span><span class="p">,</span> <span class="k">typename</span> <span class="n">_Compare</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">less</span><span class="o">&lt;</span><span class="n">_Key</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">typename</span> <span class="n">_Alloc</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">_Tp</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">map</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Key</span>     <span class="n">key_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Tp</span>     <span class="n">mapped_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">_Tp</span><span class="o">&gt;</span>  <span class="n">value_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Compare</span>     <span class="n">key_compare</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Alloc</span>     <span class="n">allocator_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä½ ä½¿ç”¨ä¸€ä¸ª<code>const_cast</code>ï¼Œæˆ–è®¸èƒ½æ”¹å˜å®ƒï¼Œåé¢ä¼šè®¨è®ºåˆ°ã€‚</p>
<h2 id="ä¿®æ”¹setå’Œmultisetå€¼">ä¿®æ”¹setå’Œmultisetå€¼</h2>
<p>å¯¹äº<code>set&lt;T&gt;</code>æˆ–<code>multiset&lt;T&gt;</code>ç±»å‹çš„å¯¹è±¡æ¥è¯´ï¼Œå‚¨å­˜åœ¨å®¹å™¨é‡Œçš„å…ƒç´ ç±»å‹åªä¸è¿‡æ˜¯<code>T</code>ï¼Œå¹¶é<code>const T</code>ã€‚å› æ­¤ï¼Œ<code>set</code>æˆ–<code>multiset</code>é‡Œçš„å…ƒç´ å¯èƒ½åœ¨ä½ æƒ³è¦çš„ä»»ä½•æ—¶å€™æ”¹å˜ã€‚ä¸éœ€è¦æ˜ å°„ã€‚</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">_Key</span><span class="p">,</span> <span class="k">typename</span> <span class="n">_Compare</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">less</span><span class="o">&lt;</span><span class="n">_Key</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="k">typename</span> <span class="n">_Alloc</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="n">_Key</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">set</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// typedefs:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">///@{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">/// Public typedefs.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">typedef</span> <span class="n">_Key</span>     <span class="n">key_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Key</span>     <span class="n">value_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Compare</span> <span class="n">key_compare</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Compare</span> <span class="n">value_compare</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Alloc</span>   <span class="n">allocator_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">///@}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä¸ºä»€ä¹ˆsetæˆ–multiseté‡Œçš„å…ƒç´ ä¸æ˜¯å¸¸æ•°ï¼Ÿ</strong></p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé›‡å‘˜çš„ç±»:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Employee</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>       <span class="c1">// è·å–é›‡å‘˜å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="nf">setName</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">);</span> <span class="c1">// è®¾ç½®é›‡å‘˜å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">getTitle</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>   <span class="c1">// è·å–é›‡å‘˜å¤´è¡”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="nf">setTitle</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">title</span><span class="p">);</span>     <span class="c1">// è®¾ç½®é›‡å‘˜å¤´è¡”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="nf">idNumber</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>             <span class="c1">// è·å–é›‡å‘˜IDå·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è®©æˆ‘ä»¬åšåˆç†çš„å‡è®¾ï¼Œæ¯ä¸ªé›‡å‘˜æœ‰å”¯ä¸€çš„IDå·ï¼Œå°±æ˜¯<code>idNumber</code>å‡½æ•°è¿”å›çš„æ•°å­—ã€‚ç„¶åï¼Œå»ºç«‹ä¸€ä¸ªé›‡å‘˜çš„<code>set</code>ï¼Œå¾ˆæ˜¾ç„¶åº”è¯¥åªä»¥<code>ID</code>å·æ¥æ’åº<code>set</code>:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">IDNumberLess</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="n">Employee</span><span class="p">,</span> <span class="n">Employee</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span> <span class="c1">// å‚è§æ¡æ¬¾40
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Employees</span> <span class="n">lhs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">Employee</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">idNumber</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">idNumber</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">set</span><span class="o">&lt;</span><span class="n">Employee</span><span class="p">,</span> <span class="n">IDNumberLess</span><span class="o">&gt;</span> <span class="n">EmpIDSet</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">EmpIDSet</span> <span class="n">se</span><span class="p">;</span> <span class="c1">// seæ˜¯é›‡å‘˜çš„setï¼Œ æŒ‰ç…§IDå·æ’åº
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®é™…ä¸Šï¼Œé›‡å‘˜çš„<code>ID</code>å·æ˜¯<code>set</code>ä¸­å…ƒç´ çš„é”®ã€‚<strong>å…¶ä½™çš„é›‡å‘˜æ•°æ®åªæ˜¯è™šæœ‰å…¶è¡¨</strong>ã€‚åœ¨è¿™é‡Œï¼Œæ²¡æœ‰ç†ç”±ä¸èƒ½æŠŠä¸€ä¸ªç‰¹å®šé›‡å‘˜çš„å¤´è¡”æ”¹æˆæŸä¸ªæœ‰è¶£çš„ä¸œè¥¿:</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">Employee</span> <span class="n">selectedID</span><span class="p">;</span> <span class="c1">// å®¹çº³è¢«é€‰æ‹©çš„é›‡å‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span> <span class="c1">// IDå·çš„å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">EmpIDSet</span><span class="o">::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">selectedID</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span><span class="o">-&gt;</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// ç»™é›‡å‘˜æ–°å¤´è¡”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºåœ¨è¿™é‡Œæˆ‘ä»¬åªæ˜¯æ”¹å˜é›‡å‘˜çš„ä¸€ä¸ªä¸setæ’åºçš„æ–¹å¼æ— å…³çš„æ–¹é¢ï¼ˆä¸€ä¸ªé›‡å‘˜çš„éé”®éƒ¨åˆ†ï¼‰ï¼Œæ‰€ä»¥è¿™æ®µä»£ç ä¸ä¼šç ´åsetã€‚é‚£æ˜¯å®ƒåˆæ³•çš„åŸå› ã€‚ä½†å®ƒçš„åˆæ³•æ’é™¤äº†<code>set/multiset</code>çš„å…ƒç´ æ˜¯<code>const</code>çš„å¯èƒ½ã€‚è€Œä¸”é‚£æ˜¯å®ƒä»¬ä¸ºä»€ä¹ˆä¸æ˜¯çš„åŸå› ã€‚</p>
<p>å› ä¸º<code>set</code>æˆ–<code>multiset</code>é‡Œçš„å€¼ä¸æ˜¯<code>const</code>ï¼Œæ‰€ä»¥è¯•å›¾æ”¹å˜å®ƒä»¬å¯ä»¥ç¼–è¯‘ã€‚</p>
<p><font color=red>å¦‚æœä½ æ”¹å˜<code>set</code>æˆ–<code>multiset</code>é‡Œçš„å…ƒç´ ï¼Œ ä½ å¿…é¡»<strong>ç¡®ä¿ä¸æ”¹å˜ä¸€ä¸ªé”®éƒ¨åˆ†â€”â€”å½±å“å®¹å™¨æœ‰åºæ€§çš„å…ƒç´ éƒ¨åˆ†</strong>ã€‚å¦‚æœä½ åšäº†ï¼Œä½ ä¼šç ´åå®¹å™¨ï¼Œå†ä½¿ç”¨é‚£ä¸ªå®¹å™¨å°†äº§ç”Ÿæœªå®šä¹‰çš„ç»“æœï¼Œ è€Œä¸”é‚£æ˜¯ä½ çš„é”™è¯¯ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™ä¸ªé™åˆ¶åªåº”ç”¨äºè¢«åŒ…å«å¯¹è±¡çš„é”®éƒ¨åˆ†ã€‚å¯¹è¢«åŒ…å«å…ƒç´ çš„æ‰€æœ‰å…¶ä»–éƒ¨åˆ†æ¥è¯´ï¼Œæ˜¯å¼€æ”¾çš„: éšä¾¿æ”¹å˜ï¼</font></p>
<h2 id="é˜»æ­¢ä¿®æ”¹setå’Œmultisetå€¼">é˜»æ­¢ä¿®æ”¹setå’Œmultisetå€¼</h2>
<p>å³ä½¿<code>set</code>å’Œ<code>multiset</code>çš„å…ƒç´ ä¸æ˜¯<code>const</code>ï¼Œå®ç°ä»ç„¶æœ‰å¾ˆå¤šæ–¹å¼å¯ä»¥é˜»æ­¢å®ƒä»¬è¢«ä¿®æ”¹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå®ç°å¯ä»¥è®©ç”¨äº<code>set&lt;T&gt;::iteratorçš„operator*</code>è¿”å›ä¸€ä¸ªå¸¸æ•°<code>T&amp;</code>ã€‚å³ï¼Œå®ƒå¯ä»¥è®©<code>set</code>çš„è¿­ä»£å™¨è§£å¼•ç”¨çš„ç»“æœæ˜¯<code>set</code>å…ƒç´ çš„å¸¸é‡å¼•ç”¨ã€‚</p>
<p>åœ¨è¿™æ ·çš„å®ç°ä¸‹ï¼Œå°†æ²¡æœ‰åŠæ³•ä¿®æ”¹<code>set</code>æˆ–<code>multiset</code>çš„å…ƒç´ ï¼Œå› ä¸ºæ‰€æœ‰è®¿é—®é‚£äº›å…ƒç´ çš„æ–¹æ³•éƒ½å°†åœ¨è®©ä½ è®¿é—®ä¹‹å‰åŠ ä¸€ä¸ª<code>const</code>ã€‚</p>
<h2 id="è¦ä¸è¦ä¿®æ”¹setå’Œmultisetå€¼">è¦ä¸è¦ä¿®æ”¹setå’Œmultisetå€¼</h2>
<ol>
<li>å¦‚æœ<strong>ä¸å…³å¿ƒç§»æ¤æ€§</strong>ï¼Œä½ æƒ³è¦æ”¹å˜setæˆ–multisetä¸­å…ƒç´ çš„å€¼ï¼Œè€Œä¸”ä½ çš„STLå®ç°è®©ä½ ä¾¥å¹¸æˆåŠŸï¼Œç»§ç»­åšã€‚åªæ˜¯è¦ç¡®å®šä¸è¦æ”¹å˜å…ƒç´ çš„é”®éƒ¨åˆ†ï¼Œå³ï¼Œä¼šå½±å“å®¹å™¨æœ‰åºæ€§çš„å…ƒç´ éƒ¨åˆ†ã€‚</li>
<li>å¦‚æœ<strong>åœ¨ä¹ç§»æ¤æ€§</strong>ï¼Œå°±è®¤ä¸ºsetå’Œmultisetä¸­çš„å…ƒç´ ä¸èƒ½è¢«ä¿®æ”¹ï¼Œè‡³å°‘ä¸èƒ½åœ¨æ²¡æœ‰æ˜ å°„çš„æƒ…å†µä¸‹</li>
</ol>
<p><strong>Solution: æ˜ å°„åˆ°ä¸€ä¸ªå¼•ç”¨</strong></p>
<p>æœ‰æ—¶å€™å®Œå…¨æœ‰ç†ç”±æ”¹å˜<code>set</code>æˆ–<code>multiset</code>å…ƒç´ çš„éé”®éƒ¨åˆ†ã€‚ä¾‹å¦‚åˆšçœ‹çš„ä¸èƒ½åœ¨ä¸€äº›å®ç°ä¸‹ç¼–è¯‘çš„<code>setTitle</code>è°ƒç”¨:</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">EmpIDSet</span><span class="o">::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">selectedID</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span><span class="o">-&gt;</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// æœ‰äº›STLå®ç°ä¼šæ‹’ç»è¿™æ ·ï¼Œå› ä¸º*iæ˜¯const
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºäº†è®©å®ƒå¯ä»¥ç¼–è¯‘å¹¶ä¸”è¡Œä¸ºæ­£ç¡®ï¼Œæˆ‘ä»¬å¿…é¡»æ˜ å°„æ‰*içš„å¸¸é‡æ€§ã€‚è¿™æ˜¯é‚£ä¹ˆåšçš„æ­£ç¡®æ–¹æ³•:</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">const_cast</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">).</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// æ˜ å°„æ‰*içš„å¸¸é‡æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è¿™å¯ä»¥å¾—åˆ°iæŒ‡å‘çš„å¯¹è±¡ï¼Œå‘Šè¯‰ä½ çš„ç¼–è¯‘å™¨æŠŠæ˜ å°„çš„ç»“æœå½“ä½œä¸€ä¸ªï¼ˆéå¸¸æ•°ï¼‰Employeeçš„å¼•ç”¨ï¼Œç„¶ååœ¨é‚£ä¸ªå¼•ç”¨ä¸Šè°ƒç”¨setTitleã€‚</strong></p>
<p><strong>é”™è¯¯ç‰ˆæœ¬çš„æ˜ å°„</strong></p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span>
</span></span><span class="line"><span class="cl">  <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">).</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// æŠŠ*iæ˜ å°„åˆ°ä¸€ä¸ªEmployee
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒä¹Ÿç­‰ä»·äºå¦‚ä¸‹å†…å®¹:</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">((</span><span class="n">Employee</span><span class="p">)(</span><span class="o">*</span><span class="n">i</span><span class="p">)).</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// ä½¿ç”¨Cæ˜ å°„è¯­æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤ä¸ªéƒ½èƒ½ç¼–è¯‘ï¼Œè€Œä¸”å› ä¸ºå®ƒä»¬ç­‰ä»·ï¼Œæ‰€ä»¥å®ƒä»¬é”™çš„åŸå› ä¹Ÿç›¸åŒã€‚</p>
<p><strong>åœ¨è¿è¡ŒæœŸï¼Œå®ƒä»¬ä¸èƒ½ä¿®æ”¹<code>*i</code>ï¼</strong></p>
<p><strong>åœ¨è¿™ä¸¤ä¸ªæƒ…å†µé‡Œï¼Œæ˜ å°„çš„ç»“æœæ˜¯ä¸€ä¸ª<code>*i</code>å‰¯æœ¬çš„ä¸´æ—¶åŒ¿åå¯¹è±¡ï¼Œè€ŒsetTitleæ˜¯åœ¨åŒ¿åçš„ç‰©ä½“ä¸Šè°ƒç”¨ï¼Œä¸åœ¨<code>*i</code>ä¸Š<code>ï¼*i</code>æ²¡è¢«ä¿®æ”¹ï¼Œå› ä¸ºsetTitleä»æœªåœ¨é‚£ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ï¼Œå®ƒåœ¨é‚£ä¸ªå¯¹è±¡çš„å‰¯æœ¬ä¸Šè°ƒç”¨ã€‚</strong></p>
<p>ä¸¤ä¸ªå¥æ³•å½¢å¼ç­‰ä»·äºè¿™ä¸ª:</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span>
</span></span><span class="line"><span class="cl">  <span class="n">Employee</span> <span class="nf">tempCopy</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">);</span> <span class="c1">// æŠŠ*iæ‹·è´åˆ°tempCopy
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">tempCopy</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// ä¿®æ”¹tempCopy
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡æ˜ å°„åˆ°å¼•ç”¨ï¼Œæˆ‘ä»¬é¿å…äº†å»ºç«‹ä¸€ä¸ªæ–°å¯¹è±¡ã€‚</p>
<p>å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œæ˜ å°„çš„ç»“æœæ˜¯ä¸€ä¸ªç°æœ‰å¯¹è±¡çš„å¼•ç”¨ï¼Œ<code>i</code>æŒ‡å‘çš„å¯¹è±¡ã€‚</p>
<p>å½“æˆ‘ä»¬åœ¨æœ‰è¿™ä¸ªå¼•ç”¨æŒ‡å®šçš„å¯¹è±¡ä¸Šè°ƒç”¨setTitleæ—¶ï¼Œæˆ‘ä»¬æ˜¯åœ¨<code>*i</code>ä¸Šè°ƒç”¨setTitleï¼Œè€Œä¸”é‚£æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¸èƒ½å»æ‰mapå’Œmultimapçš„å¸¸é‡æ€§</strong></p>
<p>æ³¨æ„<code>map&lt;K, V&gt;</code>æˆ–<code>multimap&lt;K, V&gt;</code>åŒ…å«<code>pair&lt;const K, V&gt;</code>ç±»å‹çš„å…ƒç´ ã€‚</p>
<p>é‚£ä¸ª<code>const</code>è¡¨æ˜<code>pair</code>çš„ç¬¬ä¸€ä¸ªç»„ä»¶è¢«å®šä¹‰ä¸ºå¸¸é‡ï¼Œè€Œé‚£æ„å‘³ç€è¯•å›¾ä¿®æ”¹å®ƒæ˜¯æœªå®šä¹‰çš„è¡Œä¸ºï¼ˆå³ä½¿æ˜ å°„æ‰å®ƒçš„å¸¸é‡æ€§ï¼‰ã€‚</p>
<p>ç†è®ºä¸Šï¼Œä¸€ä¸ªSTLå®ç°å¯èƒ½æŠŠè¿™æ ·çš„å€¼å†™åˆ°ä¸€ä¸ªåªè¯»çš„å†…å­˜ä½ç½®ï¼ˆæ¯”å¦‚ï¼Œä¸€æ—¦å†™äº†å°±é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›è¡Œå†™ä¿æŠ¤çš„è™šæ‹Ÿå†…å­˜é¡µï¼‰ï¼Œè€Œä¸”è¯•å›¾æ˜ å°„æ‰å®ƒçš„å¸¸é‡æ€§ï¼Œæœ€å¤šï¼Œæ²¡æœ‰æ•ˆæœã€‚</p>
<p>å¦‚æœä½ æ˜¯ä¸€ä¸ªåšæŒéµå¾ªæ ‡å‡†æ‹Ÿå®šçš„è§„åˆ™çš„äººï¼Œä½ ç»ä¸ä¼šè¯•å›¾æ˜ å°„æ‰<code>map</code>æˆ–<code>multimap</code>é”®çš„å¸¸é‡æ€§ã€‚</p>
<h2 id="å®‰å…¨ä¿®æ”¹å…ƒç´ æ­¥éª¤">å®‰å…¨ä¿®æ”¹å…ƒç´ æ­¥éª¤</h2>
<p>æƒ³è¦æ€»æ˜¯å¯ä»¥å·¥ä½œè€Œä¸”æ€»æ˜¯å®‰å…¨åœ°æ”¹å˜setã€multisetã€mapæˆ–multimapé‡Œçš„å…ƒç´ ï¼ŒæŒ‰5ä¸ªç®€å•çš„æ­¥éª¤å»åšï¼š</p>
<ol>
<li>å®šä½ä½ æƒ³è¦æ”¹å˜çš„å®¹å™¨å…ƒç´ ã€‚å¦‚æœä½ ä¸ç¡®å®šæœ€å¥½çš„æ–¹æ³•ï¼Œ æ¡æ¬¾45æä¾›äº†å…³äºæ€æ ·è¿›è¡Œé€‚å½“æœå¯»çš„æŒ‡å¯¼ã€‚</li>
<li>æ‹·è´ä¸€ä»½è¦è¢«ä¿®æ”¹çš„å…ƒç´ ã€‚å¯¹mapæˆ–multimapè€Œè¨€ï¼Œç¡®å®šä¸è¦æŠŠå‰¯æœ¬çš„ç¬¬ä¸€ä¸ªå…ƒç´ å£°æ˜ä¸ºconstã€‚æ¯•ç«Ÿï¼Œä½ æƒ³è¦æ”¹å˜å®ƒï¼</li>
<li>ä¿®æ”¹å‰¯æœ¬ï¼Œä½¿å®ƒæœ‰ä½ æƒ³è¦åœ¨å®¹å™¨é‡Œçš„å€¼ã€‚</li>
<li>ä»å®¹å™¨é‡Œåˆ é™¤å…ƒç´ ï¼Œé€šå¸¸é€šè¿‡è°ƒç”¨eraseï¼ˆå‚è§æ¡æ¬¾9ï¼‰ã€‚</li>
<li>æŠŠæ–°å€¼æ’å…¥å®¹å™¨ã€‚å¦‚æœæ–°å…ƒç´ åœ¨å®¹å™¨çš„æ’åºé¡ºåºä¸­çš„ä½ç½®æ­£å¥½ç›¸åŒæˆ–ç›¸é‚»äºåˆ é™¤çš„å…ƒç´ ï¼Œä½¿ç”¨insertçš„â€œæç¤ºâ€å½¢å¼æŠŠæ’å…¥çš„æ•ˆç‡ä»å¯¹æ•°æ—¶é—´æ”¹è¿›åˆ°åˆ†æ‘Šçš„å¸¸æ•°æ—¶é—´ã€‚ä½¿ç”¨ä½ ä»ç¬¬ä¸€æ­¥è·å¾—çš„è¿­ä»£å™¨ä½œä¸ºæç¤ºã€‚</li>
</ol>
<p><strong>ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼šå…ˆåˆ é™¤ï¼Œå†æ’å…¥æ–°çš„ã€‚</strong></p>
<p><strong>Example:</strong></p>
<p>è¿™æ˜¯åŒä¸€ä¸ªç´¯äººçš„é›‡å‘˜ä¾‹å­ï¼Œè¿™æ¬¡ä»¥å®‰å…¨ã€å¯ç§»æ¤çš„æ–¹å¼å†™:</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">EmpIDSet</span> <span class="n">se</span><span class="p">;</span> <span class="c1">// åŒå‰ï¼Œseæ˜¯ä¸€ä¸ªä»¥IDå·æ’åºçš„é›‡å‘˜set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Employee</span> <span class="n">selectedID</span><span class="p">;</span> <span class="c1">// åŒå‰ï¼ŒselectedIDæ˜¯ä¸€ä¸ªå¸¦æœ‰éœ€è¦IDå·çš„é›‡å‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">EmpIDSet</span><span class="o">::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">selectedID</span><span class="p">);</span> <span class="c1">// ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ°è¦æ”¹å˜çš„å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">!=</span><span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Employee</span> <span class="nf">e</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">);</span> <span class="c1">// ç¬¬äºŒæ­¥ï¼šæ‹·è´è¿™ä¸ªå…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">se</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">i</span><span class="o">++</span><span class="p">);</span>  <span class="c1">// ç¬¬ä¸‰æ­¥ï¼šåˆ é™¤è¿™ä¸ªå…ƒç´ ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="c1">// è‡ªå¢è¿™ä¸ªè¿­ä»£å™¨ä»¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="c1">// ä¿æŒå®ƒæœ‰æ•ˆï¼ˆå‚è§æ¡æ¬¾9ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">e</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// ç¬¬å››æ­¥ï¼šä¿®æ”¹è¿™ä¸ªå‰¯æœ¬
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">se</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>               <span class="c1">// ç¬¬äº”æ­¥ï¼šæ’å…¥æ–°å€¼ï¼›æç¤ºå®ƒçš„ä½ç½®å’ŒåŸå…ˆå…ƒç´ çš„ä¸€æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>Effective STL [19] | äº†è§£ç›¸ç­‰å’Œç­‰ä»·çš„åŒºåˆ«</title><link>https://jianye0428.github.io/posts/clause_19/</link><pubDate>Thu, 10 Aug 2023 08:30:55 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_19/</guid><description><![CDATA[<h2 id="æ¯”è¾ƒå¯¹è±¡">æ¯”è¾ƒå¯¹è±¡</h2>
<p>STLå……æ»¡äº†æ¯”è¾ƒå¯¹è±¡æ˜¯å¦æœ‰åŒæ ·çš„å€¼ã€‚æ¯”å¦‚ï¼Œå½“ä½ ç”¨<code>find</code>æ¥å®šä½åŒºé—´ä¸­ç¬¬ä¸€ä¸ªæœ‰ç‰¹å®šå€¼çš„å¯¹è±¡çš„ä½ç½®ï¼Œ<code>find</code>å¿…é¡»å¯ä»¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼Œçœ‹çœ‹ä¸€ä¸ªçš„å€¼æ˜¯å¦ä¸å¦ä¸€ä¸ªç›¸ç­‰ã€‚åŒæ ·ï¼Œå½“ä½ å°è¯•å‘<code>set</code>ä¸­æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ æ—¶ï¼Œ<code>set::insert</code>å¿…é¡»å¯ä»¥åˆ¤æ–­é‚£ä¸ªå…ƒç´ çš„å€¼æ˜¯å¦å·²ç»åœ¨<code>set</code>ä¸­äº†ã€‚</p>
<p><code>find</code>ç®—æ³•å’Œ<code>set</code>çš„<code>insert</code>æˆå‘˜å‡½æ•°æ˜¯å¾ˆå¤šå¿…é¡»åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸åŒçš„å‡½æ•°çš„ä»£è¡¨ã€‚ä½†å®ƒä»¬å®ç°æ–¹å¼ä¸åŒï¼Œfindå¯¹â€œç›¸åŒâ€çš„å®šä¹‰æ˜¯ç›¸ç­‰ï¼ŒåŸºäº<code>operator==</code>ã€‚<code>set::insert</code>å¯¹â€œç›¸åŒâ€çš„å®šä¹‰æ˜¯ç­‰ä»·ï¼Œé€šå¸¸åŸºäº<code>operator&lt;</code>ã€‚å› ä¸ºæœ‰å®šä¹‰ä¸åŒï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¸€ä¸ªå®šä¹‰è§„å®šäº†ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„å€¼è€Œå¦ä¸€ä¸ªå®šä¹‰åˆ¤å®šå®ƒä»¬æ²¡æœ‰ã€‚ç»“æœï¼Œå¦‚æœä½ æƒ³æœ‰æ•ˆä½¿ç”¨STLï¼Œé‚£ä¹ˆä½ å¿…é¡»æ˜ç™½ç›¸ç­‰å’Œç­‰ä»·çš„åŒºåˆ«ã€‚</p>
<p><strong>ç›¸ç­‰</strong></p>
<p>æ“ä½œä¸Šæ¥è¯´ï¼Œç›¸ç­‰çš„æ¦‚å¿µæ˜¯åŸºäº<code>operator</code>çš„ã€‚å¦‚æœè¡¨è¾¾å¼â€œ<code>x == y</code>â€è¿”å›trueï¼Œ<code>x</code>å’Œ<code>y</code>æœ‰ç›¸ç­‰çš„å€¼ï¼Œå¦åˆ™å®ƒä»¬æ²¡æœ‰ã€‚</p>
<p><strong><font color=red>xå’Œyæœ‰ç›¸ç­‰çš„å€¼å¹¶ä¸æ„å‘³ç€æ‰€æœ‰å®ƒä»¬çš„æˆå‘˜æœ‰ç›¸ç­‰çš„å€¼</font></strong>ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰ä¸€ä¸ªå†…éƒ¨è®°å½•äº†æœ€åä¸€æ¬¡è®¿é—®çš„Widgetç±»ã€‚</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"> <span class="n">TimeStamp</span> <span class="n">lastAccessed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªç”¨äºWidgetçš„å¿½ç•¥è¿™ä¸ªåŸŸçš„operator:</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">operator</span><span class="p">(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¿½ç•¥lastAccessedåŸŸçš„ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œä¸¤ä¸ª<code>Widget</code>å³ä½¿å®ƒä»¬çš„<code>lastAccessed</code>åŸŸä¸åŒä¹Ÿå¯ä»¥æœ‰ç›¸ç­‰çš„å€¼ã€‚</p>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œç›¸ç­‰æ„å‘³ç€ä¸¤ä¸ªå˜é‡çš„å€¼ç›¸åŒï¼Œä½†æ˜¯å¦‚æœæ¯”è¾ƒ2ä¸ªå¯¹è±¡ï¼Œå› ä¸ºæ¯”è¾ƒå‡½æ•°å¯ä»¥è‡ªå®šä¹‰ï¼Œå› æ­¤æœ‰æ—¶å€™å¯¹è±¡çš„æŸäº›æˆå‘˜å˜é‡å€¼ä¸åŒä¹Ÿä¼šè®¾å®š2ä¸ªå¯¹è±¡ç›¸ç­‰ã€‚</p>
<p><strong>ç­‰ä»·</strong></p>
<p>==ç­‰ä»·æ˜¯åŸºäºåœ¨ä¸€ä¸ªæœ‰åºåŒºé—´ä¸­å¯¹è±¡å€¼çš„ç›¸å¯¹ä½ç½®==ã€‚</p>
<p>ç­‰ä»·ä¸€èˆ¬åœ¨æ¯ç§æ ‡å‡†å…³è”å®¹å™¨ï¼ˆæ¯”å¦‚ï¼Œsetã€multisetã€mapå’Œmultimapï¼‰çš„ä¸€éƒ¨åˆ†â€”â€”æ’åºé¡ºåºæ–¹é¢æœ‰æ„ä¹‰ã€‚æ³¨æ„è¿™é‡Œçš„åº”ç”¨åœºæ™¯æ˜¯==æ’åº==ã€‚</p>
<p>ä¸¤ä¸ªå¯¹è±¡xå’Œyå¦‚æœåœ¨å…³è”å®¹å™¨cçš„æ’åºé¡ºåºä¸­æ²¡æœ‰å“ªä¸ªæ’åœ¨å¦ä¸€ä¸ªä¹‹å‰ï¼Œé‚£ä¹ˆå®ƒä»¬å…³äºcä½¿ç”¨çš„æ’åºé¡ºåºæœ‰ç­‰ä»·çš„å€¼ã€‚</p>
<p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªset<Widget> sã€‚ä¸¤ä¸ªWidget w1å’Œw2ï¼Œå¦‚æœåœ¨sçš„æ’åºé¡ºåºä¸­æ²¡æœ‰å“ªä¸ªåœ¨å¦ä¸€ä¸ªä¹‹å‰ï¼Œé‚£ä¹ˆå…³äºså®ƒä»¬æœ‰ç­‰ä»·çš„å€¼ã€‚set<Widget>çš„é»˜è®¤æ¯”è¾ƒå‡½æ•°æ˜¯less<Widget>ï¼Œè€Œé»˜è®¤çš„less<Widget>ç®€å•åœ°å¯¹Widgetè°ƒç”¨operator&lt;ï¼Œæ‰€ä»¥w1å’Œw2å…³äºoperator&lt;æœ‰ç­‰ä»·çš„å€¼å¦‚æœä¸‹é¢è¡¨è¾¾å¼ä¸ºçœŸï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="o">!</span><span class="p">(</span><span class="n">w1</span> <span class="o">&lt;</span> <span class="n">w2</span><span class="p">)</span> <span class="c1">// w1 &lt; w2æ—¶å®ƒéçœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&amp;&amp;</span> <span class="c1">// è€Œä¸”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">!</span><span class="p">(</span><span class="n">w2</span><span class="o">&lt;</span><span class="n">w1</span><span class="p">)</span> <span class="c1">// w2 &lt; w1æ—¶å®ƒéçœŸ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªæœ‰æ„ä¹‰ï¼š<font color=red>ä¸¤ä¸ªå€¼å¦‚æœæ²¡æœ‰å“ªä¸ªåœ¨å¦ä¸€ä¸ªä¹‹å‰ï¼ˆå…³äºæŸä¸ªæ’åºæ ‡å‡†ï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬ç­‰ä»·ï¼ˆæŒ‰ç…§é‚£ä¸ªæ ‡å‡†ï¼‰ã€‚</font>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”¨äºå…³è”å®¹å™¨çš„æ¯”è¾ƒå‡½æ•°ä¸æ˜¯<code>operator&lt;</code>æˆ–ç”šè‡³<code>less</code>ï¼Œå®ƒæ˜¯ç”¨æˆ·å®šä¹‰çš„åˆ¤æ–­å¼ã€‚æ¯ä¸ªæ ‡å‡†å…³è”å®¹å™¨é€šè¿‡å®ƒçš„<code>key_comp</code>æˆå‘˜å‡½æ•°æ¥è®¿é—®æ’åºåˆ¤æ–­å¼ï¼Œæ‰€ä»¥å¦‚æœä¸‹å¼æ±‚å€¼ä¸ºçœŸï¼Œä¸¤ä¸ªå¯¹è±¡xå’Œyå…³äºä¸€ä¸ªå…³è”å®¹å™¨cçš„æ’åºæ ‡å‡†æœ‰ç­‰ä»·çš„å€¼ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="o">!</span><span class="n">c</span><span class="p">.</span><span class="n">key_comp</span><span class="p">()(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">c</span><span class="p">.</span><span class="n">key_comp</span><span class="p">()(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="c1">// åœ¨cçš„æ’åºé¡ºåºä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¦‚æœxåœ¨yä¹‹å‰å®ƒéçœŸï¼ŒåŒæ—¶åœ¨cçš„æ’åºé¡ºåºä¸­,å¦‚æœyåœ¨xä¹‹å‰å®ƒéçœŸ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦å®Œå…¨é¢†ä¼š==ç›¸ç­‰==å’Œ==ç­‰ä»·==çš„å«ä¹‰ï¼Œè€ƒè™‘ä¸€ä¸ªå¿½ç•¥å¤§å°å†™çš„<code>set&lt;string&gt;</code>ï¼Œä¹Ÿå°±æ˜¯setçš„æ¯”è¾ƒå‡½æ•°å¿½ç•¥å­—ç¬¦ä¸²ä¸­å­—ç¬¦å¤§å°å†™çš„<code>set&lt;string&gt;</code>ã€‚è¿™æ ·çš„æ¯”è¾ƒå‡½æ•°ä¼šè®¤ä¸ºâ€œSTLâ€å’Œâ€œstLâ€æ˜¯ç­‰ä»·çš„ã€‚æ¡æ¬¾35æ¼”ç¤ºäº†æ€ä¹ˆå®ç°ä¸€ä¸ªå‡½æ•°ï¼Œ<code>ciStringCompare</code>ï¼Œå®ƒè¿›è¡Œäº†å¿½ç•¥å¤§å°å†™æ¯”è¾ƒï¼Œä½†setè¦ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°çš„ç±»å‹ï¼Œä¸æ˜¯çœŸçš„å‡½æ•°ã€‚è¦å¡«å¹³è¿™ä¸ªé¸¿æ²Ÿï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªoperator()è°ƒç”¨äº†ciStringCompareçš„ä»¿å‡½æ•°ç±»:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">CIStringCompare</span><span class="o">:</span> <span class="c1">// ç”¨äºå¿½ç•¥å¤§å°å†™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="c1">// å­—ç¬¦ä¸²æ¯”è¾ƒçš„ç±»ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">binary_function</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="n">ciStringCompare</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);</span> <span class="c1">// å…³äºciStringCompare
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…·ä½“å®ç°ä¸º:</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">ciCharCompare</span><span class="p">(</span><span class="kt">char</span> <span class="n">c1</span><span class="p">,</span> <span class="kt">char</span> <span class="n">c2</span><span class="p">)</span> <span class="c1">// å¿½ç•¥å¤§å°å†™æ¯”è¾ƒå­—ç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>   <span class="c1">// c1å’Œc2ï¼Œå¦‚æœc1 &lt; c2è¿”å›-1ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// å¦‚æœc1==c2è¿”å›0ï¼Œå¦‚æœc1 &gt; c2è¿”å›1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">Ic1</span> <span class="o">=</span> <span class="n">tolower</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c1</span><span class="p">));</span><span class="c1">// è½¬æˆå°å†™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">Ic2</span> <span class="o">=</span> <span class="n">tolower</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">Ic1</span> <span class="o">&lt;</span> <span class="n">Ic2</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">lc1</span> <span class="o">&gt;</span> <span class="n">Ic2</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»™å®š<code>CIStringCompare</code>ï¼Œè¦å»ºç«‹ä¸€ä¸ªå¿½ç•¥å¤§å°å†™çš„set<string>å°±å¾ˆç®€å•äº†:</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">CIStringCompare</span><span class="o">&gt;</span> <span class="n">ciss</span><span class="p">;</span> <span class="c1">// ciss = â€œcase-insensitive
</span></span></span><span class="line"><span class="cl"><span class="c1">// string setâ€
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæˆ‘ä»¬å‘è¿™ä¸ªsetä¸­æ’å…¥â€œ<code>Persephone</code>â€å’Œâ€œ<code>persephone</code>â€ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²åŠ å…¥äº†ï¼Œå› ä¸ºç¬¬äºŒä¸ªç­‰ä»·äºç¬¬ä¸€ä¸ªï¼š</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">ciss</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#34;Persephone&#34;</span><span class="p">);</span> <span class="c1">// ä¸€ä¸ªæ–°å…ƒç´ æ·»åŠ åˆ°setä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ciss</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#34;persephone&#34;</span><span class="p">);</span> <span class="c1">// æ²¡æœ‰æ–°å…ƒç´ æ·»åŠ åˆ°setä¸­
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæˆ‘ä»¬ç°åœ¨ä½¿ç”¨setçš„findæˆå‘˜å‡½æ•°æœç´¢å­—ç¬¦ä¸²â€œpersephoneâ€ï¼Œæœç´¢ä¼šæˆåŠŸï¼Œ</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">ciss</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#34;persephone&#34;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ciss</span><span class="p">.</span><span class="n">end</span><span class="p">())...</span> <span class="c1">// è¿™ä¸ªæµ‹è¯•ä¼šæˆåŠŸ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†å¦‚æœæˆ‘ä»¬ç”¨éæˆå‘˜çš„findç®—æ³•ï¼Œæœç´¢ä¼šå¤±è´¥ï¼š</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">find</span><span class="p">(</span><span class="n">ciss</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">ciss</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;persephone&#34;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ciss</span><span class="p">.</span><span class="n">end</span><span class="p">())...</span> <span class="c1">// è¿™ä¸ªæµ‹è¯•ä¼šå¤±è´¥
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£æ˜¯å› ä¸ºâ€œ<code>persephone</code>â€ç­‰ä»·äºâ€œ<code>Persephone</code>â€ï¼ˆå…³äºæ¯”è¾ƒä»¿å‡½æ•°CIStringCompareï¼‰ï¼Œä½†ä¸ç­‰äºå®ƒï¼ˆå› ä¸ºstring(&ldquo;persephone&rdquo;) != string(&ldquo;Persephone&rdquo;)ï¼‰ã€‚ä½ å¯èƒ½ä¼šå¥‡æ€ªä¸ºä»€ä¹ˆæ ‡å‡†å…³è”å®¹å™¨æ˜¯åŸºäºç­‰ä»·è€Œä¸æ˜¯ç›¸ç­‰ã€‚æ¯•ç«Ÿï¼Œå¤§å¤šæ•°ç¨‹åºå‘˜å¯¹ç›¸ç­‰æœ‰æ„Ÿè§‰è€Œç¼ºä¹ç­‰ä»·çš„æ„Ÿè§‰ã€‚</p>
<p><font color=red>æ ‡å‡†å…³è”å®¹å™¨ä¿æŒæœ‰åºï¼Œæ‰€ä»¥æ¯ä¸ªå®¹å™¨å¿…é¡»æœ‰ä¸€ä¸ªå®šä¹‰äº†æ€ä¹ˆä¿æŒä¸œè¥¿æœ‰åºçš„æ¯”è¾ƒå‡½æ•°ï¼ˆé»˜è®¤æ˜¯lessï¼‰ã€‚ç­‰ä»·æ˜¯æ ¹æ®è¿™ä¸ªæ¯”è¾ƒå‡½æ•°å®šä¹‰çš„ï¼Œæ‰€ä»¥æ ‡å‡†å…³è”å®¹å™¨çš„ç”¨æˆ·åªéœ€è¦ä¸ºä»–ä»¬è¦ä½¿ç”¨çš„ä»»æ„å®¹å™¨æŒ‡å®šä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼ˆå†³å®šæ’åºé¡ºåºçš„é‚£ä¸ªï¼‰ã€‚</p>
<p>å¦‚æœå…³è”å®¹å™¨ä½¿ç”¨ç›¸ç­‰æ¥å†³å®šä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æœ‰ç›¸åŒçš„å€¼ï¼Œé‚£ä¹ˆæ¯ä¸ªå…³è”å®¹å™¨å°±éœ€è¦ï¼Œé™¤äº†ç”¨äºæ’åºçš„æ¯”è¾ƒå‡½æ•°ï¼Œè¿˜éœ€è¦ä¸€ä¸ªç”¨äºåˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰çš„æ¯”è¾ƒå‡½æ•°ã€‚ï¼ˆé»˜è®¤çš„ï¼Œè¿™ä¸ªæ¯”è¾ƒå‡½æ•°å¤§æ¦‚åº”è¯¥æ˜¯equal_toï¼Œä½†æœ‰è¶£çš„æ˜¯equal_toä»æ²¡æœ‰åœ¨STLä¸­ç”¨åšé»˜è®¤æ¯”è¾ƒå‡½æ•°ã€‚å½“åœ¨STLä¸­éœ€è¦ç›¸ç­‰æ—¶ï¼Œä¹ æƒ¯æ˜¯ç®€å•åœ°ç›´æ¥è°ƒç”¨operator==ã€‚æ¯”å¦‚ï¼Œè¿™æ˜¯éæˆå‘˜findç®—æ³•æ‰€ä½œçš„ã€‚ï¼‰</font></p>
<p><strong><font color=blue>è¯´ç™½äº†ï¼Œå°±æ˜¯ç­‰ä»·æ˜¯ä¸ºå®¹å™¨æ’åºæœåŠ¡çš„ï¼Œå¦‚æœå®¹å™¨æƒ³è¦æ’å…¥å¤šä¸ªè½¬åŒ–ä¸ºå°å†™åç›¸ç­‰çš„å•è¯ï¼Œå®¹å™¨ä¼šåˆ¤å®šè¿™äº›å•è¯ç­‰ä»·ï¼Œè™½ç„¶å®ƒä»¬æœ¬èº«ä¸ç›¸ç­‰ï¼Œè¿™æ ·å°±èƒ½å¤Ÿå¾ˆå¥½åœ°ä¿æŒå®¹å™¨å†…å•è¯çš„å”¯ä¸€æ€§å’Œå•è¯çš„æœ‰åºæ€§ã€‚å¦åˆ™é€šè¿‡æŸ¥æ‰¾æˆ–æ’å…¥è¯¥å•è¯çš„æ—¶å€™ï¼Œå®¹å™¨å†…éƒ¨å°±ä¼šå‘ç”Ÿæ­§ä¹‰ï¼Œé€ æˆä¸ç¬¦åˆä½¿ç”¨è€…é€»è¾‘ã€‚</font></strong></p>
<p>è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç±»ä¼¼setçš„STLå®¹å™¨å«åš<code>set2CF</code>ï¼Œâ€œset with two comparison functionsâ€ã€‚<strong><font color=red>ç¬¬ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ç”¨æ¥å†³å®šsetçš„æ’åºé¡ºåºï¼Œç¬¬äºŒä¸ªç”¨æ¥å†³å®šæ˜¯å¦ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„å€¼ã€‚</font></strong> ç°åœ¨è€ƒè™‘è¿™set2CFï¼š</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">set2CF</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">CIStringCompare</span><span class="p">,</span> <span class="n">equal_to</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">s</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œså†…éƒ¨æ’åºå®ƒçš„å­—ç¬¦ä¸²æ—¶ä¸è€ƒè™‘å¤§å°å†™ï¼Œç­‰ä»·æ ‡å‡†ç›´è§‰ä¸Šæ˜¯è¿™æ ·ï¼šå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­ä¸€ä¸ªç­‰äºå¦ä¸€ä¸ªï¼Œé‚£ä¹ˆå®ƒä»¬æœ‰ç›¸åŒçš„å€¼ã€‚è®©æˆ‘ä»¬å‘sä¸­æ’å…¥å“ˆè¿ªæ–¯å¼ºå¨¶çš„æ–°å¨˜ï¼ˆPersephoneï¼‰çš„ä¸¤ä¸ªæ‹¼å†™:</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">s</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#34;Persephone&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#34;persephone&#34;</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å¦‚æœæˆ‘ä»¬è¯´<code>&quot;Persephone&quot; != &quot;persephone&quot;</code>ç„¶åä¸¤ä¸ªéƒ½æ’å…¥sï¼Œå®ƒä»¬åº”è¯¥æ˜¯ä»€ä¹ˆé¡ºåºï¼Ÿ</p>
</blockquote>
<p>è®°ä½æ’åºå‡½æ•°ä¸èƒ½åˆ†åˆ«å‘Šè¯‰å®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥ä»¥ä»»æ„é¡ºåºæ’å…¥ï¼Œå› æ­¤æ”¾å¼ƒä»¥ç¡®å®šçš„é¡ºåºéå†setå†…å®¹çš„èƒ½åŠ›å—ï¼Ÿï¼ˆä¸èƒ½ä»¥ç¡®å®šçš„é¡ºåºéå†å…³è”å®¹å™¨å…ƒç´ å·²ç»æŠ˜ç£¨ç€<code>multiset</code>å’Œ<code>multimap</code>äº†ï¼Œå› ä¸ºæ ‡å‡†æ²¡æœ‰è§„å®šç­‰ä»·çš„å€¼ï¼ˆå¯¹äºmultisetï¼‰æˆ–é”®ï¼ˆå¯¹äºmultimapï¼‰çš„ç›¸å¯¹é¡ºåºã€‚ï¼‰æˆ–è€…æˆ‘ä»¬åšæŒsçš„å†…å®¹çš„ä¸€ä¸ªç¡®å®šé¡ºåºå¹¶å¿½ç•¥ç¬¬äºŒæ¬¡æ’å…¥çš„å°è¯•ï¼ˆâ€œpersephoneâ€çš„é‚£ä¸ªï¼‰? å¦‚æœæˆ‘ä»¬é‚£ä¹ˆåšï¼Œè¿™é‡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#34;persephone&#34;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">s</span><span class="p">.</span><span class="n">end</span><span class="p">())...</span> <span class="c1">// è¿™ä¸ªæµ‹è¯•æˆåŠŸæˆ–å¤±è´¥ï¼Ÿ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¤§æ¦‚**<font color=red>findä½¿ç”¨äº†ç­‰ä»·æ£€æŸ¥</font>**ï¼Œä½†å¦‚æœæˆ‘ä»¬ä¸ºäº†ç»´æŠ¤sä¸­å…ƒç´ çš„ä¸€ä¸ªç¡®å®šé¡ºåºè€Œå¿½ç•¥äº†ç¬¬äºŒä¸ªinsertçš„è°ƒç”¨ï¼Œè¿™ä¸ªfindä¼šå¤±è´¥ï¼Œå³ä½¿â€œpersephoneâ€çš„æ’å…¥ç”±äºå®ƒæ˜¯ä¸€ä¸ªé‡å¤çš„å€¼çš„åŸåˆ™è€Œè¢«å¿½ç•¥ï¼</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>é€šè¿‡åªä½¿ç”¨ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°å¹¶ä½¿ç”¨ç­‰ä»·ä½œä¸ºä¸¤ä¸ªå€¼â€œç›¸ç­‰â€çš„æ„ä¹‰çš„ä»²è£è€…ï¼Œæ ‡å‡†å…³è”å®¹å™¨é¿å¼€äº†å¾ˆå¤šä¼šç”±å…è®¸ä¸¤ä¸ªæ¯”è¾ƒå‡½æ•°è€Œå¼•å‘çš„å›°éš¾ã€‚</p>
<p>ä¸€å¼€å§‹è¡Œä¸ºå¯èƒ½çœ‹èµ·æ¥æœ‰äº›å¥‡æ€ªï¼ˆç‰¹åˆ«æ˜¯å½“ä½ å‘ç°æˆå‘˜å’Œéæˆå‘˜findå¯èƒ½è¿”å›ä¸åŒç»“æœï¼‰ï¼Œä½†æœ€åï¼Œå®ƒé¿å…äº†ä¼šç”±åœ¨æ ‡å‡†å…³è”å®¹å™¨ä¸­æ··ç”¨ç›¸ç­‰å’Œç­‰ä»·é€ æˆçš„æ··ä¹±ã€‚</p>
]]></description></item><item><title>Effective STL [20] | ä¸ºæŒ‡é’ˆçš„å…³è”å®¹å™¨æŒ‡å®šæ¯”è¾ƒç±»å‹</title><link>https://jianye0428.github.io/posts/clause_20/</link><pubDate>Fri, 11 Aug 2023 16:10:59 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_20/</guid><description><![CDATA[<h2 id="example">Example</h2>
<p>å‡å®šä½ æœ‰ä¸€ä¸ªstring*æŒ‡é’ˆçš„setï¼Œä½ æŠŠä¸€äº›åŠ¨ç‰©çš„åå­—æ’å…¥è¿›set:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*&gt;</span> <span class="n">ssp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ssp</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="s">&#34;Anteater&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">ssp</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="s">&#34;Wombat&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">ssp</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="s">&#34;Lemur&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">ssp</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="s">&#34;Penguin&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ssp = â€œset of string ptrsâ€
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åä½ å†™äº†ä¸‹åˆ—ä»£ç æ‰“å°setçš„å†…å®¹ï¼Œå¸Œæœ›å­—ç¬¦ä¸²æŒ‰å­—æ¯é¡ºåºå‡ºç°ã€‚æ¯•ç«Ÿï¼Œç¡®å®šsetä¿æŒå®ƒä»¬çš„å†…å®¹æœ‰åºã€‚</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*&gt;::</span><span class="n">const_iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="n">i</span> <span class="o">!=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ æœŸæœ›çœ‹åˆ°</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Anteater
</span></span><span class="line"><span class="cl">Wombat
</span></span><span class="line"><span class="cl">Lemur
</span></span><span class="line"><span class="cl">Penguin</span></span></code></pre></td></tr></table>
</div>
</div><p>å®é™…è¿è¡Œç»“æœ:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="mh">0x5566364b5eb0</span>
</span></span><span class="line"><span class="cl"><span class="mh">0x5566364b5f10</span>
</span></span><span class="line"><span class="cl"><span class="mh">0x5566364b5f70</span>
</span></span><span class="line"><span class="cl"><span class="mh">0x5566364b5fd0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœæ˜¯4ä¸ªåå…­è¿›åˆ¶çš„æ•°ï¼Œä»£è¡¨æŒ‡é’ˆçš„å€¼ã€‚ å› ä¸ºsetå®¹çº³æŒ‡é’ˆï¼Œ<code>*i</code>ä¸æ˜¯ä¸€ä¸ª<code>string</code>ï¼Œæ˜¯ä¸€ä¸ª<code>string</code>çš„æŒ‡é’ˆã€‚</p>
<p>å¦‚æœä½ å·²ç»æ”¹ä¸ºè°ƒç”¨copyç®—æ³•ï¼Œ</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">copy</span><span class="p">(</span><span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">ostream_iterator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">));</span><span class="c1">// æŠŠsspä¸­çš„å­—ç¬¦ä¸²æ‹·è´åˆ°coutï¼ˆä½†è¿™ä¸èƒ½ç¼–è¯‘ï¼‰
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªcopyçš„è°ƒç”¨å°†ä¸èƒ½ç¼–è¯‘ï¼Œå› ä¸º<code>ostream_iterator</code>éœ€è¦çŸ¥é“è¢«æ‰“å°çš„å¯¹è±¡çš„ç±»å‹ï¼Œæ‰€ä»¥å½“ä½ å‘Šè¯‰å®ƒæ˜¯ä¸€ä¸ªstringæ—¶ï¼ˆé€šè¿‡ä½œä¸ºæ¨¡æ¿å‚æ•°ä¼ é€’ï¼‰ï¼Œç¼–è¯‘å™¨æ£€æµ‹åˆ°é‚£å’Œsspä¸­å‚¨å­˜çš„å¯¹è±¡ç±»å‹(æ˜¯<code>string*</code>)ä¹‹é—´ä¸åŒ¹é…ï¼Œå®ƒä»¬ä¼šæ‹’ç»ç¼–è¯‘ä»£ç ã€‚</p>
<p>æŠŠæ˜¾å¼å¾ªç¯ä¸­çš„<code>*i</code>æ”¹ä¸º<code>**i</code>ï¼Œä½ å¯èƒ½å¯ä»¥å¾—åˆ°ä½ æƒ³è¦çš„è¾“å‡ºï¼Œä½†ä¹Ÿå¯èƒ½ä¸ã€‚åŠ¨ç‰©åå­—å°†è¢«æ‰“å°ï¼Œä½†å®ƒä»¬æŒ‰å­—æ¯é¡ºåºå‡ºç°çš„æœºä¼šåªæ˜¯24ä»½ä¹‹1ã€‚sspä¿æŒå®ƒçš„å†…å®¹æœ‰åºï¼Œä½†æ˜¯å®ƒå®¹çº³çš„æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥å®ƒä»¥æŒ‡é’ˆçš„å€¼æ’åºï¼Œè€Œä¸ä»¥stringå€¼ã€‚å¯¹äºå››ä¸ªæŒ‡é’ˆå€¼å¯èƒ½æœ‰24ç§æ’åˆ—ï¼ˆï¼‰ï¼Œæ‰€ä»¥æŒ‡é’ˆè¢«å‚¨å­˜æ—¶æœ‰24ç§å¯èƒ½çš„é¡ºåºã€‚å› æ­¤ä½ çœ‹è§å­—ç¬¦ä¸²æŒ‰å­—æ¯æ’åºæœ‰24ä»½ä¹‹1çš„å‡ ç‡ã€‚</p>
<p>æˆ–è€…æ‰“å° <code>*string</code>çš„<code>char*</code>æ•°ç»„</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*&gt;::</span><span class="n">const_iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">c_str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="solution">Solution</h2>
<p>å½“æˆ‘ä»¬å†™ä¸‹<code>set&lt;string*&gt; ssp</code>;ï¼Œå…¶å®çœç•¥äº†ä¸€ä¸ªé»˜è®¤å‚æ•°<code>set&lt;string*, less&lt;string*&gt; &gt; ssp</code>;ï¼Œå®é™…ä¸Šè¿˜æœ‰ä¸ªé»˜è®¤å‚æ•°:</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="n">less</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*&gt;</span><span class="p">,</span> <span class="n">allocator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*&gt;</span> <span class="o">&gt;</span> <span class="n">ssp</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è‡ªå®šä¹‰ä»¿å‡½æ•°">è‡ªå®šä¹‰ä»¿å‡½æ•°</h2>
<p>å¦‚æœæƒ³è¦<code>string*</code>æŒ‡é’ˆä»¥å­—ç¬¦ä¸²å€¼ç¡®å®šé¡ºåºè¢«å‚¨å­˜åœ¨<code>set</code>ä¸­ï¼Œä¸èƒ½ä½¿ç”¨é»˜è®¤æ¯”è¾ƒä»¿å‡½æ•°ç±»<code>less&lt;string*&gt;</code>ã€‚</p>
<p><strong>å¿…é¡»æ”¹ä¸ºå†™è‡ªå·±çš„æ¯”è¾ƒä»¿å‡½æ•°ç±»ï¼Œå®ƒçš„å¯¹è±¡å¸¦æœ‰string*æŒ‡é’ˆå¹¶æŒ‰ç…§æŒ‡å‘çš„å­—ç¬¦ä¸²å€¼æ¥è¿›è¡Œæ’åº:</strong></p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">StringPtrLess</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps1</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps2</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="o">*</span><span class="n">ps1</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">ps2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå¯ä»¥ä½¿ç”¨<code>StringPtrLess</code>ä½œä¸º<code>ssp</code>çš„æ¯”è¾ƒç±»å‹:</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="n">StringPtrLess</span><span class="o">&gt;</span> <span class="n">StringPtrSet</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">StringPtrSet</span> <span class="n">ssp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹å­—ç¬¦ä¸²çš„é›†åˆï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1">// æŒ‰ç…§StringPtrLesså®šä¹‰çš„é¡ºåºæ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å’Œå‰é¢ä¸€æ ·æ’å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1">// åŒæ ·å››ä¸ªå­—ç¬¦ä¸²
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨å¾ªç¯æœ€åå°†åšæƒ³è¦å®ƒåšçš„ï¼ˆä¹Ÿå°±æ˜¯å‰é¢ä½ ä½¿ç”¨*iä»£æ›¿**iæ‰€ä¿®æ­£çš„é—®é¢˜ï¼‰:</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">StringPtrSet</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">**</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æŒ‡é’ˆä¹‹å‰å¯¹å®ƒä»¬è§£å¼•ç”¨çš„å‡½æ•°ï¼Œç„¶åå’Œ<code>for_each</code>è”ç”¨é‚£ä¸ªå‡½æ•°:</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">ps</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">for_each</span><span class="p">(</span><span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">print</span><span class="p">);</span><span class="c1">// åœ¨sspä¸­çš„æ¯ä¸ªå…ƒç´ ä¸Šè°ƒç”¨print
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…ä½ æƒ³è±¡å¹¶å†™å‡ºäº†æ³›å‹çš„è§£å¼•ç”¨ä»¿å‡½æ•°ç±»ï¼Œç„¶åè®©å®ƒå’Œtransformä¸ostream_iteratorè¿ç”¨:</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// å½“æœ¬ç±»å‹çš„ä»¿å‡½æ•°è¢«ä¼ å…¥ä¸€ä¸ªT*æ—¶ï¼Œå®ƒä»¬è¿”å›ä¸€ä¸ªconst T&amp;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">Dereference</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡è§£å¼•ç”¨â€œè½¬æ¢â€ sspä¸­çš„æ¯ä¸ªå…ƒç´ ï¼ŒæŠŠç»“æœå†™å…¥cout
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">ostream_iterator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">),</span> <span class="n">Dereference</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦ç‚¹æ˜¯æ— è®ºä½•æ—¶ä½ å»ºç«‹ä¸€ä¸ªæŒ‡é’ˆçš„æ ‡å‡†å…³è”å®¹å™¨ï¼Œä½ å¿…é¡»è®°ä½å®¹å™¨ä¼šä»¥æŒ‡é’ˆçš„å€¼æ’åºã€‚è¿™åŸºæœ¬ä¸Šä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œæ‰€ä»¥ä½ å‡ ä¹æ€»æ˜¯éœ€è¦å»ºç«‹è‡ªå·±çš„ä»¿å‡½æ•°ç±»ä½œä¸ºæ¯”è¾ƒç±»å‹ã€‚</p>
<p><strong>æ¯”è¾ƒç±»å‹ vs æ¯”è¾ƒå‡½æ•°</strong></p>
<p>æ³¨æ„åˆ°è¿™é‡Œå†™çš„æ˜¯â€œæ¯”è¾ƒç±»å‹â€ã€‚</p>
<p>ä½ å¯èƒ½å¥‡æ€ªä¸ºä»€ä¹ˆå¿…é¡»ç‰¹æ„åˆ›é€ ä¸€ä¸ªä»¿å‡½æ•°ç±»è€Œä¸æ˜¯ç®€å•åœ°ä¸ºsetå†™ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°:</p>
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">stringPtrLess</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">*</span> <span class="n">ps1</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">*</span> <span class="n">ps2</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// å°†æˆä¸ºç”¨äºæŒ‰å­—ç¬¦ä¸²å€¼æ’åºçš„string*æŒ‡é’ˆçš„æ¯”è¾ƒå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="k">return</span> <span class="o">*</span><span class="n">ps1</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">ps2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="n">stringPtrLess</span><span class="o">&gt;</span> <span class="n">ssp</span><span class="p">;</span><span class="c1">// å‡è®¾ä½¿ç”¨stringPtrLess ä½œä¸ºsspçš„æ¯”è¾ƒå‡½æ•°ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1">// è¿™ä¸èƒ½ç¼–è¯‘
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„é—®é¢˜æ˜¯æ¯ä¸ªsetæ¨¡æ¿çš„ç¬¬ä¸‰ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ç§ç±»å‹ï¼Œè€Œ<code>stringPtrLess</code>ä¸æ˜¯ä¸€ç§ç±»å‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå°è¯•ä½¿ç”¨<code>stringPtrLess</code>ä½œä¸ºsetçš„æ¯”è¾ƒå‡½æ•°ä¸èƒ½ç¼–è¯‘çš„åŸå› ï¼Œsetä¸è¦ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè¦çš„æ˜¯èƒ½åœ¨å†…éƒ¨ç”¨å®ä¾‹åŒ–å»ºç«‹å‡½æ•°çš„ä¸€ç§ç±»å‹ã€‚</p>
<p><strong>æ— è®ºä½•æ—¶ä½ å»ºç«‹æŒ‡é’ˆçš„å…³è”å®¹å™¨ï¼Œæ³¨æ„ä½ ä¹Ÿå¾—æŒ‡å®šå®¹å™¨çš„æ¯”è¾ƒç±»å‹ã€‚</strong></p>
<p>å¤§å¤šæ•°æ—¶å€™ï¼Œä½ çš„æ¯”è¾ƒç±»å‹åªæ˜¯è§£å¼•ç”¨æŒ‡é’ˆå¹¶æ¯”è¾ƒæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼ˆå°±åƒä¸Šé¢çš„<code>StringPtrLess</code>åšçš„é‚£æ ·ï¼‰ã€‚</p>
<p>é‰´äºè¿™ç§æƒ…å†µï¼Œä½ æ‰‹å¤´æœ€å¥½ä¹Ÿèƒ½æœ‰ä¸€ä¸ªç”¨äºé‚£ç§æ¯”è¾ƒçš„ä»¿å‡½æ•°æ¨¡æ¿ã€‚åƒè¿™æ ·:</p>
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">DereferenceLess</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">PtrType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="n">PtrType</span> <span class="n">pT1</span><span class="p">,</span> <span class="n">PtrType</span> <span class="n">pT2</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="c1">// å‚æ•°æ˜¯å€¼ä¼ é€’çš„å› ä¸ºæˆ‘ä»¬å¸Œæœ›å®ƒä»¬æ˜¯ï¼ˆæˆ–è¡Œä¸ºåƒï¼‰æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="o">*</span><span class="n">pT1</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">pT2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·çš„æ¨¡æ¿æ¶ˆé™¤äº†å†™åƒ<code>StringPtrLess</code>é‚£æ ·çš„ç±»çš„éœ€è¦ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æ”¹ä¸ºä½¿ç”¨<code>DereferenceLess</code>:</p>
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="n">DereferenceLess</span><span class="o">&gt;</span> <span class="n">ssp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è¡Œä¸ºå°±åƒ set&lt;string*, StringPtrLess&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬æ¡æ¬¾æ˜¯å…³äºæŒ‡é’ˆçš„å…³è”å®¹å™¨ï¼Œä½†å®ƒä¹Ÿå¯ä»¥åº”ç”¨äºè¡¨ç°ä¸ºæŒ‡é’ˆçš„å¯¹è±¡çš„å®¹å™¨ï¼Œä¾‹å¦‚ï¼Œæ™ºèƒ½æŒ‡é’ˆå’Œè¿­ä»£å™¨ã€‚</p>
<p>å¦‚æœä½ æœ‰ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–è¿­ä»£å™¨çš„å…³è”å®¹å™¨ï¼Œé‚£ä¹Ÿå¾—ä¸ºå®ƒæŒ‡å®šæ¯”è¾ƒç±»å‹ã€‚å¹¸è¿çš„æ˜¯ï¼ŒæŒ‡é’ˆçš„è¿™ä¸ªè§£å†³æ–¹æ¡ˆä¹Ÿå¯ä»¥ç”¨äºç±»ä¼¼æŒ‡é’ˆçš„å¯¹è±¡ã€‚æ­£å¦‚DereferenceLessé€‚åˆä½œä¸ºT*çš„å…³è”å®¹å™¨çš„æ¯”è¾ƒç±»å‹ä¸€æ ·ï¼Œå®ƒä¹Ÿ å¯ä»¥ä½œä¸ºTå¯¹è±¡çš„è¿­ä»£å™¨å’Œæ™ºèƒ½æŒ‡é’ˆå®¹å™¨çš„æ¯”è¾ƒç±»å‹ã€‚</p>
<p>å®é™…ä¸Šï¼Œè¿™24ç§æ’åˆ—å¾ˆå¯èƒ½ä¸æ˜¯å¹³ç­‰çš„ï¼Œæ‰€ä»¥â€œ24ä»½ä¹‹1â€çš„é™ˆè¿°æœ‰ç‚¹ä½¿äººè¯¯è§£ã€‚ç¡®å®ï¼Œæœ‰24ä¸ªä¸åŒçš„é¡ºåºï¼Œè€Œä¸”ä½ å¯èƒ½å¾—åˆ°å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚</p>
]]></description></item><item><title>Diffusion æ‰©æ•£æ¨¡å‹ï¼ˆDDPMï¼‰</title><link>https://jianye0428.github.io/posts/ddpm/</link><pubDate>Mon, 31 Jul 2023 15:57:07 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/ddpm/</guid><description><![CDATA[<h2 id="ä¸€å¼•å…¥">ä¸€ã€å¼•å…¥</h2>
<p></p>
<p>è¿‘å¹´AIGCçš„çˆ†ç«ç¦»ä¸å¼€äººå·¥æ™ºèƒ½åœ¨å›¾åƒç”Ÿæˆã€æ–‡æœ¬ç”Ÿæˆä»¥åŠå¤šæ¨¡æ€ç­‰é¢†åŸŸçš„ä¸æ–­ç´¯ç§¯ï¼Œå…¶ä¸­<strong>ç”Ÿæˆæ¨¡å‹</strong>çš„å‘å±•å æ®äº†å¾ˆå¤§åŠŸåŠ³ï¼Œå¦‚ï¼š<mark>ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ GAN</mark> åŠå…¶ä¸€ç³»åˆ—å˜ä½“ã€<mark>å˜åˆ†è‡ªç¼–ç å™¨ VAE</mark> åŠå…¶ä¸€ç³»åˆ—å˜ä½“ã€<mark>è‡ªå›å½’æ¨¡å‹ AR</mark>ã€<mark>æµæ¨¡å‹ flow</mark> ï¼Œä»¥åŠè¿‘å¹´å¤§ç«çš„<strong>æ‰©æ•£æ¨¡å‹ Diffusion Model</strong> ç­‰ã€‚</p>
<p>æ‰©æ•£æ¨¡å‹çš„å¤§ç«å¹¶éæ¨ªç©ºå‡ºä¸–ï¼Œæ—©åœ¨2015å¹´å°±æœ‰äººæå‡ºäº†ç±»ä¼¼çš„æƒ³æ³•ï¼Œç›´åˆ°2020å¹´æ‰æå‡ºäº†ç»å…¸çš„ <strong>Denoising Diffusion Probabilistic Modelsï¼ˆDDPMï¼‰</strong>ï¼ŒåƒOpenAIã€NovelAIã€NVIDIAå’ŒGoogleæˆåŠŸçš„è®­ç»ƒäº†å¤§è§„æ¨¡æ¨¡å‹ä¹‹åï¼Œå®ƒä»¬å¸å¼•äº†å¾ˆå¤šäººæ³¨æ„ï¼Œåç»­æœ‰äº†å¾ˆå¤šåŸºäºæ‰©æ•£æ¨¡å‹çš„å˜ä½“ï¼Œæ¯”å¦‚æœ‰ï¼šGLIDEã€DALLE-2ã€Imagenå’Œå¹´åº•çˆ†ç«çš„å®Œå…¨å¼€æºçš„ç¨³å®šæ‰©æ•£æ¨¡å‹ï¼ˆStable Diffusionï¼‰ã€‚</p>
<p>æ‰©æ•£æ¨¡å‹ä¸ä¹‹å‰æ‰€æœ‰çš„ç”Ÿæˆæ–¹æ³•æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ï¼š</p>
<p></p>
<p>ç›´è§‚çš„è¯´å®ƒæ˜¯<mark>å°†å›¾åƒç”Ÿæˆè¿‡ç¨‹ï¼ˆé‡‡æ ·ï¼‰åˆ†è§£ä¸ºè®¸å¤šå°çš„å»å™ªæ­¥éª¤</mark>ï¼Œå…¶å® Diffusion çš„å«ä¹‰æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªè¿­ä»£è¿‡ç¨‹ï¼Œå®çº¿ç®­å¤´ç”¨äºæ‰©æ•£æ­¥éª¤ä¸­æ·»åŠ éšæœºå™ªå£°ï¼Œè™šçº¿ç®­å¤´ä»£è¡¨çš„æ˜¯é€šè¿‡å­¦ä¹ é€†å‘æ‰©æ•£è¿‡ç¨‹<mark>ä»å™ªå£°ä¸­é‡æ„æ‰€éœ€çš„æ•°æ®æ ·æœ¬</mark>ã€‚<strong>å¼•å…¥å™ªå£°å¯¼è‡´äº†ä¿¡æ¯çš„è¡°å‡ï¼Œå†é€šè¿‡å™ªå£°å°è¯•è¿˜åŸåŸå§‹æ•°æ®ï¼Œå¤šæ¬¡è¿­ä»£æœ€å°åŒ–æŸå¤±åï¼Œèƒ½å¤Ÿä½¿æ¨¡å‹åœ¨ç»™å®šå™ªå£°è¾“å…¥çš„æƒ…å†µä¸‹å­¦ä¹ ç”Ÿæˆæ–°å›¾åƒã€‚</strong></p>
<p>æ‰€ä»¥Diffusionæ¨¡å‹å’Œå…¶å®ƒç”Ÿæˆæ¨¡å‹çš„åŒºåˆ«æ˜¯ï¼Œå®ƒä¸æ˜¯ç›´æ¥çš„<strong>å›¾åƒ-&gt;æ½œå˜é‡ã€æ½œå˜é‡-&gt;å›¾åƒ</strong>çš„ä¸€æ­¥åˆ°ä½ï¼Œå®ƒæ˜¯ä¸€æ­¥ä¸€æ­¥çš„<mark><font color=red><strong>é€æ¸åˆ†è§£ã€é€æ¸å»å™ª</strong></font></mark>çš„è¿‡ç¨‹ã€‚</p>
<p>å½“ç„¶æœ‰å…³Diffusionçš„ç†è§£å’Œå˜ä½“æœ‰å¾ˆå¤šï¼Œä½†æ˜¯æ‰©æ•£æ¨¡å‹ä»æœ¬è´¨ä¸Šè®²å°±æ˜¯DDPMï¼Œæ‰€ä»¥æœ¬æ–‡ä¸»è¦å¯¹DDPMçš„åŸç†è¿›è¡Œè®²è§£ï¼Œå¹¶ç»™å‡ºDDPMçš„æ‰©æ•£è¿‡ç¨‹ã€å»å™ªè¿‡ç¨‹ã€è®­ç»ƒæŸå¤±çš„è¯¦ç»†æ¨å¯¼ï¼Œå¯¹äºæŒæ¡Diffusionç®—æ³•åŸç†åªéœ€è¦æŠ“ä½ä»¥ä¸‹å››ç‚¹å³å¯ï¼š</p>
<ul>
<li>å‰å‘è¿‡ç¨‹ï¼ˆæ‰©æ•£ï¼‰ï¼›</li>
<li>åå‘è¿‡ç¨‹ï¼ˆå»å™ªã€é‡‡æ ·ï¼‰ï¼›</li>
<li>å¦‚ä½•è®­ç»ƒï¼›</li>
<li>å¦‚ä½•æ¨æ–­ã€‚</li>
</ul>
<h2 id="äºŒæ‰©æ•£åŸç†é˜è¿°">äºŒã€æ‰©æ•£åŸç†é˜è¿°</h2>
<p>æ‰©æ•£æ¨¡å‹åŒ…æ‹¬ <strong>å‰å‘æ‰©æ•£è¿‡ç¨‹</strong> å’Œ <strong>åå‘å»å™ªè¿‡ç¨‹(é‡‡æ ·)</strong>ï¼Œå‰å‘é˜¶æ®µå¯¹å›¾åƒé€æ­¥æ–½åŠ å™ªå£°ï¼Œç›´è‡³å›¾åƒè¢«ç ´åå˜æˆå®Œå…¨çš„é«˜æ–¯å™ªå£°ï¼Œç„¶ååœ¨åå‘é˜¶æ®µå­¦ä¹ ä»é«˜æ–¯å™ªå£°è¿˜åŸä¸ºåŸå§‹å›¾åƒçš„è¿‡ç¨‹ã€‚</p>
<h3 id="21ç›´è§‚ç†è§£">2.1ã€ç›´è§‚ç†è§£</h3>
<ul>
<li>æ‰©æ•£æ¨¡å‹çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ
<ul>
<li>å­¦ä¹ ä»çº¯å™ªå£°ç”Ÿæˆå›¾ç‰‡çš„æ–¹æ³•ã€‚</li>
</ul>
</li>
<li>æ‰©æ•£æ¨¡å‹æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ
<ul>
<li>è®­ç»ƒä¸€ä¸ªUNetï¼Œæ¥å—ä¸€ç³»åˆ—åŠ äº†å™ªå£°çš„å›¾ç‰‡ï¼Œå­¦ä¹ é¢„æµ‹æ‰€åŠ çš„å™ªå£°ã€‚</li>
</ul>
</li>
<li>å‰å‘è¿‡ç¨‹åœ¨å¹²ä»€ä¹ˆï¼Ÿ
<ul>
<li>é€æ­¥å‘çœŸå®å›¾ç‰‡æ·»åŠ å™ªå£°æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªçº¯å™ªå£°ï¼›</li>
<li>å¯¹äºè®­ç»ƒé›†ä¸­çš„æ¯å¼ å›¾ç‰‡ï¼Œéƒ½èƒ½ç”Ÿæˆä¸€ç³»åˆ—çš„å™ªå£°ç¨‹åº¦ä¸åŒçš„åŠ å™ªå›¾ç‰‡ï¼›</li>
<li>åœ¨è®­ç»ƒæ—¶ï¼Œè¿™äº› ã€ä¸åŒç¨‹åº¦çš„å™ªå£°å›¾ç‰‡ + ç”Ÿæˆå®ƒä»¬æ‰€ç”¨çš„å™ªå£°ã€‘ æ˜¯å®é™…çš„è®­ç»ƒæ ·æœ¬ã€‚</li>
</ul>
</li>
<li>åå‘è¿‡ç¨‹åœ¨å¹²ä»€ä¹ˆï¼Ÿ
<ul>
<li>è®­ç»ƒå¥½æ¨¡å‹åï¼Œé‡‡æ ·ã€ç”Ÿæˆå›¾ç‰‡ã€‚</li>
</ul>
</li>
</ul>
<h3 id="22å‰å‘è¿‡ç¨‹æ‰©æ•£">2.2ã€å‰å‘è¿‡ç¨‹ï¼ˆæ‰©æ•£ï¼‰</h3>
<p></p>
<p>å‰å‘è¿‡ç¨‹åœ¨åŸå§‹è¾“å…¥å›¾åƒ$x_0$ä¸Šé€æ­¥æ·»åŠ éšæœºå™ªå£°ï¼Œè¿™ä¸ªå™ªå£°æœä»é«˜æ–¯åˆ†å¸ƒ$N(0, 1)$ï¼Œæ¯ä¸€æ­¥å¾—åˆ°çš„å›¾åƒ$x_t$åªå’Œä¸Šä¸€æ­¥çš„åŠ å™ªç»“æœ$x_{t-1}$ç›¸å…³ï¼Œé€æ­¥æ·»åŠ å™ªå£°è‡³$T$æ­¥ï¼Œå¯ä»¥å¾—åˆ°è¶‹å‘äºçº¯ç²¹å™ªå£°çš„å›¾åƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
</p>
<blockquote>
<p>åé¢æœ‰è¯¦ç»†çš„æ¨å¯¼ï¼Œå…¬å¼æ¯”è¾ƒå¤šï¼Œè¿™é‡Œå…ˆæå‰æŠŠä¸»è¦çš„åˆ—ä¸€ä¸‹æ–¹ä¾¿é˜è¿°ã€‚</p>
</blockquote>
<p>å¯¹äºå°†ä¸€å¼ å›¾ç‰‡ï¼Œä»$x_{t-1}\rightarrow x_{t}$çš„é€æ­¥åŠ å™ªç ´åçš„å…¬å¼ä¸ºï¼š</p>
<p>$$x_t=\sqrt{\alpha_t}\left.x_{t-1}+\sqrt{1-\alpha_t}\right.\varepsilon_t\quad\quad\quad\quad\quad\quad(1)$$</p>
<p>å…¶ä¸­:</p>
<ul>
<li>$x_t$è¡¨ç¤ºç¬¬$t$æ­¥çš„å›¾åƒï¼›</li>
<li>$\varepsilon$ æ˜¯ä¸€ä¸ªæ»¡è¶³æ­£æ€åˆ†å¸ƒçš„éšæœºå™ªå£°ï¼Œ$\varepsilon \sim N(0, 1)$ï¼›</li>
<li>$\sqrt{\alpha_{t}}$ æ˜¯å›¾ç‰‡çš„æƒé‡ï¼Œ$\sqrt{1 - \alpha_{t}}$ æ˜¯å™ªå£°çš„æƒé‡ï¼›</li>
</ul>
<p>å®šä¹‰ï¼š</p>
<ul>
<li>$\alpha_t=1-\beta_t$</li>
<li>$\overline{\alpha}=\prod_{s=1}^t\alpha_s$</li>
</ul>
<p>éšç€$t$çš„å¢åŠ ï¼Œ<strong>å™ªå£°çš„å æ¯”ä¼šè¶Šæ¥è¶Šå¤§</strong>ï¼Œæ‰€ä»¥æ·»åŠ çš„<strong>å™ªå£°å¼ºåº¦ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´å›¾ç‰‡çš„æƒé‡è¦è¶Šæ¥è¶Šå°ï¼Œå™ªå£°çš„æƒé‡è¦è¶Šæ¥è¶Šå¤§ã€‚å› ä¸ºéšç€æ‰©æ•£è¿‡ç¨‹çš„å¢åŠ ï¼Œå›¾åƒä¸­å™ªå£°çš„å æ¯”ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼Œæˆ‘ä»¬æƒ³è¦è¿›ä¸€æ­¥ç ´åå®ƒçš„ç»“æ„ï¼Œå°±éœ€è¦æ·»åŠ æ›´å¤šçš„å™ªå£°ã€‚</p>
<blockquote>
<p>æ¢å¥è¯è¯´ï¼Œä¸€å¼€å§‹å›¾åƒæ¯”è¾ƒæ¸…æ™°ï¼Œè¿™ä¸ªæ—¶å€™æ·»åŠ çš„å™ªå£°å°ä¸€äº›ï¼Œéšç€å›¾åƒçš„å™ªå£°è¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªæ—¶å€™å†åŠ ä¸€ç‚¹å™ªå£°çš„è¯ï¼Œå¯¹åŸæ¥çš„å›¾åƒå°±æ²¡ä»€ä¹ˆå½±å“äº†ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±æœ‰å¥½å¤šå™ªå£°äº†ï¼Œæ‰€ä»¥éšç€å›¾åƒçš„å™ªå£°è¶Šæ¥è¶Šå¤šï¼Œåé¢çš„æ­¥éª¤å°±è¦åŠ æ›´å¤šçš„å™ªå£°ã€‚</p>
</blockquote>
<p>å®é™…è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šæ¯”è¾ƒå¤§ï¼ˆDDPMåŸæ–‡ä¸­ä¸º1000ï¼‰ï¼Œæ‰€ä»¥ä¼šæœ‰ä»$x_0$é€’æ¨åˆ°$x_t$çš„å…¬å¼ï¼š</p>
<p>$$x_t=\sqrt{\overline{\alpha}_t}\left.x_0+\sqrt{1-\overline{\alpha}_t}\right.\varepsilon\quad\quad\quad\quad(2)$$</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>$\alpha_t$ã€$\beta_t$ æœ‰ä¸€ä¸ªå›ºå®šçš„å·²çŸ¥å‡½æ•°ï¼Œæ˜¯å¯ä»¥ç›´æ¥è¿›è¡Œè®¡ç®—çš„ï¼›</li>
<li>$\varepsilon$ ä¸ºéšæœºäº§ç”Ÿçš„å™ªå£°ï¼›</li>
</ul>
<p>æ‰€ä»¥æ•´ä¸ªå¼å­æ˜¯å·²çŸ¥çš„ï¼Œå¼ $(1)$ã€$(2)$ å°±å¯ä»¥æè¿°å‰å‘è¿‡ç¨‹äº†ï¼Œ$(1)$ ç”¨äºå°†ä¸€å¼ å›¾ç‰‡çš„é€æ­¥ç ´åï¼Œ$(2)$ ç”¨äºä¸€æ­¥åˆ°ä½çš„ç ´åã€‚</p>
<h3 id="23åå‘è¿‡ç¨‹å»å™ª">2.3ã€åå‘è¿‡ç¨‹ï¼ˆå»å™ªï¼‰</h3>
<p>åå‘è¿‡ç¨‹åˆ™æ˜¯ä¸æ–­å»é™¤å™ªå£°çš„è¿‡ç¨‹ï¼Œç»™å®šä¸€ä¸ªå™ªå£°å›¾ç‰‡ $x_T$ï¼Œå¯¹å®ƒä¸€æ­¥æ­¥çš„å»å™ªè¿˜åŸï¼Œç›´è‡³æœ€ç»ˆå°†åŸå§‹å›¾åƒ $x_0$ ç»™æ¢å¤å‡ºæ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p></p>
<p>å»å™ªçš„è¿‡ç¨‹ï¼Œ$x_t$ã€$\alpha_t$ã€$\beta_t$ éƒ½æ˜¯å·²çŸ¥çš„ï¼Œåªæœ‰å…¬å¼ $(2)$ ä¸­çš„çœŸå®å™ªå£°æ˜¯æœªçŸ¥çš„ï¼Œå› ä¸ºå®ƒæ˜¯éšæœºé‡‡æ ·çš„ã€‚æ‰€ä»¥éœ€è¦ä¸€ä¸ªç¥ç»ç½‘ç»œæŠŠ $\varepsilon$ ç»™å­¦å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯è¯´è®­ç»ƒä¸€ä¸ªç”± $x_t$ å’Œ $t$ ä¼°æµ‹å™ªå£°çš„æ¨¡å‹:</p>
<p>$$x_{t-1}=\frac{1}{\sqrt{\alpha_t}}(x_t-\frac{\beta_t}{\sqrt{1-\overline{\alpha}<em>t}}\varepsilon</em>\theta(x_t,t))$$</p>
<p>å…¶ä¸­ $\theta$ å°±æ˜¯æ¨¡å‹çš„å‚æ•°ï¼Œé€šå¸¸ä½¿ç”¨UNetä½œä¸ºé¢„ä¼°å™ªå£°çš„æ¨¡å‹ã€‚</p>
<h3 id="24æ¨¡å‹è®­ç»ƒ">2.4ã€æ¨¡å‹è®­ç»ƒ</h3>
<p>æ‰€ä»¥è¯´åå‘è¿‡ç¨‹å…¶å®å°±æ˜¯<strong>è®­ç»ƒç½‘ç»œå»å­¦ä¹ åˆ†è§£è¿‡ç¨‹æ¯ä¸€æ­¥çš„å™ªå£°</strong>ï¼Œå½“ç½‘ç»œè®­ç»ƒå¥½ä¹‹åï¼Œè¾“å…¥ä¸€å¼ å™ªå£°å›¾ç‰‡ï¼Œé€šè¿‡ç½‘ç»œå°±èƒ½æŠŠåŠ çš„å™ªå£°ç»™æ±‚å‡ºæ¥ï¼Œå™ªå£°æœ‰äº†ä»£å…¥å…¬å¼ï¼Œå°±èƒ½æŠŠ $x_{t-1}$ æ­¥çš„æ¯”è¾ƒæ¸…æ™°çš„å›¾ç»™æ±‚å‡ºæ¥äº†ï¼Œä¸€æ­¥æ­¥å¾€å‰è¿­ä»£å°±è¡Œäº†ã€‚</p>
<p>é‡‡ç”¨L2è·ç¦»åˆ»ç”»ç›¸è¿‘ç¨‹åº¦å°±å¯ä»¥ï¼ŒDDPMçš„å…³é”®æ˜¯è®­ç»ƒ $\varepsilon_{\theta}(x_t, t)$ï¼Œç›®çš„å°±æ˜¯ä½¿é¢„æµ‹çš„å™ªå£°ä¸çœŸå®ç”¨äºç ´åçš„å™ªå£°ç›¸è¿‘ï¼š</p>
<p>$$Loss=\mid\mid\varepsilon-\varepsilon_\theta(x_t,t)\mid\mid^2=\mid\mid\varepsilon-\varepsilon_\theta(\sqrt{\overline{\alpha}_t}~x_0+\sqrt{1-\overline{\alpha}_t}~\varepsilon_t,t)\mid\mid^2$$</p>
<p></p>
<p>æ¨¡å‹è®­ç»ƒå®Œåï¼Œåªè¦ç»™å®šéšæœºé«˜æ–¯å™ªå£°ï¼Œå°±å¯ä»¥ç”Ÿæˆä¸€å¼ ä»æœªè§è¿‡çš„å›¾åƒã€‚</p>
<p>UNetæœ¬æ–‡ä¸åšä»‹ç»ï¼Œç»“æ„å›¾ä¸ºï¼š</p>
<p></p>
<blockquote>
<p>é¢å¤–å¼ºè°ƒçš„æ˜¯ï¼šUneté‡Œæœ‰ä¸€ä¸ªä½ç½®ç¼–ç ï¼Œæ˜¯å…³äºæ—¶é—´æ­¥çš„ï¼Œæ¯ä¸ªæ—¶é—´æ­¥æ˜¯æœ‰ä¸€ä¸ªçº¿æ€§è°ƒåº¦å™¨çš„ï¼Œæ¯ä¸ªæ—¶é—´æ·»åŠ çš„å™ªå£°çš„æ–¹å·®æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥å°†æ—¶é—´æ­¥ä½œä¸ºç¼–ç åµŒå…¥çš„è¯ï¼Œå¯ä»¥å°†æ¨¡å‹é¢„æµ‹çš„å™ªå£°æ›´åŠ çš„å‡†ç¡®ã€‚</p>
</blockquote>
<h2 id="ä¸‰ç®—æ³•æµç¨‹æ¦‚è¿°">ä¸‰ã€ç®—æ³•æµç¨‹æ¦‚è¿°</h2>
<p></p>
<p>å†æ¬¡æ€»ç»“ï¼Œæ‰©æ•£æ¨¡å‹ä¸¤ä¸ªæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸€ä¸ªå›ºå®šçš„ï¼ˆé¢„å…ˆå®šä¹‰å¥½çš„ï¼‰å‰å‘æ‰©æ•£è¿‡ç¨‹ $q(x_t | x_{t-1})$ï¼šé€æ­¥å‘å›¾ç‰‡å¢åŠ å™ªå£°ç›´åˆ°æœ€ç»ˆå¾—åˆ°ä¸€å¼ çº¯ç²¹çš„å™ªå£°å›¾ï¼›</li>
<li>ä¸€ä¸ªå­¦ä¹ å¾—åˆ°çš„å»å™ªè¿‡ç¨‹ $p_{\theta}(x_{t-1} | x_t)$ï¼šè®­ç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œå»é€æ¸çš„ä»ä¸€å¼ çº¯å™ªå£°ä¸­æ¶ˆé™¤å™ªå£°ï¼Œç›´åˆ°å¾—åˆ°ä¸€å¼ çœŸæ­£çš„å›¾ç‰‡ã€‚</li>
</ul>
<p></p>
<p>ç®—æ³•1 ä¸ºè®­ç»ƒæµç¨‹ï¼š</p>
<ul>
<li>line2ï¼šä»æ•°æ®ä¸­é‡‡æ · $x_0$ï¼Œ$q(x_0)$ çš„æ„æ€æ˜¯ç»™ $x_0$ åŠ ä¸Šå™ªå£°ï¼›</li>
<li>line3ï¼šéšæœºé€‰å– time step $t$ï¼›
<ul>
<li>çœŸå®è®­ç»ƒè¿‡ç¨‹ä¸­æˆ‘ä»¬ä¸å¯èƒ½ä¸€æ­¥æ­¥çš„ä» $t$ åˆ° $T$ï¼Œå› ä¸ºä¼šå¾ˆå¤§ï¼Œè¿™å°±æ„å‘³ç€æ¯è¾“å…¥ä¸€å¼ å›¾ç‰‡ $x$ï¼Œå°±ä¼šäº§ç”Ÿå¼ å™ªå£°å›¾åƒï¼Œä¹Ÿå°±æ˜¯ä¸€å¼ å›¾åƒçš„ç½‘ç»œè¦è®­ç»ƒ $T$ ä¸ªå™ªå£°æ ·æœ¬ï¼Œéå¸¸è€—æ—¶ã€‚</li>
<li>æ‰€ä»¥å¯¹ $T$ è¿›è¡Œäº†é‡‡æ ·ï¼Œ$t$ å°±æ˜¯ä» $T$ é‡Œé‡‡é›†è‹¥å¹²ä¸ªçš„æ„æ€ã€‚</li>
<li>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾é‡‡é›† $t$ çš„åˆ†åˆ«ä¸º100ã€20ã€3ï¼Œå¯¹åº”çš„ $x$ ä¸º $x_{100}$ã€$x_{20}$ã€$x_{3}$ï¼Œå¯¹åº”å™ªå£°ä¸º $\varepsilon_{100}$ã€$\varepsilon_{20}$ã€$\varepsilon_{3}$ï¼Œå¯¹äºçš„é¢„æµ‹å™ªå£°ä¸º $\hat{\varepsilon}<em>{100}$ã€$\hat{\varepsilon}</em>{20}$ã€$\hat{\varepsilon}_{3}$, åªéœ€è¦å°† $\varepsilon$ å’Œ $\hat{\varepsilon}$ ä»£å…¥MSEå…¬å¼å³å¯ï¼ˆç›¸å‡ã€å¹³æ–¹ã€æœ€å°åŒ–ï¼‰ã€‚</li>
</ul>
</li>
<li>line 4ï¼šç”Ÿæˆéšæœºé«˜æ–¯å™ªå£°ï¼›</li>
<li>line 5ï¼šè°ƒç”¨æ¨¡å‹ä¼°è®¡ $\varepsilon_{\theta}(\sqrt{\overline{\alpha}_t}~x_0+\sqrt{1-\overline{\alpha}_t}~\varepsilon_t,t)$ ï¼Œè®¡ç®—çœŸå®å™ªå£°ä¸ä¼°è®¡å™ªå£°ä¹‹é—´çš„MSE Lossï¼Œåå‘ä¼ æ’­æ›´æ–°æ¨¡å‹ã€‚
<ul>
<li>ç½‘ç»œçš„ä½œç”¨æ˜¯é¢„æµ‹å™ªå£°ï¼Œéšç€çš„å¢åŠ ï¼Œå™ªå£°å¼ºåº¦ä¼šè¶Šæ¥è¶Šå¤§ï¼Œå› æ­¤é¢„æµ‹çš„å™ªå£°æ˜¯å’Œè¿­ä»£æ˜¯ç›´æ¥ç›¸å…³çš„ï¼Œæ‰€ä»¥è¦æŠŠä½œä¸ºå‚æ•°é€å…¥åˆ°ç½‘ç»œå½“ä¸­ã€‚</li>
</ul>
</li>
<li>ç›´åˆ°æ”¶æ•›ã€‚</li>
</ul>
<p>ç®—æ³•2 ä¸ºé‡‡æ ·æµç¨‹ï¼š</p>
<ul>
<li>line 1ï¼šä»é«˜æ–¯åˆ†å¸ƒé‡‡æ · $x_T$ï¼›</li>
<li>line 2ï¼šæŒ‰ç…§ $T, &hellip;, 1$ çš„é¡ºåºè¿›è¡Œè¿­ä»£ï¼›</li>
<li>line 3ï¼šå¦‚æœ $t = 1$ ä»¤ $z = 0$ï¼›å¦‚æœ $t &gt; 1$ ï¼Œä»é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·ï¼›</li>
<li>line 4ï¼šåˆ©ç”¨å…¬å¼æ±‚å‡ºå‡å€¼å’Œæ–¹å·®ï¼Œè¿›è€Œæ±‚å¾— $x_{t-1}$ï¼›</li>
<li>ç»è¿‡ä¸Šè¿°è¿­ä»£ï¼Œæ¢å¤ $x_0$ã€‚</li>
</ul>
<h2 id="å››æ•°å­¦æè¿°">å››ã€æ•°å­¦æè¿°</h2>
<p>æˆ‘ä»¬æ¥æ¨å¯¼å¦‚ä½•ä»åŸå§‹å›¾åƒç›´æ¥åˆ°ç¬¬tæ—¶åˆ»çš„å›¾åƒ $(X_0 - X_t)$ã€‚</p>
<p>é¦–å…ˆå›é¡¾ 2.1å°èŠ‚ çš„ä¸¤ä¸ªå®šä¹‰ï¼š</p>
<ul>
<li>$\alpha_t = 1 - \beta_{t}$, $\beta_t$ è¦è¶Šå¤§è¶Šå¥½ï¼Œè®ºæ–‡ä¸­ä»0.0001åˆ°0.02;</li>
<li>$\overline{\alpha}=\prod_{s=1}^t\alpha_s$ç´¯ä¹˜ï¼Œä¸‹é¢ä¼šç”¨åˆ°ï¼›</li>
<li>$x_t=\sqrt{\alpha_t}x_{t-1}+\sqrt{1-\alpha_t}\varepsilon_t\text{,}\varepsilon_t\sim N(0,1)$ æ¯ä¸€æ—¶åˆ»æ·»åŠ çš„å™ªå£°å‡ç‹¬ç«‹ï¼›</li>
</ul>
<p>æˆ‘ä»¬è¦æ±‚$x_t$æ—¶åˆ»çš„å›¾åƒï¼Œå®ƒéœ€è¦ä¸€æ­¥æ­¥çš„åŠ å™ªè¿­ä»£ï¼Œè¿™æ ·å¤ªæ…¢äº†ã€‚å› ä¸ºæ¯ä¸€æ­¥æ·»åŠ çš„å™ªå£°ç‹¬ç«‹ä¸”æœä»æ­£å¤ªåˆ†å¸ƒï¼Œæˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹æ¨å¯¼ï¼š</p>
<blockquote>
<p>ä¸ºäº†ä¸æ··æ·†ï¼Œåªéœ€è¦è®°ä½ï¼š<strong>ä¸‹æ ‡è¶Šå°ï¼Œå™ªå£°è¶Šå°</strong>ï¼Œå³ $x_{t-1}$ çš„å™ªå£°æ˜¯å°äº $x_t$ çš„ã€‚</p>
</blockquote>
<p>$$
\begin{aligned}
q(x_{t}\mid x_{t-1})&amp; =N(x_t;\sqrt{\alpha_t}x_{t-1},(1-\alpha_t)I)  \cr
&amp;=\underbrace{\sqrt{\alpha_t}x_{t-1}}<em>{x</em>{t-2}\text{æ¥è¡¨ç¤º}x_{t-1}}+\sqrt{1-\alpha_t}\varepsilon_t \cr
&amp;=\sqrt{\alpha_t}\left(\sqrt{\alpha_{t-1}}\right.x_{t-2}+\sqrt{1-\alpha_{t-1}}\left.\varepsilon_{t-1}\right)+\sqrt{1-\alpha_t}\left.\varepsilon_t\right. \cr
&amp;=\sqrt{\alpha_t\alpha_{t-1}}x_{t-2}+\underbrace{\sqrt{\alpha_t-\alpha_t\alpha_{t-1}}\varepsilon_{t-1}+\sqrt{1-\alpha_t}\varepsilon_t}<em>{\text{ä¸¤ä¸ªç‹¬ç«‹æ­£å¤ªåˆ†å¸ƒç›¸åŠ }} \cr
&amp;=\sqrt{\alpha_t\alpha</em>{t-1}}\left.x_{t-2}+\sqrt{1-\alpha_t\alpha_{t-1}}\right.\varepsilon  \cr
&amp;\text{&hellip;} \
&amp;=\sqrt{\overline{\alpha}_t}\left.x_0+\sqrt{1-\overline{\alpha}_t}\right.\varepsilon  \cr
&amp;\therefore q(x_t\mid x_0)=N(x_t;\sqrt{\overline{\alpha}_t}x_0,\sqrt{1-\overline{\alpha}_t}I)
\end{aligned}
$$</p>
<blockquote>
<p>ä¸Šè¿°ç”¨çš„å°±æ˜¯é‡å‚æ•°åŒ–æŠ€å·§ã€‚</p>
</blockquote>
<p>æ–¹å·®å‚æ•° $\beta_{t}$ å¯ä»¥å›ºå®šä¸ºä¸€ä¸ªå¸¸æ•°ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä½œä¸º $T$ æ—¶é—´æ®µçš„ä¸€ä¸ªæ—¶é—´è¡¨ã€‚äº‹å®ä¸Šï¼Œäººä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ–¹å·®è¡¨ï¼Œå®ƒå¯ä»¥æ˜¯çº¿æ€§çš„ã€äºŒæ¬¡çš„ã€ä½™å¼¦çš„ç­‰ç­‰ã€‚æœ€åˆçš„DDPMä½œè€…åˆ©ç”¨äº†ä¸€ä¸ªä» $\beta_1 = 10^{-4}$ åˆ°$\beta_T = 0.02$å¢åŠ çš„çº¿æ€§æ—¶é—´è¡¨ã€‚Nicholç­‰äºº2021å¹´çš„ç ”ç©¶è¡¨æ˜ï¼Œé‡‡ç”¨ä½™å¼¦æ—¶é—´è¡¨æ•ˆæœæ›´å¥½ã€‚</p>
<p></p>
<h3 id="42åå‘è¿‡ç¨‹å»å™ª">4.2ã€åå‘è¿‡ç¨‹ï¼ˆå»å™ªï¼‰</h3>
<p>æ¥ä¸‹æ¥æ˜¯åå‘è¿‡ç¨‹çš„æ¨å¯¼ï¼š
$$p(x_{t-1}\mid x_t)=N(x_{t-1};\underbrace{\mu_\theta(x_t,t)}<em>\text{è¦åé¢„æµ‹è¿™ä¸ª},\overbrace{\Sigma</em>\theta(x_t,t)}^{fixed})$$</p>
<p>ç»™å®š$x_t$è¦é¢„æµ‹ $x_{t-1}$ï¼Œå®ƒæ˜¯ä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒï¼Œ$x_t$å’Œ$t$çš„æ–¹å·®æ˜¯å›ºå®šçš„ï¼Œè®ºæ–‡ä½œè€…ä½¿ç”¨åŸå§‹çš„å™ªå£°è°ƒåº¦å™¨ä½œä¸ºæ–¹å·®ï¼Œä¹Ÿå°±æ˜¯è¯´å™ªå£°è°ƒåº¦å™¨ä¸€æ—¦ç¡®ç«‹ï¼Œæ–¹å·®çš„å¤§å°ä¹Ÿå°±å›ºå®šäº†ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦é¢„æµ‹è¿™ä¸ªå‡å€¼å°±å¥½äº†ï¼Œä¸‹é¢ç»™å‡ºå…·ä½“çš„æ¨å¯¼è¿‡ç¨‹ï¼š</p>
<p>æˆ‘ä»¬å…ˆçœ‹æ•´ä¸ªæŸå¤±å‡½æ•°ï¼Œæ˜¯ä¸ª<strong>è´Ÿå¯¹æ•°ä¼¼ç„¶</strong>ï¼š</p>
<p>$$-\log{p_{\theta}(x_0)}$$</p>
<p>å¸Œæœ›ç¥ç»ç½‘ç»œçš„å‚æ•° $\theta$ï¼Œå¯ä»¥ä½¿å¾—ç”Ÿæˆ $x_0$çš„æ¦‚ç‡è¶Šå¤§è¶Šå¥½ã€‚</p>
<p>ä½†é—®é¢˜åœ¨äº $x_0$ çš„æ¦‚ç‡ä¸å¥½è®¡ç®—ï¼Œå› ä¸ºå®ƒä¾èµ–äº $x_0$ ä¹‹å‰çš„æ‰€æœ‰æ­¥é•¿ï¼Œä» $x_T$ å¼€å§‹ã€‚ä½œä¸ºä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—è¿™ä¸ªç›®æ ‡çš„<strong>å˜åˆ†ä¸‹ç•Œ</strong>ï¼Œå¹¶å¾—åˆ°ä¸€ä¸ªæ›´æ˜“äºè®¡ç®—çš„å…¬å¼ï¼š</p>
<p>$$-log(p_\theta(x_0))\leq-log(p_\theta(x_0))+D_{KL}(q(x_{1:T}\mid x_0)\parallel p_\theta(x_{1:T}\mid x_0))$$</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>$x_{1:T}$ æŒ‡çš„æ˜¯ $x_1, &hellip;, x_T$ æ•´ä¸ªåºåˆ—ã€‚</li>
</ul>
<p>ç°åœ¨ä¾ç„¶æ— æ³•è®¡ç®—ï¼Œæˆ‘ä»¬ç»§ç»­æ¨å¯¼ï¼š</p>
<p>$$
\begin{gathered}
-log(p_\theta(x_0)) \leq-log(p_\theta(x_0))+D_{KL}(q(x_{1:T}\mid x_0)\mid\mid p_\theta(x_{1:T}\mid x_0)) \cr
\leq-log(p_\theta(x_0))+log(\frac{q(x_{1:T}\mid x_0)}{p_\theta(x_{1:T}\mid x_0)})
\end{gathered}
$$</p>
<p>æˆ‘ä»¬å°† KL divergence æ”¹å†™åï¼Œå†åˆ©ç”¨è´å¶æ–¯å…¬å¼è¿›è¡Œå˜å½¢ï¼Œå³åˆ†æ¯å¯ä»¥æ”¹å†™ä¸ºï¼š</p>
<p>$$
\begin{aligned}
p_\theta(x_{1:T}\mid x_0) &amp;=\frac{p_\theta(x_0\mid x_{1:T})\mathrm{~}p_\theta(x_{1:T})}{p_\theta(x_0)} \cr
&amp;=\frac{p_\theta(x_0,x_{1:T})}{p_\theta(x_0)} \cr
&amp;=\frac{p_\theta(x_{0:T})}{p_\theta(x_0)}
\end{aligned}
$$</p>
<p>å°†å…¶ä»£å›åŸå¼ï¼š</p>
<p>$$
\begin{aligned}
log(\frac{q(x_{1:T}\mid x_0)}{p_\theta(x_{1:T}\mid x_0)})&amp; =log(\frac{q(x_{1:T}\mid x_0)}{\frac{p_\theta(x_{0:T})}{p_\theta(x_0)}})  \cr
&amp;=log(\frac{q(x_{1:T}\mid x_0)}{p_\theta(x_{0:T})})+log(p_\theta(x_0))
\end{aligned}
$$</p>
<p>æ‰€ä»¥åŸå¼å¯ç®€åŒ–ä¸ºï¼š</p>
<p>$$-log(p_\theta(x_0))\leq\underbrace{log(\frac{q(x_{1:T}\mid x_0)}{p_\theta(x_{0:T})})}_{\text{å˜åˆ†ä¸‹ç•Œ,å¯ä»¥ä¼˜åŒ–å®ƒ}}$$</p>
<ul>
<li>
<p>åˆ†å­ï¼Œå°±æ˜¯å‰å‘è¿‡ç¨‹ï¼Œå®ƒæ˜¯å›ºå®šçš„ï¼Œä» $x_0$ åˆ° $x_{1:T}$ çš„é‡‡æ ·ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä»æˆ‘ä»¬æ•°æ®ä¸­çš„ä¸€äº›å›¾åƒå¼€å§‹ï¼›</p>
</li>
<li>
<p>åˆ†æ¯ï¼Œ$p_\theta(x_{0:T})=p(x_T)\prod_{t=1}^Tp_\theta(x_{t-1}\mid x_t)$ï¼›</p>
<ul>
<li>å°† $p(x_T)$ æå‡ºæ¥ï¼Œæ˜¯å› ä¸º $p(x_T)$ æ˜¯æŒ‡å½“å‰å›¾åƒï¼Œå®ƒæ˜¯ä¸ä¾èµ–äºç½‘ç»œå‚æ•° $\theta$ çš„.</li>
</ul>
<p>$$
\begin{aligned}
log(\frac{q(x_{1:T}\mid x_0)}{p_{\theta}(x_{0:T})})&amp; =log(\frac{\prod_{t=1}^Tq(x_t\mid x_{t-1})}{p(x_T)\prod_{t=1}^Tp_\theta(x_{t-1}\mid x_t)})  \cr
&amp;=-log(p(x_T))+log(\frac{\prod_{t=1}^Tq(x_t\mid x_{t-1})}{\prod_{t=1}^Tp_\theta(x_{t-1}\mid x_t)}) \cr
&amp;=-log(p(x_T))+\sum_{t=1}^Tlog(\frac{q(x_t\mid x_{t-1})}{p_\theta(x_{t-1}\mid x_t)}) \cr
&amp;=-log(p(x_T))+\sum_{t=2}^Tlog(\frac{q(x_t\mid x_{t-1})}{p_\theta(x_{t-1}\mid x_t)})+\underbrace{log(\frac{q(x_1\mid x_0)}{p_\theta(x_0\mid x_1)})}_{t=1}
\end{aligned}
$$</p>
</li>
</ul>
<p></p>
<p>$q(x_t|x_{t-1})$ æ ¹æ®è´å¶æ–¯å…¬å¼å¯ä»¥å˜æ¢å¦‚ä¸‹ï¼š</p>
<p>$$q(x_t\mid x_{t-1})=\frac{q(x_{t-1}\mid x_t)q(x_t)}{q(x_{t-1})}$$</p>
<p>$q(x_{t-1}|x_{t})$å…·æœ‰æ¯”è¾ƒé«˜çš„æ–¹å·®ï¼Œå› ä¸ºæ ¹æ®è¿™å¼ ç…§ç‰‡ï¼Œæˆ‘ä»¬æ— æ³•ç¡®å®šå®ƒæ¥è‡ªå“ªé‡Œï¼Œä½†æ˜¯å¼•å…¥ $x_0$ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®¹æ˜“çš„é¢„æµ‹å‡º $x_{t-1}$ï¼Œ</p>
<p></p>
<p>å› æ­¤æˆ‘ä»¬ä½¿ç”¨ï¼š</p>
<p>$$\frac{q(x_{t-1}\mid x_t,x_0)\mathrm{~}q(x_t\mid x_0)}{q(x_{t-1}\mid x_0)}$$</p>
<p>æ›¿æ¢è´å¶æ–¯é‡å†™åçš„å¼å­ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š</p>
<p>$$
\begin{aligned}
log(\frac{q(x_{1:T}\mid x_0)}{p_{\theta}(x_{0:T})})&amp; =-log(p(x_T))+\sum_{t=2}^Tlog(\frac{q(x_{t-1}\mid x_t,x_0)q(x_t\mid x_0)}{p_\theta(x_{t-1}\mid x_t)q(x_{t-1}\mid x_0)})+log(\frac{q(x_1\mid x_0)}{p_\theta(x_0\mid x_1)})  \cr
&amp;=-log(p(x_T))+\sum_{t=2}^Tlog(\frac{q(x_{t-1}\mid x_t,x_0)}{p_\theta(x_{t-1}\mid x_t)})+\underbrace{\sum_{t=2}^Tlog(\frac{q(x_t\mid x_0)}{q(x_{t-1}\mid x_0)})}+log(\frac{q(x_1\mid x_0)}{p_\theta(x_0\mid x_1)})
\end{aligned}
$$</p>
<p>ä¸Šè¿°æ ‡è®°çš„å¼å­ï¼Œä¹Ÿå¯ä»¥ç®€åŒ–ï¼Œæˆ‘ä»¬å‡è®¾ $t=4$ï¼š</p>
<p>$$
\begin{gathered}
\begin{aligned}\sum_{t=2}^{T=4}log(\frac{q(x_t\mid x_0)}{q(x_{t-1}\mid x_0)})\end{aligned} =log(\frac{q(x_2\mid x_0)}{q(x_1\mid x_0)}\cdot\frac{q(x_3\mid x_0)}{q(x_2\mid x_0)}\cdot\frac{q(x_4\mid x_0)}{q(x_3\mid x_0)}) \
=log(\frac{q(x_4\mid x_0)}{q(x_1\mid x_0)})
\end{gathered}
$$</p>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç®€åŒ–ä¸ºï¼š</p>
<p>$$
\begin{aligned}
&amp;=-log(p(x_T))+\sum_{t=2}^Tlog(\frac{q(x_{t-1}\mid x_t,x_0)}{p_\theta(x_{t-1}\mid x_t)})+log(\frac{q(x_t\mid x_0)}{q(x_1\mid x_0)})+log(\frac{q(x_1\mid x_0)}{p_\theta(x_0\mid x_1)}) \cr
&amp;=-log(p(x_T))+\sum_{t=2}^Tlog(\frac{q(x_{t-1}\mid x_t,x_0)}{p_\theta(x_{t-1}\mid x_t)})+log(q(x_t\mid x_0))-log(p_\theta(x_0\mid x_1)) \cr
&amp;=log(\frac{q(x_t\mid x_0)}{p(x_T)})+\sum_{t=2}^Tlog(\frac{q(x_{t-1}\mid x_t,x_0)}{p_\theta(x_{t-1}\mid x_t)})-log(p_\theta(x_0\mid x_1))\cr
&amp;=\overbrace{\underbrace{D_{KL}(q(x_t\mid x_0)\mid\mid p(x_T))}<em>{q\text{åªæ˜¯ä¸ªæ­£å‘è¿‡ç¨‹æ²¡æœ‰å¯å­¦ä¹ å‚æ•°}}}^{\text{å¯ä»¥å¿½ç•¥}} + \sum</em>{t=2}^TD_{KL}(q(x_{t-1}\mid x_t,x_0)\mid\mid p_\theta(x_{t-1}\mid x_t))-log(p_\theta(x_0\mid x_1))
\end{aligned}
$$</p>
<ul>
<li>ç¬¬ä¸€é¡¹KLæ•£åº¦å¯ä»¥å¿½ç•¥ï¼Œå› ä¸º$q$åªæ˜¯ä¸ªæ­£å‘è¿‡ç¨‹ï¼Œæ²¡æœ‰å¯å­¦ä¹ å‚æ•°ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å®ƒæ˜¯å›ºå®šçš„ã€‚</li>
<li>ç¬¬äºŒé¡¹KLæ•£åº¦ï¼Œå·¦è¾¹å’Œå³è¾¹éƒ½æ˜¯æ­£å¤ªåˆ†å¸ƒï¼Œåˆ†åˆ«æœä» $N(x_{t-1};\tilde{\mu_t}(x_t,x_0),\tilde{\mathsf{\beta}<em>t}I)$ ã€$N(x</em>{t-1};\mu_\theta(x_t,t),\text{Î²}I)$ï¼š</li>
</ul>
<p>$$
\sum_{t=2}^TD_{KL}(\underbrace{q(x_{t-1}\mid x_t,x_0)}<em>{N(x</em>{t-1};\tilde{\mu}<em>t(x_t,x_0),\tilde{\mathsf{\beta}}<em>tI)}\mid\mid\overbrace{p</em>\theta(x</em>{t-1}\mid x_t)}^{N(x_{t-1};\mu_\theta(x_t,t),\mathsf{\beta}I})
$$</p>
<p>ç¬¬ä¸€é¡¹çš„ $\tilde{\mu_{t}}(x_{t},x_{0})$ã€$\tilde{\beta_{t}}$ å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„å€¼ï¼Œè¿™é‡Œçœç•¥äº†è¿™éƒ¨åˆ†çš„æ¨å¯¼ï¼Œä¸å½±å“ç®—æ³•çš„ç†è§£ï¼Œ</p>
<p>$$
\begin{gathered}\tilde{\mu}<em>t(x_t,x_0)=\frac{\sqrt{\alpha_t}(1-\overline{\alpha}</em>{t-1})}{1-\overline{\alpha}<em>t}x_t+\frac{\sqrt{\alpha}</em>{t-1}\beta_t}{1-\overline{\alpha}_t}x_0\\tilde{\mathsf{\beta}}<em>t=\frac{1-\overline{\alpha}</em>{t-1}}{1-\overline{\alpha}_t}\beta_t\end{gathered}
$$</p>
<blockquote>
<p>å‡¡æ˜¯æ¶‰åŠåˆ° $\alpha_t$ çš„ï¼Œå°±æ˜¯å­¦ä¹ è°ƒåº¦å™¨çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³æ³¨å®ƒ</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥åŒ–ç®€ $\tilde{\mu}_{t}$ï¼Œæˆ‘ä»¬çŸ¥é“ $x_t=\sqrt{\overline{\alpha}_t}x_0+\sqrt{1-\overline{\alpha}_t}\varepsilon $, å³:</p>
<p>$$
x_0=\frac1{\sqrt{\overline{\alpha}_t}}(x_t-\sqrt{1-\overline{\alpha}_t}\left.\varepsilon\right)
$$</p>
<p>è¿˜çŸ¥é“: $\overline{\alpha}=\prod_{s=1}^t\alpha_s$ã€$\alpha_t=1-\beta_t$:</p>
<p>ä»£å…¥ $\tilde{\mu}_{t}$ å¾—åˆ°ï¼š</p>
<p>$$
\begin{aligned}
\underbrace{\tilde{\mu}<em>t(x_t,x_0)}</em>{\text{ä¸å†ä¾èµ–}x_0}&amp; =\frac{\sqrt{\alpha_{t}}(1-\overline{\alpha}<em>{t-1})}{1-\overline{\alpha}</em>{t}}x_{t}+\frac{\sqrt{\overline{\alpha}<em>{t-1}}\beta</em>{t}}{1-\overline{\alpha}<em>{t}}\frac{1}{\sqrt{\overline{\alpha}</em>{t}}}(x_{t}-\sqrt{1-\overline{\alpha}<em>{t}}\varepsilon)  \cr
&amp;=\frac{\alpha_t(1-\overline{\alpha}</em>{t-1})x_t}{\sqrt{\alpha_t}(1-\overline{\alpha}_t)}+\frac{\beta_t}{\sqrt{\alpha_t}(1-\overline{\alpha}_t)}(x_t-\sqrt{1-\overline{\alpha}_t}\left.\varepsilon\right) \cr
&amp;=\frac{\alpha_tx_t-\overline{\alpha}_tx_t+(1-\alpha_t)x_t-(1-\alpha_t)\sqrt{1-\overline{\alpha}_t}\varepsilon}{\sqrt{\alpha_t}(1-\overline{\alpha}_t)} \cr
&amp;=\frac{x_t(1-\overline{\alpha}_t)-(1-\alpha_t)\sqrt{1-\overline{\alpha}_t}\varepsilon}{\sqrt{\alpha_t}(1-\overline{\alpha}_t)} \cr
&amp;=\frac{x_t}{\sqrt{\alpha_t}}-\frac{(1-\alpha_t)\varepsilon}{\sqrt{\alpha_t}\sqrt{(1-\overline{\alpha}_t)}} \cr
&amp;=\frac1{\sqrt{\alpha_t}}(x_t-\frac{\beta_t}{\sqrt{1-\overline{\alpha}_t}}\left.\varepsilon\right)
\end{aligned}
$$</p>
<p>ä»£å…¥ä¹‹åæˆ‘ä»¬å‘ç°å®ƒå°±ä¸å†ä¾èµ–äº $x_0$ äº†ï¼Œå®ƒå°±æ˜¯å’Œ $x_t$ çš„ä¸€ä¸ªå…³ç³»å¼ï¼Œå¼ä¸­çš„ $\alpha_t$ã€$\beta_t$ã€$\varepsilon$éƒ½æ˜¯å·²çŸ¥çš„ï¼Œæœ€åçš„æœ¬è´¨å°±æ˜¯æˆ‘ä»¬åªæ˜¯ä»ä¸­å‡å»ç¼©æ”¾çš„éšæœºå™ªå£°ã€‚</p>
<p>$$\therefore x_{t-1}=N(x_{t-1};\frac1{\sqrt{\alpha_t}}(x_t-\frac{\beta_t}{\sqrt{1-\overline{\alpha}<em>t}}\left.\varepsilon</em>\theta(x_t,t)\right),\Sigma_\theta(x_t,t))$$</p>
<p>è¿™æ ·ä¸€æ¥ï¼ŒDDPMçš„æ¯ä¸€æ­¥æ¨æ–­å¯ä»¥æ€»ç»“ä¸ºï¼š</p>
<ul>
<li>æ¯ä¸ªæ—¶é—´æ­¥é€šè¿‡ $x_t$ å’Œ $t$ æ¥é¢„æµ‹é«˜æ–¯å™ªå£°ï¼Œå›¾ä¸­ç”¨ $z$ è¡¨ç¤ºï¼Œæ ¹æ®ä¸Šè¿°å…¬å¼è®¡ç®—å¾—åˆ°å‡å€¼ $\mu$ï¼›</li>
<li>å¾—åˆ°æ–¹å·® $\Sigma_\theta(x_t,t)$</li>
<li>å…¥å…¬å¼å¾—åˆ° $q(x_{t-1}\mid x_t)$ ï¼Œåˆ©ç”¨é‡å‚æ•°åŒ–å¾—åˆ° $x_{t-1}$ ã€‚</li>
</ul>
<p></p>
<h3 id="43è®­ç»ƒæŸ">4.3ã€è®­ç»ƒæŸ</h3>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹æŸå¤±çš„æ¨å¯¼ï¼Œæˆ‘ä»¬æ¥å›é¡¾ç¬¬äºŒé¡¹ï¼š</p>
<p></p>
<p>æˆ‘ä»¬éœ€è¦å‡å°KLæ•£åº¦ï¼Œç”±äº<mark>æ–¹å·®æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬æ— æ³•ä¼˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦å°†å®ƒä»¬çš„å‡å€¼ä¹‹å·®å‡å°</mark>ï¼ŒåŸè®ºæ–‡ä¸­ä½¿ç”¨çš„æ˜¯ç®€å•çš„å‡æ–¹è¯¯å·®ï¼š</p>
<p>å°†$\mu$è¡¨è¾¾å¼ä»£å…¥ï¼š</p>
<p>$$
\begin{aligned}
L_{t}&amp; =\frac1{2\sigma_t^2}\mid|\tilde{\mu}<em>t(x_t,x_0)-\mu</em>\theta(x_t,t)||^2  \cr
&amp;=\frac1{2\sigma_t^2}\mid\mid\frac1{\sqrt{\alpha_t}}(x_t-\frac{\beta_t}{\sqrt{1-\overline{\alpha}<em>t}}\left.\varepsilon\right)-\frac1{\sqrt{\alpha_t}}(x_t-\frac{\beta_t}{\sqrt{1-\overline{\alpha}<em>t}}\left.\varepsilon</em>\theta(x_t,t)\right)\mid\mid^2 \cr
&amp;=\frac{\beta_t^2}{2\sigma_t^2\alpha_t(1-\overline{\alpha}<em>t)}\underbrace{\mid\mid\varepsilon-\varepsilon</em>\theta(x_t,t)\mid\mid^2}</em>{mse} \cr
&amp;-&gt;\mid\mid\varepsilon-\varepsilon_\theta(x_t,t)\mid\mid^2=\mid\mid\varepsilon-\varepsilon_\theta(\sqrt{\overline{\alpha}_t}\left.x_0+\sqrt{1-\overline{\alpha}_t}\left.\varepsilon_t,t\right)\mid\mid^2\right.
\end{aligned}
$$</p>
<p>ç ”ç©¶äººå‘˜å‘ç°ï¼Œå¿½ç•¥å‰é¢çš„ç³»æ•°é¡¹ä¼šå˜å¾—æ›´ç®€å•ï¼Œé‡‡æ ·è´¨é‡ä¹Ÿä¼šå¾—åˆ°æé«˜ï¼Œæ‰€ä»¥å‰é¢è¿™ä¸ªç³»æ•°é¡¹æˆ‘ä»¬ç›´æ¥å¿½ç•¥ï¼Œå®ƒæ˜¯å’Œå™ªå£°è°ƒåº¦å™¨æœ‰å…³çš„ï¼Œæˆ‘ä»¬åŠ å™ªçš„è¯ä¹Ÿä¼šä½¿è®¡ç®—å¤æ‚ã€‚</p>
<p>æˆ‘ä»¬æœ€å°åŒ– $\mid\mid\varepsilon-\varepsilon_\theta(x_t, t)\mid\mid^2$ ä¹Ÿå°±æ˜¯<strong>æœ€å°åŒ–äº†KLæ•£åº¦</strong>ï¼ŒKLæ•£åº¦å˜å°äº†ä¹Ÿå°±æ˜¯å˜åˆ†ä¸Šé™ä¼˜åŒ–åˆ°æœ€å°ï¼Œæ‰€ä»¥é‚£ä¸ªè´Ÿå¯¹æ•°ä¼¼ç„¶ä¹Ÿä¼šå˜å°ã€‚</p>
<p>ä¸Šé¢è¿˜å‰©äº†æœ€åä¸€é¡¹ $-log(p_\theta(x_0\mid x_1))$ ï¼Œè¿™ä¸ªä½œè€…å†³å®šå»æ‰å®ƒï¼Œå³åœ¨ $t=1$ æ—¶ï¼Œæˆ‘ä»¬ä¸æ·»åŠ å™ªå£°ã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢æ¨ªçº¿çš„åœ°æ–¹ï¼Œåªæœ‰ $t&gt;1$ çš„æ—¶å€™æ‰æœä»é«˜æ–¯åˆ†å¸ƒï¼Œå¦‚æœ $t\leq {1}$ï¼Œç›´æ¥è®© $z=0$ï¼Œå³å™ªå£°è®¾ç½®ä¸º0ã€‚</p>
<p></p>
<p>å›é¡¾ä¸Šé¢æ•´ä¸ªæ¨å¯¼è¿‡ç¨‹ï¼šæˆ‘ä»¬ä»<strong>è´Ÿå¯¹æ•°ä¼¼ç„¶ -&gt; ä¼˜åŒ–ä¸‹ç•Œ -&gt; ç®€åŒ–ä¸‹ç•Œ -&gt; é¢„æµ‹å™ªå£°</strong>ã€‚</p>
<h2 id="äº”torchå¤ç°">äº”ã€torchå¤ç°</h2>
<p><a href="https://wangguisen.blog.csdn.net/article/details/128821008"target="_blank" rel="external nofollow noopener noreferrer">https://wangguisen.blog.csdn.net/article/details/128821008<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>ref:
[1]. <a href="https://arxiv.org/abs/2006.11239"target="_blank" rel="external nofollow noopener noreferrer">https://arxiv.org/abs/2006.11239<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[2]. <a href="https://kexue.fm/archives/9119"target="_blank" rel="external nofollow noopener noreferrer">https://kexue.fm/archives/9119<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[3]. <a href="https://zhuanlan.zhihu.com/p/576475987"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/576475987<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[4]. <a href="https://zhuanlan.zhihu.com/p/525106459"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/525106459<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[5]. <a href="https://www.bilibili.com/video/BV1b541197HX"target="_blank" rel="external nofollow noopener noreferrer">https://www.bilibili.com/video/BV1b541197HX<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[6]. <a href="https://www.bilibili.com/video/BV1WD4y1E7X5"target="_blank" rel="external nofollow noopener noreferrer">https://www.bilibili.com/video/BV1WD4y1E7X5<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[7]. <a href="https://huggingface.co/blog/annotated-diffusion"target="_blank" rel="external nofollow noopener noreferrer">https://huggingface.co/blog/annotated-diffusion<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[8]. <a href="https://www.datalearner.com/blog/1051664857725795"target="_blank" rel="external nofollow noopener noreferrer">https://www.datalearner.com/blog/1051664857725795<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[9]. <a href="https://lilianweng.github.io/posts/2021-07-11-diffusion-models"target="_blank" rel="external nofollow noopener noreferrer">https://lilianweng.github.io/posts/2021-07-11-diffusion-models<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[10]. <a href="https://mp.weixin.qq.com/s?__biz=Mzk0MzIzODM5MA==&amp;mid=2247486128&amp;idx=1&amp;sn=7ffef5d8c1bbf24565d0597eb5eaeb16&amp;chksm=c337b729f4403e3f4ca4fcc1bc04704f72c1dc02876a2bf83c330e7857eba567864da6a64e18&amp;scene=21#wechat_redirect"target="_blank" rel="external nofollow noopener noreferrer">https://mp.weixin.qq.com/s?__biz=Mzk0MzIzODM5MA==&mid=2247486128&idx=1&sn=7ffef5d8c1bbf24565d0597eb5eaeb16&chksm=c337b729f4403e3f4ca4fcc1bc04704f72c1dc02876a2bf83c330e7857eba567864da6a64e18&scene=21#wechat_redirect<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>
[11]. <a href="https://arxiv.org/pdf/2006.11239.pdf"target="_blank" rel="external nofollow noopener noreferrer">paper link<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [1]</title><link>https://jianye0428.github.io/posts/partone/</link><pubDate>Sat, 29 Jul 2023 18:51:19 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/partone/</guid><description><![CDATA[<h1 id="åºè¨€">åºè¨€</h1>
<p>è¿™æœ¬C++çš„ç»å…¸ä¹‹ä½œï¼Œä½œè€…æ˜¯å¤§ä½¬<code>Scott Meyers</code>ğŸ‘‰<a href="https://www.aristeia.com/books.html"target="_blank" rel="external nofollow noopener noreferrer">å¤§ä½¬ä¸»é¡µ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼Œè¿˜å†™è¿‡å…¶ä»–å‡ æœ¬å½±å“æ·±è¿œçš„C++ç»å…¸ï¼Œä¾‹å¦‚<code>ã€ŠEffective STLã€‹</code>,<code>ã€ŠMore Effective C++ã€‹</code>,<code>ã€ŠEffective Mordern C++ã€‹</code>,<code>ã€ŠOverview of the New C++(C++11/14)ã€‹</code>ç­‰ç­‰ã€‚æœ¬äººçœ‹çš„æ˜¯ä¸­æ–‡ç‰ˆï¼Œä¾¯æ·è€å¸ˆç¿»è¯‘çš„ï¼Œç²¾è¯»åˆ†æå¹¶å®è·µæ¨æ•²åï¼Œæ•´ç†æˆåšå®¢è®°å½•ä¸‹æ¥ã€‚</p>
<blockquote>
<p>(Effective-C++æ€»ç»“ç³»åˆ—åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬ä¸€éƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬1~2ç« ï¼Œå†…å®¹èŒƒå›´Rule01~12ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule01ç®€å†™ä¸ºR01)ã€‚</p>
</blockquote>
<div class="details admonition Note">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Effective-C++ç³»åˆ—List<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partone/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/parttwo/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partthree/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partfour/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></div>
    </div>
  </div>
<h2 id="ch1è®©è‡ªå·±ä¹ æƒ¯c">CH1.è®©è‡ªå·±ä¹ æƒ¯C++</h2>
<h3 id="r01-è§†cä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦">R01 è§†C++ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦</h3>
<p>å¦‚ä»Šçš„C++å·²ç»æ˜¯ä¸ªå¤šé‡èŒƒå¼(multiparadigm)è¯­è¨€ï¼ŒåŒæ—¶æ”¯æŒé¢å‘è¿‡ç¨‹å½¢å¼ã€é¢å‘å¯¹è±¡å½¢å¼ã€å‡½æ•°å½¢å¼ã€æ³›å‹å½¢å¼ã€å…ƒç¼–ç¨‹å½¢å¼ã€‚ è¦ç†è§£è¿™ä¹ˆå¤šç‰¹æ€§ï¼Œå¯ä»¥ç®€å•çš„å½’ç»“ä¸º<code>å››ç§æ¬¡è¯­è¨€</code>(sublanguage)ç»„æˆï¼š</p>
<ul>
<li><strong>Cè¯­è¨€:</strong> <code>C++ä»ä»¥Cä¸ºåŸºç¡€</code>ã€‚C++æ˜¯Cçš„è¶…é›†, ä»ç„¶ä»¥ C ä¸ºåŸºç¡€ã€‚<font color=green>åŒºå—</font>ã€<font color=green>è¯­å¥</font>ã€<font color=green>é¢„å¤„ç†å™¨</font>ã€<font color=green>å†…ç½®æ•°æ®ç±»å‹</font> ã€<font color=green>æ•°ç»„</font>ã€<font color=green>æŒ‡é’ˆ</font>ç­‰ç»Ÿç»Ÿæ¥è‡ªCï¼Œè®¸å¤šæ—¶å€™C++å¯¹é—®é¢˜çš„è§£å†³å…¶å®ä¸è¿‡å°±æ˜¯è¾ƒé«˜çº§çš„ C è§£æ³•ï¼Œä½†å½“ä½ C++å†…çš„ C æˆåˆ†å·¥ä½œæ—¶ï¼Œé«˜æ•ˆç¼–ç¨‹å®ˆåˆ™æ˜ ç…§å‡º C è¯­è¨€çš„<font color=red>å±€é™</font>ï¼šæ²¡æœ‰æ¨¡æ¿(template) ï¼Œæ²¡æœ‰å¼‚å¸¸(exceptions)ï¼Œæ²¡æœ‰é‡è½½(overloading)â€¦â€¦</li>
<li><strong>Object-Oriented C++:</strong> é¢å‘å¯¹è±¡ç‰¹æ€§ã€‚è¿™éƒ¨åˆ†ä¹Ÿå°±æ˜¯ C with classes æ‰€è¯‰æ±‚çš„: <strong>classes</strong>(åŒ…æ‹¬æ„é€ å‡½æ•°å’Œææ„å‡½æ•°)ï¼Œ<strong>å°è£…</strong>(encapsulation)ã€<strong>ç»§æ‰¿</strong>(inheritance)ã€<strong>å¤šæ€</strong>(polymorhpism)ã€<strong>virtualå‡½æ•°</strong>(åŠ¨æ€ç»‘å®š)â€¦â€¦ç­‰ç­‰ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯é¢å‘å¯¹è±¡è®¾è®¡ä¹‹å¤å…¸å®ˆåˆ™åœ¨C++ ä¸Šçš„ç›´æ¥å®æ–½ã€‚</li>
<li><strong>Template C++:</strong> C++çš„æ³›å‹(generic)ç¼–ç¨‹çš„éƒ¨åˆ†ï¼Œä¹Ÿå¸¦æ¥äº†é»‘é­”æ³•-æ¨¡æ¿å…ƒç¼–ç¨‹(TMP,Metaprogramming)ï¼›</li>
<li><strong>STLï¼š</strong> STL(Standard Temlate Library)å³æ ‡å‡†æ¨¡æ¿åº“ï¼Œå®ƒæ˜¯templateç¨‹åºåº“ã€‚å°è£…äº†å„ç±»å®¹å™¨(container)ã€é…ç½®å™¨(allocator)ã€è¿­ä»£å™¨(iterator)ã€ç®—æ³•ä»¥åŠå¸¸ç”¨å¯¹è±¡ã€‚</li>
</ul>
<p><strong>æ€»ç»“:</strong>
C++é«˜æ•ˆç¼–ç¨‹å®ˆåˆ™è§†çŠ¶å†µè€Œå˜åŒ–ï¼Œå–å†³äºä½ ä½¿ç”¨C++çš„å“ªä¸€éƒ¨åˆ†</p>
<h3 id="r02-å°½é‡ä»¥constenuminlineæ›¿æ¢define">R02 å°½é‡ä»¥<code>const</code>,<code>enum</code>,<code>inline</code>æ›¿æ¢<code>#define</code></h3>
<ul>
<li><strong>å¯¹äºå®å®šä¹‰çš„å¸¸é‡ï¼Œå»ºè®®ç”¨constå¸¸é‡æˆ–è€…æšä¸¾enumæ›¿æ¢</strong>
è¿™æ ·åšçš„å¥½å¤„æ˜¯æ–¹ä¾¿è°ƒè¯•ï¼Œå› ä¸ºå®æŠ¥é”™å°±æ˜¯ä¸ªå¸¸æ•°å€¼ï¼Œæ²¡æœ‰ç¬¦å·è¡¨ï¼›å¹¶ä¸”å®ä¸å…·æœ‰å°è£…æ€§(å®çš„ä½œç”¨åŸŸæ˜¯åœ¨ç¼–è¯‘æ—¶æ˜¯å…¶å®šä¹‰ä¹‹äº‹)ã€‚
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// ä¸¾ä¾‹ï¼šMAX_DATA_COUNTåœ¨é¢„å¤„ç†é˜¶æ®µå°±ä¼šè¢«æ›¿æ¢ï¼Œç¼–è¯‘å™¨ä¸ä¼šè§åˆ°å®ƒï¼Œæ‰€ä»¥ä¸€æ—¦æœ‰ç›¸å…³æŠ¥é”™ï¼Œç»™çš„æ˜¯100è¿™ä¸ªå€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define MAX_DATA_COUNT   100
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_DATA_COUNT</span> <span class="o">=</span> <span class="mi">100</span> <span class="p">;</span><span class="c1">// å¸¸é‡åªæœ‰ä¸€ä»½ï¼Œå®ä¼šå¯¼è‡´å¤šä»½å¸¸é‡å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Buffer</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span><span class="c1">//...ç±»å…¶ä»–éƒ¨åˆ†çœç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">static</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">factor_</span> <span class="p">;</span><span class="c1">// staticå¸¸é‡,ç±»å†…å£°æ˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span>  <span class="n">times_</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="c1">// intç±»å‹å…è®¸ç±»å†…åˆå§‹åŒ–,è§„èŒƒä¸Šè¿˜æ˜¯å»ºè®®æ‹¿åˆ°ç±»å¤–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">ArrLength</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">arr</span><span class="p">[</span><span class="n">ArrLength</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">double</span> <span class="n">Buffer</span><span class="o">::</span><span class="n">factor_</span>  <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span><span class="c1">// ç±»å¤–åˆå§‹åŒ–,ä¸€èˆ¬å†™åœ¨å®ç°æ–‡ä»¶*.cpp,*.ccä¸­
</span></span></span></code></pre></td></tr></table>
</div>
</div>å¦‚æœç¼–è¯‘å™¨ä¸å…è®¸å£°æ˜æ—¶&quot;in-classåˆå€¼è®¾å®š&quot;,å¦‚æœæ˜¯æ•´å½¢å¸¸é‡ï¼Œå¯ä»¥è®©æšä¸¾å€¼æ¥æ›¿ä»£ï¼Œè€Œä¸”<font color=red><code>æšä¸¾å€¼ä¸èƒ½è¢«å–åœ°å€</code></font>ã€‚</li>
<li><strong>å¯¹äºå®å®šä¹‰çš„å‡½æ•°ï¼Œå»ºè®®ç”¨å†…è”inlineå‡½æ•°æ›¿æ¢</strong>
å®å‡½æ•°æ²¡åŠæ³•å•è¡Œdebugè°ƒè¯•ï¼Œè€Œå†…è”å‡½æ•°å¯ä»¥ï¼›
å®çš„å†™æ³•å³ä½¿å°å¿ƒç¿¼ç¿¼çš„åŠ å¥½äº†æ‹¬å·ï¼Œä¹Ÿå¯èƒ½é€ æˆæ„æƒ³ä¸åˆ°çš„<font color=red><code>å®å‡½æ•°é‡å¤è®¡ç®—</code></font>çš„é—®é¢˜ã€‚
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#define  GET_MAX(a,b)   ((a)&gt;(b) ? (a) :(b))
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">GET_MAX</span><span class="p">(</span><span class="o">++</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>    <span class="c1">// aç´¯åŠ äºŒæ¬¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">GET_MAX</span><span class="p">(</span><span class="o">++</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">+</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// aç´¯åŠ ä¸€æ¬¡
</span></span></span><span class="line"><span class="cl"><span class="c1">// å®šä¹‰ä¸ªinlineå‡½æ•°å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜,(a,b)ä½œä¸ºå‡½æ•°å…¥å‚å°±åªä¼šè®¡ç®—ä¸€æ¬¡
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>ä¸Šè¿°æƒ…å†µï¼Œä»çº¯Cè¯­è¨€è§’åº¦ï¼Œæƒ³é¿å…â€œå®å‡½æ•°é‡å¤è®¡ç®—â€ï¼Œå…¶å®è¿˜æœ‰ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨GNU C æ‰©å±•çš„ typeof æˆ– GCC çš„ <code>__auto_type</code> å…³é”®å­—ï¼Œè¯¦ç»†å¯å‚è€ƒGCCå®˜æ–¹æ–‡æ¡£é¡µé¢ã€‚2è€…éƒ½é€‚ç”¨äºGCCå’ŒClangï¼Œéƒ½ä¸é€‚ç”¨MSVCï¼‰ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-17"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define  GET_MAX_ONCE(a,b) \
</span></span></span><span class="line"><span class="cl"><span class="cp">      ( {typeof(a) _a = (a);   \
</span></span></span><span class="line"><span class="cl"><span class="cp">         typeof(b) _b = (b);   \
</span></span></span><span class="line"><span class="cl"><span class="cp">         (_a) &gt; (_b) ? (_a) : (_b); } )</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-18"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="nf">GET_MAX</span><span class="p">(</span><span class="o">++</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">++</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;a = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, b = &#34;</span><span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, c = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="nf">GET_MAX_ONCE</span><span class="p">(</span><span class="o">++</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">++</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;a = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, b = &#34;</span><span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, c = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•ä»£ç è¾“å‡ºï¼š</p>
<div class="highlight" id="id-19"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">a</span> <span class="o">=</span> 11, <span class="nv">b</span> <span class="o">=</span> 22, <span class="nv">c</span> <span class="o">=</span> <span class="m">21</span>
</span></span><span class="line"><span class="cl"><span class="nv">a</span> <span class="o">=</span> 11, <span class="nv">b</span> <span class="o">=</span> 21, <span class="nv">c</span> <span class="o">=</span> <span class="m">20</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ğŸ¤” <code>ä½¿ç”¨ __auto_type</code> æ¥å–ä»£æ—¶è¦èµ‹åˆå€¼ï¼Œå…³é”®çš„ typeof é‚£è¡Œç”¨æ³•æ”¹ä¸º<code>__auto_type _a = (a);</code> ã€‚
__auto_type æ¯” typeof çš„ä¼˜åŠ¿ä¹‹å¤„åœ¨äºé¢å¯¹å˜é•¿æ•°ç»„(VLA)ï¼Œåªè§£æ1æ¬¡ï¼›ä»¥åŠé¢å¯¹åµŒå¥—å®å®šä¹‰æ—¶ä¹Ÿæ˜¯åªä¸¥æ ¼è§£æä¸€æ¬¡ã€‚</p>
</blockquote>
</div>
    </div>
  </div></li>
</ul>
<h3 id="r03-å°½å¯èƒ½ç”¨const">R03 å°½å¯èƒ½ç”¨const</h3>
<p>è¯´èµ·constï¼Œå…ˆå¤ä¹ ä¸ªé¢è¯•é«˜é¢‘é¢˜ğŸ˜</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//ç±»å‹charåœ¨å“ªé‡Œæ²¡å…³ç³»ï¼Œå…³é”®çœ‹constå’Œ*çš„ç›¸å¯¹ä½ç½®ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//conståœ¨*å·¦è¾¹ï¼ŒæŒ‡é’ˆæ‰€æŒ‡ç‰©ä¸ºå¸¸é‡;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//conståœ¨*å³è¾¹ï¼ŒæŒ‡é’ˆä¸ºå¸¸é‡ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">p</span><span class="p">;</span> <span class="c1">// æŒ‡é’ˆpæ‰€æŒ‡çš„å­—ç¬¦ä¸²ä¸ºå¸¸é‡ï¼Œä½†æ˜¯på¯ä»¥ä¿®æ”¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">char</span><span class="o">*</span> <span class="k">const</span> <span class="n">p</span><span class="p">;</span> <span class="c1">// æŒ‡é’ˆpæ˜¯å¸¸é‡ï¼ŒæŒ‡å‘çš„å­—ç¬¦ä¸²å¯ä¿®æ”¹
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>constä¿®é¥°å‡½æ•°è¿”å›å€¼æ—¶çš„é˜²å¾¡æ€§
constä¿®é¥°å‡½æ•°çš„è¿”å›å€¼ï¼Œå¯ä»¥é¿å…ä¸€äº›é”™è¯¯ï¼Œå¦‚ä¸‹ï¼š
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">const</span> <span class="n">Rational</span> <span class="k">operator</span><span class="o">*</span> <span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å­˜åœ¨Rational a,b,c;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="p">)</span> <span class="c1">//ä¾‹å¦‚æ‰‹è¯¯ &#34;==&#34;æ‰“æˆäº†&#34;=&#34;ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>constæˆå‘˜å‡½æ•°çš„é™åˆ¶
constæˆå‘˜å‡½æ•°æœ‰2ä¸ªå¥½å¤„ï¼š(1). æ˜ç¡®ç†è§£å‡½æ•°æ˜¯å¦ä¿®æ”¹å¯¹è±¡å†…å®¹ï¼›(2). ä½¿â€œæ“ä½œconstå¯¹è±¡â€æˆä¸ºå¯èƒ½ã€‚
å¯ä»¥é€šè¿‡constç‰¹æ€§è®©å¯¹è±¡è‡ªåŠ¨è°ƒç”¨æ­£ç¡®çš„ç‰ˆæœ¬ï¼š
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TextBlock</span><span class="p">{</span><span class="c1">//...ç±»å…¶ä»–éƒ¨åˆ†çœç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">const</span> <span class="kt">char</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span> <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">index</span><span class="p">];}</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">index</span><span class="p">];}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">TextBlock</span><span class="o">&amp;</span> <span class="n">ctb</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ctb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">;</span><span class="c1">//æ ¹æ®constç‰¹æ€§ï¼Œè°ƒç”¨ const TextBlock::operator[]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>æ€è€ƒï¼šconstæˆå‘˜å‡½æ•°ä¸ä¿®æ”¹æˆå‘˜å¯¹è±¡ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæˆå‘˜å¯¹è±¡ä¸ºæŒ‡é’ˆ<code>char *p</code>ï¼Œä»…ä¿®æ”¹<code>p</code>æŒ‡å‘çš„å†…å®¹ï¼Œé‚£å®ƒè¿˜æ˜¯<code>const</code>æˆå‘˜å‡½æ•°å—ï¼Ÿ
å®æµ‹ï¼šconstæˆå‘˜å‡½æ•°æ˜¯å…è®¸<code>p[2]= 'x'</code>è¿™ä¸€æ“ä½œçš„ï¼Œä½†æ˜¯ä¸å…è®¸p++ï¼›
<ul>
<li><code>bitwise-constness</code>(åˆç§°ä¸ºphysical constness)ç†å¿µè®¤ä¸ºä¸æ˜¯ï¼Œä¸èƒ½æ›´æ”¹ä»»ä½•å¯¹è±¡å†…çš„ä»»ä½•ä¸€ä¸ªbitã€‚è¿™ç§è¯´æ³•ä¹Ÿæœ‰çº°æ¼ï¼Œconstå‡½æ•°è¿”å›ä¸€ä¸ªå¼•ç”¨å°±å¤±æ§äº†,å¤–éƒ¨å¯æ”¹ï¼›</li>
<li><code>logical-constness</code>ç†å¿µåˆ™å…è®¸constæˆå‘˜å‡½æ•°ä¿®æ”¹æˆå‘˜å˜é‡çš„bitsï¼Œä½†åªæœ‰åœ¨å®¢æˆ·ç«¯ä¾¦æµ‹ä¸å‡ºçš„æƒ…å†µä¸‹;</li>
<li><code>constæˆå‘˜å‡½æ•°</code>å¦‚æœä¸€å®šè¦ä¿®æ”¹æˆå‘˜å˜é‡ï¼Œæˆå‘˜å˜é‡ä½¿ç”¨ <code>mutable</code> ä¿®é¥°å³å¯.</li>
</ul>
</li>
<li>constä¸non-constçš„æˆå‘˜å‡½æ•°å®ç°å®Œå…¨ç›¸åŒæ—¶
è¿™ç§æƒ…å†µï¼Œå¦‚ä½•å»é™¤ä»£ç å†—ä½™æ˜¯ä¸ªé—®é¢˜ã€‚ä¸è¦å°è£…å‡ºä¸€ä¸ªprivateå‡½æ•°ç„¶åä¸€èµ·è°ƒç”¨ï¼Œå¤šäº†å±‚è°ƒç”¨ã€‚
æ­£ç¡®åšæ³•ğŸ‘‰ <code>ä½¿ç”¨è½¬å‹,è®©non-constè°ƒç”¨constæˆå‘˜å‡½æ•°</code>ï¼Œå¦‚ä¸‹ä¸ºç¤ºä¾‹ï¼š</li>
</ul>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Rawdata</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Rawdata</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span><span class="o">:</span><span class="n">p_</span><span class="p">(</span><span class="n">src</span><span class="p">),</span><span class="n">length_</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">src</span><span class="p">))</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">GetLength</span><span class="p">()</span><span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">p_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span><span class="c1">//ä¸ºæ±‚ç®€ä¾¿,ä¸ä½œæ£€æŸ¥äº†ã€‚p_å†…å®¹ä¿®æ”¹ç¼–è¯‘å™¨æ˜¯å…è®¸çš„.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">length_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">GetLength</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&amp;&gt;</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Rawdata</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)).</span><span class="n">GetLength</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">p_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">length_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="r04-ç¡®å®šå¯¹è±¡ä½¿ç”¨å‰å…ˆåˆå§‹åŒ–">R04 ç¡®å®šå¯¹è±¡ä½¿ç”¨å‰å…ˆåˆå§‹åŒ–</h3>
<p>åˆ†æ¸…&quot;èµ‹å€¼&quot;å’Œ&quot;åˆå§‹åŒ–&quot;ï¼Œåœ¨ç±»çš„æ„é€ å‡½æ•°ä½“å†…ä½¿ç”¨ç­‰å·&quot;=&ldquo;èµ‹å€¼å¹¶é&quot;åˆå§‹åŒ–â€ã€‚æˆå‘˜å˜é‡çš„åˆå§‹åŒ–æ˜¯åœ¨æ„é€ å‡½æ•°çš„<u>æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</u>å®ç°ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p>
<p><code>C++åˆå§‹åŒ–çš„æ¬¡åº:</code></p>
<ol>
<li>Base classæ€»æ˜¯æ—©äºDerived Classè¢«åˆå§‹åŒ–ï¼›</li>
<li>Classå†…çš„æˆå‘˜å˜é‡æ€»æ˜¯ä»¥å£°æ˜æ¬¡åºè¢«åˆå§‹åŒ–ï¼›
ä¸¾ä¾‹: ä¸‹å›¾ä¸­çš„ä»£ç åˆå§‹åŒ–é¡ºåºä¸ºå£°æ˜é¡ºåº&quot;age_$\rightarrow$name_$\rightarrow$gender_ $\rightarrow$isVip_&rdquo;
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"> <span class="k">class</span> <span class="nc">Customer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> <span class="c1">//è¿™é‡Œåªæ˜¯ä¸ºäº†éªŒè¯ï¼Œå¦‚æœæ˜¯å®é™…å·¥ç¨‹ä»£ç ï¼Œå»ºè®®åˆå€¼åˆ—è¡¨å°½é‡å’Œå£°æ˜é¡ºåºä¿æŒä¸€è‡´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="n">Customer</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">gender</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">age</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isVip</span> <span class="o">=</span> <span class="nb">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="o">:</span><span class="n">isVip_</span><span class="p">(</span><span class="n">isVip</span><span class="p">),</span> <span class="n">gender_</span><span class="p">(</span><span class="n">gender</span><span class="p">),</span> <span class="n">name_</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">age_</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">     <span class="kt">uint8_t</span> <span class="n">age_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">gender_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="kt">bool</span> <span class="n">isVip_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><pre><code>ğŸ’¡ï¼šä»»ä½•ä¸€ä¸ªæˆå‘˜å˜é‡açš„åˆå§‹åŒ–æµç¨‹ï¼šç±»å†…å£°æ˜èµ‹åˆå€¼(C++11)-&gt;æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨-&gt;æ„é€ å‡½æ•°ä½“å†…èµ‹å€¼.
</code></pre>
</div>
    </div>
  </div></li>
<li>å‡½æ•°ä½“å¤–staticå˜é‡ç§°ä¸º<code>non-local static</code>å˜é‡ï¼Œè¿™ç§å˜é‡å¯ä»¥åœ¨å„è‡ªçš„ç¼–è¯‘å•å…ƒæ­£å¸¸å·¥ä½œï¼Œä½†C++æ— æ³•ä¿è¯åˆå§‹åŒ–æ¬¡åºï¼Œå½“ç¼–è¯‘å•å…ƒä¹‹é—´éœ€è¦å…±äº«å˜é‡æ—¶ï¼Œè€Œè¯¥å˜é‡ä¾èµ–non-local staticï¼Œå°±å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚
<strong>è§£å†³åŠæ³•</strong>æ˜¯å°†è¿™æ ·çš„å˜é‡æ”¾å›å‡½æ•°ä½“å†…ï¼Œæˆä¸ºlocal staticï¼Œå› ä¸ºC++ç¡®ä¿åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶ä¸€å®šä¼šåˆå§‹åŒ–è¿™ä¸ªstaticå˜é‡ã€‚</li>
</ol>
<h2 id="ch2æ„é€ ææ„èµ‹å€¼è¿ç®—">CH2.æ„é€ /ææ„/èµ‹å€¼è¿ç®—</h2>
<h3 id="r05-äº†è§£cé»˜è®¤ç¼–å†™å¹¶è°ƒç”¨å“ªäº›å‡½æ•°">R05 äº†è§£C++é»˜è®¤ç¼–å†™å¹¶è°ƒç”¨å“ªäº›å‡½æ•°</h3>
<p>ç¼–è¯‘å™¨å¯ä»¥æš—è‡ªä¸ºClassåˆ›å»º<code>defaultæ„é€ å‡½æ•°</code>ï¼Œ<code>copyæ„é€ å‡½æ•°(å¤åˆ¶æ„é€ )</code>ï¼Œ<code>copy assigment(èµ‹å€¼æ„é€ )æ“ä½œç¬¦</code>ï¼Œä»¥åŠ<code>defaultææ„å‡½æ•°</code>ã€‚</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EmptyClass</span><span class="p">{};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç­‰ä»·äº:</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EmptyClass</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">EmptyClass</span><span class="p">()</span> <span class="p">{}</span>        <span class="c1">// defaultæ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">EmptyClass</span><span class="p">(</span><span class="k">const</span> <span class="n">EmptyClass</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{}</span><span class="c1">//copyæ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">~</span><span class="n">EmptyClass</span><span class="p">()</span> <span class="p">{}</span><span class="c1">//defaultææ„å‡½æ•°ï¼Œæ³¨æ„æ˜¯non-virtual
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">EmptyClass</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">EmptyClass</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{}</span><span class="c1">//copy assignmentæ“ä½œç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å¦‚æœä¸€ä¸ªéç©ºClassè‡ªè¡Œå£°æ˜äº†æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨å°±ä¸å†ä¸ºå®ƒåˆ›å»ºdefaultæ„é€ å‡½æ•°;</p>
</li>
<li>
<p>å¦‚æœä¸€ä¸ªClasså†…æœ‰å¼•ç”¨å˜é‡æˆ–constå˜é‡ï¼Œç¼–è¯‘å™¨ä¸ä¼šä¸ºå…¶ç”Ÿæˆcopy-assignmentå‡½æ•°ï¼Œéœ€è¦è‡ªå·±å®ç°.</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NameObject</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">NameObject</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span> <span class="o">:</span><span class="n">nameValue_</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">objectVal_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">nameValue_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">int</span> <span class="n">objectVal_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span><span class="c1">//è€ƒè™‘ä»¥ä¸‹åº”ç”¨ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">(</span><span class="s">&#34;Mike&#34;</span><span class="p">),</span> <span class="n">name2</span><span class="p">(</span><span class="s">&#34;Nicky&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">NameObject</span> <span class="nf">nObj</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">22</span><span class="p">),</span> <span class="n">nObj2</span><span class="p">(</span><span class="n">name2</span><span class="p">,</span><span class="mi">33</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">nObj2</span> <span class="o">=</span> <span class="n">nObj</span><span class="p">;</span><span class="c1">//è¿™ä¸€å¥ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œå› ä¸ºå¼•ç”¨ä¸èƒ½æŒ‡å‘2ä¸ªå¯¹è±¡ï¼Œä¸”constä¸å¯æ”¹
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="r06-ä¸æƒ³ç¼–è¯‘å™¨çš„è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°æ˜ç¡®æ‹’ç»">R06 ä¸æƒ³ç¼–è¯‘å™¨çš„è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°,æ˜ç¡®æ‹’ç»</h3>
<p>æŸäº›åœºæ™¯ï¼Œç±»å¯¹è±¡æœ¬èº«æ˜¯è®¤ä¸ºç‹¬ä¸€æ— äºŒçš„ï¼Œæ¯”å¦‚æè¿°äººç‰©æ€§æ ¼çš„ç±»Personality(å¯èƒ½ä¸æ°å½“)ï¼Œä¸åŒçš„äººæ€§æ ¼ä¸åŒï¼Œè‚¯å®šæ˜¯ä¸å¸Œæœ›èƒ½å¤åˆ¶/èµ‹å€¼çš„ã€‚
å¦‚æœä¸æƒ³ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆé‚£å‡ ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚ä¸æƒ³è¦å¤åˆ¶æ„é€ æˆ–èµ‹å€¼æ„é€ ï¼Œå°±æ˜ç¡®åœ¨ä»£ç ä¸­ç¦æ­¢ï¼Œä¹Ÿé˜²æ­¢å¤–éƒ¨ç”¨æˆ·ä½¿ç”¨ã€‚</p>
<ul>
<li>æŠ€å·§1ï¼šå¯ä»¥å£°æ˜ä¸ºprivateå‡½æ•°ä½†æ˜¯ä¸ç»™å‡ºå®ç°ï¼Œè®©ç¼–è¯‘å™¨æŠ¥é”™ï¼›</li>
<li>æŠ€å·§2ï¼šå¯ä»¥è®¾ç«‹åŸºç±»Baseï¼Œè®©å¤åˆ¶æ„é€ å’Œèµ‹å€¼æ„é€ éƒ½ä¸ºprivateå‡½æ•°ï¼Œè®©ç›®æ ‡ç±»ç»§æ‰¿äºBaseç±»ã€‚</li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>C++11é’ˆå¯¹æ­¤ç±»æƒ…å†µï¼Œç»™äºˆäº†deleteå…³é”®å­—ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œåœ¨æˆå‘˜å‡½æ•°åé¢æ–°å¢&quot;=delete&quot;ï¼Œå³å¯æ˜¾å¼åœ°æ‹’ç»è¿™ä¸ªå‡½æ•°çš„ç”Ÿæˆå’Œè°ƒç”¨.ä¸¾ä¾‹å¦‚ä¸‹:</p>
<div class="highlight" id="id-20"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">A</span><span class="p">(</span><span class="k">const</span> <span class="n">A</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span> <span class="c1">// æ‹·è´æ„é€ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">A</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">A</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span> <span class="c1">// æ‹·è´èµ‹å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div></div>
    </div>
  </div>
<h3 id="r07-ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°">R07 ä¸ºå¤šæ€åŸºç±»å£°æ˜<code>virtual</code>ææ„å‡½æ•°</h3>
<ul>
<li>é’ˆå¯¹<code>Base* pBase= new DerivedObj()</code>ï¼Œé‡Šæ”¾pBaseæ—¶ï¼Œå¦‚æœBaseåŸºç±»çš„ææ„å‡½æ•°<code>None-Virtual</code>ï¼Œåˆ™ä¼šå¯¼è‡´Derivedçš„ææ„å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ï¼Œé€ æˆ<code>å†…å­˜ä¸å®Œå…¨é‡Šæ”¾</code>ï¼Œå³å†…å­˜æ³„æ¼ï¼›</li>
<li>Non-Virtualçš„Classä¸è¦åšåŸºç±»ï¼›</li>
<li>å¦‚æœä¸åšåŸºç±»ï¼Œå°±ä¸è¦å£°æ˜ææ„å‡½æ•°ä¸ºvirtualå‡½æ•°ï¼Œé¿å…è™šè¡¨ä¸ºå…¶åˆ†é…vptré€ æˆæµªè´¹ï¼›</li>
<li>å¦‚æœæƒ³è¦æŠ½è±¡ç±»ï¼Œåˆæš‚æ—¶æ²¡æœ‰åˆé€‚æ¥å£ï¼Œå¯ä»¥è®©å…ˆè™šææ„æˆä¸ºçº¯è™šå‡½æ•°ï¼Œä¾‹å¦‚
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RawData</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">RawData</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è¿™é‡Œç‰¹æ®Šçš„æ˜¯ï¼Œéœ€è¦ä¸ºè¿™ä¸ªçº¯è™šå‡½æ•°æä¾›å®šä¹‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">~</span><span class="n">RawData</span><span class="o">::</span><span class="n">RawData</span><span class="p">(){}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="r08-åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°">R08 åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°</h3>
<ul>
<li>
<p>ææ„å‡½æ•°æœ€å¥½ä¸è¦åå‡ºå¼‚å¸¸</br>
å¯¹äºæŸä¸ªWidgetç±»ï¼Œå¦‚æœææ„å‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆ<code>vector&lt;widget&gt;</code>ææ„æ—¶å¯èƒ½è¿ç»­æŠ›å‡ºå¤šä¸ªå¼‚å¸¸ä»¥è‡³äºæ— æ³•å¤„ç†ï¼Œç›´æ¥å¯¼è‡´æå‰ç¨‹åºç»“æŸæˆ–è€…æœªå®šä¹‰è¡Œä¸ºã€‚</p>
</li>
<li>
<p>å¦‚æœæœ‰æŸä¸ªå‡½æ•°å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶éœ€è¦å¯¹å¼‚å¸¸åšå‡ºååº”ï¼Œåº”è¯¥æä¾›ä¸€ä¸ªéææ„çš„å‡½æ•°æ¥å¤„ç†</br>
æ³¨æ„ï¼Œåœ¨ææ„ä¸­æŠ›å¼‚å¸¸å¹¶åä¸‹(catchågo-on-execute)ï¼Œä¼šæ©ç›–é”™è¯¯ï¼Œä¹Ÿä¸æ˜¯ä¸ªå¥½åŠæ³•;æŠ›å¼‚å¸¸åcatchä½å¹¶std::abort()åè€Œå¯ä»¥æå‰ç»ˆç»“ã€æœªå®šä¹‰è¡Œä¸ºã€ã€‚</p>
</li>
</ul>
<h3 id="r09-ç»ä¸åœ¨æ„é€ å’Œææ„è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°">R09 ç»ä¸åœ¨æ„é€ å’Œææ„è¿‡ç¨‹ä¸­è°ƒç”¨<code>virtual</code>å‡½æ•°</h3>
<ul>
<li>åœ¨Derived-Classçš„Base-Classæ„é€ æœŸé—´ï¼Œå¯¹è±¡çš„ç±»å‹æ˜¯Base-Classï¼Œè€ŒéDerivedï¼Œå³ä½¿<code>dynamic_cast</code>ä¹Ÿæ˜¯è¿™æ ·è®¤ä¸ºçš„ï¼Œå› ä¸ºæ­¤æ—¶virtualå‡½æ•°ä¸ä¼šä¸‹é™åˆ°Derived-Classçš„é˜¶å±‚ï¼›æ¢å¥è¯è¯´==&gt; â€œ<code>åœ¨Base-Classæ„é€ æœŸé—´ï¼Œvirtualå‡½æ•°ä¸æ˜¯virtualå‡½æ•°</code>â€ï¼›</li>
<li>åœ¨ææ„çš„æ—¶å€™ä¹Ÿæ˜¯ç±»ä¼¼é“ç†ï¼Œä¹Ÿä¸è¦åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨virtualå‡½æ•°ï¼Œé—´æ¥è°ƒç”¨ä¹Ÿä¸è¡Œ(æ¯”å¦‚non-Virtual-&gt;virtual)ï¼›</li>
<li>é‚£ä¹ˆæ›¿ä»£æ–¹æ¡ˆæ˜¯ï¼Ÿ</br>
å¦‚æœæœ‰è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå¸Œæœ›åœ¨å­ç±»æ„é€ æ—¶èƒ½è°ƒç”¨çˆ¶ç±»çš„fooå‡½æ•°(ä¸‹æ–¹logTransactionå‡½æ•°)ï¼Œé‚£ä¹ˆå°†fooæ”¹ä¸ºnon-Virtualå‡½æ•°ï¼Œå¹¶ä¸”å­ç±»æ„é€ æ—¶è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œæœ‰å‚æ•°æ—¶ä¸€å¹¶ä¼ è¿‡å»ï¼›</li>
</ul>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Transaction</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">explict</span> <span class="n">Transaction</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">info</span><span class="p">,</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span><span class="o">:</span><span class="n">id_</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="n">logTransaction</span><span class="p">(</span><span class="n">info</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">logTransaction</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">info</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">info</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span> <span class="p">}</span><span class="c1">//non-Virtualå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">id_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BuyTransaction</span> <span class="o">:</span><span class="k">public</span> <span class="n">Transaction</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>  <span class="c1">//å°†logä¿¡æ¯ä¼ é€’ç»™ åŸºç±»Transactionæ„é€ å‡½æ•°ï¼› å¹¶åˆå§‹åŒ–äº†åŸºç±»æˆå‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">BuyTransaction</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">info</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span><span class="n">Transaction</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœæœ‰å‡ ä¸ªBaseæ„é€ å‡½æ•°ï¼Œå°±å¾—å†™å‡ ä¸ªDerivedæ„é€ å‡½æ•°ä¼ å‚ã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸€æ­¥éª¤ï¼Œ åœ¨ç°ä»£C++11ï¼Œæ¨å‡ºäº†ç»§æ‰¿æ„é€ å‡½æ•°(Inheriting Constructor)ï¼Œå­ç±»å¯ä»¥ä¸€ä¸ªéƒ½ä¸ç”¨å†™ï¼Œç›´æ¥å†™ä¸€å¥usingå£°æ˜å³å¯ï¼Œä½¿ç”¨<code>using BaseClass::BaseClass</code>çš„å½¢å¼ï¼Œå¦‚ä¸‹ğŸ‘‡</p>
<div class="highlight" id="id-21"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BuyTransaction</span> <span class="o">:</span><span class="k">public</span> <span class="n">Transaction</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="n">Transaction</span><span class="o">::</span><span class="n">Transaction</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//å…¶ä»–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div></div>
    </div>
  </div>
<h3 id="r10-ä»¤operatorè¿”å›ä¸€ä¸ªreference-to-this">R10 ä»¤<code>operator=</code>è¿”å›ä¸€ä¸ªreference to *this</h3>
<ul>
<li>å…³äºèµ‹å€¼æ“ä½œç¬¦<code>operator=</code>ï¼Œä¸»æµåšæ³•æ˜¯:
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Widget</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Widget</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//... do some thing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div>ä¸Šè¿°åšæ³•ä¸å±€é™äºoperator=ï¼Œè¿˜æœ‰<code>operator += ,-=,*=,/=</code>ç­‰å…¶ä»–èµ‹å€¼è¿ç®—ç¬¦ã€‚</br>
è¯¥ä¸»æµåè®®/åšæ³•ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œåªæ˜¯ä¸ªå»ºè®®ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥å…è®¸<strong>è¿ç»­èµ‹å€¼</strong>($x=y=z$çš„å½¢å¼)ã€‚</br>
è¯¥åè®®è¢«å†…ç½®ç±»å‹ï¼Œä»¥åŠSTLçš„ç±»å‹(å¦‚string,vector,complex,shared_ptr)å…±åŒéµå®ˆã€‚</br></li>
</ul>
<h3 id="r11-åœ¨operatorä¸­å¤„ç†è‡ªæˆ‘èµ‹å€¼">R11 åœ¨<code>operator=</code>ä¸­å¤„ç†&quot;è‡ªæˆ‘èµ‹å€¼&quot;</h3>
<p>ä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™è‡ªå·±ï¼Œè¿™ç§çœ‹èµ·æ¥æœ‰ç‚¹å‚»çš„åšæ³•ï¼Œæœ‰æ—¶å€™ä¼šæ¯”è¾ƒéš¾ä»¥å‘è§‰ã€‚æ¯”å¦‚ï¼š<code>a[i] = a[j]</code>ï¼Œå¦‚æœ $i$ å’Œ $j$ ç›¸ç­‰ï¼Œå°±æ˜¯â€œè‡ªæˆ‘èµ‹å€¼â€çš„ç»å…¸åœºæ™¯äº†ã€‚
æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå°½é‡å®Œå¤‡çš„èµ‹å€¼æ“ä½œç¬¦å‡½æ•°ğŸ¤”ã€‚
è€ƒè™‘å¦‚ä¸‹ç±»<code>MapWidget</code>ï¼Œå†…æœ‰æ•°æ®è£¸æŒ‡é’ˆ<code>BitMap *pb_</code>ï¼Œåœ¨èµ‹å€¼æ—¶åŒæ—¶è€ƒè™‘<strong>å¼‚å¸¸å®‰å…¨</strong>å’Œ <strong>â€œè‡ªæˆ‘èµ‹å€¼â€</strong> å®‰å…¨(è®¤åŒæµ‹è¯•ä¿éšœè‡ªæˆ‘èµ‹å€¼å®‰å…¨)ï¼Œæ˜¯ä¸€ä¸ªç›¸å¯¹ä¸é”™çš„å®ç°ã€‚ä½†æ˜¯ï¼Œè®¤åŒæµ‹è¯•ä¼šé™ä½è¿è¡Œæ•ˆç‡ï¼Œæ ¹æ®å®é™…å·¥ç¨‹å®è·µæƒ…å†µ(è‡ªæˆ‘èµ‹å€¼æ¦‚ç‡æä½ )å¯ä»¥é…Œæƒ…å»æ‰ã€‚</p>
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BitMap</span> <span class="p">{</span><span class="cm">/*çœç•¥ç±»å£°æ˜&amp;å®ç°*/</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MapWidget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">BitMap</span> <span class="o">*</span> <span class="n">pb_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">MapWidget</span><span class="p">(</span><span class="n">BitMap</span> <span class="o">*</span><span class="n">pb</span><span class="p">)</span> <span class="o">:</span><span class="n">pb_</span><span class="p">(</span><span class="n">pb</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">MapWidget</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">MapWidget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="c1">//è¿™ä¸€å¥ä¸ºè®¤åŒæµ‹è¯•(identity test)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">BitMap</span> <span class="o">*</span><span class="n">pOrig</span> <span class="o">=</span> <span class="n">pb_</span><span class="p">;</span><span class="c1">//ä¸è¦ä¸€ä¸Šæ¥å°±deleteï¼Œè€Œæ˜¯ä¿å­˜this-&gt;pb_
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">pb_</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BitMap</span><span class="p">(</span><span class="o">*</span><span class="n">rhs</span><span class="p">.</span><span class="n">pb_</span><span class="p">);</span><span class="c1">//å› ä¸ºè¿™ä¸€å¥å¯èƒ½æŠ›å¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">delete</span> <span class="n">pOrig</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Copy and SwapæŠ€æœ¯ ä¸Šæ–‡ä¸­ä¿éšœ<strong>å¼‚å¸¸å®‰å…¨</strong>å’Œ **â€œè‡ªæˆ‘èµ‹å€¼â€**å®‰å…¨çš„æŠ€æœ¯æ‰‹æ®µï¼Œå¦å¤–ä¸€ä¸ªåŠæ³•ï¼Œå°±æ˜¯Copy and SwapæŠ€æœ¯ã€‚è¿™ä¸ªæŠ€æœ¯çš„å…³é”®åœ¨äºâ€œä¿®æ”¹å¯¹è±¡æ•°æ®çš„å‰¯æœ¬ï¼Œç„¶ååœ¨ä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„å‡½æ•°ä¸­å°†ä¿®æ”¹çš„æ•°æ®å’ŒåŸä»¶ç½®æ¢ â€ã€‚
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">MapWidget</span><span class="o">::</span><span class="n">Swap</span><span class="p">(</span><span class="n">MapWidget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">){</span><span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">pb_</span><span class="p">,</span><span class="n">pb_</span><span class="p">);}</span>
</span></span><span class="line"><span class="cl"><span class="n">MapWidget</span><span class="o">&amp;</span> <span class="n">MapWidget</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">MapWidget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">MapWidget</span> <span class="nf">temp</span><span class="p">(</span><span class="n">rhs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Swap</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="r12-å¤åˆ¶å¯¹è±¡æ—¶åˆ«å¿˜è®°å…¶æ¯ä¸€ä¸ªæˆåˆ†">R12 å¤åˆ¶å¯¹è±¡æ—¶åˆ«å¿˜è®°å…¶æ¯ä¸€ä¸ªæˆåˆ†</h3>
<ul>
<li>
<p>ç¼–å†™ç±»çš„Copyingå‡½æ•°æ—¶éœ€è¦åšåˆ°2ç‚¹
è¿™é‡Œçš„Copyingå‡½æ•°æ˜¯æŒ‡æœ‰copyå±æ€§çš„ç‰¹æ®Šå‡½æ•°==&gt; copyæ„é€ å‡½æ•°å’Œcopyèµ‹å€¼æ“ä½œç¬¦ã€‚</p>
<ol>
<li>å¤åˆ¶æ‰€æœ‰Localæˆå‘˜å˜é‡
å¦‚æœæˆå‘˜å¤åˆ¶çš„æ—¶å€™æœ‰é—æ¼ï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šæœ‰æ€¨è¨€ï¼Œè¿™å°±åŸ‹ä¸‹äº†éšæ‚£ã€‚å¦‚æœæ–°å¢äº†æˆå‘˜ï¼Œè¦å¯¹åº”ä¿®æ”¹Copyingå‡½æ•°ã€‚</li>
<li>è°ƒç”¨æ‰€æœ‰Base-Classå†…éƒ¨çš„é€‚å½“çš„Copyå‡½æ•°
å…·ä½“ä»£ç çš„æ¨èå®ç° å¦‚ä¸‹ğŸ‘‡ï¼š</li>
</ol>
<div class="highlight" id="id-16"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Customer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Customer</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">float</span> <span class="n">money</span><span class="p">)</span><span class="o">:</span><span class="n">name_</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="n">money_</span><span class="p">(</span><span class="n">money</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">money_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">VipCustomer</span> <span class="o">:</span><span class="k">public</span> <span class="n">Customer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>  <span class="c1">//æ³¨æ„ï¼šæ´¾ç”Ÿç±»è¦å¤åˆ¶åŸºç±»é‚£éƒ¨åˆ†çš„æˆå‘˜å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">using</span> <span class="n">Customer</span><span class="o">::</span><span class="n">Customer</span><span class="p">;</span> <span class="c1">//å‚è€ƒR09
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">VipCustomer</span><span class="p">(</span><span class="k">const</span> <span class="n">VipCustomer</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span><span class="n">priority_</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">priority_</span><span class="p">),</span><span class="n">Customer</span><span class="p">(</span><span class="n">rhs</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl">    <span class="n">VipCustomer</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">VipCustomer</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">Customer</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">rhs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">priority_</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">priority_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">setPriority</span><span class="p">(</span><span class="kt">int</span> <span class="n">priority</span><span class="p">)</span> <span class="p">{</span> <span class="n">priority_</span> <span class="o">=</span> <span class="n">priority</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">priority_</span><span class="p">;</span><span class="c1">//å­ç±»ç‹¬æœ‰æˆå‘˜å¯ä»¥å•ç‹¬setå‡½æ•°èµ‹å€¼ï¼Œæˆ–è€…æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨èµ‹å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä¸è¦ç”¨ä¸€ä¸ªCopyingå‡½æ•°å»å®ç°å¦ä¸€ä¸ª
ä»¤copy-assignmentæ“ä½œç¬¦è°ƒç”¨copyæ„é€ å‡½æ•°æ˜¯ä¸åˆç†çš„ï¼›åä¹‹ï¼Œåè€…è°ƒç”¨å‰è€…ä¹Ÿæ˜¯æ— æ„ä¹‰çš„ã€‚ å¦‚æœ2è€…æœ‰å¤§é‡çš„ä»£ç æ˜¯ç›¸åŒçš„ï¼Œå¯ä»¥å‰¥ç¦»ä¸€ä¸ªç±»å†…privateç±»å‹çš„<code>init</code>å‡½æ•°å‡ºæ¥ï¼Œæä¾›ç»™ä¸Šè¿°2è€…è°ƒç”¨ã€‚</p>
</li>
</ul>
<h2 id="refbr">ref:</br></h2>
<p>[1]. <a href="https://blog.csdn.net/cltcj/category_12098441.html"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/cltcj/category_12098441.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[2]. <a href="https://kissingfire123.github.io/2021/12/06_effective-c-%e4%b9%8b%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93%e4%b8%80/"target="_blank" rel="external nofollow noopener noreferrer">https://kissingfire123.github.io/2021/12/06_effective-c-%e4%b9%8b%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93%e4%b8%80/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></p>]]></description></item><item><title>Effective STL [15] | å°å¿ƒstringå®ç°çš„å¤šæ ·æ€§</title><link>https://jianye0428.github.io/posts/clause_15/</link><pubDate>Fri, 04 Aug 2023 08:25:48 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_15/</guid><description><![CDATA[<h2 id="sizeofstringçš„å€¼">sizeof(string)çš„å€¼</h2>
<p>å¦‚æœæƒ³çŸ¥é“<code>sizeof(string)</code>çš„å€¼æ˜¯å¤šå°‘ï¼Œç­”æ¡ˆä¸ä¸€å®šã€‚</p>
<p><code>string</code>å’Œ<code>char*</code>æŒ‡é’ˆä¸€æ ·å¤§çš„å®ç°å¾ˆå¸¸è§ï¼Œä¹Ÿå¾ˆå®¹æ˜“æ‰¾åˆ°<code>string</code>æ˜¯<code>char</code>*7 å€å¤§å°çš„<code>string</code>å®ç°ã€‚</p>
<p>æ‰€ä»¥å¾—äº†è§£ä¸€ä¸‹<code>string</code>çš„å®ç°</p>
<h2 id="stringçš„å®ç°">stringçš„å®ç°</h2>
<p><strong>åŸºæœ¬å®ç°</strong></p>
<ul>
<li>å­—ç¬¦ä¸²çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯åŒ…å«çš„å­—ç¬¦çš„æ•°ç›®ã€‚</li>
<li>å®¹çº³å­—ç¬¦ä¸²å­—ç¬¦çš„å†…å­˜å®¹é‡ã€‚</li>
<li>å­—ç¬¦ä¸²çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ï¼Œæ„æˆè¿™ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦ã€‚
<strong>å¯èƒ½å®ç°</strong></li>
<li>é…ç½®å™¨çš„æ‹·è´
<strong>ä¾èµ–å¼•ç”¨è®¡æ•°çš„stringå®ç°</strong>s</li>
<li>åŒ…å«è¿™ä¸ªå€¼çš„å¼•ç”¨è®¡æ•°</li>
</ul>
<h2 id="4ç§ä¸åŒçš„stringå®ç°æ•°æ®ç»“æ„">4ç§ä¸åŒçš„stringå®ç°æ•°æ®ç»“æ„</h2>
<p>ä»¥ä¸‹æ˜¯åŸä½œè€…çœ‹åˆ°çš„4ä¸ªæºç çš„stringçš„å®ç°</p>
<p><strong>A</strong>
æ¯ä¸ªstringå¯¹è±¡åŒ…å«ä¸€ä¸ª<strong>é…ç½®å™¨çš„æ‹·è´</strong>ï¼Œ<strong>å­—ç¬¦ä¸²çš„å¤§å°(size)</strong>ï¼Œ<strong>å®¹é‡(capacity)</strong>ï¼Œ<strong>ä¸€ä¸ªæŒ‡å‘åŒ…å«å¼•ç”¨è®¡æ•°ï¼ˆâ€œRefCntâ€ï¼‰<strong>å’Œ</strong>å­—ç¬¦ä¸²å€¼çš„åŠ¨æ€åˆ†é…çš„ç¼“å†²åŒºçš„æŒ‡é’ˆ</strong>ã€‚</p>
<p>åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œä¸€ä¸ªä½¿ç”¨é»˜è®¤é…ç½®å™¨çš„å­—ç¬¦ä¸²å¯¹è±¡æ˜¯æŒ‡é’ˆå¤§å°çš„4å€ã€‚å¯¹äºä¸€ä¸ªè‡ªå®šä¹‰çš„é…ç½®å™¨ï¼Œstringå¯¹è±¡ä¼šéšé…ç½®å™¨å¯¹è±¡çš„å¢å¤§è€Œå˜å¤§ï¼š</p>
<p></p>
<p><strong>B</strong>
Bçš„<strong>stringå¯¹è±¡å’ŒæŒ‡é’ˆä¸€æ ·å¤§</strong>ï¼Œå› ä¸ºåœ¨ç»“æ„ä½“ä¸­åªåŒ…å«ä¸€ä¸ªæŒ‡é’ˆã€‚å†æ¬¡ï¼Œè¿™é‡Œå‡è®¾ä½¿ç”¨é»˜è®¤é…ç½®å™¨ã€‚æ­£å¦‚å®ç°Aï¼Œå¦‚æœä½¿ç”¨è‡ªå®šä¹‰é…ç½®å™¨ï¼Œè¿™ä¸ªstringå¯¹è±¡çš„å¤§å°ä¼šå¢åŠ å¤§çº¦é…ç½®å™¨å¯¹è±¡çš„å¤§å°ã€‚</p>
<p>åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œ<strong>ä½¿ç”¨é»˜è®¤é…ç½®å™¨ä¸å ç”¨ç©ºé—´ï¼Œè¿™å½’åŠŸäºè¿™é‡Œç”¨äº†ä¸€ä¸ªåœ¨å®ç°Aä¸­æ²¡æœ‰çš„ä½¿ç”¨ä¼˜åŒ–</strong>ã€‚</p>
<p>Bçš„stringæŒ‡å‘çš„å¯¹è±¡åŒ…å«<strong>å­—ç¬¦ä¸²çš„å¤§å°</strong>ã€<strong>å®¹é‡</strong>å’Œ<strong>å¼•ç”¨è®¡æ•°</strong>ï¼Œä»¥åŠ<strong>å®¹çº³å­—ç¬¦ä¸²å€¼çš„åŠ¨æ€åˆ†é…ç¼“å†²åŒºçš„æŒ‡</strong>é’ˆåŠ&quot;<strong>å…¶ä»–</strong>&quot;ã€‚â€œå…¶ä»–â€æŒ‡å¯¹è±¡åŒ…å«åœ¨å¤šçº¿ç¨‹ç³»ç»Ÿä¸­ä¸å¹¶å‘æ§åˆ¶æœ‰å…³çš„ä¸€äº›é™„åŠ æ•°æ®ã€‚</p>
<p>
åœ¨å®ç°Bä¸­ï¼Œ<strong>ç”¨äºå¹¶å‘æ§åˆ¶çš„æ•°æ®æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¤§å°çš„6å€</strong>ã€‚</p>
<p><strong>C</strong>
<strong>Cçš„stringå¯¹è±¡æ€»æ˜¯ç­‰äºæŒ‡é’ˆçš„å¤§å°</strong>ï¼Œä½†æ˜¯<strong>è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¸stringç›¸å…³çš„ä¸œè¥¿çš„åŠ¨æ€åˆ†é…ç¼“å†²å™¨</strong>ï¼šå¤§å°ã€å®¹é‡ã€å¼•ç”¨è®¡æ•°å’Œå€¼ã€‚æ²¡æœ‰æ¯ç‰©ä½“é…ç½®å™¨ï¼ˆper-object allocatorï¼‰çš„æ”¯æŒã€‚ç¼“å†²åŒºä¹Ÿå®¹çº³ä¸€äº›å…³äºå€¼å¯å…±äº«æ€§çš„æ•°æ®ï¼Œæ ‡è®°ä¸ºâ€œ<strong>X</strong>â€ã€‚
</p>
<p><strong>D</strong>
Dçš„<strong>stringå¯¹è±¡æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¤§å°çš„7å€</strong>ï¼ˆä»ç„¶å‡è®¾ä½¿ç”¨äº†é»˜è®¤é…ç½®å™¨ï¼‰ã€‚è¿™ä¸ªå®ç°<strong>æ²¡æœ‰ä½¿ç”¨å¼•ç”¨è®¡æ•°</strong>ï¼Œä½†æ¯ä¸ªstringåŒ…å«äº†ä¸€ä¸ªè¶³ä»¥<strong>è¡¨ç°æœ€å¤š15ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²å€¼çš„å†…éƒ¨ç¼“å†²åŒº</strong>ã€‚</p>
<p>å› æ­¤å°çš„å­—ç¬¦ä¸²å¯ä»¥è¢«æ•´ä¸ªä¿å­˜åœ¨stringå¯¹è±¡ä¸­ï¼Œä¸€ä¸ªæœ‰æ—¶è¢«ç§°ä¸ºâ€œ<strong>å°å­—ç¬¦ä¸²ä¼˜åŒ–</strong>â€çš„ç‰¹æ€§ã€‚</p>
<p>å½“ä¸€ä¸ªstringçš„å®¹é‡è¶…è¿‡15æ—¶ï¼Œ<strong>ç¼“å†²å™¨çš„ç¬¬ä¸€éƒ¨åˆ†è¢«ç”¨ä½œæŒ‡å‘åŠ¨æ€åˆ†é…å†…å­˜çš„ä¸€ä¸ªæŒ‡é’ˆï¼Œè€Œå­—ç¬¦ä¸²çš„å€¼å­˜æ”¾åœ¨é‚£å—å†…å­˜</strong>ä¸­ï¼š</p>
<p></p>
<p><strong>g++ 9.4.0ä¸­çš„å®ç°</strong></p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">  <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">_CharT</span><span class="p">,</span> <span class="k">typename</span> <span class="n">_Traits</span><span class="p">,</span> <span class="k">typename</span> <span class="n">_Alloc</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">basic_string</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">__gnu_cxx</span><span class="o">::</span><span class="n">__alloc_traits</span><span class="o">&lt;</span><span class="n">_Alloc</span><span class="o">&gt;::</span><span class="k">template</span>
</span></span><span class="line"><span class="cl"> <span class="n">rebind</span><span class="o">&lt;</span><span class="n">_CharT</span><span class="o">&gt;::</span><span class="n">other</span> <span class="n">_Char_alloc_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">__gnu_cxx</span><span class="o">::</span><span class="n">__alloc_traits</span><span class="o">&lt;</span><span class="n">_Char_alloc_type</span><span class="o">&gt;</span> <span class="n">_Alloc_traits</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// Types:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">_Traits</span>     <span class="n">traits_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">_Traits</span><span class="o">::</span><span class="n">char_type</span>  <span class="n">value_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">_Char_alloc_type</span>    <span class="n">allocator_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">_Alloc_traits</span><span class="o">::</span><span class="n">size_type</span>  <span class="n">size_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">_Alloc_traits</span><span class="o">::</span><span class="n">difference_type</span> <span class="n">difference_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">_Alloc_traits</span><span class="o">::</span><span class="n">reference</span>  <span class="n">reference</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">_Alloc_traits</span><span class="o">::</span><span class="n">const_reference</span> <span class="n">const_reference</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">_Alloc_traits</span><span class="o">::</span><span class="n">pointer</span>  <span class="n">pointer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">_Alloc_traits</span><span class="o">::</span><span class="n">const_pointer</span> <span class="n">const_pointer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">__gnu_cxx</span><span class="o">::</span><span class="n">__normal_iterator</span><span class="o">&lt;</span><span class="n">pointer</span><span class="p">,</span> <span class="n">basic_string</span><span class="o">&gt;</span>  <span class="n">iterator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">__gnu_cxx</span><span class="o">::</span><span class="n">__normal_iterator</span><span class="o">&lt;</span><span class="n">const_pointer</span><span class="p">,</span> <span class="n">basic_string</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="n">const_iterator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">reverse_iterator</span><span class="o">&lt;</span><span class="n">const_iterator</span><span class="o">&gt;</span> <span class="n">const_reverse_iterator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">reverse_iterator</span><span class="o">&lt;</span><span class="n">iterator</span><span class="o">&gt;</span>  <span class="n">reverse_iterator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">///  Value returned by various member functions when they fail.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">static</span> <span class="k">const</span> <span class="n">size_type</span> <span class="n">npos</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">size_type</span><span class="o">&gt;</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>sizeof(string)</strong></p>
<p>ä¸¾ä¾‹ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">string</span> <span class="nf">s</span><span class="p">(</span><span class="s">&#34;Randy&#34;</span><span class="p">);</span> <span class="c1">// 5ä¸ªå­—ç¬¦
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p>å®ç°Aæœ‰32ä¸ªå­—ç¬¦çš„æœ€å°åˆ†é…å¤§å°ï¼Œæ‰€ä»¥è™½ç„¶sçš„å¤§å°æ˜¯5ï¼Œåœ¨å®ç°Aä¸‹å®¹é‡æ˜¯31ã€‚ï¼ˆç¬¬32ä¸ªå­—ç¬¦å¤§æ¦‚è¢«ä¿ç•™ä½œ<strong>å°¾éƒ¨çš„null</strong>ï¼Œå› æ­¤å¯ä»¥å®¹æ˜“åœ°å®ç°c_stræˆå‘˜å‡½æ•°ã€‚ï¼‰</p>
</li>
<li>
<p>å®ç°Cæœ€å°é‡16ï¼Œè€Œä¸”æ²¡æœ‰ä¸ºå°¾éƒ¨nullä¿ç•™ç©ºé—´ã€‚æ‰€ä»¥åœ¨å®ç°Cä¸‹ï¼Œsçš„å®¹é‡æ˜¯16ã€‚</p>
</li>
<li>
<p>å®ç°Dçš„æœ€å°ç¼“å†²åŒºå¤§å°ä¹Ÿæ˜¯16ï¼ŒåŒ…æ‹¬å°¾éƒ¨nullçš„ç©ºé—´ã€‚å½“ç„¶ï¼Œåœ¨è¿™é‡ŒåŒºåˆ«å‡ºå®ç°Dæ˜¯å› ä¸ºå®¹é‡å°äº16çš„å­—ç¬¦ä¸²ä½¿ç”¨çš„å†…å­˜åŒ…å«åœ¨æœ¬èº«å­—ç¬¦ä¸²å¯¹è±¡ä¸­ã€‚</p>
</li>
<li>
<p>å®ç°Bæ²¡æœ‰æœ€å°åˆ†é…ï¼Œåœ¨å®ç°Bä¸‹ï¼Œsçš„å®¹é‡æ˜¯7ã€‚</p>
</li>
</ol>
<p><strong>åŠ¨æ€åˆ†é…</strong></p>
<p>åœ¨å®ç°Dä¸‹<strong>å°†ä¼šæ²¡æœ‰åŠ¨æ€åˆ†é…</strong>ï¼Œåœ¨<strong>å®ç°Aå’ŒC 1æ¬¡</strong>ï¼Œè€Œåœ¨<strong>å®ç°B 2æ¬¡</strong>ï¼ˆä¸€æ¬¡æ˜¯stringå¯¹è±¡æŒ‡å‘çš„å¯¹è±¡ï¼Œä¸€æ¬¡æ˜¯é‚£ä¸ªå¯¹è±¡æŒ‡å‘çš„å­—ç¬¦ç¼“å†²åŒºï¼‰ã€‚</p>
<p>å¦‚æœå…³å¿ƒåŠ¨æ€åˆ†é…å’Œå›æ”¶å†…å­˜çš„æ¬¡æ•°ï¼Œæˆ–å¦‚æœå…³å¿ƒç»å¸¸ä¼´éšè¿™æ ·åˆ†é…çš„å†…å­˜å¼€é”€ï¼Œä½ å¯èƒ½æƒ³è¦é¿å¼€å®ç°Bã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œ å®<strong>ç°Bçš„æ•°æ®ç»“æ„åŒ…æ‹¬äº†å¯¹å¤šçº¿ç¨‹ç³»ç»Ÿå¹¶å‘æ§åˆ¶çš„ç‰¹æ®Šæ”¯æŒçš„äº‹å®æ„å‘³ç€å®ƒæ¯”å®ç°Aæˆ–Cæ›´èƒ½æ»¡è¶³ä½ çš„éœ€è¦ï¼Œå°½ç®¡åŠ¨æ€åˆ†é…æ¬¡æ•°è¾ƒå¤š</strong>ã€‚</p>
<p>å®ç°Dä¸éœ€è¦å¯¹å¤šçº¿ç¨‹çš„ç‰¹æ®Šæ”¯æŒï¼Œå› ä¸ºå®ƒä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°ã€‚</p>
<p>åœ¨åŸºäº<strong>å¼•ç”¨è®¡æ•°çš„è®¾è®¡</strong>ä¸­ï¼Œ<strong>å­—ç¬¦ä¸²å¯¹è±¡ä¹‹å¤–çš„æ¯ä¸ªä¸œè¥¿éƒ½å¯ä»¥è¢«å¤šä¸ªå­—ç¬¦ä¸²å…±äº«</strong>ï¼ˆå¦‚æœå®ƒä»¬æœ‰ç›¸åŒçš„å€¼ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»å›¾ä¸­è§‚å¯Ÿåˆ°çš„å…¶ä»–ä¸œè¥¿æ˜¯<strong>å®ç°Aæ¯”Bæˆ–Cæä¾›æ›´å°‘çš„å…±äº«æ€§</strong>ã€‚</p>
<p>ç‰¹åˆ«æ˜¯ï¼Œ<strong>å®ç°Bå’ŒCèƒ½å…±äº«ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¤§å°å’Œå®¹é‡ï¼Œå› æ­¤æ½œåœ¨åœ°å‡å°‘äº†æ¯ç‰©ä½“åˆ†æ‘Šçš„çš„å‚¨å­˜æ•°æ®çš„å¼€é”€</strong>ã€‚</p>
<p>æœ‰è¶£çš„æ˜¯ï¼Œ<strong>å®ç°Cä¸èƒ½æ”¯æŒæ¯å¯¹è±¡é…ç½®å™¨çš„äº‹å®æ„å‘³ç€å®ƒæ˜¯å”¯ä¸€å¯ä»¥å…±äº«é…ç½®å™¨çš„å®ç°ï¼šæ‰€æœ‰å­—ç¬¦ä¸²å¿…é¡»ä½¿ç”¨åŒä¸€ä¸ª</strong>ï¼</p>
<p><strong>å®ç°Dåœ¨å­—ç¬¦ä¸²å¯¹è±¡é—´æ²¡æœ‰å…±äº«æ•°æ®ã€‚</strong></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ä¸åŒçš„å®ç°ä»¥ä¸åŒçš„æ–¹å¼ä»å®ƒä»¬çš„è®¾è®¡çµæ´»æ€§ä¸­å¾—åˆ°å¥½å¤„ï¼š</p>
<ol>
<li>
<p><strong>å­—ç¬¦ä¸²å€¼å¯èƒ½æ˜¯æˆ–å¯èƒ½ä¸æ˜¯å¼•ç”¨è®¡æ•°çš„</strong>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¾ˆå¤šå®ç°çš„ç¡®æ˜¯ç”¨äº†å¼•ç”¨è®¡æ•°ï¼Œä½†å®ƒä»¬é€šå¸¸æä¾›äº†å…³é—­çš„æ–¹æ³•ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡é¢„å¤„ç†å™¨å®ã€‚æ¯”å¦‚ï¼Œ<strong>å¼•ç”¨è®¡æ•°åªå¯¹é¢‘ç¹æ‹·è´çš„å­—ç¬¦ä¸²æœ‰å¸®åŠ©ï¼Œè€Œæœ‰äº›ç¨‹åºä¸ç»å¸¸æ‹·è´å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æ²¡æœ‰é‚£ä¸ªå¼€é”€</strong></p>
</li>
<li>
<p>stringå¯¹è±¡çš„å¤§å°å¯èƒ½ä»1åˆ°è‡³å°‘7å€char*æŒ‡é’ˆçš„å¤§å°</p>
</li>
<li>
<p><strong>æ–°å­—ç¬¦ä¸²å€¼çš„å»ºç«‹å¯èƒ½éœ€è¦0ã€1æˆ–2æ¬¡åŠ¨æ€åˆ†é…</strong></p>
</li>
<li>
<p><strong>stringå¯¹è±¡å¯èƒ½æ˜¯æˆ–å¯èƒ½ä¸å…±äº«å­—ç¬¦ä¸²çš„å¤§å°å’Œå®¹é‡ä¿¡æ¯</strong></p>
</li>
<li>
<p><strong>stringå¯èƒ½æ˜¯æˆ–å¯èƒ½ä¸æ”¯æŒæ¯å¯¹è±¡é…ç½®å™¨</strong></p>
</li>
<li>
<p><strong>ä¸åŒå®ç°å¯¹äºæœ€å°åŒ–å­—ç¬¦ç¼“å†²åŒºçš„é…ç½®å™¨æœ‰ä¸åŒç­–ç•¥</strong></p>
</li>
</ol>
<p>stringæ˜¯æ ‡å‡†åº“ä¸­çš„æœ€é‡è¦çš„ç»„ä»¶ä¹‹ä¸€ï¼Œé¼“åŠ±åº”è¯¥è¦å¤šç”¨ã€‚</p>
<p>å¦‚æœè¦<strong>æœ‰æ•ˆä½¿ç”¨STL</strong>ï¼Œ<strong>éœ€è¦å°å¿ƒstringå®ç°çš„å¤šæ ·æ€§</strong>ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ æ­£åœ¨å†™å¿…é¡»åœ¨ä¸åŒSTLå¹³å°ä¸Šè¿è¡Œçš„ä»£ç å¹¶ä¸”ä½ é¢ä¸´ä¸¥æ ¼çš„æ€§èƒ½éœ€æ±‚ã€‚</p>
]]></description></item><item><title>Effective STL [14] | ä½¿ç”¨reserveæ¥é¿å…ä¸å¿…è¦çš„é‡æ–°åˆ†é…</title><link>https://jianye0428.github.io/posts/clause_14/</link><pubDate>Thu, 03 Aug 2023 13:06:29 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_14/</guid><description><![CDATA[<h2 id="è‡ªåŠ¨æ‰©å®¹">è‡ªåŠ¨æ‰©å®¹</h2>
<p>STL å®¹å™¨åªè¦å­˜å‚¨çš„å¯¹è±¡ä¸è¶…è¿‡ã€Œ<strong>æœ€å¤§å¤§å°</strong>ã€ï¼Œå°±å¯ä»¥è‡ªåŠ¨å¢é•¿åˆ°è¶³ä»¥å®¹çº³æ”¾è¿›å»çš„æ•°æ®ã€‚è¿™ä¸ªæœ€å¤§å€¼ï¼Œåªè¦è°ƒç”¨åå«max_sizeçš„æˆå‘˜å‡½æ•°å°±å¯ä»¥æŸ¥è¯¢åˆ°ã€‚</p>
<p>å¯¹äºvectorå’Œstringï¼Œåªè¦éœ€è¦æ›´å¤šç©ºé—´ï¼Œå°±ä»¥<code>realloc</code>ç­‰ä»·çš„æ€æƒ³æ¥å¢é•¿ã€‚</p>
<p>reallocçš„æ“ä½œæœ‰4ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>ã€Œ<strong>åˆ†é…æ–°çš„å†…å­˜å—</strong>ã€ã€‚åœ¨å¤§éƒ¨åˆ†å®ç°ä¸­ï¼Œvectorå’Œstringçš„å®¹é‡æ¯æ¬¡ä»¥ã€Œ<strong>2</strong>ã€ä¸ºå› æ•°å¢é•¿ï¼Œå³å®¹é‡æ¯æ¬¡ç¿»å€ã€‚</li>
<li>ã€Œ<strong>æŠŠæ‰€æœ‰å…ƒç´ ä»å®¹å™¨çš„æ—§å†…å­˜æ‹·è´åˆ°æ–°å†…å­˜</strong>ã€ã€‚</li>
<li>ã€Œ<strong>é”€æ¯æ—§å†…å­˜ä¸­çš„å¯¹è±¡</strong>ã€ã€‚</li>
<li>ã€Œ<strong>å›æ”¶æ—§å†…å­˜</strong>ã€ã€‚
è¿™å°±æ˜¯åˆ†é…ï¼Œå›æ”¶ï¼Œæ‹·è´å’Œææ„4ä¸ªæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤ä»£ä»·éƒ½å¾ˆæ˜‚è´µã€‚</li>
</ol>
<p>å³ä¾¿æ˜¯ç®€å•åœ°æŠŠä¸€ä¸ªå…ƒç´ æ’å…¥vectoræˆ–stringçš„åŠ¨ä½œä¹Ÿå¯èƒ½å› ä¸ºéœ€è¦æ›´æ–°å…¶ä»–ä½¿ç”¨äº†æŒ‡å‘vectoræˆ–stringä¸­çš„è¿­ä»£å™¨ã€æŒ‡é’ˆæˆ–å¼•ç”¨çš„æ•°æ®ç»“æ„è€Œè†¨èƒ€ã€‚</p>
<h2 id="4ä¸ªæˆå‘˜å‡½æ•°">4ä¸ªæˆå‘˜å‡½æ•°</h2>
<p>è¿™4ä¸ªSTLå®¹å™¨æˆå‘˜å‡½æ•°ï¼Œåªæœ‰vectorå’Œstringæä¾›äº†æ‰€æœ‰è¿™äº›å‡½æ•°ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">æˆå‘˜å‡½æ•°</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">size()</td>
<td style="text-align:left">ã€Œå®¹å™¨ä¸­æœ‰å¤šå°‘å…ƒç´ ã€ã€‚</br>æ²¡æœ‰è¯´æ˜å®¹å™¨ä¸ºå®¹çº³çš„å…ƒç´ åˆ†é…äº†å¤šå°‘å†…å­˜ã€‚</td>
</tr>
<tr>
<td style="text-align:left">capacity()</td>
<td style="text-align:left">ã€Œå®¹å™¨å·²ç»åˆ†é…çš„å†…å­˜ä¸­å¯ä»¥å®¹çº³å¤šå°‘å…ƒç´ ã€ã€‚</br>é‚£æ˜¯å®¹å™¨åœ¨é‚£å—å†…å­˜ä¸­æ€»å…±å¯ä»¥å®¹çº³å¤šå°‘å…ƒç´ ï¼Œè€Œä¸æ˜¯è¿˜å¯ä»¥å®¹çº³å¤šå°‘å…ƒç´ ã€‚å¦‚æœæƒ³çŸ¥é“ä¸€ä¸ªvectoræˆ–stringä¸­æœ‰å¤šå°‘æ²¡æœ‰è¢«å ç”¨çš„å†…å­˜ï¼Œå¿…é¡»ä»capacity()ä¸­å‡å»size()ã€‚å¦‚æœsizeå’Œcapacityè¿”å›åŒæ ·çš„å€¼ï¼Œå®¹å™¨ä¸­å°±æ²¡æœ‰å‰©ä½™ç©ºé—´äº†ï¼Œè€Œä¸‹ä¸€æ¬¡æ’å…¥ï¼ˆé€šè¿‡insertæˆ–push_backç­‰ï¼‰ä¼šå¼•å‘ä¸Šé¢çš„é‡æ–°åˆ†é…æ­¥éª¤ã€‚</td>
</tr>
<tr>
<td style="text-align:left">resize(Container::size_type n)</td>
<td style="text-align:left"></br>ã€Œå¼ºåˆ¶æŠŠå®¹å™¨æ”¹ä¸ºå®¹çº³nä¸ªå…ƒç´ ã€ã€‚è°ƒç”¨resizeä¹‹åï¼Œsizeå°†ä¼šè¿”å›nã€‚å¦‚æœnå°äºå½“å‰å¤§å°ï¼Œå®¹å™¨å°¾éƒ¨çš„å…ƒç´ ä¼šè¢«é”€æ¯ã€‚å¦‚æœnå¤§äºå½“å‰å¤§å°ï¼Œæ–°é»˜è®¤æ„é€ çš„å…ƒç´ ä¼šæ·»åŠ åˆ°å®¹å™¨å°¾éƒ¨ã€‚å¦‚æœnå¤§äºå½“å‰å®¹é‡ï¼Œåœ¨å…ƒç´ åŠ å…¥ä¹‹å‰ä¼šå‘ç”Ÿé‡æ–°åˆ†é…ã€‚</td>
</tr>
<tr>
<td style="text-align:left">reserve(Container::size_type n)</td>
<td style="text-align:left">ã€Œå¼ºåˆ¶å®¹å™¨æŠŠå®ƒçš„å®¹é‡æ”¹ä¸ºè‡³å°‘nï¼Œæä¾›çš„nä¸å°äºå½“å‰å¤§å°ã€ã€‚</br>è¿™ä¸€èˆ¬å¼ºè¿«è¿›è¡Œä¸€æ¬¡é‡æ–°åˆ†é…ï¼Œå› ä¸ºå®¹é‡éœ€è¦å¢åŠ ã€‚</td>
</tr>
</tbody>
</table>
<p><strong>reserve</strong>æˆå‘˜å‡½æ•°å…è®¸ä½ æœ€å°åŒ–å¿…é¡»è¿›è¡Œçš„é‡æ–°åˆ†é…çš„æ¬¡æ•°ï¼Œå› è€Œå¯ä»¥é¿å…çœŸåˆ†é…çš„å¼€é”€å’Œè¿­ä»£å™¨/æŒ‡é’ˆ/å¼•ç”¨å¤±æ•ˆã€‚</p>
<p>ã€Œ<strong>è°ƒç”¨reserveä¸æ”¹å˜å®¹å™¨ä¸­å¯¹è±¡çš„ä¸ªæ•°ã€‚</strong>ã€</p>
<h2 id="æå‰-reserve">æå‰ reserve</h2>
<p>ã€Œ<strong>åªè¦æœ‰å…ƒç´ éœ€è¦æ’å…¥è€Œä¸”å®¹å™¨çš„å®¹é‡ä¸è¶³æ—¶å°±ä¼šå‘ç”Ÿé‡æ–°åˆ†é…</strong>ã€ï¼ˆåŒ…æ‹¬å®ƒä»¬ç»´æŠ¤çš„ã€ŒåŸå§‹å†…å­˜åˆ†é…å’Œå›æ”¶ã€ï¼Œã€Œå¯¹è±¡çš„æ‹·è´å’Œææ„ã€å’Œã€Œè¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨çš„å¤±æ•ˆã€ï¼‰ã€‚</p>
<p>ã€Œé¿å…é‡æ–°åˆ†é…çš„å…³é”®ã€æ˜¯ä½¿ç”¨reserveå°½å¿«æŠŠå®¹å™¨çš„å®¹é‡è®¾ç½®ä¸ºè¶³å¤Ÿå¤§ï¼Œæœ€å¥½åœ¨å®¹å™¨è¢«æ„é€ ä¹‹åç«‹åˆ»è¿›è¡Œã€‚</p>
<p><strong>Example</strong></p>
<p>å‡å®šä½ æƒ³å»ºç«‹ä¸€ä¸ªå®¹çº³1-1000å€¼çš„<code>vector&lt;int&gt;</code>ã€‚æ²¡æœ‰ä½¿ç”¨<code>reserve</code>ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å¤§å¤šæ•°STLå®ç°ä¸­ï¼Œè¿™æ®µä»£ç åœ¨å¾ªç¯è¿‡ç¨‹ä¸­ã€Œ<strong>å°†ä¼šå¯¼è‡´2åˆ°10æ¬¡é‡æ–°åˆ†é…</strong>ã€ã€‚ï¼ˆã€Œvectoråœ¨é‡æ–°åˆ†é…æ—¶ä¸€èˆ¬æŠŠå®¹é‡ç¿»å€ã€ï¼Œ$1000 \approx 2^{10}$ã€‚ï¼‰ æŠŠä»£ç æ”¹ä¸ºä½¿ç”¨<code>reserve</code>ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ã€Œ<strong>è¿™åœ¨å¾ªç¯ä¸­ä¸ä¼šå‘ç”Ÿé‡æ–°åˆ†é…ã€‚</strong>ã€</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>é€šå¸¸æœ‰2ç§æƒ…å†µä½¿ç”¨<code>reserve</code>æ¥é¿å…ä¸å¿…è¦çš„é‡æ–°åˆ†é…:</p>
<ol>
<li>å¯ç”¨çš„æƒ…å†µæ˜¯ã€Œ<strong>å½“ä½ ç¡®åˆ‡æˆ–è€…å¤§çº¦çŸ¥é“æœ‰å¤šå°‘å…ƒç´ å°†æœ€åå‡ºç°åœ¨å®¹å™¨ä¸­</strong>ã€ã€‚å¯ä»¥æå‰reserveé€‚å½“æ•°é‡çš„ç©ºé—´ã€‚</li>
</ol>
<p>2.ã€Œ<strong>ä¿ç•™å¯èƒ½éœ€è¦çš„æœ€å¤§çš„ç©ºé—´</strong>ã€ï¼Œç„¶åï¼Œä¸€æ—¦æ·»åŠ å®Œå…¨éƒ¨æ•°æ®ã€Œ<strong>ä¿®æ•´æ‰ä»»ä½•å¤šä½™çš„å®¹é‡</strong>ã€ã€‚</p>
]]></description></item><item><title>Effective STL [13] | å°½é‡ä½¿ç”¨vectorå’Œstringæ¥ä»£æ›¿åŠ¨æ€åˆ†é…çš„æ•°ç»„</title><link>https://jianye0428.github.io/posts/clause_13/</link><pubDate>Thu, 03 Aug 2023 09:11:16 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_13/</guid><description><![CDATA[<h2 id="ä½¿ç”¨newåŠ¨æ€åˆ†é…å†…å­˜æ—¶çš„æ³¨æ„äº‹é¡¹">ä½¿ç”¨newåŠ¨æ€åˆ†é…å†…å­˜æ—¶çš„æ³¨æ„äº‹é¡¹</h2>
<ol>
<li>
<p>å¿…é¡»ç¡®ä¿ä»¥åä¼šdeleteè¿™ä¸ªåˆ†é…ã€‚å¦‚æœåé¢æ²¡æœ‰deleteï¼Œã€Œ<strong>newå°±ä¼šäº§ç”Ÿä¸€ä¸ªèµ„æºæ³„æ¼</strong>ã€ã€‚</p>
</li>
<li>
<p>ä½ é¡»ç¡®ä¿ä½¿ç”¨äº†<strong>delete</strong>çš„æ­£ç¡®å½¢å¼:
å¦‚æœä½¿ç”¨äº†deleteçš„é”™è¯¯å½¢å¼ï¼Œç»“æœä¼šæœªå®šä¹‰ã€‚åœ¨ä¸€äº›å¹³å°ä¸Šï¼Œç¨‹åºåœ¨è¿è¡ŒæœŸä¼šå½“æ‰ã€‚å¦ä¸€æ–¹é¢ï¼Œæœ‰æ—¶å€™ä¼šé€ æˆèµ„æºæ³„æ¼ï¼Œä¸€äº›å†…å­˜ä¹Ÿéšä¹‹è€Œå»ã€‚</p>
<ul>
<li>å¯¹äºåˆ†é…ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ï¼Œå¿…é¡»ä½¿ç”¨â€œdeleteâ€ã€‚</li>
<li>å¯¹äºåˆ†é…ä¸€ä¸ªæ•°ç»„ï¼Œå¿…é¡»ä½¿ç”¨â€œdelete []â€ã€‚</li>
</ul>
</li>
<li>
<p>å¿…é¡»ç¡®ä¿åª<strong>delete</strong>ä¸€æ¬¡ã€‚å¦‚æœä¸€ä¸ªåˆ†é…è¢«åˆ é™¤äº†ä¸æ­¢ä¸€æ¬¡ï¼Œç»“æœä¹Ÿä¼šæœªå®šä¹‰ã€‚</p>
</li>
</ol>
<h2 id="vectorå’Œstring">vectorå’Œstring</h2>
<ol>
<li>
<p>vectorå’Œstringæ¶ˆé™¤äº†ä¸Šé¢çš„è´Ÿæ‹…ï¼Œå› ä¸ºå®ƒä»¬ç®¡ç†è‡ªå·±çš„å†…å­˜ã€‚
å½“å…ƒç´ æ·»åŠ åˆ°é‚£äº›å®¹å™¨ä¸­æ—¶å®ƒä»¬çš„å†…å­˜ä¼šå¢é•¿ï¼Œè€Œä¸”å½“ä¸€ä¸ªvectoræˆ–stringé”€æ¯æ—¶ï¼Œå®ƒçš„ææ„å‡½æ•°ä¼šè‡ªåŠ¨é”€æ¯å®¹å™¨ä¸­çš„å…ƒç´ ï¼Œå›æ”¶å­˜æ”¾é‚£äº›å…ƒç´ çš„å†…å­˜ã€‚</p>
</li>
<li>
<p>vectorå’Œstringæ˜¯ç¾½ç¿¼ä¸°æ»¡çš„åºåˆ—å®¹å™¨ã€‚
è™½ç„¶æ•°ç»„ä¹Ÿå¯ä»¥ç”¨äºSTLç®—æ³•ï¼Œä½†æ²¡æœ‰æä¾›åƒ<code>begin</code>ã€<code>end</code>å’Œ<code>size</code>è¿™æ ·çš„æˆå‘˜å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰å†…åµŒåƒ<code>iterator</code>ã€<code>reverse_iterator</code>æˆ–<code>value_type</code>é‚£æ ·çš„<code>typedef</code>ã€‚è€Œä¸”<code>char*</code>æŒ‡é’ˆå½“ç„¶ä¸èƒ½å’Œæä¾›äº†ä¸“ç”¨æˆå‘˜å‡½æ•°çš„<code>string</code>ç«äº‰ã€‚STLç”¨çš„è¶Šå¤šï¼Œè¶Šä¼šæ­§è§†å†…å»ºçš„æ•°ç»„ã€‚</p>
</li>
</ol>
<h2 id="string-è®¡æ•°é—®é¢˜">string è®¡æ•°é—®é¢˜</h2>
<p>å¾ˆå¤š<code>string</code>å®ç°åœ¨åå°ä½¿ç”¨äº†å¼•ç”¨è®¡æ•°ï¼Œã€Œä¸€ä¸ªæ¶ˆé™¤äº†ä¸å¿…è¦çš„å†…å­˜åˆ†é…å’Œå­—ç¬¦æ‹·è´çš„ç­–ç•¥ï¼Œè€Œä¸”åœ¨å¾ˆå¤šåº”ç”¨ä¸­å¯ä»¥æé«˜æ€§èƒ½ã€ã€‚</p>
<p>äº‹å®ä¸Šï¼Œä¸€èˆ¬è®¤ä¸º<strong>é€šè¿‡å¼•ç”¨è®¡æ•°ä¼˜åŒ–å­—ç¬¦ä¸²å¾ˆé‡è¦</strong>ï¼Œæ‰€ä»¥C++æ ‡å‡†å§”å‘˜ä¼šç‰¹åˆ«è®¾æ³•ä¿è¯äº†é‚£æ˜¯ä¸€ä¸ªåˆæ³•çš„å®ç°ã€‚</p>
<p><strong>å¤šçº¿ç¨‹ä½¿ç”¨</strong></p>
<p>å¦‚æœä½ åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨äº†å¼•ç”¨è®¡æ•°çš„å­—ç¬¦ä¸²ï¼Œä½ å¯èƒ½å‘ç°<font color=red>ã€Œé¿å…åˆ†é…å’Œæ‹·è´æ‰€èŠ‚çœä¸‹çš„æ—¶é—´éƒ½èŠ±è´¹åœ¨åå°å¹¶å‘æ§åˆ¶ä¸Šã€</font>äº†ï¼Œä¼šå› ä¸ºçº¿ç¨‹å®‰å…¨æ€§å¯¼è‡´çš„æ€§èƒ½ä¸‹é™ã€‚</p>
<p>å¦‚æœç”¨åˆ°çš„stringå®ç°æ˜¯å¼•ç”¨è®¡æ•°çš„ï¼Œè€Œä¸”å·²ç»ç¡®å®šstringçš„å¼•ç”¨è®¡æ•°åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¿è¡Œï¼Œé‚£ä¹ˆè‡³å°‘æœ‰3ä¸ªåˆç†çš„é€‰æ‹©ï¼Œè€Œä¸”æ²¡æœ‰ä¸€ä¸ªæ”¾å¼ƒäº†STLï¼š</p>
<ol>
<li>ã€Œ<strong>çœ‹çœ‹åº“å®ç°æ˜¯å¦å¯ä»¥å…³é—­å¼•ç”¨è®¡æ•°ï¼Œé€šå¸¸æ˜¯é€šè¿‡æ”¹å˜é¢„å¤„ç†å˜é‡çš„å€¼</strong>ã€ï¼›</li>
<li>å¯»æ‰¾æˆ–å¼€å‘ä¸€ä¸ªä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°çš„stringå®ç°ï¼ˆæˆ–éƒ¨åˆ†å®ç°ï¼‰æ›¿ä»£å“ï¼›</li>
<li>ã€Œ<strong>è€ƒè™‘ä½¿ç”¨vector<char>æ¥ä»£æ›¿stringï¼Œvectorå®ç°ä¸å…è®¸ä½¿ç”¨å¼•ç”¨è®¡æ•°ï¼Œæ‰€ä»¥éšè—çš„å¤šçº¿ç¨‹æ€§èƒ½é—®é¢˜ä¸ä¼šå‡ºç°äº†</strong>ã€ã€‚</li>
</ol>
<p>å½“ç„¶ï¼Œä½¿ç”¨äº†vector<char>ï¼Œå°±ç›¸å½“äºæ”¾å¼ƒäº†stringçš„ä¸“ç”¨æˆå‘˜å‡½æ•°ï¼Œä½†å¤§éƒ¨åˆ†åŠŸèƒ½ä»ç„¶å¯ä»¥é€šè¿‡STLç®—æ³•å¾—åˆ°ï¼Œæ‰€ä»¥ä»ä¸€ç§è¯­æ³•åˆ‡æ¢åˆ°å¦ä¸€ç§ä¸ä¼šå¤±å»å¾ˆå¤šåŠŸèƒ½ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>å¦‚æœä½ åœ¨ä½¿ç”¨åŠ¨æ€åˆ†é…æ•°ç»„ï¼Œä½ å¯èƒ½æ¯”éœ€è¦çš„åšæ›´å¤šçš„å·¥ä½œã€‚
è¦å‡è½»ä½ çš„è´Ÿæ‹…ï¼Œå°±ä½¿ç”¨vectoræˆ–stringæ¥ä»£æ›¿ã€‚</p>
]]></description></item><item><title>å˜åˆ†è‡ªç¼–ç å™¨ VAE è¯¦è§£</title><link>https://jianye0428.github.io/posts/vae_1/</link><pubDate>Thu, 27 Jul 2023 10:53:41 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/vae_1/</guid><description><![CDATA[<!-- <div class="details admonition quote">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-quote-right fa-fw" aria-hidden="true"></i>quote<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">note abstract info tip success question warning failure danger bug example quote</div>
    </div>
  </div> -->
<h2 id="å¼•å…¥">å¼•å…¥</h2>
<p></p>
<div class="details admonition Notes open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Notes<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æœ¬æ–‡ä¹Ÿæ˜¯ä¸ºå†™ Stable Diffusion ç›¸å…³æ–‡ç« åšçš„é“ºå«ï¼Œä¸»è¦å‚è€ƒäº†æå®æ¯…è€å¸ˆçš„è§†é¢‘è¯¾ä»¥åŠBç«™çš„ç™½æ¿æ¨å¯¼ç³»åˆ—ã€‚æœ‰å…³GMMã€è’™ç‰¹å¡æ´›ã€ELBOã€å˜åˆ†æ¨æ–­ã€é‡å‚æ•°åŒ–çš„ç»†èŠ‚æœ¬æ–‡ä¸åšè¯¦ç»†ä»‹ç»ï¼Œä¸»è¦å›´ç»•VAEçš„ç»“æ„ä»¥åŠlossä¼˜åŒ–æ¨å¯¼åšè®²è§£ã€‚</div>
    </div>
  </div>
<p>æˆ‘ä»¬å…ˆæ¥ç®€å•çš„å¼•å…¥ä¸€ä¸‹ï¼š</p>
<ul>
<li>Vï¼šå˜åˆ†æ¨æ–­ï¼Œå®ƒçš„æ„æ€æ¥è‡ªäºæ¦‚ç‡å›¾æ¨¡å‹ï¼Œæœ¬æ–‡ä¼šç»™å‡ºå˜åˆ†ä¸‹ç•Œçš„è¯¦ç»†æ¨å¯¼ï¼›</li>
<li>AEï¼šAuto-Encoderï¼Œè‡ªç¼–ç å™¨ï¼›</li>
<li>VAEï¼šVariational Auto-Encoderï¼Œ<strong>å˜åˆ†è‡ªç¼–ç å™¨</strong>ï¼Œå°†æ¦‚ç‡å›¾æ¨¡å‹å’Œç¥ç»ç½‘ç»œç›¸ç»“åˆçš„æ¨¡å‹ï¼›</li>
</ul>
<h2 id="ä¸€ae">ä¸€ã€AE</h2>
<p></p>
<p>å…ˆæ¥ä»‹ç»ä¸€ä¸‹è‡ªç¼–ç å™¨ï¼ˆAuto-Encoderï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒåŸç†å¯æ¦‚è¿°ä¸ºï¼š</p>
<ul>
<li>å°†é«˜ç»´åŸå§‹æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ï¼‰é€å…¥ Encoderï¼Œåˆ©ç”¨ Encoder å°†é«˜ç»´æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªä½ç»´ç©ºé—´ï¼Œå°†nç»´å‹ç¼©åˆ°mç»´($m&laquo;n$)ï¼Œæˆ‘ä»¬ç”¨éšå˜é‡æ¥è¡¨ç¤ºï¼›</li>
<li>ç„¶åå°†ä½ç»´ç©ºé—´çš„ç‰¹å¾é€å…¥ Decoder è¿›è¡Œè§£ç ï¼Œä»¥æ­¤æ¥é‡å»ºåŸå§‹è¾“å…¥æ•°æ®ã€‚</li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">Encoderã€Decoderç½‘ç»œå¯ä»¥ä¸ºæ™®é€šçš„å…¨è¿æ¥ã€ä¹Ÿå¯ä»¥ä¸ºCNNã€æˆ–è€…ç±»ä¼¼äºUnetéƒ½å¯ä»¥ï¼Œæ²¡æœ‰å›ºå®šçš„è¦æ±‚ã€‚</div>
    </div>
  </div>
<p>è¿™é‡Œä¸ºå’Œåæ–‡çš„æ¨å¯¼è”ç³»èµ·æ¥ï¼Œæˆ‘ä»¬å°† Encoder ç½‘ç»œçš„æ˜ å°„å‡½æ•°å®šä¹‰ä¸º $q_{\phi}$ ã€Decoder ç½‘ç»œå®šä¹‰ä¸º $p_{\theta}$ï¼Œå…¶ä¸­ $\phi$ã€$\theta$ çš†ä¸ºç½‘ç»œå‚æ•°ã€‚</br>
é‚£ä¹ˆå¯¹äºè¾“å…¥ $x$ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Encoderå¾—åˆ° <code>Latent Variable</code>ï¼š$z = q_{\phi}(x)$ï¼Œç„¶åDecoderå¯ä»¥ä»éšå˜é‡zä¸­å¯¹åŸå§‹æ•°æ®è¿›è¡Œé‡å»ºï¼š$x&rsquo; = p_{\theta}(z) = p_{\theta}(q_{\phi}(x))$ã€‚</p>
<p>æˆ‘ä»¬å¸Œæœ›é‡å»ºçš„æ•°æ®å’ŒåŸæ¥çš„æ•°æ®è¿‘ä¼¼ä¸€è‡´ï¼Œå³æœ€å°åŒ–è¾“å…¥å’Œè¾“å‡ºä¹‹é—´çš„é‡æ„è¯¯å·®ï¼Œé‚£ä¹ˆAEçš„è®­ç»ƒæŸå¤±å¯ä»¥é‡‡ç”¨ç®€å•çš„MSEï¼š</p>
<p>$$L_{\text{AE}}(\theta, \phi) = \frac{1}{n}\sum_{i=1}^{n} (x^{(i)} - x&rsquo;^{(i)})^2 =\frac{1}{n}\sum_{i=1}^{n} (x^{(i)} - p_{\theta}(q_{\phi}(x^{(i)})))^2$$</p>
<div class="details admonition Note">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">å¯ä»¥ç†è§£ä¸ºæ¯”è¾ƒè¾“å…¥å’Œé‡æ„è¾“å…¥çš„åƒç´ ç‚¹çš„è¯¯å·®ã€‚</div>
    </div>
  </div>
<h2 id="äºŒae-å­˜åœ¨çš„é—®é¢˜">äºŒã€AE å­˜åœ¨çš„é—®é¢˜</h2>
<p>ä¸Šé¢æˆ‘ä»¬é€šè¿‡AEå¯ä»¥<font color=lightseablue><strong>æ„å»ºä¸€ä¸ªé‡æ„å›¾åƒçš„æ¨¡å‹</strong></font>ï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡å‹å¹¶ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œæˆ–è€…è¯´å®ƒå¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ç”Ÿæˆæ¨¡å‹ã€‚å¯¹äºä¸€ä¸ªç”Ÿæˆæ¨¡å‹è€Œè¨€ï¼Œå®ƒæ»¡è¶³ï¼š</p>
<ul>
<li><strong>Encoder å’Œ Decoder å¯ä»¥ç‹¬ç«‹æ‹†åˆ†ï¼ˆç±»æ¯” GAN çš„ Generator å’Œ Discriminatorï¼‰ï¼›</strong></li>
<li><strong>å›ºå®šç»´åº¦ä¸‹<font color=red>ä»»æ„é‡‡æ ·</font>å‡ºæ¥çš„ç¼–ç ï¼Œéƒ½åº”è¯¥èƒ½é€šè¿‡ Decoder äº§ç”Ÿä¸€å¼ æ¸…æ™°ä¸”é€¼çœŸçš„å›¾ç‰‡ã€‚</strong></li>
</ul>
<p>å½“ç„¶å¯¹äºç¬¬ä¸€ç‚¹å®ƒæ˜¯æ»¡è¶³çš„ï¼Œæˆ‘ä»¬ä¸»è¦åˆ†æç¬¬äºŒç‚¹ï¼Œä¹Ÿå°±æ˜¯AEå­˜åœ¨çš„é—®é¢˜ï¼Œä»è€Œå¼•å‡ºVAEã€‚</p>
<p></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç”¨ä¸€å¼ å…¨æœˆå›¾å’Œä¸€å¼ åŠæœˆå›¾å»è®­ç»ƒä¸€ä¸ªAEï¼Œç»è¿‡è®­ç»ƒæ¨¡å‹æ˜¯èƒ½å¤Ÿå¾ˆå¥½çš„è¿˜åŸå‡ºè¿™ä¸¤å¼ å›¾ç‰‡ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ latent code ä¸­ä»»å–ä¸€ç‚¹ï¼Œå°†å…¶äº¤ç»™ Decoder è¿›è¡Œè§£ç ï¼Œç›´è§‰ä¸Šæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€å¼ ä»‹äºå…¨æœˆå’ŒåŠæœˆä¹‹å‰çš„å›¾ç‰‡ï¼ˆæ¯”å¦‚é˜´å½±é¢ç§¯è¦†ç›–çš„æ ·å­ï¼‰ã€‚ç„¶è€Œ<font color=red>å®é™…ä¸Šçš„è¾“å‡ºå›¾ç‰‡ä¸ä»…æ¨¡ç³Šè€Œä¸”è¿˜æ˜¯ä¹±ç çš„</font>ã€‚</p>
<p>å¯¹äºè¿™ä¸ªç°è±¡ï¼Œä¸€ä¸ªç›´è§‚çš„è§£é‡Šå°±æ˜¯AEçš„ Encoder å’Œ Decoder éƒ½ç”¨äº†DNNï¼Œé‚£ä¹ˆNNåªä¼šå¹²ä¸€ä»¶äº‹æƒ…ï¼šå­¦ä¹ ã€è®°ä½ã€ç”¨è®°ä½çš„ä¸œè¥¿é¢„æµ‹ï¼Œæˆ‘ä»¬<u>ä» latent space ä¸­é‡‡æ ·çš„ç‚¹ï¼Œç¼–ç å™¨éƒ½æ²¡æœ‰å­¦ä¹ è¿‡</u>ï¼Œæ€ä¹ˆèƒ½å¤ŸæŒ‡æœ›å®ƒç”Ÿæˆå¸Œæœ›çš„å€¼å‘¢?</p>
<p>æ¢å¥è¯è¯´ï¼Œ<font color=red><strong>NNåªè®°ä½äº†å·¦è¾¹å…¨æœˆå›¾ç‰‡çš„éšå‘é‡å’Œå³è¾¹åŠæœˆå›¾ç‰‡çš„éšå‘é‡ï¼Œå¹¶ä¸èƒ½æ³›åŒ–åˆ°ä¸­é—´å°±æ˜¯$\frac{3}{4}$æœˆäº®çš„å›¾ç‰‡</strong></font>ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæœ€ç›´æ¥çš„æ€æƒ³å°±æ˜¯<strong>å¼•å…¥å™ªå£°</strong>ï¼Œæ‰©å¤§å›¾ç‰‡çš„ç¼–ç åŒºåŸŸï¼Œä»è€Œèƒ½å¤Ÿè¦†ç›–åˆ°å¤±çœŸçš„ç©ºç™½ç¼–ç åŒºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p></p>
<p>å…¶å®è¯´ç™½äº†å°±æ˜¯<strong>é€šè¿‡å¢åŠ è¾“å…¥çš„å¤šæ ·æ€§ä»è€Œå¢å¼ºè¾“å‡ºçš„é²æ£’æ€§</strong>ã€‚</p>
<p>å½“æˆ‘ä»¬ç»™è¾“å…¥å›¾ç‰‡è¿›è¡Œç¼–ç ä¹‹å‰å¼•å…¥ä¸€ç‚¹å™ªå£°ï¼Œä½¿å¾—æ¯å¼ å›¾ç‰‡çš„ç¼–ç ç‚¹å‡ºç°åœ¨ç»¿è‰²ç®­å¤´èŒƒå›´å†…ï¼Œè¿™æ ·ä¸€æ¥æ‰€å¾—åˆ°çš„ latent space å°±èƒ½è¦†ç›–åˆ°æ›´å¤šçš„ç¼–ç ç‚¹ã€‚æ­¤æ—¶æˆ‘ä»¬å†ä»ä¸­é—´ç‚¹æŠ½å–è¿˜åŸä¾¿å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ¯”è¾ƒå¸Œæœ›çš„è¾“å‡ºã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬ç»™è¾“å…¥çš„å›¾ç‰‡å¢åŠ äº†ä¸€äº›å™ªå£°ï¼Œä½¿å¾— latent space èƒ½å¤Ÿè¦†ç›–åˆ°æ¯”è¾ƒå¤šçš„åŒºåŸŸï¼Œä½†æ˜¯è¿˜æœ‰ä¸å°‘åœ°æ–¹æ²¡æœ‰è¦†ç›–åˆ°ï¼Œæ¯”å¦‚ä¸Šå›¾çš„é»„è‰²ç‚¹ä½ç½®ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å°è¯•åˆ©ç”¨æ›´å¤šçš„å™ªå£°ï¼Œä½¿å¾—å¯¹äºæ¯ä¸€ä¸ªè¾“å…¥æ ·æœ¬ï¼Œå®ƒçš„ç¼–ç éƒ½èƒ½å¤Ÿè¦†ç›–åˆ°æ•´ä¸ªç¼–ç ç©ºé—´ï¼Ÿåªä¸è¿‡æˆ‘ä»¬è¿™é‡Œéœ€è¦ä¿è¯çš„æ˜¯ï¼š<font color=red>å¯¹äºç¼–ç é™„è¿‘çš„æˆ‘ä»¬åº”è¯¥ç»™å®šä¸€ä¸ªé«˜çš„æ¦‚ç‡å€¼ï¼Œå¯¹äºè·ç¦»åŸç¼–ç ç‚¹è¿œçš„åº”è¯¥ç»™å®šä¸€ä¸ªä½çš„æ¦‚ç‡å€¼</font>ã€‚</p>
<p>è¿™æ ·æ€»ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°±æ˜¯è¦å°†åŸå…ˆçš„ä¸€ä¸ªå•ç‚¹æ‹‰ä¼¸åˆ°æ•´ä¸ªç¼–ç ç©ºé—´ï¼Œå³å°†ç¦»æ•£çš„ç¼–ç ç‚¹æ‹‰ä¼¸ä¸ºä¸€æ¡è¿ç»­çš„æ¥è¿‘æ­£å¤ªåˆ†å¸ƒçš„ç¼–ç æ›²çº¿ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p></p>
<p>è¿™ä¸ªå…¶å®å°±æ˜¯VAEçš„æ€æƒ³ï¼Œç†Ÿæ‚‰GMMçš„åŒå­¦åº”è¯¥çŸ¥é“ï¼Œå®ƒæ˜¯Kä¸ªé«˜æ–¯åˆ†å¸ƒï¼ˆGaussian Distributionï¼‰çš„æ··åˆï¼Œå…¶å®**<font color=green>VAEå¯ä»¥è¯´æ˜¯æ— é™ä¸ªé«˜æ–¯åˆ†å¸ƒçš„æ··åˆ</font>**ã€‚</p>
<h2 id="ä¸‰vae-ç»“æ„é¢„è§ˆ">ä¸‰ã€VAE ç»“æ„é¢„è§ˆ</h2>
<p></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºVAEçš„ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°VAEé‡Œçš„ç¼–ç å™¨ä¸æ˜¯è¾“å‡ºéšå‘é‡$z$ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œåˆ†å¸ƒçš„å‡å€¼ä¸º$m$ã€æ–¹å·®ä¸º$\sigma$ï¼Œ$e$ å³ä¸ºç»™ç¼–ç æ·»åŠ çš„å™ªå£°ï¼Œæ¥è‡ªäºæ­£æ€åˆ†å¸ƒã€‚</p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>tips<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">VAEçš„Encoderçš„è¾“å‡ºä¸æ˜¯éšå‘é‡ï¼Œè€Œæ˜¯å‡å€¼ä¸º$m$, æ–¹å·®ä¸º$\sigma$çš„æ­£æ€åˆ†å¸ƒã€‚</div>
    </div>
  </div>
<p>å…¬å¼æ€ä¹ˆå¾—åˆ°çš„åé¢ä¼šç»™å‡ºæ¨å¯¼ï¼Œæˆ‘ä»¬å…ˆæ¥æè¿°ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<p>$$z_{i} = c_{i} = \exp(\sigma_i) * e_i + m_i$$</p>
<ul>
<li>Encoderä¼šè®¡ç®—å‡ºä¸¤ç»„ç¼–ç ï¼Œä¸€ç»„ä¸ºå‡å€¼mã€ä¸€ç»„ä¸ºæ§åˆ¶å™ªå£°å¹²æ‰°ç¨‹åº¦çš„æ–¹å·®$\sigma$ï¼›</li>
<li>æ–¹å·®$\sigma$ä¸»è¦ç”¨æ¥ä¸ºå™ªå£°ç¼–ç  $e$ åˆ†é…æƒé‡ï¼›</li>
<li>å–æŒ‡æ•°ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯åˆ†é…åˆ°çš„æƒé‡æ˜¯æ­£å€¼ï¼›</li>
<li>ä¹Ÿå°±æ˜¯è¯´æ•°æ®åˆ†å¸ƒä¼šåœ¨ $\exp(\sigma_i) * e$ æ–¹å·®èŒƒå›´å†…é‡‡æ ·ä¸€ä¸ªå€¼ï¼Œå¾—åˆ°ä¸€ä¸ªåç§»é‡ï¼Œå°±æ˜¯ç›¸å½“äºæŠŠåŸå§‹çš„æ ·æœ¬åŠ ä¸Šäº†ä¸€ä¸ªå™ªå£°ã€‚ä»ç»“æ„å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒæŸå¤±é™¤äº†AEçš„ é‡æ„æŸå¤±ï¼ˆreconstruction errorï¼‰å¤–ï¼Œè¿˜å¤šå‡ºäº†ä¸‹é¢è¿™ä¸€é¡¹ï¼š
$$c = (c_1, c_2, c_3) = \sum_{i=1}^{3} (e^{\sigma_i} - (1 + \sigma_i) + (m_i)^2)$$</li>
</ul>
<p>è¿™ä¸ªè¾…åŠ©losså¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªçº¦æŸï¼Œä¹Ÿå°±æ˜¯è¯´ç”Ÿæˆçš„ $\sigma$ è¦æ»¡è¶³è¿™ä¸ªçº¦æŸã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆè¦åŠ è¿™ä¸ªè¾…åŠ©lossï¼Ÿ</strong></p>
<ul>
<li>æˆ‘ä»¬æœ€å°åŒ–äº† reconstruction errorï¼Œå¦‚æœä¸åŠ è¿™ä¸ªè¾…åŠ©lossçš„è¯ï¼ŒEncoderè‚¯å®šå¸Œæœ›å™ªå£°å¯¹è‡ªèº«ç”Ÿæˆçš„å›¾ç‰‡å¹²æ‰°è¶Šå°è¶Šå¥½ï¼Œä¸ºäº†ä¿è¯ç”Ÿæˆå›¾ç‰‡çš„è´¨é‡ï¼Œäºæ˜¯åˆ†é…ç»™å™ªå£°çš„æƒé‡ä¹Ÿå°±æ˜¯è¶Šä½ã€‚å¦‚æœä¸åŠ è¿™ä¸ªçº¦æŸçš„è¯ï¼Œç½‘ç»œåªéœ€è¦å°†æ–¹å·®è®¾ç½®ä¸ºæ¥è¿‘è´Ÿæ— ç©·å¤§çš„å€¼ $\exp ^ {-\infty} = 0$ï¼Œå³å¯æ¶ˆé™¤å™ªå£°å¸¦æ¥çš„å½±å“ï¼Œè¿™æ ·å¿…ç„¶ä¼šè¿‡æ‹Ÿåˆå¯¼è‡´é²æ£’æ€§ä¸ä½³ã€‚</li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>tips<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æ·»åŠ è¾…åŠ©lossæ˜¯ä¸ºäº†é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œæé«˜æ¨¡å‹çš„é²æ£’æ€§ã€‚</div>
    </div>
  </div>
<p><strong>ä¸ºä»€ä¹ˆåŠ è¿™ä¸ªè¾…åŠ©lossæœ‰ç”¨ï¼Ÿ</strong></p>
<ul>
<li>æˆ‘ä»¬å¯¹ $\sigma$ æ±‚å¯¼å¯å¾— $c = e^{\sigma} - 1$ï¼Œä»¤å…¶ç­‰äº0å¯æ±‚å‡º $\sigma = 0$ æ—¶å–å¾—æå°å€¼ï¼Œè¿™æ ·ä¸€æ¥ä¾¿å¯ä»¥çº¦æŸæ–¹å·®ä¸ä¼šä¸€è·¯èµ°å‘è´Ÿæ— ç©·ï¼Œä»è€Œèµ·åˆ°æ­£åˆ™åŒ–çº¦æŸçš„ä½œç”¨ï¼›</li>
<li>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ$e^{\sigma}$ æ˜¯è“è‰²æ›²çº¿ï¼Œ$1 + \sigma$ æ˜¯çº¢è‰²çº¿æ¡ï¼Œé‚£ä¹ˆ $e^{\sigma} - (1 + \sigma)$å°±æ˜¯è“è‰²æ›²çº¿å‡å»çº¢è‰²ç›´çº¿ï¼Œå¾—åˆ°ç»¿è‰²æ›²çº¿ï¼Œæ˜¾è€Œæ˜“è§çš„å¯ä»¥å‘ç°å®ƒçš„æœ€å°å€¼ä¸º0ã€‚</li>
</ul>
<p></p>
<h2 id="å››æ•°å­¦æè¿°">å››ã€æ•°å­¦æè¿°</h2>
<h3 id="41ä½œè€…çš„-intuition">4.1ã€ä½œè€…çš„ Intuition</h3>
<p>
</p>
<p>å€Ÿç”¨ä½œè€…åŸæ–‡çš„è¡¨è¿°ï¼Œæˆ‘ä»¬æ¥å¼•å…¥å®šä¹‰ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé¦–å…ˆæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªé«˜ç»´çš„éšæœºå˜é‡ï¼Œä¸ä¹‹ç›¸å…³è”çš„æˆ‘ä»¬å«å®ƒéšå˜é‡ $z$ï¼Œ$z$ çš„ç»´åº¦ä¸€èˆ¬è¦æ¯” $x$ ä½å¾ˆå¤šï¼Œç”¨æ¥æè¿° $x$ ä¸­æ‰€åŒ…å«çš„ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬å‡è®¾ $z$ æ»¡è¶³åˆ†å¸ƒ $p_{\theta}(z)$ï¼Œ$x$ ä¹Ÿæ˜¯ä¸€ä¸ªæ¡ä»¶æ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ul>
<li>åœ¨å·²çŸ¥ $z$ çš„æƒ…å†µä¸‹ï¼Œ$p_{\theta}(z)$èƒ½ç”Ÿæˆä¸€ä¸ªsample $x$ ï¼›</li>
<li>ç»™å®šä¸€ä¸ªsample $x$ï¼Œ$q_{\phi}(x)$ å°±å¯ä»¥å°è¯•æ¨æµ‹å‡ºè¿™ä¸ªæ¥ã€‚</li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>å› ä¸ºå‡è®¾$z$æ»¡è¶³ä¸€å®šåˆ†å¸ƒï¼Œæ‰€ä»¥ä¹Ÿæœ‰ä»$\theta$åˆ°$z$çš„ç®­å¤´ï¼›</p>
<p>ä¹‹åæåˆ°çš„$z$éƒ½æ˜¯Decoderé‡Œçš„å‚æ•°ã€‚</p>
</div>
    </div>
  </div>
<p>è¿™ä¹ˆè¯´å¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾æœ‰ä¸€ä¸ªå›¾åƒï¼Œé‡Œé¢æœ‰3ä¸ªé¢œè‰²ä¸ä¸€è‡´çš„å½¢çŠ¶ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„è¾“å…¥$x$ã€‚é€šè¿‡å³å›¾çš„å‚æ•°ï¼Œå¯ä»¥æ§åˆ¶$x$ï¼Œè¿™å°±æ˜¯éšå˜é‡$z$ã€‚</p>
<p>é‚£ä¹ˆå›åˆ°å®é™…çš„åº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬æƒ³è¦é€šè¿‡$x$è·å¾—$z$ï¼Œåˆæƒ³é€šè¿‡$z$å¾—åˆ°ç›¸åº”çš„$x$ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„åŒç®­å¤´å°±æ˜¯æˆ‘ä»¬æƒ³è¦åšçš„äº‹æƒ…ã€‚</p>
<p>é‚£ä¹ˆå¯¹äºç”Ÿæˆæ¨¡å‹è€Œè¨€ï¼ŒVAEçš„æ•°æ®äº§ç”ŸåŒ…æ‹¬ä¸¤ä¸ªè¿‡ç¨‹ï¼š</p>
<ul>
<li>ä»ä¸€ä¸ªå…ˆéªŒåˆ†å¸ƒ $p_{\theta}(z)$ ä¸­é‡‡æ ·ä¸€ä¸ª $z^{(i)}$ï¼›</li>
<li>æ ¹æ®æ¡ä»¶åˆ†å¸ƒ $p_{\theta}(x|z)$ï¼Œç”¨ $z^{(i)}$ ç”Ÿæˆ $x^{(i)}$ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ä¸€ä¸ªå‚æ•° $\theta^*$ æ¥<strong>æœ€å¤§åŒ–ç”ŸæˆçœŸå®æ•°æ®çš„æ¦‚ç‡</strong>ï¼š</p>
<p>$$\theta^*=\argmax_{\theta} \prod_{i=1}^{n}p_{\theta}(x^{(i)})$$</p>
<p>è¿™é‡Œ $p_{\theta}(x^{(i)})$ å¯ä»¥é€šè¿‡å¯¹ $z$ ç§¯åˆ†å¾—åˆ°ï¼š</p>
<p>$$p_{\theta}(x^{(i)}) = \int_{z} p_{\theta}(x, z) \mathrm{d}{z} = \int_{z} p_{\theta}(z) p_{\theta}(x^{(i)}|z)\mathrm{d}{z}$$</p>
<p>å®é™…ä¸Šæˆ‘ä»¬è¦æ ¹æ®ä¸Šè¿°ç§¯åˆ†æ˜¯ä¸å¯èƒ½å®ç°çš„ï¼Œå…ˆéªŒåˆ†å¸ƒ $p_{\theta}(z)$ æ˜¯æœªçŸ¥çš„ï¼Œè€Œä¸”å¦‚æœåˆ†å¸ƒæ¯”è¾ƒå¤æ‚ä¸”é«˜ç»´ï¼Œå¯¹å…¶ç©·ä¸¾è®¡ç®—ä¹Ÿæ˜¯ä¸ç°å®çš„ã€‚</p>
<p><strong>å˜åˆ†æ¨æ–­å¼•å…¥åéªŒæ¦‚ç‡æ¥è”åˆå»ºæ¨¡</strong>ï¼Œå³given $x$ æƒ³è¦å¾—åˆ°å®ƒçš„ $z$ï¼Œæ ¹æ®è´å¶æ–¯å…¬å¼è¡¨ç¤ºä¸ºï¼š</p>
<p>$$p_{\theta}(z | x) = \frac{p_{\theta}(x|z) p_{\theta}(z)}{p_{\theta}(x)}$$</p>
<p>æˆ‘ä»¬åˆå›åˆ°æœ€ä¸Šé¢çš„å›¾ï¼š</p>
<p></p>
<ul>
<li>å®çº¿ç®­å¤´å°±æ˜¯æˆ‘ä»¬è¦å¾—åˆ°çš„ç”Ÿæˆæ¨¡å‹ $p_{\theta}(z) p_{\theta}(x|z)$ï¼Œè¿™é‡Œ $p_{\theta} (z)$ å¾€å¾€æ˜¯äº‹å…ˆå®šä¹‰å¥½çš„ï¼Œæ¯”å¦‚æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œè€Œ $p_{\theta}(x|z)$ å¯ä»¥ç”¨ä¸€ä¸ªç½‘ç»œæ¥å­¦ä¹ ï¼Œå®ƒå°±å¯ä»¥çœ‹æˆæ˜¯ <strong>Probabilistic Decoder</strong>ã€‚</li>
<li>è™šçº¿ç®­å¤´ä»£è¡¨å¯¹åéªŒåˆ†å¸ƒ $p_{\theta}(z|x)$ çš„å˜åˆ†ä¼°è®¡ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªç½‘ç»œå»è¿‘ä¼¼ï¼Œæˆ‘ä»¬è®°ä¸º $q_{\phi}(z|x)$ï¼Œåˆ™è¿™ä¸ªç½‘ç»œç§°ä¸º <strong>Probabilistic Encoder</strong>ã€‚</li>
</ul>
<p>æ‰€ä»¥VAEçš„ä¼˜åŒ–ç›®æ ‡å°±æœ‰äº†ï¼Œä¸ºäº†<strong>è¾¾åˆ°ä»xä¼°è®¡zçš„è¿‡ç¨‹</strong>ï¼Œå¯¹äºä¼°è®¡çš„åéªŒ $q_{\phi}(z|x)$ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒ<strong>æ¥è¿‘</strong>çœŸå®çš„åéªŒåˆ†å¸ƒ $p_{\theta}(z|x)$ ï¼Œå³ï¼š</p>
<p>$$p_{\theta}(z|x) \cong q_{\phi}(z|x)$$</p>
<p>è¯´ç™½äº†å°±æ˜¯ä½¿ç”¨å¦ä¸€ä¸ªæ¨¡å‹ï¼Œå‚æ•°ç”± $\phi$ è¡¨ç¤ºï¼Œåœ¨å‚æ•° $\phi$ çš„å¸®åŠ©ä¸‹ï¼Œæœ‰äº†ä¸€ä¸ªåˆ†å¸ƒ $q$ ï¼Œç°åœ¨å¸Œæœ›åˆ†å¸ƒ $q$ èƒ½å¤Ÿå°½é‡æ¥è¿‘ $p$ï¼Œä»è€Œè¾¾åˆ°ä» $x$ ä¼°è®¡ $z$ çš„è¿‡ç¨‹ã€‚</p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>å¯ä»¥çœ‹åˆ°VAEå’ŒAEæ¶æ„ä¸Šè¿˜æ˜¯ç›¸ä¼¼çš„ï¼ŒVAEçš„æœ€ç»ˆç›®æ ‡æ˜¯å¾—åˆ°ç”Ÿæˆæ¨¡å‹å³Decoderï¼ŒEncoderåªæ˜¯è¾…åŠ©å»ºæ¨¡ã€‚</p>
<p>è€ŒAEå¸¸å¸¸æ˜¯ä¸ºäº†å¾—åˆ°Encoderæ¥è¿›è¡Œç‰¹å¾æå–æˆ–å‹ç¼©ã€‚</p>
</div>
    </div>
  </div>
<h3 id="42å˜åˆ†ä¸‹ç•Œ">4.2ã€å˜åˆ†ä¸‹ç•Œ</h3>
<p>ä¸ºäº†è¡¡é‡ä¸¤ä¸ª distribution çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œæˆ‘ä»¬åº”è¯¥å¾ˆè‡ªç„¶çš„æƒ³åˆ°äº†KL divergenceï¼Œå› ä¸ºæˆ‘ä»¬å®é™…ä¸Šè®¡ç®—çš„æ˜¯åˆ†å¸ƒ $q$ ï¼Œæ‰€ä»¥æˆ‘ä»¬ä» $q$ çš„è§†è§’æ¥è®¡ç®—å®ƒåˆ° $p$ çš„KLæ•£åº¦ï¼š</p>
<p>$$q_{\phi}(z|x) \cong p_{\theta}(z|x) \rightarrow D_{\text{KL}}(q_{\phi}(z|x) || p_{\theta}(z|x))$$</p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>éœ€è¦å†æ¬¡å¼ºè°ƒçš„æ˜¯ï¼š</p>
<p>$\theta$ ä¸º decoder çš„å‚æ•°ï¼›</p>
<p>$\phi$ ä¸º encoder çš„å‚æ•°ã€‚</p>
</div>
    </div>
  </div>
<p>æ ¹æ®å®šä¹‰æˆ‘ä»¬å°†KL divergenceå±•å¼€ï¼Œå¯¹ $z$ æ±‚å’Œï¼Œè¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<p>$$
\begin{align}
D_{\text{KL}}(q_{\phi}(z|x) || p_{\theta}(z|x)) &amp;= \sum_{z} q_{\phi}(z | x) \log (\frac{q_{\phi}(z | x)}{p_{\theta}(z | x)}) \cr
&amp;= - \sum_{z} q_{\phi}(z | x) \log (\frac{p_{\theta}(z | x)}{q_{\phi}(z | x)})\cr
&amp;= - \sum_{z} q_{\phi}(z | x) \log (\frac{\frac{p_{\theta}(z,x)}{p_{\theta}(x)}}{q_{\phi}(z | x)})\cr
&amp;= - \sum_{z} q_{\phi}(z | x) [\log({\frac{p_{\theta}(x, z)}{p_{\theta}(x)}}) - \log({q_{\phi}(z | x)})]\cr
&amp;= - \sum_{z} q_{\phi}(z | x) [\log({\frac{p_{\theta}(x, z)}{q_{\phi}(z|x)}}) - \log({p_{\theta}(x)})]\cr
\end{align}
$$</p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">$p_{\theta}(z | x)$ æ˜¯æ ¹æ®æ¡ä»¶æ¦‚ç‡å…¬å¼æ‹†å¼€çš„ã€‚</div>
    </div>
  </div>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ³¨æ„åˆ° $\log(p_{\theta}(x))$ æ˜¯å’Œ $z$ æ²¡æœ‰å…³ç³»çš„ï¼Œå¹¶ä¸”logé¡¹æ˜¯å¸¸æ•°ï¼Œæ‰€ä»¥åœ¨ä¹˜æ±‚å’Œçš„æ—¶å€™ç›´æ¥æåˆ° $\sum$ å¤–é¢å»å°±å¯ä»¥äº†ï¼Œå¹¶ä¸” $q_{\phi} (z | x)$ å¯¹ $z$ æ±‚å’Œçš„ç»“æœæ˜¯1ï¼Œé‚£æ‰€ä»¥ $-\sum_{z}(q_{\phi}(z|x))(-\log(p_{\theta}(x)))$ çš„ç»“æœå°±æ˜¯ $\log(p_{\theta}(x))$ï¼Œå®ƒæ˜¯ä¸ªconstã€‚</p>
<p>æˆ‘ä»¬å°†å®ƒç§»åˆ°ç­‰å¼çš„å·¦è¾¹ï¼Œè¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<p>$$
\begin{align}
\log(p_{\theta}(x)) &amp;= D_{KL}(q_{\phi}(z|x) || p_{\theta}(z|x)) + \sum_{z}q_{\phi}(z|x)\log(\frac{p_{\theta}(x, z)}{q_{\phi}(z|x)}) \cr
&amp;= D_{KL}(q_{\phi}(z|x) || p_{\theta}(z|x)) + L(\theta, \phi; x)
\end{align}
$$</p>
<p>æˆ‘ä»¬å°† $\sum_{z}q_{\phi}(z|x)\log(\frac{p_{\theta}(x, z)}{q_{\phi}(z|x)})$ å†™æˆ $L(\theta, \phi; x)$ ï¼Œç­‰å¼å·¦è¾¹æ˜¯ä¸€ä¸ªconstï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ç®¡ $x$ çš„åˆ†å¸ƒæ˜¯ä»€ä¹ˆæ ·ï¼Œå®ƒå¯¹ $\theta$ æ¥è¯´æ²¡ä»€ä¹ˆå½±å“ã€‚ç­‰å¼å³è¾¹ï¼ŒKL divergenceæ˜¯ä¸€ä¸ªéè´Ÿçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦æŠŠ $L(\theta, \phi; x)$ çš„å€¼å°½å¯èƒ½çš„æ‹‰å¤§ï¼Œé‚£ä¹ˆKL divergenceçš„å€¼å°±ä¼šéšä¹‹ç¼©å°ã€‚</p>
<p><strong>æƒ³è¦æœ€å¤§åŒ–çš„$L(\theta, \phi; x)$ï¼Œå°±è¢«ç§°ä¸ºå˜åˆ†ä¸‹ç•Œï¼ˆVariational lower boundï¼‰ã€‚</strong></p>
<h3 id="43loss-function">4.3ã€Loss Function</h3>
<p>ç°åœ¨æˆ‘ä»¬åªè¦æƒ³åŠæ³•å°†è¿™ä¸ª lower bound æå‡å°±å¯ä»¥äº†ï¼Œé‚£ä¹ˆè¿™ä¸ª lower bound å°±å¯ä»¥ä½œä¸ºæˆ‘ä»¬çš„ loss functionï¼š</p>
<p>$$
\begin{aligned}
L(\theta, \phi; x) &amp;= \sum_{z}q_{\phi}(z|x)\log(\frac{p_{\theta}(x, z)}{q_{\phi}(z|x)}) \cr
&amp;= \sum_{z}q_{\phi}(z|x)\log(\frac{p_{\theta}(x|z) p_{\theta}(z)}{q_{\phi}(z|x)}) \cr
&amp;= \sum_{z}q_{\phi}(z|x)[\log(p_{\theta}(x|z)) + \log(\frac{p_{\theta}(z)}{q_{\phi}(z | x)})] \cr
&amp;= {E}<em>{q</em>{\phi}(z|x)}[\log(p_{\theta}(x|z))] - D_{KL}(q_{\theta}(z | x) || p_{\theta}(z))
\end{aligned}
$$</p>
<p>ä¸Šè¿°ç­‰å¼ï¼Œæˆ‘ä»¬å°† lower bound å†å±•å¼€ï¼Œå°† $p_{\theta}(x, z)$ å±•æˆæ¡ä»¶æ¦‚ç‡ï¼Œç„¶åå†å°†logæ‹†åˆ†ã€‚</p>
<p>ç¬¬ä¸‰è¡Œä¸­æ‹¬å·å†…ï¼Œå·¦è¾¹çš„å¯ä»¥å†™æˆæœŸæœ›çš„å½¢å¼ï¼Œå³è¾¹çš„å› ä¸ºéƒ½æœ‰ $q_{\phi}$ å’Œ $p_{\theta}$ æ‰€ä»¥ç¬¦åˆKL divergenceçš„å…¬å¼ã€‚</p>
<ul>
<li>æˆ‘ä»¬å°† ${E}<em>{q</em>{\phi}(z|x)}[\log(p_{\theta}(x|z))]$ ç§°ä¸º<strong>Reconstruction Loss</strong>ï¼Œ</li>
<li>å°† $-D_{KL}(q_{\theta}(z | x) || p_{\theta}(z))$ ç§°ä¸º <strong>Regularization Loss</strong>ã€‚</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¼°è®¡å‡ºè¿™ä¸¤é¡¹çš„æ¢¯åº¦æ¥ï¼Œå°±å¯ä»¥å¯¹ lower bound è¿›è¡Œä¼˜åŒ–äº†ã€‚</p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æˆ‘ä»¬çš„ç›®çš„æ˜¯æƒ³è®© Probabilistic Encoder æ¥è¿‘äº $p_{\theta}(z)$ï¼Œå› ä¸ºä¸¤ä¸ªæŸå¤±ï¼Œè¿™æ ·KL divergenceå°±è¶Šå¤§è¶Šå¥½ï¼Œå®é™…-KLæ‰æ˜¯è®­ç»ƒç”¨çš„lossã€‚</div>
    </div>
  </div>
<h3 id="44è’™ç‰¹å¡æ´›æ³•æ±‚æ¢¯åº¦">4.4ã€è’™ç‰¹å¡æ´›æ³•æ±‚æ¢¯åº¦</h3>
<p>æ¥ä¸‹æ¥è®²å¦‚ä½•æ±‚å‡ºè¿™ä¸¤é¡¹çš„å¯¼æ•°ï¼Œæ¥ä¼˜åŒ–æå‡ lower boundã€‚æˆ‘ä»¬çœ‹åˆ°æƒ³è¦ä¼˜åŒ–çš„è¿™ä¸ªlossï¼Œå…¶å®æ˜¯å¯ä»¥å†™æˆæœŸæœ›çš„å½¢å¼çš„ï¼Œå‡å®šæœŸæœ›é‡Œçš„è¿™ä¸€é¡¹æ˜¯ $f(z)$ï¼Œå¯¹äºä¼°è®¡è¿™ç§æœŸæœ›å®ƒçš„å¯¼æ•°ï¼Œæœ€ç›´æ¥çš„æˆ‘ä»¬å°±æƒ³åˆ°äº†è’™ç‰¹å¡æ´›çš„æ–¹æ³•ã€‚</p>
<p></p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">è™½ç„¶è¿™é‡Œæœ‰ä¸ª $\phi$ï¼Œä½†æˆ‘ä»¬å‡å®šè¿™ä¸ª $f(z)$ å’Œ $\phi$ æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚(å‡è®¾ï¼ï¼ï¼ï¼)</div>
    </div>
  </div>
<p>ä½¿ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•ï¼Œå¯¹ $f(z)$ åœ¨ $q_{\phi}$ ä¸Šçš„æœŸæœ›ï¼Œå¯¹ $\phi$ æ±‚å¯¼æ•°ï¼Œè¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<p>$$
\begin{aligned}
\eta &amp;= \triangle_{\phi} E_{q_{\phi}(z)}[f(z)]\cr
&amp;= \triangle_{\phi} \int {q_{\phi}(z)}f(z) \mathrm{d}z\cr
&amp;= \int \triangle_{\phi}{q_{\phi}(z)}f(z) \mathrm{d}z\cr
&amp;= \int {q_{\phi}(z)}f(z)\triangle_{\phi} \log {q_{\phi}(z)}\mathrm{d}z\cr
&amp;= E_{q_{\phi}(z)}[f(z)\triangle_{\phi} \log {q_{\phi}(z)}]
\end{aligned}
$$</p>
<ul>
<li>$line 1 \sim 2:$ æ ¹æ®æœŸæœ›çš„å®šä¹‰å±•å¼€ï¼Œå› ä¸ºæˆ‘ä»¬å‡è®¾ $f(z)$ å’Œ $\phi$ æ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥å¯ä»¥å°†å¯¼æ•°ç¬¦å·æ‹¿è¿›æ¥ï¼›</li>
<li>$line 3: $ æ ¹æ®å˜æ¢ $\triangle_{\phi} \log q_{\phi}(z) = \frac{\triangle_{\phi}q_{\phi}(z)}{q_{\phi}(z)}$ å¸¦å…¥å¯å¾—;</li>
</ul>
<p>å¥—ç”¨è’™ç‰¹å¡æ´›å…¬å¼ï¼Œæœ€ç»ˆè¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<p>$$
\begin{aligned}
\triangle_{\phi}E_{q_{\phi}(z)}[f(z)] &amp;= E_{q_{\phi}(z)}[f(z) \triangle_{q_{\phi}(z)} \log{q_{\phi}(z)}] \cr
&amp;\cong \frac{1}{L}\sum_{l=1}^{L} f(z) \triangle_{q_{\phi}(z^{(l)})} \log{q_{\phi}(z^{(l)})}, where z^{(l)} \sim q_{\phi}(z|x^{(i)})
\end{aligned}
$$</p>
<p>ä½†æ˜¯ä½œè€…å®éªŒå‘ç°ä½¿ç”¨è¿™ä¸ª estimator æ˜¯æœ‰å¾ˆé«˜çš„ variance çš„ï¼Œå°±æ˜¯ç›´è§‚ä¸Šæ¥è¯´ä¼šå¯¼è‡´è®­ç»ƒå¾ˆä¸ç¨³å®šã€‚</p>
<p>åœ¨æ­¤åŸºç¡€ä¸Šä½œè€…æå‡ºäº† Generic Stochastic Gradient Variational Bayes (<strong>SGVB</strong>) estimatorï¼Œå¹¶ä½¿ç”¨**é‡å‚æ•°åŒ–(Reparameterization)**trickï¼Œæˆ‘ä»¬å…ˆæ¥è¯´ä¸‹é‡å‚æ•°åŒ–ã€‚</p>
<h3 id="45é‡å‚æ•°åŒ–-trick">4.5ã€é‡å‚æ•°åŒ– Trick</h3>
<p>ä¸Šé¢æˆ‘ä»¬ç”¨è’™ç‰¹å¡æ´›çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªéå¸¸å¼ºçš„å‡è®¾ï¼Œé‚£å°±æ˜¯å‡è®¾ $f(z)$ å’Œ $\phi$ æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œä½†å®é™…è¡¨è¾¾å¼ä¸­ï¼š
</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè¿˜æ˜¯æœ‰å…³ç³»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—è€ƒè™‘å®ƒä»¬ä¹‹é—´å­˜åœ¨çš„å…³ç³»ã€è¿™ä¸ªå…³ç³»ä¼šå¸¦æ¥ä»€ä¹ˆæ ·çš„é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬æŠŠå®ƒæ‰“å¼€æ¥çœ‹ï¼š</p>
<p>$$
\begin{aligned}
\triangle_{\phi}E_{q_{\phi}}[f(z)] &amp;= \triangle_{\phi}\int q_{\phi}(z)f(z) \mathrm{d}z \cr
&amp;= \int \triangle_{\phi}[q_{\phi}(z)f(z)] \mathrm{d}z\cr
&amp;= \int f(z) \triangle_{\phi}q_{\phi}(z) \mathrm{d}z + \int q_{\phi}(z)\triangle_{\phi}f(z) \mathrm{d}z\cr
&amp;= \underbrace{\int f(z) \triangle_{\phi}q_{\phi}(z) \mathrm{d}z}<em>{what \ about \ this \ ?} + E</em>{q_{\phi}(z)}[\triangle_{\phi}f(z)]
\end{aligned}
$$</p>
<p>åˆ†åˆ«æ±‚å¯¼ä¹‹åï¼Œåé¢ä¸€é¡¹å¯ä»¥å†™æˆæœŸæœ›çš„å½¢å¼ï¼Œä½†æ˜¯å‰é¢è¿™ä¸€é¡¹å°±æ— æ³•å¤„ç†äº†ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½œè€…ä½¿ç”¨äº†<strong>é‡å‚æ•°åŒ–æŠ€å·§ï¼ˆReparameterization Trickï¼‰</strong>ã€‚</p>
<p>æ ¸å¿ƒæ€æƒ³å°±æ˜¯å¼•å…¥ä¸€ä¸ªè¾…åŠ©çš„éšæœºå˜é‡ $\epsilon$ï¼Œ$\epsilon \in p(\epsilon)$ï¼Œè¿™ä¸ªéšæœºå˜é‡å’Œå…¶å®ƒå˜é‡æ²¡æœ‰å…³ç³»ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„éšæœºå˜é‡ï¼Œç”¨æ¥è¡¨ç¤ºäº§ç”Ÿ $z$ çš„è¿‡ç¨‹ä¸­æ‰€æœ‰çš„éšæœºæ€§ã€‚ä¹Ÿå°±æ˜¯è¯´æŠ½æ ·äº§ç”Ÿ $z$ çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„éšæœºæ€§éƒ½æ˜¯ç”±è¿™ä¸ª $\epsilon \in p(\epsilon)$ äº§ç”Ÿçš„ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠ $z$ å†™æˆè¿™ç§å½¢å¼ï¼š $z = g_{\phi}(\epsilon, x)$ï¼Œä»è€Œå¯ä»¥æŠŠ $q_{\phi}(z)$ è¿™ä¸ªæ¦‚ç‡åˆ†å¸ƒè½¬ç§»åˆ° $p_{\epsilon}$ ä¸Šï¼Œè€Œ $\epsilon$ æœ‰ä¸€ä¸ªéå¸¸å¥½çš„ç‰¹æ€§ï¼Œé‚£å°±æ˜¯å’Œ $\phi$ æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚</p>
<p>è¿™ç§ trick å°±æ˜¯é‡å‚æ•°åŒ–ï¼Œå¾—åˆ°æ–°çš„å˜å½¢åé‡æ–°å¯¹ $\phi$ æ±‚å¯¼ï¼š</p>
<p>$$
\begin{aligned}
E_{q_{\phi(z)}}[f(z^{(i)})] &amp;= E_{p(\epsilon)}[f(g_{\phi}(\epsilon, x^i))] \cr
\triangle_{\phi}E_{q_{\phi(z)}}[f(z^{(i)})] &amp;= \triangle_{\phi}E_{p(\epsilon)}[f(g_{\phi}(\epsilon, x^i)]\cr
&amp;=E_{p(\epsilon)}[\triangle_{\phi}f(g_{\phi}(\epsilon, x^i)]\cr
&amp;\approx \frac{1}{L} \sum_{l=1}^{L} \triangle_{\phi}f(g_{\phi}(\epsilon^{(l)}, x^{(i)}))
\end{aligned}
$$</p>
<p>ä¼°è®¡è¿™ä¸ªæœŸæœ›ä¹Ÿæ˜¯é‡‡æ ·ç„¶åæ±‚å¹³å‡å¾—åˆ°æœ€åçš„å¼å­ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠlossçš„æ¢¯åº¦ç»™ä¼°è®¡å‡ºæ¥äº†ã€‚</p>
<p>ä»¥ä¸Šæ˜¯ä»æ•°å­¦è§’åº¦æ¥åˆ†æçš„é‡å‚æ•°åŒ–æŠ€å·§ï¼Œè¿™é‡Œä½œè€…ç»™å‡ºäº†ä¸€ä¸ªæ›´åŠ ç›´è§‚çš„è¡¨è¾¾ï¼š</p>
<p></p>
<ul>
<li>å·¦å›¾ä¸ºåŸæ¥çš„å½¢å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ $\phi$ å’Œ $x$ äº§ç”Ÿä¸€ä¸ªdistributionï¼Œç„¶ååœ¨è¿™ä¸ªdistributionä¸­æŠ½æ ·äº§ç”Ÿä¸€ä¸ªzï¼Œç„¶åå†å¾—åˆ°æœ€ç»ˆçš„ $f$ ã€‚ä½†æ˜¯åœ¨ä¼ é€’æ¢¯åº¦çš„æ—¶å€™ï¼Œæ€ä¹ˆæŠŠæ¢¯åº¦é€šè¿‡æŠ½æ ·è¿™ä¸ªè¿‡ç¨‹ä¼ é€’å›æ¥å‘¢ï¼Ÿè¿™ä¸ªæ˜¯æ²¡æ³•ä¼ é€’æ¢¯åº¦çš„ã€‚
åœ¨ä½¿ç”¨äº†é‡å‚æ•°åŒ–trickåï¼Œéšæœºæ€§ç§»åŠ¨åˆ°äº† $\epsilon$ ä¸Šï¼Œä¹‹å‰æ‰€æœ‰æŠ½æ ·çš„è¿‡ç¨‹åŒ…æ‹¬çš„éšæœºæ€§ï¼Œéƒ½è®© $\epsilon$ åŒ…æ‹¬äº†ï¼Œè¿™æ ·å°±å¯ä»¥é¡ºåˆ©åœ°å°†æ¢¯åº¦é€šè¿‡ $z$ ä¼ é€’åˆ° $\phi$ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å·§å¦™çš„æ–¹æ³•.</li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">å¯ä»¥ç†è§£æˆç”¨å¤šä½™å‚æ•°é€¼è¿‘æŠ½æ ·çš„è¿‡ç¨‹ã€‚</div>
    </div>
  </div>
<h3 id="46-generic-sgvb">4.6 Generic SGVB</h3>
<p>ç®€å•è¯´å®Œé‡å‚æ•°åŒ–ï¼Œæˆ‘ä»¬å›åˆ°SGVB:
</p>
<p>è¿™é‡Œæ˜¯æƒ³æ±‚è¿™ä¸€ä¸²æœŸæœ›ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬çš„ $f(z)$ ï¼Œæ ¹æ®ä¹‹å‰çš„ Reparameterization Trickï¼Œæˆ‘ä»¬æŠŠ $z$ å†™æˆè¿™æ ·çš„å½¢å¼ï¼š</p>
<p>$$z^{(i, l)} = g_{\phi} (\epsilon^{(i,l)}, x^{(i)}) \ and \ \epsilon^{(l)} \sim p(\epsilon)$$</p>
<p>è®© $\epsilon$ ä»è¿™ä¸ª distribution ä¸­æŠ½æ ·äº§ç”Ÿï¼Œ$\epsilon$ æ˜¯ä¸€ä¸ªä¸ $\phi$ ã€$\theta$ éƒ½æ²¡æœ‰å…³ç³»çš„éšæœºå˜é‡ï¼Œç„¶å loss å°±å˜æˆï¼š</p>
<p>$$L(\theta, \phi, x^{(i)}) = \frac{1}{L} \sum_{l=1}^{L} \log p_{\theta}(x^{(i)}, z^{(i,l)}) - \log q_{\phi}(z^{(i,l)} | x^{(i)})$$</p>
<p>æƒ³è¦æ±‚å®ƒå¯¹ $\phi$ çš„å¯¼æ•°ï¼Œåªéœ€è¦ä¸¤è¾¹åŒæ—¶æ±‚å¯¼å³å¯ã€‚</p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">å› ä¸ºæœŸæœ›è¿™ä¸ªç§¯åˆ†å·²ç»è¢«æ›¿æ¢æˆäº† $\epsilon$ çš„distributionï¼Œå®ƒè·Ÿ $\phi$ æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¼°è®¡æ•´ä¸ªlossçš„å¯¼æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥å¯¹ $\phi$ æ±‚å¯¼å°±å¯ä»¥äº†ã€‚</div>
    </div>
  </div>
<p>è¿™ä¸ªå°±æ˜¯ä½œè€…æå‡ºçš„ç¬¬ä¸€ç§ä¼°è®¡æ¢¯åº¦çš„æ–¹æ³•ã€‚</p>
<h3 id="47another-sgvb">4.7ã€Another SGVB</h3>
<p>åœ¨æ­¤åŸºç¡€ä¸Šä½œè€…è¿˜å‘ç°ï¼Œæœ‰ä¸€äº›å¥½çš„æ€§è´¨å¯ä»¥ç›´æ¥æ‹¿æ¥åˆ©ç”¨ï¼Œæ¯”å¦‚æœŸæœ›çš„ä¸€äº›æ€§è´¨ã€‚</p>
<p>åœ¨ 4.3 èŠ‚ä¸­æˆ‘ä»¬è®²åˆ°åŸæ¥çš„ loss å¯ä»¥å†™æˆ KLæ•£åº¦ + æœŸæœ› çš„å½¢å¼ï¼š</p>
<p>$$L(\theta, \phi, x^{(i)}) = -D_{KL}(q_{\phi}(z|x^{(i)})||p_{\theta}(z)) + E_{q_{\phi}(z|x)}[\log(p_{\theta}(x^{(i)}|z))]$$</p>
<p>è¿™é‡Œæˆ‘ä»¬å‡è®¾è¿™ä¸¤ä¸ªdistributionï¼š$q_{\phi}$ ã€$p_{\theta}$ éƒ½æ˜¯ Gaussian distributionï¼Œè¯´ç™½äº†å°±æ˜¯0å‡å€¼1æ–¹å·®ï¼Œæ ¹æ®å®šä¹‰ï¼š</p>
<p>$$
\begin{cases}
D_{KL}(P||Q) = E_{x \sim P}[\log(\frac{P(x)}{Q(x)})]\cr
E_{x\sim P(x)} = \int P(x)Q(x)\mathrm{d}x
\end{cases}
$$</p>
<p>æˆ‘ä»¬æ ¹æ®ä¸Šè¿°å®šä¹‰æ‰“å¼€è¿™ä¸ªKL divergenceï¼š</p>
<p>$$-D_{KL}(q_{\phi}(z|x)||p_{\theta}(z)) = \int q_{\phi}(z|x)(\log p_{\theta}(z)) - \log q_{\phi}(z|x) \mathrm{d}z$$</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ $\int q_{\phi}(z|x)\log p_{\theta}(z) \mathrm{d}z$:</p>
<p>$$
\begin{align}
\int q_{\phi}(z|x)\log p_{\theta}(z) \mathrm{d}z &amp;= \int N(z; \mu, \sigma^2) \log N(z; 0, 1)\mathrm{d}z\cr
&amp;= \int N(z; \mu, \sigma^2) (-\frac{1}{2}z^2 - \frac{1}{2}\log(2\pi))\mathrm{d}z\cr
&amp;= -\frac{1}{2} \int N(z; \mu, \sigma^2) z^2\mathrm{d}z - \frac{J}{2}\log(2\pi) \cr
&amp;= -\frac{J}{2} \log (2\pi) - \frac{1}{2}(E_{z \sim N(z;\mu, \sigma^2)}[z]^2 + Var(z))\cr
&amp;= -\frac{J}{2} \log (2\pi) - \frac{1}{2}\sum_{J}^{j=1}(\mu^2 + \sigma_j^2)
\end{align}
$$</p>
<ul>
<li>$line 1\sim 2:$ æˆ‘ä»¬è®©å·¦é¢åˆ†å¸ƒ $N(z; \mu, \sigma^2)$ ä¿æŒä¸åŠ¨ï¼Œå°† normal distribution çš„PDFå¸¦è¿›å»ï¼›
<ul>
<li>normal distribution çš„PDFä¸º:
</li>
<li>å°†å¸¸æ•°é¡¹ç›´æ¥æ‹¿å‡ºæ¥ï¼ŒæŒ‡æ•°çš„éƒ¨åˆ†ä¹Ÿé€šè¿‡logç›´æ¥æ‹¿ä¸‹æ¥äº†ï¼›</li>
</ul>
</li>
<li>$line 3:$ å› ä¸º $\frac{1}{2}\log(2\pi)$ æ˜¯ä¸ªå¸¸æ•°ã€$N(z; \mu, \sigma^2)$ è¿™ä¸ªåˆ†å¸ƒç§¯åˆ†ä¹‹åæ˜¯1ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æŠŠå¸¸æ•°é¡¹æ‹¿åˆ°ç§¯åˆ†å¤–é¢ï¼›ä½†æ˜¯å› ä¸º $z$ æ˜¯ä¸€ä¸ªå‘é‡ï¼Œæˆ‘ä»¬å‡è®¾ $z$ æœ‰ $J$ ä¸ªå…ƒç´ elementï¼Œé‚£ä¹ˆæ¯ä¸ªå…ƒç´ éƒ½ä¼šç§¯å‡ºä¸€ä¸ªå€¼æ¥ï¼Œæ‰€ä»¥è¦ä¹˜ä¸Š $J$ï¼Œå³ $\frac{J}{2}\log(2\pi)$;</li>
<li>$line 4:$ å¯¹äºç§¯åˆ† $\int N(z;\mu,\sigma^2) z^2\mathrm{d}z$ æˆ‘ä»¬å¯ä»¥æ¢ä¸ªè§’åº¦ç†è§£å®ƒï¼šè¿™é‡Œæˆ‘ä»¬æŠŠå®ƒå°±å½“æˆä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œæ‰€ä»¥æ•´ä¸ªè¿™ä¸ªç§¯åˆ†å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªæœŸæœ›çš„å½¢å¼ï¼Œä¸è¿‡å®ƒæ˜¯å¯¹ $z^2$ çš„æœŸæœ›ï¼Œç»è¿‡å˜å½¢å¯ä»¥å†™æˆ $-\frac{1}{2} E_{z \sim N(z; \mu, \sigma^2)}[z]^2$
ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæˆ‘ä»¬ä½¿ç”¨æœŸæœ›çš„æ€§è´¨ $E[z^2] = E[z]^2 + variance(z)$ï¼Œå³ $z^2$ çš„æœŸæœ›ç­‰äºæœŸæœ›çš„å¹³æ–¹åŠ ä¸Š $z$ çš„æ–¹å·®ï¼›</li>
<li>é‚£ä¹ˆå¯¹äºä¸€ä¸ª normal distribution æ¥è¯´å®ƒçš„æœŸæœ›å’Œæ–¹å·®æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼š$\mu$ å’Œ $\sigma$ï¼Œå¯¹äº $z$ é‡Œçš„æ¯ä¸ªå…ƒç´ ï¼ˆè„šæ ‡æ˜¯ $j$ï¼‰éƒ½åŠ èµ·æ¥å°±å¥½äº†ï¼Œè¿™æ ·æœ€å¼€å§‹çš„ç§¯åˆ†å°±å¯ä»¥ç®€åŒ–æˆæœ€åçš„å½¢å¼ã€‚</li>
</ul>
<p>æˆ‘ä»¬å†æ¥çœ‹ $\int q_{\phi}(z|x)\log q_{\phi}(z|x)\mathrm{d}z$:</p>
<p>$$
\begin{aligned}
\int q_{\phi}(z|x)\log q_{\phi}(z|x)\mathrm{d}z &amp;=\int N(z; \mu, \sigma^2)\log N(z;\mu,\sigma^2)\mathrm{d}z\cr
&amp;= \int N(z; \mu, \sigma^2)(-\frac{1}{2}(\frac{z - \mu}{\sigma})^2- \frac{1}{2}\log (2 \pi) - \frac{1}{2}\log(\sigma^2))\mathrm{d}z\cr
&amp;=-\frac{1}{2}\int N(z;\mu,\sigma^{2})(\frac{z-\mu}{\sigma})^{2}\mathrm{d}z-\frac{J}{2}log(2\pi)-\frac{1}{2}\sum_{j=1}^{J}log(\sigma_{j}^{2}) \cr
&amp;=-\frac J2log(2\pi)-\frac12\sum_{j=1}^{J}log(\sigma_{j}^{2})-\frac12E_{z\sim N(z;\mu,\sigma^{2})}[(\frac{z-\mu}\sigma)^{2}] \cr
&amp;=-\frac{J}{2}log(2\pi)-\frac{1}{2}\sum_{j=1}^{J}log(\sigma_{j}^{2})-\frac{1}{2}(E_{z\sim N(z;\mu,\sigma^{2})}[\frac{z-\mu}{\sigma}]^{2}+Var(\frac{z-\mu}{\sigma})) \cr
&amp;=-\frac{J}{2}log(2\pi)-\frac{1}{2}\sum_{j=1}^{J}(1+log(\sigma_j^2))
\end{aligned}
$$</p>
<p>åŒæ ·çš„è¿˜æ˜¯æŠŠå®ƒçš„PDFå¸¦è¿›æ¥ï¼Œå±•æˆä¸Šé¢ç›¸ä¼¼çš„å½¢å¼ï¼Œä½†æ˜¯è¿™ä¸ªåœ°æ–¹çš„å¸¸æ•°é¡¹å’Œå˜é‡è¦æ˜¾å¾—å¤æ‚ä¸€ç‚¹ï¼Œç›¸ä¼¼çš„æ˜¯æˆ‘ä»¬ä¸€æ ·å¯ä»¥æŠŠå¸¸æ•°éƒ¨åˆ†æ‹¿åˆ°ç§¯åˆ†å¤–é¢å»ï¼Œç„¶åå¯¹äºå‰é¢è¿™é¡¹ç§¯åˆ†ä¹ŸæŠŠå®ƒç†è§£æˆæœŸæœ›çš„å½¢å¼ï¼ŒåŒæ ·åˆ©ç”¨æœŸæœ›çš„æ€§è´¨å°†å¹³æ–¹åŒ–ç®€ï¼Œå°±å¯ä»¥å¾—åˆ°æœ€åçš„ç»“æœã€‚</p>
<p>éšåæˆ‘ä»¬æŠŠ KLæ•£åº¦ è¿™ä¸¤é¡¹ç»™åˆå¹¶èµ·æ¥ï¼š
$$
\begin{aligned}
-D_{KL}(q_{\phi}(z\mid x)\mid\mid p_{\theta}(z))&amp; =\int q_\phi(z\mid x)(logp_\theta(z))-logq_\phi(z\mid x))\mathrm{d}z  \cr
&amp;=\frac12\sum_{j=1}^J(1+log((\sigma_j)^2)-(\mu_j)^2-(\sigma_j)^2)
\end{aligned}
$$</p>
<p>æŠŠåˆšåˆšä¸Šé¢çš„ç»“æœå¸¦è¿›æ¥åšå‡æ³•å³å¯å¾—åˆ°è¿™ä¸ªç­‰å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡è¿™ä¸ªå¼å­æ¥ä¼°è®¡å‡ºKLæ•£åº¦ã€‚</p>
<p>å¯¹äºå¦ä¸€éƒ¨åˆ†çš„loss $E_{q_{\phi}(z|x)}[\log(p_{\theta}(x^{(i)} | z))]$ï¼Œå°±åƒæˆ‘ä»¬ä¸Šé¢è¯´çš„ï¼Œè¿™éƒ¨åˆ†çš„æ¦‚ç‡æˆ‘ä»¬å¸Œæœ›given $z$ äº§ç”Ÿçš„ $x$ å°½é‡çš„æ¥è¿‘è¾“å…¥ $x$ï¼Œä¸ºäº†å®ç°è¿™ä¸ªé€¼è¿‘ï¼Œæˆ‘ä»¬ä½¿ç”¨MSEæ¥è®©$f(z)$é€¼è¿‘è¿™ä¸ªxï¼Œå°±å¯ä»¥æœ€å¤§åŒ–è¿™ä¸ªlossï¼š</p>
<p></p>
<p>ä»¥ä¸Šå°±æ˜¯æœ€ç»ˆä½¿ç”¨çš„SGVBï¼Œä½œè€…é€šè¿‡ KLæ•£åº¦ çš„æ€§è´¨å’Œ Regularization Loss çš„è¿‘ä¼¼ï¼Œç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§ç›¸å¯¹ç¨³å®šçš„ä¼°è®¡losså’Œæ¢¯åº¦çš„æ–¹æ³•ã€‚</p>
<h2 id="äº”vae-ç»“æ„å›é¡¾">äº”ã€VAE ç»“æ„å›é¡¾</h2>
<p></p>
<p>æ€»çš„æ¥çœ‹ Variational Auto-Encoder çš„modelå°±æ˜¯ï¼š</p>
<ul>
<li>è¾“å…¥ä¸€ä¸ª $x$ï¼Œè¿›äº†Encoderï¼Œè¿™ä¸ª Encoder æ˜¯ç”±å‚æ•°æ¥å†³å®šçš„ï¼ŒEncoder ä¼šäº§ç”Ÿ $Î¼$å’Œ $Ïƒ$ï¼›</li>
<li>$Î¼$å’Œ $Ïƒ$é¦–å…ˆè¢«æˆ‘ä»¬ç”¨æ¥è®¡ç®— KL divergenceï¼Œä½œä¸º<strong>è¾…åŠ©æŸå¤±</strong>ï¼›</li>
<li>åŒæ—¶åœ¨ $Î¼$ å’Œ $Ïƒ$ä¹‹åæˆ‘ä»¬å¯¹å®ƒæŠ½æ ·äº§ç”Ÿä¸€ä¸ª $z$ï¼ŒåŠ ä¸Š $\epsilon$ å¸®æˆ‘ä»¬äº§ç”Ÿéšæœºçš„é¡¹ï¼›</li>
<li>å¾—åˆ°éšå˜é‡ $z$åï¼Œæ”¾åˆ° Decoder é‡Œï¼Œå®ƒæ˜¯ç”±å‚æ•° $\theta$ æ¥å†³å®šçš„ï¼›</li>
<li>ç»è¿‡è¿™ä¸ª Decoder ä¹‹åï¼Œæˆ‘ä»¬é‡å»ºå‡ºäº†ä¸€ä¸ª $x$ï¼›</li>
<li>å¯¹æ¯”é‡å»ºåçš„ $x$ å’Œè¾“å…¥ $x$ ä¹‹é—´çš„ MSE å°±æ„æˆäº†lossçš„å¦ä¸€éƒ¨åˆ†ï¼Œ</li>
<li>ä¸¤ä¸ªlossåŠ èµ·æ¥å°±æ˜¯æœ€ç»ˆçš„lossã€‚</li>
</ul>
<p>è¿™ä¸ªå°±æ˜¯æœ€ç»å…¸çš„ Variational Auto-Encoderã€‚</p>
<p>å¯¹æ¯”ç¬¬ä¸€å¤§èŠ‚AEçš„å›¾ï¼Œå¯ä»¥ç”»æˆä¸€ä¸‹å½¢å¼ï¼š</p>
<p></p>
<h2 id="å…­åŸæ–‡å®éªŒ">å…­ã€åŸæ–‡å®éªŒ</h2>
<p>ä½œè€…åŸºäºMNIST å’Œ Frey Faceåšäº†å®éªŒéªŒè¯ï¼Œçœ‹ä¸‹åŸæ–‡çš„ç»“æœå›¾ï¼š</p>
<p></p>
<p>é¦–å…ˆä½œè€…è¯´äº†ä½¿ç”¨ä¸åŒçš„å­¦ä¹ æ–¹æ³•èƒ½æŠŠè¿™ä¸ª lower bound æå‡å¤šå°‘ï¼Œlower bound çš„æå‡è¶Šå¤§ï¼Œè¯´æ˜ Encoder å’Œæˆ‘ä»¬æƒ³è¦é€¼è¿‘çš„è¿™ä¸ªDistructionï¼Œå®ƒçš„KLæ•£åº¦æ˜¯è¶Šæ¥è¶Šå°ã€‚</p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">ç”±å›¾ä¸­å¯ä»¥çœ‹å‡ºAEVBä¸wake-sleepç®—æ³•çš„æ¯”è¾ƒï¼Œå¯ä»¥çœ‹å‡ºAEVBè®­ç»ƒæ•ˆæœæ›´å¥½ã€‚ä¸”éšç€éšå˜é‡ç»´åº¦å¢å¤§ï¼Œå¹¶æœªå‡ºç°è¿‡æ‹Ÿåˆç°è±¡ã€‚</div>
    </div>
  </div>
<p>
</p>
<p>å›¾4æ˜¯é™å®š2ä¸ªç»´åº¦çš„éšå˜é‡ $z$ï¼Œå¹¶è°ƒèŠ‚ä¸¤ä¸ªç»´åº¦çš„å€¼ï¼Œç”Ÿæˆçš„å›¾ç‰‡ã€‚</p>
<p>å›¾5æ˜¯ä¸åŒç»´åº¦çš„éšå˜é‡éšæœºé‡‡æ ·çš„å›¾ç‰‡ã€‚</p>
<h2 id="ä¸ƒtorchå¤ç°-aevae">ä¸ƒã€torchå¤ç° AEã€VAE</h2>
<p><a href="https://wangguisen.blog.csdn.net/article/details/128476638"target="_blank" rel="external nofollow noopener noreferrer">https://wangguisen.blog.csdn.net/article/details/128476638<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<h2 id="references">References</h2>
<p>[1]. <a href="https://arxiv.org/abs/1312.6114"target="_blank" rel="external nofollow noopener noreferrer">https://arxiv.org/abs/1312.6114<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[2]. <a href="http://www.gwylab.com/note-vae.html"target="_blank" rel="external nofollow noopener noreferrer">http://www.gwylab.com/note-vae.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[3]. <a href="https://zhuanlan.zhihu.com/p/452743042"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/452743042<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[4]. <a href="https://www.bilibili.com/video/BV1q64y1y7J2/"target="_blank" rel="external nofollow noopener noreferrer">https://www.bilibili.com/video/BV1q64y1y7J2/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[5]. <a href="https://www.bilibili.com/video/av15889450/?p=33"target="_blank" rel="external nofollow noopener noreferrer">https://www.bilibili.com/video/av15889450/?p=33<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[6]. <a href="https://gregorygundersen.com/blog/2018/04/29/reparameterization/"target="_blank" rel="external nofollow noopener noreferrer">https://gregorygundersen.com/blog/2018/04/29/reparameterization/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
</br>
[7]. <a href="https://mp.weixin.qq.com/s?__biz=Mzk0MzIzODM5MA==&amp;mid=2247486014&amp;idx=1&amp;sn=2ff34f72c869907408ed1b08bec1a238&amp;chksm=c337b7a7f4403eb14a1b5cdc3e1a1b11dca6f957591957cc29a4c270f0ace0a4674a7ae33214&amp;scene=21#wechat_redirect"target="_blank" rel="external nofollow noopener noreferrer">https://mp.weixin.qq.com/s?__biz=Mzk0MzIzODM5MA==&mid=2247486014&idx=1&sn=2ff34f72c869907408ed1b08bec1a238&chksm=c337b7a7f4403eb14a1b5cdc3e1a1b11dca6f957591957cc29a4c270f0ace0a4674a7ae33214&scene=21#wechat_redirect<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>]]></description></item><item><title>Effective STL [12] | ç†è§£è‡ªå®šä¹‰åˆ†é…å™¨çš„æ­£ç¡®ç”¨æ³•</title><link>https://jianye0428.github.io/posts/clause_12/</link><pubDate>Wed, 02 Aug 2023 08:03:42 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_12/</guid><description><![CDATA[<!-- <div class="details admonition quote">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-quote-right fa-fw" aria-hidden="true"></i>quote<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">note abstract info tip success question warning failure danger bug example quote</div>
    </div>
  </div> -->
<h2 id="å¤šçº¿ç¨‹ç»´æŠ¤çš„è§„åˆ™">å¤šçº¿ç¨‹ç»´æŠ¤çš„è§„åˆ™</h2>
<p>å¤šçº¿ç¨‹ç¨‹åºæ˜¯å¾ˆæ™®éçš„ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†STLå‚å•†åŠªåŠ›ä½¿ä»–ä»¬çš„å®ç°åœ¨çº¿ç¨‹ç¯å¢ƒä¸­å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>
<p>ä½†æ˜¯ï¼Œå³ä½¿ä»–ä»¬åšå¾—å¾ˆå¥½ï¼Œã€Œ<strong>å¤§éƒ¨åˆ†è´Ÿæ‹…ä»åœ¨ä½ è‚©ä¸Šï¼Œè€Œç†è§£ä¸ºä»€ä¹ˆä¼šè¿™æ ·æ˜¯å¾ˆé‡è¦çš„</strong>ã€ã€‚</p>
<p>åœ¨STLå®¹å™¨ï¼ˆå’Œå¤§å¤šæ•°å‚å•†çš„æ„¿æœ›ï¼‰é‡Œå¯¹å¤šçº¿ç¨‹æ”¯æŒçš„é»„é‡‘è§„åˆ™å·²ç»ç”±SGIå®šä¹‰ï¼Œå¹¶ä¸”åœ¨å®ƒä»¬çš„STLç½‘ç«™ä¸Šå‘å¸ƒï¼š</p>
<ul>
<li>ã€Œ<strong>å¤šä¸ªè¯»å–è€…æ˜¯å®‰å…¨çš„</strong>ã€ã€‚å¤šçº¿ç¨‹å¯èƒ½åŒæ—¶è¯»å–ä¸€ä¸ªå®¹å™¨çš„å†…å®¹ï¼Œåœ¨è¯»å–æ—¶ã€Œä¸èƒ½æœ‰ä»»ä½•å†™å…¥è€…æ“ä½œè¿™ä¸ªå®¹å™¨ã€ã€‚</li>
<li>ã€Œ<strong>å¯¹ä¸åŒå®¹å™¨çš„å¤šä¸ªå†™å…¥è€…æ˜¯å®‰å…¨çš„</strong>ã€ã€‚å¤šçº¿ç¨‹å¯ä»¥åŒæ—¶å†™ä¸åŒçš„å®¹å™¨ã€‚å¯¹åŒä¸€ä¸ªå®¹å™¨åŒæ—¶å¤šçº¿ç¨‹å†™å…¥æ˜¯ä¸å®‰å…¨çš„ã€‚</li>
</ul>
<h2 id="å®Œå…¨çº¿ç¨‹å®‰å…¨">å®Œå…¨çº¿ç¨‹å®‰å…¨ï¼Ÿ</h2>
<p>å¾ˆå¤šç¨‹åºå‘˜å¸Œæœ›STLå®ç°æ˜¯å®Œå…¨çº¿ç¨‹å®‰å…¨ï¼Œè¿™éå¸¸éš¾ä»¥å®ç°ã€‚</p>
<p>ä¸€ä¸ªåº“å¯èƒ½è¯•å›¾ä»¥ä¸‹åˆ—æ–¹å¼å®ç°è¿™æ ·å®Œå…¨çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼š</p>
<ul>
<li>æ¯æ¬¡è°ƒç”¨å®¹å™¨çš„æˆå‘˜å‡½æ•°æœŸé—´éƒ½è¦é”å®šè¯¥å®¹å™¨ã€</li>
<li>åœ¨ã€Œ<strong>æ¯ä¸ªå®¹å™¨è¿”å›çš„è¿­ä»£å™¨(ä¾‹å¦‚é€šè¿‡è°ƒç”¨beginæˆ–end)çš„ç”Ÿå­˜æœŸä¹‹å†…éƒ½è¦é”å®šè¯¥å®¹å™¨</strong>ã€</li>
<li>åœ¨ã€Œ<strong>æ¯ä¸ªåœ¨å®¹å™¨ä¸Šè°ƒç”¨çš„ç®—æ³•æ‰§è¡ŒæœŸé—´é”å®šè¯¥å®¹å™¨</strong>ã€ã€‚ï¼ˆè¿™äº‹å®ä¸Šæ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºç®—æ³•æ²¡æœ‰åŠæ³•è¯†åˆ«å‡ºå®ƒä»¬æ­£åœ¨æ“ä½œçš„å®¹å™¨ï¼‰</li>
</ul>
<h2 id="example-å¤šçº¿ç¨‹ä¿®æ”¹">Example å¤šçº¿ç¨‹ä¿®æ”¹</h2>
<p>æœå¯»ä¸€ä¸ªvector<int>ä¸­ç¬¬ä¸€æ¬¡å‡ºç°3è¿™ä¸ªå€¼çš„åœ°æ–¹ï¼Œå¦‚æœå®ƒæ‰¾åˆ°äº†ï¼Œå°±æŠŠè¿™ä¸ªå€¼æ”¹ä¸º2ã€‚</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">first3</span><span class="p">(</span><span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">3</span><span class="p">));</span> <span class="c1">// line 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">first3</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span> <span class="c1">// line 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">first3</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// line 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¤šçº¿ç¨‹è®¿é—®æ—¶ï¼Œä¼šæœ‰å¾ˆå¤šã€Œé—®é¢˜ã€:</p>
<ol>
<li>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒé‡Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½åœ¨è¡Œ1å®Œæˆä¹‹åç«‹åˆ»ä¿®æ”¹vä¸­çš„æ•°æ®ã€‚å¦‚æœæ˜¯é‚£æ ·ï¼Œè¡Œ2å¯¹first3å’Œv.endçš„æ£€æµ‹å°†æ˜¯æ— æ„ä¹‰çš„ï¼Œå› ä¸ºvçš„å€¼å¯èƒ½å’Œå®ƒä»¬åœ¨è¡Œ1ç»“æŸæ—¶çš„å€¼ä¸åŒã€‚</li>
<li>è¿™æ ·çš„æ£€æµ‹ä¼šäº§ç”Ÿæœªå®šä¹‰çš„ç»“æœï¼Œå› ä¸ºå¦ä¸€çº¿ç¨‹å¯èƒ½æ’åœ¨è¡Œ1å’Œè¡Œ2ä¹‹é—´ï¼Œä½¿first3å¤±æ•ˆï¼Œæˆ–è®¸é€šè¿‡è¿›è¡Œä¸€æ¬¡æ’å…¥æ“ä½œé€ æˆvectoré‡æ–°åˆ†é…å®ƒçš„å†…åœ¨å†…å­˜ã€‚ï¼ˆé‚£å°†ä½¿vectorå…¨éƒ¨çš„è¿­ä»£å™¨å¤±æ•ˆï¼‰</li>
<li>è¡Œ3ä¸­å¯¹<code>*first3</code>çš„èµ‹å€¼æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½åœ¨è¡Œ2å’Œè¡Œ3ä¹‹é—´æ‰§è¡Œï¼Œå¹¶ä»¥æŸç§æ–¹å¼ä½¿<code>first3</code>å¤±æ•ˆï¼Œå¯èƒ½é€šè¿‡åˆ é™¤å®ƒæŒ‡å‘ï¼ˆæˆ–è‡³å°‘æ›¾ç»æŒ‡å‘ï¼‰çš„å…ƒç´ ã€‚</li>
</ol>
<p><strong>è§£å†³åŠæ³•ï¼šåŠ é”</strong></p>
<p>è¦è®©ä¸Šé¢çš„ä»£ç æˆä¸ºçº¿ç¨‹å®‰å…¨çš„ï¼Œã€Œ<strong>vå¿…é¡»ä»è¡Œ1åˆ°è¡Œ3ä¿æŒé”å®š</strong>ã€ï¼Œè®©æœ€å¤šä¸€ä¸ªçº¿ç¨‹åœ¨1-3è¡Œçš„è¿‡ç¨‹ä¸­èƒ½è®¿é—®vã€‚å¾ˆéš¾æƒ³è±¡STLå®ç°æ€ä¹ˆèƒ½è‡ªåŠ¨æ¨æ–­å‡ºè¿™ä¸ªã€‚</p>
<p>è€Œã€Œ<strong>åŒæ­¥åŸè¯­ï¼ˆä¾‹å¦‚ï¼Œä¿¡å·ç¯ï¼Œäº’æ–¥é‡ï¼Œç­‰ç­‰ï¼‰é€šå¸¸å¼€é”€å¾ˆå¤§</strong>ã€ï¼Œæ›´éš¾æƒ³è±¡æ€ä¹ˆå®ç°åœ¨ç¨‹åºæ²¡æœ‰æ˜æ˜¾æ€§èƒ½æŸå¤±çš„æƒ…å†µä¸‹åšåˆ°å‰é¢æ‰€è¯´çš„ã€‚</p>
<p>å› æ­¤ä½ å¿…é¡»ã€Œ<strong>æ‰‹å·¥å¯¹ä»˜</strong>ã€è¿™äº›æƒ…å†µä¸­çš„åŒæ­¥æ§åˆ¶</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">getMutexFor</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">first3</span><span class="p">(</span><span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">3</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">first3</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// è¿™é‡Œç°åœ¨å®‰å…¨äº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">first3</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// è¿™é‡Œä¹Ÿæ˜¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">releaseMutexFor</span><span class="p">(</span><span class="n">v</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ã€Œ<strong>æ”¹è¿›</strong>ï¼šã€ä¸€ä¸ªæ›´é¢å‘å¯¹è±¡çš„è§£å†³æ–¹æ¡ˆæ˜¯ã€Œ<strong>åˆ›å»ºä¸€ä¸ªLockç±»</strong>ã€ï¼Œåœ¨å®ƒçš„ã€Œ<strong>æ„é€ å‡½æ•°é‡Œè·å¾—äº’æ–¥é‡å¹¶åœ¨å®ƒçš„ææ„å‡½æ•°é‡Œé‡Šæ”¾å®ƒ</strong>ã€ï¼Œè¿™æ ·ä½¿<strong>getMutexFor</strong>å’Œ<strong>releaseMutexFor</strong>çš„ã€Œ<strong>è°ƒç”¨ä¸åŒ¹é…çš„æœºä¼šå‡åˆ°æœ€å°</strong>ã€:</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Container</span><span class="o">&gt;</span> <span class="c1">// è·å–å’Œé‡Šæ”¾å®¹å™¨çš„äº’æ–¥é‡çš„ç±»çš„æ¨¡æ¿æ ¸å¿ƒï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Lock</span> <span class="p">{</span> <span class="o">/</span>
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> <span class="c1">// å¿½ç•¥äº†å¾ˆå¤šç»†èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Lock</span><span class="p">(</span><span class="k">const</span> <span class="n">Containers</span> <span class="n">container</span><span class="p">)</span><span class="o">:</span> <span class="n">c</span><span class="p">(</span><span class="n">container</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">getMutexFor</span><span class="p">(</span><span class="n">c</span><span class="p">);</span> <span class="c1">// åœ¨æ„é€ å‡½æ•°è·å–äº’æ–¥é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">Lock</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">releaseMutexFor</span><span class="p">(</span><span class="n">c</span><span class="p">);</span> <span class="c1">// åœ¨ææ„å‡½æ•°é‡Œé‡Šæ”¾å®ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"> <span class="k">const</span> <span class="n">Container</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ä¸€ä¸ªç±»ï¼ˆåƒLockï¼‰æ¥ç®¡ç†èµ„æºçš„ç”Ÿå­˜æœŸï¼ˆä¾‹å¦‚äº’æ–¥é‡ï¼‰çš„åŠæ³•é€šå¸¸ç§°ä¸º<strong>èµ„æºè·å¾—å³åˆå§‹åŒ–</strong>ã€‚</p>
<p>åº”ç”¨åˆ°ä¸Šè¿°ä¾‹å­ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="c1">// å»ºç«‹æ–°å—ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Lock</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">v</span><span class="p">);</span> <span class="c1">// è·å–äº’æ–¥é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">first3</span><span class="p">(</span><span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">3</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">first3</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">*</span><span class="n">first3</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// å…³é—­å—ï¼Œè‡ªåŠ¨
</span></span></span><span class="line"><span class="cl"><span class="c1">// é‡Šæ”¾äº’æ–¥é‡
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>åŸºäºLockçš„æ–¹æ³•åœ¨æœ‰å¼‚å¸¸çš„æƒ…å†µä¸‹æ˜¯ç¨³å¥çš„</strong></p>
<p>å› ä¸ºLockå¯¹è±¡åœ¨Lockçš„ææ„å‡½æ•°é‡Œé‡Šæ”¾å®¹å™¨çš„çš„äº’æ–¥é‡ï¼Œæ‰€ä»¥åœ¨äº’æ–¥é‡éœ€è¦é‡Šæ”¾æ˜¯å°±é”€æ¯Lockæ˜¯å¾ˆé‡è¦çš„ã€‚ä¸ºäº†è®©è¿™ä»¶äº‹å‘ç”Ÿï¼Œæˆ‘ä»¬å»ºç«‹ä¸€ä¸ªé‡Œé¢å®šä¹‰äº†Lockçš„æ–°å—ï¼Œè€Œä¸”å½“æˆ‘ä»¬ä¸å†éœ€è¦äº’æ–¥é‡æ—¶å°±å…³é—­é‚£ä¸ªå—ã€‚</p>
<p>C++ä¿è¯å¦‚æœæŠ›å‡ºäº†å¼‚å¸¸ï¼Œå±€éƒ¨å¯¹è±¡å°±ä¼šè¢«é”€æ¯ï¼Œæ‰€ä»¥å³ä½¿å½“æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨Lockå¯¹è±¡æ—¶æœ‰å¼‚å¸¸æŠ›å‡ºï¼ŒLockä¹Ÿå°†é‡Šæ”¾å®ƒçš„äº’æ–¥é‡ã€‚å¦‚æœæˆ‘ä»¬ä¾èµ–æ‰‹å·¥è°ƒç”¨<code>getMutexFor</code>å’Œ<code>releaseMutexFor</code>ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨<code>getMutexFor</code>ä¹‹å<code>releaseMutexFor</code>ä¹‹å‰å¦‚æœæœ‰å¼‚å¸¸æŠ›å‡ºï¼Œæˆ‘ä»¬å°†ä¸ä¼šé‡Šæ”¾äº’æ–¥é‡ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<ul>
<li>
<p>å½“æ¶‰åŠåˆ°çº¿ç¨‹å®‰å…¨å’ŒSTLå®¹å™¨æ—¶ï¼Œä½ å¯ä»¥ç¡®å®šåº“å®ç°å…è®¸åœ¨ä¸€ä¸ªå®¹å™¨ä¸Šçš„å¤šè¯»å–è€…å’Œä¸åŒå®¹å™¨ä¸Šçš„å¤šå†™å…¥è€…ã€‚</p>
</li>
<li>
<p>ã€Œä½ ä¸èƒ½å¸Œæœ›åº“æ¶ˆé™¤å¯¹æ‰‹å·¥å¹¶è¡Œæ§åˆ¶çš„éœ€è¦ï¼Œè€Œä¸”ä½ å®Œå…¨ä¸èƒ½ä¾èµ–äºä»»ä½•çº¿ç¨‹æ”¯æŒã€</p>
</li>
</ul>]]></description></item><item><title>Effective STL ç²¾åº¦æ€»ç»“ [7] | åœ¨ç¨‹åºä¸­ä½¿ç”¨STL</title><link>https://jianye0428.github.io/posts/partseven/</link><pubDate>Mon, 28 Aug 2023 07:58:09 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/partseven/</guid><description><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1>
<blockquote>
<p>Effective-STLæ€»ç»“ç³»åˆ—åˆ†ä¸ºä¸ƒéƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬ä¸ƒéƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬ä¸ƒç« ï¼Œå†…å®¹èŒƒå›´Rule43~50ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule43ç®€å†™ä¸ºR43ã€‚</p>
</blockquote>
<div class="details admonition Note">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Effective-STLç³»åˆ—List<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partone/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/parttwo/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partthree/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partfour/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></div>
    </div>
  </div>
<h2 id="r43-ç®—æ³•è°ƒç”¨ä¼˜å…ˆäºæ‰‹å†™çš„å¾ªç¯">R43 ç®—æ³•è°ƒç”¨ä¼˜å…ˆäºæ‰‹å†™çš„å¾ªç¯</h2>
<p>è°ƒç”¨ç®—æ³•ä¼˜äºæ‰‹å†™å¾ªç¯ï¼š</p>
<ul>
<li>æ•ˆç‡ï¼š<strong>ç®—æ³•</strong>æ¯”æ‰‹å†™çš„å¾ªç¯<strong>æ•ˆç‡æ›´é«˜</strong>ã€‚</li>
<li>æ­£ç¡®æ€§ï¼šæ‰‹å†™å¾ªç¯æ¯”ä½¿ç”¨ç®—æ³•å®¹æ˜“å‡ºé”™ã€‚</li>
<li>å¯ç»´æŠ¤æ€§ï¼šä½¿ç”¨ç®—æ³•çš„ä»£ç æ›´åŠ ç®€æ´æ˜äº†ã€‚</li>
</ul>
<p>ä¾‹å­ï¼šP155ï¼Œ</p>
<p>ç®—æ³•çš„åç§°è¡¨æ˜äº†å®ƒçš„åŠŸèƒ½ï¼Œè€Œ forã€whileã€do å¾ªç¯ä¸èƒ½ã€‚</p>
<p>æ‰‹å†™å¾ªç¯éœ€è¦ç»´æŠ¤è¿­ä»£å™¨çš„æœ‰æ•ˆæ€§ã€‚</p>
<p>Ref:</p>
<p>[1]. <a href="https://www.cnblogs.com/Sherry4869/p/15162253.html"target="_blank" rel="external nofollow noopener noreferrer">https://www.cnblogs.com/Sherry4869/p/15162253.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>
[2]. <a href="https://blog.csdn.net/zhuikefeng/article/details/108164117#t35"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/zhuikefeng/article/details/108164117#t35<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>
[3]. <a href="https://zhuanlan.zhihu.com/p/458156007"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/458156007<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>Effective STL [34] | æ³¨æ„å“ªä¸ªç®—æ³•éœ€è¦æœ‰åºåŒºé—´</title><link>https://jianye0428.github.io/posts/clause_34/</link><pubDate>Sat, 26 Aug 2023 10:55:58 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_34/</guid><description><![CDATA[<p>ä¸æ˜¯æ‰€æœ‰ç®—æ³•å¯ä»¥ç”¨äºä»»æ„åŒºé—´ã€‚æ¯”å¦‚ï¼Œ<strong>removeéœ€è¦å‰å‘è¿­ä»£å™¨å’Œå¯ä»¥é€šè¿‡è¿™äº›è¿­ä»£å™¨èµ‹å€¼çš„èƒ½åŠ›</strong>ã€‚æ‰€ä»¥ï¼Œå®ƒä¸èƒ½åº”ç”¨äºç”±è¾“å…¥è¿­ä»£å™¨åˆ’åˆ†çš„åŒºé—´ï¼Œä¹Ÿä¸èƒ½æ˜¯mapæˆ–multimapï¼Œä¹Ÿä¸èƒ½æ˜¯setå’Œmultisetçš„ä¸€äº›å®ç°ã€‚</p>
<p>åŒæ ·ï¼Œ<strong>å¾ˆå¤šæ’åºç®—æ³•éœ€è¦éšæœºè®¿é—®è¿­ä»£å™¨</strong>ï¼Œæ‰€ä»¥ä¸å¯èƒ½åœ¨ä¸€ä¸ªlistçš„å…ƒç´ ä¸Šè°ƒç”¨è¿™äº›ç®—æ³•ã€‚</p>
<p>æœ€å¸¸è§çš„å°±æ˜¯ä¸€äº›ç®—æ³•<strong>éœ€è¦æœ‰åºå€¼çš„åŒºé—´</strong>ã€‚æ— è®ºä½•æ—¶éƒ½åº”è¯¥åšæŒè¿™ä¸ªéœ€æ±‚ï¼Œå› ä¸ºå†’çŠ¯å®ƒä¸ä»…ä¼šå¯¼è‡´ç¼–è¯‘å™¨è¯Šæ–­ï¼Œè€Œä¸”ä¼šé€ æˆæœªå®šä¹‰çš„è¿è¡ŒæœŸè¡Œä¸ºã€‚</p>
<p>æ—¢å¯ä»¥å’Œæœ‰åºåˆå¯ä»¥å’Œæ— åºåŒºé—´åˆä½œçš„ç®—æ³•å¾ˆå°‘ï¼Œä½†<strong>å½“æ“ä½œæœ‰åºåŒºé—´çš„æ—¶å€™å®ƒä»¬æœ€æœ‰ç”¨</strong>ã€‚</p>
<h2 id="åªèƒ½æ“ä½œæœ‰åºæ•°æ®çš„ç®—æ³•çš„è¡¨">åªèƒ½æ“ä½œæœ‰åºæ•°æ®çš„ç®—æ³•çš„è¡¨</h2>
<ul>
<li>binary_search</li>
<li>lower_bound</li>
<li>upper_bound</li>
<li>equal_range</li>
<li>set_union</li>
<li>set_intersection</li>
<li>set_difference</li>
<li>set_symmetric_difference</li>
<li>merge</li>
<li>inplace_merge</li>
<li>includes</li>
</ul>
<h2 id="ä¸€èˆ¬ç”¨äºæœ‰åºåŒºé—´ä½†ä¸å¼ºåˆ¶è¦æ±‚">ä¸€èˆ¬ç”¨äºæœ‰åºåŒºé—´ï¼Œä½†ä¸å¼ºåˆ¶è¦æ±‚</h2>
<ul>
<li>unique</li>
<li>unique_copy</li>
</ul>
<h2 id="binary_searchlower_boundupper_boundå’Œequal_range"><code>binary_search</code>ã€<code>lower_bound</code>ã€<code>upper_bound</code>å’Œ<code>equal_range</code></h2>
<p>æœç´¢ç®—æ³•binary_searchã€lower_boundã€upper_boundå’Œequal_rangeéœ€è¦<strong>æœ‰åºåŒºé—´</strong>ï¼Œå› ä¸ºå®ƒä»¬<strong>ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾æ¥æœç´¢</strong>å€¼ã€‚åƒCåº“ä¸­çš„bsearchï¼Œè¿™äº›ç®—æ³•ä¿è¯äº†<strong>å¯¹æ•°æ—¶é—´çš„æŸ¥æ‰¾</strong>ï¼Œä½†ä½œä¸ºäº¤æ¢çš„æ˜¯ï¼Œä½ å¿…é¡»ç»™å®ƒä»¬å·²ç»æ’è¿‡åºçš„å€¼ã€‚</p>
<p>å®é™…ä¸Šï¼Œä»…å½“ä¼ ç»™å®ƒä»¬çš„æ˜¯éšæœºè®¿é—®è¿­ä»£å™¨æ—¶å®ƒä»¬æ‰èƒ½ä¿è¯æœ‰é‚£æ ·çš„æ€§èƒ½ã€‚</p>
<p>å¦‚æœç»™å®ƒä»¬å¨åŠ›æ¯”è¾ƒå°çš„è¿­ä»£å™¨ï¼ˆæ¯”å¦‚åŒå‘è¿­ä»£å™¨ï¼‰ï¼Œå®ƒä»¬ä»ç„¶è¿›è¡Œå¯¹æ•°æ¬¡æ¯”è¾ƒï¼Œä½†è¿è¡Œæ˜¯çº¿æ€§æ—¶é—´çš„ã€‚é‚£æ˜¯å› ä¸ºï¼Œç¼ºä¹è¿›è¡Œâ€œ<strong>è¿­ä»£å™¨ç®—æœ¯ï¼ˆarithmeticï¼‰</strong>â€çš„èƒ½åŠ›ã€‚å®ƒä»¬åœ¨æœç´¢çš„åŒºé—´ä¸­éœ€è¦èŠ±è´¹çº¿æ€§æ—¶é—´æ¥ä»ä¸€ä¸ªåœ°æ–¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚</p>
<h2 id="unionset_intersectionset_differenceå’Œset_symmetric_difference"><code>union</code>ã€<code>set_intersection</code>ã€<code>set_difference</code>å’Œ<code>set_symmetric_difference</code></h2>
<p>ç®—æ³•<code>set_union</code>ã€<code>set_intersection</code>ã€<code>set_difference</code>å’Œ<code>set_symmetric_difference</code>çš„å››äººç»„æä¾›äº†çº¿æ€§æ—¶é—´è®¾ç½®å®ƒä»¬åå­—æ‰€æå‡ºçš„æ“ä½œçš„æ€§èƒ½ã€‚</p>
<p>ä¸ºä»€ä¹ˆå®ƒä»¬éœ€è¦æœ‰åºåŒºé—´ï¼Ÿå› ä¸ºå¦‚æœä¸æ˜¯çš„è¯ï¼Œå®ƒä»¬ä¸èƒ½ä»¥çº¿æ€§æ—¶é—´å®Œæˆå®ƒä»¬çš„å·¥ä½œã€‚</p>
<p>ä½ ä¼šå‘ç°ï¼Œ<strong>éœ€è¦æœ‰åºåŒºé—´çš„ç®—æ³•ä¸ºäº†æ¯”å®ƒä»¬ç”¨äºå¯èƒ½æ— åºåŒºé—´æä¾›æ›´å¥½çš„æ€§èƒ½è€Œè¿™ä¹ˆåš</strong>ã€‚</p>
<h2 id="mergeå’Œinplace_merge">mergeå’Œinplace_merge</h2>
<p>mergeå’Œinplace_mergeæ‰§è¡Œäº†æœ‰æ•ˆçš„å•éåˆå¹¶æ’åºç®—æ³•ï¼šå®ƒä»¬è¯»å–ä¸¤ä¸ªæœ‰åºåŒºé—´ï¼Œç„¶åäº§ç”Ÿä¸€ä¸ªåŒ…å«äº†ä¸¤ä¸ªæºåŒºé—´æ‰€æœ‰å…ƒç´ çš„æ–°æœ‰åºåŒºé—´ã€‚</p>
<p>å®ƒä»¬ä»¥çº¿æ€§æ—¶é—´æ‰§è¡Œï¼Œå¦‚æœå®ƒä»¬ä¸çŸ¥é“æºåŒºé—´å·²ç»æœ‰åºå°±ä¸èƒ½å®Œæˆã€‚</p>
<h2 id="includes">includes</h2>
<p>includes ç”¨æ¥æ£€æµ‹æ˜¯å¦ä¸€ä¸ªåŒºé—´çš„æ‰€æœ‰å¯¹è±¡ä¹Ÿåœ¨å¦ä¸€ä¸ªåŒºé—´ä¸­ã€‚</p>
<p>å› ä¸ºincludeså¯èƒ½å‡è®¾å®ƒçš„ä¸¤ä¸ªåŒºé—´éƒ½å·²ç»æœ‰åºï¼Œæ‰€ä»¥å®ƒä¿è¯äº†çº¿æ€§æ—¶é—´æ€§èƒ½ã€‚æ²¡æœ‰é‚£ä¸ªä¿è¯ï¼Œä¸€èˆ¬æ¥è¯´å®ƒä¼šå˜æ…¢ã€‚</p>
<h2 id="uniqueå’Œunique_copy">uniqueå’Œunique_copy</h2>
<p>uniqueå’Œunique_copyç”šè‡³åœ¨æ— åºåŒºé—´ä¸Šä¹Ÿæä¾›äº†å®šä¹‰è‰¯å¥½çš„è¡Œä¸ºã€‚</p>
<p>çœ‹çœ‹æ ‡å‡†æ˜¯æ€ä¹ˆæè¿°uniqueçš„è¡Œä¸ºçš„ï¼š</p>
<blockquote>
<p>ä»æ¯ä¸ªç›¸ç­‰å…ƒç´ çš„è¿ç»­ç»„ä¸­å»é™¤ç¬¬ä¸€ä¸ªä»¥å¤–æ‰€æœ‰çš„å…ƒç´ ã€‚</p>
</blockquote>
<p>å¦‚æœä½ è¦uniqueä»ä¸€ä¸ªåŒºé—´å»é™¤æ‰€æœ‰é‡å¤å€¼ï¼ˆä¹Ÿå°±æ˜¯ï¼Œè®©åŒºé—´ä¸­æ‰€æœ‰å€¼â€œå”¯ä¸€â€ï¼‰ï¼Œä½ å¿…é¡»å…ˆç¡®ä¿æ‰€æœ‰é‡å¤å€¼ä¸€ä¸ªæ¥ç€ä¸€ä¸ªã€‚é‚£æ˜¯æ’åºå®Œæˆçš„ä¸œè¥¿ä¹‹ä¸€ã€‚</p>
<p>å®é™…ä¸Šï¼Œuniqueä¸€èˆ¬ç”¨äºä»åŒºé—´ä¸­å»é™¤æ‰€æœ‰é‡å¤å€¼ï¼Œæ‰€ä»¥ä½ å‡ ä¹æ€»æ˜¯è¦ç¡®ä¿ä½ ä¼ é€’ç»™uniqueï¼ˆæˆ–unique_copyï¼‰çš„åŒºé—´æ˜¯æœ‰åºçš„ã€‚Unixå¼€å‘è€…ä¼šå‘ç°STLçš„uniqueå’ŒUnixçš„uniqä¹‹é—´æœ‰æƒŠäººçš„ç›¸ä¼¼ã€‚</p>
<p>é¡ºä¾¿è¯´è¯´ï¼Œuniqueä»ä¸€ä¸ªåŒºé—´é™¤å»å…ƒç´ çš„æ–¹å¼å’Œremoveä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªæ˜¯åŒºåˆ†å‡ºä¸é™¤å»çš„å…ƒç´ ã€‚</p>
<h2 id="æ’åº">æ’åº</h2>
<p>å› ä¸ºSTLå…è®¸ä½ æŒ‡å®šç”¨äºæ’åºçš„æ¯”è¾ƒå‡½æ•°ï¼Œ<strong>ä¸åŒçš„åŒºé—´å¯èƒ½ä»¥ä¸åŒçš„æ–¹å¼æ’åº</strong>ã€‚</p>
<p>æ¯”å¦‚ï¼Œç»™å®šä¸¤ä¸ªintçš„åŒºé—´ï¼Œä¸€ä¸ªå¯èƒ½ä»¥é»˜è®¤æ–¹å¼æ’åºï¼ˆä¹Ÿå°±æ˜¯å‡åºï¼‰ï¼Œè€Œå¦ä¸€ä¸ªä½¿ç”¨<code>greater&lt;int&gt;</code>æ’åºï¼Œå› æ­¤æ˜¯é™åºã€‚</p>
<p>ç»™å®šWidgetçš„ä¸¤ä¸ªåŒºé—´ï¼Œä¸€ä¸ªå¯èƒ½ä»¥ä»·æ ¼æ’åºè€Œå¦ä¸€ä¸ªå¯èƒ½ä»¥å¹´é¾„æ’åºã€‚å› ä¸ºæœ‰å¾ˆå¤šä¸åŒçš„æ–¹å¼æ¥æ’åºï¼Œæ‰€ä»¥ä¿è¯ç»™STLæ‰€ä½¿ç”¨çš„æ’åºç›¸å…³ä¿¡æ¯ä¸€è‡´æ˜¯å¾ˆé‡è¦çš„ã€‚</p>
<p><strong>å¦‚æœä½ ä¼ ä¸€ä¸ªåŒºé—´ç»™ä¸€ä¸ªä¹Ÿå¸¦æœ‰æ¯”è¾ƒå‡½æ•°çš„ç®—æ³•ï¼Œç¡®ä¿ä½ ä¼ é€’çš„æ¯”è¾ƒå‡½æ•°è¡Œä¸ºå’Œä½ ç”¨äºæ’åºè¿™ä¸ªåŒºé—´çš„ä¸€æ ·ã€‚</strong></p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹ä¸€ä¸ªvectorï¼ŒæŠŠä¸€äº›æ•°æ®æ”¾è¿›å»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">sort</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">greater</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span> <span class="c1">// é™åºæ’åˆ—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨è¿™ä¸ªvectorï¼ˆæ²¡æœ‰æ”¹å˜å®ƒï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1">// åœ¨è¿™ä¸ªvectorä¸­æœç´¢5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="n">is3Exists</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="n">binary_search</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// å‡è®¾å®ƒæ˜¯å‡åºæ’åˆ—ï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œbinary_searchå‡è®¾å®ƒæœç´¢çš„åŒºé—´æ˜¯ä»¥â€œ&lt;â€æ’åºï¼ˆä¹Ÿå°±æ˜¯ï¼Œå€¼æ˜¯å‡åºï¼‰ï¼Œä½†åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™ä¸ªvectoræ˜¯é™åºã€‚å½“ä½ åœ¨å€¼çš„æ’åˆ—é¡ºåºå’Œç®—æ³•æ‰€æœŸæœ›çš„ä¸åŒçš„åŒºé—´ä¸Šè°ƒç”¨binary_search (æˆ–lower_boundç­‰ï¼‰ä¼šå¯¼è‡´æœªå®šä¹‰çš„ç»“æœã€‚</p>
<h3 id="æ­£ç¡®æ’åºæ–¹å¼">æ­£ç¡®æ’åºæ–¹å¼</h3>
<p>è¦è®©ä»£ç è¡Œä¸ºæ­£ç¡®ï¼Œä½ å¿…é¡»å‘Šè¯‰binary_searchè¦ä½¿ç”¨å’ŒsortåŒæ ·çš„æ¯”è¾ƒå‡½æ•°ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="n">is3Exists</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æœç´¢3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">binary_search</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">3</span><span class="p">,</span> <span class="n">greater</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ¯”è¾ƒå‡½æ•°æŠŠgreaterä½œä¸º
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><font color=blue>æ‰€æœ‰éœ€è¦æœ‰åºåŒºé—´çš„ç®—æ³•ï¼ˆä¹Ÿå°±æ˜¯é™¤äº†uniqueå’Œunique_copyå¤–æœ¬æ¡æ¬¾çš„æ‰€æœ‰ç®—æ³•ï¼‰é€šè¿‡ç­‰ä»·æ¥åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦â€œç›¸åŒâ€ï¼Œå°±åƒæ ‡å‡†å…³è”å®¹å™¨ï¼ˆå®ƒä»¬æœ¬èº«æ˜¯æœ‰åºçš„ï¼‰ã€‚ç›¸åï¼Œuniqueå’Œunique_copyåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡â€œç›¸åŒâ€çš„é»˜è®¤æ–¹å¼æ˜¯é€šè¿‡ç›¸ç­‰</font>ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡ä¼ ç»™è¿™äº›ç®—æ³•ä¸€ä¸ªå®šä¹‰äº†â€œç›¸åŒâ€çš„æ„ä¹‰çš„åˆ¤æ–­å¼æ¥è¦†ç›–è¿™ä¸ªé»˜è®¤æƒ…å†µã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>11ä¸ªéœ€è¦æœ‰åºåŒºé—´çš„ç®—æ³•ä¸ºäº†æ¯”å…¶ä»–å¯èƒ½æ€§æä¾›æ›´å¥½çš„æ€§èƒ½è€Œ<font color=blue>éœ€è¦ä¼ ç»™å®ƒä»¬æœ‰åºåŒºé—´ï¼Œéœ€è¦ä¿è¯ç”¨äºç®—æ³•çš„æ¯”è¾ƒå‡½æ•°å’Œç”¨äºæ’åºçš„ä¸€è‡´</font>ã€‚</p>
]]></description></item><item><title>Effective STL [33] | æé˜²åœ¨æŒ‡é’ˆçš„å®¹å™¨ä¸Šä½¿ç”¨ç±»ä¼¼removeçš„ç®—æ³•</title><link>https://jianye0428.github.io/posts/clause_33/</link><pubDate>Sat, 26 Aug 2023 10:55:54 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_33/</guid><description><![CDATA[<h2 id="åˆ é™¤å«æœ‰æŒ‡é’ˆçš„å®¹å™¨å…ƒç´ ">åˆ é™¤å«æœ‰æŒ‡é’ˆçš„å®¹å™¨å…ƒç´ </h2>
<p>å¦‚æœä½ åœ¨ç®¡ç†ä¸€å †åŠ¨æ€åˆ†é…çš„Widgetsï¼Œæ¯ä¸€ä¸ªéƒ½å¯èƒ½é€šè¿‡æ£€éªŒï¼Œä½ æŠŠç»“æœæŒ‡é’ˆä¿å­˜åœ¨ä¸€ä¸ªvectorä¸­ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¿™ä¸ªWidgetæ˜¯å¦é€šè¿‡æ£€éªŒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="n">isCertified</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹ä¸€ä¸ªvectorç„¶åç”¨åŠ¨æ€åˆ†é…çš„Widgetçš„æŒ‡é’ˆå¡«å……
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">*&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Widget</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å½“å’Œvå·¥ä½œä¸€æ®µæ—¶é—´åï¼Œä½ å†³å®šé™¤å»æœªé€šè¿‡æ£€éªŒçš„Widgetï¼Œå› ä¸ºä½ ä¸å†éœ€è¦å®ƒä»¬äº†ã€‚</p>
<p><strong>å°½é‡ç”¨ç®—æ³•è°ƒç”¨ä»£æ›¿æ˜¾å¼å¾ªç¯å’Œå…³äºremoveå’Œeraseä¹‹é—´å…³ç³»çš„æè¿°</strong>ï¼Œä½ è‡ªç„¶ä¼šæƒ³åˆ°è½¬å‘erase-removeæƒ¯ç”¨æ³•ï¼Œè™½ç„¶è¿™æ¬¡ä½ ä½¿ç”¨äº†remove_ifï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">remove_if</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ é™¤æœªé€šè¿‡æ£€éªŒçš„WidgetæŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">not1</span><span class="p">(</span><span class="n">mem_fun</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Widget</span><span class="o">::</span><span class="n">isCertified</span><span class="p">))),</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å…³äºmem_funçš„ä¿¡æ¯å‚è§æ¡æ¬¾41
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ¡æ¬¾7ä»‹ç»è¿‡æ‘§æ¯å®¹å™¨ä¸­çš„ä¸€ä¸ªæŒ‡é’ˆä¹Ÿä¸ä¼šåˆ é™¤æŒ‡é’ˆæŒ‡å‘çš„ä¸œè¥¿çš„è®¨è®ºï¼Œæ‰€ä»¥è¿™é‡Œå½“è°ƒç”¨eraseæ—¶ï¼Œæå¯èƒ½ä½ å·²ç»æ³„æ¼äº†èµ„æºã€‚</p>
<h2 id="èµ„æºæ³„éœ²åˆ†æ">èµ„æºæ³„éœ²åˆ†æ</h2>
<p>æˆ‘ä»¬å‡è®¾åœ¨è°ƒç”¨remove_ifå‰ï¼Œvçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<p></p>
<p>åœ¨è°ƒç”¨remove_ifåï¼Œä¸€èˆ¬æ¥è¯´vçœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆåŒ…å«ä»remove_ifè¿”å›çš„è¿­ä»£å™¨ï¼‰ï¼š</p>
<p></p>
<p>èµ„æºæ³„æ¼çš„ç†ç”±ç°åœ¨å¾ˆæ˜æœ—äº†ã€‚æŒ‡å‘Widget Bå’ŒCçš„â€œåˆ é™¤çš„â€æŒ‡é’ˆè¢«vectorä¸­åé¢çš„â€œä¸åˆ é™¤çš„â€æŒ‡é’ˆè¦†ç›–ã€‚æ²¡æœ‰ä»€ä¹ˆæŒ‡å‘ä¸¤ä¸ªæœªé€šè¿‡æ£€éªŒçš„Widgetï¼Œå®ƒä»¬ä¹Ÿæ²¡æœ‰è¢«åˆ é™¤ï¼Œå®ƒä»¬çš„å†…å­˜å’Œå…¶ä»–èµ„æºæ³„æ¼äº†ã€‚</p>
<p>ä¸€æ—¦remove_ifå’Œeraseè¿”å›åï¼Œæƒ…å†µçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<p></p>
<p>ç°åœ¨ä½ ä¹Ÿå¾ˆæ¸…æ¥šä¸ºä»€ä¹ˆåº”è¯¥åŠªåŠ›é¿å…åœ¨åŠ¨æ€åˆ†é…çš„æŒ‡é’ˆçš„å®¹å™¨ä¸Šä½¿ç”¨removeå’Œç±»ä¼¼ç®—æ³•ï¼ˆremove_ifå’Œuniqueï¼‰ã€‚</p>
<p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½ ä¼šå‘ç°<strong>partitionç®—æ³•æ˜¯åˆç†çš„æ›¿ä»£å“</strong>ã€‚</p>
<h2 id="æ­£ç¡®åˆ é™¤åšæ³•">æ­£ç¡®åˆ é™¤åšæ³•</h2>
<p>å¦‚æœä½ æ— æ³•é¿å…åœ¨é‚£æ ·çš„å®¹å™¨ä¸Šä½¿ç”¨removeï¼Œæ’é™¤è¿™ä¸ªé—®é¢˜ä¸€ç§æ–¹æ³•æ˜¯åœ¨<strong>åº”ç”¨erase-removeæƒ¯ç”¨æ³•ä¹‹å‰å…ˆåˆ é™¤æŒ‡é’ˆå¹¶è®¾ç½®å®ƒä»¬ä¸ºç©ºï¼Œç„¶åé™¤å»å®¹å™¨ä¸­çš„æ‰€æœ‰ç©ºæŒ‡é’ˆ</strong>ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">delAndNullifyUncertified</span><span class="p">(</span><span class="n">Widget</span> <span class="o">*&amp;</span><span class="n">pWidget</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å¦‚æœ*pWidgetæ˜¯ä¸€ä¸ªæœªé€šè¿‡æ£€éªŒWidgetï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pWidget</span><span class="o">-&gt;</span><span class="n">isCertified</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ é™¤æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">delete</span> <span class="n">pWidget</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¹¶ä¸”è®¾ç½®å®ƒä¸ºç©º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">pWidget</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠæ‰€æœ‰æŒ‡å‘æœªé€šè¿‡æ£€éªŒWidgetçš„æŒ‡é’ˆåˆ é™¤å¹¶ä¸”è®¾ç½®ä¸ºç©º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">for_each</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">delAndNullifyUncertified</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä»vä¸­é™¤å»ç©ºæŒ‡é’ˆ0å¿…é¡»æ˜ å°„åˆ°ä¸€ä¸ªæŒ‡é’ˆï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">remove</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">               <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Widget</span> <span class="o">*&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è®©C++å¯ä»¥æ­£ç¡®åœ°æ¨å‡ºremoveçš„ç¬¬ä¸‰ä¸ªå‚æ•°çš„ç±»å‹
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç„¶ï¼Œè¿™å‡è®¾vectorå¹¶ä¸å®¹çº³ä»»ä½•ä½ æƒ³ä¿ç•™çš„ç©ºæŒ‡é’ˆã€‚å¦‚æœæœ‰çš„è¯ï¼Œä½ å¯èƒ½å¿…é¡»è‡ªå·±å†™å¾ªç¯æ¥æŒ‰ä½ çš„æ–¹å¼åˆ é™¤æŒ‡é’ˆã€‚</p>
<h3 id="æ™ºèƒ½æŒ‡é’ˆ">æ™ºèƒ½æŒ‡é’ˆ</h3>
<p>å¦‚æœä½ æŠŠæŒ‡é’ˆçš„å®¹å™¨æ›¿æ¢æˆ<strong>æ‰§è¡Œå¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆçš„å®¹å™¨</strong>ï¼Œåˆ é™¤ç›¸å…³çš„å›°éš¾å°±ä¸å­˜åœ¨äº†ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨erase-removeæƒ¯ç”¨æ³•ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// RCSP = â€œå¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆâ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">RCSP</span> <span class="p">{</span> <span class="p">...};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// RCSPW = â€œRCSP to Widgetâ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="n">RCSP</span><span class="o">&lt;</span> <span class="n">Widget</span><span class="o">&gt;</span> <span class="n">RCSPW</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹ä¸€ä¸ªvectorï¼Œç”¨åŠ¨æ€åˆ†é…Widgetçš„æ™ºèƒ½æŒ‡é’ˆå¡«å……å®ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">RCSPW</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">RCSPW</span><span class="p">(</span><span class="k">new</span> <span class="n">Widget</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// eraseæœªé€šè¿‡æ£€éªŒçš„Widgetçš„æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">remove_if</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="n">not1</span> <span class="p">(</span><span class="n">mem_fun</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Widget</span><span class="o">::</span><span class="n">isCertified</span><span class="p">))),</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ²¡æœ‰èµ„æºæ³„æ¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦è®©è¿™äº›å·¥ä½œï¼Œä½ çš„<strong>æ™ºèƒ½æŒ‡é’ˆç±»å‹å°±å¿…é¡»å¯ä»¥ï¼ˆæ¯”å¦‚<code>RCSP&lt;Widget&gt;</code>ï¼‰éšå¼è½¬æ¢ä¸ºç›¸åº”çš„å†…å»ºæŒ‡é’ˆç±»å‹ï¼ˆæ¯”å¦‚<code>Widget*</code>ï¼‰</strong>ã€‚é‚£æ˜¯å› ä¸ºå®¹å™¨æŒæœ‰æ™ºèƒ½æŒ‡é’ˆï¼Œä½†è¢«è°ƒç”¨çš„æˆå‘˜å‡½æ•°ï¼ˆæ¯”å¦‚<code>Widget::isCertified</code>ï¼‰è¦çš„æ˜¯å†…å»ºæŒ‡é’ˆã€‚å¦‚æœä¸å­˜åœ¨éšå¼è½¬æ¢ï¼Œä½ çš„ç¼–è¯‘å™¨ä¼šæŠ—è®®çš„ã€‚</p>
]]></description></item><item><title>Effective STL [32] | å¦‚æœä½ çœŸçš„æƒ³åˆ é™¤ä¸œè¥¿çš„è¯å°±åœ¨ç±»ä¼¼removeçš„ç®—æ³•åæ¥ä¸Šerase</title><link>https://jianye0428.github.io/posts/clause_32/</link><pubDate>Sat, 26 Aug 2023 10:55:50 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_32/</guid><description><![CDATA[<h2 id="removeå®é™…ä½œç”¨">removeå®é™…ä½œç”¨</h2>
<h3 id="removeçš„å£°æ˜">removeçš„å£°æ˜</h3>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">ForwardIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">ForwardIterator</span> <span class="n">remove</span><span class="p">(</span><span class="n">ForwardIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">ForwardIterator</span> <span class="n">last</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>removeæ¥æ”¶æŒ‡å®šå®ƒæ“ä½œçš„å…ƒç´ åŒºé—´çš„ä¸€å¯¹è¿­ä»£å™¨ã€‚å®ƒä¸æ¥æ”¶ä¸€ä¸ªå®¹å™¨ï¼Œæ‰€ä»¥<strong>removeä¸çŸ¥é“å®ƒä½œç”¨äºå“ªä¸ªå®¹å™¨</strong>ã€‚</p>
<p>æ­¤å¤–ï¼Œremoveä¹Ÿä¸å¯èƒ½å‘ç°å®¹å™¨ï¼Œå› ä¸ºæ²¡æœ‰åŠæ³•ä»ä¸€ä¸ªè¿­ä»£å™¨è·å–å¯¹åº”äºå®ƒçš„å®¹å™¨ã€‚</p>
<h3 id="removeä¸åšä»€ä¹ˆ">removeä¸åšä»€ä¹ˆ</h3>
<p>ä»å®¹å™¨ä¸­é™¤å»ä¸€ä¸ªå…ƒç´ ï¼Œå”¯ä¸€çš„æ–¹æ³•æ˜¯è°ƒç”¨é‚£ä¸ªå®¹å™¨çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œå‡ ä¹éƒ½æ˜¯eraseçš„æŸä¸ªå½¢å¼ï¼Œ(listæœ‰å‡ ä¸ªé™¤å»å…ƒç´ çš„æˆå‘˜å‡½æ•°ä¸å«eraseï¼Œä½†å®ƒä»¬ä»ç„¶æ˜¯æˆå‘˜å‡½æ•°ã€‚)å› ä¸ºå”¯ä¸€ä»å®¹å™¨ä¸­é™¤å»ä¸€ä¸ªå…ƒç´ çš„æ–¹æ³•æ˜¯åœ¨é‚£ä¸ªå®¹å™¨ä¸Šè°ƒç”¨ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œè€Œä¸”å› ä¸ºremoveæ— æ³•çŸ¥é“å®ƒæ­£åœ¨æ“ä½œçš„å®¹å™¨ï¼Œæ‰€ä»¥removeä¸å¯èƒ½ä»ä¸€ä¸ªå®¹å™¨ä¸­é™¤å»å…ƒç´ ã€‚</p>
<p>ä»ä¸€ä¸ªå®¹å™¨ä¸­removeå…ƒç´ ä¸ä¼šæ”¹å˜å®¹å™¨ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹ä¸€ä¸ªvector&lt;int&gt; ç”¨1-10å¡«å……å®ƒ(è°ƒç”¨reserveçš„è§£é‡Šåœ¨æ¡æ¬¾14)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰“å°10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è®¾ç½®3ä¸ªå…ƒç´ ä¸º99
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">remove</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">99</span><span class="p">);</span> <span class="c1">// åˆ é™¤æ‰€æœ‰ç­‰äº99çš„å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="c1">// ä»ç„¶æ˜¯10ï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><font color=blue>removeå¹¶ä¸â€œçœŸçš„â€åˆ é™¤ä¸œè¥¿ï¼Œå› ä¸ºå®ƒåšä¸åˆ°ã€‚</font></p>
<p><strong>removeä¸çŸ¥é“å®ƒè¦ä»å“ªä¸ªå®¹å™¨åˆ é™¤ä¸œè¥¿ï¼Œè€Œæ²¡æœ‰å®¹å™¨ï¼Œå®ƒå°±æ²¡æœ‰åŠæ³•è°ƒç”¨æˆå‘˜å‡½æ•°ã€‚</strong></p>
<h3 id="remove-åšäº†ä»€ä¹ˆ">remove åšäº†ä»€ä¹ˆ</h3>
<p>removeç§»åŠ¨æŒ‡å®šåŒºé—´ä¸­çš„å…ƒç´ ç›´åˆ°æ‰€æœ‰â€œä¸åˆ é™¤çš„â€å…ƒç´ åœ¨åŒºé—´çš„å¼€å¤´(ç›¸å¯¹ä½ç½®å’ŒåŸæ¥å®ƒä»¬çš„ä¸€æ ·)ã€‚å®ƒè¿”å›ä¸€ä¸ªæŒ‡å‘æœ€åä¸€ä¸ªçš„ä¸‹ä¸€ä¸ªâ€œä¸åˆ é™¤çš„â€å…ƒç´ çš„è¿­ä»£å™¨ã€‚è¿”å›å€¼æ˜¯åŒºé—´çš„â€œæ–°é€»è¾‘ç»ˆç‚¹â€ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œè¿™æ˜¯våœ¨è°ƒç”¨removeå‰çœ‹èµ·æ¥çš„æ ·å­ï¼š</p>
<p></p>
<p>å¦‚æœæˆ‘ä»¬æŠŠremoveçš„è¿”å›å€¼å­˜æ”¾åœ¨ä¸€ä¸ªå«åšnewEndçš„æ–°è¿­ä»£å™¨ä¸­:</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">newEnd</span><span class="p">(</span><span class="n">remove</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">99</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ˜¯è°ƒç”¨åvçœ‹èµ·æ¥çš„æ ·å­:</p>
<p></p>
<p>å¦‚æœâ€œä¸åˆ é™¤çš„â€å…ƒç´ åœ¨vä¸­çš„v.begin()å’ŒnewEndä¹‹é—´ï¼Œâ€œåˆ é™¤çš„â€å…ƒç´ å°±å¿…é¡»åœ¨newEndå’Œv.end()ä¹‹é—´ã€‚</p>
<p><strong>removeå¹¶æ²¡æœ‰æ”¹å˜åŒºé—´ä¸­å…ƒç´ çš„é¡ºåºï¼Œæ‰€ä»¥ä¸ä¼šæŠŠæ‰€æœ‰â€œåˆ é™¤çš„â€å…ƒç´ æ”¾åœ¨ç»“å°¾ï¼Œå¹¶å®‰æ’æ‰€æœ‰â€œä¸åˆ é™¤çš„â€å€¼åœ¨å¼€å¤´ã€‚</strong></p>
<p>å¦‚æœä½ ä¸æƒ³å¤±å»ä»»ä½•å€¼ï¼Œä½ å¯èƒ½åº”è¯¥è°ƒç”¨partitionæˆ–stable_partitionè€Œä¸æ˜¯removeã€‚</p>
<h3 id="remove-å®é™…æ“ä½œæµç¨‹">remove å®é™…æ“ä½œæµç¨‹</h3>
<p>åœ¨å†…éƒ¨ï¼Œremoveéå†è¿™ä¸ªåŒºé—´ï¼ŒæŠŠè¦â€œåˆ é™¤çš„â€å€¼è¦†ç›–ä¸ºåé¢è¦ä¿ç•™çš„å€¼ã€‚è¿™ä¸ªè¦†ç›–é€šè¿‡å¯¹æŒæœ‰è¢«è¦†ç›–çš„å€¼çš„å…ƒç´ èµ‹å€¼æ¥å®Œæˆã€‚</p>
<ol>
<li>removeæ£€æµ‹v[0]ï¼Œå‘ç°å®ƒçš„å€¼ä¸æ˜¯è¦è¢«åˆ é™¤çš„ï¼Œç„¶åç§»åŠ¨åˆ°v[1]ã€‚åŒæ ·çš„æƒ…å†µå‘ç”Ÿåœ¨v[1]å’Œv[2]ã€‚</li>
<li>å‘ç°v[3]åº”è¯¥è¢«åˆ é™¤ï¼Œæ‰€ä»¥å®ƒè®°å½•ä¸‹v[3]çš„å€¼åº”è¯¥è¢«è¦†ç›–ï¼Œç„¶åå®ƒç§»åŠ¨åˆ°v[4]ã€‚è¿™ç±»ä¼¼è®°å½•v[3]æ˜¯ä¸€ä¸ªéœ€è¦å¡«å……çš„â€œæ´â€ã€‚</li>
<li>å‘ç°v[4]çš„å€¼åº”è¯¥è¢«ä¿æŒï¼Œæ‰€ä»¥å®ƒæŠŠv[4]èµ‹ç»™v[3]ï¼Œè®°å½•ä¸‹v[4]åº”è¯¥è¢«è¦†ç›–ï¼Œç„¶åç§»åŠ¨åˆ°v[5]ã€‚ç»§ç»­ç±»ä¼¼çš„å‹ç¼©ï¼Œå®ƒç”¨v[4]â€œå¡«å……â€v[3]è€Œä¸”è®°å½•v[4]ç°åœ¨æ˜¯ä¸€ä¸ªæ´ã€‚</li>
<li>å‘ç°v[5]åº”è¯¥è¢«åˆ é™¤ï¼Œæ‰€ä»¥å¿½ç•¥å¹¶å®ƒç§»åŠ¨åˆ°v[6]ã€‚ä»ç„¶è®°å¾—v[4]æ˜¯ä¸€ä¸ªç­‰å¾…å¡«å……çš„æ´ã€‚</li>
<li>å‘ç°v[6]æ˜¯ä¸€ä¸ªåº”è¯¥ä¿ç•™çš„å€¼ï¼Œæ‰€ä»¥æŠŠv[6]èµ‹ç»™v[4]ã€‚è®°å¾—v[5]ç°åœ¨æ˜¯ä¸‹ä¸€ä¸ªè¦è¢«å¡«å……çš„æ´ï¼Œç„¶åç§»åˆ°v[7]ã€‚</li>
<li>åœ¨æŸç§æ„ä¹‰ä¸Šç±»ä¼¼ä¸Šé¢çš„ï¼Œæ£€æŸ¥v[7]ã€v[8]å’Œv[9]ã€‚æŠŠv[7]èµ‹ç»™v[5]ï¼Œv[8]èµ‹ç»™v[6]ï¼Œå¿½ç•¥v[9]ï¼Œå› ä¸ºv[9]çš„å€¼æ˜¯è¦è¢«åˆ é™¤çš„ã€‚</li>
<li>è¿”å›æŒ‡å®šä¸‹ä¸€ä¸ªè¦è¢«è¦†ç›–çš„å…ƒç´ çš„è¿­ä»£å™¨ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­è¿™ä¸ªå…ƒç´ æ˜¯v[7]ã€‚</li>
</ol>
<p></p>
<p>äº‹å®ä¸Šå½“removeåœ¨åˆ é™¤æ—¶è¦†ç›–çš„å€¼æ˜¯æŒ‡é’ˆæ—¶ï¼Œä¼šæœ‰é‡è¦çš„å½±å“ã€‚ä½†æ˜¯å¯¹äºæœ¬æ¡æ¬¾ï¼ŒçŸ¥é“removeä¸ä»å®¹å™¨ä¸­é™¤å»ä»»ä½•å…ƒç´ å› ä¸ºå®ƒåšä¸åˆ°å°±å¤Ÿäº†ã€‚</p>
<h2 id="åº”è¯¥åœ¨removeåé¢æ¥ä¸Šerase">åº”è¯¥åœ¨removeåé¢æ¥ä¸Šerase</h2>
<p>åªæœ‰å®¹å™¨æˆå‘˜å‡½æ•°å¯ä»¥é™¤å»å®¹å™¨å…ƒç´ ï¼Œè€Œé‚£æ˜¯æœ¬æ¡æ¬¾çš„æ•´ä¸ªè¦ç‚¹ï¼š<strong>å¦‚æœä½ çœŸçš„è¦åˆ é™¤ä¸œè¥¿çš„è¯ï¼Œä½ åº”è¯¥åœ¨removeåé¢æ¥ä¸Šerase</strong>ã€‚</p>
<p>è¦é™¤å»é‚£äº›å…ƒç´ ï¼Œä½ è¦åšçš„æ‰€æœ‰äº‹æƒ…å°±æ˜¯ç”¨é‚£ä¸¤ä¸ªè¿­ä»£å™¨è°ƒç”¨eraseçš„åŒºé—´å½¢å¼ã€‚å› ä¸ºremoveæœ¬èº«å¾ˆæ–¹ä¾¿åœ°è¿”å›äº†åŒºé—´æ–°é€»è¾‘ç»ˆç‚¹çš„è¿­ä»£å™¨:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ­£å¦‚ä»å‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">remove</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">99</span><span class="p">),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// çœŸçš„åˆ é™¤æ‰€æœ‰ç­‰äº99çš„å…ƒç´ ï¼Œç°åœ¨è¿”å›7
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>äº‹å®ä¸Šï¼Œremoveå’Œeraseæ˜¯äº²å¯†è”ç›Ÿï¼Œè¿™ä¸¤ä¸ªæ•´åˆåˆ°listæˆå‘˜å‡½æ•°removeä¸­ã€‚è¿™æ˜¯STLä¸­å”¯ä¸€åå«removeåˆèƒ½ä»å®¹å™¨ä¸­é™¤å»å…ƒç´ çš„å‡½æ•°ï¼š</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">li</span><span class="p">;</span>  <span class="c1">// å»ºç«‹ä¸€ä¸ªlistæ”¾ä¸€äº›å€¼è¿›å»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">li</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">99</span><span class="p">);</span> <span class="c1">// é™¤å»æ‰€æœ‰ç­‰äº99çš„å…ƒç´ ï¼šçœŸçš„åˆ é™¤å…ƒç´ ï¼Œæ‰€ä»¥å®ƒçš„å¤§å°å¯èƒ½æ”¹å˜äº†
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨è¿™ä¸ªremoveå‡½æ•°æ˜¯ä¸€ä¸ªSTLä¸­çš„çŸ›ç›¾ã€‚åœ¨å…³è”å®¹å™¨ä¸­ç±»ä¼¼çš„å‡½æ•°å«eraseï¼Œlistçš„removeä¹Ÿå¯ä»¥å«åšeraseã€‚ä½†å®ƒæ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éƒ½å¿…é¡»ä¹ æƒ¯å®ƒã€‚</p>
<p><strong>å¯¹äºlistï¼Œè°ƒç”¨removeæˆå‘˜å‡½æ•°æ¯”åº”ç”¨erase-removeæƒ¯ç”¨æ³•æ›´é«˜æ•ˆã€‚</strong></p>
<h2 id="ç±»ä¼¼removeçš„ç®—æ³•">ç±»ä¼¼removeçš„ç®—æ³•</h2>
<p><code>remove_if</code>å’Œ<code>unique</code>ã€‚ removeå’Œremove_ifä¹‹é—´çš„ç›¸ä¼¼æ€§å¾ˆç›´æˆªäº†å½“ã€‚</p>
<p>uniqueè¡Œä¸ºä¹Ÿåƒremoveã€‚å®ƒç”¨æ¥ä»ä¸€ä¸ªåŒºé—´åˆ é™¤ä¸œè¥¿(é‚»è¿‘çš„é‡å¤å€¼)è€Œä¸ç”¨è®¿é—®æŒæœ‰åŒºé—´å…ƒç´ çš„å®¹å™¨ã€‚å¦‚æœä½ çœŸçš„è¦ä»å®¹å™¨ä¸­åˆ é™¤å…ƒç´ ï¼Œä½ ä¹Ÿå¿…é¡»æˆå¯¹è°ƒç”¨uniqueå’Œeraseï¼Œuniqueåœ¨listä¸­ä¹Ÿç±»ä¼¼äºremoveã€‚æ­£åƒlist::removeçœŸçš„åˆ é™¤ä¸œè¥¿(è€Œä¸”æ¯”erase-removeæƒ¯ç”¨æ³•é«˜æ•ˆå¾—å¤š)ã€‚</p>
<p><code>list::unique</code>ä¹ŸçœŸçš„åˆ é™¤é‚»è¿‘çš„é‡å¤å€¼(ä¹Ÿæ¯”erase-uniqueé«˜æ•ˆ)ã€‚</p>
]]></description></item><item><title>Effective STL [31] | äº†è§£ä½ çš„æ’åºé€‰æ‹©</title><link>https://jianye0428.github.io/posts/clause_31/</link><pubDate>Sat, 26 Aug 2023 10:19:35 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_31/</guid><description><![CDATA[<h2 id="ç¨³å®šæ’åº-vs-ä¸ç¨³å®šæ’åº">ç¨³å®šæ’åº VS ä¸ç¨³å®šæ’åº</h2>
<p>æœ‰äº›æ’åºç®—æ³•æ˜¯ç¨³å®šçš„ã€‚åœ¨ç¨³å®šæ’åºä¸­ï¼Œå¦‚æœä¸€ä¸ªåŒºé—´ä¸­çš„ä¸¤ä¸ªå…ƒç´ æœ‰ç­‰ä»·çš„å€¼ï¼Œå®ƒä»¬çš„ç›¸å¯¹ä½ç½®åœ¨æ’åºåä¸æ”¹å˜ã€‚ä¸ç¨³å®šçš„ç®—æ³•æ²¡åšè¿™ä¸ªä¿è¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ï¼ˆæœªæ’åºçš„ï¼‰widgets vectorä¸­Widget Aåœ¨Widget Bä¹‹å‰ï¼Œè€Œä¸”ä¸¤è€…éƒ½æœ‰ç›¸åŒçš„è´¨é‡ç­‰çº§ï¼Œé‚£ä¹ˆç¨³å®šæ’åºç®—æ³•ä¼šä¿è¯åœ¨è¿™ä¸ªvectoræ’åºåï¼ŒWidget Aä»ç„¶åœ¨Widget Bä¹‹å‰ã€‚</p>
<h2 id="partial_sort"><code>partial_sort</code></h2>
<p>sortæ˜¯ä¸ªä»¤äººç§°èµçš„ç®—æ³•ï¼Œå¦‚æœä¸éœ€è¦å®Œå…¨æ’åºæ—¶ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªå­˜æœ‰Widget çš„vectorï¼Œä½ æƒ³é€‰æ‹©20ä¸ªè´¨é‡æœ€é«˜çš„Widgetå‘é€ç»™å®¢æˆ·ï¼Œ20ä¸ªä¹‹å¤–çš„Widgetå¯ä»¥ä¿æŒæ— åºï¼Œä¹Ÿå°±æ˜¯ä½ éœ€è¦çš„æ˜¯éƒ¨åˆ†æ’åºï¼Œè¿™æ—¶å°±å¯ä»¥ç”¨partial_sortã€‚</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">qualityCompare</span><span class="p">(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¿”å›lhsçš„è´¨é‡æ˜¯ä¸æ˜¯æ¯”rhsçš„è´¨é‡å¥½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠæœ€å¥½çš„20ä¸ªå…ƒç´ ï¼ˆæŒ‰é¡ºåºï¼‰æ”¾åœ¨widgetsçš„å‰ç«¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">partial_sort</span><span class="p">(</span><span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">widgets</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">qualityCompare</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨widgets...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨å®Œpartial_sortåï¼Œwidgetsçš„å‰20ä¸ªå…ƒç´ æ˜¯å®¹å™¨ä¸­æœ€å¥½çš„è€Œä¸”å®ƒä»¬æŒ‰é¡ºåºæ’åˆ—ï¼Œè´¨é‡æœ€é«˜çš„Widgetæ˜¯widgets[0]ï¼Œç¬¬äºŒé«˜çš„æ˜¯widgets[1]ç­‰ã€‚</p>
<p>partial_sortæ˜¯ä¸ç¨³å®šçš„ã€‚</p>
<h2 id="nth_element">nth_element</h2>
<p>å¦‚æœä½ ä¸å…³å¿ƒå“ªä¸ªWidgetç»™å“ªä¸ªå®¢æˆ·ï¼Œä½ éœ€è¦çš„åªæ˜¯ä»»æ„é¡ºåºçš„20ä¸ªæœ€å¥½çš„Widgetã€‚STLä¸­nth_elementå¯ä»¥ç²¾ç¡®åœ°å®Œæˆäº†ä½ éœ€è¦çš„ã€‚</p>
<p>nth_elementæ’åºä¸€ä¸ªåŒºé—´ï¼Œåœ¨nä½ç½®ï¼ˆä½ æŒ‡å®šçš„ï¼‰çš„å…ƒç´ æ˜¯å¦‚æœåŒºé—´è¢«å®Œå…¨æ’åºåä¼šå‡ºç°åœ¨é‚£å„¿çš„å…ƒç´ ã€‚</p>
<p><strong>Example</strong></p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">randy</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="c1">//é»˜è®¤æ±‚ç¬¬må¤§çš„å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">nth_element</span><span class="p">(</span><span class="n">randy</span><span class="p">,</span> <span class="n">randy</span><span class="o">+</span><span class="n">m</span><span class="p">,</span> <span class="n">randy</span><span class="o">+</span><span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//å®šä¹‰cmpå¯æ±‚ç¬¬må°çš„å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="nf">cmp</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">){</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="n">a</span><span class="o">&gt;</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">nth_element</span><span class="p">(</span><span class="n">randy</span><span class="p">,</span> <span class="n">randy</span><span class="o">+</span><span class="n">m</span><span class="p">,</span> <span class="n">randy</span><span class="o">+</span><span class="n">n</span><span class="p">,</span> <span class="n">cmp</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å‡½æ•°æ˜¯å°†ç¬¬ m å¤§çš„å…ƒç´ æ”¾åœ¨ arr æ•°ç»„æ•°ç»„ä¸­é€‚å½“ä½ç½®ï¼Œå…¶ä»–å…ƒç´ æŒ‰ç…§ç¬¬ m å…ƒç´ çš„å¤§å°åˆ’åˆ†ã€‚ åœ¨[ 0, n ]è¿™ä¸ªèŒƒå›´å†…ï¼Œåœ¨ç¬¬ m ä¸ªå…ƒç´ ä¹‹å‰çš„å…ƒç´ éƒ½å°äºæˆ–ç­‰äºç¬¬ m ä¸ªå…ƒç´ ï¼Œè€Œä¸”ç¬¬ m ä¸ªå…ƒç´ åé¢çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šæ¯”å®ƒå¤§ã€‚</p>
<p><code>nth_element()</code>å‡½æ•°ä»…å°†ç¬¬ m å¤§/å°çš„æ•°åœ¨ randy æ•°ç»„ä¸­æ’å¥½äº†ä½ç½®ï¼Œå¹¶ä¸è¿”å›å€¼ã€‚è¾“å‡º randy[m] å³æ˜¯ç¬¬ m å¤§/å°çš„æ•°ã€‚</p>
<p><strong>æ’åºWidgetæ•°ç»„</strong></p>
<p>ä½¿ç”¨nth_elementæ¥ä¿è¯æœ€å¥½çš„20ä¸ªWidgetåœ¨widgets vectorçš„å‰ç«¯ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">nth_element</span><span class="p">(</span><span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">19</span><span class="p">,</span> <span class="n">widgets</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">qualityCompare</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠæœ€å¥½çš„20ä¸ªå…ƒç´ æ”¾åœ¨widgetså‰ç«¯ï¼Œä½†ä¸ç”¨æ‹…å¿ƒå®ƒä»¬çš„é¡ºåº
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨nth_elementæœ¬è´¨ä¸Šç­‰ä»·äºè°ƒç”¨partial_sortï¼Œä¸¤ä¸ªç®—æ³•éƒ½æŠŠ20ä¸ªè´¨é‡æœ€é«˜çš„Widgetç§»åŠ¨åˆ°vectorå‰ç«¯ã€‚</p>
<p>å®ƒä»¬ç»“æœçš„å”¯ä¸€åŒºåˆ«æ˜¯partial_sortæ’åºäº†åœ¨ä½ç½®1-20çš„å…ƒç´ ï¼Œè€Œnth_elementä¸æ’åºã€‚</p>
<p><strong>å…¶ä»–ç”¨æ³•</strong></p>
<p>é™¤äº†èƒ½å¸®ä½ æ‰¾åˆ°åŒºé—´é¡¶éƒ¨çš„nä¸ªå…ƒç´ ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨äºæ‰¾åˆ°åŒºé—´çš„ä¸­å€¼æˆ–è€…æ‰¾åˆ°åœ¨æŒ‡å®šç™¾åˆ†ç‚¹çš„å…ƒç´ ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// è¿­ä»£å™¨çš„å˜é‡æ–¹ä¾¿åœ°è¡¨ç¤ºwidgetsçš„èµ·ç‚¹å’Œç»ˆç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">begin</span><span class="p">(</span><span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">end</span><span class="p">(</span><span class="n">widgets</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è¿™ä¸ªè¿­ä»£å™¨æŒ‡ç¤ºäº†ä¸‹é¢ä»£ç è¦æ‰¾çš„ä¸­ç­‰è´¨é‡ç­‰çº§çš„Widgetçš„ä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">goalPosition</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å…´è¶£çš„Widgetä¼šæ˜¯æœ‰åºçš„vectorçš„ä¸­é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">goalPosition</span> <span class="o">=</span> <span class="n">begin</span> <span class="o">+</span> <span class="n">widgets</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰¾åˆ°widgetsä¸­ä¸­ç­‰è´¨é‡ç­‰çº§çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">nth_element</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">goalPosition</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">qualityCompare</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// goalPositionç°åœ¨æŒ‡å‘ä¸­ç­‰è´¨é‡ç­‰çº§çš„Widget
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸‹é¢çš„ä»£ç èƒ½æ‰¾åˆ°è´¨é‡ç­‰çº§ä¸º75%çš„Widget
</span></span></span><span class="line"><span class="cl"><span class="c1">// æŒ‡å‡ºå…´è¶£çš„Widgetç¦»å¼€å§‹æœ‰å¤šè¿œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">size_type</span> <span class="n">goalOffset</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">widgets</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰¾åˆ°è´¨é‡å€¼ä¸º75%çš„Widget
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">nth_element</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">begin</span> <span class="o">+</span> <span class="n">goalOffset</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">qualityCompare</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// begin + goalOffsetç°åœ¨æŒ‡å‘è´¨é‡ç­‰çº§ä¸º75%çš„Widget
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…ƒç´ æœ‰åŒæ ·è´¨é‡">å…ƒç´ æœ‰åŒæ ·è´¨é‡</h2>
<p>å‡è®¾æœ‰12ä¸ªå…ƒç´ è´¨é‡æ˜¯1çº§ï¼ˆå¯èƒ½æ˜¯æœ€å¥½çš„ï¼‰ï¼Œ15ä¸ªå…ƒç´ è´¨é‡æ˜¯2çº§ï¼ˆç¬¬äºŒå¥½çš„ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€‰æ‹©20ä¸ªæœ€å¥½çš„Widgetå°±æ˜¯é€‰æ‹©12ä¸ª1çº§çš„å’Œ15ä¸ªä¸­çš„8ä¸ª2çº§çš„ã€‚partial_sortå’Œnth_elementæ€ä¹ˆåˆ¤æ–­15ä¸ªä¸­çš„å“ªäº›è¦æ”¾åˆ°æœ€å¥½çš„20ä¸ªä¸­ï¼Ÿå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå½“å¤šä¸ªå…ƒç´ æœ‰ç­‰ä»·çš„å€¼æ—¶sortæ€ä¹ˆåˆ¤æ–­å…ƒç´ çš„é¡ºåºï¼Ÿ</p>
<p>partial_sortå’Œnth_elementä»¥ä»»ä½•å®ƒä»¬å–œæ¬¢çš„æ–¹å¼æ’åºå€¼ç­‰ä»·çš„å…ƒç´ ï¼Œè€Œä¸”ä½ ä¸èƒ½æ§åˆ¶å®ƒä»¬åœ¨è¿™æ–¹é¢è¡Œä¸ºã€‚</p>
<p>nth_elementã€sortä¹Ÿæ²¡æœ‰æä¾›ç¨³å®šæ€§ã€‚</p>
<h2 id="stable_sort">stable_sort</h2>
<p>stable_sort æ˜¯ç¨³å®šæ’åºï¼ŒSTLå¹¶ä¸åŒ…å«partial_sortå’Œnth_elementçš„ç¨³å®šç‰ˆæœ¬ã€‚</p>
<p>å½“æŒ‡å®šèŒƒå›´å†…åŒ…å«å¤šä¸ªç›¸ç­‰çš„å…ƒç´ æ—¶ï¼Œsort() æ’åºå‡½æ•°æ— æ³•ä¿è¯ä¸æ”¹å˜å®ƒä»¬çš„ç›¸å¯¹ä½ç½®ã€‚é‚£ä¹ˆï¼Œå¦‚æœæ—¢è¦å®Œæˆæ’åºåˆè¦ä¿è¯ç›¸ç­‰å…ƒç´ çš„ç›¸å¯¹ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨stable_sort()å‡½æ•°</p>
<p>stable_sort() å‡½æ•°å®Œå…¨å¯ä»¥çœ‹ä½œæ˜¯ sort() å‡½æ•°åœ¨åŠŸèƒ½æ–¹é¢çš„å‡çº§ç‰ˆã€‚stable_sort() å’Œ sort() å…·æœ‰ç›¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œå°±è¿è¯­æ³•æ ¼å¼ä¹Ÿæ˜¯ç›¸åŒçš„ï¼ˆåç»­ä¼šè®²ï¼‰ï¼Œåªä¸è¿‡å‰è€…åœ¨åŠŸèƒ½ä¸Šé™¤äº†å¯ä»¥å®ç°æ’åºï¼Œè¿˜å¯ä»¥ä¿è¯ä¸æ”¹å˜ç›¸ç­‰å…ƒç´ çš„ç›¸å¯¹ä½ç½®ã€‚</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//å¯¹ [first, last) åŒºåŸŸå†…çš„å…ƒç´ åšé»˜è®¤çš„å‡åºæ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">stable_sort</span> <span class="p">(</span> <span class="n">RandomAccessIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">RandomAccessIterator</span> <span class="n">last</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æŒ‰ç…§æŒ‡å®šçš„ comp æ’åºè§„åˆ™ï¼Œå¯¹ [first, last) åŒºåŸŸå†…çš„å…ƒç´ è¿›è¡Œæ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">stable_sort</span> <span class="p">(</span> <span class="n">RandomAccessIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">RandomAccessIterator</span> <span class="n">last</span><span class="p">,</span> <span class="n">Compare</span> <span class="n">comp</span> <span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;     // std::cout</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;    // std::stable_sort</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;       // std::vector</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">//ä»¥æ™®é€šå‡½æ•°çš„æ–¹å¼å®ç°è‡ªå®šä¹‰æ’åºè§„åˆ™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="nf">randy_comp</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ä»¥å‡½æ•°å¯¹è±¡çš„æ–¹å¼å®ç°è‡ªå®šä¹‰æ’åºè§„åˆ™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">kim_comp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">jeff_num</span><span class="p">{</span><span class="mi">88</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">33</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">stable_sort</span><span class="p">(</span><span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span>  <span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>  <span class="c1">// 2 13 22 88 1 30 3 33
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="c1">//åˆ©ç”¨STLæ ‡å‡†åº“æä¾›greater&lt;T&gt;è¿›è¡Œæ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">stable_sort</span><span class="p">(</span><span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">greater</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span>  <span class="c1">// 88 22 13 2 1 30 3 33
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="c1">//é€šè¿‡è‡ªå®šä¹‰æ¯”è¾ƒè§„åˆ™è¿›è¡Œæ’åº,è¿™é‡Œä¹Ÿå¯ä»¥æ¢æˆ kim_comp()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">stable_sort</span><span class="p">(</span><span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">jeff_num</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">randy_comp</span><span class="p">);</span>  <span class="c1">// 1 2 3 13 22 30 33 88
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">jeff_num</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">jeff_num</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="partition">partition</h2>
<p>ä½†æ˜¯å®Œå…¨æ’åºéœ€è¦å¾ˆå¤šå·¥ä½œï¼Œè€Œä¸”å¯¹äºè¿™ä¸ªä»»åŠ¡åšäº†å¾ˆå¤šä¸å¿…è¦çš„å·¥ä½œã€‚ä¸€ä¸ªæ›´å¥½çš„ç­–ç•¥æ˜¯ä½¿ç”¨partitionç®—æ³•ï¼Œå®ƒé‡æ’åŒºé—´ä¸­çš„å…ƒç´ ä»¥ä½¿æ‰€æœ‰æ»¡è¶³æŸä¸ªæ ‡å‡†çš„å…ƒç´ éƒ½åœ¨åŒºé—´çš„å¼€å¤´ã€‚</p>
<p>æ¯”å¦‚ï¼Œç§»åŠ¨æ‰€æœ‰è´¨é‡ç­‰çº§ä¸º2æˆ–æ›´å¥½çš„Widgetåˆ°widgetså‰ç«¯ï¼š</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">hasAcceptableQuality</span><span class="p">(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">w</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="c1">// è¿”å›wè´¨é‡ç­‰çº§æ˜¯å¦æ˜¯2æˆ–æ›´é«˜;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠæ‰€æœ‰æ»¡è¶³hasAcceptableQualityçš„widgetsç§»åŠ¨åˆ°widgetså‰ç«¯ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¹¶ä¸”è¿”å›ä¸€ä¸ªæŒ‡å‘ç¬¬ä¸€ä¸ªä¸æ»¡è¶³çš„widgetçš„è¿­ä»£å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">goodEnd</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">widgets</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">widgets</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">hasAcceptableQuality</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤è°ƒç”¨å®Œæˆåï¼Œä»widgets.begin()åˆ°goodEndçš„åŒºé—´å®¹çº³äº†æ‰€æœ‰è´¨é‡æ˜¯1æˆ–2çš„Widgetï¼Œä»goodEndåˆ°widgets.end()çš„åŒºé—´åŒ…å«äº†æ‰€æœ‰è´¨é‡ç­‰çº§æ›´ä½çš„Widgetã€‚</p>
<p>å¦‚æœåœ¨åˆ†å‰²æ—¶ä¿æŒåŒæ ·è´¨é‡ç­‰çº§çš„Widgetçš„ç›¸å¯¹ä½ç½®å¾ˆé‡è¦ï¼Œæˆ‘ä»¬è‡ªç„¶ä¼šç”¨stable_partitionæ¥ä»£æ›¿partitionã€‚</p>
<p><strong>listæ’åº</strong></p>
<p>å”¯ä¸€æˆ‘ä»¬å¯èƒ½ä¼šä½†ä¸èƒ½ä½¿ç”¨<code>sort</code>ã€<code>stable_sort</code>ã€<code>partial_sort</code>æˆ–<code>nth_element</code>çš„å®¹å™¨æ˜¯<code>list</code>ï¼Œ<code>list</code>é€šè¿‡æä¾›<code>sort</code>æˆå‘˜å‡½æ•°åšäº†ä¸€äº›è¡¥å¿ã€‚ï¼ˆæœ‰è¶£çš„æ˜¯ï¼Œlist::sortæä¾›äº†<u>ç¨³å®šæ’åº</u>ã€‚ï¼‰</p>
<p>å¦‚æœä½ æƒ³è¦å¯¹listä¸­çš„å¯¹è±¡è¿›è¡Œpartial_sortæˆ–nth_elementï¼Œä½ å¿…é¡»é—´æ¥å®Œæˆï¼š</p>
<ol>
<li>æŠŠå…ƒç´ æ‹·è´åˆ°ä¸€ä¸ªæ”¯æŒéšæœºè®¿é—®è¿­ä»£å™¨çš„å®¹å™¨ä¸­ï¼Œç„¶åå¯¹å®ƒåº”ç”¨éœ€è¦çš„ç®—æ³•;</li>
<li>å»ºç«‹ä¸€ä¸ªlist::iteratorçš„å®¹å™¨ï¼Œå¯¹é‚£ä¸ªå®¹å™¨ä½¿ç”¨ç®—æ³•ï¼Œç„¶åé€šè¿‡è¿­ä»£å™¨è®¿é—®listå…ƒç´ ;</li>
<li>ä½¿ç”¨æœ‰åºçš„è¿­ä»£å™¨å®¹å™¨çš„ä¿¡æ¯æ¥è¿­ä»£åœ°æŠŠlistçš„å…ƒç´ æ¥åˆåˆ°ä½ æƒ³è®©å®ƒä»¬æ‰€å¤„çš„ä½ç½®ã€‚</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p><strong>ç®—æ³•sortã€stable_sortã€partial_sortå’Œnth_elementéœ€è¦éšæœºè®¿é—®è¿­ä»£å™¨ï¼Œæ‰€ä»¥å®ƒä»¬å¯èƒ½åªèƒ½ç”¨äºvectorã€stringã€dequeå’Œæ•°ç»„ã€‚</strong></p>
<p>å¯¹æ ‡å‡†å…³è”å®¹å™¨æ’åºå…ƒç´ æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºè¿™æ ·çš„å®¹å™¨ä½¿ç”¨å®ƒä»¬çš„æ¯”è¾ƒå‡½æ•°æ¥åœ¨ä»»ä½•æ—¶å€™ä¿æŒæœ‰åºã€‚</p>
<p>partitionå’Œstable_partitionä¸sortã€stable_sortã€partial_sortå’Œnth_elementä¸åŒï¼Œå®ƒä»¬åªéœ€è¦åŒå‘è¿­ä»£å™¨ã€‚å› æ­¤ä½ å¯ä»¥åœ¨ä»»ä½•æ ‡å‡†åºåˆ—è¿­ä»£å™¨ä¸Šä½¿ç”¨partitionå’Œstable_partitionã€‚</p>
<ol>
<li>å¦‚æœéœ€è¦åœ¨vectorã€stringã€dequeæˆ–æ•°ç»„ä¸Šè¿›è¡Œ<strong>å®Œå…¨æ’åº</strong>ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>sort</code>æˆ–<code>stable_sort</code>ã€‚</li>
<li>å¦‚æœä½ æœ‰ä¸€ä¸ªvectorã€stringã€dequeæˆ–æ•°ç»„ï¼Œ<strong>åªéœ€è¦æ’åºå‰nä¸ªå…ƒç´ </strong>ï¼Œåº”è¯¥ç”¨<code>partial_sort</code>ã€‚</li>
<li>å¦‚æœä½ æœ‰ä¸€ä¸ªvectorã€stringã€dequeæˆ–æ•°ç»„ï¼Œ<strong>éœ€è¦é‰´åˆ«å‡ºç¬¬nä¸ªå…ƒç´ æˆ–ä½ éœ€è¦é‰´åˆ«å‡ºæœ€å‰çš„nä¸ªå…ƒç´ ï¼Œè€Œä¸ç”¨çŸ¥é“å®ƒä»¬çš„é¡ºåº</strong>ï¼Œnth_elementæ˜¯ä½ åº”è¯¥æ³¨æ„å’Œè°ƒç”¨çš„ã€‚</li>
<li>å¦‚æœä½ éœ€è¦<strong>æŠŠæ ‡å‡†åºåˆ—å®¹å™¨çš„å…ƒç´ æˆ–æ•°ç»„åˆ†éš”ä¸ºæ»¡è¶³å’Œä¸æ»¡è¶³æŸä¸ªæ ‡å‡†</strong>ï¼Œä½ å¤§æ¦‚å°±è¦æ‰¾partitionæˆ–stable_partitionã€‚</li>
<li>å¦‚æœä½ çš„æ•°æ®æ˜¯åœ¨listä¸­ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨partitionå’Œstable_partitionï¼Œä½ å¯ä»¥ä½¿ç”¨listçš„sortæ¥ä»£æ›¿sortå’Œstable_sortã€‚å¦‚æœä½ éœ€è¦partial_sortæˆ–nth_elementæä¾›çš„æ•ˆæœï¼Œä½ å°±å¿…é¡»é—´æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚</li>
</ol>
<p>ä½ å¯ä»¥é€šè¿‡æŠŠæ•°æ®æ”¾åœ¨æ ‡å‡†å…³è”å®¹å™¨ä¸­çš„æ–¹æ³•ä»¥<strong>ä¿æŒåœ¨ä»»ä½•æ—¶å€™ä¸œè¥¿éƒ½æœ‰åº</strong>ã€‚ä½ ä¹Ÿå¯èƒ½ä¼šè€ƒè™‘æ ‡å‡†éSTLå®¹å™¨priority_queueï¼Œå®ƒä¹Ÿå¯ä»¥æ€»æ˜¯ä¿æŒå®ƒçš„å…ƒç´ æœ‰åºã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œ<font color=blue>åšæ›´å¤šå·¥ä½œçš„ç®—æ³•æ¯”åšå¾—å°‘çš„è¦èŠ±æ›´é•¿æ—¶é—´ï¼Œè€Œå¿…é¡»ç¨³å®šæ’åºçš„ç®—æ³•æ¯”å¿½ç•¥ç¨³å®šæ€§çš„ç®—æ³•è¦èŠ±æ›´é•¿æ—¶é—´</font>ã€‚</p>
<p>æœ¬èŠ‚è®¨è®ºçš„ç®—æ³•éœ€è¦æ›´å°‘èµ„æºï¼ˆæ—¶é—´å’Œç©ºé—´ï¼‰çš„ç®—æ³•æ’åºï¼š</p>
<ol>
<li>partition</li>
<li>partial_sort</li>
<li>stable_partition</li>
<li>sort</li>
<li>nth_element</li>
<li>stable_sort</li>
</ol>
]]></description></item><item><title>Effective STL ç²¾åº¦æ€»ç»“ [6] | ä»¿å‡½æ•°ã€ä»¿å‡½æ•°ç±»ã€å‡½æ•°ç­‰</title><link>https://jianye0428.github.io/posts/partsix/</link><pubDate>Tue, 22 Aug 2023 19:22:49 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/partsix/</guid><description><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1>
<blockquote>
<p>Effective-STLæ€»ç»“ç³»åˆ—åˆ†ä¸ºä¸ƒéƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬å…­éƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬å…­ç« ï¼Œå†…å®¹èŒƒå›´Rule38~42ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule38ç®€å†™ä¸ºR38ã€‚</p>
</blockquote>
<div class="details admonition Note">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Effective-STLç³»åˆ—List<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partone/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/parttwo/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partthree/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partfour/"target="_blank" rel="external nofollow noopener noreferrer">Effective STL(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></div>
    </div>
  </div>
<h2 id="r38-éµå¾ªæŒ‰å€¼ä¼ é€’çš„åŸåˆ™æ¥è®¾è®¡å‡½æ•°å­ç±»">R38: éµå¾ªæŒ‰å€¼ä¼ é€’çš„åŸåˆ™æ¥è®¾è®¡å‡½æ•°å­ç±»</h2>
<p>å‡½æ•°æŒ‡é’ˆæ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚</p>
<p>å‡½æ•°å¯¹è±¡å¾€å¾€æŒ‰å€¼ä¼ é€’å’Œè¿”å›ã€‚æ‰€ä»¥ï¼Œç¼–å†™çš„å‡½æ•°å¯¹è±¡å¿…é¡»å°½å¯èƒ½åœ°å°å·§ï¼Œå¦åˆ™å¤åˆ¶çš„å¼€é”€å¤§ï¼›å‡½æ•°å¯¹è±¡å¿…é¡»æ˜¯<strong>å•æ€</strong>çš„(ä¸æ˜¯å¤šæ€)ï¼Œä¸å¾—ä½¿ç”¨è™šå‡½æ•°ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›åˆ›å»ºä¸€ä¸ªåŒ…å«å¤§é‡æ•°æ®å¹¶ä¸”ä½¿ç”¨äº†å¤šæ€æ€§çš„å‡½æ•°å­ç±»ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BPFCImpl</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="n">unary_function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">void</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Widget</span> <span class="n">w</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">...</span>
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="o">~</span><span class="n">BPFCImpl</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">operator</span><span class="p">()</span> <span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">friend</span> <span class="k">class</span> <span class="nc">BPFC</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>					<span class="c1">// å…è®¸BPFCè®¿é—®å†…éƒ¨æ•°æ®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BPFC</span><span class="o">:</span>								<span class="c1">// æ–°çš„BPFCç±»ï¼šçŸ­å°ã€å•æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">public</span> <span class="n">unary_function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">void</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">BPFCImpl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pImpl</span><span class="p">;</span>					<span class="c1">// BPFCå”¯ä¸€çš„æ•°æ®æˆå‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="k">const</span>	<span class="c1">// ç°åœ¨è¿™æ˜¯ä¸€ä¸ªéè™šå‡½æ•°ï¼Œå°†è°ƒç”¨è½¬åˆ°BPFCImplä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">pImpl</span><span class="o">-&gt;</span><span class="k">operator</span><span class="p">()(</span><span class="n">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆä½ åº”è¯¥åˆ›å»ºä¸€ä¸ªå°å·§ã€å•æ€çš„ç±»ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å¦ä¸€ä¸ªå®ç°ç±»ï¼Œå¹¶ä¸”å°†æ‰€æœ‰çš„æ•°æ®å’Œè™šå‡½æ•°éƒ½æ”¾åœ¨å®ç°ç±»ä¸­(â€œPimpl Idiomâ€)ã€‚</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BPFCImpl</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="n">unary_function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">void</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Widget</span> <span class="n">w</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">...</span>
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="o">~</span><span class="n">BPFCImpl</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">operator</span><span class="p">()</span> <span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">friend</span> <span class="k">class</span> <span class="nc">BPFC</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>					<span class="c1">// å…è®¸BPFCè®¿é—®å†…éƒ¨æ•°æ®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BPFC</span><span class="o">:</span>								<span class="c1">// æ–°çš„BPFCç±»ï¼šçŸ­å°ã€å•æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">public</span> <span class="n">unary_function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">void</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">BPFCImpl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pImpl</span><span class="p">;</span>					<span class="c1">// BPFCå”¯ä¸€çš„æ•°æ®æˆå‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="k">const</span>	<span class="c1">// ç°åœ¨è¿™æ˜¯ä¸€ä¸ªéè™šå‡½æ•°ï¼Œå°†è°ƒç”¨è½¬åˆ°BPFCImplä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">pImpl</span><span class="o">-&gt;</span><span class="k">operator</span><span class="p">()(</span><span class="n">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="r39-ç¡®ä¿åˆ¤åˆ«å¼æ˜¯-çº¯å‡½æ•°">R39 ç¡®ä¿åˆ¤åˆ«å¼æ˜¯ â€œçº¯å‡½æ•°â€</h2>
<p><strong>åˆ¤åˆ«å¼(predicate)ï¼šä¸€ä¸ªè¿”å›å€¼ä¸º bool ç±»å‹çš„å‡½æ•°ã€‚</strong></p>
<p><strong>çº¯å‡½æ•°ï¼šæŒ‡è¿”å›å€¼ä»…ä»…ä¾èµ–äºå…¶å‚æ•°çš„å‡½æ•°ã€‚</strong></p>
<p>åˆ¤åˆ«å¼ç±»(predicate class)ï¼šä¸€ä¸ªå‡½æ•°å­ç±»ï¼Œå®ƒçš„ operator() å‡½æ•°æ˜¯ä¸€ä¸ªåˆ¤åˆ«å¼(è¿”å› true æˆ– false)ã€‚</p>
<p>STL ä¸­å‡¡æ˜¯å¯ä»¥æ¥å—ä¸€ä¸ªåˆ¤åˆ«å¼ç±»å¯¹è±¡çš„åœ°æ–¹ï¼Œä¹Ÿå°±å¯ä»¥æ¥å—ä¸€ä¸ªåˆ¤åˆ«å¼å‡½æ•°ã€‚</p>
<p>åˆ¤åˆ«å¼åº”è¯¥æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œè€Œçº¯å‡½æ•°åº”è¯¥æ²¡æœ‰çŠ¶æ€ã€‚</p>
<h2 id="r40-ä½¿ä»¿å‡½æ•°ç±»å¯é€‚é…">R40 ä½¿ä»¿å‡½æ•°ç±»å¯é€‚é…</h2>
<p>å¯¹å‡½æ•°æŒ‡é’ˆï¼Œè¦å…ˆåº”ç”¨<code>ptr_fun</code>ä¹‹åå†åº”ç”¨<code>not1</code>ä¹‹åæ‰å¯ä»¥å·¥ä½œã€‚</p>
<p>4 ä¸ªæ ‡å‡†çš„å‡½æ•°é…æ¥å™¨(<code>not1</code>ã€<code>not2</code>ã€<code>bind1st</code>ã€<code>bind2nd</code>)éƒ½è¦æ±‚ä¸€äº›ç‰¹æ®Šçš„ç±»å‹å®šä¹‰ï¼Œæä¾›è¿™äº›å¿…è¦ç±»å‹å®šä¹‰(<code>argument_type</code>ã€<code>first_argument_type</code>ã€<code>second_argument_type</code>ã€<code>result_type</code>)çš„å‡½æ•°å¯¹è±¡è¢«ç§°ä¸ºå¯é…æ¥(å¯é€‚é…)(<code>adaptable</code>)çš„å‡½æ•°å¯¹è±¡ã€‚</p>
<p>æä¾›è¿™äº›ç±»å‹å®šä¹‰æœ€ç®€å•çš„æ–¹æ³•ï¼šè®©å‡½æ•°å­ä»ä¸€ä¸ªåŸºç»“æ„ç»§æ‰¿ã€‚</p>
<ul>
<li>å¯¹äº unary_functionï¼Œå¿…é¡»æŒ‡å®šå‡½æ•°å­ç±» operator() æ‰€å¸¦çš„å‚æ•°ç±»å‹ï¼Œä»¥åŠ operator() è¿”å›ç±»å‹ã€‚</li>
<li>å¯¹äº binary_functionï¼Œå¿…é¡»æŒ‡å®š 3 ä¸ªç±»å‹ï¼šoperator() ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå‚æ•°ç±»å‹ï¼Œä»¥åŠ operator() è¿”å›ç±»å‹ã€‚</li>
</ul>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MeetsThreshold</span><span class="o">:</span> <span class="k">public</span> <span class="n">std</span><span class="o">::</span><span class="n">unary_function</span><span class="o">&lt;</span><span class="n">Widget</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">T</span> <span class="n">threshold</span><span class="p">;</span>						<span class="c1">// åŒ…å«çŠ¶æ€ä¿¡æ¯ï¼Œä½¿ç”¨ç±»å°è£…ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">MeetsThreshold</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">threshold</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">WidgetNameCompare</span><span class="o">:</span>					<span class="c1">// STLä¸­æ‰€æœ‰æ— çŠ¶æ€å‡½æ•°å­ç±»ä¸€èˆ¬éƒ½è¢«å®šä¹‰æˆç»“æ„ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">public</span> <span class="n">std</span><span class="o">::</span><span class="n">binary_function</span><span class="o">&lt;</span><span class="n">Widget</span><span class="p">,</span> <span class="n">Widget</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼ é€’ç»™ binary_function æˆ– unary_function çš„éæŒ‡é’ˆç±»å‹éœ€è¦å»æ‰ const å’Œåº”ç”¨(&amp;)éƒ¨åˆ†ã€‚</p>
<h2 id="r41-ç†è§£-ptr_funmem_fun-å’Œ-mem_fun_ref-çš„æ¥ç”±">R41 ç†è§£ ptr_funã€mem_fun å’Œ mem_fun_ref çš„æ¥ç”±</h2>
<p>STLè¯­æ³•æƒ¯ä¾‹ï¼šå‡½æ•°æˆ–è€…å‡½æ•°å¯¹è±¡è¢«è°ƒç”¨æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨éæˆå‘˜å‡½æ•°çš„è¯­æ³•å½¢å¼ã€‚</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">for_each</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">test</span><span class="p">);</span>					<span class="c1">// è°ƒç”¨1ï¼šf(x)ï¼Œfä¸ºéæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">for_each</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">Widget</span><span class="o">::</span><span class="n">test</span><span class="p">);</span>			<span class="c1">// è°ƒç”¨2ï¼šx.f()ï¼Œfä¸ºæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>														<span class="c1">// xæ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å¯¹è±¡çš„å¼•ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">list</span><span class="o">&lt;</span><span class="n">Widget</span> <span class="o">*&gt;</span> <span class="n">lpw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">for_each</span><span class="p">(</span><span class="n">lpw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">lpw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">Widgettest</span><span class="p">);</span>			<span class="c1">// è°ƒç”¨3ï¼šp-&gt;f()ï¼Œfä¸ºæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>														<span class="c1">// pæ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡xçš„æŒ‡é’ˆã€‚
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>mem_funã€mem_fun_tï¼šmem_fun å°†è¯­æ³• 3 è°ƒæ•´ä¸ºè¯­æ³• 1ã€‚</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">R</span><span class="p">,</span> <span class="k">typename</span> <span class="n">C</span><span class="o">&gt;</span>		<span class="c1">//è¯¥mem_funå£°æ˜é’ˆå¯¹ä¸å¸¦å‚æ•°çš„éconstæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mem_fun_t</span><span class="o">&lt;</span><span class="n">R</span><span class="p">,</span><span class="n">C</span><span class="o">&gt;</span>							<span class="c1">//Cæ˜¯ç±»ï¼ŒRæ˜¯æ‰€æŒ‡å‘çš„æˆå‘˜å‡½æ•°è¿”å›çš„ç±»å‹ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mem_fun</span><span class="p">(</span><span class="n">R</span><span class="p">(</span><span class="n">C</span><span class="o">::*</span><span class="n">pmf</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><p>mem_fun å¸¦ä¸€ä¸ªæŒ‡å‘æŸä¸ªæˆå‘˜å‡½æ•°çš„æŒ‡é’ˆå‚æ•° pmfï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ª mem_fun_t ç±»å‹çš„å¯¹è±¡ã€‚</p>
<p>mem_fun_t æ˜¯ä¸€ä¸ªå‡½æ•°å­ç±»ï¼Œå®ƒæ‹¥æœ‰è¯¥æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆï¼Œå¹¶æä¾›äº† operator() å‡½æ•°ï¼Œåœ¨ operator() ä¸­è°ƒç”¨äº†é€šè¿‡å‚æ•°ä¼ é€’è¿›æ¥çš„å¯¹è±¡ä¸Šçš„è¯¥æˆå‘˜å‡½æ•°ã€‚</p>
<p>ç±»ä¼¼åœ°ï¼Œmem_fun_ref å°†è¯­æ³• 2 è°ƒæ•´ä¸ºè¯­æ³• 1ã€‚</p>
<p><strong>æ€»ç»“:</strong></p>
<ul>
<li>std::ptr_funï¼šå°†å‡½æ•°æŒ‡é’ˆè½¬æ¢ä¸ºå‡½æ•°å¯¹è±¡ã€‚</li>
<li>std::mem_funï¼šå°†æˆå‘˜å‡½æ•°è½¬æ¢ä¸ºå‡½æ•°å¯¹è±¡(æŒ‡é’ˆç‰ˆæœ¬)ã€‚</li>
<li>std::mem_fun_refï¼šå°†æˆå‘˜å‡½æ•°è½¬æ¢ä¸ºå‡½æ•°å¯¹è±¡(å¼•ç”¨ç‰ˆæœ¬)ã€‚</li>
</ul>
<h2 id="r42-ç¡®ä¿lesstä¸operatorå…·æœ‰ç›¸åŒçš„è¯­ä¹‰">R42 ç¡®ä¿less<T>ä¸operator&lt;å…·æœ‰ç›¸åŒçš„è¯­ä¹‰</h2>
<p>å°½é‡é¿å…ä¿®æ”¹ less çš„è¡Œä¸ºï¼Œå¯èƒ½ä¼šè¯¯å¯¼å…¶ä»–ç¨‹åºå‘˜ã€‚</p>
<p>å¦‚æœä½ ä½¿ç”¨äº† lessï¼Œæ— è®ºæ˜¯æ˜¾å¼åœ°è¿˜æ˜¯éšå¼åœ°ï¼Œéƒ½éœ€è¦ç¡®ä¿å®ƒä¸ operator&lt; å…·æœ‰ç›¸åŒçš„æ„ä¹‰ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›ä»¥ä¸€ç§ç‰¹æ®Šçš„æ–¹å¼æ¥æ’åˆ—å¯¹è±¡ï¼Œé‚£ä¹ˆæœ€å¥½åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°å­ç±»ã€‚</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªmultiset<Widget>å®¹å™¨ï¼Œå®ƒé»˜è®¤çš„æ¯”è¾ƒå‡½æ•°æ˜¯less<Widget>ï¼Œè€Œless<Widget>åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šè°ƒç”¨operator&lt;æ¥å®Œæˆmultisetçš„æ’åºï¼Œè€Œoperator&lt;æ˜¯æŒ‰ç…§Widgetä¸­æˆå‘˜å˜é‡weightæ¥æ’åºçš„ï¼Œç°åœ¨ç‰¹æ®Šæƒ…å†µä¸‹éœ€è¦ä¸€ä¸ªæŒ‰Widgetä¸­æˆå‘˜å˜é‡speedæ¥æ’åºçš„multisetï¼Œä¸€ç§æ–¹æ³•æ˜¯å…¨ç‰¹åŒ–less<Widget>ï¼Œä½†æ˜¯è¿™ç§åšæ³•å¹¶ä¸å¥½ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½æ˜¯è§‰å¾—è‡ªå·±æŒ‰ç…§weightæ¥æ’åºï¼Œä½†æ˜¯å…¶å®åšçš„å´æ˜¯æŒ‰ç…§speedæ¥æ’åºï¼Œæ›´å¥½çš„åŠæ³•æ˜¯åˆ›å»ºä¸€ä¸ªå‡½æ•°å­ç±»ï¼Œç„¶åç”¨è¯¥å­ç±»åšæ¯”è¾ƒå‡½æ•°ï¼Œè€Œä¸æ˜¯æ”¹å˜lessçš„é»˜è®¤è¡Œä¸ºã€‚</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">speedCompare</span> <span class="o">:</span> <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="n">Widget</span><span class="p">,</span> <span class="n">Widget</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">maxSpeed</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">maxSpeed</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">multiset</span><span class="o">&lt;</span><span class="n">Widget</span><span class="p">,</span> <span class="n">speedCompare</span><span class="o">&gt;</span> <span class="n">widgets</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Ref:</p>
<p>[1]. <a href="https://www.cnblogs.com/Sherry4869/p/15162253.html"target="_blank" rel="external nofollow noopener noreferrer">https://www.cnblogs.com/Sherry4869/p/15162253.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>
[2]. <a href="https://blog.csdn.net/zhuikefeng/article/details/108164117#t35"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/zhuikefeng/article/details/108164117#t35<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>
[3]. <a href="https://zhuanlan.zhihu.com/p/458156007"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/458156007<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>Transformer Q &amp; A</title><link>https://jianye0428.github.io/posts/transformerqanda/</link><pubDate>Mon, 21 Aug 2023 07:59:36 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/transformerqanda/</guid><description><![CDATA[<h2 id="1-2017å¹´æ·±åº¦å­¦ä¹ é¢†åŸŸçš„é‡å¤§çªç ´æ˜¯ä»€ä¹ˆ">1. 2017å¹´æ·±åº¦å­¦ä¹ é¢†åŸŸçš„é‡å¤§çªç ´æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>Transformerã€‚æœ‰ä¸¤æ–¹é¢çš„åŸå› :</p>
<p>1.1 ä¸€æ–¹é¢ï¼ŒTransformeræ˜¯æ·±åº¦å­¦ä¹ é¢†åŸŸç»§MLPã€RNNã€CNNä¹‹åçš„ç¬¬4å¤§ç‰¹å¾æå–å™¨(ä¹Ÿè¢«ç§°ä¸ºåŸºç¡€æ¨¡å‹)ã€‚</br>
<strong>ä»€ä¹ˆæ˜¯ç‰¹å¾æå–å™¨ï¼Ÿ</strong></br>
ç‰¹å¾æå–å™¨æ˜¯è®¡ç®—æœºæ¨¡ä»¿å¤§è„‘ï¼Œä¸å¤–éƒ¨ä¸–ç•Œ(å›¾åƒã€æ–‡å­—ã€è¯­éŸ³ç­‰)äº¤äº’çš„æ–¹å¼ï¼Œå¦‚å›¾1æ‰€ç¤ºã€‚ä¸¾ä¾‹è€Œè¨€: Imagenetæ•°æ®é›†ä¸­åŒ…å«1000ç±»å›¾åƒï¼Œäººä»¬å·²ç»æ ¹æ®è‡ªå·±çš„ç»éªŒæŠŠè¿™ä¸€ç™¾ä¸‡å¼ å›¾åƒåˆ†å¥½1000ç±»ï¼Œæ¯ä¸€ç±»å›¾åƒ(å¦‚ç¾æ´²è±¹)éƒ½æœ‰ç‹¬ç‰¹çš„ç‰¹å¾ã€‚è¿™æ—¶ï¼Œç¥ç»ç½‘ç»œ(å¦‚ResNet18)ä¹Ÿæ˜¯æƒ³é€šè¿‡è¿™ç§åˆ†ç±»çš„æ–¹å¼ï¼ŒæŠŠæ¯ä¸€ç±»å›¾åƒçš„ç‰¹å¾å°½å¯èƒ½æå–æˆ–è¯†åˆ«å‡ºæ¥ã€‚åˆ†ç±»ä¸æ˜¯æœ€ç»ˆç›®çš„ï¼Œè€Œæ˜¯ä¸€ç§æå–å›¾åƒç‰¹å¾çš„æ‰‹æ®µï¼Œæ©ç è¡¥å…¨å›¾åƒä¹Ÿæ˜¯ä¸€ç§æå–ç‰¹å¾çš„æ–¹å¼ï¼Œå›¾åƒå—é¡ºåºæ‰“ä¹±ä¹Ÿæ˜¯ä¸€ç§æå–ç‰¹å¾çš„æ–¹å¼ã€‚</p>
<p></p>
<p>1.2 å¦ä¸€æ–¹é¢ï¼ŒTransformeråœ¨æ·±åº¦å­¦ä¹ é¢†åŸŸæ‰®æ¼”çš„è§’è‰²: ç¬¬3æ¬¡å’Œç¬¬4æ¬¡çƒ­æ½®çš„åŸºçŸ³ï¼Œå¦‚ä¸‹å›¾2æ‰€ç¤ºã€‚</p>
<p></p>
<h2 id="2-transformerçš„æå‡ºèƒŒæ™¯æ˜¯ä»€ä¹ˆ">2. Transformerçš„æå‡ºèƒŒæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><strong>2.1 åœ¨é¢†åŸŸå‘å±•èƒŒæ™¯å±‚é¢</strong>: å½“æ—¶æ—¶å¤„2017å¹´ï¼Œæ·±åº¦å­¦ä¹ åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸå·²ç»ç«äº†å‡ å¹´ã€‚ä»Alexnetã€VGGã€GoogleNetã€ResNetã€DenseNet;ä»å›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹å†åˆ°è¯­ä¹‰åˆ†å‰²;ä½†åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸå¹¶æ²¡æœ‰å¼•èµ·å¾ˆå¤§åå“ã€‚</p>
<p><strong>2.2 æŠ€æœ¯èƒŒæ™¯å±‚é¢</strong>:
(1)å½“æ—¶ä¸»æµçš„åºåˆ—è½¬å½•ä»»åŠ¡(å¦‚æœºå™¨ç¿»è¯‘)çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹å›¾3æ‰€ç¤ºï¼Œåœ¨Sequence to Sequenceæ¶æ„ä¸‹(Encoder-Decoderçš„ä¸€ç§)ï¼ŒRNNæ¥æå–ç‰¹å¾ï¼ŒAttentionæœºåˆ¶å°†Encoderæå–åˆ°çš„ç‰¹å¾é«˜æ•ˆä¼ é€’ç»™Decoderã€‚
(2)è¿™ç§åšæ³•æœ‰ä¸¤ä¸ªä¸è¶³ä¹‹å¤„ï¼Œä¸€æ–¹é¢æ˜¯åœ¨æå–ç‰¹å¾æ—¶çš„RNNå¤©ç”Ÿ<strong>ä»å‰å‘åæ—¶åºä¼ é€’</strong>çš„ç»“æ„å†³å®šäº†å…¶æ— æ³•å¹¶è¡Œè¿ç®—ï¼Œå…¶æ¬¡æ˜¯å½“åºåˆ—é•¿åº¦è¿‡é•¿æ—¶ï¼Œæœ€å‰é¢åºåˆ—çš„ä¿¡æ¯æœ‰å¯èƒ½è¢«é—å¿˜æ‰ã€‚å› æ­¤å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæ¡†æ¶ä¸‹ï¼ŒRNNæ˜¯ç›¸å¯¹è–„å¼±æ€¥éœ€æ”¹è¿›çš„åœ°æ–¹ã€‚</p>
<p></p>
<h2 id="3-transformeråˆ°åº•æ˜¯ä»€ä¹ˆ">3. Transformeråˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>3.1 Transformeræ˜¯ä¸€ç§ç”±Encoderå’ŒDecoderç»„æˆçš„æ¶æ„ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯æ¶æ„å‘¢ï¼Ÿæœ€ç®€å•çš„æ¶æ„å°±æ˜¯A + B + Cã€‚</p>
<p>3.2 Transformerä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ˜¯â€œæˆ‘çˆ±å­¦ä¹ â€ï¼Œè¾“å‡ºæ˜¯â€œI love studyâ€ã€‚</p>
<p>3.3 å¦‚æœæŠŠTransformerçš„æ¶æ„è¿›è¡Œåˆ†æ‹†ï¼Œå¦‚å›¾4æ‰€ç¤ºã€‚</p>
<p></p>
<h2 id="4-ä»€ä¹ˆæ˜¯transformer-encoder">4. ä»€ä¹ˆæ˜¯Transformer Encoderï¼Ÿ</h2>
<p>4.1 ä»<font color=red>åŠŸèƒ½è§’åº¦</font>ï¼ŒTransformer Encoderçš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>æå–ç‰¹å¾</strong>ï¼Œä¹Ÿæœ‰ä½¿ç”¨Transformer Decoderæ¥æå–ç‰¹å¾ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªäººå­¦ä¹ è·³èˆï¼ŒEncoderæ˜¯çœ‹åˆ«äººæ˜¯å¦‚ä½•è·³èˆçš„ï¼ŒDecoderæ˜¯å°†å­¦ä¹ åˆ°çš„ç»éªŒå’Œè®°å¿†(keyå’Œvalueçš„åŒ¹é…ç¨‹åº¦)ï¼Œå±•ç°å‡ºæ¥</p>
<p>4.2 ä»<font color=red>ç»“æ„è§’åº¦</font>ï¼Œå¦‚å›¾5æ‰€ç¤ºï¼ŒTransformer Encoder = Embedding + Positional Embedding + N * (å­Encoder block1 + å­Encoder block2);</p>
<p>å­Encoder block1 = Multi head attention + ADD + Norm;</p>
<p>å­Encoder block2 = Feed Forward + ADD + Norm;</p>
<p>4.3 ä»<font color=red>è¾“å…¥è¾“å‡ºè§’åº¦</font>ï¼ŒNä¸ªTransformer Encoder blockä¸­çš„ç¬¬ä¸€ä¸ªEncoder blockçš„è¾“å…¥ä¸ºä¸€ç»„å‘é‡ X = (Embedding + Positional Embedding)ï¼Œå‘é‡ç»´åº¦é€šå¸¸ä¸º512*512ï¼Œå…¶ä»–Nä¸ªTransformerEncoder blockçš„è¾“å…¥ä¸ºä¸Šä¸€ä¸ª Transformer Encoder blockçš„è¾“å‡ºï¼Œè¾“å‡ºå‘é‡çš„ç»´åº¦ä¹Ÿä¸º<code>512*512</code>(è¾“å…¥è¾“å‡ºå¤§å°ç›¸åŒ)ã€‚</p>
<p>4.4 ä¸ºä»€ä¹ˆæ˜¯<code>512*512</code>ï¼Ÿ<font color=red>å‰è€…æ˜¯æŒ‡tokençš„ä¸ªæ•°</font>ï¼Œå¦‚â€œæˆ‘çˆ±å­¦ä¹ â€æ˜¯4ä¸ªtokenï¼Œè¿™é‡Œè®¾ç½®ä¸º512æ˜¯ä¸ºäº†å›Šæ‹¬ä¸åŒçš„åºåˆ—é•¿åº¦ï¼Œä¸å¤Ÿæ—¶paddingã€‚<font color=red>åè€…æ˜¯æŒ‡æ¯ä¸€ä¸ªtokenç”Ÿæˆçš„å‘é‡ç»´åº¦</font>ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªtokenä½¿ç”¨ä¸€ä¸ªåºåˆ—é•¿åº¦ä¸º512çš„å‘é‡è¡¨ç¤ºã€‚äººä»¬å¸¸è¯´ï¼ŒTransformerä¸èƒ½è¶…è¿‡512ï¼Œå¦åˆ™ç¡¬ä»¶å¾ˆéš¾æ”¯æ’‘;å…¶å®512æ˜¯æŒ‡å‰è€…ï¼Œä¹Ÿå°±æ˜¯tokençš„ä¸ªæ•°ï¼Œå› ä¸ºæ¯ä¸€ä¸ªtokenè¦åšself attentionæ“ä½œ;ä½†æ˜¯åè€…çš„512ä¸å®œè¿‡å¤§ï¼Œå¦åˆ™è®¡ç®—èµ·æ¥ä¹Ÿå¾ˆæ…¢ã€‚</p>
<p></p>
<h2 id="5-ä»€ä¹ˆæ˜¯transformer-decoder">5. ä»€ä¹ˆæ˜¯Transformer Decoderï¼Ÿ</h2>
<p>5.1 ä»åŠŸèƒ½è§’åº¦ï¼Œç›¸æ¯”äºTransformer Encoderï¼ŒTransformer Decoderæ›´æ“…é•¿åš<strong>ç”Ÿæˆå¼ä»»åŠ¡</strong>ï¼Œå°¤å…¶å¯¹äºè‡ªç„¶è¯­è¨€å¤„ç†é—®é¢˜ã€‚</p>
<p>5.2 ä»ç»“æ„è§’åº¦ï¼Œå¦‚å›¾6æ‰€ç¤ºï¼ŒTransformer Decoder = Embedding + Positional Embedding + N*(å­Decoder block1 + å­Decoder block2 + å­Decoder block3)+ Linear + Softmax;</p>
<p>å­Decoder block1 = Mask Multi head attention + ADD + Norm;</p>
<p>å­Decoder block2 = Multi head attention + ADD + Norm;</p>
<p>å­Decoder block3 = Feed Forward + ADD + Norm;</p>
<p></p>
<p>5.3 ä»(Embedding+Positional Embedding)(Nä¸ªDecoder block)(Linear + softmax) è¿™ä¸‰ä¸ªæ¯ä¸€ä¸ªå•ç‹¬ä½œç”¨è§’åº¦:</p>
<p>Embedding + Positional Embedding: ä»¥æœºå™¨ç¿»è¯‘ä¸ºä¾‹ï¼Œè¾“å…¥â€œMachine Learningâ€ï¼Œè¾“å‡ºâ€œæœºå™¨å­¦ä¹ â€; è¿™é‡Œçš„Embeddingæ˜¯æŠŠâ€œæœºå™¨å­¦ä¹ â€ä¹Ÿè½¬åŒ–æˆå‘é‡çš„å½¢å¼ã€‚</p>
<p>Nä¸ªDecoder block: ç‰¹å¾å¤„ç†å’Œä¼ é€’è¿‡ç¨‹ã€‚</p>
<p>Linear + softmax: softmaxæ˜¯é¢„æµ‹ä¸‹ä¸€ä¸ªè¯å‡ºç°çš„æ¦‚ç‡ï¼Œå¦‚å›¾7æ‰€ç¤ºï¼Œå‰é¢çš„Linearå±‚ç±»ä¼¼äºåˆ†ç±»ç½‘ç»œ(ResNet18)æœ€ååˆ†ç±»å±‚å‰æ¥çš„MLPå±‚ã€‚</p>
<p></p>
<p>5.4 Transformer Decoderçš„è¾“å…¥ã€è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿåœ¨Trainå’ŒTestæ—¶æ˜¯ä¸åŒçš„ã€‚</p>
<p>åœ¨Trainé˜¶æ®µï¼Œå¦‚å›¾8æ‰€ç¤ºã€‚è¿™æ—¶æ˜¯çŸ¥é“labelçš„ï¼Œdecoderçš„ç¬¬ä¸€ä¸ªè¾“å…¥æ˜¯beginå­—ç¬¦ï¼Œè¾“å‡ºç¬¬ä¸€ä¸ªå‘é‡ä¸labelä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦ä½¿ç”¨cross entropy lossã€‚Decoderçš„ç¬¬äºŒä¸ªè¾“å…¥æ˜¯ç¬¬ä¸€ä¸ªå‘é‡çš„labelï¼ŒDecoderçš„ç¬¬Nä¸ªè¾“å…¥å¯¹åº”çš„è¾“å‡ºæ˜¯Endå­—ç¬¦ï¼Œåˆ°æ­¤ç»“æŸã€‚è¿™é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œåœ¨Trainé˜¶æ®µæ˜¯å¯ä»¥è¿›è¡Œ<strong>å¹¶è¡Œè®­ç»ƒ</strong>çš„ã€‚</p>
<p></p>
<p>åœ¨Testé˜¶æ®µï¼Œä¸‹ä¸€ä¸ªæ—¶åˆ»çš„è¾“å…¥æ˜¯å‰ä¸€ä¸ªæ—¶åˆ»çš„è¾“å‡ºï¼Œå¦‚å›¾9æ‰€ç¤ºã€‚å› æ­¤ï¼ŒTrainå’ŒTestæ—¶å€™ï¼ŒDecoderçš„è¾“å…¥ä¼šå‡ºç°Mismatchï¼Œåœ¨Testæ—¶å€™ç¡®å®æœ‰å¯èƒ½ä¼šå‡ºç°ä¸€æ­¥é”™ï¼Œæ­¥æ­¥é”™çš„æƒ…å†µã€‚æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ: ä¸€ç§æ˜¯trainæ—¶å¶å°”ç»™ä¸€äº›é”™è¯¯ï¼Œå¦ä¸€ç§æ˜¯Scheduled samplingã€‚</p>
<p></p>
<p>5.5 Transformer Decoder blockå†…éƒ¨çš„è¾“å…¥å’Œè¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å‰é¢æåˆ°çš„æ˜¯åœ¨æ•´ä½“trainå’Œtesté˜¶æ®µï¼ŒDecoderçš„è¾“å…¥å’Œè¾“å‡ºï¼Œé‚£ä¹ˆTransformer Decoderå†…éƒ¨çš„Transformer Decoder blockï¼Œå¦‚å›¾10æ‰€ç¤ºï¼Œçš„è¾“å…¥è¾“å‡ºåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p></p>
<p>å¯¹äºN=6ä¸­çš„ç¬¬1æ¬¡å¾ªç¯(N=1æ—¶): å­Decoder block1 çš„è¾“å…¥æ˜¯ embedding +Positional Embeddingï¼Œå­Decoder block2 çš„è¾“å…¥çš„Qæ¥è‡ªå­Decoder block1çš„è¾“å‡ºï¼ŒKVæ¥è‡ªTransformer Encoderæœ€åä¸€å±‚çš„è¾“å‡ºã€‚</p>
<p>å¯¹äºN=6çš„ç¬¬2æ¬¡å¾ªç¯: å­Decoder block1çš„è¾“å…¥æ˜¯N=1æ—¶ï¼Œå­Decoder block3çš„è¾“å‡ºï¼ŒKVåŒæ ·æ¥è‡ªTransformer Encoderçš„æœ€åä¸€å±‚çš„è¾“å‡ºã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºåœ¨Trainè¿˜æ˜¯Testæ—¶ï¼ŒTransformer Decoderçš„è¾“å…¥ä¸ä»…æ¥è‡ª(ground truthæˆ–è€…ä¸Šä¸€ä¸ªæ—¶åˆ»Decoderçš„è¾“å‡º)ï¼Œè¿˜æ¥è‡ªTransformer Encoderçš„æœ€åä¸€å±‚ã€‚</p>
<p>è®­ç»ƒæ—¶: ç¬¬iä¸ªdecoderçš„è¾“å…¥ = encoderè¾“å‡º + ground truth embeddingã€‚</p>
<p>é¢„æµ‹æ—¶: ç¬¬iä¸ªdecoderçš„è¾“å…¥ = encoderè¾“å‡º + ç¬¬(i-1)ä¸ªdecoderè¾“å‡º.</p>
<h2 id="6-transformer-encoderå’Œtransformer-decoderæœ‰å“ªäº›ä¸åŒ">6. Transformer Encoderå’ŒTransformer Decoderæœ‰å“ªäº›ä¸åŒï¼Ÿ</h2>
<p>6.1 ä½œç”¨ä¸Šï¼ŒTransformer Encoderå¸¸ç”¨æ¥<strong>æå–ç‰¹å¾</strong>ï¼ŒTransformer Decoderå¸¸ç”¨äº<strong>ç”Ÿæˆå¼ä»»åŠ¡</strong>ã€‚Transformer Encoderå’ŒTransformer Decoderæ˜¯ä¸¤æ¡ä¸åŒçš„æŠ€æœ¯è·¯çº¿ï¼Œ<strong>Berté‡‡ç”¨çš„å‰è€…ï¼ŒGPTç³»åˆ—æ¨¡å‹é‡‡ç”¨çš„æ˜¯åè€…</strong>ã€‚</p>
<p>6.2 ç»“æ„ä¸Šï¼ŒTransformer Decoder blockåŒ…æ‹¬äº†3ä¸ªå­Decoder blockï¼Œè€ŒTransformer Encoder block åŒ…æ‹¬2ä¸ªå­Encoder blockï¼Œä¸”Transformer Decoderä¸­ä½¿ç”¨äº†Mask multi-head Attentionã€‚</p>
<p>6.3 ä»äºŒè€…çš„è¾“å…¥è¾“å‡ºè§’åº¦ï¼ŒNä¸ªTransformer Encoderè¿ç®—å®Œæˆä¹‹åï¼Œå®ƒçš„è¾“å‡ºæ‰æ­£å¼è¾“å…¥è¿›Transformer Decoderï¼Œä½œä¸ºQKVä¸­çš„Kå’ŒVï¼Œç»™Transformer Decoderä½¿ç”¨ã€‚é‚£ä¹ˆTransformerEncoderæœ€åå±‚çš„è¾“å‡ºæ˜¯å¦‚ä½•é€ç»™Decoderå‘¢ï¼Ÿå¦‚å›¾11æ‰€ç¤ºã€‚</p>
<p></p>
<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆEncoderå’ŒDecoderå¿…é¡»è¦ç”¨è¿™ç§äº¤äº’çš„æ–¹å¼å‘¢ï¼Ÿå…¶å®ä¹Ÿå¹¶ä¸ä¸€å®šï¼Œåç»­æœ‰ä¸åŒäº¤äº’æ–¹å¼çš„æå‡ºï¼Œå¦‚å›¾12ã€‚</p>
<p></p>
<h2 id="7-ä»€ä¹ˆæ˜¯embedding">7. ä»€ä¹ˆæ˜¯Embeddingï¼Ÿ</h2>
<p>7.1 Embeddingåœ¨Transformeræ¶æ„ä¸­çš„ä½ç½®å¦‚å›¾13æ‰€ç¤ºã€‚</p>
<p>7.2 æå‡ºèƒŒæ™¯:  è®¡ç®—æœºæ— æ³•ç›´æ¥å¤„ç†ä¸€ä¸ªå•è¯æˆ–è€…ä¸€ä¸ªæ±‰å­—ï¼Œéœ€è¦æŠŠä¸€ä¸ªtokenè½¬åŒ–æˆè®¡ç®—æœºå¯ä»¥è¯†åˆ«çš„å‘é‡ï¼Œè¿™ä¹Ÿå°±æ˜¯embeddingè¿‡ç¨‹ã€‚</p>
<p>7.3 å®ç°æ–¹å¼:  æœ€ç®€å•çš„embeddingæ“ä½œå°±æ˜¯one hot vectorï¼Œä½†one hot vectoræœ‰ä¸€ä¸ªå¼Šç«¯å°±æ˜¯æ²¡æœ‰è€ƒè™‘è¯è¯­å‰åä¹‹é—´çš„å…³ç³»ï¼Œåæ¥ä¹Ÿå°±äº§ç”Ÿäº†WordEmbeddingï¼Œå¦‚å›¾13ã€‚</p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">wordembeddingå°†å•è¯tokenå‘é‡åŒ–ï¼Œå¹¶ä¸”è€ƒè™‘çš„å•è¯ä¸å•è¯ä¹‹é—´çš„ç›¸å…³æ€§ã€‚</div>
    </div>
  </div>
<p></p>
<h2 id="8-ä»€ä¹ˆæ˜¯positional-embedding">8. ä»€ä¹ˆæ˜¯Positional Embeddingï¼Ÿ</h2>
<p>8.1 Positional Embeddingåœ¨Transformeræ¶æ„ä¸­çš„ä½ç½®å¦‚å›¾14æ‰€ç¤ºã€‚</p>
<p>8.2 æå‡ºèƒŒæ™¯:  RNNä½œä¸ºç‰¹å¾æå–å™¨ï¼Œæ˜¯è‡ªå¸¦è¯çš„å‰åé¡ºåºä¿¡æ¯çš„;è€ŒAttentionæœºåˆ¶å¹¶æ²¡æœ‰è€ƒè™‘å…ˆåé¡ºåºä¿¡æ¯ï¼Œä½†å‰åé¡ºåºä¿¡æ¯å¯¹è¯­ä¹‰å½±å“å¾ˆå¤§ï¼Œå› æ­¤éœ€è¦é€šè¿‡Positional Embeddingè¿™ç§æ–¹å¼æŠŠå‰åä½ç½®ä¿¡æ¯åŠ åœ¨è¾“å…¥çš„Embeddingä¸Šã€‚</p>
<p>8.3 å®ç°æ–¹å¼:  ä¼ ç»Ÿä½ç½®ç¼–ç å’Œç¥ç»ç½‘ç»œè‡ªåŠ¨è®­ç»ƒå¾—åˆ°ã€‚</p>
<p></p>
<h2 id="9-ä»€ä¹ˆæ˜¯attention">9. ä»€ä¹ˆæ˜¯Attentionï¼Ÿ</h2>
<p>9.1 ä»‹ç»Transformerï¼Œä¸ºä»€ä¹ˆè¦ä»‹ç»Attentionå‘¢ï¼Ÿå› ä¸ºåœ¨Transformerä¸­æœ€å¤šçš„multi head attentionå’ŒMask multi head attentionæ¥è‡ªScaled dot product attentionï¼Œè€Œscaled dot product attentionæ¥è‡ªself attentionï¼Œè€Œself attentionæ˜¯attentionçš„ä¸€ç§ï¼Œå› æ­¤é¦–å…ˆéœ€è¦äº†è§£Attentionï¼Œå¦‚å›¾15æ‰€ç¤ºã€‚</p>
<p></p>
<p>9.2 Attentionåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>
<p>å¯¹äºå›¾åƒè€Œè¨€ï¼Œattentionå°±æ˜¯äººä»¬çœ‹åˆ°å›¾åƒä¸­çš„æ ¸å¿ƒå…³æ³¨çš„åŒºåŸŸï¼Œæ˜¯å›¾åƒä¸­çš„é‡ç‚¹ï¼Œå¦‚å›¾16æ‰€ç¤ºã€‚å¯¹äºåºåˆ—è€Œè¨€ï¼ŒAttentionæœºåˆ¶æœ¬è´¨ä¸Šæ˜¯ä¸ºäº†æ‰¾åˆ°<strong>è¾“å…¥ä¸­ä¸åŒtokenä¹‹é—´çš„ç›¸äº’å…³ç³»</strong>ï¼Œé€šè¿‡æƒé‡çŸ©é˜µæ¥è‡ªå‘åœ°æ‰¾åˆ°è¯ä¸è¯ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p></p>
<p>9.3 Attentionæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<p>æ˜¯é€šè¿‡QKVå®ç°çš„ã€‚</p>
<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯QKVå‘¢ï¼ŸQæ˜¯queryï¼ŒKæ˜¯keysï¼ŒVæ˜¯valuesã€‚å¦‚å›¾17æ‰€ç¤ºï¼Œä¸¾ä¾‹è€Œè¨€ï¼ŒQæ˜¯å¤§è„‘å‘å‡ºçš„ä¿¡å·ï¼Œæˆ‘å£æ¸´äº†;Kæ˜¯ç¯å¢ƒä¿¡æ¯ï¼Œçœ¼ç›çœ‹åˆ°çš„ä¸–ç•Œ;Væ˜¯å¯¹ç¯å¢ƒä¸­ä¸åŒçš„ç‰©å“èµ‹äºˆä¸åŒçš„æ¯”é‡ï¼Œæ°´çš„æ¯”é‡åŠ å¤§ã€‚</p>
<p>æ€»ä¹‹ï¼ŒAttentionå°±æ˜¯é€šè¿‡è®¡ç®—QKçš„ç›¸ä¼¼åº¦ï¼Œä¸Vç›¸ä¹˜å¾—åˆ°æ³¨æ„åŠ›æ•°å€¼ã€‚</p>
<p>$$\text{Attention}(\mathrm{Query},\mathrm{Source})=\sum\text{Similarity}(\mathrm{Query},\mathrm{Key}<em>\mathrm{i})*\mathrm{Value}</em>\mathrm{i}$$</p>
<p></p>
<p>9.4 ä¸ºä»€ä¹ˆå¿…é¡»è¦æœ‰QKVä¸‰è€…ï¼Ÿ</p>
<p>ä¸ºä»€ä¹ˆä¸æ˜¯åªæœ‰Qï¼Ÿå› ä¸ºQ1ä¸Q2ä¹‹é—´çš„å…³ç³»æƒé‡ï¼Œä¸æ­¢éœ€è¦a12ï¼Œä¹Ÿéœ€è¦a21ã€‚ä½ å¯èƒ½ä¼šé—®ï¼Ÿæˆ‘ä»¬è®©a12=a21ä¸è¡Œå—ï¼Ÿä¹Ÿå¯ä»¥å°è¯•ï¼Œä½†ä»åŸç†ä¸Šè®²æ•ˆæœåº”è¯¥æ²¡æœ‰a12å’Œa21æ•ˆæœå¥½ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸æ˜¯åªæœ‰QKï¼Ÿæ±‚å¾—çš„æƒé‡ç³»æ•°éœ€è¦æ”¾åˆ°è¾“å…¥ä¸­ï¼Œå¯ä»¥ä¹˜Qï¼Œä¹Ÿå¯ä»¥ä¹˜Kï¼Œä¸ºä»€ä¹ˆè¦é‡æ–°ä¹˜Vå‘¢ï¼Ÿæˆ‘è§‰å¾—å¯èƒ½æ˜¯å¤šäº†ä¸€ç»„å¯è®­ç»ƒå‚æ•°$W_V$ï¼Œä½¿ç½‘ç»œå…·æœ‰æ›´å¼ºçš„å­¦ä¹ èƒ½åŠ›ã€‚</p>
<h2 id="10-ä»€ä¹ˆæ˜¯self-attention">10. ä»€ä¹ˆæ˜¯Self Attentionï¼Ÿ</h2>
<p>10.1 ä»‹ç»Transformerï¼Œä¸ºä»€ä¹ˆè¦ä»‹ç»self Attentionå‘¢ï¼Ÿå› ä¸ºåœ¨Transformerä¸­æœ€å¤šçš„multi head attentionå’ŒMask multi head attentionæ¥è‡ªScaled dot product attentionï¼Œè€Œscaled dot product attentionæ¥è‡ªself attentionï¼Œå¦‚å›¾15æ‰€ç¤ºã€‚</p>
<p>10.2 ä»€ä¹ˆæ˜¯Self Attentionå‘¢ï¼Ÿself attentionå’Œlocal attentionã€stride attentionéƒ½æ˜¯attentionçš„ä¸€ç§;self attentionæ˜¯æ¯ä¸€ä¸ªQä¸æ¯ä¸€ä¸ªKä¾æ¬¡è®¡ç®—æ³¨æ„åŠ›ç³»æ•°ï¼Œå¦‚å›¾18æ‰€ç¤ºï¼Œè€Œåƒlocal attentionæ˜¯Qåªä¸ç›¸é‚»çš„Kè®¡ç®—æ³¨æ„åŠ›ç³»æ•°ï¼Œstride attentionæ˜¯Qé€šè¿‡è·³è¿çš„æ–¹å¼ä¸Kè®¡ç®—æ³¨æ„åŠ›ç³»æ•°ã€‚</p>
<p></p>
<p>10.3 Self attentionä¸ºä»€ä¹ˆå¯ä»¥ç”¨äºå¤„ç†åƒæœºå™¨ç¿»è¯‘è¿™ç§åºåˆ—æ•°æ®?</p>
<p>è¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸€ä¸ªä½ç½®çš„æ•°æ®ï¼Œå¯ä»¥å…³æ³¨å…¶ä»–ä½ç½®çš„ä¿¡æ¯ï¼Œç”±æ­¤é€šè¿‡Attention scoreæ¥æå–ç‰¹å¾æˆ–è€…æ•è·è¾“å…¥åºåˆ—æ¯ä¸€ä¸ªtokenä¹‹é—´çš„å…³ç³»ã€‚</p>
<p>10.4 Self attentionæ˜¯å¦‚ä½•å…·ä½“å®ç°çš„? æ€»å…±åˆ†ä¸º4æ­¥ï¼Œå¦‚å›¾19æ‰€ç¤º</p>
<p></p>
<h2 id="11-ä»€ä¹ˆæ˜¯scaled-dot-product-attention">11. ä»€ä¹ˆæ˜¯Scaled dot product attentionï¼Ÿ</h2>
<p>11.1 self attentionæœ€å¸¸è§çš„æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯dot product attentionã€å¦ä¸€ç§æ˜¯additive attentionï¼Œå¦‚å›¾20æ‰€ç¤ºï¼Œå‰è€…çš„è®¡ç®—æ•ˆç‡æ›´é«˜ã€‚</p>
<p></p>
<p>11.2 ä»€ä¹ˆæ˜¯Scaled ?</p>
<p>scaledçš„å…·ä½“å®ç°æ–¹å¼å¦‚å›¾21æ‰€ç¤ºï¼Œè¿™ä¸€æ“ä½œçš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å†…ç§¯è¿‡å¤§ï¼Œä»æ¢¯åº¦è§’åº¦è€ƒè™‘ï¼Œé¿å…é è¿‘1ï¼Œæ˜“è®­ç»ƒ;ä¸batch normalizationæœ‰ä¸€äº›ç›¸ä¼¼çš„åŠŸèƒ½ã€‚</p>
<p>$$\text{Attention}(Q,K,V)=\text{softmax}(\frac{QK^T}{\sqrt{d_k}})V$$</p>
<h2 id="12-ä»€ä¹ˆæ˜¯multi-head-attention">12. ä»€ä¹ˆæ˜¯Multi head attentionï¼Ÿ</h2>
<p>12.1 Multi head attentionåœ¨Transformeræ¶æ„ä¸­çš„ä½ç½®å¦‚å›¾15æ‰€ç¤ºã€‚</p>
<p>12.2 æå‡ºèƒŒæ™¯: CNNå…·æœ‰å¤šä¸ªchannelï¼Œå¯ä»¥æå–å›¾åƒä¸åŒç»´åº¦çš„ç‰¹å¾ä¿¡æ¯ï¼Œé‚£ä¹ˆSelf attentionæ˜¯å¦å¯ä»¥æœ‰ç±»ä¼¼æ“ä½œï¼Œå¯ä»¥æå–ä¸åŒè·ç¦»tokençš„å¤šä¸ªç»´åº¦ä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>12.3 ä»€ä¹ˆæ˜¯group å·ç§¯ï¼Ÿå¦‚å›¾22æ‰€ç¤ºï¼Œå°†è¾“å…¥çš„ç‰¹å¾å¤šä¸ªchannelåˆ†æˆå‡ ä¸ªgroupå•ç‹¬åšå·ç§¯ï¼Œæœ€åå†è¿›è¡Œcon cæ“ä½œã€‚</p>
<p></p>
<p>12.4 Multi head attentionçš„å®ç°æ–¹å¼ï¼Ÿä¸self attentionæ ¹æœ¬ä¸åŒæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å¦‚å›¾23æ‰€ç¤ºï¼Œä»¥2ä¸ªheadçš„ä¸ºä¾‹ï¼Œå°†è¾“å…¥çš„Qã€Kã€Våˆ†æˆä¸¤ä»½ï¼Œæ¯ä¸€å°ä»½çš„Qä¸å¯¹åº”çš„Kã€Våˆ†åˆ«æ“ä½œï¼Œæœ€åè®¡ç®—å¾—åˆ°çš„å‘é‡å†è¿›è¡Œconcæ“ä½œï¼Œç”±æ­¤å¯ä»¥çœ‹å‡ºï¼ŒMulti head attentionä¸groupå·ç§¯æœ‰ç€ç›¸ä¼¼çš„å®ç°æ–¹å¼ã€‚</p>
<p></p>
<p>12.5 å¦‚ä½•ä»è¾“å…¥è¾“å‡ºçš„ç»´åº¦æ¥ç†è§£Multi head attentionï¼Ÿå¦‚å›¾24æ‰€ç¤ºã€‚</p>
<p></p>
<h2 id="13-ä»€ä¹ˆæ˜¯mask-multi-head-attention">13. ä»€ä¹ˆæ˜¯Mask Multi head attentionï¼Ÿ</h2>
<p>13.1 Mask Multi head attentionåœ¨transformeræ¶æ„ä¸­çš„ä½ç½®å¦‚å›¾15æ‰€ç¤ºã€‚</p>
<p>13.2 ä¸ºä»€ä¹ˆè¦æœ‰Maskè¿™ç§æ“ä½œï¼Ÿ</p>
<p>Transformeré¢„æµ‹ç¬¬Tä¸ªæ—¶åˆ»çš„è¾“å‡ºï¼Œä¸èƒ½çœ‹åˆ°Tæ—¶åˆ»ä¹‹åçš„é‚£äº›è¾“å…¥ï¼Œä»è€Œä¿è¯è®­ç»ƒå’Œé¢„æµ‹ä¸€è‡´ã€‚</p>
<p>é€šè¿‡ Masked æ“ä½œå¯ä»¥é˜²æ­¢ç¬¬ i ä¸ªå•è¯çŸ¥é“ i+1 ä¸ªå•è¯ä¹‹åçš„ä¿¡æ¯ï¼Œå¦‚å›¾25æ‰€ç¤ºã€‚</p>
<p></p>
<p>13.3 Maskæ“ä½œæ˜¯å¦‚ä½•å…·ä½“å®ç°çš„å‘¢ï¼Ÿ</p>
<p>Q1åªè·ŸK1è®¡ç®—ï¼ŒQ2åªè·ŸK1ã€K2è®¡ç®—ï¼Œè€Œå¯¹äºK3ã€K4ç­‰ï¼Œåœ¨softmaxä¹‹å‰ç»™ä¸€ä¸ªéå¸¸å¤§çš„è´Ÿæ•°ï¼Œç”±æ­¤ç»è¿‡softmaxä¹‹åå˜ä¸º0ï¼Œå…¶åœ¨çŸ©é˜µä¸Šçš„è®¡ç®—åŸç†å®ç°å¦‚å›¾26æ‰€ç¤ºã€‚</p>
<p></p>
<h2 id="14-ä»€ä¹ˆæ˜¯add">14. ä»€ä¹ˆæ˜¯ADDï¼Ÿ</h2>
<p>14.1 Addå°±æ˜¯æ®‹å·®è¿æ¥ï¼Œç”±2015å¹´ResNetè¿™ç¯‡æ–‡ç« å‘æ‰¬å…‰å¤§(ç›®å‰å¼•ç”¨é‡å·²è¶…è¿‡16ä¸‡)ï¼Œä¸Skip connectionçš„åŒºåˆ«åœ¨äºéœ€è¦å¤§å°ç»´åº¦å…¨éƒ¨ç›¸åŒã€‚</p>
<p>14.2 ä½œä¸ºå¤§é“è‡³ç®€æƒ³æ³•çš„æè‡´ï¼Œå‡ ä¹æ¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¨¡å‹éƒ½ä¼šç”¨åˆ°è¿™ä¸ªæŠ€æœ¯ï¼Œå¯ä»¥<strong>é˜²æ­¢ç½‘ç»œé€€åŒ–</strong>ï¼Œå¸¸ç”¨äºè§£å†³å¤šå±‚ç½‘ç»œéš¾è®­ç»ƒçš„é—®é¢˜ã€‚</p>
<p></p>
<h2 id="15-ä»€ä¹ˆæ˜¯norm">15. ä»€ä¹ˆæ˜¯Normï¼Ÿ</h2>
<p>15.1 Normå°±æ˜¯layer normalizationã€‚</p>
<p>15.2 æ ¸å¿ƒä½œç”¨: ä¸ºäº†è®­ç»ƒæ›´åŠ ç¨³å®šï¼Œå’Œbatch normalizationæœ‰ç›¸åŒçš„ä½œç”¨ï¼Œéƒ½æ˜¯ä¸ºäº†ä½¿è¾“å…¥çš„æ ·æœ¬å‡å€¼ä¸ºé›¶ï¼Œæ–¹å·®ä¸º1ã€‚</p>
<p>15.3 ä¸ºä»€ä¹ˆä¸ä½¿ç”¨batch normalizationï¼Œä½¿ç”¨çš„æ˜¯layer normalizationå‘¢ï¼Ÿå› ä¸ºä¸€ä¸ªæ—¶åºæ•°æ®ï¼Œå¥å­è¾“å…¥é•¿åº¦æœ‰é•¿æœ‰çŸ­ï¼Œå¦‚æœä½¿ç”¨batch normalizationï¼Œåˆ™å¾ˆå®¹æ˜“é€ æˆå› æ ·æœ¬é•¿çŸ­ä¸ä¸€é€ æˆâ€œè®­ç»ƒä¸ç¨³å®šâ€ã€‚BNæ˜¯å¯¹åŒä¸€ä¸ªbatchå†…çš„æ‰€æœ‰æ•°æ®çš„åŒä¸€ä¸ªç‰¹å¾æ•°æ®è¿›è¡Œæ“ä½œ;è€ŒLNæ˜¯å¯¹åŒä¸€ä¸ªæ ·æœ¬è¿›è¡Œæ“ä½œã€‚</p>
<p></p>
<ol start="16">
<li>ä»€ä¹ˆæ˜¯FFNï¼Ÿ</li>
</ol>
<p>16.1 FFNå°±æ˜¯feed forward networksã€‚</p>
<p>16.2 ä¸ºä»€ä¹ˆæœ‰äº†Self attentionå±‚ï¼Œè¿˜è¦æœ‰FFNï¼ŸAttentionå·²ç»æœ‰äº†æƒ³è¦çš„åºåˆ—ä¿¡æ¯ç‰¹å¾ï¼ŒMLPçš„ä½œç”¨æ˜¯æŠŠä¿¡æ¯æŠ•å½±åˆ°ç‰¹å®šçš„ç©ºé—´é‡Œï¼Œå†åšä¸€æ¬¡éçº¿æ€§æ˜ å°„ï¼Œå’ŒSelf attentionäº¤æ›¿ä½¿ç”¨ã€‚</p>
<p>16.3 ç»“æ„ä¸Š: åŒ…æ‹¬ä¸¤å±‚MLPï¼Œç¬¬ä¸€å±‚çš„ç»´åº¦ä¸º$512<em>2048$ï¼Œç¬¬äºŒå±‚çš„ç»´åº¦ä¸º$2048</em>512$ï¼Œä¸”ç¬¬äºŒå±‚MLPæ²¡æœ‰ä½¿ç”¨æ¿€æ´»å‡½æ•°ï¼Œå¦‚å›¾29æ‰€ç¤ºã€‚</p>
<p></p>
<h2 id="17-transformeræ˜¯å¦‚ä½•è®­ç»ƒå‡ºæ¥çš„">17. Transformeræ˜¯å¦‚ä½•è®­ç»ƒå‡ºæ¥çš„ï¼Ÿ</h2>
<p>17.1 æ•°æ®ä¸Šï¼Œåœ¨Transformerè®ºæ–‡ä¸­æœ‰æåˆ°ï¼Œç”¨åˆ°äº†4.5Må’Œ36Mçš„ç¿»è¯‘å¥å­å¯¹ã€‚</p>
<p>17.2 ç¡¬ä»¶ä¸Šï¼Œbaseæ¨¡å‹æ˜¯8ä¸ªP100 GPUè®­ç»ƒäº†12ä¸ªå°æ—¶ï¼Œå¤§æ¨¡å‹æ˜¯è®­ç»ƒäº†3.5å¤©ã€‚</p>
<p>17.3 æ¨¡å‹å‚æ•°å’Œè°ƒå‚å±‚é¢:</p>
<p>ç¬¬ä¸€ï¼Œå¯è®­ç»ƒçš„å‚æ•°åŒ…æ‹¬$W_Q$ã€$W_K$ã€$W_V$ã€$W_O$ï¼Œæ¢åŒ…æ‹¬$FFN$å±‚çš„å‚æ•°ã€‚</p>
<p>ç¬¬äºŒï¼Œå¯è°ƒçš„å‚æ•°åŒ…æ‹¬: æ¯ä¸€ä¸ªtokenå‘é‡è¡¨ç¤ºçš„ç»´åº¦(d_model)ã€headçš„å¤´æ•°ã€Encoderå’ŒDecoderä¸­blocké‡å¤çš„æ¬¡æ•°Nã€FFNä¸­é—´å±‚å‘é‡çš„ç»´åº¦ã€Label smoothing(ç½®ä¿¡åº¦0.1)å’Œdropout(0.1)ã€‚</p>
<h2 id="18-transformerä¸ºä»€ä¹ˆæ•ˆæœå¥½">18. Transformerä¸ºä»€ä¹ˆæ•ˆæœå¥½ï¼Ÿ</h2>
<p>18.1 è™½ç„¶é¢˜ç›®æ˜¯Attention is all you needï¼Œä½†åç»­ä¸€äº›ç ”ç©¶è¡¨æ˜ï¼ŒAttentionã€æ®‹å·®è¿æ¥ã€layer normalizationã€FFNï¼Œè¿™äº›å› ç´ å…±åŒæˆå°±äº†Transformerã€‚</p>
<p>18.2 Transformerä¼˜ç‚¹åŒ…æ‹¬:</p>
<p>ç¬¬ä¸€ï¼Œæå‡ºæ·±åº¦å­¦ä¹ ç»§MLPã€CNNã€RNNåçš„ç¬¬4å¤§ç‰¹å¾æå–å™¨ã€‚</p>
<p>ç¬¬äºŒï¼Œä¸€å¼€å§‹ç”¨åœ¨æœºå™¨ç¿»è¯‘ï¼Œéšç€GPTå’ŒBertå½»åº•å‡ºåœˆ;æ˜¯ä¸€ä¸ªè½¬æŠ˜ç‚¹ï¼Œåœ¨è¿™ä¸ªç‚¹ä¹‹åï¼ŒNLPé¢†åŸŸå¿«é€Ÿå‘å±•ï¼Œä¹‹åå¤šæ¨¡æ€ã€å¤§æ¨¡å‹ã€è§†è§‰Transformerç­‰å¼€å§‹å…´èµ·ã€‚</p>
<p>ç¬¬ä¸‰ï¼Œç»™äººä»¬ä¿¡å¿ƒï¼ŒåŸæ¥CNNå’ŒRNNä¹‹åï¼Œè¿˜å¯ä»¥æœ‰æ•ˆæœæ›´å¥½çš„ç‰¹å¾æå–å™¨ã€‚</p>
<p>18.3 Transformerçš„ä¸è¶³ä¹‹å¤„ï¼Ÿ</p>
<p>ç¬¬ä¸€ï¼Œè®¡ç®—é‡å¤§ï¼Œå¯¹ç¡¬ä»¶è¦æ±‚é«˜ã€‚</p>
<p>ç¬¬äºŒï¼Œå› ä¸ºæ— å½’çº³åç½®ï¼Œéœ€è¦å¾ˆå¤šæ•°æ®æ‰å¯ä»¥å–å¾—å¾ˆå¥½çš„æ•ˆæœã€‚</p>
<p>Ref:</br>
[1]. <a href="https://mp.weixin.qq.com/s/sNyh3SzhIdsk8feYfQlTSA"target="_blank" rel="external nofollow noopener noreferrer">https://mp.weixin.qq.com/s/sNyh3SzhIdsk8feYfQlTSA<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>Transformer | å¦‚ä½•ç†è§£attentionä¸­çš„Q,K,Vï¼Ÿ</title><link>https://jianye0428.github.io/posts/attentionaqkv/</link><pubDate>Sun, 20 Aug 2023 17:44:07 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/attentionaqkv/</guid><description><![CDATA[<h2 id="è§£ç­”ä¸€">è§£ç­”ä¸€</h2>
<p>æˆ‘ä»¬ç›´æ¥ç”¨torchå®ç°ä¸€ä¸ªSelfAttentionæ¥è¯´ä¸€è¯´ï¼š</p>
<ol>
<li>é¦–å…ˆå®šä¹‰ä¸‰ä¸ªçº¿æ€§å˜æ¢çŸ©é˜µï¼Œquery, key, valueï¼š</li>
</ol>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BertSelfAttention</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">  <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼Œè¿™é‡Œçš„query, key, valueåªæ˜¯ä¸€ç§æ“ä½œ(çº¿æ€§å˜æ¢)çš„åç§°ï¼Œå®é™…çš„Q/K/Væ˜¯å®ƒä»¬ä¸‰ä¸ªçš„è¾“å‡º
2. å‡è®¾ä¸‰ç§æ“ä½œçš„è¾“å…¥éƒ½æ˜¯åŒä¸€ä¸ªçŸ©é˜µ(æš‚ä¸”å…ˆåˆ«ç®¡ä¸ºä»€ä¹ˆè¾“å…¥æ˜¯åŒä¸€ä¸ªçŸ©é˜µ)ï¼Œè¿™é‡Œæš‚ä¸”å®šä¸ºé•¿åº¦ä¸ºLçš„å¥å­ï¼Œæ¯ä¸ªtokençš„ç‰¹å¾ç»´åº¦æ˜¯768ï¼Œé‚£ä¹ˆè¾“å…¥å°±æ˜¯(L, 768)ï¼Œæ¯ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªå­—ï¼Œåƒè¿™æ ·ï¼š

ä¹˜ä»¥ä¸Šé¢ä¸‰ç§æ“ä½œå°±å¾—åˆ°äº†Q/K/Vï¼Œ(L, 768)*(768,768) = (L,768)ï¼Œç»´åº¦å…¶å®æ²¡å˜ï¼Œå³æ­¤åˆ»çš„Q/K/Våˆ†åˆ«ä¸ºï¼š

ä»£ç ä¸º:</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BertSelfAttention</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"> <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden_states</span><span class="p">):</span> <span class="c1"># hidden_states ç»´åº¦æ˜¯(L, 768)</span>
</span></span><span class="line"><span class="cl">     <span class="n">Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>
<p>ç„¶åæ¥å®ç°è¿™ä¸ªæ“ä½œ:
$$Attention(Q,K_i,V_i)\color{red}{\boxed{=softmax(\frac{Q^TK_i}{\sqrt{d_k}})V_i}}$$
â‘  é¦–å…ˆæ˜¯Qå’ŒKçŸ©é˜µä¹˜ï¼Œ(L, 768)*(L, 768)çš„è½¬ç½®=(L,L)ï¼Œçœ‹å›¾ï¼š

é¦–å…ˆç”¨Qçš„ç¬¬ä¸€è¡Œï¼Œå³â€œæˆ‘â€å­—çš„768ç‰¹å¾å’ŒKä¸­â€œæˆ‘â€å­—çš„768ä¸ºç‰¹å¾ç‚¹ä¹˜æ±‚å’Œï¼Œå¾—åˆ°è¾“å‡º(0ï¼Œ0)ä½ç½®çš„æ•°å€¼ï¼Œè¿™ä¸ªæ•°å€¼å°±ä»£è¡¨äº†â€œæˆ‘æƒ³åƒé…¸èœé±¼â€ä¸­â€œæˆ‘â€å­—å¯¹â€œæˆ‘â€å­—çš„æ³¨æ„åŠ›æƒé‡ï¼Œç„¶åæ˜¾è€Œæ˜“è§è¾“å‡ºçš„ç¬¬ä¸€è¡Œå°±æ˜¯â€œæˆ‘â€å­—å¯¹â€œæˆ‘æƒ³åƒé…¸èœé±¼â€é‡Œé¢æ¯ä¸ªå­—çš„æ³¨æ„åŠ›æƒé‡ï¼›æ•´ä¸ªç»“æœè‡ªç„¶å°±æ˜¯â€œæˆ‘æƒ³åƒé…¸èœé±¼â€é‡Œé¢æ¯ä¸ªå­—å¯¹å…¶å®ƒå­—(åŒ…æ‹¬è‡ªå·±)çš„æ³¨æ„åŠ›æƒé‡(å°±æ˜¯ä¸€ä¸ªæ•°å€¼)äº†~</p>
<p>â‘¡ ç„¶åæ˜¯é™¤ä»¥æ ¹å·dimï¼Œè¿™ä¸ªdimå°±æ˜¯768ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦é™¤ä»¥è¿™ä¸ªæ•°å€¼ï¼Ÿä¸»è¦æ˜¯ä¸ºäº†ç¼©å°ç‚¹ç§¯èŒƒå›´ï¼Œç¡®ä¿softmaxæ¢¯åº¦ç¨³å®šæ€§ï¼Œå…·ä½“æ¨å¯¼å¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://zhuanlan.zhihu.com/p/149903065"target="_blank" rel="external nofollow noopener noreferrer">è²ç”Ÿä¸‰åäºŒï¼šSelf-attentionä¸­dot-productæ“ä½œä¸ºä»€ä¹ˆè¦è¢«ç¼©æ”¾<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼Œç„¶åå°±æ˜¯ä¸ºä»€ä¹ˆè¦softmaxï¼Œä¸€ç§è§£é‡Šæ˜¯ä¸ºäº†ä¿è¯æ³¨æ„åŠ›æƒé‡çš„éè´Ÿæ€§ï¼ŒåŒæ—¶å¢åŠ éçº¿æ€§ï¼Œè¿˜æœ‰ä¸€äº›å·¥ä½œå¯¹å»æ‰softmaxè¿›è¡Œäº†å®éªŒï¼Œå¦‚<a href="https://zhuanlan.zhihu.com/p/157490738"target="_blank" rel="external nofollow noopener noreferrer">PaperWeeklyï¼šçº¿æ€§Attentionçš„æ¢ç´¢ï¼šAttentionå¿…é¡»æœ‰ä¸ªSoftmaxå—ï¼Ÿ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>â‘¢ ç„¶åå°±æ˜¯åˆšæ‰çš„æ³¨æ„åŠ›æƒé‡å’ŒVçŸ©é˜µä¹˜äº†ï¼Œå¦‚å›¾ï¼š
</p>
<p>æ³¨æ„åŠ›æƒé‡ x VALUEçŸ©é˜µ = æœ€ç»ˆç»“æœ </br>
é¦–å…ˆæ˜¯â€œæˆ‘â€è¿™ä¸ªå­—å¯¹â€œæˆ‘æƒ³åƒé…¸èœé±¼â€è¿™å¥è¯é‡Œé¢æ¯ä¸ªå­—çš„æ³¨æ„åŠ›æƒé‡ï¼Œå’ŒVä¸­â€œæˆ‘æƒ³åƒé…¸èœé±¼â€é‡Œé¢æ¯ä¸ªå­—çš„ç¬¬ä¸€ç»´ç‰¹å¾è¿›è¡Œç›¸ä¹˜å†æ±‚å’Œï¼Œè¿™ä¸ªè¿‡ç¨‹å…¶å®å°±ç›¸å½“äºç”¨æ¯ä¸ªå­—çš„æƒé‡å¯¹æ¯ä¸ªå­—çš„ç‰¹å¾è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œç„¶åå†ç”¨â€œæˆ‘â€è¿™ä¸ªå­—å¯¹å¯¹â€œæˆ‘æƒ³åƒé…¸èœé±¼â€è¿™å¥è¯é‡Œé¢æ¯ä¸ªå­—çš„æ³¨æ„åŠ›æƒé‡å’ŒVä¸­â€œæˆ‘æƒ³åƒé…¸èœé±¼â€é‡Œé¢æ¯ä¸ªå­—çš„ç¬¬äºŒç»´ç‰¹å¾è¿›è¡Œç›¸ä¹˜å†æ±‚å’Œï¼Œä¾æ¬¡ç±»æ¨~æœ€ç»ˆä¹Ÿå°±å¾—åˆ°äº†(L,768)çš„ç»“æœçŸ©é˜µï¼Œå’Œè¾“å…¥ä¿æŒä¸€è‡´~</p>
<p>æ•´ä¸ªè¿‡ç¨‹åœ¨è‰ç¨¿çº¸ä¸Šç”»ä¸€ç”»ç®€å•çš„çŸ©é˜µä¹˜å°±å‡ºæ¥äº†ï¼Œä¸€ç›®äº†ç„¶~æœ€åä¸Šä»£ç ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BertSelfAttention</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"> <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_head_size</span><span class="p">)</span> <span class="c1"># è¾“å…¥768ï¼Œ è¾“å‡º768</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">hidden_states</span><span class="p">):</span> <span class="c1"># hidden_states ç»´åº¦æ˜¯(L, 768)</span>
</span></span><span class="line"><span class="cl">     <span class="n">Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">hidden_states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">attention_scores</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">     <span class="n">attention_scores</span> <span class="o">=</span> <span class="n">attention_scores</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attention_head_size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">attention_probs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span><span class="n">attention_scores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">attention_probs</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="n">out</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä¸ºä»€ä¹ˆå«<strong>è‡ªæ³¨æ„åŠ›ç½‘ç»œ</strong>ï¼Ÿ</br>
å› ä¸ºå¯ä»¥çœ‹åˆ°Q/K/Véƒ½æ˜¯é€šè¿‡åŒä¸€å¥è¯çš„è¾“å…¥ç®—å‡ºæ¥çš„ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æµç¨‹ä¹Ÿå°±æ˜¯ä¸€å¥è¯å†…æ¯ä¸ªå­—å¯¹å…¶å®ƒå­—(åŒ…æ‹¬è‡ªå·±)çš„æƒé‡åˆ†é…ï¼›é‚£å¦‚æœä¸æ˜¯è‡ªæ³¨æ„åŠ›å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼ŒQæ¥è‡ªäºå¥Aï¼ŒKã€Væ¥è‡ªäºå¥Bå³å¯~</br></p>
</li>
<li>
<p>æ³¨æ„ï¼ŒK/Vä¸­ï¼Œå¦‚æœåŒæ—¶æ›¿æ¢ä»»æ„ä¸¤ä¸ªå­—çš„ä½ç½®ï¼Œå¯¹æœ€ç»ˆçš„ç»“æœæ˜¯ä¸ä¼šæœ‰å½±å“çš„ï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œå¯ä»¥è‡ªå·±åœ¨è‰ç¨¿çº¸ä¸Šç”»ä¸€ç”»çŸ©é˜µä¹˜ï¼›ä¹Ÿå°±æ˜¯è¯´æ³¨æ„åŠ›æœºåˆ¶æ˜¯æ²¡æœ‰ä½ç½®ä¿¡æ¯çš„ï¼Œä¸åƒCNN/RNN/LSTMï¼›è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦å¼•å…¥positional embedingçš„åŸå› ã€‚</p>
</li>
</ol>
<h2 id="è§£ç­”äºŒ">è§£ç­”äºŒ</h2>
<p>å…¶å®ç›´æ¥ç”¨é‚±é”¡é¹è€å¸ˆPPTé‡Œçš„ä¸€å¼ å›¾å°±å¯ä»¥ç›´è§‚ç†è§£â€”â€”å‡è®¾Dæ˜¯è¾“å…¥åºåˆ—çš„å†…å®¹ï¼Œå®Œå…¨å¿½ç•¥çº¿æ€§å˜æ¢çš„è¯å¯ä»¥è¿‘ä¼¼è®¤ä¸ºQ=K=V=D(æ‰€ä»¥å«åšSelf-Attentionï¼Œå› ä¸ºè¿™æ˜¯è¾“å…¥çš„åºåˆ—å¯¹å®ƒè‡ªå·±çš„æ³¨æ„åŠ›)ï¼Œäºæ˜¯åºåˆ—ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ç»è¿‡Self-Attentionä¹‹åçš„è¡¨ç¤ºå°±å¯ä»¥è¿™æ ·å±•ç°ï¼š</p>
<p></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒTheè¿™ä¸ªè¯çš„è¡¨ç¤ºï¼Œå®é™…ä¸Šæ˜¯æ•´ä¸ªåºåˆ—åŠ æƒæ±‚å’Œçš„ç»“æœâ€”â€”æƒé‡ä»å“ªæ¥ï¼Ÿç‚¹ç§¯ä¹‹åSoftmaxå¾—åˆ°â€”â€”è¿™é‡ŒSoftmax(QK)å°±æ˜¯æ±‚æƒé‡çš„ä½“ç°ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå‘é‡ç‚¹ç§¯çš„å€¼å¯ä»¥è¡¨å¾è¯ä¸è¯ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œè€Œæ­¤å¤„çš„â€œæ•´ä¸ªåºåˆ—â€åŒ…æ‹¬Theè¿™ä¸ªè¯è‡ªå·±(å†ä¸€æ¬¡å¼ºè°ƒè¿™æ˜¯Self-Attention)ï¼Œæ‰€ä»¥æœ€åè¾“å‡ºçš„è¯çš„è¡¨ç¤ºï¼Œå…¶â€œä¸»è¦æˆåˆ†â€å°±ä¸»è¦åœ°åŒ…å«å®ƒè‡ªèº«å’Œè·Ÿå®ƒç›¸ä¼¼çš„è¯çš„è¡¨ç¤ºï¼Œå…¶ä»–æ— å…³çš„è¯çš„è¡¨ç¤ºå¯¹åº”çš„æƒé‡å°±ä¼šæ¯”è¾ƒä½ã€‚</p>
<h2 id="è§£ç­”ä¸‰">è§£ç­”ä¸‰</h2>
<p>é¦–å…ˆé™„ä¸Šé“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/37601161"target="_blank" rel="external nofollow noopener noreferrer">å¼ ä¿Šæ—ï¼šæ·±åº¦å­¦ä¹ ä¸­çš„æ³¨æ„åŠ›æ¨¡å‹(2017ç‰ˆ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a> ã€‚è¿™ä¸ªå‡ ä¹æ˜¯æˆ‘è¯»åˆ°è¿‡çš„è®²è§£Attentionæœ€ä¸ºé€å½»çš„ç¯‡ç« ä¹‹ä¸€äº†ã€‚</p>
<p>Q(Querry)ä»£è¡¨æŸ¥è¯¢å€¼ï¼Œå¯¹åº”Decoderçš„H(t-1)çŠ¶æ€ã€‚è¿™é‡Œè¦æ­£ç¡®ç†è§£H(t-1)ï¼Œæƒ³è¦è§£ç å‡ºtæ—¶åˆ»çš„è¾“å‡ºï¼Œä½ é€å…¥Decoderçš„å¿…ç„¶æœ‰å‰ä¸€æ—¶åˆ»è®¡ç®—å‡ºçš„éšçŠ¶æ€ã€‚å¥½äº†ï¼Œæ‰€è°“æŸ¥è¯¢ï¼Œå°±æ˜¯ä½ è¦æ‹¿ç€è¿™ä¸ªDecoderä¸­çš„H(t-1)å»å’ŒEncoderä¸­å„ä¸ªæ—¶åˆ»çš„éšçŠ¶æ€<a href="%e4%b9%9f%e5%b0%b1%e6%98%af%e5%90%84%e4%b8%aaKey">H(1), H(2), &hellip; , H(T)</a>å»æ¯”ï¼Œä¹Ÿå°±æ˜¯äºŒè€…è®¡ç®—ç›¸ä¼¼åº¦(å¯¹åº”äºæ–‡çŒ®ä¸­çš„å„ç§energyå‡½æ•°)ã€‚æœ€åç®—å‡ºæ¥çš„ç»“æœç”¨Softmaxå½’ä¸€åŒ–ï¼Œè¿™ä¸ªç®—å‡ºæ¥çš„æƒé‡å°±æ˜¯å¸¦æœ‰æ³¨æ„åŠ›æœºåˆ¶çš„æƒé‡ï¼Œå…¶å®åœ¨ç¿»è¯‘ä»»åŠ¡ä¸­ï¼ŒKeyå’ŒValueæ˜¯ç›¸ç­‰çš„ã€‚åœ¨Transformerçš„å®ç°æºç ä¸­ï¼ŒKeyå’ŒValueçš„åˆå§‹å€¼ä¹Ÿæ˜¯ç›¸ç­‰çš„ã€‚æœ‰äº†è¿™ä¸ªæƒé‡ä¹‹åï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªæƒé‡å¯¹Valueè¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œç”Ÿæˆçš„è¿™ä¸ªæ–°çš„å‘é‡å°±æ˜¯å¸¦æœ‰æ³¨æ„åŠ›æœºåˆ¶çš„è¯­ä¹‰å‘é‡ Context vectorï¼Œè€Œè¿™ä¸ªè¯­ä¹‰å‘é‡ä¼šæƒè¡¡Targetä¸Sourceçš„tokenä¸tokençš„å…³ç³»ï¼Œä»è€Œå®ç°è§£ç è¾“å‡ºæ—¶ï¼Œä¸Sourceä¸­â€œçœŸæ­£æœ‰å†³å®šæ„ä¹‰â€çš„tokenå…³è”ã€‚</p>
<p>å§‘ä¸”ç”»è›‡æ·»è¶³çš„å†è¯´å‡ å¥ï¼š
é¦–å…ˆï¼ŒAttentionæœºåˆ¶æ˜¯ç”±Encoder-Decoderæ¶æ„è€Œæ¥ï¼Œä¸”æœ€åˆæ˜¯ç”¨äºå®ŒæˆNLPé¢†åŸŸä¸­çš„ç¿»è¯‘(Translation)ä»»åŠ¡ã€‚é‚£ä¹ˆè¾“å…¥è¾“å‡ºå°±æ˜¯éå¸¸æ˜æ˜¾çš„ Source-Targetçš„å¯¹åº”å…³ç³»ï¼Œç»å…¸çš„Seq2Seqç»“æ„æ˜¯ä»Encoderç”Ÿæˆå‡ºä¸€ä¸ªè¯­ä¹‰å‘é‡(Context vector)è€Œä¸å†å˜åŒ–ï¼Œç„¶åå°†è¿™ä¸ªè¯­ä¹‰å‘é‡é€å…¥Decoderé…åˆè§£ç è¾“å‡ºã€‚è¿™ç§æ–¹æ³•çš„æœ€å¤§é—®é¢˜å°±æ˜¯è¿™ä¸ªè¯­ä¹‰å‘é‡ï¼Œæˆ‘ä»¬æ˜¯å¸Œæœ›å®ƒä¸€æˆä¸å˜å¥½å‘¢ï¼Ÿè¿˜æ˜¯å®ƒæœ€å¥½èƒ½é…åˆDecoderåŠ¨æ€è°ƒæ•´è‡ªå·±ï¼Œæ¥ä½¿Targetä¸­çš„æŸäº›tokenä¸Sourceä¸­çš„çœŸæ­£â€œæœ‰å†³å®šæ„ä¹‰â€çš„tokenå…³è”èµ·æ¥å¥½å‘¢ï¼Ÿ
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰Attentionæœºåˆ¶çš„åŸå› ã€‚è¯´åˆ°åº•ï¼ŒAttentionæœºåˆ¶å°±æ˜¯æƒ³ç”Ÿæˆä¼šåŠ¨æ€å˜åŒ–çš„è¯­ä¹‰å‘é‡æ¥é…åˆè§£ç è¾“å‡ºã€‚è€Œæ–°è´µ Self-Attentionåˆ™æ˜¯ä¸ºäº†è§£å†³Targetä¸Sourceå„è‡ªå†…éƒ¨tokenä¸tokençš„å…³ç³»ã€‚åœ¨Transformerä¸­ï¼Œè¿™ä¸¤ç§æ³¨æ„åŠ›æœºåˆ¶å¾—åˆ°äº†æœ‰æœºçš„ç»Ÿä¸€ï¼Œé‡Šæ”¾å‡ºäº†å¼‚å¸¸æƒŠäººçš„æ½œåŠ›ã€‚</p>
<p>ref:</br>
[1]. <a href="https://mp.weixin.qq.com/s/v7N3lhMBSdoGCz4K3TmsmA"target="_blank" rel="external nofollow noopener noreferrer">https://mp.weixin.qq.com/s/v7N3lhMBSdoGCz4K3TmsmA<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
]]></description></item><item><title>Effective STL [30] | ç¡®ä¿ç›®æ ‡åŒºé—´è¶³å¤Ÿå¤§</title><link>https://jianye0428.github.io/posts/clause_30/</link><pubDate>Sat, 19 Aug 2023 15:32:43 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_30/</guid><description><![CDATA[<p>STLå®¹å™¨åœ¨è¢«æ·»åŠ æ—¶ï¼ˆé€šè¿‡insertã€push_frontã€push_backç­‰ï¼‰è‡ªåŠ¨æ‰©å±•å®ƒä»¬è‡ªå·±æ¥å®¹çº³æ–°å¯¹è±¡ã€‚</p>
<h2 id="æ’å…¥æ•°æ®">æ’å…¥æ•°æ®</h2>
<p><strong>å°¾éƒ¨æ’å…¥ back_inserter</strong></p>
<p>å½“ä½ æƒ³å‘å®¹å™¨ä¸­æ’å…¥å¯¹è±¡ä½†å¹¶æ²¡æœ‰å‘Šè¯‰STLä»–ä»¬æ‰€æƒ³çš„æ—¶ï¼Œé—®é¢˜å‡ºç°äº†:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">transmogrify</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">);</span> <span class="c1">// è‡ªå®šä¹‰çš„è¿™ä¸ªå‡½æ•°ä»xäº§ç”Ÿä¸€äº›æ–°å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠæ•°æ®æ”¾å…¥values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠtransmogrifyåº”ç”¨äºvaluesä¸­çš„æ¯ä¸ªå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1">// æŠŠè¿™ä¸ªè¿”å›çš„valuesé™„åŠ åˆ°results
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">results</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">transmogrify</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è¿™æ®µä»£ç æœ‰bugï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>transformè¢«å‘ŠçŸ¥å®ƒçš„ç›®çš„åŒºé—´æ˜¯ä»<code>results.end()</code>å¼€å§‹çš„ï¼Œæ‰€ä»¥é‚£å°±æ˜¯å¼€å§‹å†™åœ¨valuesçš„æ¯ä¸ªå…ƒç´ ä¸Šè°ƒç”¨<code>transmogrify</code>çš„ç»“æœçš„åœ°æ–¹ã€‚</p>
<p>å°±åƒæ‰€æœ‰ä½¿ç”¨ç›®æ ‡åŒºé—´çš„ç®—æ³•ï¼Œ<code>transform</code>é€šè¿‡å¯¹ç›®æ ‡åŒºé—´çš„å…ƒç´ èµ‹å€¼çš„æ–¹æ³•å†™å…¥ç»“æœï¼Œ<code>transform</code>ä¼šæŠŠ<code>transmogrify</code>åº”ç”¨äº<code>values[0]</code>å¹¶æŠŠç»“æœèµ‹ç»™<code>*results.end()</code>ã€‚</p>
<p>ç„¶åå®ƒä¼šæŠŠ<code>transmogrify</code>åº”ç”¨äº<code>value[1]</code>å¹¶æŠŠç»“æœèµ‹ç»™<code>*(results.end()+1)</code>ã€‚</p>
<p>é‚£åªèƒ½å¸¦æ¥ç¾éš¾ï¼Œå› ä¸ºåœ¨<code>*results.end()</code>æ²¡æœ‰å¯¹è±¡ï¼Œ<code>*(results.end()+1)</code>ä¹Ÿæ²¡æœ‰ï¼å› ä¸º<code>transform</code>å¹¶æ²¡æœ‰åœ¨å°¾éƒ¨åˆ›é€ æ–°çš„å¯¹è±¡ã€‚</p>
<p>è°ƒç”¨<code>transform</code>æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºå®ƒä¼šç»™ä¸å­˜åœ¨çš„å¯¹è±¡èµ‹å€¼ã€‚</p>
<p><strong>æ­£ç¡®åšæ³•</strong></p>
<p>æŠŠ<code>transform</code>çš„ç»“æœæ”¾å…¥<code>results</code>å®¹å™¨çš„ç»“å°¾çš„æ–¹å¼æ˜¯è°ƒç”¨<code>back_inserter</code>æ¥äº§ç”ŸæŒ‡å®šç›®æ ‡åŒºé—´èµ·ç‚¹çš„è¿­ä»£å™¨:</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠtransmogrifyåº”ç”¨äºvaluesä¸­çš„æ¯ä¸ªå¯¹è±¡ï¼Œåœ¨resultsçš„ç»“å°¾æ’å…¥è¿”å›çš„values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">back_inserter</span><span class="p">(</span><span class="n">results</span><span class="p">),</span><span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å†…éƒ¨ï¼Œ<code>back_inserter</code>è¿”å›çš„è¿­ä»£å™¨ä¼šè°ƒç”¨<code>push_back</code>ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ä»»ä½•æä¾›<code>push_back</code>çš„å®¹å™¨ä¸Šä½¿ç”¨<code>back_inserter</code>(ä¹Ÿå°±æ˜¯ä»»ä½•æ ‡å‡†åºåˆ—å®¹å™¨: <code>vector</code>ã€<code>string</code>ã€<code>deque</code>å’Œ<code>list</code>)ã€‚</p>
<p><strong>å‰ç«¯æ’å…¥ front_inserter</strong></p>
<p>å¦‚æœä½ æƒ³è®©ä¸€ä¸ªç®—æ³•åœ¨å®¹å™¨çš„å‰ç«¯æ’å…¥ä¸œè¥¿ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>front_inserter</code>ã€‚</p>
<p>åœ¨å†…éƒ¨ï¼Œ<code>front_inserter</code>åˆ©ç”¨äº†<code>push_front</code>ï¼Œæ‰€ä»¥<code>front_insert</code>åªå’Œæä¾›é‚£ä¸ªæˆå‘˜å‡½æ•°çš„å®¹å™¨é…åˆ(ä¹Ÿå°±æ˜¯<code>deque</code>å’Œ<code>list</code>):</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// resultsç°åœ¨æ˜¯list
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">front_inserter</span><span class="p">(</span><span class="n">results</span><span class="p">),</span><span class="n">transmogrify</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åœ¨resultså‰ç«¯   ä»¥ååº   æ’å…¥transformçš„ç»“æœ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸º<code>front_inserter</code>ç”¨<code>push_front</code>æŠŠæ¯ä¸ªå¯¹è±¡æ·»åŠ åˆ°<code>results</code>ï¼Œ<code>results</code>ä¸­çš„å¯¹è±¡é¡ºåºä¼šå’Œ<code>values</code>ä¸­å¯¹åº”çš„å¯¹è±¡é¡ºåºç›¸åã€‚</p>
<p><code>vector</code>ä¸æä¾›<code>push_front</code>ï¼Œæ‰€ä»¥<code>front_inserter</code>ä¸èƒ½ç”¨äº<code>vector</code>ã€‚</p>
<p><strong>åŒåºæ’å…¥</strong></p>
<p>å¦‚æœä½ è¦<code>transform</code>æŠŠè¾“å‡ºç»“æœæ”¾åœ¨<code>results</code>å‰ç«¯ï¼Œä½†ä½ ä¹Ÿè¦è¾“å‡ºå’Œ<code>values</code>ä¸­å¯¹åº”çš„å¯¹è±¡é¡ºåºç›¸åŒï¼Œåªè¦ä»¥ç›¸åçš„é¡ºåºè¿­ä»£<code>values</code>:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1">// åœ¨resultså‰ç«¯ æ’å…¥transformçš„ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">rbegin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">rend</span><span class="p">(),</span><span class="n">front_inserter</span><span class="p">(</span><span class="n">results</span><span class="p">),</span><span class="n">transmogrify</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä¿æŒç›¸å¯¹çš„å¯¹è±¡é¡ºåº
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä»»æ„ä½ç½®æ’å…¥ inserter</strong></p>
<p><code>front_inserter</code>è®©ä½ å¼ºåˆ¶ç®—æ³•åœ¨å®¹å™¨å‰ç«¯æ’å…¥å®ƒä»¬çš„ç»“æœï¼Œ<code>back_inserter</code>è®©ä½ å‘Šè¯‰å®ƒä»¬æŠŠç»“æœæ”¾åœ¨å®¹å™¨åç«¯ï¼Œæœ‰ç‚¹æƒŠäººçš„æ˜¯<code>inserter</code>å…è®¸ä½ å¼ºåˆ¶ç®—æ³•æŠŠå®ƒä»¬çš„ç»“æœæ’å…¥å®¹å™¨ä¸­çš„ä»»æ„ä½ç½®:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Šï¼Œé™¤äº†ç°åœ¨åœ¨è°ƒç”¨transformå‰ resultså·²ç»æœ‰ä¸€äº›æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠtransmogrifyçš„ç»“æœæ’å…¥resultsçš„ä¸­é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">inserter</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">results</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">results</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ’å…¥æ•ˆç‡">æ’å…¥æ•ˆç‡</h2>
<p>ä¸ç®¡ä½ æ˜¯å¦ä½¿ç”¨äº†<code>back_inserter</code>ã€<code>front_inserter</code>æˆ–<code>inserter</code>ï¼Œ<code>transform</code>ä¼šå¯¹ç›®çš„åŒºé—´æ¯æ¬¡å†™å…¥ä¸€ä¸ªå€¼ï¼Œä½ æ— æ³•æ”¹å˜ã€‚</p>
<p>å½“ä½ è¦æ’å…¥çš„å®¹å™¨æ˜¯<code>vector</code>æˆ–<code>string</code>æ—¶ï¼Œä½ å¯ä»¥æœ€å°åŒ–è¿™ä¸ªä»£ä»·ï¼Œ<strong>é¢„å…ˆè°ƒç”¨<code>reserve</code></strong>ã€‚</p>
<p>ä½ ä»ç„¶è¦æ‰¿å—æ¯æ¬¡å‘ç”Ÿæ’å…¥æ—¶ç§»åŠ¨å…ƒç´ çš„å¼€é”€ï¼Œä½†è‡³å°‘ä½ é¿å…äº†é‡æ–°åˆ†é…å®¹å™¨çš„å†…åœ¨å†…å­˜:</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">results</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç¡®å®šresultsè‡³å°‘è¿˜èƒ½è£…å¾—ä¸‹values.size()ä¸ªå…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Šï¼Œä½†resultsæ²¡æœ‰ä»»ä½•é‡æ–°åˆ†é…æ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">inserter</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">results</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">results</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ä½¿ç”¨<code>reserve</code>æ¥æé«˜ä¸€è¿ä¸²æ’å…¥çš„æ•ˆç‡æ—¶ï¼Œæ€»æ˜¯åº”è¯¥è®°ä½<code>reserve</code><strong>åªå¢åŠ å®¹å™¨çš„å®¹é‡ï¼šå®¹å™¨çš„å¤§å°ä»ç„¶æ²¡æœ‰æ”¹å˜</strong>ã€‚</p>
<p>å³ä½¿è°ƒç”¨å®Œ<code>reserve</code>ï¼Œå½“ä½ æƒ³è¦è®©å®¹å™¨æŠŠæ–°å…ƒç´ åŠ å…¥åˆ°<code>vector</code>æˆ–<code>string</code>æ—¶ï¼Œä½ ä¹Ÿå¿…é¡»å¯¹ç®—æ³•ä½¿ç”¨æ’å…¥è¿­ä»£å™¨(æ¯”å¦‚ï¼Œä»<code>back_inserter</code>ã€<code>front_inserter</code>æˆ–<code>inserter</code>è¿”å›çš„è¿­ä»£å™¨ä¹‹ä¸€)ï¼Œå› ä¸ºèµ‹å€¼åªåœ¨ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æ“ä½œæ—¶æœ‰æ„ä¹‰ï¼Œè€Œä¸æ˜¯åœ¨ä¸€ä¸ªå¯¹è±¡å’Œä¸€å—åŸå§‹çš„æ¯”ç‰¹ä¹‹é—´ã€‚</p>
<p>ç¬¬ä¸€ä¸ªä¾‹å­æ­£ç¡®çš„å†™æ³•:</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">results</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1">// æŠŠtransmogrifyçš„ç»“æœå†™å…¥resultsçš„ç»“å°¾ï¼Œå¤„ç†æ—¶é¿å…äº†é‡æ–°åˆ†é…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">back_inserter</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="p">,</span> <span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è¦†ç›–åŸå§‹æ•°æ®">è¦†ç›–åŸå§‹æ•°æ®</h2>
<p>æœ‰æ—¶å€™ä½ è¦è¦†ç›–ç°æœ‰å®¹å™¨çš„å…ƒç´ è€Œä¸æ˜¯æ’å…¥æ–°çš„ã€‚</p>
<p><strong>å½“è¿™ç§æƒ…å†µæ—¶ï¼Œä½ ä¸éœ€è¦æ’å…¥è¿­ä»£å™¨ï¼Œä½†ä½ ä»ç„¶éœ€è¦æŒ‰ç…§æœ¬æ¡æ¬¾çš„å»ºè®®æ¥ç¡®ä¿ä½ çš„ç›®çš„åŒºé—´è¶³å¤Ÿå¤§ã€‚</strong></p>
<p>å‡è®¾ä½ è®©<code>transform</code>è¦†ç›–<code>results</code>çš„å…ƒç´ ã€‚å¦‚æœ<code>results</code>è‡³å°‘æœ‰å’Œ<code>values</code>ä¸€æ ·å¤šçš„å…ƒç´ ï¼Œé‚£å¾ˆç®€å•ã€‚å¦‚æœæ²¡æœ‰ï¼Œ ä½ ä¹Ÿå¿…é¡»ä½¿ç”¨<code>resize</code>æ¥ç¡®ä¿å®ƒæœ‰ã€‚</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç¡®ä¿resultsè‡³å°‘å’Œvaluesä¸€æ ·å¤§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">()){</span>
</span></span><span class="line"><span class="cl"> <span class="n">results</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è¦†ç›–values.size()ä¸ª resultsçš„å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">results</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…ä½ å¯ä»¥æ¸…ç©ºresultsç„¶åç”¨é€šå¸¸çš„æ–¹å¼ä½¿ç”¨æ’å…¥è¿­ä»£å™¨:</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// é”€æ¯resultsä¸­çš„æ‰€æœ‰å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">results</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä¿ç•™è¶³å¤Ÿç©ºé—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">results</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠtransformåœ°è¿”å›å€¼// æ”¾å…¥results
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">values</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">back_inserter</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">transmogrify</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç»“è®º">ç»“è®º</h2>
<p>æ— è®ºä½•æ—¶ä½ ä½¿ç”¨ä¸€ä¸ªè¦æ±‚æŒ‡å®šç›®çš„åŒºé—´çš„ç®—æ³•ï¼Œç¡®ä¿ç›®çš„åŒºé—´å·²ç»è¶³å¤Ÿå¤§æˆ–è€…åœ¨ç®—æ³•æ‰§è¡Œæ—¶å¯ä»¥å¢åŠ å¤§å°ã€‚</p>
<p>å¦‚æœä½ é€‰æ‹©å¢åŠ å¤§å°ï¼Œå°±ä½¿ç”¨æ’å…¥è¿­ä»£å™¨ï¼Œæ¯”å¦‚<code>ostream_iterators</code>æˆ–ä»<code>back_inserter</code>ã€<code>front_inserter</code>æˆ–<code>inserter</code>è¿”å›çš„è¿­ä»£å™¨ã€‚</p>
]]></description></item><item><title>Effective STL [29] | éœ€è¦ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦è¾“å…¥æ—¶è€ƒè™‘ä½¿ç”¨istreambuf_iterator</title><link>https://jianye0428.github.io/posts/clause_29/</link><pubDate>Fri, 18 Aug 2023 07:55:51 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_29/</guid><description><![CDATA[<h2 id="istream_iterator-æ‹·è´æ–‡ä»¶">istream_iterator æ‹·è´æ–‡ä»¶</h2>
<p>å‡è®¾è¦æŠŠä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æ‹·è´åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ä¸­ã€‚ä¼¼ä¹å¯ä»¥ç”¨ä¸€ç§å¾ˆæœ‰é“ç†çš„æ–¹æ³•å®Œæˆï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">ifstream</span> <span class="nf">inputFile</span><span class="p">(</span><span class="s">&#34;interestingData.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="nf">fileData</span><span class="p">((</span><span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">inputFile</span><span class="p">)),</span> <span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æŠŠinputFileè¯»å…¥fileDataï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1">// å…³äºä¸ºä»€ä¹ˆå®ƒä¸æ˜¯å¾ˆæ­£ç¡®è¯·çœ‹ä¸‹æ–‡å…³äºè¿™ä¸ªè¯­æ³•çš„è­¦å‘Šå‚è§æ¡æ¬¾6
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¾ˆå¿«ä½ å°±ä¼šå‘ç°è¿™ç§æ–¹æ³•æ— æ³•æŠŠæ–‡ä»¶ä¸­çš„ç©ºæ ¼æ‹·è´åˆ°å­—ç¬¦ä¸²ä¸­ã€‚</p>
<p>é‚£æ˜¯å› ä¸º<code>istream_iterators</code>ä½¿ç”¨<code>operator&gt;&gt;</code>å‡½æ•°æ¥è¿›è¡ŒçœŸçš„è¯»å–ï¼Œè€Œä¸”<code>operator&gt;&gt;</code>å‡½æ•°åœ¨é»˜è®¤æƒ…å†µä¸‹å¿½ç•¥ç©ºæ ¼ã€‚</p>
<p>å‡å¦‚ä½ æƒ³ä¿ç•™ç©ºæ ¼ï¼Œä½ è¦çš„åšå°±æ˜¯è¦†ç›–é»˜è®¤æƒ…å†µã€‚åªè¦æ¸…é™¤è¾“å…¥æµçš„skipwsæ ‡å¿—å°±è¡Œäº†ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">ifstream</span> <span class="nf">inputFile</span><span class="p">(</span><span class="s">&#34;interestingData.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">inputFile</span><span class="p">.</span><span class="n">unset</span><span class="p">(</span><span class="n">ios</span><span class="o">::</span><span class="n">skipws</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å…³é—­inputFileçš„å¿½ç•¥ç©ºæ ¼æ ‡å¿—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">string</span> <span class="nf">fileData</span><span class="p">((</span><span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">inputFile</span><span class="p">)),</span> <span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨inputFileä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ‹·è´åˆ°fileDataä¸­äº†ã€‚</p>
<p><strong>æ‹·è´é€Ÿåº¦</strong></p>
<p>ä½ ä¼šå‘ç°å®ƒä»¬çš„æ‹·è´é€Ÿåº¦ä¸åƒä½ æƒ³è±¡çš„é‚£ä¹ˆå¿«ã€‚</p>
<p><code>istream_iterators</code>æ‰€ä¾é çš„<code>operator&gt;&gt;</code>å‡½æ•°è¿›è¡Œçš„æ˜¯æ ¼å¼åŒ–è¾“å…¥ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡ä½ è°ƒç”¨çš„æ—¶å€™å®ƒä»¬éƒ½å¿…é¡»åšå¤§é‡å·¥ä½œï¼š</p>
<ol>
<li>
<p>å¿…é¡»å»ºç«‹å’Œé”€æ¯å²—å“¨ï¼ˆsentryï¼‰å¯¹è±¡ï¼ˆä¸ºæ¯ä¸ª<code>operator&gt;&gt;</code>è°ƒç”¨è¿›è¡Œå»ºç«‹å’Œæ¸…é™¤æ´»åŠ¨çš„ç‰¹æ®Šçš„<code>iostream</code>å¯¹è±¡ï¼‰ï¼›</p>
</li>
<li>
<p>å¿…é¡»æ£€æŸ¥å¯èƒ½å½±å“å®ƒä»¬è¡Œä¸ºçš„æµæ ‡å¿—ï¼ˆæ¯”å¦‚skipwsï¼‰ï¼›</p>
</li>
<li>
<p>å¿…é¡»è¿›è¡Œå…¨é¢çš„è¯»å–é”™è¯¯æ£€æŸ¥ï¼›</p>
</li>
<li>
<p>å¦‚æœå®ƒä»¬é‡åˆ°é—®é¢˜ï¼Œå®ƒä»¬å¿…é¡»æ£€æŸ¥æµçš„å¼‚å¸¸æ©ç æ¥å†³å®šæ˜¯å¦è¯¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</p>
</li>
</ol>
<p>å¦‚æœè¿›è¡Œæ ¼å¼åŒ–è¾“å…¥ï¼Œé‚£äº›éƒ½æ˜¯é‡è¦çš„æ´»åŠ¨ï¼Œä½†å¦‚æœä½ éœ€è¦çš„åªæ˜¯ä»è¾“å…¥æµä¸­æŠ“å–ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£å°±è¿‡åº¦äº†ã€‚</p>
<h2 id="istreambuf_iterators-æ‹·è´æ–‡ä»¶">istreambuf_iterators æ‹·è´æ–‡ä»¶</h2>
<p>ä½ å¯ä»¥åƒ<code>istream_iterator</code>ä¸€æ ·ä½¿ç”¨<code>istreambuf_iterator</code>ï¼Œä½†<code>istream_iterator&lt;char&gt;</code>å¯¹è±¡ä½¿ç”¨<code>operator&gt;&gt;</code>æ¥ä»è¾“å…¥æµä¸­è¯»å–å•ä¸ªå­—ç¬¦ã€‚ <code>istreambuf_iterator</code>å¯¹è±¡è¿›å…¥æµçš„ç¼“å†²åŒºå¹¶ç›´æ¥è¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚ï¼ˆæ›´æ˜ç¡®åœ°è¯´ï¼Œ<code>istreambuf_iterator&lt;char&gt;</code> å¯¹è±¡ä»ä¸€ä¸ª<code>istream s</code>ä¸­è¯»å–ä¼šè°ƒç”¨<code>s.rdbuf()-&gt;sgetc()</code>æ¥è¯»<code>s</code>çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚ï¼‰æŠŠæˆ‘ä»¬çš„æ–‡ä»¶è¯»å–ä»£ç æ”¹ä¸ºä½¿ç”¨<code>istreambuf_iterator</code>ç›¸å½“ç®€å•ï¼Œå¤§å¤šæ•°Visual Basicç¨‹åºå‘˜éƒ½å¯ä»¥åœ¨ä¸¤æ¬¡å°è¯•å†…åšå¯¹ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">ifstream</span> <span class="nf">inputFile</span><span class="p">(</span><span class="s">&#34;interestingData.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="nf">fileData</span><span class="p">((</span><span class="n">istreambuf_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">inputFile</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl"><span class="n">istreambuf_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„è¿™é‡Œä¸éœ€è¦â€œ<code>unset</code>â€ <code>skipws</code>æ ‡å¿—ï¼Œ<code>istreambuf_iterator</code>ä¸å¿½ç•¥ä»»ä½•å­—ç¬¦ã€‚å®ƒä»¬åªæŠ“å–æµç¼“å†²åŒºçš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚</p>
<p>ç›¸å¯¹äº<code>istream_iterator</code>ï¼Œå®ƒä»¬æŠ“å–å¾—æ›´å¿«ã€‚</p>
<p>å¦‚æœä½ éœ€è¦ä¸€ä¸ªä¸€ä¸ªåœ°è¯»å–æµä¸­çš„å­—ç¬¦ï¼Œä½ ä¸éœ€è¦æ ¼å¼åŒ–è¾“å…¥çš„å¨åŠ›ï¼Œä½ å…³å¿ƒçš„æ˜¯å®ƒä»¬èŠ±å¤šå°‘æ—¶é—´æ¥è¯»å–æµï¼Œå’Œæ˜æ˜¾çš„æ€§èƒ½æé«˜ç›¸æ¯”ï¼Œä¸ºæ¯ä¸ªè¿­ä»£å™¨å¤šé”®å…¥ä¸‰ä¸ªå­—ç¬¦çš„ä»£ä»·æ˜¯å¾®å¼±çš„ã€‚å¯¹äºæ— æ ¼å¼çš„ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦è¾“å…¥ï¼Œä½ æ€»æ˜¯åº”è¯¥è€ƒè™‘ä½¿ç”¨<code>istreambuf_iterator</code>ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>å½“ä½ äº†è§£å®ƒä¹‹åï¼Œä½ ä¹Ÿåº”è¯¥è€ƒè™‘æŠŠ<code>ostreambuf_iterator</code>ç”¨äºç›¸åº”çš„æ— æ ¼å¼ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦è¾“å‡ºçš„ä½œã€‚</p>
<p>å®ƒä»¬æ²¡æœ‰äº†<code>ostream_iterator</code>çš„å¼€é”€ï¼ˆå’Œçµæ´»æ€§ï¼‰ï¼Œæ‰€ä»¥å®ƒä»¬é€šå¸¸ä¹Ÿåšå¾—æ›´å¥½ã€‚</p>
]]></description></item><item><title>Effective STL [28] | äº†è§£å¦‚ä½•é€šè¿‡reverse_iteratorçš„baseå¾—åˆ°iterator</title><link>https://jianye0428.github.io/posts/clause_28/</link><pubDate>Thu, 17 Aug 2023 20:04:40 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_28/</guid><description><![CDATA[<h2 id="example">Example</h2>
<p>é€šè¿‡reverse_iteratorçš„baseåˆå§‹åŒ–ä¸€ä¸ªiterator:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// å‚è§æ¡æ¬¾14
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="err">ï¼›</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// å‘vectoræ’å…¥1åˆ°5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">reverse_iterator</span> <span class="n">ri</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">rbegin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">rend</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ä½¿riæŒ‡å‘3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">i</span><span class="p">(</span><span class="n">ri</span><span class="p">.</span><span class="n">base</span><span class="p">());</span> <span class="c1">// ä½¿iå’Œriçš„baseä¸€æ ·
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œä¸Šè¿°ä»£ç åï¼Œå¯ä»¥æƒ³åˆ°äº§ç”Ÿçš„ç»“æœå°±åƒè¿™æ ·:</p>
<p></p>
<p>ä¸Šå›¾æ˜¾ç¤ºäº†<code>reverse_iterator</code>å’Œå®ƒå¯¹åº”çš„<code>base iterator</code>ä¹‹é—´ç‰¹æœ‰çš„åç§»é‡ï¼Œå°±åƒ<code>rbegin()</code>å’Œ<code>rend()</code>ä¸ç›¸å…³çš„<code>begin()</code>å’Œ<code>end()</code>ä¸€æ ·ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰è§£é‡Šæ€æ ·åœ¨<code>ri</code>ä¸Šå®ç°ä½ åœ¨iä¸Šæƒ³è¦å®Œæˆçš„æ“ä½œã€‚</p>
<p>æ­£å¦‚æ¡æ¬¾26è§£é‡Šçš„ï¼Œæœ‰äº›å®¹å™¨çš„æˆå‘˜å‡½æ•°åªæ¥å—<code>iterator</code>ç±»å‹çš„å‚æ•°ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³è¦åœ¨<code>ri</code>æ‰€æŒ‡çš„ä½ç½®æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œä½ ä¸èƒ½ç›´æ¥è¿™ä¹ˆåšï¼Œå› ä¸º<code>vector</code>çš„<code>insert</code>å‡½æ•°ä¸æ¥å—<code>reverse_iterator</code>ã€‚</p>
<p>å¦‚æœä½ æƒ³è¦åˆ é™¤riæ‰€æŒ‡ä½ç½®ä¸Šçš„å…ƒç´ ä¹Ÿä¼šæœ‰åŒæ ·çš„é—®é¢˜ã€‚<code>erase</code>æˆå‘˜å‡½æ•°ä¼šæ‹’ç»<code>reverse_iterator</code>ï¼ŒåšæŒè¦æ±‚<code>iterator</code>ã€‚</p>
<h2 id="reverse_iteratorè½¬æ¢æˆiterator">reverse_iteratorè½¬æ¢æˆiterator</h2>
<p>ä¸ºäº†å®Œæˆåˆ é™¤å’Œä¸€äº›å½¢å¼çš„æ’å…¥æ“ä½œï¼Œä½ å¿…é¡»å…ˆé€šè¿‡baseå‡½æ•°å°†reverse_iteratorè½¬æ¢æˆiteratorï¼Œç„¶åç”¨iteratoræ¥å®Œæˆå·¥ä½œã€‚</p>
<p><strong>æ’å…¥æ“ä½œ</strong></p>
<p>å‡è®¾ä½ è¦åœ¨riæŒ‡å‡ºçš„ä½ç½®ä¸ŠæŠŠä¸€ä¸ªæ–°å…ƒç´ æ’å…¥vã€‚å‡è®¾ä½ è¦æ’å…¥çš„å€¼æ˜¯99ã€‚</p>
<p>**riåœ¨ä¸Šå›¾ä¸­éå†çš„é¡ºåºæ˜¯è‡ªå³å‘å·¦ï¼Œè€Œä¸”æ’å…¥æ“ä½œä¼šå°†æ–°å…ƒç´ æ’å…¥åˆ°riä½ç½®ï¼Œå¹¶ä¸”å°†åŸå…ˆriä½ç½®çš„å…ƒç´ ç§»åˆ°éå†è¿‡ç¨‹çš„â€œä¸‹ä¸€ä¸ªâ€ä½ç½®ï¼Œæˆ‘ä»¬è®¤ä¸º3åº”è¯¥å‡ºç°åœ¨99çš„å·¦ä¾§ã€‚**æ’å…¥æ“ä½œä¹‹åï¼Œvçœ‹èµ·æ¥åƒè¿™æ ·:</p>
<p></p>
<p>æˆ‘ä»¬ä¸èƒ½ç”¨<code>ri</code>æ¥æŒ‡å®šæ’å…¥çš„åœ°æ–¹ï¼Œå› ä¸ºå®ƒä¸æ˜¯ä¸€ä¸ª<code>iterator</code>ã€‚æˆ‘ä»¬å¿…é¡»ç”¨<code>i</code>æ¥ä»£æ›¿ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œå½“<code>ri</code>æŒ‡å‘3æ—¶ï¼Œ<code>i</code>ï¼ˆå°±æ˜¯<code>ri.base()</code>ï¼‰æŒ‡å‘4ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ç”¨<code>ri</code>æ¥æŒ‡å®šæ’å…¥ä½ç½®ï¼Œé‚£ä¹ˆç”¨iæŒ‡å‘æ’å…¥ä½ç½®ï¼Œé‚£ä¸ªå‡è®¾å°±æ˜¯æ­£ç¡®çš„ã€‚</p>
<p><strong>ç»“è®º</strong></p>
<blockquote>
<p>è¦å®ç°åœ¨ä¸€ä¸ªreverse_iterator riæŒ‡å‡ºçš„ä½ç½®ä¸Šæ’å…¥æ–°å…ƒç´ ï¼Œåœ¨ri.base()æŒ‡å‘çš„ä½ç½®æ’å…¥å°±è¡Œäº†ã€‚
å¯¹äºinsertæ“ä½œè€Œè¨€ï¼Œriå’Œri.base()æ˜¯ç­‰ä»·çš„ï¼Œè€Œä¸”ri.base()çœŸçš„æ˜¯riå¯¹åº”çš„iteratorã€‚</p>
</blockquote>
<p><strong>åˆ é™¤æ“ä½œ</strong></p>
<p>å¦‚æœä½ è¦åˆ é™¤riæŒ‡å‘çš„å…ƒç´ ï¼Œä½ ä¸èƒ½ç›´æ¥ä½¿ç”¨iäº†ï¼Œå› ä¸ºiä¸riä¸æ˜¯æŒ‡å‘åŒä¸€ä¸ªå…ƒç´ ã€‚å› æ­¤ï¼Œä½ è¦åˆ é™¤çš„æ˜¯içš„å‰ä¸€ä¸ªå…ƒç´ ã€‚</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// å‘væ’å…¥1åˆ°5ï¼ŒåŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vecot</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">reverse_iterator</span> <span class="n">ri</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">rbegin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">rend</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// åŒä¸Šï¼ŒriæŒ‡å‘3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="o">--</span><span class="n">ri</span><span class="p">.</span><span class="n">base</span><span class="p">());</span> <span class="c1">// å°è¯•åˆ é™¤ri.base()å‰é¢çš„å…ƒç´ ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¯¹äºvectorï¼Œä¸€èˆ¬æ¥è¯´ç¼–è¯‘ä¸é€šè¿‡
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¡¨è¾¾å¼<code>--ri.base()</code>ç¡®å®èƒ½å¤ŸæŒ‡å‡ºæˆ‘ä»¬éœ€è¦åˆ é™¤çš„å…ƒç´ ã€‚è€Œä¸”ï¼Œå®ƒä»¬èƒ½å¤Ÿå¤„ç†é™¤äº†<code>vector</code>å’Œ<code>string</code>ä¹‹å¤–çš„å…¶ä»–æ‰€æœ‰å®¹å™¨ã€‚</p>
<p>å®ƒå¯èƒ½ä¹Ÿèƒ½å¤„ç†vectorå’Œstringï¼Œä½†å¯¹äºå¤§å¤šæ•°vectorå’Œstringçš„å®ç°ï¼Œå®ƒæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</p>
<p>åœ¨è¿™æ ·çš„å®ç°ä¸‹ï¼Œ<code>iterator</code>(å’Œ<code>const_iterator</code>)ä¼šé‡‡ç”¨å†…å»ºçš„æŒ‡é’ˆæ¥å®ç°ï¼Œæ‰€ä»¥<code>ri.base()</code>çš„ç»“æœæ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚</p>
<p><strong>åŸå› å‰–æ</strong></p>
<p>Cå’ŒC++éƒ½è§„å®šäº†ä¸èƒ½ç›´æ¥ä¿®æ”¹å‡½æ•°è¿”å›çš„æŒ‡é’ˆï¼Œæ‰€ä»¥åœ¨stringå’Œvectorçš„è¿­ä»£å™¨æ˜¯æŒ‡é’ˆçš„STLå¹³å°ä¸Šï¼Œåƒ<code>--ri.base()</code>è¿™æ ·çš„è¡¨è¾¾å¼æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</p>
<p>è¦ç§»æ¤ä»ä¸€ä¸ªç”±<code>reverse_iterator</code>æŒ‡å‡ºçš„ä½ç½®åˆ é™¤å…ƒç´ æ—¶ï¼Œä½ åº”è¯¥å°½é‡é¿å…ä¿®æ”¹baseçš„è¿”å›å€¼ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœä½ ä¸èƒ½å‡å°‘è°ƒç”¨<code>base</code>çš„è¿”å›å€¼ï¼Œåªéœ€è¦å…ˆå¢åŠ <code>reverse_iterator</code>çš„å€¼ï¼Œç„¶åå†è°ƒç”¨<code>base</code>ï¼</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// åŒä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">v</span><span class="p">.</span><span class="n">erase</span><span class="p">((</span><span class="o">++</span><span class="n">ri</span><span class="p">).</span><span class="n">base</span><span class="p">());</span> <span class="c1">// åˆ é™¤riæŒ‡å‘çš„å…ƒç´ ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1">// è¿™ä¸‹ç¼–è¯‘æ²¡é—®é¢˜äº†ï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºæ‰€æœ‰çš„æ ‡å‡†å®¹å™¨ï¼Œè¿™æ˜¯åˆ é™¤ä¸€ä¸ªç”±reverse_iteratoræŒ‡å‡ºçš„å…ƒç´ æ—¶é¦–é€‰çš„æŠ€å·§</strong></p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p><code>reverse_iterator</code>çš„<code>base</code>æˆå‘˜å‡½æ•°è¿”å›ä¸€ä¸ªâ€œå¯¹åº”çš„â€<code>iterator</code>çš„è¯´æ³•å¹¶ä¸å‡†ç¡®ï¼šå¯¹äºæ’å…¥æ“ä½œè€Œè¨€ï¼Œçš„ç¡®å¦‚æ­¤; ä½†æ˜¯å¯¹äºåˆ é™¤æ“ä½œï¼Œå¹¶éå¦‚æ­¤ã€‚</p>
<p>å½“éœ€è¦æŠŠ<code>reverse_iterator</code>è½¬æ¢æˆ<code>iterator</code>çš„æ—¶å€™ï¼Œæœ‰ä¸€ç‚¹éå¸¸é‡è¦çš„æ˜¯ä½ å¿…é¡»çŸ¥é“ä½ å‡†å¤‡æ€ä¹ˆå¤„ç†è¿”å›çš„<code>iterator</code>ï¼Œå› ä¸ºåªæœ‰è¿™æ ·ä½ æ‰èƒ½å†³å®šä½ å¾—åˆ°çš„<code>iterator</code>æ˜¯å¦æ˜¯ä½ éœ€è¦çš„ã€‚</p>
]]></description></item><item><title>Effective STL [27] | ç”¨distanceå’ŒadvanceæŠŠconst_iteratorè½¬åŒ–æˆiterator</title><link>https://jianye0428.github.io/posts/clause_27/</link><pubDate>Thu, 17 Aug 2023 07:54:00 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_27/</guid><description><![CDATA[<h2 id="æŠŠconst_iteratorè½¬åŒ–ä¸ºiterator">æŠŠconst_iteratorè½¬åŒ–ä¸ºiterator</h2>
<p>æœ‰äº›å®¹å™¨æˆå‘˜å‡½æ•°åªæ¥å—iteratorä½œä¸ºå‚æ•°ï¼Œè€Œä¸æ˜¯const_iteratorã€‚å¦‚æœä½ åªæœ‰ä¸€ä¸ªconst_iteratorï¼Œè¦åœ¨å®ƒæ‰€æŒ‡å‘çš„å®¹å™¨ä½ç½®ä¸Šæ’å…¥æ–°å…ƒç´ å‘¢ï¼Ÿ</p>
<p>ä¸Šä¸€æ¡æ¬¾è¯´å¹¶ä¸å­˜åœ¨ä»const_iteratoråˆ°iteratorä¹‹é—´çš„éšå¼è½¬æ¢ï¼Œé‚£è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>çœ‹çœ‹å½“ä½ æŠŠä¸€ä¸ªconst_iteratoræ˜ å°„ä¸ºiteratoræ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">IntDeque</span><span class="p">;</span> <span class="c1">// æ–¹ä¾¿çš„typedef
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">iterator</span> <span class="n">Iter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">ConstIter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ConstIter</span> <span class="n">ci</span><span class="p">;</span> <span class="c1">// ciæ˜¯const_iterator
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">Iter</span> <span class="n">i</span><span class="p">(</span><span class="n">ci</span><span class="p">);</span> <span class="c1">// é”™è¯¯ï¼æ²¡æœ‰ä»const_iterator åˆ°iteratoréšå¼è½¬æ¢çš„é€”å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Iter</span> <span class="nf">i</span><span class="p">(</span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">Iter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ci</span><span class="p">));</span> <span class="c1">// ä»æ˜¯ä¸ªé”™è¯¯ï¼ä¸èƒ½ä»const_iterator æ˜ å°„ä¸ºiteratorï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œåªæ˜¯ä»¥dequeä¸ºä¾‹ï¼Œä½†æ˜¯ç”¨å…¶å®ƒå®¹å™¨ç±»â€”â€”listã€setã€multisetã€mapã€multimapç”šè‡³æ¡æ¬¾25æè¿°çš„æ•£åˆ—è¡¨å®¹å™¨â€”â€”çš„ç»“æœä¸€æ ·ã€‚ä½¿ç”¨æ˜ å°„çš„è¡Œä¹Ÿè®¸åœ¨vectoræˆ–stringçš„ä»£ç æ—¶èƒ½å¤Ÿç¼–è¯‘ï¼Œä½†è¿™æ˜¯æˆ‘ä»¬é©¬ä¸Šè¦è®¨è®ºçš„éå¸¸ç‰¹æ®Šçš„æƒ…å½¢ã€‚</p>
<p>ä¸Šè¿°ä»£ç ä¸èƒ½é€šè¿‡ç¼–è¯‘çš„åŸå› åœ¨äºï¼Œå¯¹äºè¿™äº›å®¹å™¨è€Œè¨€ï¼Œ<font color=red>iteratorå’Œconst_iteratoræ˜¯å®Œå…¨ä¸åŒçš„ç±»ã€‚</font></p>
<p>åœ¨ä¸¤ä¸ªæ¯«æ— å…³è”çš„ç±»ä¹‹é—´è¿›è¡Œ<code>const_cast</code>æ˜ å°„æ˜¯è’è°¬çš„ï¼Œæ‰€ä»¥<code>reinterpret_cast</code>ã€<code>static_cast</code>ç”šè‡³Cé£æ ¼çš„æ˜ å°„ä¹Ÿä¼šå¯¼è‡´åŒæ ·çš„ç»“æœã€‚</p>
<p><strong>ä¸èƒ½ç¼–è¯‘çš„ä»£ç å¯¹äºvectorå’Œstringå®¹å™¨æ¥è¯´ä¹Ÿè®¸èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘</strong></p>
<p>é‚£æ˜¯å› ä¸ºé€šå¸¸æƒ…å†µä¸‹å¤§å¤šæ•°å®ç°éƒ½ä¼šé‡‡ç”¨çœŸå®çš„æŒ‡é’ˆä½œä¸ºé‚£äº›å®¹å™¨çš„è¿­ä»£å™¨ã€‚</p>
<p>å°±è¿™ç§å®ç°è€Œè¨€ï¼Œ<code>vector&lt;T&gt;::iterator</code>æ˜¯<code>T*</code>çš„<code>typedef</code>ï¼Œè€Œ<code>vector&lt;T&gt;::const_iterator</code>æ˜¯<code>const T*</code>çš„<code>typedef</code>ï¼Œ<code>string::iterator</code>æ˜¯<code>char</code>çš„<code>typedef</code>ï¼Œè€Œ<code>string::const_iterator</code>æ˜¯<code>const char*</code>çš„<code>typedef</code>ã€‚</p>
<p>åœ¨è¿™ç§å®ç°çš„æƒ…å†µä¸‹ï¼Œç”¨<code>const_cast</code>æŠŠ<code>const_iterator</code>æ˜ å°„æˆ<code>iterator</code>å½“ç„¶å¯ä»¥ç¼–è¯‘è€Œä¸”æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸º<code>const_iterator</code>ä¸<code>iterator</code>ä¹‹é—´çš„<code>const_cast</code>æ˜ å°„è¢«æœ€ç»ˆè§£é‡Šæˆ<code>const T*</code>åˆ°<code>T*</code>çš„æ˜ å°„ã€‚ä½†æ˜¯ï¼Œå³ä½¿æ˜¯åœ¨è¿™ç§å®ç°ä¸­ï¼Œ<code>reverse_iterator</code>å’Œ<code>const_reverse_iterator</code>ä¹Ÿæ˜¯çœŸæ­£çš„ç±»ï¼Œæ‰€ä»¥ä½ ä»ç„¶ä¸èƒ½ç›´æ¥ç”¨<code>const_cast</code>æŠŠ<code>const_reverse_iterator</code>æ˜ å°„æˆ<code>reverse_iterator</code>ã€‚</p>
<p>è€Œä¸”è¿™äº›å®ç°é€šå¸¸åªä¼šåœ¨Releaseæ¨¡å¼æ—¶æ‰ä½¿ç”¨æŒ‡é’ˆè¡¨ç¤ºvectorå’Œstringçš„è¿­ä»£å™¨ã€‚</p>
<p>æ‰€æœ‰è¿™äº›äº‹å®è¡¨æ˜ï¼ŒæŠŠconstè¿­ä»£å™¨æ˜ å°„ä¸ºè¿­ä»£å™¨æ˜¯ç—…æ€çš„ï¼Œå³ä½¿æ˜¯å¯¹vectorå’Œstringæ¥è¯´ä¹Ÿæ—¶ï¼Œå› ä¸ºç§»æ¤æ€§å¾ˆå€¼å¾—æ€€ç–‘ã€‚</p>
<h2 id="const_iteratorè½¬æ¢ä¸ºiterator">const_iteratorè½¬æ¢ä¸ºiterator</h2>
<p>æœ‰ä¸€ç§å®‰å…¨çš„ã€å¯ç§»æ¤çš„æ–¹æ³•è·å–å®ƒæ‰€å¯¹åº”çš„iteratorï¼Œè€Œä¸”ï¼Œç”¨ä¸ç€é™·å…¥ç±»å‹ç³»ç»Ÿçš„è½¬æ¢ã€‚</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;deque&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">IntDeque</span><span class="p">;</span> <span class="c1">// å’Œä»¥å‰ä¸€æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">iterator</span> <span class="n">Iter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">ConstIter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">IntDeque</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ConstIter</span> <span class="n">ci</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// è®©ciæŒ‡å‘d
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Iter</span> <span class="n">i</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span> <span class="c1">// åˆå§‹åŒ–iä¸ºd.begin()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">advance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ci</span><span class="p">));</span> <span class="c1">// æŠŠiç§»åˆ°æŒ‡å‘ciä½ç½®ï¼ˆä½†è¯·ç•™æ„ä¸‹é¢å…³äºä¸ºä»€ä¹ˆåœ¨å®ƒç¼–è¯‘å‰è¦è°ƒæ•´çš„åŸå› ï¼‰
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦å¾—åˆ°ä¸const_iteratoræŒ‡å‘åŒä¸€ä½ç½®çš„iterator:</p>
<ol>
<li>å°†iteratoræŒ‡å‘å®¹å™¨çš„èµ·å§‹ä½ç½®ï¼Œ</li>
<li>æŠŠå®ƒå‘å‰ç§»åˆ°å’Œconst_iteratorè·ç¦»å®¹å™¨èµ·å§‹ä½ç½®çš„åç§»é‡ä¸€æ ·çš„ä½ç½®å³å¯</li>
</ol>
<p>è¿™ä¸ªä»»åŠ¡å¾—åˆ°äº†ä¸¤ä¸ªå‡½æ•°æ¨¡æ¿advanceå’Œdistanceçš„å¸®åŠ©ï¼Œå®ƒä»¬éƒ½åœ¨<iterator>ä¸­å£°æ˜:</p>
<ul>
<li>distanceè¿”å›ä¸¤ä¸ªæŒ‡å‘åŒä¸€ä¸ªå®¹å™¨çš„iteratorä¹‹é—´çš„è·ç¦»ï¼›</li>
<li>advanceåˆ™ç”¨äºå°†ä¸€ä¸ªiteratorç§»åŠ¨æŒ‡å®šçš„è·ç¦»ã€‚</li>
</ul>
<p>å¦‚æœ<code>i</code>å’Œ<code>ci</code>æŒ‡å‘åŒä¸€ä¸ªå®¹å™¨ï¼Œé‚£ä¹ˆè¡¨è¾¾å¼<code>advance(i, distance(i, ci))</code>ä¼šå°†<code>i</code>ç§»åŠ¨åˆ°ä¸<code>ci</code>ç›¸åŒçš„ä½ç½®ä¸Šã€‚</p>
<p>ä¸Šè¿°ä»£ç ç¼–è¯‘å­˜åœ¨é—®é¢˜ã€‚</p>
<p>å…ˆæ¥çœ‹çœ‹distanceçš„å®šä¹‰ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">_InputIterator</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">inline</span> <span class="n">_GLIBCXX17_CONSTEXPR</span>
</span></span><span class="line"><span class="cl">  <span class="k">typename</span> <span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">_InputIterator</span><span class="o">&gt;::</span><span class="n">difference_type</span>
</span></span><span class="line"><span class="cl">  <span class="n">distance</span><span class="p">(</span><span class="n">_InputIterator</span> <span class="n">__first</span><span class="p">,</span> <span class="n">_InputIterator</span> <span class="n">__last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// concept requirements -- taken care of in __distance
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">__distance</span><span class="p">(</span><span class="n">__first</span><span class="p">,</span> <span class="n">__last</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">__iterator_category</span><span class="p">(</span><span class="n">__first</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å½“é‡åˆ°<code>distance</code>è°ƒç”¨æ—¶ï¼Œä½ çš„ç¼–è¯‘å™¨éœ€è¦æ ¹æ®ä½¿ç”¨çš„å®å‚ç±»å‹æ¨æ–­å‡º<code>InputIterator</code>çš„ç±»å‹ã€‚</p>
<p>å†æ¥çœ‹çœ‹æˆ‘æ‰€è¯´çš„ä¸å¤ªæ­£ç¡®çš„<code>distance</code>è°ƒç”¨:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">advance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ci</span><span class="p">));</span> <span class="c1">// è°ƒæ•´iï¼ŒæŒ‡å‘ciä½ç½®
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰ä¸¤ä¸ªå‚æ•°ä¼ é€’ç»™distanceï¼Œiå’Œciã€‚içš„ç±»å‹æ˜¯Iterï¼Œå³<code>deque&lt;int&gt;::iterator</code>çš„typedefã€‚</p>
<p>å¯¹ç¼–è¯‘å™¨æ¥è¯´ï¼Œè¿™è¡¨æ˜è°ƒç”¨<code>distance</code>çš„<code>InputIterator</code>æ˜¯<code>deque::iterator</code>ã€‚ä½†<code>ci</code>æ˜¯<code>ConstIter</code>ï¼Œå³<code>deque::const_iterator</code>çš„<code>typedef</code>ã€‚</p>
<p>è¡¨æ˜é‚£ä¸ª<code>InputIterator</code>æ˜¯<code>deque&lt;int&gt;::const_iterator</code>ã€‚</p>
<p><code>InputIterator</code>ä¸å¯èƒ½åŒæ—¶æœ‰ä¸¤ç§ä¸åŒçš„ç±»å‹ï¼Œæ‰€ä»¥è°ƒç”¨<code>distance</code>å¤±è´¥ã€‚</p>
<p>ä¸€èˆ¬ä¼šé€ æˆä¸€äº›å†—é•¿çš„å‡ºé”™ä¿¡æ¯ï¼Œå¯èƒ½ä¼šä¹Ÿå¯èƒ½ä¸ä¼šè¯´æ˜æ˜¯ç¼–è¯‘å™¨æ— æ³•å¾—å‡º<code>InputIterator</code>æ˜¯ä»€ä¹ˆç±»å‹ã€‚</p>
<p>è¦é¡ºåˆ©åœ°è°ƒç”¨<code>distance</code>ï¼Œä½ éœ€è¦æ’é™¤æ­§ä¹‰ã€‚</p>
<p>æœ€ç®€å•çš„åŠæ³•å°±æ˜¯æ˜¾å¼çš„æŒ‡æ˜<code>distance</code>è°ƒç”¨çš„æ¨¡æ¿å‚æ•°ç±»å‹ï¼Œä»è€Œé¿å…ç¼–è¯‘å™¨è‡ªå·±å¾—å‡ºå®ƒä»¬çš„ç±»å‹:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">advance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">distance</span><span class="o">&lt;</span><span class="n">ConstIter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ci</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ç°åœ¨çŸ¥é“äº†æ€ä¹ˆé€šè¿‡<code>advance</code>å’Œ<code>distance</code>è·å–<code>const_iterator</code>ç›¸åº”çš„<code>iterator</code>äº†ã€‚</p>
<p><strong>æ•ˆç‡å¦‚ä½•ï¼Ÿ</strong></p>
<p>ç­”æ¡ˆå¾ˆç®€å•ã€‚<strong>å–å†³äºä½ æ‰€è½¬æ¢çš„ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ ·çš„è¿­ä»£å™¨ã€‚</strong></p>
<p>å¯¹äº<strong>éšæœºè®¿é—®çš„è¿­ä»£å™¨</strong>ï¼ˆæ¯”å¦‚<code>vector</code>ã€<code>string</code>å’Œ<code>deque</code>çš„ï¼‰è€Œè¨€ï¼Œè¿™æ˜¯<strong>å¸¸æ•°æ—¶é—´</strong>çš„æ“ä½œã€‚</p>
<p>å¯¹äº<strong>åŒå‘è¿­ä»£å™¨</strong>ï¼ˆä¹Ÿå°±æ˜¯ï¼Œæ‰€æœ‰å…¶å®ƒå®¹å™¨å’ŒåŒ…æ‹¬æ•£åˆ—å®¹å™¨çš„ä¸€äº›å®ç°ï¼‰è€Œè¨€ï¼Œè¿™æ˜¯<strong>çº¿æ€§æ—¶é—´</strong>çš„æ“ä½œã€‚</p>
<p>å› ä¸ºå®ƒå¯èƒ½èŠ±è´¹çº¿æ€§æ—¶é—´çš„ä»£ä»·æ¥äº§ç”Ÿä¸€ä¸ªå’Œ<code>const_iterator</code>ç­‰ä»·çš„<code>iterator</code>ï¼Œå¹¶ä¸”å› ä¸ºå¦‚æœä¸èƒ½è®¿é—®<code>const_iterator</code>æ‰€å±çš„å®¹å™¨è¿™ä¸ªæ“ä½œå°±æ— æ³•å®Œæˆã€‚</p>
<p>ä»è¿™ä¸ªè§’åº¦å‡ºå‘ï¼Œä¹Ÿè®¸ä½ éœ€è¦é‡æ–°å®¡è§†ä½ ä»<code>const_iterator</code>äº§ç”Ÿ<code>iterator</code>çš„è®¾è®¡ã€‚</p>
<p>å½“å¤„ç†å®¹å™¨æ—¶å°½é‡ç”¨<code>iterator</code>ä»£æ›¿<code>const</code>å’Œ<code>reverse</code>è¿­ä»£å™¨ã€‚</p>
]]></description></item><item><title>Effective STL [26] | å°½é‡ç”¨iteratorä»£æ›¿const_iteratorï¼Œreverse_iteratorå’Œconst_reverse_iterator</title><link>https://jianye0428.github.io/posts/clause_26/</link><pubDate>Wed, 16 Aug 2023 19:06:25 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_26/</guid><description><![CDATA[<h2 id="4ç§è¿­ä»£å™¨">4ç§è¿­ä»£å™¨</h2>
<p>æ¯ä¸ªæ ‡å‡†å®¹å™¨ç±»éƒ½æä¾›4ç§è¿­ä»£å™¨ç±»å‹:<code>iterator</code>,<code>const_iterator</code>ï¼Œ<code>reverse_iterator</code>å’Œ<code>const_reverse_iterator</code></p>
<p>å¯¹äº<code>container&lt;T&gt;</code>è€Œè¨€ï¼Œ<code>iterator</code>çš„ä½œç”¨ç›¸å½“äº<code>T*</code>ï¼Œè€Œ<code>const_iterator</code>åˆ™ç›¸å½“äº<code>const T*</code>ã€‚</p>
<p>å¢åŠ ä¸€ä¸ª<code>iterator</code>æˆ–è€…<code>const_iterator</code>å¯ä»¥åœ¨ä¸€ä¸ªä»å®¹å™¨å¼€å¤´è¶‹å‘å°¾éƒ¨çš„éå†ä¸­è®©ä½ ç§»åŠ¨åˆ°å®¹å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p><code>reverse_iterator</code>ä¸<code>const_reverse_iterator</code>åŒæ ·ç›¸å½“äºå¯¹åº”çš„<code>T</code>å’Œ<code>const T</code>ï¼Œæ‰€ä¸åŒçš„æ˜¯ï¼Œå¢åŠ <code>reverse_iterator</code>æˆ–è€…<code>const_reverse_iterator</code>ä¼šåœ¨ä»å°¾åˆ°å¤´çš„éå†ä¸­è®©ä½ ç§»åŠ¨åˆ°å®¹å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p>
<h2 id="vectortçš„insertå’Œeraseçš„æ ·å¼">vector<T>çš„insertå’Œeraseçš„æ ·å¼</h2>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">iterator</span> <span class="nf">insert</span><span class="p">(</span><span class="n">iterator</span> <span class="n">position</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">iterator</span> <span class="nf">erase</span><span class="p">(</span><span class="n">iterator</span> <span class="n">position</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">iterator</span> <span class="nf">erase</span><span class="p">(</span><span class="n">iterator</span> <span class="n">rangeBegin</span><span class="p">,</span> <span class="n">iterator</span> <span class="n">rangeEnd</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™äº›æ–¹æ³•åªæ¥å—<code>iterator</code>ç±»å‹çš„å‚æ•°ï¼Œè€Œä¸æ˜¯<code>const_iterator</code>ã€<code>reverse_iterator</code>æˆ–<code>const_reverse_iterator</code>ã€‚æ€»æ˜¯<code>iterator</code>ã€‚</p>
<h2 id="è¿­ä»£å™¨ä¹‹é—´å­˜åœ¨çš„è½¬æ¢å…³ç³»">è¿­ä»£å™¨ä¹‹é—´å­˜åœ¨çš„è½¬æ¢å…³ç³»</h2>
<p></p>
<p>å›¾ä¸­æ˜¾ç¤ºäº†ä»<code>iterator</code>åˆ°<code>const_iterator</code>ã€ä»<code>iterator</code>åˆ°<code>reverse_iterator</code>å’Œä»<code>reverse_iterator</code>åˆ°<code>const_reverse_iterator</code>å¯ä»¥è¿›è¡Œéšå¼è½¬æ¢ã€‚</p>
<p>å¹¶ä¸”ï¼Œ<code>reverse_iterator</code>å¯ä»¥é€šè¿‡è°ƒç”¨å…¶<code>baseæˆå‘˜å‡½æ•°</code>è½¬æ¢ä¸º<code>iterator</code>ã€‚<code>const_reverse_iterator</code>ä¹Ÿå¯ä»¥ç±»ä¼¼åœ°é€šè¿‡<code>base</code>è½¬æ¢æˆä¸º<code>const_iterator</code>ã€‚</p>
<p>é€šè¿‡baseå¾—åˆ°çš„ä¹Ÿè®¸å¹¶éä½ æ‰€æœŸå¾…çš„iteratorã€‚</p>
<p>è€Œä¸”ï¼Œ<strong>æ²¡æœ‰åŠæ³•ä»ä¸€ä¸ªconst_iteratorè½¬æ¢å¾—åˆ°ä¸€ä¸ªiteratorï¼Œä¹Ÿæ— æ³•ä»const_reverse_iteratorå¾—åˆ°reverse_iterator</strong>ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“ä½ éœ€è¦æŒ‡å‡ºæ’å…¥ä½ç½®æˆ–åˆ é™¤çš„å…ƒç´ æ—¶ï¼Œconstè¿­ä»£å™¨å‡ ä¹æ²¡æœ‰ç”¨ã€‚</p>
<h2 id="å°½é‡ä½¿ç”¨iteratorå–ä»£constæˆ–è€…reverseç±»å‹çš„è¿­ä»£å™¨">å°½é‡ä½¿ç”¨iteratorå–ä»£constæˆ–è€…reverseç±»å‹çš„è¿­ä»£å™¨</h2>
<ol>
<li>
<p><code>insert</code>å’Œ<code>erase</code>çš„ä¸€äº›ç‰ˆæœ¬è¦æ±‚<code>iterator</code>ã€‚å¦‚æœä½ éœ€è¦è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œä½ å°±å¿…é¡»äº§ç”Ÿ<code>iterator</code>ï¼Œè€Œä¸èƒ½ç”¨<code>const</code>æˆ–<code>reverse iterators</code>ã€‚</p>
</li>
<li>
<p>ä¸å¯èƒ½æŠŠ<code>const_iterator</code>éšå¼è½¬æ¢æˆ<code>iterator</code>ã€‚ä»ä¸€ä¸ª<code>const_iterator</code>äº§ç”Ÿä¸€ä¸ª<code>iterator</code>çš„æŠ€æœ¯å¹¶ä¸æ™®éé€‚ç”¨ï¼Œè€Œä¸”ä¸ä¿è¯é«˜æ•ˆã€‚</p>
</li>
<li>
<p>ä»<code>reverse_iterator</code>è½¬æ¢è€Œæ¥çš„<code>iterator</code>åœ¨è½¬æ¢ä¹‹åå¯èƒ½éœ€è¦ç›¸åº”çš„è°ƒæ•´ã€‚</p>
</li>
</ol>
<p><code>iterator</code>ä¸<code>reverse_iterator</code>ä¹‹é—´çš„é€‰æ‹©æ˜¾è€Œæ˜“è§â€”â€”ä¾èµ–äºä»å‰åˆ°åæˆ–ä»ååˆ°å‰çš„éå†ã€‚</p>
<p><strong>è¿­ä»£å™¨æ¯”è¾ƒ</strong></p>
<p>å½“åœ¨<code>iterator</code>å’Œ<code>const_iterator</code>ä¹‹é—´ä½œé€‰æ‹©çš„æ—¶å€™ï¼Œä½ æœ‰æ›´å……åˆ†çš„ç†ç”±é€‰æ‹©<code>iterator</code>ï¼Œå³ä½¿<code>const_iterator</code>åŒæ ·å¯è¡Œè€Œä¸”å³ä½¿ä½ å¹¶ä¸éœ€è¦è°ƒç”¨å®¹å™¨ç±»çš„ä»»ä½•æˆå‘˜å‡½æ•°ã€‚å…¶ä¸­çš„ä»¤äººè®¨åŒçš„åŸå› åŒ…æ‹¬<code>iterator</code>ä¸<code>const_iterator</code>ä¹‹é—´çš„æ¯”è¾ƒï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">IntDeque</span><span class="p">;</span> <span class="c1">// typedefå¯ä»¥æå¤§åœ°ç®€åŒ–STLå®¹å™¨ç±»å’Œiteratorçš„æ“ä½œã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">iterator</span> <span class="n">Iter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">IntDeque</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">ConstIter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Iter</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ConstIter</span> <span class="n">ci</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// åŒä¸€ä¸ªå®¹å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">ci</span><span class="p">)</span> <span class="p">...</span> <span class="c1">// æ¯”è¾ƒiteratorå’Œconst_iterator
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å”¯ä¸€çš„å˜åŒ–æ˜¯ç­‰å·çš„ä¸€è¾¹çš„ç±»å‹æ˜¯<code>iterator</code>ï¼Œè€Œå¦ä¸€è¾¹çš„ç±»å‹æ˜¯<code>const_iterator</code>ã€‚</p>
<p><strong>å› ä¸º<code>iterator</code>åº”è¯¥åœ¨æ¯”è¾ƒä¹‹å‰éšå¼çš„è½¬æ¢æˆ<code>const_iterator</code>ï¼ŒçœŸæ­£çš„æ¯”è¾ƒåº”è¯¥åœ¨ä¸¤ä¸ª<code>const_iterator</code>ä¹‹é—´è¿›è¡Œã€‚</strong></p>
<p><strong>å¦‚æœä¸€äº›å®ç°å°†<code>const_iterator</code>çš„<code>operator==</code>ä½œä¸º<code>const_iterator</code>çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°è€Œä¸æ˜¯éæˆå‘˜å‡½æ•°ã€‚</strong></p>
<p>è€Œé—®é¢˜çš„è§£å†³ä¹‹é“æ˜¾å¾—éå¸¸æœ‰è¶£ï¼šåªè¦åƒè¿™æ ·äº¤æ¢ä¸¤ä¸ª<code>iterator</code>çš„ä½ç½®ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">ci</span> <span class="o">==</span> <span class="n">i</span><span class="p">)...</span> <span class="c1">// å½“ä¸Šé¢æ¯”è¾ƒæ— æ³•é€šè¿‡ç¼–è¯‘æ—¶çš„è§£å†³æ–¹æ³•
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è¿­ä»£å™¨æ··ç”¨</strong></p>
<p>ä¸ä»…æ˜¯æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ï¼Œåªè¦ä½ åœ¨åŒä¸€ä¸ªè¡¨è¾¾å¼ä¸­æ··ç”¨<code>iterator</code>å’Œ<code>const_iterator</code>ï¼ˆæˆ–è€…<code>reverse_iterator</code>å’Œ<code>const_reverse_iterator</code>ï¼‰ï¼Œè¿™æ ·çš„é—®é¢˜å°±å¯èƒ½ä¼šå‡ºç°:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">ci</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">...</span> <span class="c1">// å¦‚æœiä¸ciä¹‹é—´è‡³å°‘æœ‰ä¸‰ä¸ªå…ƒç´ ...
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè¿­ä»£å™¨çš„ç±»å‹ä¸åŒï¼Œä½ çš„æ­£ç¡®çš„ä»£ç å¯èƒ½ä¼šè¢«é”™è¯¯åœ°æ‹’ç»ã€‚</p>
<p>æœ¬ä¾‹ä¸­æœ€ç®€å•çš„è§£å†³æ–¹æ³•æ˜¯<strong>é€šè¿‡ä¸€ä¸ªï¼ˆå®‰å…¨çš„ï¼‰æ˜ å°„æŠŠiteratorè½¬æ¢ä¸ºconst_iterator</strong>:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">ConstIter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">ci</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">...</span> <span class="c1">// å½“ä¸Šé¢çš„ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘æ—¶çš„è§£å†³æ–¹æ³•
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é¿å…è¿™ç±»é—®é¢˜çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯å‡å°‘æ··ç”¨ä¸åŒç±»å‹çš„è¿­ä»£å™¨çš„æœºä¼šã€‚</strong></p>
]]></description></item><item><title>Effective STL [25] | ç†Ÿæ‚‰éæ ‡å‡†æ•£åˆ—å®¹å™¨</title><link>https://jianye0428.github.io/posts/clause_25/</link><pubDate>Wed, 16 Aug 2023 08:21:08 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_25/</guid><description><![CDATA[<p><strong>STLæ²¡æœ‰æ•£åˆ—è¡¨ã€‚</strong></p>
<p>å…¼å®¹STLçš„æ•£åˆ—å…³è”å®¹å™¨å¯ä»¥ä»å¤šä¸ªæ¥æºè·å¾—ï¼Œè€Œä¸”å®ƒä»¬ç”šè‡³æœ‰äº‹å®ä¸Šçš„æ ‡å‡†åå­—ï¼š<code>hash_set</code>ã€<code>hash_multiset</code>ã€<code>hash_map</code>å’Œ<code>hash_multimap</code>ã€‚åœ¨C++æ ‡å‡†å§”å‘˜ä¼šçš„è®®æ¡ˆä¸­ï¼Œæ•£åˆ—å®¹å™¨çš„åå­—æ˜¯<code>unordered_set</code>ã€ <code>unordered_multiset</code>ã€<code>unordered_map</code>å’Œ<code>unordered_multimap</code>ã€‚</p>
<p><strong>å®ƒä»¬åœ¨æ¥å£ã€èƒ½åŠ›ã€å†…åœ¨æ•°æ®ç»“æ„å’Œæ”¯æŒæ“ä½œçš„ç›¸å…³æ•ˆç‡æ–¹é¢ä¸åŒã€‚</strong></p>
<p>æœ€å¸¸è§çš„ä¸¤ä¸ªæ¥è‡ª<code>SGI</code>å’Œ<code>Dinkumware</code>ï¼Œ<code>STLport</code>ä¹Ÿæä¾›æ•£åˆ—å®¹å™¨ï¼Œä½†æ˜¯<code>STLport</code>çš„æ•£åˆ—å®¹å™¨æ˜¯åŸºäºæ¥è‡ª<code>SGI</code>çš„ã€‚</p>
<p>æ•£åˆ—å®¹å™¨æ˜¯å…³è”å®¹å™¨ï¼Œå®ƒä»¬éœ€è¦çŸ¥é“å‚¨å­˜åœ¨å®¹å™¨ä¸­çš„å¯¹è±¡ç±»å‹ï¼Œç”¨äºè¿™äº›å¯¹è±¡çš„æ¯”è¾ƒå‡½æ•°ï¼Œä»¥åŠç”¨äºè¿™äº›å¯¹è±¡çš„åˆ†é…å™¨ã€‚</p>
<h2 id="æ•£åˆ—å®¹å™¨å£°æ˜">æ•£åˆ—å®¹å™¨å£°æ˜</h2>
<p>æ•£åˆ—å®¹å™¨éœ€è¦æ•£åˆ—å‡½æ•°çš„è¯´æ˜ã€‚ä¸‹é¢æ˜¯æ•£åˆ—å®¹å™¨å£°æ˜ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">HashFunction</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">CompareFunction</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">Allocator</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">hash_container</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™éå¸¸æ¥è¿‘äºæ•£åˆ—å®¹å™¨çš„SGIå£°æ˜ï¼Œä¸»è¦å·®åˆ«æ˜¯SGIä¸ºHashFunctionå’ŒCompareFunctionæä¾›äº†é»˜è®¤ç±»å‹ã€‚</p>
<p><strong>SGI è®¾è®¡ä¸¾ä¾‹</strong></p>
<p><code>hash_set</code>çš„SGIå£°æ˜çœ‹èµ·æ¥åŸºæœ¬ä¸Šåƒè¿™æ ·ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">HashFunction</span> <span class="o">=</span> <span class="n">hash</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">CompareFunction</span> <span class="o">=</span> <span class="n">equa_to</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="k">typename</span> <span class="n">Allocator</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">hash_set</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>SGI</code>è®¾è®¡çš„ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ–¹é¢æ˜¯ä½¿ç”¨<code>equal_to</code>ä½œä¸ºé»˜è®¤æ¯”è¾ƒå‡½æ•°ã€‚<strong>è¿™è¿èƒŒæ ‡å‡†å…³è”å®¹å™¨çš„çº¦å®šâ€”â€”é»˜è®¤æ¯”è¾ƒå‡½æ•°æ˜¯lessã€‚</strong></p>
<p><code>SGI</code>çš„æ•£åˆ—å®¹å™¨ç¡®å®šåœ¨ä¸€ä¸ªæ•£åˆ—å®¹å™¨ä¸­çš„ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æœ‰ç›¸åŒçš„å€¼æ˜¯é€šè¿‡ç›¸ç­‰æµ‹è¯•ï¼Œè€Œä¸æ˜¯ç­‰ä»·ã€‚</p>
<p>å› ä¸ºæ•£åˆ—å…³è”å®¹å™¨ï¼Œä¸åƒå®ƒä»¬åœ¨æ ‡å‡†ä¸­çš„ï¼ˆé€šå¸¸åŸºäºæ ‘ï¼‰å…„å¼Ÿï¼Œä¸éœ€è¦ä¿æŒæœ‰åºã€‚</p>
<p><strong>Dinkumware è®¾è®¡ä¸¾ä¾‹</strong></p>
<p>Dinkumwareè®¾è®¡çš„æ•£åˆ—å®¹å™¨é‡‡å–ä¸€äº›ä¸åŒçš„ç­–ç•¥ã€‚å®ƒä»ç„¶å…è®¸ä½ æŒ‡å®šå¯¹è±¡ç±»å‹ã€æ•£åˆ—å‡½æ•°ç±»å‹ã€æ¯”è¾ƒå‡½æ•°ç±»å‹å’Œåˆ†é…å™¨ç±»å‹ï¼Œä½†æ˜¯<strong>å®ƒæŠŠé»˜è®¤çš„æ•£åˆ—å’Œæ¯”è¾ƒå‡½æ•°ç§»è¿›ä¸€ä¸ªå•ç‹¬çš„ç±»ä¼¼ç‰¹æ€§çš„å«åšhash_compareçš„ç±»</strong>ï¼Œè€Œä¸”å®ƒæŠŠ<code>hash_compare</code>ä½œä¸ºå®¹å™¨æ¨¡æ¿çš„<code>HashingInfo</code>å®å‚çš„é»˜è®¤å€¼ã€‚</p>
<p>è¿™æ˜¯<code>Dinkumware</code>çš„hash_setå£°æ˜ï¼ˆå†æ¬¡ä¸ºæ¼”ç¤ºè€Œè°ƒæ•´è¿‡ï¼‰:</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">CompareFunction</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">hash_compare</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">HashingInfo</span> <span class="o">=</span> <span class="n">hash_compare</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">less</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">Allocator</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">hash_set</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æ¥å£è®¾è®¡æœ‰è¶£çš„åœ°æ–¹æ˜¯<code>HashingInfo</code>çš„ä½¿ç”¨ã€‚</p>
<p><strong>å®¹å™¨çš„æ•£åˆ—å’Œæ¯”è¾ƒå‡½æ•°å‚¨å­˜åœ¨<code>HashingInfo</code>ä¸­ï¼Œä½†HashingInfoç±»å‹ä¹Ÿå®¹çº³äº†æ§åˆ¶è¡¨ä¸­æ¡¶ï¼ˆbucketï¼‰æœ€å°æ•°é‡ï¼Œä»¥åŠå®¹å™¨å…ƒç´ å¯¹æ¡¶çš„æœ€å¤§å…è®¸æ¯”ç‡çš„æšä¸¾ã€‚</strong></p>
<p>å½“è¿™æ¯”ç‡è¢«è¶…è¿‡æ—¶ï¼Œè¡¨ä¸­æ¡¶çš„æ•°é‡å°±å¢åŠ ï¼Œè€Œè¡¨ä¸­çš„ä¸€äº›å…ƒç´ éœ€è¦é‡æ–°æ•£åˆ—ã€‚ï¼ˆSGIæä¾›å…·æœ‰ç±»ä¼¼æ§åˆ¶è¡¨ä¸­æ¡¶å’Œè¡¨ä¸­å…ƒç´ å¯¹æ¡¶æ¯”ç‡çš„æˆå‘˜å‡½æ•°ã€‚ï¼‰</p>
<p><strong>hash_compare</strong></p>
<p><code>hash_compare</code>ï¼ˆHashingInfoçš„é»˜è®¤å€¼ï¼‰çœ‹èµ·æ¥æˆ–å¤šæˆ–å°‘åƒè¿™æ ·:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">CompareFunction</span> <span class="o">=</span> <span class="n">less</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">hash_compare</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">enum</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">bucket_size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="c1">// å…ƒç´ å¯¹æ¡¶çš„æœ€å¤§æ¯”ç‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">min_buckets</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1">// æ¡¶çš„æœ€å°æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span> <span class="c1">// æ•£åˆ—å‡½æ•°æ¯”è¾ƒå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span> <span class="c1">// å¿½ç•¥ä¸€äº›ä¸œè¥¿ï¼ŒåŒ…æ‹¬ CompareFunctionçš„ä½¿ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‡è½½<code>operator()</code>ï¼ˆåœ¨è¿™é‡Œæ˜¯å®ç°æ•£åˆ—å’Œæ¯”è¾ƒå‡½æ•°ï¼‰æ˜¯æ¯”ä½ å¯ä»¥æƒ³è±¡çš„æ›´ç»å¸¸å‡ºç°çš„ä¸€ä¸ªç­–ç•¥ã€‚</p>
<p><code>Dinkumware</code>è®¾è®¡å…è®¸ä½ å†™ä½ è‡ªå·±çš„ç±»ä¼¼hash_compareçš„ç±»ï¼ˆä¹Ÿè®¸é€šè¿‡ä»<code>hash_compare</code>æœ¬èº«æ´¾ç”Ÿè€Œæ¥ï¼‰ï¼Œè€Œä¸”åªè¦ä½ çš„ç±»å®šä¹‰äº†<code>bucket_size</code>ã€<code>min_buckets</code>ã€ä¸¤ä¸ª<code>operator()</code>å‡½æ•°ï¼ˆä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªå®å‚ï¼Œä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªï¼‰ï¼ŒåŠ ä¸Šå·²ç»çœå»çš„ä¸€äº›ä¸œè¥¿ï¼Œå°±èƒ½ä½¿ç”¨å®ƒæ¥æ§åˆ¶Dinkumwareçš„<code>hash_set</code>æˆ–<code>hash_multiset</code>çš„é…ç½®å’Œè¡Œä¸ºã€‚</p>
<p><code>hash_map</code>å’Œ<code>hash_multimap</code>çš„é…ç½®æ§åˆ¶ä¹Ÿç›¸ä¼¼ã€‚</p>
<h2 id="å†³ç­–ç•™ç»™å®ç°">å†³ç­–ç•™ç»™å®ç°</h2>
<p>æ³¨æ„ä¸ç®¡æ˜¯SGIè¿˜æ˜¯Dinkumwareçš„è®¾è®¡ï¼Œä½ éƒ½èƒ½æŠŠå…¨éƒ¨å†³ç­–ç•™ç»™å®ç°:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// å»ºç«‹ä¸€ä¸ªintçš„æ•£åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">hash_set</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">intTable</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦è®©è¿™ä¸ªå¯ä»¥ç¼–è¯‘ï¼Œæ•£åˆ—è¡¨å¿…é¡»å®¹çº³ä¸€ä¸ªæ•´æ•°ç±»å‹ï¼ˆä¾‹å¦‚intï¼‰ï¼Œå› ä¸º<strong>é»˜è®¤æ•£åˆ—å‡½æ•°ä¸€èˆ¬å±€é™äºæ•´æ•°ç±»å‹ã€‚</strong></p>
<p><strong>å®ç°æ–¹æ³•ä¸åŒ</strong></p>
<p>åœ¨åç«¯ï¼ŒSGIå’ŒDinkumwareçš„å®ç°æ–¹æ³•éå¸¸ä¸åŒã€‚</p>
<ol>
<li>SGIåˆ©ç”¨å¸¸ç”¨çš„ä¸€ä¸ªå…ƒç´ çš„å•é“¾è¡¨çš„æŒ‡é’ˆæ•°ç»„ï¼ˆæ¡¶ï¼‰ç»„æˆçš„å¼€æ”¾æ•£åˆ—æ³•ã€‚</li>
<li>Dinkumwareä¹Ÿåˆ©ç”¨äº†å¼€æ”¾æ•£åˆ—æ³•ï¼Œä½†æ˜¯å®ƒçš„è®¾è®¡æ˜¯åŸºäºä¸€ç§æ–°é¢–çš„æ•°æ®ç»“æ„â€”â€”ç”±è¿­ä»£å™¨ï¼ˆæœ¬è´¨æ˜¯æ¡¶ï¼‰çš„æ•°ç»„ç»„æˆçš„å…ƒç´ åŒå‘é“¾è¡¨ï¼Œè¿­ä»£å™¨çš„ç›¸é‚»å¯¹è¡¨ç¤ºåœ¨æ¯ä¸ªæ¡¶é‡Œå…ƒç´ çš„èŒƒå›´ã€‚</li>
</ol>
<p><strong>é“¾è¡¨ä¸åŒ</strong></p>
<ol>
<li>SGIå®ç°åœ¨<strong>å•é“¾è¡¨</strong>ä¸­å‚¨å­˜è¡¨çš„å…ƒç´ </li>
<li>Dinkumwareå®ç°ä½¿ç”¨ä¸€ä¸ªåŒå‘é“¾è¡¨</li>
</ol>
<p><strong>è¿­ä»£å™¨ç§ç±»ä¸åŒ</strong></p>
<ol>
<li>SGIçš„æ•£åˆ—å®¹å™¨æä¾›äº†å‰å‘è¿­ä»£å™¨ï¼Œå› æ­¤ä½ å¾—æ”¾å¼ƒè¿›è¡Œåå‘è¿­ä»£çš„èƒ½åŠ›ï¼šåœ¨SGIçš„æ•£åˆ—å®¹å™¨ä¸­æ²¡æœ‰rbeginæˆ–è€…rendæˆå‘˜å‡½æ•°ã€‚</li>
<li>ç”¨äºDinkumwareæ•£åˆ—å®¹å™¨çš„è¿­ä»£å™¨æ˜¯åŒå‘çš„ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥æä¾›å‰å‘å’Œåå‘éå†ã€‚</li>
</ol>
<p><strong>å†…å­˜ä½¿ç”¨é‡æ–¹é¢ä¸åŒ</strong></p>
<p>SGIçš„è®¾è®¡æ¯”Dinkumwareçš„èŠ‚ä¿­ä¸€ç‚¹ç‚¹ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>è™½ç„¶STLæœ¬èº«ç¼ºä¹æ•£åˆ—å®¹å™¨ï¼Œå…¼å®¹STLçš„æ•£åˆ—å®¹å™¨ï¼ˆæœ‰ä¸åŒçš„æ¥å£ã€èƒ½åŠ›å’Œè¡Œä¸ºæƒè¡¡ï¼‰ä¸éš¾å¾—åˆ°ã€‚å°±SGIå’ŒSTLportçš„å®ç°è€Œè¨€ï¼Œä½ ç”šè‡³å¯ä»¥å…è´¹ä¸‹è½½å¾—åˆ°å®ƒä»¬ã€‚</p>
]]></description></item><item><title>Effective STL [24] | å½“å…³ä¹æ•ˆç‡æ—¶åº”è¯¥åœ¨map::operator[]å’Œmap-insertä¹‹é—´ä»”ç»†é€‰æ‹©</title><link>https://jianye0428.github.io/posts/clause_24/</link><pubDate>Tue, 15 Aug 2023 08:10:23 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_24/</guid><description><![CDATA[<h2 id="example-mapæ’å…¥">Example mapæ’å…¥</h2>
<p>å‡è®¾æœ‰ä¸€ä¸ªæ”¯æŒé»˜è®¤æ„é€ å‡½æ•°ä»¥åŠä»ä¸€ä¸ªdoubleæ„é€ å’Œèµ‹å€¼çš„Widgetç±»:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="n">Widget</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Widget</span><span class="p">(</span><span class="kt">double</span> <span class="n">weight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Widget</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="kt">double</span> <span class="n">weight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å‡è®¾æˆ‘ä»¬æƒ³å»ºç«‹ä¸€ä¸ªä»intåˆ°Widgetçš„mapï¼Œè€Œä¸”æˆ‘ä»¬æƒ³æœ‰åˆå§‹åŒ–æœ‰ç‰¹å®šå€¼çš„æ˜ å°„:</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Widget</span><span class="o">&gt;</span> <span class="n">m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.50</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.67</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mf">45.8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0003</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>map operator[] å·¥ä½œåŸç†</strong></p>
<p>mapçš„<code>operator[]</code>å‡½æ•°æ˜¯ä¸ªå¥‡æ€ªçš„ä¸œè¥¿ã€‚å®ƒä¸vectorã€dequeå’Œstringçš„<code>operator[]</code>å‡½æ•°æ— å…³ï¼Œä¹Ÿå’Œå†…å»ºçš„æ•°ç»„operator[]æ— å…³ã€‚</p>
<p><code>map::operator[]</code>è¢«è®¾è®¡ä¸ºç®€åŒ–â€œæ·»åŠ æˆ–æ›´æ–°â€åŠŸèƒ½ã€‚å³ï¼Œç»™å®š<code>map&lt;K, V&gt; m</code>;è¿™ä¸ªè¡¨è¾¾å¼</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æ£€æŸ¥é”®kæ˜¯å¦å·²ç»åœ¨mapé‡Œã€‚å¦‚æœä¸ï¼Œå°±æ·»åŠ ä¸Šï¼Œä»¥vä½œä¸ºå®ƒçš„å¯¹åº”å€¼ã€‚å¦‚æœkå·²ç»åœ¨mapé‡Œï¼Œå®ƒçš„å…³è”å€¼è¢«æ›´æ–°æˆvã€‚</strong></p>
<p>è¿™é¡¹å·¥ä½œçš„åŸç†æ˜¯<code>operator[]</code>è¿”å›ä¸€ä¸ªä¸kå…³è”çš„å€¼å¯¹è±¡çš„å¼•ç”¨ã€‚ç„¶åvèµ‹å€¼ç»™æ‰€å¼•ç”¨ï¼ˆ<code>ä»operator[]</code>è¿”å›çš„ï¼‰çš„å¯¹è±¡ã€‚</p>
<p>å½“è¦æ›´æ–°ä¸€ä¸ªå·²å­˜åœ¨çš„é”®çš„å…³è”å€¼æ—¶å¾ˆç›´æ¥ï¼Œå› ä¸ºå·²ç»æœ‰<code>operator[]</code>å¯ä»¥ç”¨æ¥è¿”å›å¼•ç”¨çš„å€¼å¯¹è±¡ã€‚</p>
<p>ä½†æ˜¯å¦‚æœkè¿˜ä¸åœ¨mapé‡Œï¼Œ<code>operator[]</code>å°±æ²¡æœ‰å¯ä»¥å¼•ç”¨çš„å€¼å¯¹è±¡ã€‚é‚£æ ·çš„è¯ï¼Œå®ƒä½¿ç”¨å€¼ç±»å‹çš„é»˜è®¤æ„é€ å‡½æ•°ä»å¤´å¼€å§‹å»ºç«‹ä¸€ä¸ªï¼Œç„¶å<code>operator[]</code>è¿”å›è¿™ä¸ªæ–°å»ºç«‹å¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<p>è®©æˆ‘ä»¬å†æ¬¡åœ°çœ‹çœ‹åŸå…ˆä¾‹å­çš„ç¬¬ä¸€éƒ¨åˆ†ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Widget</span><span class="o">&gt;</span> <span class="n">m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.50</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¡¨è¾¾å¼<code>m[1]</code>æ˜¯<code>m.operator[](1)</code>çš„ç®€åŒ–ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ª<code>map::operator[]</code>çš„è°ƒç”¨ã€‚</p>
<p>è¿™ä¸ªå‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªWidgetçš„å¼•ç”¨ï¼Œå› ä¸ºm çš„æ˜ å°„ç±»å‹æ˜¯Widgetã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œmé‡Œé¢è¿˜æ²¡æœ‰ä»»ä½•ä¸œè¥¿ï¼Œæ‰€ä»¥é”®1åœ¨mapé‡Œæ²¡æœ‰å…¥å£ã€‚å› æ­¤<code>operator[]</code>é»˜è®¤æ„é€ ä¸€ä¸ªWidgetæ¥ä½œä¸ºå…³è”åˆ°1çš„å€¼ï¼Œç„¶åè¿”å›åˆ°é‚£ä¸ªWidgetçš„å¼•ç”¨ã€‚</p>
<p>æœ€åï¼ŒWidgetæˆä¸ºèµ‹å€¼ç›®æ ‡ï¼šè¢«èµ‹å€¼çš„å€¼æ˜¯1.50ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸‹é¢è¿™ä¸ªè¯­å¥</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.50</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>åŠŸèƒ½ä¸Šç­‰ä»·äºè¿™ä¸ª:</strong></p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">// æ–¹ä¾¿çš„ typedef
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Widget</span><span class="o">&gt;</span> <span class="n">IntWidgetMap</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ç”¨é”®1å»ºç«‹æ–°æ˜ å°„å…¥å£å’Œä¸€ä¸ªé»˜è®¤æ„é€ çš„å€¼å¯¹è±¡ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pair</span><span class="o">&lt;</span><span class="n">IntWidgetMap</span><span class="o">::</span><span class="n">iterator</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"> <span class="n">m</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">IntWidgetMap</span><span class="o">::</span><span class="n">value_type</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Widget</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// èµ‹å€¼ç»™å€¼ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">result</span><span class="p">.</span><span class="n">first</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">=</span> <span class="mf">1.50</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç°åœ¨å·²ç»å¾ˆæ¸…æ¥šä¸ºä»€ä¹ˆè¿™ç§æ–¹æ³•å¯èƒ½é™ä½æ€§èƒ½äº†ï¼šå…ˆé»˜è®¤æ„é€ ä¸€ä¸ªWidgetï¼Œç„¶åæˆ‘ä»¬ç«‹å³èµ‹ç»™å®ƒæ–°å€¼ã€‚</strong></p>
<p><strong><code>map insert</code>æ›´é«˜æ•ˆ</strong></p>
<p>å¦‚æœ<strong>ç”¨æƒ³è¦çš„å€¼æ„é€ Widgetæ¯”é»˜è®¤æ„é€ Widgetç„¶åè¿›è¡Œèµ‹å€¼æ˜¾ç„¶æ›´é«˜æ•ˆ</strong>ï¼Œå°±åº”è¯¥ç”¨ç›´æˆªäº†å½“çš„insertè°ƒç”¨æ¥æ›¿æ¢operator[]çš„ä½¿ç”¨ï¼ˆåŒ…æ‹¬å®ƒçš„æ„é€ åŠ èµ‹å€¼ï¼‰:</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">m</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">IntWidgetMap</span><span class="o">::</span><span class="n">value_type</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ä¸Šé¢çš„é‚£äº›ä»£ç æœ‰ç›¸åŒçš„æœ€ç»ˆæ•ˆæœï¼Œé™¤äº†å®ƒ<strong>é€šå¸¸èŠ‚çœäº†3æ¬¡å‡½æ•°è°ƒç”¨</strong>ï¼š</p>
<ol>
<li>ä¸€ä¸ªå»ºç«‹ä¸´æ—¶çš„é»˜è®¤æ„é€ Widgetå¯¹è±¡</li>
<li>ä¸€ä¸ªé”€æ¯é‚£ä¸ªä¸´æ—¶çš„å¯¹è±¡</li>
<li>ä¸€ä¸ªå¯¹Widgetçš„èµ‹å€¼æ“ä½œã€‚</li>
</ol>
<p>è¿™äº›å‡½æ•°è°ƒç”¨è¶Šæ˜‚è´µï¼Œä½ é€šè¿‡ä½¿ç”¨map-insertä»£æ›¿<code>map::operator[]</code>å°±èƒ½èŠ‚çœè¶Šå¤šã€‚</p>
<p>ä¸Šé¢çš„ä»£ç åˆ©ç”¨äº†æ¯ä¸ªæ ‡å‡†å®¹å™¨éƒ½æä¾›çš„value_type typedefã€‚è¿™typedefæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«é‡è¦çš„ï¼Œä½†å¯¹äºmapå’Œmultimapï¼ˆä»¥åŠéæ ‡å‡†å®¹å™¨çš„hash_mapå’Œhash_multimapâ€”â€”å‚è§æ¡æ¬¾25ï¼‰ï¼Œè®°ä½å®ƒæ˜¯å¾ˆé‡è¦çš„ï¼Œå®¹å™¨å…ƒç´ çš„ç±»å‹æ€»æ˜¯æŸç§pairã€‚</p>
<p>ä¹‹å‰è°ˆåŠçš„<code>operator[]</code>è¢«è®¾è®¡ä¸ºç®€åŒ–â€œæ·»åŠ æˆ–æ›´æ–°â€åŠŸèƒ½ï¼Œè€Œä¸”ç°åœ¨æˆ‘ä»¬ç†è§£äº†å½“â€œå¢åŠ â€è¢«æ‰§è¡Œæ—¶ï¼Œ<code>insert</code>æ¯”<code>operator[]</code>æ›´é«˜æ•ˆã€‚å½“åšæ›´æ–°æ—¶ï¼Œæƒ…å½¢æ­£å¥½ç›¸åï¼Œä¹Ÿå°±æ˜¯ï¼Œå½“ä¸€ä¸ªç­‰ä»·çš„é”®è¿™å·²ç»åœ¨mapé‡Œæ—¶ã€‚</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨operator[]æ¥æŠŠkçš„å€¼æ›´æ–°ä¸ºv
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¥æŠŠkçš„å€¼æ›´æ–°ä¸ºvä½¿ç”¨insert
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">m</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">IntWidgetMap</span><span class="o">::</span><span class="n">value_type</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)).</span><span class="n">first</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="operator-ä¸-insert-æƒè¡¡">operator[] ä¸ insert æƒè¡¡</h2>
<p>insertçš„è°ƒç”¨éœ€è¦<code>IntWidgetMap::value_type</code>ç±»å‹çš„å®å‚ï¼ˆå³<code>pair&lt;int, Widget&gt;</code>ï¼‰ï¼Œæ‰€ä»¥å½“è°ƒç”¨insertæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æ„é€ å’Œææ„ä¸€ä¸ªé‚£ç§ç±»å‹çš„å¯¹è±¡ã€‚é‚£è€—è´¹äº†ä¸€å¯¹æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ï¼Œä¹Ÿä¼šé€ æˆä¸€ä¸ªWidgetçš„æ„é€ å’Œææ„ï¼Œå› ä¸º<code>pair&lt;int, Widget&gt;</code>æœ¬èº«åŒ…å«äº†ä¸€ä¸ªWidgetå¯¹è±¡ï¼Œ<strong>operator[]æ²¡æœ‰ä½¿ç”¨pairå¯¹è±¡ï¼Œæ‰€ä»¥æ²¡æœ‰æ„é€ å’Œææ„pairå’ŒWidgetã€‚</strong></p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>æƒ…å½¢é€‰æ‹©:</p>
<ol>
<li>å› æ­¤å‡ºäºå¯¹æ•ˆç‡çš„è€ƒè™‘ï¼Œå½“ç»™<code>map</code>æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬æ–­å®š<code>insert</code>æ¯”<code>operator[]</code>å¥½ï¼›</li>
<li>ä»æ•ˆç‡å’Œç¾å­¦è€ƒè™‘ï¼Œå½“æ›´æ–°å·²ç»åœ¨<code>map</code>é‡Œçš„å…ƒç´ å€¼æ—¶<code>operator[]</code>æ›´å¥½ã€‚</li>
</ol>
</div>
    </div>
  </div>
<p>å¦‚æœSTLæä¾›ä¸€ä¸ªä¸¤å…¨å…¶ç¾çš„å‡½æ•°ï¼Œå³ï¼Œåœ¨å¥æ³•ä¸Šå¸å¼•äººçš„åŒ…ä¸­çš„é«˜æ•ˆçš„â€œæ·»åŠ æˆ–æ›´æ–°â€åŠŸèƒ½:</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// å¦‚æœé”®kä¸å†map mä¸­ï¼›é«˜æ•ˆåœ°æŠŠpair(k, v)æ·»åŠ åˆ°mä¸­ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¦åˆ™é«˜æ•ˆåœ°æŠŠå’Œkå…³è”çš„å€¼æ›´æ–°ä¸ºvã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// è¿”å›ä¸€ä¸ªæŒ‡å‘æ·»åŠ æˆ–ä¿®æ”¹çš„pairçš„è¿­ä»£å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">iterator</span> <span class="n">affectedPair</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"> <span class="n">efficientAddOrUpdate</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯ï¼Œåœ¨STLå†…æ²¡æœ‰åƒè¿™æ ·çš„å‡½æ•°ï¼Œæ­£å¦‚ä¸‹é¢çš„ä»£ç æ‰€æ¼”ç¤ºçš„ï¼Œè‡ªå·±å†™ä¸€ä¸ªå¹¶ä¸éš¾ã€‚é‚£äº›æ³¨é‡Šæ€»ç»“äº†æ­£åœ¨åšä»€ä¹ˆï¼Œè€Œä¸”éšåçš„æ®µè½ä¹Ÿæä¾›äº†ä¸€äº›é™„åŠ çš„è§£é‡Šã€‚</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// mapçš„ç±»å‹KeyArgTypeå’ŒValueArgtypeæ˜¯ç±»å‹å‚æ•°çš„åŸå› è¯·çœ‹ä¸‹é¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">MapType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">KeyArgType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">ValueArgtype</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">MapType</span><span class="o">::</span><span class="n">iterator</span> <span class="n">efficientAddOrUpdate</span><span class="p">(</span><span class="n">MapType</span><span class="o">&amp;</span> <span class="n">m</span><span class="p">,</span> <span class="k">const</span> <span class="n">KeyArgType</span><span class="o">&amp;</span> <span class="n">k</span><span class="p">,</span> <span class="k">const</span> <span class="n">ValueArgtype</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="c1">// æ‰¾åˆ°kåœ¨æˆ–åº”è¯¥åœ¨å“ªé‡Œï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="k">typename</span> <span class="n">MapType</span><span class="o">::</span><span class="n">iterator</span> <span class="n">Ib</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¦‚æœIbæŒ‡å‘ä¸€ä¸ªpair, å®ƒçš„é”®ç­‰ä»·äºk...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="k">if</span><span class="p">(</span><span class="n">Ib</span> <span class="o">!=</span> <span class="n">m</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">key_comp</span><span class="p">()(</span><span class="n">k</span><span class="p">,</span> <span class="n">Ib</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// æ›´æ–°è¿™ä¸ªpairçš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">Ib</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// å¹¶è¿”å›æŒ‡å‘pairçš„è¿­ä»£å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="n">Ib</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">MapType</span><span class="o">::</span><span class="n">value_type</span> <span class="n">MVT</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">       <span class="c1">// æŠŠpair(k, v)æ·»åŠ åˆ°må¹¶// è¿”å›æŒ‡å‘æ–°mapå…ƒç´ çš„è¿­ä»£å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="n">m</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Ib</span><span class="p">,</span> <span class="n">MVT</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œä¸€ä¸ªé«˜æ•ˆçš„å¢åŠ æˆ–æ›´æ–°ï¼Œæˆ‘ä»¬éœ€è¦èƒ½<strong>æ‰¾å‡ºkçš„å€¼æ˜¯å¦åœ¨mapä¸­; å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£å®ƒåœ¨å“ªé‡Œ; å¦‚æœä¸æ˜¯ï¼Œå®ƒè¯¥è¢«æ’å…¥å“ªé‡Œã€‚</strong></p>
<p>è¿™ä¸ªå·¥ä½œæ˜¯ä¸º<code>low_bound</code>é‡èº«å®šåšçš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬è°ƒç”¨é‚£ä¸ªå‡½æ•°ã€‚ç¡®å®šlower_boundæ˜¯å¦ç”¨æˆ‘ä»¬è¦å¯»æ‰¾çš„é”®æ‰¾åˆ°äº†ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬å¯¹ååŠéƒ¨åˆ†è¿›è¡Œä¸€ä¸ªç­‰ä»·æµ‹è¯•ï¼Œä¸€å®šè¦å¯¹mapä½¿ç”¨æ­£ç¡®çš„æ¯”è¾ƒå‡½æ•°: é€šè¿‡<code>map::key_comp</code>æä¾›çš„æ¯”è¾ƒå‡½æ•°ã€‚ç­‰ä»·æµ‹è¯•çš„ç»“æœå‘Šè¯‰æˆ‘ä»¬åº”è¯¥è¿›è¡Œå¢åŠ è¿˜æ˜¯æ›´æ–°ã€‚</p>
<p>å¦‚æœæ˜¯æ›´æ–°ï¼Œä»£ç å¾ˆç›´æˆªäº†å½“ã€‚æ’å…¥åˆ†æ”¯æ›´æœ‰è¶£ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†insertçš„â€œæç¤ºâ€å½¢å¼ã€‚ç»“æ„<code>m.insert(Ibï¼ŒMVT(kï¼Œv))</code>â€œæç¤ºâ€äº†**<code>Ib</code>é‰´åˆ«å‡ºäº†é”®ç­‰ä»·äºkçš„æ–°å…ƒç´ æ­£ç¡®çš„æ’å…¥ä½ç½®ï¼Œè€Œä¸”ä¿è¯å¦‚æœæç¤ºæ­£ç¡®ï¼Œé‚£ä¹ˆæ’å…¥å°†åœ¨åˆ†æ‘Šçš„å¸¸æ•°æ—¶é—´å†…å‘ç”Ÿï¼Œè€Œä¸æ˜¯å¯¹æ•°æ—¶é—´**ã€‚åœ¨<code>efficientAddOrUpdate</code>é‡Œï¼Œæˆ‘ä»¬çŸ¥é“Ibé‰´åˆ«å‡ºäº†é€‚å½“çš„æ’å…¥ä½ç½®ï¼Œå› æ­¤insertçš„è°ƒç”¨è¢«ä¿è¯ä¸ºæ˜¯ä¸€æ¬¡å¸¸æ•°æ—¶é—´æ“ä½œã€‚</p>
<p><strong>KeyArgTypeå’ŒValueArgType</strong></p>
<p>è¿™ä¸ªå®ç°çš„ä¸€ä¸ªæœ‰è¶£æ–¹é¢æ˜¯<code>KeyArgType</code>å’Œ<code>ValueArgType</code>ä¸å¿…æ˜¯å‚¨å­˜åœ¨mapé‡Œçš„ç±»å‹ã€‚å®ƒä»¬åªéœ€è¦å¯ä»¥è½¬æ¢åˆ°å‚¨å­˜åœ¨mapé‡Œçš„ç±»å‹ã€‚</p>
<p>ä¸€ä¸ªå¯é€‰çš„æ–¹æ³•æ˜¯å»æ‰ç±»å‹å‚æ•°<code>KeyArgType</code>å’Œ<code>ValueArgType</code>ï¼Œæ”¹ä¸ºä½¿ç”¨<code>MapType::key_type</code>å’Œ<code>MapType::mapped_type</code>ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬é‚£ä¹ˆåšï¼Œ<strong>åœ¨è°ƒç”¨æ—¶æˆ‘ä»¬å¯èƒ½å¼ºè¿«å‘ç”Ÿä¸å¿…è¦çš„ç±»å‹è½¬æ¢</strong>:</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Widget</span><span class="o">&gt;</span> <span class="n">m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ«å¿˜äº†Widgetæ¥å—ä»ä¸€ä¸ªdoubleèµ‹å€¼ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">Widget</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="kt">double</span> <span class="n">weight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨è€ƒè™‘<code>efficientAddOrUpdate</code>çš„è°ƒç”¨:</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">efficientAddOrUpdate</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å‡è®¾æ˜¯ä¸€æ¬¡æ›´æ–°æ“ä½œï¼Œå³ï¼Œmå·²ç»åŒ…å«é”®æ˜¯10çš„å…ƒç´ ã€‚é‚£æ ·çš„è¯ï¼Œä¸Šé¢çš„æ¨¡æ¿æ¨æ–­å‡º<code>ValueArgType</code>æ˜¯<code>double</code>ï¼Œ<strong>å‡½æ•°ä½“ç›´æ¥æŠŠ1.5ä½œä¸ºdoubleèµ‹ç»™ä¸10ç›¸å…³çš„é‚£ä¸ªWidget</strong>ã€‚é‚£æ˜¯é€šè¿‡è°ƒç”¨<code>Widget::operator(double)</code>å®Œæˆçš„ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ç”¨äº†<code>MapType::mapped_type</code>ä½œä¸º<code>efficientAddOrUpdate</code>çš„ç¬¬3ä¸ªå‚æ•°çš„ç±»å‹ï¼Œåœ¨è°ƒç”¨æ—¶æˆ‘ä»¬å¾—æŠŠ1.5è½¬åŒ–æˆä¸€ä¸ªWidgetï¼Œé‚£æ ·çš„è¯æˆ‘ä»¬å°±å¾—<strong>èŠ±è´¹æœ¬æ¥ä¸éœ€è¦çš„ä¸€æ¬¡Widgetæ„é€ ï¼ˆä»¥åŠéšåçš„ææ„ï¼‰</strong>ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>å½“å…³ä¹æ•ˆç‡æ—¶åº”è¯¥åœ¨map::operator[]å’Œmap-insertä¹‹é—´ä»”ç»†é€‰æ‹©ã€‚</p>
<p><font color=red>å¦‚æœä½ è¦æ›´æ–°å·²å­˜åœ¨çš„mapå…ƒç´ ï¼Œoperator[]æ›´å¥½ï¼Œä½†å¦‚æœä½ è¦å¢åŠ ä¸€ä¸ªæ–°å…ƒç´ ï¼Œinsertåˆ™æœ‰ä¼˜åŠ¿ã€‚</font></p>
]]></description></item><item><title>Effective STL [23] | è€ƒè™‘ç”¨æœ‰åºvectorä»£æ›¿å…³è”å®¹å™¨</title><link>https://jianye0428.github.io/posts/clause_23/</link><pubDate>Mon, 14 Aug 2023 19:13:32 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_23/</guid><description><![CDATA[<p>å½“éœ€è¦ä¸€ä¸ªæä¾›å¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®ç»“æ„æ—¶ï¼Œå¾ˆå¤šSTLç¨‹åºå‘˜ç«‹åˆ»ä¼šæƒ³åˆ°æ ‡å‡†å…³è”å®¹å™¨ï¼š<code>set</code>ã€<code>multiset</code>ã€<code>map</code>å’Œ<code>multimap</code>ã€‚</p>
<p>å¦‚æœä½¿ç”¨äº†åˆé€‚çš„æ•£åˆ—å‡½æ•°ï¼Œåˆ™å¯ä»¥è®¤ä¸ºæ•£åˆ—å®¹å™¨æä¾›äº†å¸¸æ•°æ—¶é—´çš„æŸ¥æ‰¾ã€‚</p>
<p>å¯¹äºå¤šæ•°åº”ç”¨ï¼Œè¢«è®¤ä¸ºæ˜¯å¸¸æ•°æ—¶é—´æŸ¥æ‰¾çš„æ•£åˆ—å®¹å™¨è¦å¥½äºä¿è¯äº†å¯¹æ•°æ—¶é—´æŸ¥æ‰¾çš„<code>set</code>ã€<code>map</code>å’Œå®ƒä»¬çš„<code>multi</code>åŒäº‹ã€‚</p>
<p>å³ä½¿ä½ éœ€è¦çš„å°±åªæ˜¯==å¯¹æ•°æ—¶é—´==æŸ¥æ‰¾çš„ä¿è¯ï¼Œæ ‡å‡†å…³è”å®¹å™¨ä»ç„¶å¯èƒ½ä¸æ˜¯ä½ çš„æœ€ä½³é€‰æ‹©ã€‚å’Œç›´è§‰ç›¸åï¼Œå¯¹äºæ ‡å‡†å…³è”å®¹å™¨ï¼Œæ‰€æä¾›çš„æ€§èƒ½ä¹Ÿç»å¸¸åŠ£äºæœ¬è¯¥æ¯”è¾ƒæ¬¡çš„<code>vector</code>ã€‚</p>
<h2 id="å…³è”å®¹å™¨æ•°æ®ç»“æ„">å…³è”å®¹å™¨æ•°æ®ç»“æ„</h2>
<p>æ ‡å‡†å…³è”å®¹å™¨çš„å…¸å‹å®ç°æ˜¯<strong>å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘</strong>ã€‚</p>
<p>ä¸€ä¸ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸€ä¸ªå¯¹<strong>æ’å…¥</strong>ã€<strong>åˆ é™¤</strong>å’Œ<strong>æŸ¥æ‰¾</strong>çš„æ··åˆæ“ä½œä¼˜åŒ–çš„æ•°æ®ç»“æ„ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œå®ƒè¢«è®¾è®¡ä¸ºåº”ç”¨äºè¿›è¡Œä¸€äº›æ’å…¥ï¼Œç„¶åä¸€äº›æŸ¥æ‰¾ï¼Œç„¶åå¯èƒ½å†è¿›è¡Œä¸€äº›æ’å…¥ï¼Œç„¶åä¹Ÿè®¸ä¸€äº›åˆ é™¤ï¼Œç„¶åå†æ¥ä¸€äº›æŸ¥æ‰¾ï¼Œç„¶åæ›´å¤šçš„æ’å…¥æˆ–åˆ é™¤ï¼Œç„¶åæ›´å¤šçš„æŸ¥æ‰¾ç­‰ã€‚è¿™ä¸ªäº‹ä»¶åºåˆ—çš„å…³é”®ç‰¹å¾æ˜¯æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾éƒ½æ˜¯æ··åˆåœ¨ä¸€èµ·çš„ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ²¡æœ‰åŠæ³•é¢„æµ‹å¯¹æ ‘çš„ä¸‹ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆã€‚</p>
<p><strong>ä½¿ç”¨æ•°æ®ç»“æ„çš„3é˜¶æ®µ</strong></p>
<ol>
<li><strong>å»ºç«‹</strong>ã€‚é€šè¿‡æ’å…¥å¾ˆå¤šå…ƒç´ å»ºç«‹ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå‡ ä¹æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æ’å…¥å’Œåˆ é™¤ã€‚å‡ ä¹æ²¡æœ‰æˆ–æ ¹æœ¬æ²¡æœ‰æŸ¥æ‰¾ã€‚</li>
<li><strong>æŸ¥æ‰¾</strong>ã€‚åœ¨æ•°æ®ç»“æ„ä¸­æŸ¥æ‰¾æŒ‡å®šçš„ä¿¡æ¯ç‰‡ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå‡ ä¹æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æŸ¥æ‰¾ã€‚å‡ ä¹æ²¡æœ‰æˆ–æ ¹æœ¬æ²¡æœ‰æ’å…¥å’Œåˆ é™¤ã€‚</li>
<li><strong>é‡ç»„</strong>ã€‚ä¿®æ”¹æ•°æ®ç»“æ„çš„å†…å®¹ï¼Œé€šè¿‡åˆ é™¤æ‰€æœ‰ç°æœ‰æ•°æ®å’Œåœ¨åŸåœ°æ’å…¥æ–°æ•°æ®ã€‚ä»åŠ¨ä½œä¸Šè¯´ï¼Œè¿™ä¸ªé˜¶æ®µç­‰ä»·äºé˜¶æ®µ1ã€‚ä¸€æ—¦è¿™ä¸ªé˜¶æ®µå®Œæˆï¼Œåº”ç”¨ç¨‹åºè¿”å›é˜¶æ®µ2ã€‚</li>
</ol>
<h2 id="æœ‰åºvectoræ›´é«˜æ•ˆ">æœ‰åºvectoræ›´é«˜æ•ˆ</h2>
<p>ä¸€ä¸ªvectorå¯èƒ½æ¯”ä¸€ä¸ªå…³è”å®¹å™¨èƒ½æä¾›æ›´é«˜çš„æ€§èƒ½ï¼ˆæ—¶é—´å’Œç©ºé—´ä¸Šéƒ½æ˜¯ï¼‰ã€‚</p>
<p>ä½†ä¸æ˜¯ä»»æ„çš„<code>vector</code>éƒ½ä¼šï¼Œåªæœ‰æœ‰åºvectorã€‚å› ä¸ºåªæœ‰æœ‰åºå®¹å™¨æ‰èƒ½æ­£ç¡®åœ°ä½¿ç”¨æŸ¥æ‰¾ç®—æ³•â€”â€”<code>binary_search</code>ã€<code>lower_bound</code>ã€<code>equal_range</code>ç­‰ã€‚</p>
<p>Q: ä¸ºä»€ä¹ˆä¸€ä¸ªï¼ˆæœ‰åºçš„ï¼‰vectorçš„äºŒåˆ†æ³•æŸ¥æ‰¾æ¯”ä¸€ä¸ªäºŒå‰æ ‘çš„äºŒåˆ†æ³•æŸ¥æ‰¾æä¾›äº†æ›´å¥½çš„æ€§èƒ½ï¼Ÿ</p>
<p>A: å…¶ä¸­çš„ä¸€ä¸ªæ˜¯<strong>å¤§å°é—®é¢˜</strong>ï¼Œå…¶ä¸­çš„ä¸€ä¸ªæ˜¯<strong>å¼•ç”¨å±€éƒ¨æ€§é—®é¢˜</strong>ã€‚</p>
<p><strong>å¤§å°é—®é¢˜</strong></p>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¹å™¨æ¥å®¹çº³Widgetå¯¹è±¡ï¼Œè€Œä¸”ï¼Œå› ä¸ºæŸ¥æ‰¾é€Ÿåº¦å¯¹æˆ‘ä»¬å¾ˆé‡è¦ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªWidgetçš„å…³è”å®¹å™¨å’Œä¸€ä¸ªæœ‰åº<code>vector&lt;Widget&gt;</code>ã€‚</p>
<p><strong>å…³è”å®¹å™¨æ•°æ®ç»“æ„</strong></p>
<p>å¦‚æœé€‰æ‹©ä¸€ä¸ªå…³è”å®¹å™¨ï¼Œæˆ‘ä»¬å‡ ä¹ç¡®å®šäº†è¦ä½¿ç”¨å¹³è¡¡äºŒå‰æ ‘ã€‚è¿™æ ·çš„æ ‘æ˜¯ç”±æ ‘èŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªéƒ½ä¸ä»…å®¹çº³äº†ä¸€ä¸ªWidgetï¼Œè€Œä¸”ä¿å­˜äº†ä¸€ä¸ªè¯¥èŠ‚ç‚¹åˆ°å·¦å­©å­çš„æŒ‡é’ˆï¼Œä¸€ä¸ªåˆ°å®ƒå³å­©å­çš„æŒ‡é’ˆï¼Œå’Œï¼ˆå…¸å‹çš„ï¼‰ä¸€ä¸ªåˆ°å®ƒçˆ¶èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚</p>
<p>è¿™æ„å‘³ç€<strong>åœ¨å…³è”å®¹å™¨ä¸­ç”¨äºå­˜å‚¨ä¸€ä¸ªWidgetçš„ç©ºé—´å¼€é”€è‡³å°‘ä¼šæ˜¯ä¸‰ä¸ªæŒ‡é’ˆ</strong>ã€‚</p>
<p><strong>vectoræ•°æ®ç»“æ„</strong></p>
<p>ä¸ä¹‹ç›¸å¯¹çš„æ˜¯ï¼Œå½“åœ¨vectorä¸­å­˜å‚¨Widgetå¹¶æ²¡æœ‰å¼€é”€ï¼šç®€å•åœ°å­˜å‚¨ä¸€ä¸ªWidgetã€‚</p>
<p>å½“ç„¶ï¼Œ<strong>vectoræœ¬èº«æœ‰å¼€é”€</strong>ï¼Œåœ¨vectorç»“å°¾ä¹Ÿå¯èƒ½æœ‰ç©ºçš„ï¼ˆä¿ç•™ï¼‰ç©ºé—´ï¼Œä½†æ˜¯æ¯ä¸ªvectorå¼€é”€æ˜¯å¯ä»¥å¿½ç•¥çš„ï¼ˆé€šå¸¸æ˜¯ä¸‰ä¸ªæœºå™¨å­—ï¼Œæ¯”å¦‚ï¼Œä¸‰ä¸ªæŒ‡é’ˆæˆ–ä¸¤ä¸ªæŒ‡é’ˆå’Œä¸€ä¸ªintï¼‰ï¼Œè€Œä¸”å¦‚æœå¿…è¦çš„è¯ï¼Œæœ«å°¾ç©ºçš„ç©ºé—´å¯ä»¥é€šè¿‡â€œäº¤æ¢æŠ€å·§â€å»æ‰ã€‚å³ä½¿è¿™ä¸ªé™„åŠ çš„ç©ºé—´æ²¡æœ‰å»æ‰ï¼Œä¹Ÿå¹¶ä¸å½±å“ä¸‹é¢çš„åˆ†æï¼Œå› ä¸ºå½“æŸ¥æ‰¾æ—¶ä¸ä¼šå¼•ç”¨é‚£æ®µå†…å­˜ã€‚</p>
<p><strong>å†…å­˜å¤§å°</strong></p>
<p>å‡è®¾æˆ‘ä»¬çš„æ•°æ®ç»“æ„è¶³å¤Ÿå¤§ï¼Œå®ƒä»¬å¯ä»¥åˆ†æˆå¤šä¸ªå†…å­˜é¡µé¢ï¼Œä½†æ˜¯vectoræ¯”å…³è”å®¹å™¨éœ€è¦çš„é¡µé¢è¦å°‘ã€‚</p>
<p>å› ä¸ºvectorä¸éœ€è¦æ¯ä¸ªWidgetçš„å¼€é”€ï¼Œè€Œå…³è”å®¹å™¨ç»™æ¯ä¸ªWidgetä¸Šé™„åŠ äº†ä¸‰ä¸ªæŒ‡é’ˆã€‚</p>
<p>å‡è®¾åœ¨ä½ ä½¿ç”¨çš„ç³»ç»Ÿä¸Šä¸€ä¸ªWidgetçš„å¤§å°æ˜¯12ä¸ªå­—èŠ‚ï¼ŒæŒ‡é’ˆæ˜¯4ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå†…å­˜é¡µé¢æ˜¯4096ï¼ˆ4Kï¼‰å­—èŠ‚ã€‚</p>
<p>å¿½ç•¥æ¯ä¸ªå®¹å™¨çš„å¼€é”€ï¼Œå½“ç”¨vectorä¿å­˜æ—¶ï¼Œä½ å¯ä»¥åœ¨ä¸€é¡µé¢ä¸Šæ”¾ç½®341ä¸ªWidget $(4096\div12\approx341)$ï¼Œä½†ä½¿ç”¨å…³è”å®¹å™¨æ—¶ä½ æœ€å¤šåªèƒ½æ”¾170ä¸ª $4096\div(12+4\times3)\approx170)$ã€‚</p>
<p><strong>å› æ­¤å…³è”å®¹å™¨å’Œvectoræ¯”èµ·æ¥ï¼Œä½ å°†ä¼šä½¿ç”¨å¤§çº¦ä¸¤å€çš„å†…å­˜ã€‚</strong></p>
<p>å¦‚æœä½ ä½¿ç”¨çš„ç¯å¢ƒå¯ä»¥ç”¨<strong>è™šæ‹Ÿå†…å­˜</strong>ï¼Œå°±å¾ˆå¯ä»¥å®¹æ˜“åœ°çœ‹å‡ºé‚£ä¼š<strong>é€ æˆå¤§é‡çš„é¡µé¢é”™è¯¯ï¼Œå› æ­¤ä¸€ä¸ªç³»ç»Ÿä¼šå› ä¸ºå¤§æ•°æ®é‡è€Œæ˜æ˜¾æ…¢ä¸‹æ¥</strong>ã€‚</p>
<p><strong>å¼•ç”¨å±€éƒ¨æ€§é—®é¢˜</strong></p>
<p>å‡è®¾åœ¨äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹éƒ½ç¾¤é›†åœ¨ä¸€ä¸ªç›¸å…³çš„å°å†…å­˜é¡µé¢é›†ä¸­ï¼Œå®é™…æƒ…å†µä¸‹å…³è”å®¹å™¨å¾ˆä¹è§‚çš„ã€‚</p>
<p><strong>å¤§éƒ¨åˆ†STLå®ç°ä½¿ç”¨è‡ªå®šä¹‰å†…å­˜ç®¡ç†å™¨æ¥è¾¾åˆ°è¿™æ ·çš„ç¾¤é›†ï¼Œä½†æ˜¯å¦‚æœä½ çš„STLå®ç°æ²¡æœ‰æ”¹è¿›æ ‘èŠ‚ç‚¹ä¸­çš„å¼•ç”¨å±€éƒ¨æ€§ï¼Œè¿™äº›èŠ‚ç‚¹ä¼šåˆ†æ•£åœ¨æ‰€æœ‰ä½ çš„å†…å­˜ç©ºé—´ã€‚é‚£ä¼šå¯¼è‡´æ›´å¤šçš„é¡µé¢é”™è¯¯ã€‚</strong></p>
<p>å³ä½¿ä½¿ç”¨äº†è‡ªå®šä¹‰ç¾¤é›†å†…å­˜ç®¡ç†å™¨ï¼Œå…³è”å®¹å™¨ä¹Ÿä¼šå¯¼è‡´å¾ˆå¤šé¡µé¢é”™è¯¯ï¼Œå› ä¸ºï¼Œä¸åƒè¿ç»­å†…å­˜å®¹å™¨ï¼Œæ¯”å¦‚vectorï¼Œ<strong>åŸºäºèŠ‚ç‚¹çš„å®¹å™¨æ›´éš¾ä¿è¯åœ¨å®¹å™¨çš„éå†é¡ºåºä¸­ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªçš„å…ƒç´ åœ¨ç‰©ç†å†…å­˜ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªã€‚</strong></p>
<p><strong>å½“è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾æ—¶é‚£ç§å†…å­˜ç»„ç»‡æ–¹å¼ï¼ˆè¯‘æ³¨ï¼šéå†é¡ºåºä¸­ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªçš„å…ƒç´ åœ¨ç‰©ç†å†…å­˜ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªï¼‰æ­£å¥½æ˜¯é¡µé¢é”™è¯¯æœ€å°‘çš„ã€‚</strong></p>
<h2 id="vectorçš„ç¼ºç‚¹">vectorçš„ç¼ºç‚¹</h2>
<p><font color=red>æœ‰åºvectorçš„å¤§ç¼ºç‚¹æ˜¯å¿…é¡»ä¿æŒæœ‰åºï¼</font></p>
<p>å› ä¸ºvectorä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½å¿…é¡»æ‹·è´ï¼Œæ‰€ä»¥ï¼š</p>
<ol>
<li>
<p>å½“ä¸€ä¸ªæ–°å…ƒç´ æ’å…¥æ—¶ï¼Œå¤§äºè¿™ä¸ªæ–°å…ƒç´ çš„æ‰€æœ‰ä¸œè¥¿éƒ½å¿…é¡»å‘ä¸Šç§»ä¸€ä½ï¼Œéå¸¸æ˜‚è´µï¼›</p>
</li>
<li>
<p>å¦‚æœvectorå¿…é¡»é‡æ–°åˆ†é…å®ƒçš„å†…åœ¨å†…å­˜ï¼Œåˆ™ä¼šæ›´æ˜‚è´µï¼›</p>
</li>
<li>
<p>å¦‚æœä¸€ä¸ªå…ƒç´ ä»vectorä¸­è¢«åˆ é™¤ï¼Œæ‰€æœ‰å¤§äºå®ƒçš„å…ƒç´ éƒ½è¦å‘ä¸‹ç§»åŠ¨ã€‚</p>
</li>
</ol>
<p>vectorçš„æ’å…¥å’Œåˆ é™¤éƒ½å¾ˆæ˜‚è´µï¼Œä½†æ˜¯å…³è”å®¹å™¨çš„æ’å…¥å’Œåˆ é™¤åˆ™å¾ˆè½»é‡ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåªæœ‰å½“ä½ çŸ¥é“ä½ çš„æ•°æ®ç»“æ„ä½¿ç”¨çš„æ—¶å€™æŸ¥æ‰¾å‡ ä¹ä¸å’Œæ’å…¥å’Œåˆ é™¤æ··åˆæ—¶ï¼Œä½¿ç”¨æœ‰åºvectorä»£æ›¿å…³è”å®¹å™¨æ‰æœ‰æ„ä¹‰ã€‚</p>
<p><strong>æ¦‚è¦</strong></p>
<ol>
<li>
<p>åœ¨æœ‰åºvectorä¸­å­˜å‚¨æ•°æ®å¾ˆæœ‰å¯èƒ½æ¯”åœ¨æ ‡å‡†å…³è”å®¹å™¨ä¸­ä¿å­˜ç›¸åŒçš„æ•°æ®æ¶ˆè€—æ›´å°‘çš„å†…å­˜ï¼›</p>
</li>
<li>
<p>å½“é¡µé¢é”™è¯¯å€¼å¾—é‡è§†çš„æ—¶å€™ï¼Œåœ¨æœ‰åºvectorä¸­é€šè¿‡äºŒåˆ†æ³•æŸ¥æ‰¾å¯èƒ½æ¯”åœ¨ä¸€ä¸ªæ ‡å‡†å…³è”å®¹å™¨ä¸­æŸ¥æ‰¾æ›´å¿«ã€‚</p>
</li>
</ol>
<h2 id="example">Example</h2>
<blockquote>
<p>vectorä»£æ›¿set</p>
</blockquote>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"> <span class="c1">// ä»£æ›¿set&lt;Widget&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="n">vw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹é˜¶æ®µï¼šå¾ˆå¤šæ’å…¥ï¼Œå‡ ä¹æ²¡æœ‰æŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç»“æŸå»ºç«‹é˜¶æ®µã€‚ï¼ˆå½“æ¨¡æ‹Ÿä¸€ä¸ªmultisetæ—¶ï¼Œä½ å¯èƒ½æ›´å–œæ¬¢ç”¨stable_sort æ¥ä»£æ›¿ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">sort</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç”¨äºæŸ¥æ‰¾çš„å€¼çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Widget</span> <span class="n">w</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span><span class="c1">// å¼€å§‹æŸ¥æ‰¾é˜¶æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡binary_searchæŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">binary_search</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">w</span><span class="p">))...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡lower_boundæŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">w</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¡æ¬¾19è§£é‡Šäº†â€œ!(w &lt; *i)â€æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">i</span><span class="p">))...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡equal_rangeæŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pair</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="o">&gt;</span> <span class="n">range</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">                       <span class="n">equal_range</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">w</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">first</span> <span class="o">!=</span> <span class="n">range</span><span class="p">.</span><span class="n">second</span><span class="p">)...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// ç»“æŸæŸ¥æ‰¾é˜¶æ®µï¼Œå¼€å§‹é‡ç»„é˜¶æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¼€å§‹æ–°çš„æŸ¥æ‰¾é˜¶æ®µ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">sort</span><span class="p">(</span><span class="n">vw</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vw</span><span class="p">.</span><span class="n">end</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‡Œé¢æœ€éš¾çš„ä¸œè¥¿å°±æ˜¯<strong>æ€ä¹ˆåœ¨æœç´¢ç®—æ³•ä¸­åšå‡ºé€‰æ‹©</strong>ï¼ˆæ¯”å¦‚ï¼Œ<code>binary_search</code>ã€<code>lower_bound</code>ç­‰ï¼‰</p>
<blockquote>
<p>vectorä»£æ›¿mapæˆ–multimap</p>
</blockquote>
<p>å½“ä½ å†³å®šç”¨vectorä»£æ›¿mapæˆ–multimapæ—¶ï¼Œäº‹æƒ…ä¼šå˜å¾—æ›´æœ‰è¶£ï¼Œå› ä¸º<strong>vectorå¿…é¡»å®¹çº³pairå¯¹è±¡</strong>ã€‚</p>
<p>ä½†æ˜¯è¦æ³¨æ„ï¼Œå¦‚æœä½ å£°æ˜ä¸€ä¸ªmap&lt;K, V&gt;çš„å¯¹è±¡ï¼ˆæˆ–è€…ç­‰ä»·çš„multimapï¼‰ï¼Œä¿å­˜åœ¨mapä¸­çš„å…ƒç´ ç±»å‹æ˜¯<code>pair&lt;const K, V&gt;</code>ã€‚</p>
<p>å¦‚æœè¦ç”¨vectoræ¨¡æ‹Ÿ<code>map</code>æˆ–è€…<code>multimap</code>ï¼Œ<strong>å¿…é¡»å»æ‰const</strong>ï¼Œå› ä¸ºå½“ä½ å¯¹vectoræ’åºæ—¶ï¼Œå…ƒç´ çš„å€¼å°†ä¼šé€šè¿‡èµ‹å€¼ç§»åŠ¨ï¼Œé‚£æ„å‘³ç€pairçš„ä¸¤ä¸ªç»„ä»¶éƒ½å¿…é¡»æ˜¯å¯èµ‹å€¼çš„ã€‚</p>
<p>å½“ä½¿ç”¨vectoræ¥æ¨¡æ‹Ÿmap&lt;K, V&gt;æ—¶ï¼Œ<strong>ä¿å­˜åœ¨vectorä¸­æ•°æ®çš„ç±»å‹å°†æ˜¯<code>pair&lt;K, V&gt;</code></strong>ï¼Œè€Œä¸æ˜¯<code>pair&lt;const K, V&gt;</code>ã€‚</p>
<p>mapå’Œmultimapä»¥é¡ºåºçš„æ–¹å¼ä¿å­˜ä»–ä»¬çš„å…ƒç´ ï¼Œä½†<strong>ç”¨äºæ’åºç›®çš„æ—¶å®ƒä»¬åªä½œç”¨äºå…ƒç´ çš„keyéƒ¨åˆ†</strong>ï¼ˆpairçš„ç¬¬ä¸€ä¸ªç»„ä»¶ï¼‰ï¼Œæ‰€ä»¥å½“æ’åºvectoræ—¶ä½ å¿…é¡»åšä¸€æ ·çš„äº‹æƒ…ã€‚</p>
<p>ä½ éœ€è¦ä¸ºä½ çš„pairå†™ä¸€ä¸ªè‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œå› ä¸º<code>pair</code>çš„<code>operator&lt;</code>ä½œç”¨äºpairçš„ä¸¤ä¸ªç»„ä»¶ã€‚</p>
<p><strong>2ä¸ªæ¯”è¾ƒå‡½æ•°æ¥è¿›è¡ŒæŸ¥æ‰¾</strong></p>
<p>ç”¨æ¥æ’åºçš„æ¯”è¾ƒå‡½æ•°å°†ä½œç”¨äºä¸¤ä¸ªpairå¯¹è±¡ï¼Œä½†æ˜¯æŸ¥æ‰¾åªç”¨åˆ°keyå€¼ã€‚</p>
<p>å¿…é¡»ä¼ ç»™ç”¨äºæŸ¥æ‰¾çš„æ¯”è¾ƒå‡½æ•°ä¸€ä¸ªkeyç±»å‹çš„å¯¹è±¡ï¼ˆè¦æŸ¥æ‰¾çš„å€¼ï¼‰å’Œä¸€ä¸ªpairï¼ˆå­˜å‚¨åœ¨vectorä¸­çš„ä¸€ä¸ªpairï¼‰â€”â€”ä¸¤ä¸ªä¸åŒçš„ç±»å‹ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªé™„åŠ çš„éº»çƒ¦ï¼Œä½ ä¸ä¼šçŸ¥é“keyè¿˜æ˜¯pairæ˜¯ä½œä¸ºç¬¬ä¸€ä¸ªå®å‚ä¼ é€’çš„ï¼Œæ‰€ä»¥ä½ çœŸçš„éœ€è¦ä¸¤ä¸ªç”¨äºæŸ¥æ‰¾çš„æ¯”è¾ƒå‡½æ•°ï¼š<strong>ä¸€ä¸ªkeyå€¼å…ˆä¼ é€’ï¼Œä¸€ä¸ªpairå…ˆä¼ é€’</strong></p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">Data</span><span class="p">;</span> <span class="c1">// åœ¨è¿™ä¸ªä¾‹å­é‡Œ&#34;map&#34;å®¹çº³çš„ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DataCompare</span> <span class="p">{</span> <span class="c1">// ç”¨äºæ¯”è¾ƒçš„ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ç”¨äºæ’åºçš„æ¯”è¾ƒå‡½æ•°keyLessåœ¨ä¸‹é¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Data</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Data</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nf">keyLess</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">rhs</span><span class="p">.</span><span class="n">first</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ç”¨äºæŸ¥æ‰¾çš„æ¯”è¾ƒå‡½æ•°ï¼ˆå½¢å¼1ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Data</span><span class="o">&amp;</span> <span class="n">Ihs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Data</span><span class="o">::</span><span class="n">first_type</span><span class="o">&amp;</span> <span class="n">k</span><span class="p">)</span> <span class="k">const</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">keyLess</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ç”¨äºæŸ¥æ‰¾çš„æ¯”è¾ƒå‡½æ•°ï¼ˆå½¢å¼2ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Data</span><span class="o">::</span><span class="n">first_type</span><span class="o">&amp;</span> <span class="n">k</span><span class="p">,</span>  <span class="k">const</span> <span class="n">Data</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">keyLessfk</span><span class="p">,</span> <span class="n">rhs</span><span class="p">.</span><span class="n">first</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// â€œçœŸçš„â€æ¯”è¾ƒå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">bool</span> <span class="n">keyLess</span><span class="p">(</span><span class="k">const</span> <span class="n">Data</span><span class="o">::</span><span class="n">first_type</span><span class="o">&amp;</span> <span class="n">k1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Data</span><span class="o">::</span><span class="n">first_type</span><span class="o">&amp;</span> <span class="n">k2</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">k1</span> <span class="o">&lt;</span> <span class="n">k2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å‡è®¾æœ‰åºvectorå°†æ¨¡æ‹Ÿ<code>map&lt;string, int&gt;</code>ã€‚</p>
<p>è¿™æ®µä»£ç å‡ ä¹æ˜¯ä¸Šé¢è®¨è®ºçš„å­—é¢è½¬æ¢ï¼Œé™¤äº†å­˜åœ¨æˆå‘˜å‡½æ•°<code>keyLess</code>ã€‚</p>
<p>é‚£ä¸ªå‡½æ•°çš„å­˜åœ¨æ˜¯ç”¨æ¥<strong>ä¿è¯å‡ ä¸ªä¸åŒçš„<code>operator()</code>å‡½æ•°ä¹‹é—´çš„ä¸€è‡´æ€§</strong>ã€‚</p>
<p>æ¯ä¸ªè¿™æ ·çš„å‡½æ•°åªæ˜¯ç®€å•åœ°æ¯”è¾ƒä¸¤ä¸ªkeyçš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ªæµ‹è¯•æ”¾åœ¨keyLessä¸­å¹¶è®©operator()å‡½æ•°è¿”å›keyLessæ‰€åšçš„äº‹æƒ…ï¼Œè¿™æ¯”å¤åˆ¶é‚£ä¸ªé€»è¾‘è¦å¥½ã€‚</p>
<p>è¿™ä¸ªè½¯ä»¶å·¥ç¨‹ä¸­ç»å¦™çš„åŠ¨ä½œå¢å¼ºäº†<code>DataCompare</code>çš„å¯ç»´æŠ¤æ€§ï¼Œä½†<strong>æœ‰ä¸€ä¸ªå°ç¼ºç‚¹ï¼Œå®ƒæä¾›äº†æœ‰ä¸åŒå‚æ•°ç±»å‹çš„operator()å‡½æ•°ï¼Œè¿™å°†å¯¼è‡´å‡½æ•°å¯¹è±¡æ— æ³•é€‚é…ã€‚</strong></p>
<p>æŠŠæœ‰åºvectorç”¨ä½œmapæœ¬è´¨ä¸Šå’Œç”¨ä½œsetä¸€æ ·ã€‚</p>
<p><strong>å”¯ä¸€å¤§çš„åŒºåˆ«æ˜¯å¿…é¡»æŠŠDataCompareå¯¹è±¡ç”¨ä½œæ¯”è¾ƒå‡½æ•°:</strong></p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// ä»£æ›¿map&lt;string, int&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;</span> <span class="n">vd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="c1">// å»ºç«‹é˜¶æ®µï¼šå¾ˆå¤šæ’å…¥ï¼Œå‡ ä¹æ²¡æœ‰æŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç»“æŸå»ºç«‹é˜¶æ®µã€‚ï¼ˆå½“æ¨¡æ‹Ÿmultimapæ—¶ï¼Œä½ å¯èƒ½æ›´å–œæ¬¢ç”¨stable_sortæ¥ä»£æ›¿ï¼‰ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">sort</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">DataCompare</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç”¨äºæŸ¥æ‰¾çš„å€¼çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// å¼€å§‹æŸ¥æ‰¾é˜¶æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡binary_searchæŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">binary_search</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">s</span><span class="p">,</span> <span class="n">DataCompare</span><span class="p">()))...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å†æ¬¡é€šè¿‡lower_boundæŸ¥æ‰¾ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">s</span><span class="p">,</span> <span class="n">DataCompare</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¡æ¬¾45è§£é‡Šäº†â€œ!DataCompare()(s, *i)â€æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">DataCompare</span><span class="p">()(</span><span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">))...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡equal_rangeæŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pair</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="o">&gt;</span> <span class="n">range</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="n">equal_range</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">s</span><span class="p">,</span> <span class="n">DataCompare</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">first</span> <span class="o">!=</span> <span class="n">range</span><span class="p">.</span><span class="n">second</span><span class="p">)...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span> <span class="c1">// ç»“æŸæŸ¥æ‰¾é˜¶æ®µï¼Œå¼€å§‹é‡ç»„é˜¶æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¼€å§‹æ–°çš„æŸ¥æ‰¾é˜¶æ®µ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">sort</span><span class="p">(</span><span class="n">vd</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vd</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">DataCompare</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£å¦‚ä½ æ‰€è§ï¼Œä¸€æ—¦ä½ å†™äº†DataCompareï¼Œä¸œè¥¿éƒ½å¾ˆå¥½åœ°ä¾åºæ’åˆ—äº†ã€‚</p>
<p>è€Œä¸€æ—¦ä½ç½®åˆé€‚äº†ï¼Œå®ƒä»¬å¾€å¾€æ¯”ç›¸åº”çš„ä½¿ç”¨çœŸçš„mapçš„è®¾è®¡è¿è¡Œå¾—æ›´å¿«è€Œä¸”ä½¿ç”¨æ›´å°‘å†…å­˜ã€‚</p>
<p>å¦‚æœä½ çš„ç¨‹åºä¸æ˜¯æŒ‰ç…§é˜¶æ®µçš„æ–¹å¼æ“ä½œæ•°æ®ç»“æ„ï¼Œé‚£ä¹ˆä½¿ç”¨æœ‰åºvectorä»£æ›¿æ ‡å‡†å…³è”å®¹å™¨å‡ ä¹å¯ä»¥ç¡®å®šæ˜¯åœ¨æµªè´¹æ—¶é—´ã€‚</p>
]]></description></item><item><title>Effective STL [22] | é¿å…åŸåœ°ä¿®æ”¹setå’Œmultisetçš„é”®</title><link>https://jianye0428.github.io/posts/clause_22/</link><pubDate>Mon, 14 Aug 2023 08:13:21 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_22/</guid><description><![CDATA[<p><strong>æ‰€æœ‰æ ‡å‡†å…³è”å®¹å™¨ï¼Œsetå’Œmultisetä¿æŒå®ƒä»¬çš„å…ƒç´ æœ‰åºï¼Œè¿™äº›å®¹å™¨çš„æ­£ç¡®è¡Œä¸ºä¾èµ–äºå®ƒä»¬ä¿æŒæœ‰åºã€‚</strong></p>
<p>å¦‚æœä½ æ”¹äº†å…³è”å®¹å™¨é‡Œçš„ä¸€ä¸ªå…ƒç´ çš„å€¼ï¼ˆä¾‹å¦‚ï¼ŒæŠŠ10å˜ä¸º1000ï¼‰ï¼Œæ–°å€¼å¯èƒ½ä¸åœ¨æ­£ç¡®çš„ä½ç½®ï¼Œè€Œä¸”é‚£å°†ç ´åå®¹å™¨çš„æœ‰åºæ€§ã€‚</p>
<h2 id="ä¿®æ”¹mapå’Œmultimapå€¼">ä¿®æ”¹mapå’Œmultimapå€¼</h2>
<p>è¯•å›¾æ”¹å˜è¿™äº›å®¹å™¨é‡Œçš„ä¸€ä¸ªé”®å€¼çš„ç¨‹åºå°†ä¸èƒ½ç¼–è¯‘:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span> <span class="n">m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// é”™è¯¯ï¼mapé”®ä¸èƒ½æ”¹å˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">multimap</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span> <span class="n">mm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">mm</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="c1">// é”™è¯¯ï¼multimapé”®ä¹Ÿä¸èƒ½æ”¹å˜
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition tip open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-lightbulb fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">å› ä¸º<code>map&lt;K, V&gt;</code>æˆ–<code>multimap&lt;K, V&gt;</code>ç±»å‹çš„å¯¹è±¡ä¸­å…ƒç´ çš„ç±»å‹æ˜¯<code>pair&lt;const K, V&gt;</code>ã€‚å› ä¸ºé”®çš„ç±»å‹const Kï¼Œå®ƒä¸èƒ½æ”¹å˜ã€‚</div>
    </div>
  </div>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">_Key</span><span class="p">,</span> <span class="k">typename</span> <span class="n">_Tp</span><span class="p">,</span> <span class="k">typename</span> <span class="n">_Compare</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">less</span><span class="o">&lt;</span><span class="n">_Key</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">typename</span> <span class="n">_Alloc</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">_Tp</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">map</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Key</span>     <span class="n">key_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Tp</span>     <span class="n">mapped_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">_Tp</span><span class="o">&gt;</span>  <span class="n">value_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Compare</span>     <span class="n">key_compare</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Alloc</span>     <span class="n">allocator_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä½ ä½¿ç”¨ä¸€ä¸ª<code>const_cast</code>ï¼Œæˆ–è®¸èƒ½æ”¹å˜å®ƒï¼Œåé¢ä¼šè®¨è®ºåˆ°ã€‚</p>
<h2 id="ä¿®æ”¹setå’Œmultisetå€¼">ä¿®æ”¹setå’Œmultisetå€¼</h2>
<p>å¯¹äº<code>set&lt;T&gt;</code>æˆ–<code>multiset&lt;T&gt;</code>ç±»å‹çš„å¯¹è±¡æ¥è¯´ï¼Œå‚¨å­˜åœ¨å®¹å™¨é‡Œçš„å…ƒç´ ç±»å‹åªä¸è¿‡æ˜¯<code>T</code>ï¼Œå¹¶é<code>const T</code>ã€‚å› æ­¤ï¼Œ<code>set</code>æˆ–<code>multiset</code>é‡Œçš„å…ƒç´ å¯èƒ½åœ¨ä½ æƒ³è¦çš„ä»»ä½•æ—¶å€™æ”¹å˜ã€‚ä¸éœ€è¦æ˜ å°„ã€‚</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">_Key</span><span class="p">,</span> <span class="k">typename</span> <span class="n">_Compare</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">less</span><span class="o">&lt;</span><span class="n">_Key</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="k">typename</span> <span class="n">_Alloc</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="n">_Key</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">set</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// typedefs:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">///@{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">/// Public typedefs.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">typedef</span> <span class="n">_Key</span>     <span class="n">key_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Key</span>     <span class="n">value_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Compare</span> <span class="n">key_compare</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Compare</span> <span class="n">value_compare</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="n">_Alloc</span>   <span class="n">allocator_type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">///@}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä¸ºä»€ä¹ˆsetæˆ–multiseté‡Œçš„å…ƒç´ ä¸æ˜¯å¸¸æ•°ï¼Ÿ</strong></p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé›‡å‘˜çš„ç±»:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Employee</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>       <span class="c1">// è·å–é›‡å‘˜å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="nf">setName</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">);</span> <span class="c1">// è®¾ç½®é›‡å‘˜å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">getTitle</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>   <span class="c1">// è·å–é›‡å‘˜å¤´è¡”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="nf">setTitle</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">title</span><span class="p">);</span>     <span class="c1">// è®¾ç½®é›‡å‘˜å¤´è¡”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="nf">idNumber</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>             <span class="c1">// è·å–é›‡å‘˜IDå·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è®©æˆ‘ä»¬åšåˆç†çš„å‡è®¾ï¼Œæ¯ä¸ªé›‡å‘˜æœ‰å”¯ä¸€çš„IDå·ï¼Œå°±æ˜¯<code>idNumber</code>å‡½æ•°è¿”å›çš„æ•°å­—ã€‚ç„¶åï¼Œå»ºç«‹ä¸€ä¸ªé›‡å‘˜çš„<code>set</code>ï¼Œå¾ˆæ˜¾ç„¶åº”è¯¥åªä»¥<code>ID</code>å·æ¥æ’åº<code>set</code>:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">IDNumberLess</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="n">Employee</span><span class="p">,</span> <span class="n">Employee</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span> <span class="c1">// å‚è§æ¡æ¬¾40
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Employees</span> <span class="n">lhs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">Employee</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">idNumber</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">idNumber</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">set</span><span class="o">&lt;</span><span class="n">Employee</span><span class="p">,</span> <span class="n">IDNumberLess</span><span class="o">&gt;</span> <span class="n">EmpIDSet</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">EmpIDSet</span> <span class="n">se</span><span class="p">;</span> <span class="c1">// seæ˜¯é›‡å‘˜çš„setï¼Œ æŒ‰ç…§IDå·æ’åº
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®é™…ä¸Šï¼Œé›‡å‘˜çš„<code>ID</code>å·æ˜¯<code>set</code>ä¸­å…ƒç´ çš„é”®ã€‚<strong>å…¶ä½™çš„é›‡å‘˜æ•°æ®åªæ˜¯è™šæœ‰å…¶è¡¨</strong>ã€‚åœ¨è¿™é‡Œï¼Œæ²¡æœ‰ç†ç”±ä¸èƒ½æŠŠä¸€ä¸ªç‰¹å®šé›‡å‘˜çš„å¤´è¡”æ”¹æˆæŸä¸ªæœ‰è¶£çš„ä¸œè¥¿:</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">Employee</span> <span class="n">selectedID</span><span class="p">;</span> <span class="c1">// å®¹çº³è¢«é€‰æ‹©çš„é›‡å‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span> <span class="c1">// IDå·çš„å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">EmpIDSet</span><span class="o">::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">selectedID</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span><span class="o">-&gt;</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// ç»™é›‡å‘˜æ–°å¤´è¡”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºåœ¨è¿™é‡Œæˆ‘ä»¬åªæ˜¯æ”¹å˜é›‡å‘˜çš„ä¸€ä¸ªä¸setæ’åºçš„æ–¹å¼æ— å…³çš„æ–¹é¢ï¼ˆä¸€ä¸ªé›‡å‘˜çš„éé”®éƒ¨åˆ†ï¼‰ï¼Œæ‰€ä»¥è¿™æ®µä»£ç ä¸ä¼šç ´åsetã€‚é‚£æ˜¯å®ƒåˆæ³•çš„åŸå› ã€‚ä½†å®ƒçš„åˆæ³•æ’é™¤äº†<code>set/multiset</code>çš„å…ƒç´ æ˜¯<code>const</code>çš„å¯èƒ½ã€‚è€Œä¸”é‚£æ˜¯å®ƒä»¬ä¸ºä»€ä¹ˆä¸æ˜¯çš„åŸå› ã€‚</p>
<p>å› ä¸º<code>set</code>æˆ–<code>multiset</code>é‡Œçš„å€¼ä¸æ˜¯<code>const</code>ï¼Œæ‰€ä»¥è¯•å›¾æ”¹å˜å®ƒä»¬å¯ä»¥ç¼–è¯‘ã€‚</p>
<p><font color=red>å¦‚æœä½ æ”¹å˜<code>set</code>æˆ–<code>multiset</code>é‡Œçš„å…ƒç´ ï¼Œ ä½ å¿…é¡»<strong>ç¡®ä¿ä¸æ”¹å˜ä¸€ä¸ªé”®éƒ¨åˆ†â€”â€”å½±å“å®¹å™¨æœ‰åºæ€§çš„å…ƒç´ éƒ¨åˆ†</strong>ã€‚å¦‚æœä½ åšäº†ï¼Œä½ ä¼šç ´åå®¹å™¨ï¼Œå†ä½¿ç”¨é‚£ä¸ªå®¹å™¨å°†äº§ç”Ÿæœªå®šä¹‰çš„ç»“æœï¼Œ è€Œä¸”é‚£æ˜¯ä½ çš„é”™è¯¯ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™ä¸ªé™åˆ¶åªåº”ç”¨äºè¢«åŒ…å«å¯¹è±¡çš„é”®éƒ¨åˆ†ã€‚å¯¹è¢«åŒ…å«å…ƒç´ çš„æ‰€æœ‰å…¶ä»–éƒ¨åˆ†æ¥è¯´ï¼Œæ˜¯å¼€æ”¾çš„: éšä¾¿æ”¹å˜ï¼</font></p>
<h2 id="é˜»æ­¢ä¿®æ”¹setå’Œmultisetå€¼">é˜»æ­¢ä¿®æ”¹setå’Œmultisetå€¼</h2>
<p>å³ä½¿<code>set</code>å’Œ<code>multiset</code>çš„å…ƒç´ ä¸æ˜¯<code>const</code>ï¼Œå®ç°ä»ç„¶æœ‰å¾ˆå¤šæ–¹å¼å¯ä»¥é˜»æ­¢å®ƒä»¬è¢«ä¿®æ”¹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå®ç°å¯ä»¥è®©ç”¨äº<code>set&lt;T&gt;::iteratorçš„operator*</code>è¿”å›ä¸€ä¸ªå¸¸æ•°<code>T&amp;</code>ã€‚å³ï¼Œå®ƒå¯ä»¥è®©<code>set</code>çš„è¿­ä»£å™¨è§£å¼•ç”¨çš„ç»“æœæ˜¯<code>set</code>å…ƒç´ çš„å¸¸é‡å¼•ç”¨ã€‚</p>
<p>åœ¨è¿™æ ·çš„å®ç°ä¸‹ï¼Œå°†æ²¡æœ‰åŠæ³•ä¿®æ”¹<code>set</code>æˆ–<code>multiset</code>çš„å…ƒç´ ï¼Œå› ä¸ºæ‰€æœ‰è®¿é—®é‚£äº›å…ƒç´ çš„æ–¹æ³•éƒ½å°†åœ¨è®©ä½ è®¿é—®ä¹‹å‰åŠ ä¸€ä¸ª<code>const</code>ã€‚</p>
<h2 id="è¦ä¸è¦ä¿®æ”¹setå’Œmultisetå€¼">è¦ä¸è¦ä¿®æ”¹setå’Œmultisetå€¼</h2>
<ol>
<li>å¦‚æœ<strong>ä¸å…³å¿ƒç§»æ¤æ€§</strong>ï¼Œä½ æƒ³è¦æ”¹å˜setæˆ–multisetä¸­å…ƒç´ çš„å€¼ï¼Œè€Œä¸”ä½ çš„STLå®ç°è®©ä½ ä¾¥å¹¸æˆåŠŸï¼Œç»§ç»­åšã€‚åªæ˜¯è¦ç¡®å®šä¸è¦æ”¹å˜å…ƒç´ çš„é”®éƒ¨åˆ†ï¼Œå³ï¼Œä¼šå½±å“å®¹å™¨æœ‰åºæ€§çš„å…ƒç´ éƒ¨åˆ†ã€‚</li>
<li>å¦‚æœ<strong>åœ¨ä¹ç§»æ¤æ€§</strong>ï¼Œå°±è®¤ä¸ºsetå’Œmultisetä¸­çš„å…ƒç´ ä¸èƒ½è¢«ä¿®æ”¹ï¼Œè‡³å°‘ä¸èƒ½åœ¨æ²¡æœ‰æ˜ å°„çš„æƒ…å†µä¸‹</li>
</ol>
<p><strong>Solution: æ˜ å°„åˆ°ä¸€ä¸ªå¼•ç”¨</strong></p>
<p>æœ‰æ—¶å€™å®Œå…¨æœ‰ç†ç”±æ”¹å˜<code>set</code>æˆ–<code>multiset</code>å…ƒç´ çš„éé”®éƒ¨åˆ†ã€‚ä¾‹å¦‚åˆšçœ‹çš„ä¸èƒ½åœ¨ä¸€äº›å®ç°ä¸‹ç¼–è¯‘çš„<code>setTitle</code>è°ƒç”¨:</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">EmpIDSet</span><span class="o">::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">selectedID</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span><span class="o">-&gt;</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// æœ‰äº›STLå®ç°ä¼šæ‹’ç»è¿™æ ·ï¼Œå› ä¸º*iæ˜¯const
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºäº†è®©å®ƒå¯ä»¥ç¼–è¯‘å¹¶ä¸”è¡Œä¸ºæ­£ç¡®ï¼Œæˆ‘ä»¬å¿…é¡»æ˜ å°„æ‰*içš„å¸¸é‡æ€§ã€‚è¿™æ˜¯é‚£ä¹ˆåšçš„æ­£ç¡®æ–¹æ³•:</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">const_cast</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">).</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// æ˜ å°„æ‰*içš„å¸¸é‡æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è¿™å¯ä»¥å¾—åˆ°iæŒ‡å‘çš„å¯¹è±¡ï¼Œå‘Šè¯‰ä½ çš„ç¼–è¯‘å™¨æŠŠæ˜ å°„çš„ç»“æœå½“ä½œä¸€ä¸ªï¼ˆéå¸¸æ•°ï¼‰Employeeçš„å¼•ç”¨ï¼Œç„¶ååœ¨é‚£ä¸ªå¼•ç”¨ä¸Šè°ƒç”¨setTitleã€‚</strong></p>
<p><strong>é”™è¯¯ç‰ˆæœ¬çš„æ˜ å°„</strong></p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span>
</span></span><span class="line"><span class="cl">  <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">).</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// æŠŠ*iæ˜ å°„åˆ°ä¸€ä¸ªEmployee
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒä¹Ÿç­‰ä»·äºå¦‚ä¸‹å†…å®¹:</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">((</span><span class="n">Employee</span><span class="p">)(</span><span class="o">*</span><span class="n">i</span><span class="p">)).</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// ä½¿ç”¨Cæ˜ å°„è¯­æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤ä¸ªéƒ½èƒ½ç¼–è¯‘ï¼Œè€Œä¸”å› ä¸ºå®ƒä»¬ç­‰ä»·ï¼Œæ‰€ä»¥å®ƒä»¬é”™çš„åŸå› ä¹Ÿç›¸åŒã€‚</p>
<p><strong>åœ¨è¿è¡ŒæœŸï¼Œå®ƒä»¬ä¸èƒ½ä¿®æ”¹<code>*i</code>ï¼</strong></p>
<p><strong>åœ¨è¿™ä¸¤ä¸ªæƒ…å†µé‡Œï¼Œæ˜ å°„çš„ç»“æœæ˜¯ä¸€ä¸ª<code>*i</code>å‰¯æœ¬çš„ä¸´æ—¶åŒ¿åå¯¹è±¡ï¼Œè€ŒsetTitleæ˜¯åœ¨åŒ¿åçš„ç‰©ä½“ä¸Šè°ƒç”¨ï¼Œä¸åœ¨<code>*i</code>ä¸Š<code>ï¼*i</code>æ²¡è¢«ä¿®æ”¹ï¼Œå› ä¸ºsetTitleä»æœªåœ¨é‚£ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ï¼Œå®ƒåœ¨é‚£ä¸ªå¯¹è±¡çš„å‰¯æœ¬ä¸Šè°ƒç”¨ã€‚</strong></p>
<p>ä¸¤ä¸ªå¥æ³•å½¢å¼ç­‰ä»·äºè¿™ä¸ª:</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span>
</span></span><span class="line"><span class="cl">  <span class="n">Employee</span> <span class="nf">tempCopy</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">);</span> <span class="c1">// æŠŠ*iæ‹·è´åˆ°tempCopy
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">tempCopy</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// ä¿®æ”¹tempCopy
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡æ˜ å°„åˆ°å¼•ç”¨ï¼Œæˆ‘ä»¬é¿å…äº†å»ºç«‹ä¸€ä¸ªæ–°å¯¹è±¡ã€‚</p>
<p>å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œæ˜ å°„çš„ç»“æœæ˜¯ä¸€ä¸ªç°æœ‰å¯¹è±¡çš„å¼•ç”¨ï¼Œ<code>i</code>æŒ‡å‘çš„å¯¹è±¡ã€‚</p>
<p>å½“æˆ‘ä»¬åœ¨æœ‰è¿™ä¸ªå¼•ç”¨æŒ‡å®šçš„å¯¹è±¡ä¸Šè°ƒç”¨setTitleæ—¶ï¼Œæˆ‘ä»¬æ˜¯åœ¨<code>*i</code>ä¸Šè°ƒç”¨setTitleï¼Œè€Œä¸”é‚£æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¸èƒ½å»æ‰mapå’Œmultimapçš„å¸¸é‡æ€§</strong></p>
<p>æ³¨æ„<code>map&lt;K, V&gt;</code>æˆ–<code>multimap&lt;K, V&gt;</code>åŒ…å«<code>pair&lt;const K, V&gt;</code>ç±»å‹çš„å…ƒç´ ã€‚</p>
<p>é‚£ä¸ª<code>const</code>è¡¨æ˜<code>pair</code>çš„ç¬¬ä¸€ä¸ªç»„ä»¶è¢«å®šä¹‰ä¸ºå¸¸é‡ï¼Œè€Œé‚£æ„å‘³ç€è¯•å›¾ä¿®æ”¹å®ƒæ˜¯æœªå®šä¹‰çš„è¡Œä¸ºï¼ˆå³ä½¿æ˜ å°„æ‰å®ƒçš„å¸¸é‡æ€§ï¼‰ã€‚</p>
<p>ç†è®ºä¸Šï¼Œä¸€ä¸ªSTLå®ç°å¯èƒ½æŠŠè¿™æ ·çš„å€¼å†™åˆ°ä¸€ä¸ªåªè¯»çš„å†…å­˜ä½ç½®ï¼ˆæ¯”å¦‚ï¼Œä¸€æ—¦å†™äº†å°±é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›è¡Œå†™ä¿æŠ¤çš„è™šæ‹Ÿå†…å­˜é¡µï¼‰ï¼Œè€Œä¸”è¯•å›¾æ˜ å°„æ‰å®ƒçš„å¸¸é‡æ€§ï¼Œæœ€å¤šï¼Œæ²¡æœ‰æ•ˆæœã€‚</p>
<p>å¦‚æœä½ æ˜¯ä¸€ä¸ªåšæŒéµå¾ªæ ‡å‡†æ‹Ÿå®šçš„è§„åˆ™çš„äººï¼Œä½ ç»ä¸ä¼šè¯•å›¾æ˜ å°„æ‰<code>map</code>æˆ–<code>multimap</code>é”®çš„å¸¸é‡æ€§ã€‚</p>
<h2 id="å®‰å…¨ä¿®æ”¹å…ƒç´ æ­¥éª¤">å®‰å…¨ä¿®æ”¹å…ƒç´ æ­¥éª¤</h2>
<p>æƒ³è¦æ€»æ˜¯å¯ä»¥å·¥ä½œè€Œä¸”æ€»æ˜¯å®‰å…¨åœ°æ”¹å˜setã€multisetã€mapæˆ–multimapé‡Œçš„å…ƒç´ ï¼ŒæŒ‰5ä¸ªç®€å•çš„æ­¥éª¤å»åšï¼š</p>
<ol>
<li>å®šä½ä½ æƒ³è¦æ”¹å˜çš„å®¹å™¨å…ƒç´ ã€‚å¦‚æœä½ ä¸ç¡®å®šæœ€å¥½çš„æ–¹æ³•ï¼Œ æ¡æ¬¾45æä¾›äº†å…³äºæ€æ ·è¿›è¡Œé€‚å½“æœå¯»çš„æŒ‡å¯¼ã€‚</li>
<li>æ‹·è´ä¸€ä»½è¦è¢«ä¿®æ”¹çš„å…ƒç´ ã€‚å¯¹mapæˆ–multimapè€Œè¨€ï¼Œç¡®å®šä¸è¦æŠŠå‰¯æœ¬çš„ç¬¬ä¸€ä¸ªå…ƒç´ å£°æ˜ä¸ºconstã€‚æ¯•ç«Ÿï¼Œä½ æƒ³è¦æ”¹å˜å®ƒï¼</li>
<li>ä¿®æ”¹å‰¯æœ¬ï¼Œä½¿å®ƒæœ‰ä½ æƒ³è¦åœ¨å®¹å™¨é‡Œçš„å€¼ã€‚</li>
<li>ä»å®¹å™¨é‡Œåˆ é™¤å…ƒç´ ï¼Œé€šå¸¸é€šè¿‡è°ƒç”¨eraseï¼ˆå‚è§æ¡æ¬¾9ï¼‰ã€‚</li>
<li>æŠŠæ–°å€¼æ’å…¥å®¹å™¨ã€‚å¦‚æœæ–°å…ƒç´ åœ¨å®¹å™¨çš„æ’åºé¡ºåºä¸­çš„ä½ç½®æ­£å¥½ç›¸åŒæˆ–ç›¸é‚»äºåˆ é™¤çš„å…ƒç´ ï¼Œä½¿ç”¨insertçš„â€œæç¤ºâ€å½¢å¼æŠŠæ’å…¥çš„æ•ˆç‡ä»å¯¹æ•°æ—¶é—´æ”¹è¿›åˆ°åˆ†æ‘Šçš„å¸¸æ•°æ—¶é—´ã€‚ä½¿ç”¨ä½ ä»ç¬¬ä¸€æ­¥è·å¾—çš„è¿­ä»£å™¨ä½œä¸ºæç¤ºã€‚</li>
</ol>
<p><strong>ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼šå…ˆåˆ é™¤ï¼Œå†æ’å…¥æ–°çš„ã€‚</strong></p>
<p><strong>Example:</strong></p>
<p>è¿™æ˜¯åŒä¸€ä¸ªç´¯äººçš„é›‡å‘˜ä¾‹å­ï¼Œè¿™æ¬¡ä»¥å®‰å…¨ã€å¯ç§»æ¤çš„æ–¹å¼å†™:</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">EmpIDSet</span> <span class="n">se</span><span class="p">;</span> <span class="c1">// åŒå‰ï¼Œseæ˜¯ä¸€ä¸ªä»¥IDå·æ’åºçš„é›‡å‘˜set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Employee</span> <span class="n">selectedID</span><span class="p">;</span> <span class="c1">// åŒå‰ï¼ŒselectedIDæ˜¯ä¸€ä¸ªå¸¦æœ‰éœ€è¦IDå·çš„é›‡å‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">EmpIDSet</span><span class="o">::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">selectedID</span><span class="p">);</span> <span class="c1">// ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ°è¦æ”¹å˜çš„å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">!=</span><span class="n">se</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Employee</span> <span class="nf">e</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">);</span> <span class="c1">// ç¬¬äºŒæ­¥ï¼šæ‹·è´è¿™ä¸ªå…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">se</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">i</span><span class="o">++</span><span class="p">);</span>  <span class="c1">// ç¬¬ä¸‰æ­¥ï¼šåˆ é™¤è¿™ä¸ªå…ƒç´ ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="c1">// è‡ªå¢è¿™ä¸ªè¿­ä»£å™¨ä»¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="c1">// ä¿æŒå®ƒæœ‰æ•ˆï¼ˆå‚è§æ¡æ¬¾9ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">e</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Corporate Deity&#34;</span><span class="p">);</span> <span class="c1">// ç¬¬å››æ­¥ï¼šä¿®æ”¹è¿™ä¸ªå‰¯æœ¬
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">se</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>               <span class="c1">// ç¬¬äº”æ­¥ï¼šæ’å…¥æ–°å€¼ï¼›æç¤ºå®ƒçš„ä½ç½®å’ŒåŸå…ˆå…ƒç´ çš„ä¸€æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>Effective STL [21] | æ°¸è¿œè®©æ¯”è¾ƒå‡½æ•°å¯¹ç›¸ç­‰çš„å€¼è¿”å›false</title><link>https://jianye0428.github.io/posts/clause_21/</link><pubDate>Fri, 11 Aug 2023 17:11:35 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_21/</guid><description><![CDATA[<h2 id="example-set">Example set</h2>
<p>å»ºç«‹ä¸€ä¸ªsetï¼Œæ¯”è¾ƒç±»å‹ç”¨<code>less_equal</code>ï¼Œç„¶åæ’å…¥æ•´å‹æ•°å­—33(ç§°ä¸º $33_{A}$):</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">less_equal</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">s</span><span class="p">;</span> <span class="c1">// sä»¥â€œ&lt;=â€æ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">s</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">33</span><span class="p">);</span> <span class="c1">// æ’å…¥33
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨å°è¯•å†æ’å…¥ä¸€æ¬¡33(ç§°ä¸º $33_{B}$):</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">s</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">33</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºè¿™ä¸ªinsertçš„è°ƒç”¨ï¼Œsetå¿…é¡»å…ˆè¦åˆ¤æ–­å‡º $33_{A}$ æ˜¯å¦å·²ç»ä½äºå…¶ä¸­äº†ï¼ŒæŸ¥æ‰¾å“ªå„¿é€‚åˆæ’å…¥ $33_{B}$ã€‚æœ€ç»ˆï¼Œå®ƒæ€»è¦æ£€æŸ¥ $33_{B}$æ˜¯å¦ä¸ $33_{A}$ ç›¸åŒã€‚</p>
<p>å…³è”å®¹å™¨å¯¹â€œç›¸åŒâ€çš„å®šä¹‰æ˜¯ç­‰ä»·ï¼Œå› æ­¤setæµ‹è¯• $33_{B}$æ˜¯å¦ç­‰ä»·äº $33_{A}$ã€‚</p>
<p>å½“æ‰§è¡Œè¿™ä¸ªæµ‹è¯•æ—¶ï¼Œå®ƒè‡ªç„¶æ˜¯ä½¿ç”¨setçš„æ¯”è¾ƒå‡½æ•°ã€‚åœ¨è¿™ä¸€ä¾‹å­é‡Œï¼Œæ˜¯<code>operator&lt;=</code>ï¼Œå› ä¸ºæˆ‘ä»¬æŒ‡å®š<code>set</code>çš„æ¯”è¾ƒå‡½æ•°ä¸º<code>less_equal</code>ï¼Œè€Œ<code>less_equal</code>æ„æ€å°±æ˜¯<code>operator&lt;=</code>ã€‚</p>
<p>å¯ä»¥çœ‹çœ‹<code>less_equal</code>çš„æºç å®ç°ï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">/// One of the @link comparison_functors comparison functors@endlink.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">_Tp</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">less_equal</span> <span class="o">:</span> <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="n">_Tp</span><span class="p">,</span> <span class="n">_Tp</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">_GLIBCXX14_CONSTEXPR</span>
</span></span><span class="line"><span class="cl">  <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">  <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">_Tp</span><span class="o">&amp;</span> <span class="n">__x</span><span class="p">,</span> <span class="k">const</span> <span class="n">_Tp</span><span class="o">&amp;</span> <span class="n">__y</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="k">return</span> <span class="n">__x</span> <span class="o">&lt;=</span> <span class="n">__y</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// æ­¤å¤„æ˜¯ &lt;=
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>äºæ˜¯ï¼Œsetå°†è®¡ç®—è¿™ä¸ªè¡¨è¾¾å¼æ˜¯å¦ä¸ºçœŸ:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="o">!</span><span class="p">(</span><span class="mi">33</span><span class="n">A</span> <span class="o">&lt;=</span> <span class="mi">33</span><span class="n">B</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="mi">33</span><span class="n">B</span> <span class="o">&lt;=</span> <span class="mi">33</span><span class="n">A</span><span class="p">)</span> <span class="c1">// æµ‹è¯•33Aå’Œ33Bæ˜¯å¦ç­‰ä»·
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>$33_{A}$ å’Œ $33_{B}$ éƒ½æ˜¯33ï¼Œå› æ­¤ï¼Œ $33_{A}$&lt;=$33_{B}$ è‚¯å®šä¸ºçœŸã€‚åŒæ ·æ¸…æ¥šçš„æ˜¯ï¼Œ$33_{B}$ &lt;= $33_{A}$ã€‚äºæ˜¯ä¸Šè¿°çš„è¡¨è¾¾å¼ç®€åŒ–ä¸º:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="o">!</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å†ç®€åŒ–å°±æ˜¯</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="nb">false</span> <span class="o">&amp;&amp;</span> <span class="nb">false</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœå½“ç„¶æ˜¯falseã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œsetå¾—å‡ºçš„ç»“è®ºæ˜¯ $33_{B}$ ä¸ $33_{B}$ ä¸ç­‰ä»·ï¼Œå› æ­¤ä¸ä¸€æ ·ï¼Œäºæ˜¯å®ƒå°† $33_{B}$ æ’å…¥å®¹å™¨ä¸­çš„æ—è¾¹ã€‚</p>
<p>åœ¨æŠ€æœ¯ä¸Šè€Œè¨€ï¼Œè¿™ä¸ªåšæ³•å¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºï¼Œä½†æ˜¯é€šå¸¸çš„ç»“æœæ˜¯setä»¥æ‹¥æœ‰äº†ä¸¤ä¸ªä¸º33çš„å€¼çš„æ‹·è´è€Œå‘Šç»ˆï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸å†æ˜¯ä¸€ä¸ªsetäº†ã€‚é€šè¿‡ä½¿ç”¨less_equalä½œä¸ºæˆ‘ä»¬çš„æ¯”è¾ƒç±»å‹ï¼Œæˆ‘ä»¬ç ´åäº†å®¹å™¨ï¼</p>
<p><strong>æµ‹è¯•</strong></p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">set</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">less_equal</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">snumber</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">snumber</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">33</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">snumber</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">33</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">for_each</span><span class="p">(</span><span class="n">snumber</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">snumber</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">print</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœ:</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="mi">33</span>
</span></span><span class="line"><span class="cl"><span class="mi">33</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="example-string">Example string*</h2>
<p><code>æ¡æ¬¾20</code>æè¿°äº†è¯¥å¦‚ä½•å†™ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ä»¥ä½¿å¾—å®¹çº³<code>string*</code>æŒ‡é’ˆçš„å®¹å™¨æ ¹æ®stringçš„å€¼æ’åºï¼Œè€Œä¸æ˜¯å¯¹æŒ‡é’ˆçš„å€¼æ’åºã€‚é‚£ä¸ªæ¯”è¾ƒå‡½æ•°æ˜¯æŒ‰å‡åºæ’åºçš„ï¼Œä½†ç°åœ¨å‡è®¾ä½ éœ€è¦<code>string*</code>æŒ‡é’ˆçš„å®¹å™¨çš„é™åºæ’åºçš„æ¯”è¾ƒå‡½æ•°ã€‚</p>
<p>è‡ªç„¶æ˜¯æŠ“ç°æˆçš„ä»£ç æ¥ä¿®æ”¹äº†ã€‚å¦‚æœä¸ç»†å¿ƒï¼Œå¯èƒ½ä¼šè¿™ä¹ˆå¹²:</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">StringPtrGreater</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span> <span class="c1">// è¿™ä»£ç æ˜¯æœ‰ç‘•ç–µçš„ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps1</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps2</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">ps1</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">ps2</span><span class="p">);</span> <span class="c1">// åªæ˜¯ç›¸åäº†æ—§çš„æµ‹è¯•ï¼›è¿™æ˜¯ä¸å¯¹çš„ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„æƒ³æ³•æ˜¯é€šè¿‡å°†æ¯”è¾ƒå‡½æ•°å†…éƒ¨ç»“æœå–åæ¥è¾¾åˆ°ååºçš„ç»“æœã€‚å¾ˆä¸å¹¸ï¼Œå–åâ€œ&lt;â€ä¸ä¼šç»™ä½ ï¼ˆä½ æ‰€æœŸæœ›çš„ï¼‰â€œ&gt;â€ï¼Œå®ƒç»™ä½ çš„æ˜¯ â€œ&gt;=â€ã€‚</p>
<p>è€Œä½ ç°åœ¨çŸ¥é“ï¼Œå› ä¸ºå®ƒå°†å¯¹ç›¸ç­‰çš„å€¼è¿”å›trueï¼Œå¯¹å…³è”å®¹å™¨æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ— æ•ˆçš„æ¯”è¾ƒå‡½æ•°ã€‚</p>
<p>ä½ çœŸæ­£éœ€è¦çš„æ¯”è¾ƒç±»å‹æ˜¯è¿™ä¸ª:</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">StringPtrGreater</span><span class="o">:</span> <span class="c1">// å¯¹å…³è”å®¹å™¨æ¥è¯´è¿™æ˜¯æœ‰æ•ˆçš„æ¯”è¾ƒç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps1</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps2</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="o">*</span><span class="n">ps2</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">ps1</span><span class="p">;</span> <span class="c1">// è¿”å›*ps2æ˜¯å¦å¤§äº*ps1ï¼ˆä¹Ÿå°±æ˜¯äº¤æ¢æ“ä½œæ•°çš„é¡ºåºï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦é¿å…æ‰å…¥è¿™ä¸ªé™·é˜±ï¼Œä½ æ‰€è¦è®°ä½çš„å°±æ˜¯æ¯”è¾ƒå‡½æ•°çš„è¿”å›å€¼è¡¨æ˜çš„æ˜¯åœ¨æ­¤å‡½æ•°å®šä¹‰çš„æ’åºæ–¹å¼ä¸‹ï¼Œä¸€ä¸ªå€¼æ˜¯å¦å¤§äºå¦ä¸€ä¸ªã€‚</p>
<p><strong>ç›¸ç­‰çš„å€¼ç»ä¸è¯¥ä¸€ä¸ªå¤§äºå¦ä¸€ä¸ªï¼Œæ‰€ä»¥æ¯”è¾ƒå‡½æ•°æ€»åº”è¯¥å¯¹ç›¸ç­‰çš„å€¼è¿”å›<code>false</code></strong></p>
<h2 id="example-multiset">Example multiset</h2>
<p>multisetå’Œmultimapé‚£äº›å®¹å™¨å¯ä»¥å®¹çº³å¤æœ¬å¯èƒ½åŒ…å«å‰¯æœ¬ï¼Œå¦‚æœå®¹å™¨è®¤ä¸ºä¸¤ä¸ªå€¼ç›¸ç­‰çš„å¯¹è±¡ä¸ç­‰ä»·ï¼Œå®ƒå°†ä¼šæŠŠä¸¤ä¸ªéƒ½å­˜å‚¨è¿›å»çš„ï¼Œè¿™æ­£æ˜¯multiç³»åˆ—å®¹å™¨çš„æ‰€è¦æ”¯æŒçš„äº‹æƒ…ã€‚</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">multiset</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">less_equal</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">msnum</span><span class="p">;</span> <span class="c1">// ä»ç„¶ä»¥â€œ&lt;=â€æ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">msnum</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span> <span class="c1">// æ’å…¥22A
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">msnum</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span> <span class="c1">// æ’å…¥22B
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">for_each</span><span class="p">(</span><span class="n">msnum</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">msnum</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">print</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœ:</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="mi">22</span>
</span></span><span class="line"><span class="cl"><span class="mi">22</span></span></span></code></pre></td></tr></table>
</div>
</div><p>sé‡Œæœ‰ä¸¤ä¸ª22çš„æ‹·è´ï¼Œ<strong>å› æ­¤æˆ‘ä»¬æœŸæœ›å¦‚æœæˆ‘ä»¬åœ¨å®ƒä¸Šé¢åšä¸€ä¸ª<code>equal_range</code>ï¼Œæˆ‘ä»¬å°†ä¼šå¾—åˆ°ä¸€å¯¹æŒ‡å‡ºåŒ…å«è¿™ä¸¤ä¸ªæ‹·è´çš„èŒƒå›´çš„è¿­ä»£å™¨ã€‚ä½†é‚£æ˜¯ä¸å¯èƒ½çš„ã€‚</strong></p>
<p><code>equal_range</code>ï¼Œè™½ç„¶å«è¿™ä¸ªåå­—ï¼Œä½†ä¸æ˜¯æŒ‡ç¤ºå‡ºç›¸ç­‰çš„å€¼çš„èŒƒå›´ï¼Œè€Œæ˜¯ç­‰ä»·çš„å€¼çš„èŒƒå›´ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œsçš„æ¯”è¾ƒå‡½æ•°è¯´22Aå’Œ22Bæ˜¯ä¸ç­‰ä»·çš„ï¼Œæ‰€ä»¥ä¸å¯èƒ½è®©å®ƒä»¬åŒæ—¶å‡ºç°åœ¨equal_rangeæ‰€æŒ‡ç¤ºçš„èŒƒå›´å†…ã€‚</p>
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">pair</span><span class="o">&lt;</span><span class="n">multiset</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="p">,</span> <span class="n">multiset</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="o">&gt;</span> <span class="n">range2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//åœ¨ myvector å®¹å™¨ä¸­æ‰¾åˆ°æ‰€æœ‰çš„å…ƒç´  22
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">range2</span> <span class="o">=</span> <span class="n">equal_range</span><span class="p">(</span><span class="n">msnum</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">msnum</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">22</span><span class="p">,</span> <span class="n">less_equal</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span>
</span></span><span class="line"><span class="cl"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">my multisetï¼š&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">range2</span><span class="p">.</span><span class="n">first</span><span class="p">;</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">range2</span><span class="p">.</span><span class="n">second</span><span class="p">;</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœæ²¡æœ‰å¾—åˆ°æœŸæœ›ç»“æœ:</p>
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">my multiset:</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ”¹ä¸º<code>less</code>æ¯”è¾ƒ:</p>
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">range2</span> <span class="o">=</span> <span class="n">equal_range</span><span class="p">(</span><span class="n">msnum</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">msnum</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">22</span><span class="p">,</span> <span class="n">less</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœ:</p>
<div class="highlight" id="id-16"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">my</span> <span class="n">multiset</span><span class="err">ï¼š</span><span class="mi">22</span> <span class="mi">22</span></span></span></code></pre></td></tr></table>
</div>
</div><p><font color=red><strong>é™¤éä½ çš„æ¯”è¾ƒå‡½æ•°æ€»æ˜¯ä¸ºç›¸ç­‰çš„å€¼è¿”å›falseï¼Œä½ å°†ä¼šæ‰“ç ´æ‰€æœ‰çš„æ ‡å‡†å…³è”å‹å®¹å™¨ï¼Œä¸ç®¡å®ƒä»¬æ˜¯å¦å…è®¸å­˜å‚¨å¤æœ¬ã€‚</strong></font></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ä»æŠ€æœ¯ä¸Šè¯´ï¼Œç”¨äºæ’åºå…³è”å®¹å™¨çš„æ¯”è¾ƒå‡½æ•°å¿…é¡»åœ¨å®ƒä»¬æ‰€æ¯”è¾ƒçš„å¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªâ€œ<strong>ä¸¥æ ¼çš„å¼±åºåŒ–(strict weakordering)</strong>â€ã€‚ï¼ˆä¼ ç»™sortç­‰ç®—æ³•ï¼ˆå‚è§æ¡æ¬¾31ï¼‰çš„æ¯”è¾ƒå‡½æ•°ä¹Ÿæœ‰åŒæ ·çš„é™åˆ¶ï¼‰ã€‚</p>
<p><strong>ä»»ä½•ä¸€ä¸ªå®šä¹‰äº†ä¸¥æ ¼çš„å¼±åºåŒ–çš„å‡½æ•°éƒ½å¿…é¡»åœ¨ä¼ å…¥ç›¸åŒçš„å€¼çš„ä¸¤ä¸ªæ‹·è´æ—¶è¿”å›falseã€‚</strong></p>
]]></description></item><item><title>Effective STL [20] | ä¸ºæŒ‡é’ˆçš„å…³è”å®¹å™¨æŒ‡å®šæ¯”è¾ƒç±»å‹</title><link>https://jianye0428.github.io/posts/clause_20/</link><pubDate>Fri, 11 Aug 2023 16:10:59 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_20/</guid><description><![CDATA[<h2 id="example">Example</h2>
<p>å‡å®šä½ æœ‰ä¸€ä¸ªstring*æŒ‡é’ˆçš„setï¼Œä½ æŠŠä¸€äº›åŠ¨ç‰©çš„åå­—æ’å…¥è¿›set:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*&gt;</span> <span class="n">ssp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ssp</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="s">&#34;Anteater&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">ssp</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="s">&#34;Wombat&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">ssp</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="s">&#34;Lemur&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">ssp</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="s">&#34;Penguin&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ssp = â€œset of string ptrsâ€
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åä½ å†™äº†ä¸‹åˆ—ä»£ç æ‰“å°setçš„å†…å®¹ï¼Œå¸Œæœ›å­—ç¬¦ä¸²æŒ‰å­—æ¯é¡ºåºå‡ºç°ã€‚æ¯•ç«Ÿï¼Œç¡®å®šsetä¿æŒå®ƒä»¬çš„å†…å®¹æœ‰åºã€‚</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*&gt;::</span><span class="n">const_iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="n">i</span> <span class="o">!=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ æœŸæœ›çœ‹åˆ°</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Anteater
</span></span><span class="line"><span class="cl">Wombat
</span></span><span class="line"><span class="cl">Lemur
</span></span><span class="line"><span class="cl">Penguin</span></span></code></pre></td></tr></table>
</div>
</div><p>å®é™…è¿è¡Œç»“æœ:</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="mh">0x5566364b5eb0</span>
</span></span><span class="line"><span class="cl"><span class="mh">0x5566364b5f10</span>
</span></span><span class="line"><span class="cl"><span class="mh">0x5566364b5f70</span>
</span></span><span class="line"><span class="cl"><span class="mh">0x5566364b5fd0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœæ˜¯4ä¸ªåå…­è¿›åˆ¶çš„æ•°ï¼Œä»£è¡¨æŒ‡é’ˆçš„å€¼ã€‚ å› ä¸ºsetå®¹çº³æŒ‡é’ˆï¼Œ<code>*i</code>ä¸æ˜¯ä¸€ä¸ª<code>string</code>ï¼Œæ˜¯ä¸€ä¸ª<code>string</code>çš„æŒ‡é’ˆã€‚</p>
<p>å¦‚æœä½ å·²ç»æ”¹ä¸ºè°ƒç”¨copyç®—æ³•ï¼Œ</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">copy</span><span class="p">(</span><span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">ostream_iterator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">));</span><span class="c1">// æŠŠsspä¸­çš„å­—ç¬¦ä¸²æ‹·è´åˆ°coutï¼ˆä½†è¿™ä¸èƒ½ç¼–è¯‘ï¼‰
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªcopyçš„è°ƒç”¨å°†ä¸èƒ½ç¼–è¯‘ï¼Œå› ä¸º<code>ostream_iterator</code>éœ€è¦çŸ¥é“è¢«æ‰“å°çš„å¯¹è±¡çš„ç±»å‹ï¼Œæ‰€ä»¥å½“ä½ å‘Šè¯‰å®ƒæ˜¯ä¸€ä¸ªstringæ—¶ï¼ˆé€šè¿‡ä½œä¸ºæ¨¡æ¿å‚æ•°ä¼ é€’ï¼‰ï¼Œç¼–è¯‘å™¨æ£€æµ‹åˆ°é‚£å’Œsspä¸­å‚¨å­˜çš„å¯¹è±¡ç±»å‹(æ˜¯<code>string*</code>)ä¹‹é—´ä¸åŒ¹é…ï¼Œå®ƒä»¬ä¼šæ‹’ç»ç¼–è¯‘ä»£ç ã€‚</p>
<p>æŠŠæ˜¾å¼å¾ªç¯ä¸­çš„<code>*i</code>æ”¹ä¸º<code>**i</code>ï¼Œä½ å¯èƒ½å¯ä»¥å¾—åˆ°ä½ æƒ³è¦çš„è¾“å‡ºï¼Œä½†ä¹Ÿå¯èƒ½ä¸ã€‚åŠ¨ç‰©åå­—å°†è¢«æ‰“å°ï¼Œä½†å®ƒä»¬æŒ‰å­—æ¯é¡ºåºå‡ºç°çš„æœºä¼šåªæ˜¯24ä»½ä¹‹1ã€‚sspä¿æŒå®ƒçš„å†…å®¹æœ‰åºï¼Œä½†æ˜¯å®ƒå®¹çº³çš„æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥å®ƒä»¥æŒ‡é’ˆçš„å€¼æ’åºï¼Œè€Œä¸ä»¥stringå€¼ã€‚å¯¹äºå››ä¸ªæŒ‡é’ˆå€¼å¯èƒ½æœ‰24ç§æ’åˆ—ï¼ˆï¼‰ï¼Œæ‰€ä»¥æŒ‡é’ˆè¢«å‚¨å­˜æ—¶æœ‰24ç§å¯èƒ½çš„é¡ºåºã€‚å› æ­¤ä½ çœ‹è§å­—ç¬¦ä¸²æŒ‰å­—æ¯æ’åºæœ‰24ä»½ä¹‹1çš„å‡ ç‡ã€‚</p>
<p>æˆ–è€…æ‰“å° <code>*string</code>çš„<code>char*</code>æ•°ç»„</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*&gt;::</span><span class="n">const_iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">c_str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="solution">Solution</h2>
<p>å½“æˆ‘ä»¬å†™ä¸‹<code>set&lt;string*&gt; ssp</code>;ï¼Œå…¶å®çœç•¥äº†ä¸€ä¸ªé»˜è®¤å‚æ•°<code>set&lt;string*, less&lt;string*&gt; &gt; ssp</code>;ï¼Œå®é™…ä¸Šè¿˜æœ‰ä¸ªé»˜è®¤å‚æ•°:</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="n">less</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*&gt;</span><span class="p">,</span> <span class="n">allocator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*&gt;</span> <span class="o">&gt;</span> <span class="n">ssp</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è‡ªå®šä¹‰ä»¿å‡½æ•°">è‡ªå®šä¹‰ä»¿å‡½æ•°</h2>
<p>å¦‚æœæƒ³è¦<code>string*</code>æŒ‡é’ˆä»¥å­—ç¬¦ä¸²å€¼ç¡®å®šé¡ºåºè¢«å‚¨å­˜åœ¨<code>set</code>ä¸­ï¼Œä¸èƒ½ä½¿ç”¨é»˜è®¤æ¯”è¾ƒä»¿å‡½æ•°ç±»<code>less&lt;string*&gt;</code>ã€‚</p>
<p><strong>å¿…é¡»æ”¹ä¸ºå†™è‡ªå·±çš„æ¯”è¾ƒä»¿å‡½æ•°ç±»ï¼Œå®ƒçš„å¯¹è±¡å¸¦æœ‰string*æŒ‡é’ˆå¹¶æŒ‰ç…§æŒ‡å‘çš„å­—ç¬¦ä¸²å€¼æ¥è¿›è¡Œæ’åº:</strong></p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">StringPtrLess</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span> <span class="n">binary_function</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps1</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps2</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="o">*</span><span class="n">ps1</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">ps2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå¯ä»¥ä½¿ç”¨<code>StringPtrLess</code>ä½œä¸º<code>ssp</code>çš„æ¯”è¾ƒç±»å‹:</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="n">StringPtrLess</span><span class="o">&gt;</span> <span class="n">StringPtrSet</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">StringPtrSet</span> <span class="n">ssp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å»ºç«‹å­—ç¬¦ä¸²çš„é›†åˆï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1">// æŒ‰ç…§StringPtrLesså®šä¹‰çš„é¡ºåºæ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å’Œå‰é¢ä¸€æ ·æ’å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1">// åŒæ ·å››ä¸ªå­—ç¬¦ä¸²
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨å¾ªç¯æœ€åå°†åšæƒ³è¦å®ƒåšçš„ï¼ˆä¹Ÿå°±æ˜¯å‰é¢ä½ ä½¿ç”¨*iä»£æ›¿**iæ‰€ä¿®æ­£çš„é—®é¢˜ï¼‰:</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">StringPtrSet</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">**</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æŒ‡é’ˆä¹‹å‰å¯¹å®ƒä»¬è§£å¼•ç”¨çš„å‡½æ•°ï¼Œç„¶åå’Œ<code>for_each</code>è”ç”¨é‚£ä¸ªå‡½æ•°:</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ps</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">ps</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">for_each</span><span class="p">(</span><span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">print</span><span class="p">);</span><span class="c1">// åœ¨sspä¸­çš„æ¯ä¸ªå…ƒç´ ä¸Šè°ƒç”¨print
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…ä½ æƒ³è±¡å¹¶å†™å‡ºäº†æ³›å‹çš„è§£å¼•ç”¨ä»¿å‡½æ•°ç±»ï¼Œç„¶åè®©å®ƒå’Œtransformä¸ostream_iteratorè¿ç”¨:</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// å½“æœ¬ç±»å‹çš„ä»¿å‡½æ•°è¢«ä¼ å…¥ä¸€ä¸ªT*æ—¶ï¼Œå®ƒä»¬è¿”å›ä¸€ä¸ªconst T&amp;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">Dereference</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡è§£å¼•ç”¨â€œè½¬æ¢â€ sspä¸­çš„æ¯ä¸ªå…ƒç´ ï¼ŒæŠŠç»“æœå†™å…¥cout
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">transform</span><span class="p">(</span><span class="n">ssp</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">ssp</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">ostream_iterator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">),</span> <span class="n">Dereference</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦ç‚¹æ˜¯æ— è®ºä½•æ—¶ä½ å»ºç«‹ä¸€ä¸ªæŒ‡é’ˆçš„æ ‡å‡†å…³è”å®¹å™¨ï¼Œä½ å¿…é¡»è®°ä½å®¹å™¨ä¼šä»¥æŒ‡é’ˆçš„å€¼æ’åºã€‚è¿™åŸºæœ¬ä¸Šä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œæ‰€ä»¥ä½ å‡ ä¹æ€»æ˜¯éœ€è¦å»ºç«‹è‡ªå·±çš„ä»¿å‡½æ•°ç±»ä½œä¸ºæ¯”è¾ƒç±»å‹ã€‚</p>
<p><strong>æ¯”è¾ƒç±»å‹ vs æ¯”è¾ƒå‡½æ•°</strong></p>
<p>æ³¨æ„åˆ°è¿™é‡Œå†™çš„æ˜¯â€œæ¯”è¾ƒç±»å‹â€ã€‚</p>
<p>ä½ å¯èƒ½å¥‡æ€ªä¸ºä»€ä¹ˆå¿…é¡»ç‰¹æ„åˆ›é€ ä¸€ä¸ªä»¿å‡½æ•°ç±»è€Œä¸æ˜¯ç®€å•åœ°ä¸ºsetå†™ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°:</p>
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">stringPtrLess</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">*</span> <span class="n">ps1</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">*</span> <span class="n">ps2</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// å°†æˆä¸ºç”¨äºæŒ‰å­—ç¬¦ä¸²å€¼æ’åºçš„string*æŒ‡é’ˆçš„æ¯”è¾ƒå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="k">return</span> <span class="o">*</span><span class="n">ps1</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">ps2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="n">stringPtrLess</span><span class="o">&gt;</span> <span class="n">ssp</span><span class="p">;</span><span class="c1">// å‡è®¾ä½¿ç”¨stringPtrLess ä½œä¸ºsspçš„æ¯”è¾ƒå‡½æ•°ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1">// è¿™ä¸èƒ½ç¼–è¯‘
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„é—®é¢˜æ˜¯æ¯ä¸ªsetæ¨¡æ¿çš„ç¬¬ä¸‰ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ç§ç±»å‹ï¼Œè€Œ<code>stringPtrLess</code>ä¸æ˜¯ä¸€ç§ç±»å‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå°è¯•ä½¿ç”¨<code>stringPtrLess</code>ä½œä¸ºsetçš„æ¯”è¾ƒå‡½æ•°ä¸èƒ½ç¼–è¯‘çš„åŸå› ï¼Œsetä¸è¦ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè¦çš„æ˜¯èƒ½åœ¨å†…éƒ¨ç”¨å®ä¾‹åŒ–å»ºç«‹å‡½æ•°çš„ä¸€ç§ç±»å‹ã€‚</p>
<p><strong>æ— è®ºä½•æ—¶ä½ å»ºç«‹æŒ‡é’ˆçš„å…³è”å®¹å™¨ï¼Œæ³¨æ„ä½ ä¹Ÿå¾—æŒ‡å®šå®¹å™¨çš„æ¯”è¾ƒç±»å‹ã€‚</strong></p>
<p>å¤§å¤šæ•°æ—¶å€™ï¼Œä½ çš„æ¯”è¾ƒç±»å‹åªæ˜¯è§£å¼•ç”¨æŒ‡é’ˆå¹¶æ¯”è¾ƒæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼ˆå°±åƒä¸Šé¢çš„<code>StringPtrLess</code>åšçš„é‚£æ ·ï¼‰ã€‚</p>
<p>é‰´äºè¿™ç§æƒ…å†µï¼Œä½ æ‰‹å¤´æœ€å¥½ä¹Ÿèƒ½æœ‰ä¸€ä¸ªç”¨äºé‚£ç§æ¯”è¾ƒçš„ä»¿å‡½æ•°æ¨¡æ¿ã€‚åƒè¿™æ ·:</p>
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">DereferenceLess</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">PtrType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="n">PtrType</span> <span class="n">pT1</span><span class="p">,</span> <span class="n">PtrType</span> <span class="n">pT2</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="c1">// å‚æ•°æ˜¯å€¼ä¼ é€’çš„å› ä¸ºæˆ‘ä»¬å¸Œæœ›å®ƒä»¬æ˜¯ï¼ˆæˆ–è¡Œä¸ºåƒï¼‰æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="o">*</span><span class="n">pT1</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">pT2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·çš„æ¨¡æ¿æ¶ˆé™¤äº†å†™åƒ<code>StringPtrLess</code>é‚£æ ·çš„ç±»çš„éœ€è¦ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æ”¹ä¸ºä½¿ç”¨<code>DereferenceLess</code>:</p>
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">*</span><span class="p">,</span> <span class="n">DereferenceLess</span><span class="o">&gt;</span> <span class="n">ssp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è¡Œä¸ºå°±åƒ set&lt;string*, StringPtrLess&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬æ¡æ¬¾æ˜¯å…³äºæŒ‡é’ˆçš„å…³è”å®¹å™¨ï¼Œä½†å®ƒä¹Ÿå¯ä»¥åº”ç”¨äºè¡¨ç°ä¸ºæŒ‡é’ˆçš„å¯¹è±¡çš„å®¹å™¨ï¼Œä¾‹å¦‚ï¼Œæ™ºèƒ½æŒ‡é’ˆå’Œè¿­ä»£å™¨ã€‚</p>
<p>å¦‚æœä½ æœ‰ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–è¿­ä»£å™¨çš„å…³è”å®¹å™¨ï¼Œé‚£ä¹Ÿå¾—ä¸ºå®ƒæŒ‡å®šæ¯”è¾ƒç±»å‹ã€‚å¹¸è¿çš„æ˜¯ï¼ŒæŒ‡é’ˆçš„è¿™ä¸ªè§£å†³æ–¹æ¡ˆä¹Ÿå¯ä»¥ç”¨äºç±»ä¼¼æŒ‡é’ˆçš„å¯¹è±¡ã€‚æ­£å¦‚DereferenceLessé€‚åˆä½œä¸ºT*çš„å…³è”å®¹å™¨çš„æ¯”è¾ƒç±»å‹ä¸€æ ·ï¼Œå®ƒä¹Ÿ å¯ä»¥ä½œä¸ºTå¯¹è±¡çš„è¿­ä»£å™¨å’Œæ™ºèƒ½æŒ‡é’ˆå®¹å™¨çš„æ¯”è¾ƒç±»å‹ã€‚</p>
<p>å®é™…ä¸Šï¼Œè¿™24ç§æ’åˆ—å¾ˆå¯èƒ½ä¸æ˜¯å¹³ç­‰çš„ï¼Œæ‰€ä»¥â€œ24ä»½ä¹‹1â€çš„é™ˆè¿°æœ‰ç‚¹ä½¿äººè¯¯è§£ã€‚ç¡®å®ï¼Œæœ‰24ä¸ªä¸åŒçš„é¡ºåºï¼Œè€Œä¸”ä½ å¯èƒ½å¾—åˆ°å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚</p>
]]></description></item><item><title>Effective STL [19] | äº†è§£ç›¸ç­‰å’Œç­‰ä»·çš„åŒºåˆ«</title><link>https://jianye0428.github.io/posts/clause_19/</link><pubDate>Thu, 10 Aug 2023 08:30:55 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/clause_19/</guid><description><![CDATA[<h2 id="æ¯”è¾ƒå¯¹è±¡">æ¯”è¾ƒå¯¹è±¡</h2>
<p>STLå……æ»¡äº†æ¯”è¾ƒå¯¹è±¡æ˜¯å¦æœ‰åŒæ ·çš„å€¼ã€‚æ¯”å¦‚ï¼Œå½“ä½ ç”¨<code>find</code>æ¥å®šä½åŒºé—´ä¸­ç¬¬ä¸€ä¸ªæœ‰ç‰¹å®šå€¼çš„å¯¹è±¡çš„ä½ç½®ï¼Œ<code>find</code>å¿…é¡»å¯ä»¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼Œçœ‹çœ‹ä¸€ä¸ªçš„å€¼æ˜¯å¦ä¸å¦ä¸€ä¸ªç›¸ç­‰ã€‚åŒæ ·ï¼Œå½“ä½ å°è¯•å‘<code>set</code>ä¸­æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ æ—¶ï¼Œ<code>set::insert</code>å¿…é¡»å¯ä»¥åˆ¤æ–­é‚£ä¸ªå…ƒç´ çš„å€¼æ˜¯å¦å·²ç»åœ¨<code>set</code>ä¸­äº†ã€‚</p>
<p><code>find</code>ç®—æ³•å’Œ<code>set</code>çš„<code>insert</code>æˆå‘˜å‡½æ•°æ˜¯å¾ˆå¤šå¿…é¡»åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸åŒçš„å‡½æ•°çš„ä»£è¡¨ã€‚ä½†å®ƒä»¬å®ç°æ–¹å¼ä¸åŒï¼Œfindå¯¹â€œç›¸åŒâ€çš„å®šä¹‰æ˜¯ç›¸ç­‰ï¼ŒåŸºäº<code>operator==</code>ã€‚<code>set::insert</code>å¯¹â€œç›¸åŒâ€çš„å®šä¹‰æ˜¯ç­‰ä»·ï¼Œé€šå¸¸åŸºäº<code>operator&lt;</code>ã€‚å› ä¸ºæœ‰å®šä¹‰ä¸åŒï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¸€ä¸ªå®šä¹‰è§„å®šäº†ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„å€¼è€Œå¦ä¸€ä¸ªå®šä¹‰åˆ¤å®šå®ƒä»¬æ²¡æœ‰ã€‚ç»“æœï¼Œå¦‚æœä½ æƒ³æœ‰æ•ˆä½¿ç”¨STLï¼Œé‚£ä¹ˆä½ å¿…é¡»æ˜ç™½ç›¸ç­‰å’Œç­‰ä»·çš„åŒºåˆ«ã€‚</p>
<p><strong>ç›¸ç­‰</strong></p>
<p>æ“ä½œä¸Šæ¥è¯´ï¼Œç›¸ç­‰çš„æ¦‚å¿µæ˜¯åŸºäº<code>operator</code>çš„ã€‚å¦‚æœè¡¨è¾¾å¼â€œ<code>x == y</code>â€è¿”å›trueï¼Œ<code>x</code>å’Œ<code>y</code>æœ‰ç›¸ç­‰çš„å€¼ï¼Œå¦åˆ™å®ƒä»¬æ²¡æœ‰ã€‚</p>
<p><strong><font color=red>xå’Œyæœ‰ç›¸ç­‰çš„å€¼å¹¶ä¸æ„å‘³ç€æ‰€æœ‰å®ƒä»¬çš„æˆå‘˜æœ‰ç›¸ç­‰çš„å€¼</font></strong>ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰ä¸€ä¸ªå†…éƒ¨è®°å½•äº†æœ€åä¸€æ¬¡è®¿é—®çš„Widgetç±»ã€‚</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"> <span class="n">TimeStamp</span> <span class="n">lastAccessed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªç”¨äºWidgetçš„å¿½ç•¥è¿™ä¸ªåŸŸçš„operator:</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">operator</span><span class="p">(</span><span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¿½ç•¥lastAccessedåŸŸçš„ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œä¸¤ä¸ª<code>Widget</code>å³ä½¿å®ƒä»¬çš„<code>lastAccessed</code>åŸŸä¸åŒä¹Ÿå¯ä»¥æœ‰ç›¸ç­‰çš„å€¼ã€‚</p>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œç›¸ç­‰æ„å‘³ç€ä¸¤ä¸ªå˜é‡çš„å€¼ç›¸åŒï¼Œä½†æ˜¯å¦‚æœæ¯”è¾ƒ2ä¸ªå¯¹è±¡ï¼Œå› ä¸ºæ¯”è¾ƒå‡½æ•°å¯ä»¥è‡ªå®šä¹‰ï¼Œå› æ­¤æœ‰æ—¶å€™å¯¹è±¡çš„æŸäº›æˆå‘˜å˜é‡å€¼ä¸åŒä¹Ÿä¼šè®¾å®š2ä¸ªå¯¹è±¡ç›¸ç­‰ã€‚</p>
<p><strong>ç­‰ä»·</strong></p>
<p>==ç­‰ä»·æ˜¯åŸºäºåœ¨ä¸€ä¸ªæœ‰åºåŒºé—´ä¸­å¯¹è±¡å€¼çš„ç›¸å¯¹ä½ç½®==ã€‚</p>
<p>ç­‰ä»·ä¸€èˆ¬åœ¨æ¯ç§æ ‡å‡†å…³è”å®¹å™¨ï¼ˆæ¯”å¦‚ï¼Œsetã€multisetã€mapå’Œmultimapï¼‰çš„ä¸€éƒ¨åˆ†â€”â€”æ’åºé¡ºåºæ–¹é¢æœ‰æ„ä¹‰ã€‚æ³¨æ„è¿™é‡Œçš„åº”ç”¨åœºæ™¯æ˜¯==æ’åº==ã€‚</p>
<p>ä¸¤ä¸ªå¯¹è±¡xå’Œyå¦‚æœåœ¨å…³è”å®¹å™¨cçš„æ’åºé¡ºåºä¸­æ²¡æœ‰å“ªä¸ªæ’åœ¨å¦ä¸€ä¸ªä¹‹å‰ï¼Œé‚£ä¹ˆå®ƒä»¬å…³äºcä½¿ç”¨çš„æ’åºé¡ºåºæœ‰ç­‰ä»·çš„å€¼ã€‚</p>
<p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªset<Widget> sã€‚ä¸¤ä¸ªWidget w1å’Œw2ï¼Œå¦‚æœåœ¨sçš„æ’åºé¡ºåºä¸­æ²¡æœ‰å“ªä¸ªåœ¨å¦ä¸€ä¸ªä¹‹å‰ï¼Œé‚£ä¹ˆå…³äºså®ƒä»¬æœ‰ç­‰ä»·çš„å€¼ã€‚set<Widget>çš„é»˜è®¤æ¯”è¾ƒå‡½æ•°æ˜¯less<Widget>ï¼Œè€Œé»˜è®¤çš„less<Widget>ç®€å•åœ°å¯¹Widgetè°ƒç”¨operator&lt;ï¼Œæ‰€ä»¥w1å’Œw2å…³äºoperator&lt;æœ‰ç­‰ä»·çš„å€¼å¦‚æœä¸‹é¢è¡¨è¾¾å¼ä¸ºçœŸï¼š</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="o">!</span><span class="p">(</span><span class="n">w1</span> <span class="o">&lt;</span> <span class="n">w2</span><span class="p">)</span> <span class="c1">// w1 &lt; w2æ—¶å®ƒéçœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&amp;&amp;</span> <span class="c1">// è€Œä¸”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">!</span><span class="p">(</span><span class="n">w2</span><span class="o">&lt;</span><span class="n">w1</span><span class="p">)</span> <span class="c1">// w2 &lt; w1æ—¶å®ƒéçœŸ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªæœ‰æ„ä¹‰ï¼š<font color=red>ä¸¤ä¸ªå€¼å¦‚æœæ²¡æœ‰å“ªä¸ªåœ¨å¦ä¸€ä¸ªä¹‹å‰ï¼ˆå…³äºæŸä¸ªæ’åºæ ‡å‡†ï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬ç­‰ä»·ï¼ˆæŒ‰ç…§é‚£ä¸ªæ ‡å‡†ï¼‰ã€‚</font>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”¨äºå…³è”å®¹å™¨çš„æ¯”è¾ƒå‡½æ•°ä¸æ˜¯<code>operator&lt;</code>æˆ–ç”šè‡³<code>less</code>ï¼Œå®ƒæ˜¯ç”¨æˆ·å®šä¹‰çš„åˆ¤æ–­å¼ã€‚æ¯ä¸ªæ ‡å‡†å…³è”å®¹å™¨é€šè¿‡å®ƒçš„<code>key_comp</code>æˆå‘˜å‡½æ•°æ¥è®¿é—®æ’åºåˆ¤æ–­å¼ï¼Œæ‰€ä»¥å¦‚æœä¸‹å¼æ±‚å€¼ä¸ºçœŸï¼Œä¸¤ä¸ªå¯¹è±¡xå’Œyå…³äºä¸€ä¸ªå…³è”å®¹å™¨cçš„æ’åºæ ‡å‡†æœ‰ç­‰ä»·çš„å€¼ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="o">!</span><span class="n">c</span><span class="p">.</span><span class="n">key_comp</span><span class="p">()(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">c</span><span class="p">.</span><span class="n">key_comp</span><span class="p">()(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="c1">// åœ¨cçš„æ’åºé¡ºåºä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¦‚æœxåœ¨yä¹‹å‰å®ƒéçœŸï¼ŒåŒæ—¶åœ¨cçš„æ’åºé¡ºåºä¸­,å¦‚æœyåœ¨xä¹‹å‰å®ƒéçœŸ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¦å®Œå…¨é¢†ä¼š==ç›¸ç­‰==å’Œ==ç­‰ä»·==çš„å«ä¹‰ï¼Œè€ƒè™‘ä¸€ä¸ªå¿½ç•¥å¤§å°å†™çš„<code>set&lt;string&gt;</code>ï¼Œä¹Ÿå°±æ˜¯setçš„æ¯”è¾ƒå‡½æ•°å¿½ç•¥å­—ç¬¦ä¸²ä¸­å­—ç¬¦å¤§å°å†™çš„<code>set&lt;string&gt;</code>ã€‚è¿™æ ·çš„æ¯”è¾ƒå‡½æ•°ä¼šè®¤ä¸ºâ€œSTLâ€å’Œâ€œstLâ€æ˜¯ç­‰ä»·çš„ã€‚æ¡æ¬¾35æ¼”ç¤ºäº†æ€ä¹ˆå®ç°ä¸€ä¸ªå‡½æ•°ï¼Œ<code>ciStringCompare</code>ï¼Œå®ƒè¿›è¡Œäº†å¿½ç•¥å¤§å°å†™æ¯”è¾ƒï¼Œä½†setè¦ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°çš„ç±»å‹ï¼Œä¸æ˜¯çœŸçš„å‡½æ•°ã€‚è¦å¡«å¹³è¿™ä¸ªé¸¿æ²Ÿï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªoperator()è°ƒç”¨äº†ciStringCompareçš„ä»¿å‡½æ•°ç±»:</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">CIStringCompare</span><span class="o">:</span> <span class="c1">// ç”¨äºå¿½ç•¥å¤§å°å†™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="c1">// å­—ç¬¦ä¸²æ¯”è¾ƒçš„ç±»ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">binary_function</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="n">ciStringCompare</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);</span> <span class="c1">// å…³äºciStringCompare
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…·ä½“å®ç°ä¸º:</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">ciCharCompare</span><span class="p">(</span><span class="kt">char</span> <span class="n">c1</span><span class="p">,</span> <span class="kt">char</span> <span class="n">c2</span><span class="p">)</span> <span class="c1">// å¿½ç•¥å¤§å°å†™æ¯”è¾ƒå­—ç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>   <span class="c1">// c1å’Œc2ï¼Œå¦‚æœc1 &lt; c2è¿”å›-1ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// å¦‚æœc1==c2è¿”å›0ï¼Œå¦‚æœc1 &gt; c2è¿”å›1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">Ic1</span> <span class="o">=</span> <span class="n">tolower</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c1</span><span class="p">));</span><span class="c1">// è½¬æˆå°å†™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">Ic2</span> <span class="o">=</span> <span class="n">tolower</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">Ic1</span> <span class="o">&lt;</span> <span class="n">Ic2</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">lc1</span> <span class="o">&gt;</span> <span class="n">Ic2</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»™å®š<code>CIStringCompare</code>ï¼Œè¦å»ºç«‹ä¸€ä¸ªå¿½ç•¥å¤§å°å†™çš„set<string>å°±å¾ˆç®€å•äº†:</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">CIStringCompare</span><span class="o">&gt;</span> <span class="n">ciss</span><span class="p">;</span> <span class="c1">// ciss = â€œcase-insensitive
</span></span></span><span class="line"><span class="cl"><span class="c1">// string setâ€
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæˆ‘ä»¬å‘è¿™ä¸ªsetä¸­æ’å…¥â€œ<code>Persephone</code>â€å’Œâ€œ<code>persephone</code>â€ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²åŠ å…¥äº†ï¼Œå› ä¸ºç¬¬äºŒä¸ªç­‰ä»·äºç¬¬ä¸€ä¸ªï¼š</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">ciss</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#34;Persephone&#34;</span><span class="p">);</span> <span class="c1">// ä¸€ä¸ªæ–°å…ƒç´ æ·»åŠ åˆ°setä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ciss</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#34;persephone&#34;</span><span class="p">);</span> <span class="c1">// æ²¡æœ‰æ–°å…ƒç´ æ·»åŠ åˆ°setä¸­
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæˆ‘ä»¬ç°åœ¨ä½¿ç”¨setçš„findæˆå‘˜å‡½æ•°æœç´¢å­—ç¬¦ä¸²â€œpersephoneâ€ï¼Œæœç´¢ä¼šæˆåŠŸï¼Œ</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">ciss</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#34;persephone&#34;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ciss</span><span class="p">.</span><span class="n">end</span><span class="p">())...</span> <span class="c1">// è¿™ä¸ªæµ‹è¯•ä¼šæˆåŠŸ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†å¦‚æœæˆ‘ä»¬ç”¨éæˆå‘˜çš„findç®—æ³•ï¼Œæœç´¢ä¼šå¤±è´¥ï¼š</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">find</span><span class="p">(</span><span class="n">ciss</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">ciss</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;persephone&#34;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ciss</span><span class="p">.</span><span class="n">end</span><span class="p">())...</span> <span class="c1">// è¿™ä¸ªæµ‹è¯•ä¼šå¤±è´¥
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£æ˜¯å› ä¸ºâ€œ<code>persephone</code>â€ç­‰ä»·äºâ€œ<code>Persephone</code>â€ï¼ˆå…³äºæ¯”è¾ƒä»¿å‡½æ•°CIStringCompareï¼‰ï¼Œä½†ä¸ç­‰äºå®ƒï¼ˆå› ä¸ºstring(&ldquo;persephone&rdquo;) != string(&ldquo;Persephone&rdquo;)ï¼‰ã€‚ä½ å¯èƒ½ä¼šå¥‡æ€ªä¸ºä»€ä¹ˆæ ‡å‡†å…³è”å®¹å™¨æ˜¯åŸºäºç­‰ä»·è€Œä¸æ˜¯ç›¸ç­‰ã€‚æ¯•ç«Ÿï¼Œå¤§å¤šæ•°ç¨‹åºå‘˜å¯¹ç›¸ç­‰æœ‰æ„Ÿè§‰è€Œç¼ºä¹ç­‰ä»·çš„æ„Ÿè§‰ã€‚</p>
<p><font color=red>æ ‡å‡†å…³è”å®¹å™¨ä¿æŒæœ‰åºï¼Œæ‰€ä»¥æ¯ä¸ªå®¹å™¨å¿…é¡»æœ‰ä¸€ä¸ªå®šä¹‰äº†æ€ä¹ˆä¿æŒä¸œè¥¿æœ‰åºçš„æ¯”è¾ƒå‡½æ•°ï¼ˆé»˜è®¤æ˜¯lessï¼‰ã€‚ç­‰ä»·æ˜¯æ ¹æ®è¿™ä¸ªæ¯”è¾ƒå‡½æ•°å®šä¹‰çš„ï¼Œæ‰€ä»¥æ ‡å‡†å…³è”å®¹å™¨çš„ç”¨æˆ·åªéœ€è¦ä¸ºä»–ä»¬è¦ä½¿ç”¨çš„ä»»æ„å®¹å™¨æŒ‡å®šä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼ˆå†³å®šæ’åºé¡ºåºçš„é‚£ä¸ªï¼‰ã€‚</p>
<p>å¦‚æœå…³è”å®¹å™¨ä½¿ç”¨ç›¸ç­‰æ¥å†³å®šä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æœ‰ç›¸åŒçš„å€¼ï¼Œé‚£ä¹ˆæ¯ä¸ªå…³è”å®¹å™¨å°±éœ€è¦ï¼Œé™¤äº†ç”¨äºæ’åºçš„æ¯”è¾ƒå‡½æ•°ï¼Œè¿˜éœ€è¦ä¸€ä¸ªç”¨äºåˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰çš„æ¯”è¾ƒå‡½æ•°ã€‚ï¼ˆé»˜è®¤çš„ï¼Œè¿™ä¸ªæ¯”è¾ƒå‡½æ•°å¤§æ¦‚åº”è¯¥æ˜¯equal_toï¼Œä½†æœ‰è¶£çš„æ˜¯equal_toä»æ²¡æœ‰åœ¨STLä¸­ç”¨åšé»˜è®¤æ¯”è¾ƒå‡½æ•°ã€‚å½“åœ¨STLä¸­éœ€è¦ç›¸ç­‰æ—¶ï¼Œä¹ æƒ¯æ˜¯ç®€å•åœ°ç›´æ¥è°ƒç”¨operator==ã€‚æ¯”å¦‚ï¼Œè¿™æ˜¯éæˆå‘˜findç®—æ³•æ‰€ä½œçš„ã€‚ï¼‰</font></p>
<p><strong><font color=blue>è¯´ç™½äº†ï¼Œå°±æ˜¯ç­‰ä»·æ˜¯ä¸ºå®¹å™¨æ’åºæœåŠ¡çš„ï¼Œå¦‚æœå®¹å™¨æƒ³è¦æ’å…¥å¤šä¸ªè½¬åŒ–ä¸ºå°å†™åç›¸ç­‰çš„å•è¯ï¼Œå®¹å™¨ä¼šåˆ¤å®šè¿™äº›å•è¯ç­‰ä»·ï¼Œè™½ç„¶å®ƒä»¬æœ¬èº«ä¸ç›¸ç­‰ï¼Œè¿™æ ·å°±èƒ½å¤Ÿå¾ˆå¥½åœ°ä¿æŒå®¹å™¨å†…å•è¯çš„å”¯ä¸€æ€§å’Œå•è¯çš„æœ‰åºæ€§ã€‚å¦åˆ™é€šè¿‡æŸ¥æ‰¾æˆ–æ’å…¥è¯¥å•è¯çš„æ—¶å€™ï¼Œå®¹å™¨å†…éƒ¨å°±ä¼šå‘ç”Ÿæ­§ä¹‰ï¼Œé€ æˆä¸ç¬¦åˆä½¿ç”¨è€…é€»è¾‘ã€‚</font></strong></p>
<p>è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç±»ä¼¼setçš„STLå®¹å™¨å«åš<code>set2CF</code>ï¼Œâ€œset with two comparison functionsâ€ã€‚<strong><font color=red>ç¬¬ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ç”¨æ¥å†³å®šsetçš„æ’åºé¡ºåºï¼Œç¬¬äºŒä¸ªç”¨æ¥å†³å®šæ˜¯å¦ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„å€¼ã€‚</font></strong> ç°åœ¨è€ƒè™‘è¿™set2CFï¼š</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">set2CF</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">CIStringCompare</span><span class="p">,</span> <span class="n">equal_to</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">s</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œså†…éƒ¨æ’åºå®ƒçš„å­—ç¬¦ä¸²æ—¶ä¸è€ƒè™‘å¤§å°å†™ï¼Œç­‰ä»·æ ‡å‡†ç›´è§‰ä¸Šæ˜¯è¿™æ ·ï¼šå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­ä¸€ä¸ªç­‰äºå¦ä¸€ä¸ªï¼Œé‚£ä¹ˆå®ƒä»¬æœ‰ç›¸åŒçš„å€¼ã€‚è®©æˆ‘ä»¬å‘sä¸­æ’å…¥å“ˆè¿ªæ–¯å¼ºå¨¶çš„æ–°å¨˜ï¼ˆPersephoneï¼‰çš„ä¸¤ä¸ªæ‹¼å†™:</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">s</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#34;Persephone&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#34;persephone&#34;</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å¦‚æœæˆ‘ä»¬è¯´<code>&quot;Persephone&quot; != &quot;persephone&quot;</code>ç„¶åä¸¤ä¸ªéƒ½æ’å…¥sï¼Œå®ƒä»¬åº”è¯¥æ˜¯ä»€ä¹ˆé¡ºåºï¼Ÿ</p>
</blockquote>
<p>è®°ä½æ’åºå‡½æ•°ä¸èƒ½åˆ†åˆ«å‘Šè¯‰å®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥ä»¥ä»»æ„é¡ºåºæ’å…¥ï¼Œå› æ­¤æ”¾å¼ƒä»¥ç¡®å®šçš„é¡ºåºéå†setå†…å®¹çš„èƒ½åŠ›å—ï¼Ÿï¼ˆä¸èƒ½ä»¥ç¡®å®šçš„é¡ºåºéå†å…³è”å®¹å™¨å…ƒç´ å·²ç»æŠ˜ç£¨ç€<code>multiset</code>å’Œ<code>multimap</code>äº†ï¼Œå› ä¸ºæ ‡å‡†æ²¡æœ‰è§„å®šç­‰ä»·çš„å€¼ï¼ˆå¯¹äºmultisetï¼‰æˆ–é”®ï¼ˆå¯¹äºmultimapï¼‰çš„ç›¸å¯¹é¡ºåºã€‚ï¼‰æˆ–è€…æˆ‘ä»¬åšæŒsçš„å†…å®¹çš„ä¸€ä¸ªç¡®å®šé¡ºåºå¹¶å¿½ç•¥ç¬¬äºŒæ¬¡æ’å…¥çš„å°è¯•ï¼ˆâ€œpersephoneâ€çš„é‚£ä¸ªï¼‰? å¦‚æœæˆ‘ä»¬é‚£ä¹ˆåšï¼Œè¿™é‡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#34;persephone&#34;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">s</span><span class="p">.</span><span class="n">end</span><span class="p">())...</span> <span class="c1">// è¿™ä¸ªæµ‹è¯•æˆåŠŸæˆ–å¤±è´¥ï¼Ÿ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¤§æ¦‚**<font color=red>findä½¿ç”¨äº†ç­‰ä»·æ£€æŸ¥</font>**ï¼Œä½†å¦‚æœæˆ‘ä»¬ä¸ºäº†ç»´æŠ¤sä¸­å…ƒç´ çš„ä¸€ä¸ªç¡®å®šé¡ºåºè€Œå¿½ç•¥äº†ç¬¬äºŒä¸ªinsertçš„è°ƒç”¨ï¼Œè¿™ä¸ªfindä¼šå¤±è´¥ï¼Œå³ä½¿â€œpersephoneâ€çš„æ’å…¥ç”±äºå®ƒæ˜¯ä¸€ä¸ªé‡å¤çš„å€¼çš„åŸåˆ™è€Œè¢«å¿½ç•¥ï¼</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>é€šè¿‡åªä½¿ç”¨ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°å¹¶ä½¿ç”¨ç­‰ä»·ä½œä¸ºä¸¤ä¸ªå€¼â€œç›¸ç­‰â€çš„æ„ä¹‰çš„ä»²è£è€…ï¼Œæ ‡å‡†å…³è”å®¹å™¨é¿å¼€äº†å¾ˆå¤šä¼šç”±å…è®¸ä¸¤ä¸ªæ¯”è¾ƒå‡½æ•°è€Œå¼•å‘çš„å›°éš¾ã€‚</p>
<p>ä¸€å¼€å§‹è¡Œä¸ºå¯èƒ½çœ‹èµ·æ¥æœ‰äº›å¥‡æ€ªï¼ˆç‰¹åˆ«æ˜¯å½“ä½ å‘ç°æˆå‘˜å’Œéæˆå‘˜findå¯èƒ½è¿”å›ä¸åŒç»“æœï¼‰ï¼Œä½†æœ€åï¼Œå®ƒé¿å…äº†ä¼šç”±åœ¨æ ‡å‡†å…³è”å®¹å™¨ä¸­æ··ç”¨ç›¸ç­‰å’Œç­‰ä»·é€ æˆçš„æ··ä¹±ã€‚</p>
]]></description></item></channel></rss>