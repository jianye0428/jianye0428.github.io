<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>CMake 笔记 | [9] 设置语言标准 (三) - yejian's blog</title><meta name=author content="Jian YE">
<meta name=author-link content="https://github.com/jianye0428"><meta name=description content="四、C++ 20新增特性 4.1 新增关键字 concept(见下文) requires std::require 是一个constexpr 函数模板，用于在编译时检查某个表达式的真假值。如果表达式为真，则该函数返回一个无意义的类型 void_t；否则编译会失败，出现相应的错误信息 consteval 用来修饰函数时常量值的表达式，而且是强制性的。如果函数本身不是常量值的表达"><meta name=keywords content='CMake'><meta itemprop=name content="CMake 笔记 | [9] 设置语言标准 (三)"><meta itemprop=description content="四、C++ 20新增特性 4.1 新增关键字 concept(见下文) requires std::require 是一个constexpr 函数模板，用于在编译时检查某个表达式的真假值。如果表达式为真，则该函数返回一个无意义的类型 void_t；否则编译会失败，出现相应的错误信息 consteval 用来修饰函数时常量值的表达式，而且是强制性的。如果函数本身不是常量值的表达"><meta itemprop=datePublished content="2024-01-17T09:06:53+08:00"><meta itemprop=dateModified content="2024-01-24T14:45:31+08:00"><meta itemprop=wordCount content="3712"><meta itemprop=image content="https://jianye0428.github.io/images/favicon/jian_icon.png"><meta itemprop=keywords content="CMake,"><meta property="og:title" content="CMake 笔记 | [9] 设置语言标准 (三)"><meta property="og:description" content="四、C++ 20新增特性 4.1 新增关键字 concept(见下文) requires std::require 是一个constexpr 函数模板，用于在编译时检查某个表达式的真假值。如果表达式为真，则该函数返回一个无意义的类型 void_t；否则编译会失败，出现相应的错误信息 consteval 用来修饰函数时常量值的表达式，而且是强制性的。如果函数本身不是常量值的表达"><meta property="og:type" content="article"><meta property="og:url" content="https://jianye0428.github.io/posts/cmake_note_9/"><meta property="og:image" content="https://jianye0428.github.io/images/favicon/jian_icon.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-17T09:06:53+08:00"><meta property="article:modified_time" content="2024-01-24T14:45:31+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jianye0428.github.io/images/favicon/jian_icon.png"><meta name=twitter:title content="CMake 笔记 | [9] 设置语言标准 (三)"><meta name=twitter:description content="四、C++ 20新增特性 4.1 新增关键字 concept(见下文) requires std::require 是一个constexpr 函数模板，用于在编译时检查某个表达式的真假值。如果表达式为真，则该函数返回一个无意义的类型 void_t；否则编译会失败，出现相应的错误信息 consteval 用来修饰函数时常量值的表达式，而且是强制性的。如果函数本身不是常量值的表达"><meta name=application-name content="菠菜阿九时代峰峻啊；数量可根据；"><meta name=apple-mobile-web-app-title content="菠菜阿九时代峰峻啊；数量可根据；"><meta name=theme-color data-light=#ffffff data-dark=#252627 content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/png href=/jian_icon.png><link rel=icon type=image/png sizes=32x32 href=/jian_icon.png><link rel=icon type=image/png sizes=16x16 href=/jian_icon.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://jianye0428.github.io/posts/cmake_note_9/><link rel=prev href=https://jianye0428.github.io/posts/cmake_note_8/><link rel=next href=https://jianye0428.github.io/posts/google_benchmark_introduction/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"CMake 笔记 | [9] 设置语言标准 (三)","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/jianye0428.github.io\/posts\/cmake_note_9\/"},"image":["https:\/\/jianye0428.github.io\/images\/favicon\/jian_icon.png"],"genre":"posts","keywords":"CMake","wordcount":3712,"url":"https:\/\/jianye0428.github.io\/posts\/cmake_note_9\/","datePublished":"2024-01-17T09:06:53+08:00","dateModified":"2024-01-24T14:45:31+08:00","publisher":{"@type":"Organization","name":"Jian YE","logo":"https:\/\/jianye0428.github.io\/images\/favicon\/jian_icon.png"},"author":{"@type":"Person","name":"Jian YE"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=wide><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="yejian's blog"><img loading=lazy src=/images/favicon/jian_icon.png srcset="/images/favicon/jian_icon.png, /images/favicon/jian_icon.png 1.5x, /images/favicon/jian_icon.png 2x" sizes=auto data-title="yejian's blog" data-alt="yejian's blog" class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Jian's Blog</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 所有文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/guestbook/><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> 留言</a></li><li class="menu-item has-children"><a class=menu-link href=/about/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> 关于</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/projects/_index.zh-tw/ title=項目><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> 我的項目</a></li><li class=menu-item><a class=menu-link href=/projects/ title=项目><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> 我的项目</a></li></ul></li><li class=menu-item><a class=menu-link href=/pilot/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> 导航</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="yejian's blog"><img loading=lazy src=/images/favicon/jian_icon.png srcset="/images/favicon/jian_icon.png, /images/favicon/jian_icon.png 1.5x, /images/favicon/jian_icon.png 2x" sizes=auto data-title=/images/favicon/jian_icon.png data-alt=/images/favicon/jian_icon.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Jian's Blog</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 所有文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/guestbook/><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> 留言</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/about/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> 关于</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/projects/_index.zh-tw/ title=項目><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> 我的項目</a></li><li class=menu-item><a class=menu-link href=/projects/ title=项目><i class="fa-solid fa-laptop-code fa-fw fa-sm" aria-hidden=true></i> 我的项目</a></li></ul></li><li class=menu-item><a class=menu-link href=/pilot/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> 导航</a></li><li class="menu-item text-center"><a class=menu-link href=https://github.com/jianye0428/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class="container container-reverse"><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>CMake 笔记 | [9] 设置语言标准 (三)</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/jianye0428 title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src="https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp" srcset="https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp, https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp 1.5x, https://gravatar.loli.net/avatar/75a41975a5281767bf6bdba838de4238?s=32&amp;d=mp 2x" sizes=auto data-title="Jian YE" data-alt="Jian YE" class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;Jian YE</a></span>
<span class=post-category>收录于 <a href=/categories/c++/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> C++</a></span></div><div class=post-meta-line><span title="发布于 2024-01-17 09:06:53"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2024-01-17>2024-01-17</time></span>&nbsp;<span title="更新于 2024-01-24 14:45:31"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2024-01-24>2024-01-24</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 3712 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 8 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="CMake 笔记 | [9] 设置语言标准 (三)">
<i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#四c-20新增特性>四、C++ 20新增特性</a><ul><li><a href=#41-新增关键字>4.1 新增关键字</a></li><li><a href=#42-新增标识符>4.2 新增标识符</a></li><li><a href=#43-import头文件>4.3 import头文件</a></li><li><a href=#44-ranges>4.4 Ranges</a></li><li><a href=#45-协程>4.5 协程</a></li><li><a href=#46-concepts>4.6 Concepts</a></li><li><a href=#47-lambda表达式更新>4.7 Lambda表达式更新</a></li><li><a href=#48-常量表达式constexpr的更新>4.8 常量表达式(constexpr)的更新</a></li><li><a href=#49-原子智能指针>4.9 原子智能指针</a></li><li><a href=#410-自动合流joining可中断的线程>4.10 自动合流(Joining),可中断的线程</a></li><li><a href=#411-同步synchronization库>4.11 同步(Synchronization)库</a></li><li><a href=#412-stdatomic_ref>4.12 std::atomic_ref</a></li><li><a href=#413-其他更新>4.13 其他更新</a></li></ul></li></ul></nav></div></div><div class=content id=content data-end-flag=（完）><h2 id=四c-20新增特性>四、C++ 20新增特性</h2><h3 id=41-新增关键字>4.1 新增关键字</h3><ul><li>concept(见下文)</li><li>requires
<code>std::require</code> 是一个<code>constexpr</code> 函数模板，用于在编译时检查某个表达式的真假值。如果表达式为真，则该函数返回一个无意义的类型 <code>void_t</code>；否则编译会失败，出现相应的错误信息</li><li>consteval
用来修饰函数时常量值的表达式，而且是强制性的。如果函数本身不是常量值的表达式的话则会编译失败</li><li>co_await(协程相关)</li><li>co_return(协程相关)</li><li>co_yield(协程相关)</li><li>char8_t</li></ul><h3 id=42-新增标识符>4.2 新增标识符</h3><ul><li>import</li><li>module</li></ul><p><strong>模块</strong></p><p><strong>优点</strong></p><ul><li>没有头文件</li><li>声明实现仍然可分离, 但非必要</li><li>可以显式指定那些导出(类, 函数等)</li><li>不需要头文件重复引入宏 (include guards)</li><li>模块之间名称可以相同不会冲突</li><li>模块只处理一次, 编译更快 (头文件每次引入都需要处理)</li><li>预处理宏只在模块内有效</li><li>模块引入顺序无关紧要</li></ul><p><strong>创建模块</strong></p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// cppcon.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>export</span> <span class=n>module</span> <span class=n>cppcon</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>CppCon</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=nf>GetWelcomeHelper</span><span class=p>()</span> <span class=p>{</span>  <span class=k>return</span> <span class=s>&#34;Welcome to CppCon 2019!&#34;</span><span class=p>;</span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>export</span> <span class=k>auto</span> <span class=nf>GetWelcome</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>GetWelcomeHelper</span><span class=p>();}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><strong>引用模块</strong></p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// main.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>import</span> <span class=n>cppcon</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>CppCon</span><span class=o>::</span><span class=n>GetWelcome</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=43-import头文件>4.3 import头文件</h3><ul><li>import</li><li>隐式地将 iostream 转换为模块</li><li>加速构建, 因为 iostream 只会处理一次</li><li>和预编译头 (PCH) 具有相似的效果</li></ul><h3 id=44-ranges>4.4 Ranges</h3><p><code>Range</code> 代表一串元素, 或者一串元素中的一段，类似于<code>begin/end</code> 对。</p><p><strong>好处</strong></p><ul><li>简化语法和方便使用</li><li>防止 begin/end 不配对</li><li>使变换/过滤等串联操作成为可能</li></ul><p><strong>相关功能</strong></p><ul><li>视图: 延迟计算, 不持有, 不改写</li><li>Actions: 即时处理, 改写</li><li>Algorithms: 所有接受 begin/end 对的算法都可用</li><li>Views 和 actions 使用管道符|串联</li></ul><h3 id=45-协程>4.5 协程</h3><p><strong>协程定义</strong>是一个函数，具备如下关键字之一:</p><ul><li>co_wait: 挂起协程, 等待其它计算完成</li><li>co_return: 从协程返回 (协程 return 禁止使用)</li><li>co_yield: 同 python yield, 弹出一个值, 挂起协程, 下一次调用继续协程的运行</li><li>for co_await 循环体</li></ul><p><strong>应用场景</strong></p><ul><li>简化generator</li><li>简化异步I/O</li><li>简化延迟计算</li><li>简化事件驱动的程序</li></ul><h3 id=46-concepts>4.6 Concepts</h3><ul><li>对模板类和函数的模板形参的约束</li><li>编译期断言</li><li>可声明多个</li></ul><p><strong>定义</strong></p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>concept</span> <span class=n>Incrementable</span> <span class=o>=</span> <span class=k>requires</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span><span class=n>x</span><span class=o>++</span><span class=p>;</span> <span class=o>++</span><span class=n>x</span><span class=p>;};</span></span></span></code></pre></td></tr></table></div></div><p><strong>使用</strong></p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=n>Incrementable</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>Foo</span><span class=p>(</span><span class=n>T</span> <span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>requires</span> <span class=n>Incrementable</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>Foo</span><span class=p>(</span><span class=n>T</span> <span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>Foo</span><span class=p>(</span><span class=n>T</span> <span class=n>t</span><span class=p>)</span> <span class=k>requires</span> <span class=n>Incrementable</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>Foo</span><span class=p>(</span><span class=n>Incrementable</span> <span class=k>auto</span> <span class=n>t</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><h3 id=47-lambda表达式更新>4.7 Lambda表达式更新</h3><p><strong>[=, this] 需要显式捕获this变量</strong></p><ul><li>C++20 之前 [=] 隐式捕获this</li><li>C++20 开始 需要显式捕获this: [=, this]</li></ul><p><strong>模板形式的 Lambda 表达式</strong></p><p>可以在<code>lambda</code>表达式中使用模板语法:</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=p>[]</span><span class=k>template</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span><span class=cm>/* ... */</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>[]</span><span class=k>template</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>T</span><span class=o>*</span> <span class=n>p</span><span class=p>)</span> <span class=p>{</span><span class=cm>/* ... */</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>[]</span><span class=k>template</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=kt>int</span> <span class=n>N</span><span class=o>&gt;</span><span class=p>(</span><span class=n>T</span> <span class=p>(</span><span class=o>&amp;</span><span class=n>a</span><span class=p>)[</span><span class=n>N</span><span class=p>])</span> <span class=p>{</span><span class=cm>/* ... */</span><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p><strong>优点</strong></p><p><code>C++20</code>之前: 获取 <code>vector</code> 元素类型, 需要这么写</p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>auto</span> <span class=n>func</span> <span class=o>=</span> <span class=p>[](</span><span class=k>auto</span> <span class=n>vec</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=n>T</span> <span class=o>=</span> <span class=k>typename</span> <span class=k>decltype</span><span class=p>(</span><span class=n>vec</span><span class=p>)</span><span class=o>::</span><span class=n>value_type</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><code>C++20</code> 可以:</p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>auto</span> <span class=n>func</span> <span class=o>=</span> <span class=p>[]</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>vec</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>方便获取通用<code>lambda</code>形参类型, 访问<code>静态函数</code>:</li></ul><p><mark>C++20之前：</mark></p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>auto</span> <span class=n>func</span> <span class=o>=</span> <span class=p>[](</span><span class=k>auto</span> <span class=k>const</span><span class=o>&amp;</span> <span class=n>x</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=n>T</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>decay_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span> <span class=n>copy</span> <span class=o>=</span> <span class=n>x</span><span class=p>;</span> <span class=n>T</span><span class=o>::</span><span class=n>static_function</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=n>Iterator</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>T</span><span class=o>::</span><span class=n>iterator</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><mark>C++20以后：</mark></p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>auto</span> <span class=n>func</span> <span class=o>=</span> <span class=p>[]</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>x</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span> <span class=n>copy</span> <span class=o>=</span> <span class=n>x</span><span class=p>;</span> <span class=n>T</span><span class=o>::</span><span class=n>static_function</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=n>Iterator</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>T</span><span class=o>::</span><span class=n>iterator</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>完美转发</li></ul><p><mark>C++20之前：</mark></p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>auto</span> <span class=n>func</span> <span class=o>=</span> <span class=p>[](</span><span class=k>auto</span><span class=o>&amp;&amp;</span> <span class=p>...</span><span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>foo</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>args</span><span class=p>)</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><mark>C++20以后：</mark></p><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>auto</span> <span class=n>func</span> <span class=o>=</span> <span class=p>[]</span><span class=o>&lt;</span><span class=k>typename</span> <span class=err>…</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span> <span class=err>…</span><span class=n>args</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>foo</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>Lambda 表达式捕获支持打包展开(Pack Expansion)</li></ul><p><mark>C++20之前：</mark></p><div class=highlight id=id-12><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>F</span><span class=p>,</span> <span class=k>class</span><span class=err>... </span><span class=nc>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>delay_invoke</span><span class=p>(</span><span class=n>F</span> <span class=n>f</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span> <span class=n>args</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>f</span><span class=p>,</span> <span class=n>args</span><span class=p>...]{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>args</span><span class=p>...);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><mark>C++20以后：</mark></p><div class=highlight id=id-13><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>F</span><span class=p>,</span> <span class=k>class</span><span class=err>... </span><span class=nc>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>delay_invoke</span><span class=p>(</span><span class=n>F</span> <span class=n>f</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span> <span class=n>args</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Pack Expansion:  args = std::move(args)...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>[</span><span class=n>f</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=n>args</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>args</span><span class=p>)...](){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>args</span><span class=p>...);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=48-常量表达式constexpr的更新>4.8 常量表达式(constexpr)的更新</h3><ul><li><code>constexpr</code> 虚函数</li><li><code>constexpr</code> 的虚函数可以重写非 <code>constexpr</code> 的虚函数</li><li>非 <code>constexpr</code> 虚函数可以重写 <code>constexpr</code> 的虚函数</li><li>使用 <code>dynamic_cast()</code> 和 <code>typeid</code></li><li>动态内存分配</li><li>更改<code>union</code>成员的值</li><li>包含 <code>try/catch</code></li><li>不允许<code>throw</code>语句</li><li>在触发常量求值的时候 <code>try/catch</code> 不发生作用</li><li>需要开启 <code>constexpr std::vector</code></li></ul><p><strong>constexpr string &amp;vector</strong></p><ul><li><code>std::string</code> 和 <code>std::vector</code> 类型现在可以作为 <code>constexpr</code></li><li>未来需要支持 <code>constexpr</code> 反射</li></ul><h3 id=49-原子智能指针>4.9 原子智能指针</h3><p><code>智能指针</code>(shared_ptr)<code>线程安全</code>问题：</p><ul><li>安全: 引用计数控制单元线程安全, 保证对象只被释放一次</li><li>不安全：对于数据的读写没有线程安全</li></ul><p>将<code>智能指针</code>变成<code>线程安全</code>：</p><ul><li>使用 <code>mutex</code> 控制智能指针的访问</li><li>使用全局非成员原子操作函数访问, 诸如: <code>std::atomic_load()</code>, <code>atomic_store()</code>, …</li></ul><p><code>C++20</code>: <code>atomic&lt;shared_ptr&lt;T>></code>, <code>atomic&lt;weak_ptr&lt;T>></code>：</p><ul><li>内部原理可能使用了<code>mutex</code></li><li>全局非成员原子操作函数标记为不推荐使用(<code>deprecated</code>)</li></ul><h3 id=410-自动合流joining可中断的线程>4.10 自动合流(Joining),可中断的线程</h3><p><strong>自动合流</strong></p><div class=highlight id=id-14><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kt>void</span> <span class=nf>DoWorkPreCpp20</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=kr>thread</span> <span class=n>job</span><span class=p>([]</span> <span class=p>{</span> <span class=cm>/* ... */</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ... Do something else ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(...)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>job</span><span class=p>.</span><span class=n>join</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span><span class=p>;</span> <span class=c1>// rethrow
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>job</span><span class=p>.</span><span class=n>join</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>DoWork</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>jthread</span> <span class=n>job</span><span class=p>([]</span> <span class=p>{</span> <span class=cm>/* ... */</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ... Do something else ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span> <span class=c1>// jthread destructor automatically calls join()
</span></span></span></code></pre></td></tr></table></div></div><p><strong>中断</strong></p><div class=highlight id=id-15><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>jthread</span> <span class=n>job</span><span class=p>([](</span><span class=n>std</span><span class=o>::</span><span class=n>stop_token</span> <span class=n>token</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=n>token</span><span class=p>.</span><span class=n>stop_requested</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>//... job.request_stop();
</span></span></span><span class=line><span class=cl><span class=c1>// auto source = job.get_stop_source()
</span></span></span><span class=line><span class=cl><span class=c1>// auto token = job.get_stop_token()
</span></span></span></code></pre></td></tr></table></div></div><h3 id=411-同步synchronization库>4.11 同步(Synchronization)库</h3><p>在传统的<code>多线程</code>（<code>进程</code>）的编程中，处理数据共享是一个重中之重。目前流行的多核（多CPU）编程中，虽然采用了更多的<code>分布式</code>的算法，但最终细分到一个处理单元中，仍然是处理线程间数据的拆分。即，通过<code>数据结构</code>的设计和<code>算法</code>的分拆，实现最小的数据冲突结果。</p><p>解决<code>多线程</code>编程中的一个重要的问题就是 <mark>如何处理数据的同步</mark>问题，如有<code>mutex</code>,<code>event</code>,<code>condition</code>等等。也有的会提到<code>c++11</code>后的<code>lock</code>等。</p><p>在<code>c++20</code>中增加了以下几类<code>同步</code> <code>数据结构</code>:</p><p><strong>信号量(Semaphore)</strong>
轻量级的同步原语，可以实现 <code>mutex</code>, <code>latches</code>, <code>barriers</code>, …等同步数据结构。</p><p>两种表现类型:</p><ul><li><code>多元信号量</code>(counting semaphore): 建模非负值资源计数</li><li><code>二元信号量</code>(binary semaphore): 只有两个状态的信号量</li></ul><p>主要方法有：</p><ul><li>release：增加内部计数器并对获取者解除阻塞</li><li>acquire ：减少内部计数器或阻塞到直至能获取</li><li>try_acquire：尝试减少内部计数器而不阻塞</li><li>try_acquire_for ：尝试减少内部计数器，至多阻塞一段时长</li><li>try_acquire_until：尝试减少内部计数器，阻塞直至一个时间点</li></ul><p><strong>std::atomic 等待和通知接口</strong></p><p><code>等待</code>/<code>阻塞</code>在原子对象直到其值发生改变, 然后通知函数发送通知，它比单纯的自旋锁和轮询要效率高。</p><p>主要方法有：</p><ul><li>wait：阻塞线程直至被提醒且原子值更改</li><li>notify_one：提醒至少一个在原子对象上的等待中阻塞的线程</li><li>notify_all：提醒所有在原子对象上的等待中阻塞的线程</li></ul><p>这个其实是实现<code>CAS</code>的，在以前就有，在<code>c++20</code>中又增加了相关的一些具体的实现罢了。</p><p><strong>锁存器(Latches)</strong></p><p><code>latch</code> 是 <code>std::ptrdiff_t</code> 类型的向下计数器，它能用于<code>同步线程</code>。在创建时初始化计数器的值。线程可能在 <code>latch</code> 上阻塞直至计数器减少到零。没有可能增加或重置计数器，这使得 <code>latch</code> 为单次使用的屏障。同时调用 <code>latch</code> 的成员函数，除了<code>析构函数</code>，不引入数据竞争。</p><p>注意：它区别于下面的<code>Barriers</code>的是它只有使用一次。</p><p><strong>屏障(Barriers)</strong></p><p><code>std::barrier</code> 提供允许至多为期待数量的线程阻塞直至期待数量的线程到达该屏障。不同于 <code>std::latch</code> ，屏障可重用：一旦到达的线程从屏障阶段的同步点除阻，则可重用同一屏障。</p><h3 id=412-stdatomic_ref>4.12 std::atomic_ref</h3><p><code>std::atomic_ref</code>类型对其引用的对象进行原子操作。</p><p>使用<code>std::atomic_ref</code> 进行多线程读写时不会造成数据争用。被引用对象的生命周期必须超过<code>std::atomic_ref</code> 。操作<code>std::atomic_ref</code> 的子对象是未定义行为。</p><h3 id=413-其他更新>4.13 其他更新</h3><p><strong>指定初始化(Designated Initializers)</strong></p><div class=highlight id=id-16><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Data</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>anInt</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>aString</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Data</span> <span class=n>d</span><span class=p>{</span> <span class=p>.</span><span class=n>aString</span> <span class=o>=</span> <span class=s>&#34;Hello&#34;</span> <span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p><strong>三路比较运算符 &lt;=></strong></p><div class=highlight id=id-17><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// 如果 a &lt; b 则为 true
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>(</span><span class=n>a</span> <span class=o>&lt;=&gt;</span> <span class=n>b</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1>// 如果 a &gt; b 则为 true
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>(</span><span class=n>a</span> <span class=o>&lt;=&gt;</span> <span class=n>b</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1>// 如果 a 与 b 相等或者等价 则为 true
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>(</span><span class=n>a</span> <span class=o>&lt;=&gt;</span> <span class=n>b</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span></span></span></code></pre></td></tr></table></div></div><p>标准库类型支持: <code>vector</code>, <code>string</code>, <code>map</code>, <code>set</code>, <code>sub_match</code>, …</p><p><strong>范围 for 循环语句支持初始化语句</strong></p><p><code>switch</code> 语句初始化 (<code>C++17</code>):</p><div class=highlight id=id-18><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Foo</span> <span class=nf>GetData</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Foo</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=k>auto</span> <span class=n>data</span> <span class=o>=</span> <span class=n>GetData</span><span class=p>();</span> <span class=n>data</span><span class=p>.</span><span class=n>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>data</span><span class=p>.</span><span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><code>if</code> 语句初始化 (<code>C++17</code>):</p><div class=highlight id=id-19><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>value</span><span class=p>;</span> <span class=kt>int</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Foo</span><span class=o>*</span> <span class=nf>GetData</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=n>Foo</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>auto</span> <span class=n>data</span> <span class=o>=</span> <span class=n>GetData</span><span class=p>();</span> <span class=n>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Use &#39;data’
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>现在范围 <code>for</code> 循环同样支持初始化 (<code>C++20</code>):</p><div class=highlight id=id-20><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>values</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Foo</span> <span class=nf>GetData</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Foo</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=n>data</span> <span class=o>=</span> <span class=n>GetData</span><span class=p>();</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=nl>value</span> <span class=p>:</span> <span class=n>data</span><span class=p>.</span><span class=n>values</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Use &#39;data’
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><strong>非类型模板形参支持字符串</strong></p><div class=highlight id=id-21><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>auto</span><span class=o>&amp;</span> <span class=n>s</span><span class=o>&gt;</span> <span class=kt>void</span> <span class=n>DoSomething</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>s</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DoSomething</span><span class=o>&lt;</span><span class=s>&#34;CppCon&#34;</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><strong>[[likely]], [[unlikely]]</strong></p><p><mark>先验概率指导编译器优化</mark></p><div class=highlight id=id-22><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>switch</span> <span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>1</span><span class=o>:</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>[[likely]]</span> <span class=k>case</span> <span class=mi>2</span><span class=o>:</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>[[unlikely]]</span> <span class=k>case</span> <span class=mi>3</span><span class=o>:</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><strong>日历(Calendar)和时区(Timezone)功能</strong></p><ul><li>增加日历和时区的支持</li><li>只支持公历(Gregorian calendar)</li><li>其他日历也可通过扩展加入, 并能和 进行交互</li></ul><p>具体操作和相关类型请参考其他示例。</p><p><strong>std::span</strong>
定义：某段连续数据的”视图”
特性：</p><ul><li>不持有数据, 不分配和销毁数据</li><li>拷贝非常快, 推荐复制的方式传参(类似 <code>string_view</code>)</li><li>不支持数据跨步(<code>stride</code>)</li><li>可通过运行期确定长度也可编译器确定长度</li></ul><div class=highlight id=id-23><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// fixed-size: 42 ints
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>data</span><span class=p>[</span><span class=mi>42</span><span class=p>];</span> <span class=n>span</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>42</span><span class=o>&gt;</span> <span class=n>a</span> <span class=p>{</span><span class=n>data</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>// dynamic-size: 42 ints
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>span</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>b</span> <span class=p>{</span><span class=n>data</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>// compilation error
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>span</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>50</span><span class=o>&gt;</span> <span class=n>c</span> <span class=p>{</span><span class=n>data</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>// dynamic-size: len ints
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>span</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>d</span><span class=p>{</span> <span class=n>ptr</span><span class=p>,</span> <span class=n>len</span> <span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p><strong>特性测试宏</strong>
通过它可以判断编译器是否支持某个功能。</p><p>语言特性：</p><ul><li><code>__has_cpp_attribute(fallthrough)</code></li><li><code>__cpp_binary_literals</code></li><li><code>__cpp_char8_t</code></li><li><code>__cpp_coroutines</code></li></ul><p>标准库特性:</p><ul><li><code>__cpp_lib_concepts</code></li><li><code>__cpp_lib_ranges</code></li><li><code>__cpp_lib_scoped_lock</code></li></ul><p>包含 <code>C++ 标准库</code>版本, <code>发布日期</code>, <code>版权证书</code>, <code>特性宏</code>等。</p><p><strong>consteval 函数</strong></p><ul><li><code>constexpr</code> 函数可能编译期执行, 也可以在运行期执行</li><li><code>consteval</code> 只能在编译器执行, 如果不满足要求编译不通过。</li></ul><p><strong>constinit: 强制指定以常量方式初始化</strong></p><div class=highlight id=id-24><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=nf>GetStringDyn</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;dynamic init&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=nf>GetString</span><span class=p>(</span><span class=kt>bool</span> <span class=n>constInit</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>constInit</span> <span class=o>?</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;constant init&#34;</span> <span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>GetStringDyn</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// ✔
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>constinit</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>a</span> <span class=o>=</span> <span class=n>GetString</span><span class=p>(</span><span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// ❌
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>constinit</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>b</span> <span class=o>=</span> <span class=n>GetString</span><span class=p>(</span><span class=nb>false</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p><strong>用 using 引用 enum 类型</strong></p><div class=highlight id=id-25><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>enum</span> <span class=k>class</span> <span class=nc>CardTypeSuit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Clubs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>Diamonds</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>Hearts</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>Spades</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string_view</span> <span class=n>GetString</span><span class=p>(</span><span class=k>const</span> <span class=n>CardTypeSuit</span> <span class=n>cardTypeSuit</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>cardTypeSuit</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>CardTypeSuit</span><span class=o>::</span><span class=nl>Clubs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;Clubs&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>CardTypeSuit</span><span class=o>::</span><span class=nl>Diamonds</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;Diamonds&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>CardTypeSuit</span><span class=o>::</span><span class=nl>Hearts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=k>return</span> <span class=s>&#34;Hearts&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>CardTypeSuit</span><span class=o>::</span><span class=nl>Spades</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=k>return</span> <span class=s>&#34;Spades&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string_view</span> <span class=n>GetString</span><span class=p>(</span><span class=k>const</span> <span class=n>CardTypeSuit</span> <span class=n>cardTypeSuit</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>cardTypeSuit</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>using</span> <span class=k>enum</span> <span class=nc>CardTypeSuit</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nl>Clubs</span><span class=p>:</span> <span class=k>return</span> <span class=s>&#34;Clubs&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nl>Diamonds</span><span class=p>:</span> <span class=k>return</span> <span class=s>&#34;Diamonds&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nl>Hearts</span><span class=p>:</span> <span class=k>return</span> <span class=s>&#34;Hearts&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nl>Spades</span><span class=p>:</span> <span class=k>return</span> <span class=s>&#34;Spades&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><strong>格式化库(std::format)</strong></p><div class=highlight id=id-26><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>format</span><span class=p>(</span><span class=s>&#34;Hello CppCon {}!&#34;</span><span class=p>,</span> <span class=mi>2019</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p><strong>增加数学常量</strong></p><p>包含 <code>e</code>, <code>log2e</code>, <code>log10e</code>, <code>pi</code>, <code>inv_pi</code>, <code>inv_sqrt</code> <code>ln2</code>, <code>ln10</code>, <code>sqrt2</code>, <code>sqrt3</code>, <code>inv_sqrt3</code>, <code>egamma</code></p><p><strong>std::source_location</strong></p><p>用于获取代码位置, 对于日志和错误信息尤其有用</p><p><strong>[[nodiscard(reason)]]</strong></p><p>表明返回值不可抛弃, 加入理由的支持</p><div class=highlight id=id-27><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=na>[[nodiscard(&#34;Ignoring the return value will result in memory leaks.&#34;)]]</span>
</span></span><span class=line><span class=cl><span class=kt>void</span><span class=o>*</span> <span class=n>GetData</span><span class=p>()</span> <span class=p>{</span> <span class=cm>/* ... */</span> <span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><strong>位运算</strong></p><p>加入循环移位, 计数<code>0</code>和<code>1</code>位等功能</p><p><strong>一些小更新</strong></p><ul><li>字符串支持 <code>starts_with</code>, <code>ends_with</code></li><li><code>map</code> 支持 <code>contains</code> 查询是否存在某个键</li><li><code>list</code> 和 <code>forward list</code> 的 <code>remove</code>, <code>remove_if</code> 和 <code>unique</code> 操作返回 <code>size_type</code> 表明删除个数</li><li>增加 <code>shift_left</code>, <code>shift_right</code></li><li><code>midpoint</code> 计算中位数, 可避免溢出</li><li><code>lerp</code> 线性插值 <code>lerp( float a, float b, float t )</code> 返回</li><li>新的向量化策略 <code>unsequenced_policy</code>(<code>execution::unseq</code>)</li></ul><div class=highlight id=id-28><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>str</span> <span class=o>=</span> <span class=s>&#34;Hello world!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// starts_with, ends_with
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>bool</span> <span class=n>b</span> <span class=o>=</span> <span class=n>str</span><span class=p>.</span><span class=n>starts_with</span><span class=p>(</span><span class=s>&#34;Hello&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>map</span> <span class=n>myMap</span><span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>pair</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=s>&#34;one&#34;</span><span class=n>s</span><span class=p>},</span> <span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=s>&#34;two&#34;</span><span class=n>s</span><span class=p>},</span> <span class=p>{</span><span class=mi>3</span><span class=p>,</span> <span class=s>&#34;three&#34;</span><span class=n>s</span><span class=p>}</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>// contains, 再也不用  .find() == .end() 了
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>bool</span> <span class=n>result</span> <span class=o>=</span> <span class=n>myMap</span><span class=p>.</span><span class=n>contains</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div></div><div class=post-reward><div class=comment>Buy me a coffee~</div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward>赞赏</label><div class=reward-ways data-mode=fixed><div><img loading=lazy src=/images/alipay.png srcset="/images/alipay.png, /images/alipay.png 1.5x, /images/alipay.png 2x" sizes=auto data-title="Jian YE 支付宝" data-alt="Jian YE 支付宝" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span data-animation>支付宝</span></div><div><img loading=lazy src=/images/wechatpay.png srcset="/images/wechatpay.png, /images/wechatpay.png 1.5x, /images/wechatpay.png 2x" sizes=auto data-title="Jian YE 微信" data-alt="Jian YE 微信" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span data-animation>微信</span></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2024-01-24 14:45:31">更新于 2024-01-24&nbsp;<a class=git-hash href=https://github.com/jianye0428/JianBlog/commit/c9dbd4ba82ac124a2a961ec4720f8515085ac8d6 rel="external nofollow noopener noreferrer" target=_blank title="commit by yejian(18817571704@163.com) c9dbd4ba82ac124a2a961ec4720f8515085ac8d6: feat: add cmake 8 & 9"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>c9dbd4b</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/cmake_note_9/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span><span><a href=https://github.com/jianye0428/JianBlog/edit/docs/content/posts/C++/CMAKE/Cmake_Learning_Notes/Cmake_Note_9/index.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://jianye0428.github.io/posts/cmake_note_9/ data-title="CMake 笔记 | [9] 设置语言标准 (三)" data-hashtags=CMake><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://jianye0428.github.io/posts/cmake_note_9/ data-hashtag=CMake><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Linkedin" data-sharer=linkedin data-url=https://jianye0428.github.io/posts/cmake_note_9/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://jianye0428.github.io/posts/cmake_note_9/ data-title="CMake 笔记 | [9] 设置语言标准 (三)"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 百度" data-sharer=baidu data-url=https://jianye0428.github.io/posts/cmake_note_9/ data-title="CMake 笔记 | [9] 设置语言标准 (三)"><i data-svg-src=/lib/simple-icons/icons/baidu.min.svg aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/cmake/ class=post-tag>CMake</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/cmake_note_8/ class=post-nav-item rel=prev title="CMake 笔记 | [8] 设置语言标准 (二)"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>CMake 笔记 | [8] 设置语言标准 (二)</a>
<a href=/posts/google_benchmark_introduction/ class=post-nav-item rel=next title="Google Benchmark 性能测试分析工具">Google Benchmark 性能测试分析工具<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.123.2">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2018 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/jianye0428 target=_blank rel="external nofollow noopener noreferrer">Jian YE</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics order-first"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="ms-1 d-none">博客已运行</span><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div></div><a href=https://github.com/jianye0428/JianBlog title="在 GitHub 上查看程式碼，訂閱請點 Watch" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#000;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=/lib/cell-watermark/watermark.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:50},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{algoliaAppID:"MTJNHU0JVB",algoliaIndex:"index",algoliaSearchKey:"5486225134d99f43826da401ee9bad57",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},siteTime:"2018-05-28T20:01:01+08:00",twemoji:!0,watermark:{appendto:".wrapper>main",colspacing:30,content:'<img style="height: 0.85rem;" src="/images/favicon/jian_icon.png" alt="logo" /> jianye',enable:!0,fontfamily:"MMT_LRH,沐目体",fontsize:1.1,height:20,opacity:.0125,rotate:15,rowspacing:60,width:150}}</script><script src=/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script></body></html>