<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>Effective - æ ‡ç­¾ - yejian's blog</title><link>https://jianye0428.github.io/tags/effective/</link><description>Effective - æ ‡ç­¾ - yejian's blog</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>18817571704@163.com (Jian YE)</managingEditor><webMaster>18817571704@163.com (Jian YE)</webMaster><lastBuildDate>Mon, 31 Jul 2023 07:26:06 +0800</lastBuildDate><atom:link href="https://jianye0428.github.io/tags/effective/" rel="self" type="application/rss+xml"/><item><title>Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [4]</title><link>https://jianye0428.github.io/posts/partfour/</link><pubDate>Mon, 31 Jul 2023 07:26:06 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/partfour/</guid><description><![CDATA[<!-- <div class="details admonition quote">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-quote-right fa-fw" aria-hidden="true"></i>quote<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">note abstract info tip success question warning failure danger bug example quote</div>
    </div>
  </div> -->
<h1 id="å‰è¨€">å‰è¨€</h1>
<blockquote>
<p>Effective-C++æ€»ç»“ç³»åˆ—åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬äºŒéƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬3~4ç« ï¼Œå†…å®¹èŒƒå›´Rule13~25ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule13ç®€å†™ä¸ºR13ã€‚</p>
</blockquote>
<div class="details admonition Note">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Effective-C++ç³»åˆ—List<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partone/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/parttwo/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partthree/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partfour/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></div>
    </div>
  </div>
<p>ç”±äºåŸä¹¦åœ¨C++11ä¹‹å‰å†™æˆï¼Œæœ‰äº›ç°ä»£C++ç‰¹æ€§ä¸ä¼šæåŠï¼Œæ‰€ä»¥ä¼šæ ¹æ®æœ¬äºº<code>å¼€å‘ç»éªŒ</code>æ–°å¢ä¸€äº›ä¸ªäººæ„Ÿæ‚ŸğŸ‘‰<code>By the way</code>ç¯èŠ‚ã€‚</p>
<h2 id="ch7-æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹">CH7 æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹</h2>
<h3 id="r41-äº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€">R41 äº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€</h3>
<p>é¢å‘å¯¹è±¡ç¼–ç¨‹çš„é€šå¸¸åšæ³•ï¼š</p>
<ul>
<li><strong>æ˜¾å¼</strong>å®šä¹‰æ¥å£ï¼ˆå‚æ•°å’Œè¿”å›å€¼ç±»å‹éƒ½æ˜¯ç¡®å®šçš„ï¼Œå‡½æ•°ç­¾å å°±æ˜¯ç¡®å®šçš„ï¼‰</li>
<li>è™šå‡½æ•°å®ç°<strong>è¿è¡Œæ—¶å¤šæ€</strong></li>
</ul>
<p>é‚£ä¹ˆç¼–è¯‘æœŸå¤šæ€å‘¢ï¼Ÿåœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„ç­”æ¡ˆé€šå¸¸æ˜¯å‡½æ•°é‡è½½ã€‚</p>
<p>åœ¨Templates åŠæ³›å‹ç¼–ç¨‹ä¸­ï¼Œæ›´ä¸ºæ³¨é‡çš„æ˜¯<strong>éšå¼æ¥å£</strong>å’Œ<strong>ç¼–è¯‘æœŸå¤šæ€</strong>ï¼š</p>
<ul>
<li><code>éšå¼æ¥å£</code>:
Templateçš„æ¥å£å±äºéšå¼æ¥å£ï¼Œå› ä¸ºå®ƒç±»å‹ä¸ç¡®å®šï¼Œæ‰€ä»¥æ˜¯åŸºäºæœ‰æ•ˆè¡¨è¾¾å¼æ¥åŒºåˆ†ã€‚å†åŠ ä¸Šè¿ç®—ç¬¦é‡è½½ç­‰ç‰¹æ€§ï¼Œéšå¼æ¥å£çš„è‡ªç”±åº¦éå¸¸å¤§ã€‚</li>
<li><code>ç¼–è¯‘æœŸå¤šæ€</code>:
Templateçš„å¤šæ€æ˜¯é€šè¿‡Templateå…·ç°åŒ–å’Œå‡½æ•°é‡è½½å†³è®®å‘ç”Ÿäºç¼–è¯‘æœŸã€‚</li>
</ul>
<p>ä¸Šè¿°æè¿°çœ‹èµ·æ¥æœ‰ç‚¹æŠ½è±¡ï¼Œåˆ†æä¸‹æ–¹Templateå‡½æ•°ä»£ç ï¼š</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">doProcessing</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">w</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="n">w</span> <span class="o">!=</span> <span class="n">someNastyWidget</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>doProcessingå±äºéšå¼æ¥å£ï¼Œç±»å‹ä¸å®šï¼Œä¼ å…¥ä¸åŒç±»å‹Tï¼Œå°±å¾—åˆ°ä¸åŒçš„å‡½æ•°ã€‚</p>
<p>ç”±äº <code>æ“ä½œç¬¦é‡è½½(operator overloading)</code> çš„å­˜åœ¨ï¼Œéšå¼æ¥å£å¯¹ä¼ å…¥çš„ T ç±»å‹çš„è¦æ±‚æ¯”è¾ƒå®½æ¾ï¼Œåˆ—ä¸¾å¦‚ä¸‹ï¼š</p>
<ol>
<li>Tç±»å‹æˆ–å…¶çˆ¶ç±»å‹å…·æœ‰ size() æ¥å£ï¼Œsize() æ¥å£è¿”å›ç±»å‹Sä¸ºæ•´å‹æˆ–è€…Sç±»å‹æœ‰ <code>bool operator&gt;(int)</code> æ¥å£ï¼›</li>
<li>Tç±»å‹æœ‰ <code>bool operator != (const T&amp;)</code>æ¥å£ï¼›æˆ–Tç±»å‹å¯ä»¥éšå¼è½¬æ¢ä¸ºæŸSç±»å‹ï¼ŒSå¯ä»¥ä¸someNastyWidgetè¿›è¡Œ != æ¯”è¾ƒï¼Œæˆ–è€…å¹²è„†someNastyWidgetå°±æ˜¯Tç±»å‹ï¼›</li>
<li>ä¸Šè¿°1 ã€ 2 ç‚¹çš„æè¿°æ²¡æœ‰å°† <code>operator &amp;&amp;</code> è€ƒè™‘è¿›æ¥ï¼Œå¦åˆ™æƒ…å†µä¼šæ›´ä¸ºå¤æ‚ï¼Œè¿™é‡Œä¸èµ˜è¿°äº†ã€‚</li>
</ol>
<h3 id="r42-äº†è§£typenameçš„åŒé‡æ„ä¹‰">R42 äº†è§£typenameçš„åŒé‡æ„ä¹‰</h3>
<ul>
<li><code>typename</code> å’Œ <code>class</code> å…³é”®å­—åœ¨å£°æ˜ Template å‚æ•°çš„æ—¶å€™ï¼Œæ²¡æœ‰ä»»ä½•åŒºåˆ«
å¦‚ä¸‹ç¤ºä¾‹ï¼Œæ•ˆæœæ˜¯ä¸€è‡´çš„ï¼š</li>
</ul>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Widget</span> <span class="p">;</span> <span class="c1">//æ—©æœŸC++ä½¿ç”¨è¿™ä¸ªå£°æ˜Templateå‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Widget</span><span class="p">;</span> <span class="c1">//ç°åœ¨æ›´æ¨èç”¨è¿™ä¸ªï¼Œæš—ç¤ºå‚æ•°ä¸ä¸€å®šæ˜¯ä¸ªclassç±»å‹
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>ä½¿ç”¨å…³é”®å­— <code>typename</code> æ ‡è¯† <strong>åµŒå¥—ä»å±ç±»å‹åç§°</strong>
æ¨¡æ¿å†…çš„ä»å±ç±»å‹ï¼Œæ˜¯æŒ‡åœ¨æ¨¡æ¿å‡½æ•°/æ¨¡æ¿ç±»ä¸­ï¼Œéœ€è¦<strong>ä¾èµ–ä¼ å…¥çš„ template å‚æ•°é—´æ¥è¡¨ç¤º</strong>çš„ç±»å‹ï¼Œå¦‚æœå‘ˆåµŒå¥—çŠ¶ï¼Œå°±å«åµŒå¥—ä»å±åç§°/ç±»å‹ã€‚ å¦‚ä¸‹ç¤ºä¾‹çš„ <code>C::const_iterator</code> å°±æ˜¯åµŒå¥—ä»å±ç±»å‹ã€‚</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">C</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">printContainer2ndVal</span><span class="p">(</span><span class="k">const</span> <span class="n">C</span><span class="o">&amp;</span> <span class="n">container</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">container</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">typename</span> <span class="n">C</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">iter</span><span class="p">(</span><span class="n">container</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;this container&#39;s second value is: &#34;</span> <span class="o">&lt;&lt;</span> <span class="o">*++</span><span class="n">iter</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶ï¼Œtypename çš„ä½œç”¨å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ C::const_iterator æ˜¯ä¸ªç±»å‹ï¼Œå¦åˆ™ä¼šç¼–è¯‘æŠ¥é”™ã€‚æ­¤æ—¶å¯ä»¥ç”¨ class å…³é”®å­—æ›¿ä»£ï¼Œä½†æ˜¯ä¸å»ºè®®ã€‚</p>
<p>typename ä½¿ç”¨èŒƒå›´ä¸åªæ˜¯ template å‡½æ•°å†…éƒ¨ï¼Œä¹ŸåŒ…æ‹¬äº†å‡½æ•°å…¥å‚ ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">C</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">foo</span><span class="p">(</span><span class="k">const</span> <span class="n">C</span><span class="o">&amp;</span> <span class="n">container</span><span class="p">,</span>    <span class="c1">// ä¸å…è®¸ä½¿ç”¨ &#34;typename&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">typename</span> <span class="n">C</span><span class="o">::</span><span class="n">iterator</span> <span class="n">iter</span><span class="p">);</span> <span class="c1">// å¿…é¡»ä½¿ç”¨ &#34;typename&#34;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>âš ï¸ å…¶ä»–ç‰¹æ®Šæƒ…å†µï¼šä¸è¦åœ¨ åŸºç±»åˆ—è¡¨base class list æˆ– æˆå‘˜åˆå§‹åŒ–åˆ—member initialization list ä½¿ç”¨ typename</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Derived</span><span class="o">:</span> <span class="k">public</span> <span class="n">Base</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Nested</span><span class="p">{</span> <span class="c1">//åŸºç±»åˆ—è¡¨ä¸å…è®¸ä½¿ç”¨typename
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">explicit</span> <span class="n">Derived</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span><span class="o">:</span><span class="n">Base</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Nested</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="c1">// æˆå‘˜åˆå€¼åˆ—ä¹Ÿä¸å…è®¸typename
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">Base</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Nested</span> <span class="n">NestedType</span><span class="p">;</span><span class="c1">//ç»“åˆtypedefå®šä¹‰ï¼Œå¸¸è§„ç”¨æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">NestedType</span> <span class="n">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span><span class="c1">// å…¶ä»–æ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="r43-å­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°">R43 å­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°</h3>
<p><strong>æ¨¡æ¿åŒ–åŸºç±»</strong>ï¼šæŒ‡å®šä¹‰ template æ¨¡æ¿ç±»æ—¶ï¼Œç»§æ‰¿äºæŸåŸºç±» Base<T>ï¼Œè¿™ä¸ª Base<T> ç±»å°±æ˜¯æ¨¡æ¿åŒ–åŸºç±»ã€‚</p>
<p>ğŸ¤” é‚£ä¹ˆ Base<T> ç±»æœ‰å…³çš„å‡½æ•°ç­‰åç§°è¯¥å¦‚ä½•å¤„ç†ï¼Œåœ¨å­ç±»ä¸­ç›´æ¥ä½¿ç”¨å—ï¼Ÿè¿˜æ˜¯æœ‰æ³¨æ„äº‹é¡¹ï¼Ÿè¿™ï¼Œå°±æ˜¯æœ¬èŠ‚è¦è®¨è®ºçš„é—®é¢˜ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Company</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MsgSender</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">SendPlain</span><span class="p">(){</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;send plain</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">SendEncrypted</span><span class="p">(){</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;send encrypted</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>  <span class="c1">// åŸºç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Company</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoggingMsgSender</span><span class="o">:</span> <span class="k">public</span> <span class="n">MsgSender</span><span class="o">&lt;</span><span class="n">Company</span><span class="o">&gt;</span><span class="p">{</span><span class="c1">//å­ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">SendPlainMsg</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">SendPlain</span><span class="p">();</span><span class="c1">//  ==&gt; è¿™æ ·ç›´æ¥è°ƒç”¨æ˜¯ä¸è¡Œçš„ï¼Œæƒ³æƒ³ä¸ºä»€ä¹ˆï¼Ÿ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°æ³¨é‡Šä¸­é—®é¢˜çš„åŸå› ï¼šå› ä¸ºå½“å…¨ç‰¹åŒ–æ—¶å¯éšæ„å»é™¤ MsgSender å†…çš„å‡½æ•°ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨æ— æ³•ç¡®å®šåŸºç±»æ˜¯å¦ä»æœ‰ SendPlain è¿™ä¸ªæ–¹æ³•ã€‚æ‰€ä»¥ï¼Œç¼–è¯‘å™¨å¹²è„†<strong>æ‹’ç»åœ¨ç¼–è¯‘æ—¶</strong>å»æ¨¡æ¿åŒ–åŸºç±»ä¸­<strong>ä¸»åŠ¨å¯»æ‰¾</strong>ç»§æ‰¿è€Œæ¥çš„åç§°ã€‚</p>
<p>è§£å†³æ–¹æ³•æœ‰ä¸‰ä¸ªï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>this-&gt;</code> è°ƒç”¨SendPlain()ï¼Œå³å¯è½¬åŒ–ä¸ºè¿è¡Œæ—¶çš„é—®é¢˜ï¼Œæ¨èè¿™ä¸ªæ–¹æ³•ï¼›</li>
<li>ä½¿ç”¨ <code>using MsgSender::SendPlain;</code> è¿™æ ·çš„ using å£°æ˜å¼ï¼Œæˆ‘ä»¬åœ¨ Rule 33: é¿å…é®æ©ç”±ç»§æ‰¿å¾—æ¥çš„åç§° ä¸­ç”¨è¿‡è¿™ç§æ–¹æ³•ï¼Œæ˜¾å¼åœ°å‘Šè¯‰ç¼–è¯‘å™¨æ‰©å¤§åç§°æœç´¢èŒƒå›´ï¼Œå°è¯•å»åŸºç±»æ‰¾æ‰¾ï¼›</li>
<li>ä½¿ç”¨æ˜¾å¼è°ƒç”¨ï¼Œå³ <code>MsgSender::SendPlain();</code> ï¼Œä½†è¿™æ ·åšçš„åå¤„æ˜¯ç›´æ¥æ–­ç»äº† virtual å‡½æ•°çš„çµæ´»æ€§å’Œå¯èƒ½ï¼Œä¸å¤ªæ¨è</li>
</ol>
<h3 id="r44-å°†ä¸å‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates">R44 å°†ä¸å‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates</h3>
<p>é€šå¸¸ï¼Œåœ¨éæ¨¡æ¿ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹å‡ºé‡å¤çš„ä»£ç æˆ–è€…ç±»ï¼Œä¸€èˆ¬é‡‡ç”¨æŠ½å–å…¬å…±éƒ¨åˆ†ä¸ºå•ç‹¬å‡½æ•°ï¼Œæˆ–è€…é‡‡ç”¨ç±»çš„ç»§æ‰¿/èšåˆç­‰é¢å‘å¯¹è±¡è®¾è®¡æ–¹å¼ã€‚</p>
<p>ä½†æ˜¯ï¼Œ template æœ‰å…³çš„ä»£ç ï¼Œæœ‰æ—¶ä»£ç é‡å¤æ˜¯éšæ™¦çš„ã€‚ è¿™ä¸€èŠ‚æ˜¯ä¸ºäº†è§£å†³ template çš„ <code>ä»£ç è†¨èƒ€(code bloat)</code> é—®é¢˜ï¼Œä¸»è¦åŸåˆ™ä¸º <code>å…±æ€§ä¸å·®å¼‚æ€§åˆ†æ(commonality and variability analysis)</code> ã€‚</p>
<p>**æŸäº›ä¸æ°å½“çš„è®¾è®¡ï¼Œä¼šå¯¼è‡´æ— ç•çš„ä»£ç è†¨èƒ€ã€‚**å…ˆçœ‹ä¸‹æ–¹è¿™ä¸ªåé¢æ•™æï¼š</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">n</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SquareMatrix</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">invert</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;size is &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åº”ç”¨ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//ä¸‹é¢è¿™2å¥ï¼Œæ¨¡æ¿ç±»å®ä¾‹åŒ– 1 æ¬¡ã€‚ invertå‡½æ•°æœ‰ 1 ä»½å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">SquareMatrix</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">5</span><span class="o">&gt;</span> <span class="n">mat5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">SquareMatrix</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">5</span><span class="o">&gt;</span> <span class="n">mat5New</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æ¢æˆä¸‹é¢è¿™2å¥ï¼Œæ¨¡æ¿ç±»å®ä¾‹åŒ– 2 æ¬¡ã€‚invertå‡½æ•°æœ‰ 2 ä»½å®ç°(é—®é¢˜æš´éœ²)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">SquareMatrix</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">5</span><span class="o">&gt;</span> <span class="n">mat5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">SquareMatrix</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">10</span><span class="o">&gt;</span> <span class="n">mat10</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è†¨èƒ€åŸå› </strong>ï¼šåœ¨ç¼–è¯‘å™¨çœ‹æ¥ï¼ŒSquareMatrix&lt;int, 5&gt; å’Œ SquareMatrix&lt;int, 10&gt; æ˜¯2ä¸ª<strong>å®Œå…¨ä¸åŒçš„ C++ ç±»</strong>ï¼Œå®ä¾‹åŒ–äº†2æ¬¡ï¼Œç”Ÿæˆäº†è¿™2ä¸ªç±»ã€‚è¯•æƒ³ï¼Œå¦‚æœä»£ç ä¸­è¿˜éœ€è¦å…¶ä»– size çš„SquareMatrix ï¼Œéƒ½ä¼šå†ç”Ÿæˆä¸€ä¸ªæ–°ç±»ï¼Œé‚£ä¹ˆæœ€åäºŒè¿›åˆ¶æ–‡ä»¶å°±å¤šäº†è®¸å¤šé‡å¤çš„ç›®æ ‡ä»£ç ï¼Œä¹Ÿå°±æ˜¯è†¨èƒ€ã€‚</p>
<p>å¦‚æœèƒ½<strong>æŠ½ç¦»å‚æ•°ç›¸å…³ä»£ç </strong>ï¼Œåšåˆ°å°ºå¯¸æ— å…³ï¼Œä¾¿å¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><strong>è§£å†³æ€è·¯</strong>ï¼šæ–°å»ºä¸€ä¸ªåŸºç±» BaseMatrix ï¼Œå°†å°ºå¯¸å‚æ•°ä¼ å…¥ç»™åˆ°åŸºç±»ä½œä¸ºæˆå‘˜å˜é‡ä¿ç®¡ï¼Œå…·ä½“çš„æ•°æ®å¯ä»¥ç”¨æ•°ç»„æŒ‡é’ˆå½¢å¼æ‰˜ç®¡ã€‚ä¸è®ºæœ‰å¤šå°‘ä¸ªä¸å°ºå¯¸æœ‰å…³çš„æ´¾ç”Ÿç±»ï¼Œä¸€ä¸ª T ç±»å‹å°±<strong>åªæœ‰ä¸€ä¸ªåŸºç±»</strong>ï¼Œæ‰€ä»¥åŸºç±» <code>baseInvert</code> <strong>å‡½æ•°å®ç°åªæœ‰ä¸€ä»½</strong>ã€‚</p>
<p><mark>åŸºç±»å®ç°</mark>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseSqaureMatrix</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">BaseSqaureMatrix</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">n</span><span class="p">,</span><span class="n">T</span><span class="o">*</span> <span class="n">dataPtr</span><span class="p">)</span> <span class="o">:</span><span class="n">n_</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">dataPtr_</span><span class="p">(</span><span class="n">dataPtr</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">baseInvert</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;invert: pData = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">dataPtr_</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; , size = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">n_</span>  <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">SetDataPtr</span><span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">dataPtr</span><span class="p">)</span> <span class="p">{</span> <span class="n">dataPtr_</span> <span class="o">=</span> <span class="n">dataPtr</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">n_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">T</span><span class="o">*</span> <span class="n">dataPtr_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p><mark>ç›®æ ‡æ´¾ç”Ÿç±»</mark>å®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">n</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SquareMatrix</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseSqaureMatrix</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">SquareMatrix</span><span class="p">()</span> <span class="o">:</span><span class="n">BaseSqaureMatrix</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">data_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetDataPtr</span><span class="p">(</span><span class="n">data_</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">invert</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">baseInvert</span><span class="p">();</span> <span class="p">}</span><span class="c1">// å‚è€ƒRule43
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">data_</span> <span class="p">;</span><span class="c1">// RAIIç®¡ç†èµ„æº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€ç»ˆæ•ˆæœï¼šç›¸åŒ T ç±»å‹çš„templateå®ä¾‹ç±»(æ¯”å¦‚SquareMatrix&lt;float,5&gt;å’ŒSquareMatrix&lt;float,6&gt;)ï¼Œ<mark>å…±äº«å®ç°ç </mark>ï¼Œç¥›é™¤ä»£ç è†¨èƒ€ã€‚</p>
<h3 id="r45-è¿ç”¨æ¨¡æ¿æˆå‘˜å‡½æ•°æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹">R45 è¿ç”¨æ¨¡æ¿æˆå‘˜å‡½æ•°æ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹</h3>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Base *pBase = pDerived</code>; è¿™æ ·æ™®é€šç±»å‹è£¸æŒ‡é’ˆçš„éšå¼è½¬æ¢æ˜¯è¢« C++ æ‰€è®¤å¯çš„ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœæ¢æˆæ™ºèƒ½æŒ‡é’ˆæ¨¡æ¿ç±» SmartPtr<Base> å’Œ SmartPtr <Derived> å‘¢ï¼Œè¿˜èƒ½è¿™æ ·<strong>ä¸éœ€é¢å¤–é…ç½®</strong>å°±éšæ„è½¬æ¢å—ï¼Œç­”æ¡ˆæ˜¾ç„¶<strong>æ˜¯ä¸è¡Œ</strong>çš„ï¼ˆçºµç„¶ Base å’Œ Derived æ˜¯å…¼å®¹ç±»å‹ä¹Ÿä¸è¡Œï¼‰ã€‚</p>
<p>æœ¬èŠ‚ï¼Œå°±é‡‡ç”¨<mark>æ¨¡æ¿æˆå‘˜å‡½æ•°</mark>æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p>
<ul>
<li><strong>ä½¿ç”¨æ¨¡æ¿æˆå‘˜å‡½æ•°ï¼Œæ¥å—æ‰€æœ‰å…¼å®¹ç±»å‹çš„â€œæ³›åŒ–æ„é€ â€/â€œæ³›åŒ–èµ‹å€¼â€</strong>
<code>æ³›åŒ–(generalized)Copyæ„é€ </code>ï¼Œæ˜¯æŒ‡æ¥å—å…¶ä»–å…¼å®¹ç±»å‹è¿›è¡Œæ¨¡æ¿å‡½æ•°çš„Copyæ„é€ ã€‚ä¸¾ä¾‹ä¸€ä¸ªç²—ç³™çš„ RAII æ™ºèƒ½æŒ‡é’ˆå®ç°ï¼Œä»£ç å¦‚ä¸‹ğŸ‘‡:
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SmartPtr</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">SmartPtr</span><span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">origPtr</span><span class="p">)</span> <span class="o">:</span><span class="n">originPtr_</span><span class="p">(</span><span class="n">origPtr</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="n">SmartPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">SmartPtr</span><span class="o">&amp;</span> <span class="n">smt</span><span class="p">)</span> <span class="o">:</span><span class="n">originPtr_</span><span class="p">(</span><span class="n">smt</span><span class="p">.</span><span class="n">get</span><span class="p">())</span> <span class="p">{}</span><span class="c1">// æ­£å¸¸Copyæ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//æ­£å¸¸copyæ“ä½œç¬¦å‡½æ•°: ç®€å•æ¼”ç¤ºï¼Œå°±æµ…å¤åˆ¶å§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">SmartPtr</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">SmartPtr</span><span class="o">&amp;</span> <span class="n">smt</span><span class="p">)</span> <span class="p">{</span> <span class="n">originPtr_</span> <span class="o">=</span> <span class="n">smt</span><span class="p">.</span><span class="n">get</span><span class="p">();</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">U</span><span class="o">&gt;</span> <span class="c1">//æ³›åŒ–æ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">SmartPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">SmartPtr</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&amp;</span> <span class="n">other</span><span class="p">)</span><span class="o">:</span><span class="n">originPtr_</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">get</span><span class="p">())</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">//ä¸ºäº†éšå¼è½¬æ¢ä¸åŠ  explict
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">U</span><span class="o">&gt;</span> <span class="c1">//æ³›åŒ–èµ‹å€¼æ“ä½œç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">SmartPtr</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">SmartPtr</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">originPtr_</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="c1">//ç®€å•æ¼”ç¤ºï¼Œæµ…å¤åˆ¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">T</span><span class="o">*</span> <span class="nf">get</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">originPtr_</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">~</span><span class="n">SmartPtr</span><span class="p">()</span> <span class="p">{</span> <span class="k">delete</span> <span class="n">originPtr_</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">T</span><span class="o">*</span> <span class="n">originPtr_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div>æœ‰ä¸Šè¿°çš„ä»£ç æ”¯æŒï¼Œæˆ‘ä»¬å°±èƒ½å†™å‡ºå¦‚ä¸‹çš„åº”ç”¨ä»£ç ï¼š
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseObj</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DerivedObj</span><span class="o">:</span><span class="k">public</span> <span class="n">BaseObj</span> <span class="p">{};</span><span class="c1">//DerivedObjæ˜¯BaseObjå…¼å®¹ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">SmartPtr</span><span class="o">&lt;</span><span class="n">DerivedObj</span><span class="o">&gt;</span> <span class="n">smDerived</span><span class="p">(</span><span class="k">new</span> <span class="n">DerivedObj</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="n">SmartPtr</span><span class="o">&lt;</span><span class="n">BaseObj</span><span class="o">&gt;</span> <span class="n">smBase</span><span class="p">(</span><span class="n">smDerived</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">SmartPtr</span><span class="o">&lt;</span><span class="n">BaseObj</span><span class="o">&gt;</span> <span class="n">smBase2</span> <span class="o">=</span> <span class="n">smDerived</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><strong>å³ä½¿æœ‰ â€œæ³›åŒ–æ„é€ / èµ‹å€¼â€ï¼Œä¹Ÿéœ€è¦æ­£å¸¸çš„ Copyæ„é€ /èµ‹å€¼</strong>
æ³¨æ„ï¼Œæ¨¡æ¿æˆå‘˜å‡½æ•°ä¸ä¼šæ”¹å˜è¯­è¨€è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´â€œæ³›åŒ–æ„é€ â€ä¸èƒ½ä»£æ›¿æ­£å¸¸çš„ copy æ„é€ å‡½æ•°ã€‚æ‰€ä»¥ï¼Œéœ€è¦åŒæ—¶å£°æ˜æ­£å¸¸çš„ Copy æ„é€ å‡½æ•°å’Œ Copy èµ‹å€¼æ“ä½œç¬¦å‡½æ•°ã€‚</li>
</ul>
<h3 id="r46-éœ€è¦ç±»å‹è½¬æ¢æ—¶è¯·ä¸ºæ¨¡æ¿å®šä¹‰éæˆå‘˜å‡½æ•°">R46 éœ€è¦ç±»å‹è½¬æ¢æ—¶è¯·ä¸ºæ¨¡æ¿å®šä¹‰éæˆå‘˜å‡½æ•°</h3>
<p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ› class æ”¯æŒç±»å‹è½¬æ¢ï¼Œç±»ä¼¼æœ¬ä¹¦çš„å¦å¤–ä¸€èŠ‚ğŸ‘‰ <a href="https://jianye0428.github.io/posts/parttwo/#r24-%E8%8B%A5%E6%89%80%E6%9C%89%E5%8F%82%E6%95%B0%E7%9A%86%E9%9C%80%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E8%AF%B7%E9%87%87%E7%94%A8non-member"target="_blank" rel="external nofollow noopener noreferrer">Rule24:è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢ï¼Œè¯·é‡‡ç”¨non-member<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a> ã€‚</p>
<p>å¦‚æœ Rule24 ä¸­çš„ Rational ç±»æ˜¯ template æ¨¡æ¿ç±»ï¼Œç›´æ¥ä»¿ç…§ Rule24 åˆ©ç”¨ non-member å‡½æ•°åšæ··åˆè¿ç®—æ˜¯è¡Œä¸é€šçš„ï¼ŒåŸå› æ˜¯ <strong>template å®å‚æ¨å¯¼</strong>æ˜¯ä¸é‡‡çº³ â€œé€šè¿‡æ„é€ å‡½æ•°è€Œå‘ç”Ÿçš„â€éšå¼ç±»å‹è½¬æ¢ã€‚</p>
<p>è§£å†³åŠæ³•å¦‚ä¸‹:</p>
<ul>
<li>
<p><strong>ä½¿ç”¨ â€œtemplate class å†…éƒ¨çš„friendå‡½æ•°â€ å®Œæˆå‚æ•°éšå¼è½¬æ¢</strong>
å°† Rule24 çš„ non-member çš„ <strong>operator *å‡½æ•°</strong>æ”¹ä¸º <code>inline-friend</code> å‡½æ•°ï¼Œå› ä¸º template å®ä¾‹åŒ–çš„æ—¶å€™éœ€è¦æ‰¾åˆ°è¯¥ friend å‡½æ•°çš„å®šä¹‰å®ç°ï¼Œç±»å¤–å®šä¹‰å®ç°æ˜¯ä¼šé“¾æ¥é”™è¯¯çš„ï¼Œæ‰€ä»¥éœ€è¦ inline ã€‚
å‚è€ƒä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RationalNew</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">RationalNew</span><span class="p">(</span><span class="n">T</span> <span class="n">numerator</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">T</span> <span class="n">denominator</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span><span class="n">numerator_</span><span class="p">(</span><span class="n">numerator</span><span class="p">),</span> <span class="n">denominator_</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">T</span> <span class="nf">numerator</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">numerator_</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">T</span> <span class="nf">denominator</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">denominator_</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">friend</span> <span class="k">const</span> <span class="n">RationalNew</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">RationalNew</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">RationalNew</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">RationalNew</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">numerator</span><span class="p">()</span><span class="o">*</span><span class="n">rhs</span><span class="p">.</span><span class="n">numerator</span><span class="p">(),</span><span class="n">lhs</span><span class="p">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">*</span><span class="n">rhs</span><span class="p">.</span><span class="n">denominator</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">T</span> <span class="n">numerator_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">T</span> <span class="n">denominator_</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆï¼Œå¯¹å¦‚ä¸‹çš„åº”ç”¨ä»£ç ï¼Œå°±ä½¿ç”¨è‡ªå¦‚äº†ï¼š</p>
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">RationalNew</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">oneHalf</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">RationalNew</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">res</span> <span class="o">=</span> <span class="n">oneHalf</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">RationalNew</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">res2</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">oneHalf</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>è‹¥inline-friendå‡½æ•°ä½“å¤ªå¤§ï¼Œå¯ä»¥æŠ½ç¦»å‡ºç±»å¤–è¾…åŠ©å‡½æ•°ä¾›inlineè°ƒç”¨</strong>
ä¸Šè¿°çš„ operator* å‡½æ•°ä½“åªæœ‰ä¸€è¡Œï¼Œå®ç°ç®€å•ï¼Œä½†å¦‚æœå®ç°è¿‡ç¨‹å¤æ‚ä»£ç é‡å¤§ï¼Œè€ƒè™‘ inline å¸¦æ¥çš„å†²å‡»ä»¥åŠä»£ç å¯è¯»æ€§ï¼Œå¯ä»¥æŠ½å–ä¸ªå‡½æ•°å‡ºæ¥ä¾› inline-friend è°ƒç”¨ã€‚</p>
<p>ä¿®æ”¹æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RationalNew</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="c1">//  å…¶ä»–éƒ¨åˆ†ç•¥ã€‚æ³¨æ„ operator* å‡½æ•°ä½“å®ç°ï¼Œæ”¹ä¸ºè°ƒç”¨doMultiply
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">friend</span> <span class="k">const</span> <span class="n">RationalNew</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">RationalNew</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">RationalNew</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">doMultiply</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span><span class="n">rhs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç±»å¤–å‡½æ•°  doMultiply
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">RationalNew</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">doMultiply</span><span class="p">(</span><span class="k">const</span> <span class="n">RationalNew</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">RationalNew</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">RationalNew</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">numerator</span><span class="p">()</span><span class="o">*</span><span class="n">rhs</span><span class="p">.</span><span class="n">numerator</span><span class="p">(),</span> <span class="n">lhs</span><span class="p">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">*</span><span class="n">rhs</span><span class="p">.</span><span class="n">denominator</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="r47-è¯·ä½¿ç”¨traits-classesè¡¨ç°ç±»å‹ä¿¡æ¯">R47 è¯·ä½¿ç”¨traits classesè¡¨ç°ç±»å‹ä¿¡æ¯</h3>
<p>C++ ä¸­é€šå¸¸æŠŠ Traits ç§°ä¸º<strong>ç±»å‹èƒå–</strong>æŠ€æœ¯ï¼Œå³ï¼šåœ¨ template ç¼–ç¨‹ä¸­ï¼Œè·å–æ¨¡æ¿å‚æ•°çš„ç±»å‹ä¿¡æ¯ï¼Œå¹¶åœ¨ç¼–è¯‘é˜¶æ®µé’ˆå¯¹ä¸åŒçš„ç±»å‹å“åº”ä¸åŒçš„å¤„ç†ã€‚åŒæ—¶ï¼Œè¿™ä¸ªæŠ€æœ¯è¦æ±‚å¯¹C++<strong>å†…ç½®ç±»å‹built-in</strong> å’Œ <strong>ç”¨æˆ·è‡ªå®šä¹‰user-defined</strong> ç±»å‹çš„è¡¨ç°å¿…é¡»ä¸€æ ·å¥½ã€‚</p>
<p>æœ¬èŠ‚è®¨è®ºæ­¤è®®é¢˜ï¼Œå¹¶ä¸”ä»¥ä¸€ä¸ª C++ æ ‡å‡†çš„æ¨¡æ¿å‡½æ•°ä½œä¸ºåˆ‡å…¥å£è¿›è¡Œè®¨è®º(std::advanceï¼Œä½œç”¨æ˜¯å…¼å®¹ä¸åŒç±»å‹è¿­ä»£å™¨ï¼Œç”¨äºåç»­å–ç”¨æŒ‡å®šåç§»é‡çš„å…ƒç´  )ã€‚</p>
<p>ä¸‹æ–¹ â€œBy the wayâ€ ç¯èŠ‚ç®€å•å±•ç¤ºäº† std::advance æ ‡å‡†C++çš„å£°æ˜å¼å’ŒåŸºæœ¬ç”¨æ³•ï¼š ğŸ‘‡ï¼ˆå•å‡»å±•å¼€ï¼‰</p>
<p><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>std::advance éœ€è¦çš„å¤´æ–‡ä»¶åŒ…å«ä¸º <code>#include&lt;iterator&gt;</code> ï¼Œå†çœ‹ä¸‹å®ƒçš„å‡½æ•°åŸå‹å£°æ˜ï¼š</p>
<div class="highlight" id="id-35"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">class</span> <span class="nc">InputIt</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Distance</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">advance</span><span class="p">(</span> <span class="n">InputIt</span><span class="o">&amp;</span> <span class="n">it</span><span class="p">,</span> <span class="n">Distance</span> <span class="n">n</span> <span class="p">);</span>       <span class="c1">// C++17 ä¹‹å‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">class</span> <span class="nc">InputIt</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Distance</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="kt">void</span> <span class="n">advance</span><span class="p">(</span> <span class="n">InputIt</span><span class="o">&amp;</span> <span class="n">it</span><span class="p">,</span> <span class="n">Distance</span> <span class="n">n</span> <span class="p">);</span> <span class="c1">// è‡ªC++17 å¼€å§‹
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å†çœ‹ä¸‹ç¤ºä¾‹åº”ç”¨ä»£ç ï¼š</p>
<div class="highlight" id="id-36"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">nums</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">vIter</span> <span class="o">=</span> <span class="n">nums</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">advance</span><span class="p">(</span><span class="n">vIter</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;after advance  3 offset: *vIter = &#34;</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">vIter</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">fNums</span><span class="p">{</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.6</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">dIter</span> <span class="o">=</span> <span class="n">fNums</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">advance</span><span class="p">(</span><span class="n">dIter</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;after advance -2 offset: *dIter = &#34;</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">dIter</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">chList</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">cIter</span> <span class="o">=</span> <span class="n">chList</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">advance</span><span class="p">(</span><span class="n">cIter</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;after advance  2 offset: *cIter = &#34;</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="o">*</span><span class="n">cIter</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€ç»ˆè¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-37"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">after advance  <span class="m">3</span> offset: *vIter <span class="o">=</span> <span class="m">4</span>
</span></span><span class="line"><span class="cl">after advance -2 offset: *dIter <span class="o">=</span> 0.5
</span></span><span class="line"><span class="cl">after advance  <span class="m">2</span> offset: *cIter <span class="o">=</span> <span class="m">30</span></span></span></code></pre></td></tr></table>
</div>
</div></div>
    </div>
  </div>
èƒŒæ™¯çŸ¥è¯† ğŸ‘‰ STL è¿­ä»£å™¨æŒ‰ç…§åŠŸèƒ½åˆ†ä¸º 5 ç±»ï¼Œå¦‚ä¸‹æ–¹è¡¨æ ¼æ‰€è¿°ï¼š</p>
<table>
<thead>
<tr>
<th>æè¿°</th>
<th>ç‰¹ç‚¹</th>
<th>åº”ç”¨</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>input è¿­ä»£å™¨</td>
<td>åªå‘å‰ç§»åŠ¨ï¼Œä¸€æ¬¡ä¸€æ­¥ï¼Œåªè¯»</td>
<td>istream_iterators</td>
<td></td>
</tr>
<tr>
<td>outputè¿­ä»£å™¨</td>
<td>åªå‘å‰ç§»åŠ¨ï¼Œä¸€æ¬¡ä¸€æ­¥ï¼Œåªå†™</td>
<td>ostream_iterators</td>
<td></td>
</tr>
<tr>
<td>forwardè¿­ä»£å™¨</td>
<td>åªå‘å‰ç§»åŠ¨ï¼Œä¸€æ¬¡ä¸€æ­¥ï¼Œå¯è¯»å†™</td>
<td>single-list iterator</td>
<td></td>
</tr>
<tr>
<td>Bidirectionalè¿­ä»£å™¨</td>
<td>åŒå‘ç§»åŠ¨ï¼Œä¸€æ¬¡ä¸€æ­¥ï¼Œå¯è¯»å†™</td>
<td>set/multiset/map/multimap</td>
<td></td>
</tr>
<tr>
<td>random-accessè¿­ä»£å™¨</td>
<td>åŒå‘ç§»åŠ¨ï¼Œä¸€æ¬¡å¤šæ­¥ï¼Œå¯è¯»å†™</td>
<td>vetor/deque/string</td>
<td></td>
</tr>
</tbody>
</table>
<p><mark>å¦‚ä½•è®¾è®¡ä¸€ä¸ª trait_class å¹¶è¿ç”¨èµ·æ¥å‘¢ï¼Ÿ</mark></p>
<ul>
<li><strong>Step1ï¼š ç¡®è®¤è‹¥å¹²ä¸ªå¸Œæœ›è·å–çš„ç±»å‹ä¿¡æ¯</strong> (æœ¬ä¾‹åªæœ‰ä¸€ä¸ª iterator ç±»åˆ«ä¿¡æ¯)
é’ˆå¯¹5 ç§è¿­ä»£å™¨åˆ†ç±»ï¼ŒC++ æä¾›äº†ä¸“å±çš„ <strong>å·æ ‡ç»“æ„tag struct</strong> åŠ ä»¥åŒºåˆ†(å¯ä»¥ç†è§£ä¸ºç¼–è¯‘æœŸçš„æšä¸¾ä½œç”¨)ï¼Œç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š
<div class="highlight" id="id-16"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">input_iterator_tag</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">output_iterato_tag</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">forward_iterator_tag</span><span class="o">:</span><span class="k">public</span> <span class="n">input_iterator_tag</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">bidirectional_iterator_tag</span><span class="o">:</span> <span class="k">public</span> <span class="n">forward_iterator_tag</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">random_access_iterator_tag</span><span class="o">:</span> <span class="k">public</span> <span class="n">bidirectional_iterator_tag</span><span class="p">{};</span><span class="err">`</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><strong>Step2ï¼šä¸ºè¯¥ä¿¡æ¯é€‰ä¸€ä¸ªåç§°</strong> (ä¾‹å¦‚ iterator_category)
é‚£ä¹ˆ vectorï¼Œsetä¹‹ç±»çš„<strong>ç›®æ ‡å®¹å™¨ç±»</strong>ï¼Œå¦‚ä½•ä¸ä¸Šè¿° iterator_tag <strong>è”ç³»èµ·æ¥</strong>å‘¢ï¼Œéœ€è¦ä¸€ä¸ªåç§°ä¼ é€’å‡ºå»ï¼š
<div class="highlight" id="id-17"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="p">...</span> <span class="o">&gt;</span> <span class="c1">//çœç•¥template å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">vector</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">iterator</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span><span class="o">:</span>   <span class="c1">// ps: C++11 ä¹‹åä½¿ç”¨çš„éƒ½æ˜¯ using å®šä¹‰å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">typedef</span> <span class="n">random_access_iterator_tag</span> <span class="n">iterator_category</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><strong>Step3ï¼šæä¾›ä¸€ä¸ª template ç±»å’Œä¸€ç»„ç‰¹åŒ–ç‰ˆæœ¬</strong>ï¼ˆç‰¹åŒ–ç‰ˆæœ¬æ”¯æŒæŸäº›ç‰¹æ®Šæƒ…å†µï¼‰
<code>Traits æŠ€æœ¯</code>é’ˆå¯¹äºè¿­ä»£å™¨çš„å…³é”®æ¨¡æ¿ç±» iterator_traits å®šä¹‰å¦‚ä¸‹ï¼š
<div class="highlight" id="id-18"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">IterT</span><span class="o">&gt;</span>  <span class="c1">//  æ³¨æ„ï¼šä½¿ç”¨çš„æ˜¯ struct
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">iterator_traits</span> <span class="p">{</span> <span class="c1">//è¿™é‡Œçš„ IterT å°±å¯ä»¥ä¼ å…¥vectorç­‰å®¹å™¨ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">typedef</span> <span class="k">typename</span> <span class="n">IterT</span><span class="o">::</span><span class="n">iterator_category</span>  <span class="n">iterator_category</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>æ³¨æ„ï¼Œè¿™é‡Œçš„ IterT ç±»å‹ä¸èƒ½æ˜¯æŒ‡é’ˆç±»å‹ï¼Œå› ä¸º pointer ä¸èƒ½åç»­åµŒå¥—ã€‚é‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªç‰¹åŒ–ç‰ˆæœ¬äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š
<div class="highlight" id="id-19"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">IterT</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">iterator_traits</span><span class="o">&lt;</span><span class="n">IterT</span><span class="o">*&gt;</span><span class="p">{</span> <span class="c1">// æŒ‡é’ˆç±»å‹å’Œ random è¿­ä»£å™¨ç±»ä¼¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">typedef</span> <span class="n">random_access_iterator_tag</span> <span class="n">iterator_category</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>è‡³æ­¤ï¼Œiterator_traits çš„åŸºæœ¬å®ç°å°±å®Œæˆäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>iterator_traits&lt;IterT&gt;::iterator_category</code> å¯ä»¥åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œæ¥ä¸‹æ¥çœ‹çœ‹advance å‡½æ•°å¦‚ä½•ä½¿ç”¨å®ƒã€‚</p>
<p>ğŸ’— æ­£ç¡®åšæ³•ï¼šåˆ©ç”¨ <strong>å‡½æ•°é‡è½½overloading</strong> æŠ€æœ¯ï¼Œä½¿å¾— <strong>trait classes åœ¨ç¼–è¯‘æœŸå¯¹ç±»å‹æ‰§è¡Œ if â€¦ else æµ‹è¯•</strong>ã€‚</p>
<p>å›é¡¾æˆ‘ä»¬çš„ advance å‡½æ•°ï¼Œåªæœ‰è¿­ä»£å™¨ç±»å‹ IterT å’Œ åç§»é‡ DistT ã€‚å¯ä»¥é‡è½½å…¶å­å‡½æ•° doAdvance ï¼Œå®Œæˆç±»å‹èƒå–åçš„è‡ªé€‚åº”ï¼š</p>
<div class="highlight" id="id-20"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">IterT</span><span class="p">,</span> <span class="k">typename</span> <span class="n">DistT</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">doAdvance</span><span class="p">(</span><span class="n">IterT</span><span class="o">&amp;</span> <span class="n">iter</span><span class="p">,</span> <span class="n">DistT</span> <span class="n">d</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">random_access_iterator_tag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">iter</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">IterT</span><span class="p">,</span> <span class="k">typename</span> <span class="n">DistT</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">doAdvance</span><span class="p">(</span><span class="n">IterT</span><span class="o">&amp;</span> <span class="n">iter</span><span class="p">,</span> <span class="n">DistT</span> <span class="n">d</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">bidirectional_iterator_tag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">while</span> <span class="p">(</span><span class="n">d</span><span class="o">--</span><span class="p">)</span> <span class="o">++</span><span class="n">iter</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="p">{</span> <span class="k">while</span> <span class="p">(</span><span class="n">d</span><span class="o">++</span><span class="p">)</span> <span class="o">--</span><span class="n">iter</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">IterT</span><span class="p">,</span> <span class="k">typename</span> <span class="n">DistT</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">doAdvance</span><span class="p">(</span><span class="n">IterT</span><span class="o">&amp;</span> <span class="n">iter</span><span class="p">,</span> <span class="n">DistT</span> <span class="n">d</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">input_iterator_tag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">out_of_range</span><span class="p">(</span><span class="s">&#34;Negative distance&#34;</span><span class="p">);}</span><span class="c1">//ps: msvcä¸­çš„C++å®ç°æ˜¯é‡‡ç”¨ç¼–è¯‘æœŸé—´çš„assetåˆ¤å®š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">while</span> <span class="p">(</span><span class="n">d</span><span class="o">--</span><span class="p">)</span> <span class="o">++</span><span class="n">iter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è‡ªç„¶åœ°ï¼Œadvance å‡½æ•°çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight" id="id-21"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">IterT</span><span class="p">,</span> <span class="k">typename</span> <span class="n">DistT</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span>  <span class="n">advance</span><span class="p">(</span><span class="n">IterT</span><span class="o">&amp;</span> <span class="n">iter</span><span class="p">,</span> <span class="n">DistT</span> <span class="n">d</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="n">doAdvance</span><span class="p">(</span><span class="n">iter</span><span class="p">,</span><span class="n">d</span><span class="p">,</span> <span class="cm">/*ä¸è®º category çš„tagç±»å‹æ˜¯ä»€ä¹ˆï¼Œé‡è½½èƒ½æ‰¾åˆ°åŒ¹é…å‡½æ•°ã€‚å³ç¼–è¯‘æœŸçš„ if...else æµ‹è¯•*/</span>
</span></span><span class="line"><span class="cl">              <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">IterT</span><span class="o">&gt;::</span><span class="n">iterator_category</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è‡³æ­¤ï¼Œä¸€ä¸ªå®Œæ•´çš„ (ä»¥ iterator_traits ä¸ºä¾‹)Traits æŠ€æœ¯å®ç°ä¸è¿ç”¨çš„è¿‡ç¨‹å°±å®Œæˆäº†ã€‚</p>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><ul>
<li>
<p>å…³äº iterator_traits ï¼Œä¸æ­¢æœ‰ iterator_categoryï¼Œè¿˜æœ‰ difference_type, value_type, pointer, reference ç­‰4ä¸ªæˆå‘˜ï¼Œ<a href="https://zh.cppreference.com/w/cpp/iterator/iterator_traits"target="_blank" rel="external nofollow noopener noreferrer">è¯¦ç»†å¯å‚è€ƒ cppå‚è€ƒæ‰‹å†Œï¼šiterator_traits<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a> ã€‚</p>
</li>
<li>
<p>C++ æ ‡å‡†åº“ä¸­ç±»ä¼¼ iterator_traits åº”ç”¨äº† Traits æŠ€æœ¯çš„æ¨¡æ¿æœ‰åå‡ ä¸ªã€‚</p>
<p>ä¸¾ä¾‹å¸¸ç”¨çš„æ•°å€¼ç±»å‹èƒå– <code>numeric_limits</code> ï¼Œéœ€è¦æ³¨æ„2ä¸ªç»†èŠ‚ï¼š</p>
<ol>
<li>å¤´æ–‡ä»¶æ˜¯ #include<limits>;</li>
<li>æˆå‘˜å‡½æ•° lowest/min/max æŒ‰ç…§é¡ºåºï¼Œåˆ†åˆ«ä»£è¡¨ç»™å®šç±»å‹çš„ æœ€ä½æœ‰é™å€¼ã€æœ€å°éè´Ÿå€¼ã€æœ€å¤§æœ‰é™å€¼ã€‚å°¤å…¶æ˜¯ float/doubleï¼Œå–æœ€å°å€¼æ˜¯ lowest() ï¼Œä¸æ˜¯ min().</li>
</ol>
</li>
</ul>
</div>
    </div>
  </div>
<h3 id="r48-è®¤è¯†templateæ¨¡æ¿å…ƒç¼–ç¨‹">R48 è®¤è¯†Templateæ¨¡æ¿å…ƒç¼–ç¨‹</h3>
<p><strong>TMPï¼Œæ¨¡æ¿å…ƒç¼–ç¨‹template metaprogramming</strong> ï¼Œæ˜¯ç¼–å†™ template-based C++ ç¨‹åºå¹¶æ‰§è¡Œäºç¼–è¯‘æœŸçš„è¿‡ç¨‹ã€‚TMP è¿‡ç¨‹ç»“æŸåï¼Œè‹¥å¹² C++ æºç ä¼šè¢« templates å…·ç°åŒ–å‡ºæ¥ï¼Œä¾¿ä¼šä¸€å¦‚å¾€å¸¸åœ°è¢«ç¼–è¯‘ã€‚</p>
<p>TMP æœ‰ 2 ä¸ªå¼ºå¤§çš„ä½œç”¨ï¼š</p>
<ol>
<li>å¯ä»¥å®Œæˆé TMP çš„å¸¸è§„ç¼–ç¨‹åšä¸åˆ°çš„äº‹æƒ…
æ¯”å¦‚ä»£ç ç”Ÿæˆï¼Œç±»å‹é€‚é…ç­‰ã€‚</li>
<li>å¯ä»¥å°†æŸäº›å·¥ä½œä»è¿è¡ŒæœŸè½¬ç§»åˆ°ç¼–è¯‘æœŸ
å¯ä»¥å°†è¿è¡ŒæœŸçš„é”™è¯¯æå‰æš´éœ²åœ¨ç¼–è¯‘æœŸï¼Œå¯ä»¥è·å¾—æ›´å°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ›´å¿«åœ°è¿è¡Œï¼Œæ›´å°‘åœ°å†…å­˜éœ€æ±‚ï¼Œç¼ºç‚¹æ˜¯æ˜æ˜¾å¢åŠ ç¼–è¯‘æ—¶é—´ã€‚</li>
</ol>
<p>TMP å·²è¢«è¯æ˜æ˜¯ä¸ªâ€œ<strong>å›¾çµå®Œå¤‡</strong>â€çš„æœºå™¨ï¼Œæ„æ€æ˜¯å®ƒå¼ºå¤§åˆ°å¯ä»¥è®¡ç®—ä»»ä½•äº‹ç‰©ã€‚ä½¿ç”¨ TMP å¯ä»¥å£°æ˜å˜é‡ã€æ‰§è¡Œå¾ªç¯ã€ç¼–å†™åŠè°ƒç”¨å‡½æ•°â€¦ç­‰ç­‰ã€‚</p>
<p>æ¯”è¾ƒç‰¹åˆ«çš„æ˜¯ï¼ŒTMP å®ç°ä¸Šè¿°å„ç±»åŠŸèƒ½çš„æ–¹å¼ä¸åŒäºå¸¸è§„ C++ ç¨‹åºã€‚æ¯”å¦‚ä¸Šä¸€èŠ‚ Rule47 ä¸­ä½¿ç”¨é‡è½½å®Œæˆäº†ç¼–è¯‘æœŸçš„ ifâ€¦else æ¡ä»¶åˆ†æ”¯ã€‚TMP å¾ªç¯åŠŸèƒ½ä¹Ÿé€šå¸¸ä¼šä½¿ç”¨ â€œ<strong>é€’å½’å…·ç°åŒ–</strong>â€ æ¥å®Œæˆçš„ã€‚</p>
<p>ä¸‹æ–¹ä»£ç ç¤ºèŒƒå¦‚ä½•ä½¿ç”¨ TMP çš„æ–¹å¼æ¥è®¡ç®—é˜¶ä¹˜ï¼š</p>
<div class="highlight" id="id-22"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="n">n</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Factorial</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>   <span class="c1">// é€’å½’çš„å½¢å¼ä½“ç°: f(n) = n * f(n -1)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">enum</span> <span class="p">{</span><span class="n">value</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span> <span class="n">Factorial</span><span class="o">&lt;</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Factorial</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>  <span class="c1">// æ¨¡æ¿å…¨ç‰¹åŒ–: å®é™…æ˜¯åˆå§‹åŒ– f(0) = 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">enum</span> <span class="p">{</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆé˜¶ä¹˜è®¡ç®—åœ¨ç¼–è¯‘æœŸå°±å®Œæˆäº†ï¼Œè¿è¡Œæ—¶å°±æ˜¯ç›´æ¥å–ç”¨äº†ï¼š</p>
<div class="highlight" id="id-23"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Factorial(&#34;</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;) = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">Factorial</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Factorial(&#34;</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;) = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">Factorial</span><span class="o">&lt;</span><span class="mi">7</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ch8-å®šåˆ¶newå’Œdelete">CH8 å®šåˆ¶newå’Œdelete</h2>
<h3 id="r49-äº†è§£new-handlerçš„è¡Œä¸º">R49 äº†è§£new-handlerçš„è¡Œä¸º</h3>
<p>å½“ <code>operator new</code> æ— æ³•æ»¡è¶³æŸä¸ªå†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œä¸€èˆ¬ä¼šæŠ›å‡º <code>std::bad_alloc</code> å¼‚å¸¸ã€‚</p>
<blockquote>
<p>å¦‚æœç”¨ std::nothrow ä¿®é¥° new æ“ä½œç¬¦ï¼Œä½¿å¾—å†…å­˜åˆ†é…é˜¶æ®µä¸ä¼šæŠ›å¼‚å¸¸ï¼Œå¤±è´¥äº†å°±è¿”å› null æŒ‡é’ˆã€‚ä¸¾ä¾‹ :</p>
<div class="highlight" id="id-24"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="n">pArr</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">nothrow</span><span class="p">)</span> <span class="kt">int</span><span class="p">[</span><span class="mh">0x1fffffff</span><span class="p">];</span> <span class="c1">//å³ä½¿åˆ†é…å¤±è´¥ï¼Œä¹Ÿä¸æŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯å¾—åˆ°nullæŒ‡é’ˆ.
</span></span></span><span class="line"><span class="cl"><span class="c1">//  nothroow-new ä¸èƒ½ä¿è¯ class åç»­çš„æ„é€ å‡½æ•°ä¸æŠ›å¼‚å¸¸
</span></span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<p>new-hanlder çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-25"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">OutOfMemTip</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;new memory fail,out of memory!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">abort</span><span class="p">();</span><span class="c1">//ç»ˆæ­¢ç¨‹åºï¼Œè‹¥è°ƒè¯•æ¨¡å¼ä¼šå¼¹çª—æç¤º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ•…æ„åˆ¶é€ newå¤±è´¥çš„æƒ…å½¢ï¼Œç¨‹åºä¼šè°ƒç”¨ OutOfMemTipï¼Œè§¦å‘std::abort()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">set_new_handler</span><span class="p">(</span><span class="n">OutOfMemTip</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="n">pArr</span> <span class="o">=</span>  <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mh">0x1fffffff</span><span class="p">];</span><span class="c1">//çº¦2GB,å¦‚æœæ‰›çš„ä½ï¼Œè°ƒå¤§è¿™ä¸ªæ•°
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹å‡ºè¿™æ ·çš„å‡½æ•°æŒ‡é’ˆç»™äº†ä½¿ç”¨è€…éå¸¸å¤§çš„è®¾è®¡å¼¹æ€§ï¼Œå¯ä»¥åšåˆ°ä»¥ä¸‹äº‹æƒ…ï¼š</p>
<ul>
<li>æå‰ç”³è¯·å†…å­˜ï¼Œè®© new_handler è§¦å‘ä¸‹ä¸€æ¬¡åˆ†é…ä½¿ç”¨ï¼›</li>
<li>å®‰è£…å¦ä¸€ä¸ª new_handler ï¼Œæˆ–è®¸æ–°çš„ handler å¯ä»¥ç”³è¯·åˆ°å†…å­˜ï¼›</li>
<li>å¸è½½ new_handler ï¼Œåªè¦ä¼  null æŒ‡é’ˆå³å¯ï¼›</li>
<li>æ‰‹åŠ¨æŠ› std::bad_alloc çš„å¼‚å¸¸ï¼›</li>
<li>ä¸è¿”å›ï¼Œé€šå¸¸è°ƒç”¨ std::abort() æˆ– std::exit() ;</li>
</ul>
<p>ğŸ¤” æˆ‘ä»¬æ€è€ƒå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šæ˜¯å¦å¯ä»¥ è®©ä¸åŒçš„ <strong>C++ ç±»æ‹¥æœ‰è‡ªå·±çš„ new-handler</strong> å‘¢ï¼Ÿ C++ æ ‡å‡†æœºåˆ¶æ˜¯ä¸æ”¯æŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°ã€‚æœ‰ä¸¤ä¸ªå®ç°é€”å¾„ï¼Œåˆ—ä¸¾å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>é’ˆå¯¹æŸä¸ªç‰¹å®šç±» ï¼Œç±»å†…é‡è½½ static ç±»å‹çš„ <code>operator new</code> ä»¥åŠ <code>set_new_handler</code>æ–¹æ³•</strong>
å…·ä½“å®ç°ç•¥ï¼Œåªæƒ³æŒ‡å‡ºè¿™æ ·åšæ³•æœ‰ä¸ªæ˜æ˜¾å¼Šç«¯ï¼Œå°±æ˜¯æ¯ä¸ªç±»éƒ½å¾—è¿™ä¹ˆåšï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œä¹Ÿå®¹æ˜“ä»£ç å†—ä½™ã€‚</li>
<li><strong>ä½¿ç”¨ CRTP æ–¹æ³•ï¼ˆå³ <code>æ€ªå¼‚çš„å¾ªç¯æ¨¡æ¿æ¨¡å¼curiously recurring template pattern</code> ï¼‰å°†ä¸Šè¿°æ–¹æ³• 1 å¡è¿› template ç±»</strong>
è¿™æ ·åšçš„å¥½å¤„æ˜¯ä½¿ç”¨æ¨¡æ¿ç±»èµ‹äºˆä¸Šè¿° operator new å’Œ set_new_hanler çš„æ“ä½œï¼Œä½¿ç”¨èµ·æ¥æ–¹ä¾¿ã€‚
CRTP æ–¹æ³•ä¸­çš„åŸºç±» NewHandlerSupport å®ç°å¦‚ä¸‹ ğŸ‘‡(ç‚¹å‡»æ‰“å¼€æŠ˜å ) ï¼š</li>
</ol>
<div class="highlight" id="id-26"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NewHandlerSupport</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">new_handler</span> <span class="n">set_new_handler</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">new_handler</span> <span class="n">p</span><span class="p">)</span><span class="k">noexcept</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">new_handler</span> <span class="n">oldHandler</span> <span class="o">=</span> <span class="n">currentHandler_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">currentHandler_</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">oldHandler</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="kt">void</span><span class="o">*</span> <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="k">throw</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bad_alloc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">new_handler</span> <span class="n">oldHandle</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">set_new_handler</span><span class="p">(</span><span class="n">currentHandler_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span> <span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="o">::</span><span class="k">operator</span> <span class="k">new</span><span class="p">(</span><span class="n">size</span><span class="p">);</span> <span class="c1">//newå®Œåå¤åŸglobal-new-handler
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">set_new_handler</span><span class="p">(</span><span class="n">oldHandle</span><span class="p">);</span><span class="c1">//åŸä¹¦ä½¿ç”¨RAIIæ‰‹æ³•åœ¨è¿˜åŸè¿™ä¸ªhandlerï¼Œè¿™é‡Œä½œç”¨ç±»ä¼¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">new_handler</span> <span class="n">currentHandler_</span><span class="p">;</span><span class="c1">//åˆå§‹åŒ–åŠ¨ä½œæ”¾åˆ°ç±»å¤–cppæ–‡ä»¶é‡Œå»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆç›®æ ‡ç±» <code>TestNewHandler</code> åªè¦åŸºäº <code>CRTP</code> æ–¹æ³•ç»§æ‰¿äºåŸºç±»å°±å¯ä»¥äº†ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-27"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TestNewHandler</span> <span class="o">:</span> <span class="k">public</span> <span class="n">NewHandlerSupport</span><span class="o">&lt;</span><span class="n">TestNewHandler</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//ä¸å¿…å£°æ˜ set_new_handler æˆ– operator new
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æœ€ç»ˆåº”ç”¨æ—¶ä¹Ÿéå¸¸ç®€å•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TestNewHandler</span><span class="o">::</span><span class="n">set_new_handler</span><span class="p">(</span><span class="n">OutOfMemTip</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">TestNewHandler</span><span class="o">*</span> <span class="n">pTestHandle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TestNewHandler</span><span class="p">();</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="r50-äº†è§£newå’Œdeleteçš„åˆç†æ›¿æ¢æ—¶æœº">R50 äº†è§£newå’Œdeleteçš„åˆç†æ›¿æ¢æ—¶æœº</h3>
<p>æ›¿æ¢ç¼–è¯‘å™¨æä¾›çš„ <code>operator new</code> å’Œ <code>operator delete</code> çš„ å¸¸è§ç†ç”± å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>æ£€æµ‹è¿ç”¨ä¸Šçš„é”™è¯¯</strong>
è‡ªå®šä¹‰çš„new/deleteå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ ¡éªŒå®é™…æ§åˆ¶çš„åŒºæ®µå†…å­˜ï¼Œæ¯”å¦‚å¯ä»¥åœ¨ç›®æ ‡åŒºå—å‰åé¢å¤–ç©ºé—´æ·»åŠ å†…å­˜ç­¾å(æ¯”å¦‚å†™å…¥ç‰¹å®š int å€¼)ï¼Œç›‘æµ‹è¶Šç•Œçš„é—®é¢˜ã€‚
è¶Šç•Œåˆ†2ç§ï¼šunderruns (åŒºå—å†…å­˜èµ·ç‚¹ä¹‹å‰) å’Œ overruns (åŒºå—å†…å­˜æœ«å°¾ä¹‹å)ã€‚</p>
</li>
<li>
<p><strong>æ—¶é—´æˆ–å†…å­˜ä½¿ç”¨çš„ä¼˜åŒ–</strong>
é€šç”¨çš„ new/delete éœ€è¦é€‚ç”¨å„ç§åˆ†é…å½¢æ€å’Œåœºæ™¯ï¼Œå¯¹äºå†…å­˜ç¢ç‰‡æˆ–æ—¶é—´æ€§èƒ½éƒ½æ˜¯ä¸­åº¸æ°´å¹³ã€‚
å¯¹ç‰¹å®šçš„éœ€æ±‚å’Œåœºæ™¯ï¼Œå®šåˆ¶åŒ–åœ°å†…å­˜ç®¡ç†ä¼šæœ‰å¾ˆå¥½çš„ä¼˜åŒ–æ•ˆæœã€‚</p>
</li>
<li>
<p><strong>æ”¶é›†å†…å­˜ä½¿ç”¨çš„ç»Ÿè®¡æ•°æ®</strong>
å¯¹å†…å­˜åˆ†é…ç»†èŠ‚çš„æŠŠæ§ï¼Œä¾‹å¦‚åˆ†é…åŒºå—çš„å¤§å°åˆ†å¸ƒã€å­˜ç»­å‘¨æœŸã€FIFO/LIFOæ¬¡åºåˆ†é…å›æ”¶ã€å†…å­˜å³°å€¼ç­‰æƒ…å†µã€‚</p>
</li>
<li>
<p><strong>å¼¥è¡¥é»˜è®¤å†…å­˜åˆ†é…å™¨çš„ éæœ€ä½³å¯¹é½ä½suboptimal alignment</strong>
ä¾‹å¦‚x86ä½“ç³»ç»“æ„CPUä¸Šè®¿é—®doubleéƒ½æ˜¯8byteså¯¹é½ï¼Œå¦‚æœèƒ½åœ¨å†…å­˜åˆ†é…æ—¶å°±åšå¥½å†…å­˜å¯¹é½ï¼Œå¯æå‡è®¿é—®æ•ˆç‡ã€‚</p>
</li>
<li>
<p><strong>å°†ç›¸å…³å¯¹è±¡æˆç°‡é›†ä¸­</strong>
æ¯”å¦‚å·²çŸ¥æŸä¸ªæ•°æ®ç»“æ„å¾€å¾€ä¸€èµ·ä½¿ç”¨ï¼Œé‚£ä¹ˆåˆ†é…çš„æ—¶å€™åº”è¯¥å°½é‡è®©æ‰€æœ‰æ•°æ®çš„å†…å­˜é›†ä¸­ä¸€äº›ï¼Œé¿å…é¢‘ç¹è§¦å‘ æ¢é¡µä¸­æ–­page faults ï¼Œæå‡è®¿é—®æ•ˆç‡ã€‚</p>
</li>
<li>
<p><strong>å…¶ä»–çš„éä¼ ç»Ÿè¡Œä¸º</strong>
æƒ³å®Œæˆä¸€äº›ç³»ç»Ÿç¼–è¯‘å™¨åŠä¸åˆ°çš„äº‹æƒ…ã€‚æ¯”å¦‚å¸Œæœ›åˆ†é…é‡Šæ”¾å…±äº«å†…å­˜çš„åŒºå—ï¼Œä½†æ˜¯åªæœ‰ C-API èƒ½åšåˆ°ï¼Œé‚£å°±éœ€è¦å®šåˆ¶ç‰ˆçš„ new/delete å»åŒ…è£¹å°è£…è¿™æ ·çš„APIã€‚</p>
</li>
</ol>
<h3 id="r51-ç¼–å†™newå’Œdeleteæ—¶éœ€å›ºå®ˆå¸¸è§„">R51 ç¼–å†™newå’Œdeleteæ—¶éœ€å›ºå®ˆå¸¸è§„</h3>
<p>ä¸Šä¸€ä¸ªæ¡æ¬¾è®²äº†é‡å†™ new/delete çš„åŸå› ï¼Œè¿™ä¸€èŠ‚å°†è®²è¿°å…·ä½“éœ€è¦éµå®ˆçš„å‡ ä¸ªè§„åˆ™ã€‚</p>
<ol>
<li>
<p><strong>æ­£ç¡®å¤„ç† new å¤±è´¥çš„æƒ…å†µ</strong>
å¦‚æœåˆ†é…æ­£å¸¸ï¼Œç›´æ¥è¿”å›åŒºå—å¯¹åº”çš„æŒ‡é’ˆå³å¯ã€‚å¯å¦‚æœå¤±è´¥ï¼Œå°±å¿…é¡»å¾—æ­£ç¡®è°ƒç”¨ new-handler å‡½æ•°ï¼Œå‚è€ƒ R49 äº†è§£new-handlerçš„è¡Œä¸ºã€‚</p>
</li>
<li>
<p><strong>å¦‚æœè¦æ±‚åˆ†é… 0 byte ç©ºé—´</strong>
C++è§„å®šï¼Œå¦‚æœå®¢æˆ·è¦æ±‚åˆ†é… 0 byte å†…å­˜ç”³è¯·ï¼Œå°±è¿”å› 1byte ç©ºé—´ç”³è¯·ï¼Œå¹¶è¿”å›è¯¥æœ‰æ•ˆåœ°å€ã€‚</p>
</li>
<li>
<p><strong>ç†è§£ operator new å†…éƒ¨çš„æ— ç©·å¾ªç¯</strong>
operator new æœ‰ä¸ª while(true) å¾ªç¯ï¼Œåˆ†é…æˆåŠŸå¯ä»¥returnï¼Œæˆ–ç”± new-handler ä¸º nullptr æ—¶æŠ›å‡º std::bad_alloc å¼‚å¸¸ã€‚ä¼ªä»£ç pseudocode å¦‚ä¸‹ï¼š</p>
</li>
</ol>
<div class="highlight" id="id-28"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span><span class="o">*</span> <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="k">throw</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bad_alloc</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">      <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="err">å°è¯•åˆ†é…</span> <span class="n">size</span> <span class="n">bytes</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="err">åˆ†é…æˆåŠŸ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>  <span class="n">target_pointer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_handler</span> <span class="n">globalHandler</span> <span class="o">=</span> <span class="n">set_new_handler</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">set_new_handler</span><span class="p">(</span><span class="n">globalHandler</span><span class="p">);</span><span class="c1">//åˆ†é…å¤±è´¥äº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">globalHandler</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">globalHanler</span><span class="p">)();</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">bad_alloc</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li><strong>å½“åŸºç±»çš„ operator new è¢«å­ç±»ç»§æ‰¿æ—¶</strong>
å½“åŸºç±»è¢«ç»§æ‰¿æ—¶ï¼Œæˆå‘˜ operator new ä¹Ÿä¸€èµ·è¢«ç»§æ‰¿äº†ï¼Œè¦æ³¨æ„çš„æ˜¯åŸºç±»å’Œå­ç±»çš„ size é€šå¸¸æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¨èå®ç°å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight" id="id-29"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Base</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">static</span> <span class="kt">void</span><span class="o">*</span> <span class="k">operator</span> <span class="k">new</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">)</span><span class="k">throw</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bad_alloc</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Base</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="o">::</span><span class="k">operator</span> <span class="k">new</span><span class="p">(</span><span class="n">size</span><span class="p">);</span><span class="c1">//å­ç±»èµ°è¿™é‡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>operator new[] ä¸èƒ½è¿™æ ·åœ¨åŸºç±»ä¸­åŒºåˆ†</strong>ã€‚å› ä¸ºå³ä½¿åœ¨Baseç±»ï¼Œä¹Ÿæ— æ³•å‡å®šæ¯ä¸ªå…ƒç´ æ˜¯ sizeof(Base)ï¼Œé€šå¸¸è¿˜æœ‰é¢å¤–å†…å­˜ç©ºé—´æ¥ä¿å­˜å…ƒç´ ä¸ªæ•°ã€‚</p>
<ol start="5">
<li>operator delete çš„æ³¨æ„äº‹é¡¹
C++ éœ€è¦ä¿è¯ â€œ<code>åˆ é™¤NULLæŒ‡é’ˆæ°¸è¿œå®‰å…¨</code>â€ï¼Œæ‰€ä»¥å¿…é¡»å…‘ç°è¿™ä¸ªè§„åˆ™ã€‚é’ˆå¯¹nullæŒ‡é’ˆï¼Œå°±ä»€ä¹ˆä¹Ÿä¸åšï¼Œç›´æ¥returnã€‚</li>
</ol>
<h3 id="r52-å†™äº†placement-new-ä¹Ÿè¦å†™placement-delete">R52 å†™äº†placement-new ä¹Ÿè¦å†™placement-delete</h3>
<p>placement-newï¼Œæ˜¯æŒ‡â€œ<code>é™¤sizeå‚æ•°ä»¥å¤–ï¼Œæ¥å—ä¸€ä¸ªé¢å¤–å‚æ•°å‚ä¸æ„é€ </code>â€çš„ ç‰¹å®š operator-newã€‚</p>
<p>å…¶ä¸­ï¼Œâ€œ<code>æ¥å—ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¯¹è±¡è¯¥è¢«æ„é€ ä¹‹å¤„</code>â€æ˜¯<strong>æœ€å¸¸ä½¿ç”¨</strong>çš„ placement-newï¼Œå³â€œ<code>ä¸€ä¸ªç‰¹å®šä½ç½®ä¸Šçš„new</code>â€ï¼Œå½¢å¼å¦‚ä¸‹ä¸ºï¼š</p>
<div class="highlight" id="id-30"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//è¿™ä¸ªç‰¹æ®Šçš„ä¹Ÿæ˜¯æœ€å¸¸æ¶‰åŠçš„ placement-new å·²è¢«çº³å…¥C++æ ‡å‡†ç¨‹åºåº“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="o">*</span> <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">,</span><span class="kt">void</span><span class="o">*</span> <span class="n">pMemory</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…ˆæš‚æ—¶è€ƒè™‘ä¸€ä¸ªè°ƒç”¨äº†placement-newçš„æ­£å¸¸æ„é€ è¿‡ç¨‹ï¼š</p>
<div class="highlight" id="id-31"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// æœ‰è¿™æ ·ä¸€ä¸ªplacement-new,æ¥æ”¶ä¸€ä¸ªostreamæ¥logåˆ†é…æ—¶çš„ç›¸å…³ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span><span class="o">*</span> <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">logStream</span><span class="p">)</span> <span class="k">throw</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bad_alloc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Widget</span><span class="o">*</span> <span class="n">pw</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="p">)</span> <span class="n">Widget</span><span class="p">;</span><span class="c1">//ä¼ å…¥ostream
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºä»»ä½•çš„newå¯¹è±¡æ„é€ è¿‡ç¨‹ï¼Œè‡³å°‘å¯åˆ†ä¸ºä¸‹è¿°2ä¸ªè¿‡ç¨‹ï¼š</p>
<ol>
<li>operator new åˆ†é…å¯¹è±¡éœ€è¦çš„å†…å­˜ç©ºé—´ï¼›</li>
<li>æ‰§è¡Œå¯¹åº”çš„æ„é€ å‡½æ•°
å¦‚æœä¸Šè¿°è¿‡ç¨‹ 1 æˆåŠŸäº†ï¼Œè¿‡ç¨‹ 2 æŠ›å¼‚å¸¸ï¼Œå·²ç»ç”³è¯·çš„å†…å­˜å°±éœ€è¦åŠæ—¶å›æ”¶é¿å…memory-leakï¼Œè¿è¡ŒæœŸç³»ç»Ÿå°±ä¼šå°è¯•å¯»æ‰¾å¹¶è°ƒç”¨â€œ<strong>é¢å¤–å‚æ•°ä¸ªæ•°å’Œç±»å‹éƒ½ä¸operator new ä¸€è‡´çš„operator delete</strong>â€ï¼Œå®Œæˆå†…å­˜å›æ”¶ã€‚</li>
</ol>
<p>é‚£ä¹ˆä¸Šè¿°äº‹å®ï¼Œå°±æ˜¯ placement-new å’Œ placement-delete éœ€è¦<strong>æˆå¯¹å®ç°çš„ç†ç”±</strong>ã€‚</p>
<p>é’ˆå¯¹ä¸Šä¾‹é¢å¤–å‚æ•°æ˜¯ std::ostream çš„operator newï¼Œoperator deleteï¼Œç±»å£°æ˜å½¢å¼å¦‚ä¸‹:</p>
<div class="highlight" id="id-32"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="kt">void</span><span class="o">*</span> <span class="k">operator</span> <span class="k">new</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">logStream</span><span class="p">)</span> <span class="k">throw</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bad_alloc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ä¸æŠ›å¼‚å¸¸æ—¶ï¼Œæœ€åå¯¹è±¡ææ„æ—¶æ­£å¸¸è°ƒç”¨è¿™ä¸ª
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">static</span> <span class="kt">void</span> <span class="k">operator</span> <span class="nf">delete</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">pMemory</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//newæŠ›å¼‚å¸¸æ—¶ï¼Œè°ƒç”¨è¿™ä¸ª é¢å¤–å‚æ•°ä¸ªæ•°å’Œç±»å‹éƒ½ä¸€è‡´çš„ placement-delete
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">static</span> <span class="kt">void</span> <span class="k">operator</span> <span class="nf">delete</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">pMemory</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">logStream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>âš ï¸ <strong>One More Thing</strong> : C++ åœ¨global ä½œç”¨åŸŸæä¾›ä»¥ä¸‹å½¢å¼çš„ operator new:</p>
<div class="highlight" id="id-33"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span> <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="k">throw</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bad_alloc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span> <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">,</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span> <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">,</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">nothrow_t</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span><span class="c1">//è§æ¡æ¬¾49 new-Handlerçš„è¡Œä¸º
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ğŸ˜ æ‰€ä»¥ï¼Œå¦‚æœåœ¨class å†…å£°æ˜äº†ä¸Šè¿° operator newï¼Œ åˆ™globalä½œç”¨åŸŸçš„ operator new ä¼šè¢«<code>åç§°é®æ©</code>ã€‚</p>
<p>ğŸ¤” <code>è§£å†³åŠæ³•</code>ï¼šåœ¨åŸºç±»å¯¹globalä½œç”¨åŸŸçš„ ::operator new è¿›è¡Œå°è£…è°ƒç”¨ï¼Œç„¶ååœ¨å­ç±»ä¸­ä½¿ç”¨using å£°æ˜å¼ç ´é™¤åç§°é®æ©ã€‚</p>
<h2 id="ch9-æ‚é¡¹è®¨è®º">CH9 æ‚é¡¹è®¨è®º</h2>
<h3 id="r53-ä¸è¦è½»æ˜“å¿½ç•¥ç¼–è¯‘å™¨çš„è­¦å‘Š">R53 ä¸è¦è½»æ˜“å¿½ç•¥ç¼–è¯‘å™¨çš„è­¦å‘Š</h3>
<ul>
<li>
<p><strong>ä¸¥è‚ƒå¯¹å¾…ç¼–è¯‘å™¨å‘å‡ºçš„è­¦å‘Šä¿¡æ¯</strong>
ç¼–è¯‘å™¨å‘å‡ºçš„è­¦å‘Šä¿¡æ¯ï¼Œç»å¸¸ä¼šè¢«å¿½ç•¥ã€‚No-Warningæ˜¯å€¼å¾—è¿½å´‡çš„ï¼Œé™¤éä½ å¯¹ç¼–è¯‘ warning ä¿¡æ¯æ˜¯å……åˆ†äº†è§£å¹¶ç¡®ä¿¡æ˜¯æ— å…³ç´§è¦çš„ã€‚</p>
<p>ä¸‹é¢ä¸¾ä¸€ä¸ªè¾ƒä¸ºå¸¸è§çš„ä¾‹å­ï¼š</p>
<div class="highlight" id="id-34"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseWarn</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetWarnInfo</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="s">&#34;Base&#34;</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DerivedWarn</span> <span class="o">:</span><span class="k">public</span> <span class="n">BaseWarn</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetWarnInfo</span><span class="p">()</span>  <span class="p">{</span><span class="c1">//ç¼ºäº†const
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="s">&#34;Derived&#34;</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œæ²¡æœ‰æˆåŠŸå®ç°è™šå‡½æ•°é‡å†™ï¼Œè€Œæ˜¯é€ æˆäº†â€œ<strong>åç§°é®æ©</strong>â€ã€‚
è¿™æ ·çš„é”™è¯¯è¾ƒä¸ºéšè”½ï¼Œæœ‰äº›ç¼–è¯‘å™¨ä¼šç»™å‡ºè­¦å‘Šä¿¡æ¯ï¼Œæœ‰äº›ç”šè‡³è¿è­¦å‘Šä¿¡æ¯éƒ½æ²¡æœ‰ï¼ˆPsï¼šæˆ‘è‡ªè¡Œæµ‹è¯•äº†VS2017ï¼Œæ²¡æœ‰warningä¿¡æ¯ï¼‰ã€‚
<code>å¦‚æœç¼–è¯‘å™¨ç»™å‡ºäº†è­¦å‘Šä¿¡æ¯ï¼Œè¯·è®¤çœŸå¯¹å¾…</code>ã€‚</p>
</li>
<li>
<p><strong>ä¸è¦è¿‡åº¦ä¾èµ–ç¼–è¯‘å™¨çš„æŠ¥è­¦èƒ½åŠ›</strong>
è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œä¸åŒç¼–è¯‘å™¨å¤„ç†æ€åº¦ä¸åŒï¼Œè­¦å‘Šä¿¡æ¯ç”šè‡³å¯èƒ½æ¢ä¸ªç¼–è¯‘å™¨å°±æ¶ˆå¤±äº†ã€‚</p>
</li>
</ul>
<h3 id="r54-ç†Ÿæ‚‰åŒ…æ‹¬tr1åœ¨å†…çš„æ ‡å‡†ç¨‹åºåº“">R54 ç†Ÿæ‚‰åŒ…æ‹¬TR1åœ¨å†…çš„æ ‡å‡†ç¨‹åºåº“</h3>
<p><strong>C++ Technical Report 1 (TR1)</strong> å¹¶éæ ‡å‡†ï¼Œè€Œæ˜¯ä¸€ä»½è‰ç¨¿æ–‡ä»¶ï¼Œå¯¹C++æ ‡å‡†åº“çš„ç¬¬ä¸€æ¬¡æ‰©å±•ï¼Œå®ƒæå‡ºäº†å¯¹C++æ ‡å‡†å‡½å¼åº“çš„è¿½åŠ é¡¹ç›®ã€‚</p>
<p>è¿™ä»½æ–‡ä»¶çš„ç›®æ ‡åœ¨äºã€Œä¸ºæ‰©å……çš„C++æ ‡å‡†å‡½å¼åº“å»ºç«‹æ›´ä¸ºå¹¿æ³›çš„ç°å®ä½œå“ã€ã€‚</p>
<blockquote>
<p><code>æˆ‘çš„ç†è§£</code>ï¼š200x å¹´å‘å¸ƒçš„ C++ ç§°ä¸º â€œC++0xâ€ï¼ŒæŒç»­ä¿®æ”¹ä¸­ï¼Œæ‰€æœ‰ä¿®æ”¹å°†åˆå¹¶äº TR1ï¼Œæœ€ç»ˆç»å¤§éƒ¨åˆ†éƒ½å®šç‰ˆã€æ”¶å½•å‘å¸ƒäº <strong>C++11</strong>ã€‚</p>
</blockquote>
<p>TR1è¯¦ç»†å™è¿°äº†è®¸å¤šæ–°ç‰¹æ€§ï¼Œéƒ½æ”¾åœ¨ <code>std::tr1</code> å‘½åç©ºé—´å†…ï¼ˆä»¥ä¸‹ç®€ç§° <code>tr1::</code> ï¼‰ï¼Œåˆ—ä¸¾å¦‚ä¸‹</p>
<ol>
<li><code>æ™ºèƒ½æŒ‡é’ˆ</code>ï¼štr1::shared_ptr å’Œ tr1::weak_ptr ï¼ŒRAII åŸºç¡€ï¼Œä¸èµ˜è¿°ï¼›</li>
<li><code>tr1::function</code>ï¼šè¡¨ç¤º å¯è°ƒç”¨ç‰©callable entityï¼Œå³ä»»ä½•å‡½æ•°æˆ–å‡½æ•°å¯¹è±¡ï¼Œåªè¦ç­¾åä¸€è‡´å³å¯ï¼›</li>
<li><code>tr1::bind</code>ï¼šå¯¹å‡½æ•°è°ƒç”¨çš„å°è£…ï¼Œå°†å‡½æ•°å’Œå…¶å‚æ•°ç»‘å®šä¸€èµ·ï¼›</li>
<li><code>Hash tables</code>ï¼šé‡‡å“ˆå¸Œè¡¨å½¢å¼å‚ä¸æ„æˆï¼Œåç§°ä»¥ unordered_ å¼€å¤´çš„ set/multiset/map/multimapï¼›</li>
<li><code>æ­£åˆ™è¡¨è¾¾å¼</code>ï¼šå¤´æ–‡ä»¶åœ¨ <regrex> ï¼›</li>
<li><code>Tuple å…ƒç»„(æˆ–å«å˜é‡ç»„)</code>ï¼šä¸å®šé•¿å˜é‡ç»„ï¼Œæ˜¯ std::pair çš„ä¸€ç§æ³›åŒ–ï¼›</li>
<li><code>tr1::array</code>: å’Œ C è¯­è¨€æ•°ç»„ä¸€æ ·ï¼Œæ˜¯ä¸ªå®šé•¿æ•°ç»„ï¼ŒåŒ…è£¹äº† STL ç”¨æ³•ï¼›</li>
<li><code>tr1::mem_fn</code>: ä¼ å…¥ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ˆæ”¯æŒå¯¹æˆå‘˜å‡½æ•°å–å€ï¼‰ä½œä¸ºå…¥å‚ï¼Œæ„é€ ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œè¿›è€Œè°ƒç”¨ï¼Œç±»ä¼¼åœ°è¿˜æœ‰ mem_fn_ref;</li>
<li><code>tr1::reference_wrapper</code>ï¼šâ€œå°è£…å¼•ç”¨ä¸ºä¸€ä¸ªå¯¹è±¡â€ï¼Œé€šå¸¸ç”¨äºå¯¹å¼•ç”¨è¿›è¡Œå°è£…ç„¶åè£…å…¥æ ‡å‡†å®¹å™¨(ç›´æ¥å¾€å®¹å™¨å¡å¼•ç”¨æ˜¯ä¸è¡Œçš„)ï¼›</li>
<li><code>éšæœºæ•°ç”Ÿæˆå·¥å…·</code>ï¼šrandom_deviceï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆæˆ–è€…ä½¿ç”¨ä¸åŒçš„ éšæœºæ•°å¼•æ“ å’Œ éšæœºåˆ†å¸ƒç®—æ³•è¿›è¡Œç”Ÿæˆï¼Œå¤´æ–‡ä»¶æ˜¯ <random>ï¼›</li>
<li><code>æ•°å­¦ç‰¹æ®Šå‡½æ•°</code>ï¼šåŒ…æ‹¬Laguerreå¤šé¡¹å¼ã€Bessel å‡½æ•°ã€å®Œå…¨æ¤­åœ†ç§¯åˆ†ç­‰ç‰¹æ®Šæ•°å­¦å‡½æ•°ï¼Œæ³¨æ„ï¼Œè¿™äº› åœ¨ C++17 æ‰å¼•å…¥C++æ ‡å‡†ï¼Œå¯å‚è€ƒcppreference: special math ï¼Œå¤´æ–‡ä»¶åœ¨ <cmath>ï¼›</li>
<li><code>C99å…¼å®¹æ‰©å……</code> ï¼šC99æ ‡å‡†æ˜¯Cè¯­è¨€çš„å®˜æ–¹æ ‡å‡†ç¬¬äºŒç‰ˆï¼Œ1999å¹´å‘å¸ƒï¼ŒTR1å¯¹å…¶è¿›è¡Œäº†å…¼å®¹ï¼›</li>
<li><code>Type traits ç±»å‹èƒå–</code>ï¼štemplateç¼–ç¨‹çš„ç²¾åä¹‹ä¸€ï¼Œå‚è€ƒ Rule47:ä½¿ç”¨traitè¡¨ç°ç±»å‹ä¿¡æ¯ï¼Œå¤´æ–‡ä»¶ä¸º &lt;type_traits&gt;ï¼ŒåŠŸèƒ½ååˆ†ä¸°å¯Œï¼Œå¯å‚è€ƒcppreference: type_traitsï¼›</li>
<li><code>tr1::result_of</code> ï¼šå¯ä»¥å¯¹å‡½æ•°è¿”å›å€¼åšæ¨æ–­ï¼Œå¾—åˆ°è¿”å›å€¼ç±»å‹ï¼Œå¤´æ–‡ä»¶ä¸º &lt;type_traits&gt; ï¼Œç¤ºä¾‹ç”¨æ³•å¦‚ä¸‹ï¼š
<code>c++ // å‡è®¾æœ‰ä¸ªå‡½æ•° double calcDaySale(int); std::tr1::result_of&lt;calcDaySale(int)&gt;::type x = 3.14;//xå°±æ˜¯doubleç±»å‹. C++11ä¸­ç›´æ¥ std::result_of </code>
æ›´è¯¦ç»†çš„å®šç‰ˆTR1ä¿¡æ¯å¯ä»¥å‚è€ƒ<a href="https://aristeia.com/EC3E/TR1_info.html"target="_blank" rel="external nofollow noopener noreferrer">Effective-C++ï¼šTR1 information<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ã€‚</li>
</ol>
<h3 id="r55-è®©è‡ªå·±ç†Ÿæ‚‰boost">R55 è®©è‡ªå·±ç†Ÿæ‚‰Boost</h3>
<p>Boostæ˜¯ä¸€ä¸ªC++å¼€å‘è€…é›†ç»“çš„ç¤¾ç¾¤ï¼Œä¹Ÿæ˜¯ä¸ªå¯è‡ªç”±ä¸‹è½½çš„ç¨‹åºåº“é›†ï¼Œç½‘å€æ˜¯ <code>http://boost.org</code>ã€‚</p>
<p><strong>å…¶ç‰¹æ®Šæ€§</strong>ï¼šå’ŒC++æ ‡å‡†å§”å‘˜ä¼šæœ‰ç€ç‹¬ä¸€æ— äºŒçš„å¯†åˆ‡å…³ç³»ï¼Œä¸”å…·æœ‰å¾ˆæ·±å½±å“åŠ›ï¼›æ¥çº³ç¨‹åºåº“éå¸¸ä¸¥è°¨ï¼Œéœ€è¦ä¸€æ¬¡ä»¥ä¸Šçš„åŒè¡Œä¸“å®¶è¯„å®¡ã€‚</p>
<p>Boost ç¨‹åºåº“é›†å¯å¤„ç†çš„åœºæ™¯æœ‰è®¸å¤šï¼ˆä¸”<strong>å›Šæ‹¬äº†TR1</strong>çš„å®ç°ï¼‰ï¼Œå¯åŒºåˆ†å‡ºæ•°åä¸ªç±»åˆ«ï¼Œå¹¶ä¸”è¿˜åœ¨æŒç»­å¢åŠ ï¼Œ<strong>åˆ—ä¸¾ä¸€å°éƒ¨åˆ†</strong>å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>å­—ç¬¦ä¸²ä¸æ–‡æœ¬å¤„ç†</strong></li>
<li><strong>å®¹å™¨</strong></li>
<li><strong>å‡½æ•°å¯¹è±¡ä¸é«˜çº§ç¼–ç¨‹</strong></li>
<li><strong>æ³›å‹ç¼–ç¨‹</strong>ï¼šè¦†ç›–ä¸€å¤§ç»„ traits classes</li>
<li><strong>æ¨¡æ¿å…ƒç¼–ç¨‹</strong>ï¼šè¦†ç›–ä¸€ä¸ªé’ˆå¯¹ç¼–è¯‘å™¨ assertions è€Œå†™çš„ç¨‹åºåº“ï¼Œä»¥åŠ Boost MPLç¨‹åºåº“</li>
<li><strong>æ•°å­¦å’Œæ•°å€¼</strong>:åŒ…æ‹¬æœ‰ç†æ•°ã€å…«å…ƒæ•°ã€å››å…ƒæ•°ã€å…¬çº¦æ•°ã€å¤šé‡è¿ç®—ã€éšæœºæ•°ç­‰ç­‰</li>
<li><strong>æ­£ç¡®æ€§ä¸æµ‹è¯•æ€§</strong></li>
<li><strong>æ•°æ®ç»“æ„</strong></li>
<li><strong>è¯­è¨€é—´çš„æ”¯æŒ</strong>ï¼šå…è®¸ C++ å’Œ Python ä¹‹é—´çš„æ— ç¼äº’è”</li>
<li><strong>å†…å­˜</strong>ï¼šè¦†ç›–Poolç¨‹åºåº“å’Œæ™ºèƒ½æŒ‡é’ˆç­‰</li>
<li><strong>æ‚é¡¹</strong>ï¼šåŒ…æ‹¬ CRC æ ¡éªŒã€æ—¥æœŸå’Œæ—¶é—´çš„å¤„ç†ã€æ–‡ä»¶ç³»ç»Ÿç­‰å†…å®¹</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼ŒBoost æ˜¯ä¸€ä¸ªç¤¾ç¾¤ï¼Œä¹Ÿæ˜¯ä¸ªç½‘ç«™ã€‚è‡´åŠ›äºå…è´¹ã€æºç å¼€æ”¾ã€åŒè¡Œå¤å®¡çš„ C++ ç¨‹åºåº“å¼€å‘ï¼Œéå¸¸å€¼å¾—ç»å¸¸è®¿é—®ä¸å­¦ä¹ ã€‚</p>
<p>ref:</br>
[1]. <a href="https://blog.csdn.net/cltcj/category_12098441.html"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/cltcj/category_12098441.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[2]. <a href="https://kissingfire123.github.io/2022/05/17_effective-c-%e4%b9%8b%e9%98%85%e8%af%bb%e6%80%bb%e7%bb%93%e5%9b%9b/"target="_blank" rel="external nofollow noopener noreferrer">https://kissingfire123.github.io/2022/05/17_effective-c-%e4%b9%8b%e9%98%85%e8%af%bb%e6%80%bb%e7%bb%93%e5%9b%9b/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></p>]]></description></item><item><title>Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [3]</title><link>https://jianye0428.github.io/posts/partthree/</link><pubDate>Mon, 31 Jul 2023 07:26:00 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/partthree/</guid><description><![CDATA[<!-- <div class="details admonition quote">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-quote-right fa-fw" aria-hidden="true"></i>quote<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">note abstract info tip success question warning failure danger bug example quote</div>
    </div>
  </div> -->
<h1 id="å‰è¨€">å‰è¨€</h1>
<blockquote>
<p>Effective-C++æ€»ç»“ç³»åˆ—åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬äºŒéƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬3~4ç« ï¼Œå†…å®¹èŒƒå›´Rule13~25ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule13ç®€å†™ä¸ºR13ã€‚</p>
</blockquote>
<div class="details admonition Note">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Effective-C++ç³»åˆ—List<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partone/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/parttwo/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partthree/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partfour/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></div>
    </div>
  </div>
<p>ç”±äºåŸä¹¦åœ¨C++11ä¹‹å‰å†™æˆï¼Œæœ‰äº›ç°ä»£C++ç‰¹æ€§ä¸ä¼šæåŠï¼Œæ‰€ä»¥ä¼šæ ¹æ®æœ¬äºº<code>å¼€å‘ç»éªŒ</code>æ–°å¢ä¸€äº›ä¸ªäººæ„Ÿæ‚ŸğŸ‘‰<code>By the way</code>ç¯èŠ‚ã€‚</p>
<h2 id="ch5-å®ç°">CH5. å®ç°</h2>
<h3 id="r26-å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´">R26 å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´</h3>
<ul>
<li>å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°ï¼Œå¯å¢åŠ ç¨‹åºæ¸…æ™°åº¦å’Œæ•ˆç‡
<ol>
<li>å®šä¹‰åï¼Œåœ¨ä½¿ç”¨å‰å°±é­é‡æŠ›å¼‚å¸¸
è¿™ç§æƒ…å†µï¼Œå¦‚æœæ˜¯å®šä¹‰äº†å¯¹è±¡<code>ObjectA a</code>ï¼Œä¾¿ç™½ç™½åœ°æµªè´¹äº†å¯¹è±¡açš„æ„é€ å’Œææ„æˆæœ¬ã€‚</li>
<li>ä¸åªæ˜¯å»¶åå˜é‡å®šä¹‰åˆ°ä½¿ç”¨æ—¶ï¼Œè€Œæ˜¯å°½é‡å»¶ååˆ°èƒ½ç»™å®ƒåˆå€¼æ—¶</li>
</ol>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">encryptPassword</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">password</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="n">password</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&#34;Password is too short&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="c1">// è€ƒè™‘1ï¼šåœ¨å¼‚å¸¸ä¹‹åå®šä¹‰å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">encrypted</span><span class="p">(</span><span class="n">password</span><span class="p">);</span><span class="c1">//è€ƒè™‘2ï¼šå®šä¹‰å»¶åè‡³å˜é‡èƒ½èµ‹åˆå€¼çš„æ—¶æœº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">encrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">encrypted</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>æ€è€ƒå˜é‡å®šä¹‰<strong>æ˜¯å¦</strong>è¯¥åœ¨å¾ªç¯å†…</li>
</ol>
<ul>
<li>æ–¹æ³•Aï¼šå®šä¹‰äºå¾ªç¯å¤–
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">Widget</span> <span class="n">w</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">â€ƒ â€ƒ <span class="n">w</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">â€ƒ â€ƒ<span class="c1">// other...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>æ–¹æ³•Bï¼šå®šä¹‰äºå¾ªç¯å†…
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Widget</span> <span class="nf">w</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// other...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<p><strong>ç©¶ç«Ÿæ˜¯Aè¿˜æ˜¯Bæ–¹æ³•å¥½</strong>ï¼Œå–å†³äº <code>ä¸€ä¸ªèµ‹å€¼æˆæœ¬</code>å’Œ<code>ä¸€ç»„æ„é€ +ææ„</code>æˆæœ¬ï¼Œè¿™2è€…ä¹‹é—´ï¼Œå¦‚æœæ˜¯èµ‹å€¼æˆæœ¬ä½ï¼Œé‚£ä¹ˆAæ›´å¥½ï¼Œå¦åˆ™Bæ›´å¥½ã€‚</p>
<h3 id="r27-å°½é‡å°‘åšè½¬å‹åŠ¨ä½œ">R27 å°½é‡å°‘åšè½¬å‹åŠ¨ä½œ</h3>
<p>é€šå¸¸çš„è½¬å‹æ˜¯å¯èƒ½ä¼šè¿™æ ·å†™ï¼šå‡½æ•°é£æ ¼çš„<code>int(expression)</code>æˆ–è€…Cé£æ ¼çš„(int)<code>expression</code>ï¼Œè¿™éƒ½è¢«æˆä¸ºâ€œæ—§å¼è½¬å‹â€ã€‚</p>
<ul>
<li>
<p>åœ¨C++ä¸­ï¼Œæœ‰4ç§æ–°å¼è½¬å‹æ“ä½œç¬¦ï¼š</p>
<ol>
<li><strong>const_cast (expression)</strong>
ä½œç”¨æ˜¯ç§»é™¤å˜é‡çš„å¸¸é‡æ€§(cast away the constness)ï¼Œæ˜¯å”¯ä¸€æœ‰æ­¤èƒ½åŠ›çš„æ“ä½œç¬¦ã€‚</li>
<li><strong>dynamic_cast(expression)</strong>
ä½œç”¨æ˜¯â€œå®‰å…¨å‘ä¸‹è½¬å‹â€(safe downcasting)ï¼Œå†³å®šæŸä¸ªå¯¹è±¡æ˜¯å¦å±äºæŸç»§æ‰¿ä½“ç³»ã€‚è€—è´¹é‡å¤§è¿è¡Œæˆæœ¬ï¼ˆåŸå› ï¼šéœ€è¦æŸ¥è¯¢RTTIä¿¡æ¯ï¼Œè€Œä¸”ä¸åŒç¼–è¯‘å™¨å®ç°çš„æ–¹æ³•å’Œæ•ˆç‡æœ‰æ‰€ä¸åŒï¼‰ã€‚</li>
<li><strong>reinterpret_cast(expression)</strong>
æ‰§è¡Œä½çº§è½¬å‹ï¼Œå®é™…ç»“æœå–å†³äºç¼–è¯‘å™¨ï¼Œç§»æ¤æ€§å·®ã€‚ï¼ˆæ¯”å¦‚int* è½¬ä¸ºintï¼‰è¦æ¸…æ¥šè‡ªå·±åœ¨åšä»€ä¹ˆï¼Œæ…ç”¨ã€‚</li>
<li><strong>static_cast(expression)</strong>
å¼ºè¿«éšå¼ç±»å‹è½¬æ¢ï¼Œä»£æ›¿Cé£æ ¼çš„&quot;æ—§å¼è½¬æ¢&quot;ã€‚ä¹Ÿå¯ä»¥ç»™å˜é‡åŠ ä¸Šconstç‰¹æ€§ã€‚</li>
</ol>
<p>æ–°å¼è½¬æ¢çš„å¥½å¤„ï¼šå¾ˆå®¹æ˜“åœ¨ä»£ç æ‰¾åˆ°â€œç±»å‹ç³»ç»Ÿåœ¨ä½•å¤„è½¬å˜æˆ–ç ´åâ€ï¼›å¯¹constç‰¹æ€§çš„ä¸¥æ§ï¼Œè®©ç±»å‹ç³»ç»Ÿæ›´å¥å£®ã€‚</p>
</li>
<li>
<p>æ´¾ç”Ÿç±»é‡Œç›´æ¥è°ƒç”¨åŸºç±»æˆå‘˜å‡½æ•°æ—¶ï¼Œä¸è¦ç”¨è½¬å‹</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SpecialWindow</span><span class="o">:</span><span class="k">public</span> <span class="n">Window</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">onResize</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="n">Window</span><span class="o">::</span><span class="n">onResize</span><span class="p">();</span><span class="c1">//ä¸è¦ä½¿ç”¨ static_cast&lt;Window&gt;(*this).onResize();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å…³äºdynamic_castéœ€è¦æ³¨æ„çš„</p>
<ol>
<li>å¦‚ä½•æ›¿ä»£å’Œé¿å…
ä¸€èˆ¬æ˜¯æŒæœ‰ä¸€ä¸ª<code>Base *pBase</code>ï¼Œä½†æ˜¯æŒ‡å‘çš„æ˜¯DerivedObjï¼Œäºæ˜¯è½¬å‹ä¸ºpDerived</li>
</ol>
<ul>
<li>å¯ä»¥è¿™æ ·ä¿®æ”¹ï¼š
ä¿®æ”¹è®¾è®¡ï¼Œçª„åŒ–ç±»å‹ï¼ŒæŒæœ‰ä¸€ä¸ªpDerivedå³å¯ï¼›æˆ–è€…å°†æƒ³åšçš„äº‹æ”¾åˆ°è™šå‡½æ•°ä¸­ï¼Œåˆ©ç”¨å¤šæ€å»å®Œæˆã€‚</li>
</ul>
<ol start="2">
<li>é¿å…ä¸²è”
é¿å…ä¸‹æ–¹è¿™æ ·çš„ä»£ç ï¼Œä¸€è¿ä¸²çš„dynamic_castï¼š</li>
</ol>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Window</span><span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å®šä¹‰å­ç±» SpecialWindow1,SpecalWindow2,SpecialWindow3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Window</span><span class="o">*</span> <span class="n">winPtr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// çœç•¥winPtrçš„å…¶ä»–æ“ä½œ ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="n">SpecialWindow1</span> <span class="o">*</span><span class="n">psw1</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">SpecialWindow1</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">winPtr</span><span class="p">)){</span> <span class="p">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>  <span class="nf">if</span><span class="p">(</span><span class="n">SpecialWindow2</span> <span class="o">*</span><span class="n">psw2</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">SpecialWindow2</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">winPtr</span><span class="p">)){</span> <span class="p">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>  <span class="nf">if</span><span class="p">(</span><span class="n">SpecialWindow3</span> <span class="o">*</span><span class="n">psw3</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">SpecialWindow3</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">winPtr</span><span class="p">)){</span> <span class="p">...</span> <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·çš„ä»£ç åˆå¤§åˆæ…¢ï¼Œæ¯æ¬¡ç»§æ‰¿ä½“ç³»æœ‰æ‰€æ”¹å˜ï¼Œä»£ç å°±éœ€è¦é‡æ–°æ£€é˜…åˆ¤æ–­ã€‚è¿™æ ·çš„ä»£ç åº”è¯¥ç”¨â€œåŸºäºvirtualå‡½æ•°è°ƒç”¨â€å–ä»£å®ƒã€‚</p>
</li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>è‡ª <strong>C++11</strong> èµ·ï¼Œé’ˆå¯¹æ™ºèƒ½æŒ‡é’ˆ shared_ptr çš„è½¬å‹ï¼Œæ¨å‡ºäº†å¦å¤– 4 ä¸ªæ¨¡ç‰ˆå‡½æ•°ï¼š</p>
<ul>
<li><code>std::static_pointer_cast</code>
å‡½æ•°çš„åŸå‹å£°æ˜ä¸ºï¼š
<div class="highlight" id="id-47"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">U</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">static_pointer_cast</span><span class="p">(</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&amp;</span> <span class="n">r</span> <span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>å«ä¹‰ä»¥åŠåº”ç”¨åœºæ™¯ä¸ <code>static_cast</code> ç±»ä¼¼ï¼Œæ¯”å¦‚å­ç±»å‹æŒ‡é’ˆè½¬ä¸ºçˆ¶ç±»å‹ï¼š
<div class="highlight" id="id-48"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">basePtr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">derivedPtr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Derived</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">basePtr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">static_pointer_cast</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="p">(</span><span class="n">derivedPtr</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div>æˆ–è®¸æˆ‘ä»¬ä¼šæœ‰ç–‘é—®ï¼Œæ˜¯å¦æœ‰å¿…è¦ç”¨è¿™ä¸ªå‡½æ•°è¿›è¡Œè½¬å‹å‘¢ï¼Œå¦‚ä¸‹å®ç°ä¸æ˜¯ä¸€æ ·çš„å—?
<div class="highlight" id="id-49"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">basePtr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">derivedPtr</span><span class="p">.</span><span class="n">get</span><span class="p">()));</span></span></span></code></pre></td></tr></table>
</div>
</div>ğŸ¤” å½“ç„¶ä¸ä¸€æ ·ï¼Œstatic_cast&lt;T*&gt;((U*)nullptr)æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼Œè€Œä¸”å°±è¯­æ³•æè¿°ä¸Šæ¥çœ‹ï¼Œå“ªä¸ªæ›´ç®€æ´ä¸è¨€è‡ªæ˜ã€‚
å¦å¤–ï¼Œè‡ª C++20 èµ·æ”¯æŒå³å€¼å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹å½¢å¼ï¼š
<div class="highlight" id="id-50"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">U</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">static_pointer_cast</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&amp;&amp;</span> <span class="n">r</span> <span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><code>std::dynamic_pointer_cast</code>
å«ä¹‰ä»¥åŠåº”ç”¨åœºæ™¯ä¸ dynamic_cast ç±»ä¼¼ï¼Œç”¨æ³•ä¼ å‚ä¸ std::static_pointer_cast ç±»ä¼¼ï¼Œä¸”è‡ª C++20 èµ·æ”¯æŒå³å€¼å¼•ç”¨ï¼Œä¸èµ˜è¿°ã€‚</li>
<li><code>std::const_pointer_castï¼š</code>ä¸å‰ 2 è€…ç±»ä¼¼ï¼Œä¸èµ˜è¿°ã€‚</li>
<li><code>std::reinterpret_pointer_castï¼š</code>ä¸å‰ 3 è€…ç±»ä¼¼ï¼Œä¸èµ˜è¿°ã€‚</li>
</ul>
</div>
    </div>
  </div>
<h3 id="r28-é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†">R28 é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†</h3>
<p>è¿™é‡Œçš„<strong>handlesï¼ˆå·ç ç‰Œï¼‰åŒ…æ‹¬</strong>æŒ‡å‘å¯¹è±¡å†…éƒ¨çš„<strong>æŒ‡é’ˆ</strong>ã€<strong>è¿­ä»£å™¨</strong>ã€<strong>å¼•ç”¨</strong>ã€‚</p>
<p>ä»¥ä¸‹è®²è¿°å½“è¿”å›å¯¹è±¡å†…éƒ¨çš„handlesæ—¶ï¼Œå­˜åœ¨çš„2ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>å¯èƒ½ä¼šç ´åå°è£…æ€§
è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼špublicå‡½æ•°è¿”å›ä¸€ä¸ªprivateæˆå‘˜çš„éconstå¼•ç”¨ï¼Œå°±è®©å¤–ç•Œæœ‰äº†ä¿®æ”¹privateçš„æœºä¼šï¼Œç ´åäº†å°è£…æ€§ã€‚
æ­¤æ—¶ï¼Œéœ€è¦å°†éconstå¼•ç”¨æ”¹ä¸ºconstå¼•ç”¨ï¼Œåªè¯»å±æ€§ã€‚
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Pixel</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">float</span> <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Image</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>  <span class="c1">//æ³¨æ„ï¼šåé¢è¿™conståªä¿è¯æˆå‘˜å˜é‡vPixPtrs_ä¸æ”¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Pixel</span><span class="o">&amp;</span> <span class="n">GetThePixel</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>  <span class="n">vPixPtrs_</span><span class="p">[</span><span class="n">i</span><span class="p">];}</span><span class="c1">//éšæ‚£ï¼šå…¶å®å¤–éƒ¨è°ƒç”¨è€…ä»èƒ½ç›´æ¥ä¿®æ”¹Pixelçš„rgbå€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ä¸Šä¸€å¥çš„è¿”å›å€¼åº”è¯¥æ”¹ä¸º &#34;const Pixel&amp;&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pixel</span><span class="o">&gt;&gt;</span> <span class="n">vPixPtrs_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>å¯èƒ½ä¼šå¼•èµ·â€œç©ºæ‚¬handlesâ€
å³ä½¿ç”¨constè§£å†³äº†å°è£…æ€§çš„é—®é¢˜ï¼Œå› ä¸ºå¾ˆå®¹æ˜“å‡ºç°**â€œhandlesæ¯”å…¶æ‰€æŒ‡å¯¹è±¡æ›´é•¿å¯¿â€**ï¼Œå¯èƒ½å­˜åœ¨å¯¹è±¡å·²ææ„ï¼Œä½†handlesè¿˜ç•™å­˜çš„é—®é¢˜ã€‚å°¤å…¶æ˜¯ä¸´æ—¶å˜é‡çš„ææ„ï¼Œä¸å¤ªå®¹æ˜“å¯Ÿè§‰ã€‚
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SceneGraph</span><span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">Image</span> <span class="nf">CaptureImage</span><span class="p">(</span><span class="k">const</span> <span class="n">SceneGraph</span><span class="o">&amp;</span> <span class="n">graph</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//é‚£ä¹ˆè°ƒç”¨æ–¹å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">SceneGraph</span> <span class="n">Grap</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ä¸‹é¢è¿™å¥ä¹‹åï¼ŒImageä¸´æ—¶å¯¹è±¡è¢«é”€æ¯ï¼ŒpPixæŒ‡å‘ä¸€ä¸ªä¸å­˜åœ¨çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="n">Pixel</span> <span class="o">*</span><span class="n">pPix</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">CaptureImage</span><span class="p">(</span><span class="n">Grap</span><span class="p">).</span><span class="n">GetThePixel</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div>æ³¨æ„ï¼ŒCaptureImageçš„ç¡®èƒ½è¿”å›ä¸€ä¸ªä¸´æ—¶Imageå¯¹è±¡ï¼Œèƒ½æˆåŠŸè°ƒç”¨GetThePixelï¼Œä½†è¿™å¥ç»“æŸåï¼Œä¸´æ—¶å¯¹è±¡ç«‹é©¬ä¼šè¢«é”€æ¯ï¼Œé€ æˆç©ºæ‚¬ç°è±¡ï¼Œæˆ–å«è™šåŠ(dangling) ï¼</li>
</ul>
<h3 id="r29-ä¸ºå¼‚å¸¸å®‰å…¨è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„">R29 ä¸ºâ€œå¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„</h3>
<p>â€œ<strong>å¼‚å¸¸å®‰å…¨</strong>â€æ˜¯æŒ‡ï¼Œå½“å¼‚å¸¸æŠ›å‡ºæ—¶ï¼Œä»£ç ä¾ç„¶èƒ½åšåˆ°å¦‚ä¸‹2ç‚¹ï¼š</p>
<ol>
<li>ä¸æ³„éœ²ä»»ä½•èµ„æº
åŒ…æ‹¬å†…å­˜èµ„æºï¼Œé”èµ„æºã€‚</li>
<li>ä¸å…è®¸æ•°æ®è´¥å
ä¸ä¼šå› ä¸ºå¼‚å¸¸è€Œå¯¼è‡´ç©ºæ‚¬æŒ‡é’ˆç­‰æœªå®šä¹‰è¡Œä¸ºã€‚</li>
</ol>
<p>è€ƒè™‘ä¸‹æ–¹çš„ç¤ºä¾‹ä»£ç ï¼Œï¼ˆå¦‚æœ<code>new Image</code>æŠ›<code>std::bad_alloc</code>å¼‚å¸¸ï¼‰åˆ™ä¼šåŒæ—¶è¿èƒŒäº†ä¸Šè¿°2æ¡ï¼š</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PrettyMenu</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Mutex</span> <span class="n">mutex_</span><span class="p">;</span> <span class="c1">//äº’æ–¥å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Image</span><span class="o">*</span> <span class="n">bgImage_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">imageChangeCnt_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="n">PrettyMenu</span><span class="o">::</span><span class="n">changeBackground</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="o">&amp;</span> <span class="n">imgSrc</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_</span><span class="p">);</span><span class="c1">// è¿™ä¸ªå¯ä»¥æ”¹ä¸ºRAIIçš„é”ï¼Œæ¥ä¿è¯å¼‚å¸¸å®‰å…¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">delete</span> <span class="n">bgImage_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">++</span><span class="n">imageChangeCnt_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è¿™é‡Œnew ImageæŠ›å¼‚å¸¸ï¼Œå¯¼è‡´æ— æ³•è§£é”ï¼›ä¸”bgImage_æŒ‡å‘èµ„æºå·²ç»é‡Šæ”¾ï¼Œç©ºæ‚¬æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">bgImage_</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Image</span><span class="p">(</span><span class="n">imageSrc_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¼‚å¸¸å®‰å…¨çš„3ä¸ªç­‰çº§">å¼‚å¸¸å®‰å…¨çš„3ä¸ªç­‰çº§</h4>
<p>å¼‚å¸¸å®‰å…¨çš„å‡½æ•°ï¼Œæœ‰<strong>3ä¸ªç­‰çº§</strong>çš„å¼‚å¸¸å®‰å…¨ä¿è¯ï¼Œä¼šæ»¡è¶³<strong>ä¸‰è€…ä¹‹ä¸€</strong>ï¼š</p>
<ul>
<li>
<p><strong>åŸºæœ¬æ‰¿è¯º</strong>
å¦‚æœå¼‚å¸¸è¢«æŠ›å‡ºï¼Œç¨‹åºå†…çš„ä»»ä½•äº‹åŠ¡ä»ç„¶ä¿æŒåœ¨æœ‰æ•ˆçŠ¶æ€ä¸‹ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•æ•°æ®è´¥åã€‚æ¯”å¦‚ä¸Šä¾‹ä¸­å¦‚æœæŠ›å¼‚å¸¸ï¼Œä¼šå¦å¤–æ·»åŠ å®ç°ï¼Œä½¿bgImage_æŒæœ‰æŸä¸ªé»˜è®¤å›¾åƒï¼Œæˆ–ä¿æŒåŸå€¼ï¼Œè®©ç¨‹åºç»§ç»­æœ‰æ•ˆè¿è¡Œã€‚</p>
</li>
<li>
<p><strong>å¼ºçƒˆä¿è¯</strong>
å¦‚æœå¼‚å¸¸è¢«æŠ›å‡ºï¼Œç¨‹åºçŠ¶æ€ä¸æ”¹å˜ã€‚è¿™æ ·çš„å‡½æ•°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆé€€å›åˆ°æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚</p>
<p>ä¸Šè¿°æ¡ˆä¾‹åˆ™åº”è¯¥ä¼šè¢«ä¿®æ”¹æˆå¦‚ä¸‹å½¢å¼ï¼š</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PrettyMenu</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Image</span><span class="o">&gt;</span> <span class="n">bgImage_</span><span class="p">;</span> <span class="c1">//RAIIé¿å…äº†å¼‚å¸¸å‘ç”Ÿæ—¶çš„èµ„æºæ³„æ¼å’Œæ•°æ®è´¥å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//... çœç•¥å…¶ä»–æˆå‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="n">PrettyMenu</span><span class="o">::</span><span class="n">changeBackground</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="o">&amp;</span> <span class="n">imgSrc</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">CLock</span> <span class="nf">ml</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_</span><span class="p">);</span><span class="c1">//RAIIå°è£…çš„Lockç±»ï¼Œè¯¦ç»†å¯å‚è€ƒ é˜…è¯»æ€»ç»“(äºŒ)-Rule14
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">bgImage_</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span> <span class="n">Image</span><span class="p">(</span><span class="n">imgSrc</span><span class="p">));</span><span class="c1">//è‹¥newå¤±è´¥ï¼Œåˆ™ä¸ä¼šreset
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">++</span><span class="n">imageChangeCnt_</span><span class="p">;</span><span class="c1">//æŠŠäº‹æƒ…åšå®Œå†++count
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>ä¸æŠ›å¼‚å¸¸</strong>
åœ¨åŸä¹¦ä¸­ï¼Œè¿™ä¸ªâ€œNo Throwâ€ä¸æ˜¯ç»å¯¹ä¸æŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯ä¸€æ—¦æ„å¤–æŠ›å¼‚å¸¸ï¼Œå°±ä¼šè°ƒç”¨unexpectedå‡½æ•°è¿›è€Œabortï¼ˆä¾‹å¦‚<code>int doSomething() throw();//ç©ºç™½çš„å¼‚å¸¸æ˜ç»†</code>ï¼‰ã€‚</p>
</li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>åŸä¹¦ä¸­ä¾‹å­çš„ <strong>throw()</strong> åœ¨ä¸åŒç¼–è¯‘å™¨è¡¨ç°ä¸ä¸€è‡´ï¼Œç°åœ¨å·²ç» <strong>ä¸æ¨èä½¿ç”¨</strong>ã€‚</p>
<p>æ›´è¯¦ç»†èµ„æ–™å¯å‚è€ƒ<a href="http://gotw.ca/publications/mill22.htm"target="_blank" rel="external nofollow noopener noreferrer">A Pragmatic Look at Exception Specifications<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>å’Œ<a href="https://stackoverflow.com/questions/88573/should-i-use-an-exception-specifier-in-c"target="_blank" rel="external nofollow noopener noreferrer">Should I use an exception specifier in C++<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>åœ¨C++11ä¸­ï¼Œæœ‰äº†æ›´å¯é æœ‰æ•ˆçš„å…³é”®å­—noexceptï¼Œä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œæœ‰æ“ä½œç¬¦å’Œå¼‚å¸¸æç¤ºç¬¦ä¸¤ç§ä½œç”¨ï¼Œä¸‹æ–¹å±•ç¤ºç®€å•ç”¨æ³•ï¼š</p>
<div class="highlight" id="id-51"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">f</span><span class="p">()</span> <span class="k">noexcept</span><span class="p">;</span> <span class="c1">// å‡½æ•° f() ä¸ä¼šæŠ›å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fp</span><span class="p">)()</span> <span class="k">noexcept</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span> <span class="c1">// fp æŒ‡å‘å¯èƒ½ä¼šæŠ›å‡ºçš„å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">g</span><span class="p">(</span><span class="kt">void</span> <span class="n">pfa</span><span class="p">()</span> <span class="k">noexcept</span><span class="p">);</span>  <span class="c1">// g æ¥æ”¶æŒ‡å‘ä¸ä¼šæŠ›å‡ºçš„å‡½æ•°çš„æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1">// typedef int (*pf)() noexcept; // é”™è¯¯
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ›´è¯¦ç»†çš„<code>noexcept</code>ä»‹ç»å¯ä»¥è®¿é—®<a href="https://zh.cppreference.com/w/cpp/language/noexcept"target="_blank" rel="external nofollow noopener noreferrer">cppreferenceï¼šnoexceptæ“ä½œç¬¦<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>å’Œ<a href="https://zh.cppreference.com/w/cpp/language/noexcept_spec"target="_blank" rel="external nofollow noopener noreferrer">cppreferenceï¼šnoexceptå¼‚å¸¸è¯´æ˜ç¬¦<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
</div>
    </div>
  </div>
<h4 id="ä½¿ç”¨copy-and-swapä¿éšœå¼‚å¸¸å®‰å…¨">ä½¿ç”¨copy-and-swapä¿éšœå¼‚å¸¸å®‰å…¨</h4>
<p><code>copy-and-swap</code>æŠ€æœ¯ï¼šå…ˆæ‹·è´ä¸€ä»½æƒ³ä¿®æ”¹çš„å¯¹è±¡ï¼Œç­‰ä¿®æ”¹å½»åº•å®Œæˆåï¼ˆè¿‡ç¨‹ä¸­ä¸æŠ›å¼‚å¸¸ï¼‰ï¼Œå†ä¸åŸå¯¹è±¡äº¤æ¢ã€‚</p>
<p>ä¸ºäº†æ›´å½¢è±¡å±•ç¤ºè¿™ä¸€è¿‡ç¨‹ï¼Œä½¿ç”¨pImlæ‰‹æ³•å¯¹bgImage_å°è£…ä¸€ä¸‹ï¼š</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">ImgPimpl</span><span class="p">{</span> <span class="c1">//é€‰ç”¨structè€ŒéClassï¼šæ–¹ä¾¿ï¼›æœ€åè¢«privateæˆå‘˜å½¢å¼ä½¿ç”¨ï¼Œå°è£…æ€§ä¸ç”¨æ‹…å¿ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Image</span><span class="o">&gt;</span> <span class="n">bgImage_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="kt">int</span> <span class="n">imageChangeCnt_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆPrettyMenuç±»å¯ä»¥æ”¹ä¸ºå¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PrettyMenu</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Mutex</span> <span class="n">mutex_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ImgPimpl</span><span class="o">&gt;</span> <span class="n">pImpl_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>  <span class="c1">//æ„é€ ç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="n">PrettyMenu</span><span class="o">::</span><span class="n">changeBackground</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="o">&amp;</span> <span class="n">imgSrc</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>   <span class="c1">//å‚è€ƒ é˜…è¯»æ€»ç»“(äºŒ)-Rule25
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">CLock</span> <span class="nf">ml</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_</span><span class="p">);</span><span class="c1">//RAIIå°è£…çš„Lockç±»ï¼Œè¯¦ç»†å¯å‚è€ƒæ€»ç»“(äºŒ)-Rule14
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ImgPimpl</span><span class="o">&gt;</span> <span class="n">pNewCopy</span><span class="p">(</span><span class="k">new</span> <span class="n">ImgPimpl</span><span class="p">(</span><span class="o">*</span><span class="n">pImpl_</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">pNewCopy</span><span class="o">-&gt;</span><span class="n">bgImage_</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span> <span class="n">Image</span><span class="p">(</span><span class="n">imgSrc</span><span class="p">));</span> <span class="c1">//ä¿®æ”¹å‰¯æœ¬
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">++</span><span class="n">pNewCopy</span><span class="o">-&gt;</span><span class="n">imageChangeCnt_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">swap</span><span class="p">(</span><span class="n">pImpl_</span><span class="p">,</span><span class="n">pNewCopy</span><span class="p">);</span><span class="c1">//æ”¹å®Œä¹‹åswap
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¼‚å¸¸å®‰å…¨çš„è¿å¸¦å½±å“side-effects">å¼‚å¸¸å®‰å…¨çš„è¿å¸¦å½±å“(side effects)</h4>
<p>å‡½æ•°æä¾›çš„â€œå¼‚å¸¸å®‰å…¨ä¿è¯ç­‰çº§â€åª<strong>å–å†³äº</strong>å…¶è°ƒç”¨çš„<strong>å„ä¸ªå­å‡½æ•°çš„â€œæœ€ä¸å®‰å…¨è€…â€</strong>ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹å‡½æ•°SomeFuncä»£ç ï¼š</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">SomeFunc</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span> <span class="c1">// å¯¹localçŠ¶æ€åšä¸€ä»½å‰¯æœ¬
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">f1</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">f2</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>  <span class="c1">//å°†ä¿®æ”¹åçš„çŠ¶æ€ç½®æ¢è¿‡æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong><code>åˆ†æ</code></strong>ï¼šæ˜¾ç„¶copy-and-swapåœ¨å°½åŠ›å¼ºçƒˆä¿è¯å¼‚å¸¸å®‰å…¨ï¼Œä½†æ˜¯ï¼Œf1æˆ–è€…f2çš„å¼‚å¸¸å®‰å…¨å¦‚æœæ¯”è¾ƒä½ï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦å•ç‹¬å¯¹f1ï¼Œf2è¿›è¡Œcopy-and-swapï¼Œæ¥å°è¯•ä¿è¯â€œå¼ºçƒˆå¼‚å¸¸å®‰å…¨â€ï¼›å³ä½¿å¦‚æ­¤ï¼Œå¦‚æœf1èƒ½æˆåŠŸåšäº†ä¿®æ”¹ï¼Œä½†æ˜¯f2ä¿®æ”¹å¤±è´¥äº†å¹¶å›é€€ï¼Œé‚£ä¹ˆ<strong>f1ã€f2æ•´ä½“</strong>çœ‹èµ·æ¥è¿˜æ˜¯â€œ<strong>æ”¹äº†ä¸€éƒ¨åˆ†</strong>â€ã€‚</p>
<p><strong><code>è¿™ä¹Ÿå‘Šè¯«æˆ‘ä»¬</code></strong>ï¼Œå¦‚æœå¼•å…¥äº†å¼‚å¸¸ä¸å®‰å…¨çš„æ—§ä»£ç ï¼Œé‚£ä¹ˆè¿™ç§ç‰¹æ€§ä¼šæ³¢åŠå…¶ä»–ä»£ç ã€‚</p>
<p>å°±è®¾è®¡è€…è€Œè¨€ï¼Œåªèƒ½æ ¹æ®å®é™…æƒ…å†µï¼Œå°½å¯èƒ½ä¿è¯â€œå¼‚å¸¸å®‰å…¨â€ï¼Œé€‰æ‹©3ä¸ªå¼‚å¸¸å®‰å…¨ç­‰çº§ä¹‹ä¸€å®æ–½ã€‚</p>
<h3 id="r30-é€å½»äº†è§£inlineçš„é‡Œé‡Œå¤–å¤–">R30 é€å½»äº†è§£inlineçš„é‡Œé‡Œå¤–å¤–</h3>
<p><code>inline</code>æ˜¯C++çš„å…³é”®å­—ï¼Œè¡¨ç¤ºå†…è”å‡½æ•°ã€‚<code>ç›´æ¥åœ¨å¯¹åº”ä½ç½®å±•å¼€ä»£ç </code>ï¼Œå…å»å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼Œéš¾ä»¥é¿å… â€œ<strong>ä»£ç è†¨èƒ€</strong>â€é—®é¢˜ã€‚</p>
<p>ä½¿ç”¨inlineæ—¶åº”è¯¥æ³¨æ„ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>
<p><strong>inlineåªæ˜¯å¯¹ç¼–è¯‘å™¨çš„ç”³è¯·</strong>
inlineåªæ˜¯å¯¹ç¼–è¯‘å™¨çš„ç”³è¯·/å»ºè®®ï¼Œä¸æ˜¯å¼ºåˆ¶å‘½ä»¤ï¼Œ<strong>ç¼–è¯‘å™¨æœ‰æƒåˆ©</strong> å¯¹å…¶è®¤ä¸ºä¸é€‚åˆinlineçš„å‡½æ•°<strong>æ‹’ç»</strong>inlineã€‚ ï¼ˆåŸä¹¦è¯´ï¼šå¦‚æœç¼–è¯‘å™¨æ‹’ç»ï¼Œé€šå¸¸å®ƒä¼šç»™å‡ºwarningä¿¡æ¯ã€‚å®é™…æœ¬äººå®æµ‹VS2017æ²¡çœ‹åˆ°ï¼‰
inlineæœ‰2ç§ç”³è¯·æ–¹å¼ ï¼š</p>
<ol>
<li>åœ¨å‡½æ•°å®šä¹‰ æ—¶ä½¿ç”¨å…³é”®å­—inline<strong>æ˜¾å¼å¼ºè°ƒ</strong></li>
<li>å®ç°åœ¨Classå†…çš„æˆå‘˜å‡½æ•°æˆ–friendå‡½æ•°ï¼Œå±äº<strong>éšå¼inline</strong></li>
</ol>
</li>
<li>
<p><strong>inlineå’ŒTemplateæ²¡æœ‰ä»»ä½•å¿…ç„¶è”ç³»</strong>
è™½ç„¶æœ‰ä¸å°‘ç®€çŸ­çš„Templateå‡½æ•°æ˜¯å¸¦æœ‰inlineï¼ˆä¾‹å¦‚ä¸‹æ–¹çš„std::maxï¼‰ï¼Œä½†ä¸æ˜¯å¿…ç„¶ä¸ºä¹‹ï¼Œ<strong>ä¸¤è€…æ²¡æœ‰å› æœå…³ç³»</strong>ã€‚</p>
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">inline</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">){</span> <span class="c1">//å¯ä»¥ç”³è¯·inlineï¼Œä½†ä¸æ˜¯å¿…é¡»ç”³è¯·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="o">?</span> <span class="nl">b</span> <span class="p">:</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>ç¼–è¯‘å™¨æ‹’ç»å¤æ‚å‡½æ•°è¿›è¡Œinline</strong>
å¤æ‚å‡½æ•°çš„inlineä¼šå¸¦æ¥è¾ƒä¸¥é‡çš„â€œä»£ç è†¨èƒ€â€é—®é¢˜ï¼Œå¹¶ä¸”å¯èƒ½ä¼šæ›´æ…¢ï¼Œå› ä¸ºå¢åŠ äº†è¿è¡Œæ—¶çš„â€œé¢å¤–æ¢é¡µâ€è¡Œä¸ºï¼Œé™ä½äº†æŒ‡ä»¤cacheå‘½ä¸­ç‡ã€‚</p>
<ol>
<li>inlineå‡½æ•°å†…ä¸è¦å‡ºç°å¾ªç¯æˆ–é€’å½’</li>
<li>è™šå‡½æ•°ä¹Ÿä¸é€‚åˆåšinline
å› ä¸ºinlineæ˜¯ç¼–è¯‘æœŸé—´å†³å®šçš„äº‹ï¼Œè€Œè™šå‡½æ•°æ˜¯è¿è¡Œæ—¶å†³å®šçš„äº‹ï¼Œä¸¤è€…å°±ä¸æ˜¯åŒä¸€ä¸ªåœºæ™¯çš„ã€‚</li>
<li>æ„é€ /ææ„å‡½æ•°ä¹Ÿä¸é€‚åˆåšinline
ç¼–è¯‘å™¨å¯èƒ½ä¼šåœ¨æ„é€ /ææ„å‡½æ•°å†…éƒ¨åšç²¾å¦™å¤æ‚çš„å¼‚å¸¸å¤„ç†ï¼›ä»¥åŠåœ¨ç»§æ‰¿ä½“ç³»ä¸‹ï¼ŒBaseç±»å‡½æ•°ä½“åˆ°å¤„inlineè†¨èƒ€ã€‚</li>
</ol>
</li>
<li>
<p><strong>ä»¥å‡½æ•°æŒ‡é’ˆå½¢å¼çš„è°ƒç”¨é€šå¸¸ä¸èƒ½inline</strong>
å¯¹ç»å¤§å¤šæ•°ç¼–è¯‘å™¨è€Œè¨€ï¼Œæ˜¯å¦inlineæ˜¯compileé˜¶æ®µå†³å®šçš„äº‹æƒ…ï¼Œå°‘æ•°ç¼–è¯‘å™¨æ”¾åˆ°äº†linké˜¶æ®µã€‚</p>
<p>è®¨è®ºå¤§å¤šæ•°æƒ…å†µï¼šéœ€è¦åœ¨ç¼–è¯‘æ—¶å¾—çŸ¥inlineçš„æœ¬ä½“ï¼Œè€Œå‡½æ•°æŒ‡é’ˆåŠä¸åˆ°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kr">inline</span> <span class="kt">void</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{...}</span> <span class="c1">//å‡è®¾ç¼–è¯‘å™¨æœ‰æ„æ„¿inline â€œå¯¹fçš„è°ƒç”¨â€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span> <span class="n">pf</span><span class="p">)()</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span><span class="c1">//pf æ‰§è¡Œf
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="p">();</span>     <span class="c1">//è¿™ä¸ªè°ƒç”¨å°†è¢«inlinedï¼Œå› ä¸ºæ˜¯ä¸ªæ­£å¸¸è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pf</span><span class="p">();</span>     <span class="c1">//è¿™ä¸ªå¾ˆå¯èƒ½ä¸è¢«inlined
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>è¿‡åº¦inlineå¯¹è°ƒè¯•å’Œå‘å¸ƒå¸¦æ¥å›°éš¾</strong>
inlineæ˜¯ä»£ç åµŒå…¥ä¸å±•å¼€ï¼Œè€Œéå‡½æ•°è°ƒç”¨ï¼Œæ‰€ä»¥æŸäº›ç¼–è¯‘å™¨ä¸æ”¯æŒinlineçš„å•æ­¥Debugï¼ˆå°±åƒå®å±•å¼€ä¸€æ ·ä¸æ”¯æŒè°ƒè¯•ï¼‰ï¼›å¦å¤–ï¼Œinlineåªè¦å·²ä¿®æ”¹ï¼Œæ¶‰åŠè°ƒç”¨å®ƒçš„ä»£ç å…¨éƒ½è¦ç¼–è¯‘ï¼Œå¦‚æœæ˜¯non-inlineåˆ™å¯èƒ½åªéœ€è¦é‡æ–°linkå³å¯ã€‚</p>
</li>
</ul>
<h3 id="r31-å°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾èµ–å…³ç³»é™è‡³æœ€ä½">R31 å°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾èµ–å…³ç³»é™è‡³æœ€ä½</h3>
<p>C++çš„Classå®šä¹‰å¼åŒ…æ‹¬äº†æˆå‘˜å˜é‡ï¼Œå‡è®¾æŸæˆå‘˜å˜é‡æ˜¯ç±»å¯¹è±¡<code>ClassObjA a</code>ï¼Œå¦‚æœ<code>ClassObjA</code>ç±»çš„å†…éƒ¨å®ç°å‘ç”Ÿäº†æ”¹å˜ï¼ˆå“ªæ€•è¿™ä¸ª<code>ClassObjA.h</code>å†…åªåœ¨æŸå¤„åŠ äº†ä¸€ä¸ªç©ºæ ¼ ï¼‰ï¼Œé‚£ä¹ˆincludeäº†<code>ClassObjA.h</code>çš„æ‰€æœ‰<code>.h</code>æ–‡ä»¶<code>.cpp</code>æ–‡ä»¶éƒ½ä¼š<strong>é‡æ–°ç¼–è¯‘</strong>ã€‚</p>
<p>ğŸ‘†è¿™å°±æ˜¯ç”±â€œ<strong>ç¼–è¯‘ä¾èµ–</strong>â€å…³ç³»å¸¦æ¥çš„é—®é¢˜ã€‚</p>
<p>ä½¿ç”¨ <code>PIMPL</code> æ‰‹æ³•(pointer to implementation)å¯ä»¥å¾ˆå¥½åœ°åˆ†ç¦»å£°æ˜å’Œå®šä¹‰ï¼š</p>
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//Person.hæ–‡ä»¶  ä¸éœ€è¦include &#34;PersonImpl.h&#34;å’Œ&#34;BirthDay.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">PersonImpl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BirthDay</span><span class="p">;</span><span class="c1">// å‰ç½®å£°æ˜ä»£æ›¿include
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Person</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span><span class="c1">// æ„é€ å‡½æ•°è¿™é‡Œæ”¾å®ç°æ— æ‰€è°“ï¼Œå› ä¸ºæ˜¯å‡½æ•°æŒ‡é’ˆï¼Œä¸éœ€çŸ¥é“PersonImplæœ¬ä½“å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Person</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">PersonImpl</span><span class="o">&gt;&amp;</span> <span class="n">pImpl</span><span class="p">);</span><span class="c1">//æ„é€ å‡½æ•°çš„å®ç°ä¹Ÿæ”¾åˆ°cppé‡Œå»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="n">BirthDay</span><span class="o">&amp;</span> <span class="n">GetBirthDay</span><span class="p">();</span><span class="c1">// æ³¨æ„ï¼šè¿™é‡Œåªå£°æ˜ï¼ŒæŠŠå®ç°éƒ¨åˆ†æ”¾åˆ°cppé‡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetName</span><span class="p">();</span><span class="c1">//å®ç°ç»†èŠ‚ç”±pImpl_è½¬å‘å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">PersonImpl</span><span class="o">&gt;</span> <span class="n">pImpl_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">//Person.cppæ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&#34;PersonImpl.h&#34; //åœ¨&#34;PersonImpl.h&#34;æ–‡ä»¶å†…includeé‚£ä¸ª&#34;BirthDay.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;Person.h&#34;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼šImplç”¨æ³•ï¼Œç›¸å…³çš„å¤´æ–‡ä»¶é‡Œä¸è¦æ”¾ç½®ä»»ä½•å‡½æ•°å®ç°ä»£ç  ã€‚
ä¸Šè¿°åšæ³•å¯ä»¥è®©ä½¿ç”¨Personç±»çš„å®¢æˆ·ä¸éœ€è¦å†å…³å¿ƒPersonImplä»¥åŠBirthDayçš„å®ç°ç»†èŠ‚äº†ï¼Œåšåˆ°äº†â€œæ¥å£ä¸å®ç°åˆ†ç¦»â€ï¼Œå…³é”®ç‚¹åœ¨äºæŠŠâ€œå®šä¹‰çš„ä¾èµ–æ€§â€ æ¢æˆ $\Rightarrow$ â€œ<strong>å£°æ˜çš„ä¾èµ–æ€§</strong>â€ã€‚
è¿™é‡Œçªå‡ºäº†å¦‚ä½•<strong>æœ€å°åŒ–ç¼–è¯‘ä¾èµ–æ€§</strong>çš„æœ¬è´¨ï¼š<code>è®©å¤´æ–‡ä»¶å°½å¯èƒ½è‡ªæˆ‘æ»¡è¶³</code>ï¼Œå¦‚æœä¸è¡Œï¼Œä¹Ÿè¦ä¾èµ–äºå…¶ä»–æ–‡ä»¶çš„å£°æ˜å¼è€Œéå®šä¹‰å¼ã€‚</p>
<p>å…·ä½“åˆ°è®¾è®¡ç­–ç•¥ä¸Šï¼Œæœ‰ä»¥ä¸‹å‡ ç§åšæ³•ï¼š</p>
<ul>
<li>
<p>å¦‚æœèƒ½ç”¨object references æˆ– object pointerså®Œæˆä»»åŠ¡ï¼Œå°±åˆ«ç”¨objects
å¦‚æœè¦å®šä¹‰æŸç±»å‹çš„objectsï¼Œå°±è¦ä½¿ç”¨å®šä¹‰å¼ï¼ŒæŒ‡é’ˆå’Œåº”ç”¨åˆ™å¯ä»¥åªç”¨å£°æ˜å¼ã€‚</p>
</li>
<li>
<p>å°½é‡ä»¥classå£°æ˜å¼æ›¿æ¢classå®šä¹‰å¼
å‡½æ•°å£°æ˜ç§çš„Classç±»å‹å¯ä»¥åªç”¨å£°æ˜å¼ï¼Œå³ä½¿ä»¥by-object-valueå½¢å¼ä¼ å€¼ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
</li>
<li>
<p>ä¸ºå£°æ˜å¼å’Œå®šä¹‰å¼æä¾›ä¸åŒçš„æ–‡ä»¶
æ¯”å¦‚Dateç±»ï¼Œåˆ†ä¸ºåªåŒ…å«å£°æ˜å¼çš„&quot;Datefwd.h&quot;å’ŒåŒ…å«å®šä¹‰å¼çš„&quot;Date.h&quot;ï¼Œé‚£ä¹ˆä½¿ç”¨æ—¶ç”¨å£°æ˜å¼å¤´æ–‡ä»¶ä»£æ›¿å‰ç½®å£°æ˜ï¼Œåœ¨éœ€è¦åº”ç”¨ä»£ç client.cppé‡Œincludeå®šä¹‰å¼å¤´æ–‡ä»¶ã€‚è¿™ç§æ–¹å¼åœ¨æ ‡å‡†åº“é‡Œé‡‡ç”¨è¾ƒå¤šï¼Œå‚è€ƒ<iosfwd>å’Œ<sstream>,<fstream>,<streambuf>ç­‰ã€‚</p>
</li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><ul>
<li>C/C++å¯ä»¥ä½¿ç”¨ç¼–è¯‘å™¨é¢„å¤„ç†æŒ‡ä»¤<font color=red><code>#pragma message</code></font>ï¼Œæ‰“å°å‡ºè¯¥æ–‡ä»¶æ˜¯å¦å‚ä¸æ­¤æ¬¡ç¼–è¯‘ï¼Œä»¥åŠå‚ä¸ç¼–è¯‘æ—¶è¢«å“ªä¸ªæ–‡ä»¶æ‰€ä¾èµ–ã€‚
<div class="highlight" id="id-52"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//æ¯”å¦‚å¯ä»¥åœ¨ testEffective.h æ–‡ä»¶å†…åŠ ä¸Šè¿™å¥ï¼Œå°±èƒ½åœ¨ç¼–è¯‘è¾“å‡ºä¿¡æ¯é‡Œçœ‹åˆ°æ‰“å°ä¿¡æ¯ï¼Œè§‚å¯Ÿåˆ°ä¾èµ–å…³ç³»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#pragma message(&#34;testEffective.h å‚ä¸é‡æ–°ç¼–è¯‘&#34;)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">//è¿˜å¯ä»¥ç”¨äºæµ‹è¯•æŸäº›å®æ˜¯å¦çœŸçš„ç”Ÿæ•ˆï¼Œæœ‰æ—¶IDEçš„é«˜äº®æ˜¾ç¤ºä¸å‡†ç¡®è€Œä»¤äººç”Ÿç–‘ã€‚
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>å…³äºå¤´æ–‡ä»¶includeçš„å…¶ä»–ç¼–å†™è§„èŒƒï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/headers/#"target="_blank" rel="external nofollow noopener noreferrer">Google-C++é£æ ¼æŒ‡å—ï¼š1.å¤´æ–‡ä»¶<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
</ul>
</div>
    </div>
  </div>
<p>ä½¿ç”¨ <font color><strong><code>Interface Class</code></strong></font> ä¹Ÿèƒ½åšåˆ°æ¥å£å’Œå®ç°çš„çœŸæ­£åˆ†ç¦»ï¼š</p>
<p>è¿™ç§æ–¹å¼å¸¸è§äºè¾“å‡ºåŠ¨æ€åº“ç»™åˆ°å®¢æˆ·ä½¿ç”¨ï¼Œå®¢æˆ·èƒ½è§åˆ°æ¥å£å®šä¹‰å’Œä½¿ç”¨ï¼Œä½†æ— æ³•çœ‹åˆ°å†…éƒ¨å®ç°ã€‚</p>
<p>ç”¨æ³•è¾ƒä¸ºå¸¸è§ï¼Œä¸èµ˜è¿°ï¼Œç›´æ¥<strong>show-code</strong>ï¼š</p>
<div class="highlight" id="id-16"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//VirtualPerson.h   //å’Œ libæ–‡ä»¶ä¸€èµ·æä¾›ç»™åˆ°å®¢æˆ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">VirtualPerson</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> <span class="c1">//createçš„è¿”å›å€¼è¿˜å¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œæ¢æˆRAIIçš„æ™ºèƒ½æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">static</span> <span class="n">VirtualPerson</span> <span class="o">*</span> <span class="n">create</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">int</span> <span class="n">salary</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Level</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Salary</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">VirtualPerson</span><span class="p">();</span><span class="c1">// avoid memory leak
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">//VirtualPerson.cpp  //æºç ä¸æä¾›ç»™å®¢æˆ·ï¼Œè€Œæ˜¯ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ libæ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">VirtualPerson</span><span class="o">*</span> <span class="n">VirtualPerson</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">int</span> <span class="n">salary</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">level</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//å·¥å‚æ–¹æ³•ï¼Œè¿˜å¯ä»¥ç”Ÿæˆå…¶ä»–å­ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="k">new</span> <span class="nf">Engineer</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">salary</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">VirtualPerson</span><span class="o">::~</span><span class="n">VirtualPerson</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Engineer.h  //Engineerä¹Ÿæ˜¯å‚ä¸ç¼–è¯‘åˆ° libæ–‡ä»¶ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Engineer</span><span class="o">:</span> <span class="k">public</span> <span class="n">VirtualPerson</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Engineer</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span><span class="kt">int</span> <span class="n">salary</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Level</span><span class="p">()</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Salary</span><span class="p">()</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">level_</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">salary_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ch6-ç»§æ‰¿ä¸é¢å‘å¯¹è±¡è®¾è®¡">CH6. ç»§æ‰¿ä¸é¢å‘å¯¹è±¡è®¾è®¡</h2>
<h3 id="r32-ç¡®å®šä½ çš„publicç»§æ‰¿å¡‘é€ å‡ºis-aå…³ç³»">R32 ç¡®å®šä½ çš„publicç»§æ‰¿å¡‘é€ å‡ºis-aå…³ç³»</h3>
<p>åŸä¹¦æ ‡é¢˜ï¼š<strong>Make sure public inheritance models â€œis-aâ€</strong>. ä¾¯æ·è€å¸ˆç¿»è¯‘ä¸ºâ€œå¡‘æ¨¡â€ï¼Œæˆ‘ä¸ªäººæ›´æ„¿æ„ç§°ä¸ºâ€œå¡‘é€ â€ã€‚</p>
<ul>
<li><strong>â€œpublicç»§æ‰¿â€æ„å‘³ç€is-a</strong>
is-aï¼Œå³â€œæ˜¯ä¸€ç§â€ï¼Œå°±æ˜¯è¯´ï¼Œé€‚ç”¨äºBase Classèº«ä¸Šçš„æ¯ä¸€ä»¶äº‹ï¼Œä¹Ÿä¸€å®šé€‚ç”¨äºDerived Classèº«ä¸Šã€‚</li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>é¢å‘è®¾è®¡å¯¹è±¡çš„è®¾è®¡æœ‰è‘—åçš„5å¤§åŸåˆ™ï¼Œ SOLID åŸåˆ™ï¼Œæ¯ä¸ªå­—æ¯åˆ†åˆ«ä»£è¡¨ä¸€ç§åŸåˆ™ï¼š</p>
<ul>
<li>Sâ€“å•ä¸€è´£ä»»åŸåˆ™(SRP) â€“Single Responsibility Principle</li>
<li>Oâ€“å¼€æ”¾å°é—­åŸåˆ™(OCP)â€“ Open-Closed Principle</li>
<li>Lâ€“é‡Œå¼æ›¿æ¢åŸåˆ™(LSP)â€“ Liskov Substitution Principle</li>
<li>I â€“- æ¥å£åˆ†ç¦»åŸåˆ™(ISP)â€“Interface Segregation Principle</li>
<li>Dâ€“-ä¾èµ–å€’ç½®åŸåˆ™(DIP)â€“ Dependency Inversion Principle</li>
</ul>
<p>æ›´è¯¦ç»†çš„å™è¿°å¯ä»¥å‚è€ƒï¼š<a href="https://cloud.tencent.com/developer/article/1503629"target="_blank" rel="external nofollow noopener noreferrer">è…¾è®¯äº‘ï¼šSOLIDåŸåˆ™<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
</div>
    </div>
  </div>
<p>æœ¬èŠ‚æ¡æ¬¾çš„ä¸­å¿ƒæ€æƒ³å³é‡Œæ°æ›¿æ¢åŸåˆ™ï¼š<strong>ä¸€ä¸ªå¯¹è±¡å‡ºç°çš„åœ°æ–¹éƒ½å¯ä»¥ç”±å…¶å­ç±»ä»£æ›¿å¹¶ä¸”ä¸ä¼šå‡ºé”™ã€‚</strong></p>
<p>ç»§æ‰¿å…³ç³»æœ‰æ—¶å€™å¬èµ·æ¥å¾ˆå¥½ç†è§£ï¼Œæ¯”å¦‚ <code>Class Student: public Person</code>ç†æ‰€åº”å½“ï¼Œä½†æœ‰æ—¶ä¹Ÿä¼šå¯¼è‡´è¯¯è§£ã€‚æ¯”å¦‚ä¼é¹…å±äºé¸Ÿç±»ï¼Œä½†ä¼é¹…ä¸ä¼šé£ï¼Œé‚£ä¹ˆåŸºç±»<code>Bird::Fly</code>æ–¹æ³•åˆå½“å¦‚ä½•å¤„ç†ï¼Œä¸‹æ–¹æ»¡è¶³è®¾è®¡æ„å›¾ï¼š</p>
<div class="highlight" id="id-17"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Bird</span><span class="p">{</span>   <span class="c1">//... ä¸å£°æ˜Fly()æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FylingBird</span><span class="o">:</span><span class="k">public</span> <span class="n">Bird</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Fly</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Penguin</span><span class="o">:</span> <span class="k">public</span> <span class="n">Bird</span><span class="p">{</span> <span class="c1">//... ä¸å£°æ˜Fly()æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ³¨ï¼šå¦‚æœBirdç±»ä»¥åŠå­ç±»éƒ½ä¸è€ƒè™‘Fly()æ–¹æ³•ï¼Œé‚£ä¹ˆPenguinç›´æ¥ç»§æ‰¿äºBirdå³å¯
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿˜æœ‰å¦ä¸€ç§åœºæ™¯ï¼Œçˆ¶ç±»å’Œå­ç±»å¯¹äºåŒä¸€ä¸ªæ–¹æ³•çš„æ•°æ®ä¿®æ”¹è§„åˆ™ä¸åŒï¼Œå¯¼è‡´äº†ç»§æ‰¿ä½“ç³»çš„ç¼ºé™·ã€‚
æ¯”å¦‚<code>Class Square:public Rectangle</code> $\rightarrow$ æ­£æ–¹å½¢ç»§æ‰¿äºé•¿æ–¹å½¢ï¼Œä½†æ˜¯è€ƒè™‘è¿™æ ·ä¸€ä¸ª<strong>ç±»å¤–æ–¹æ³•</strong>:</p>
<div class="highlight" id="id-18"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">makeBigger</span><span class="p">(</span><span class="n">Rectangle</span><span class="o">&amp;</span> <span class="n">r</span><span class="p">){</span>  <span class="c1">//æ™®é€šéæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">oldHeight</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">height</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="p">.</span><span class="n">setWidth</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span><span class="c1">//å¦‚æœræ˜¯Squqreï¼Œå¯èƒ½å†…éƒ¨è‡ªåŠ¨å°±é•¿å®½ä¸€èµ·å˜äº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">assert</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">==</span> <span class="n">oldHeight</span><span class="p">);</span><span class="c1">//è¿™ä¸ªassertå¯¹äºæ­£æ–¹å½¢å°±ä¸åˆé€‚äº†,è´¸ç„¶å»é™¤åˆè¿èƒŒè®¾è®¡æœ¬æ„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åº”å¯¹ä¸Šè¿°è¿™æ ·çš„æƒ…å†µï¼Œå°±éœ€è¦ä¿®æ”¹è®¾è®¡æˆ–ä¿®æ”¹ç»§æ‰¿ä½“ç³»äº†ã€‚</p>
<h3 id="r33-é¿å…é®æ©ç”±ç»§æ‰¿å¾—æ¥çš„åç§°">R33 é¿å…é®æ©ç”±ç»§æ‰¿å¾—æ¥çš„åç§°</h3>
<p>é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯åç§°çš„é®æ©ï¼Œé€šä¿—åœ°è¯´ï¼Œæ˜¯æŒ‡ç”±äºä½œç”¨åŸŸä¸åŒå¸¦æ¥çš„å˜é‡åè¦†ç›–ã€‚è€ƒè™‘ä¸‹æ–¹ä»£ç ï¼š</p>
<div class="highlight" id="id-19"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">someFunc</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;x is&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// localä½œç”¨åŸŸæ‰¾åˆ°äº†xï¼Œç›´æ¥è¦†ç›–å…¨å±€çš„xï¼Œè¾“å‡º0.1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆå¦‚æœå°†ç»§æ‰¿ä½“ç³»è€ƒè™‘è¿›æ¥å‘¢ï¼š<strong>Derivedçš„ä½œç”¨åŸŸä¼šè¦†ç›–Baseçš„ä½œç”¨åŸŸ</strong>ï¼ŒåŒ…æ‹¬virtualå’Œnon-virtualã€‚è€ƒè™‘ä¸‹æ–¹ä»£ç ï¼š</p>
<div class="highlight" id="id-20"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Base</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">mf1</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">mf1</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Base::mf1():x =&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">mf2</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Base::mf2()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">mf3</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Base::mf3()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">mf3</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Base::mf3():x =&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Base</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Derived</span> <span class="o">:</span><span class="k">public</span> <span class="n">Base</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">mf1</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Derived::mf1()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">mf3</span><span class="p">(){</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Derived::mf3()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¾ˆæ˜æ˜¾å­˜åœ¨åç§°é®æ©çš„é—®é¢˜ï¼ŒDerivedçš„mf1ï¼Œmf3ä¼šé®æ©å­ç±»çš„æ‰€æœ‰åŒåå‡½æ•°ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-21"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">Derived</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="p">.</span><span class="n">mf1</span><span class="p">();</span>      <span class="c1">//OKï¼Œè¾“å‡º: Derived::mf1()
</span></span></span><span class="line"><span class="cl"><span class="c1">//d.mf1(100);  ç¼–è¯‘æŠ¥é”™ï¼Œå› ä¸ºåç§°è¢«é®æ©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">d</span><span class="p">.</span><span class="n">mf2</span><span class="p">();</span>      <span class="c1">//OKï¼Œè¾“å‡º: Base::mf2()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">d</span><span class="p">.</span><span class="n">mf3</span><span class="p">();</span>      <span class="c1">//OKï¼Œè¾“å‡º: Derived::mf3()
</span></span></span><span class="line"><span class="cl"><span class="c1">//d.mf3(300);  ç¼–è¯‘æŠ¥é”™ï¼ŒåŒç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">d</span><span class="p">.</span><span class="n">Base</span><span class="o">::</span><span class="n">mf3</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span> <span class="c1">//OKï¼Œè¾“å‡º: Base::mf3():x =300 . ä½†æ˜¯ä¸å¤ªå»ºè®®è¿™ä¹ˆå†™ï¼Œä¸‘ï¼ï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨usingå£°æ˜å¼æˆ–è½¬å‘å‡½æ•°
<ol>
<li>using å£°æ˜å¼
å¯ä»¥ä½¿ç”¨usingå£°æ˜å¼ï¼Œè®©Derivedå¯ä»¥å¿½ç•¥åç§°é®æ©ï¼Œçœ‹åˆ°Baseä½œç”¨åŸŸå†…çš„å‡½æ•°ã€‚å¯ä»¥è®©ä¸Šæ–¹ä»£ç çš„â€œç¼–è¯‘æŠ¥é”™â€æ¶ˆå¤±ï¼Œæ­£å¸¸è°ƒç”¨d.mf1(100)å’Œd.mf3(300)ã€‚
<div class="highlight" id="id-22"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"> <span class="k">class</span> <span class="nc">Derived</span> <span class="o">:</span><span class="k">public</span> <span class="n">Base</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> <span class="c1">//ä¿®æ”¹æœ¬èŠ‚å†…å®¹ä¸­ä¸Šæ–¹ä»£ç çš„Derivedç±»çš„å£°æ˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="k">using</span> <span class="n">Base</span><span class="o">::</span><span class="n">mf1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="k">using</span> <span class="n">Base</span><span class="o">::</span><span class="n">mf3</span><span class="p">;</span> <span class="c1">//è¿™2ä¸ªusingä½¿å¾—Baseç±»ä½œç”¨åŸŸå†…æ‰€æœ‰mf1,mf3å‡½æ•°éƒ½å¯è§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="c1">// ... å…¶ä»–ï¼Œç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>è½¬å‘å‡½æ•°(forwarding function)
åº”ç”¨åœºæ™¯: åœ¨privateç»§æ‰¿ä¸‹ï¼Œå¼ºè°ƒçš„æ˜¯ç»§æ‰¿å®ç°è€Œéç»§æ‰¿æ¥å£ï¼Œå¦‚æœæƒ³åœ¨å­ç±»çš„æˆå‘˜ä¸­è°ƒç”¨çˆ¶ç±»å‡½æ•°ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡å‡½æ•°è½¬å‘æ¥å®ç°ã€‚</li>
</ol>
<div class="highlight" id="id-23"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Derived</span><span class="o">:</span> <span class="k">private</span> <span class="n">Base</span><span class="p">{</span> <span class="c1">//æ”¹å†™æœ¬èŠ‚ä¸Šæ–¹ä»£ç ï¼Œæ³¨æ„ï¼Œæ˜¯ç§æœ‰ç»§æ‰¿
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">mf1</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">Base</span><span class="o">::</span><span class="n">mf1</span><span class="p">();</span> <span class="c1">//æ‹¿åˆ°äº†çˆ¶ç±»çš„å‡½æ•°å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// ... è¯¥å‡½æ•°å…¶ä»–éƒ¨åˆ†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åº”ç”¨ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Derived</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="p">.</span><span class="n">mf1</span><span class="p">();</span>    <span class="c1">//è°ƒç”¨æˆåŠŸï¼ŒDerived::mf1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">d</span><span class="p">.</span><span class="n">mf1</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>  <span class="c1">//ç¼–è¯‘å¤±è´¥
</span></span></span></code></pre></td></tr></table>
</div>
</div>å½“ç„¶ï¼Œpublicç»§æ‰¿ä¹Ÿèƒ½ä½¿ç”¨è½¬å‘å‡½æ•°ï¼Œå†™å‡º<code>d.Base::mf3(300)</code>; è¿™æ ·çš„ä»£ç ã€‚ä½†æ˜¯ï¼Œä¸€æ¥publicç»§æ‰¿ç†åº”éµå¾ª&quot;is-a&quot;è§„åˆ™ï¼Œusingå£°æ˜æ‹¿åˆ°æ‰€æœ‰è¢«é®æ©çš„æ¥å£ï¼›äºŒæ¥æ˜æ˜¾ä»£ç ä¸ç¾è§‚ã€‚</li>
</ul>
<h3 id="r34-åŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿">R34 åŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿</h3>
<p>å½“ä¸€ä¸ªå­ç±»Derivedç»§æ‰¿äºçˆ¶ç±»Baseï¼Œé‚£ä¹ˆè¦æ—¶åˆ»æ¸…æ¥šï¼Œå¯¹äºç±»ä¸­çš„æˆå‘˜å‡½æ•°ï¼Œæ˜¯æƒ³ç»§æ‰¿çˆ¶ç±»çš„æ¥å£ï¼Œè¿˜æ˜¯æƒ³ç»§æ‰¿çˆ¶ç±»çš„å®ç°ã€‚</p>
<ul>
<li>
<p><strong>å¯¹äºPublicç»§æ‰¿ï¼Œæ¥å£æ€»æ˜¯ä¼šè¢«ç»§æ‰¿</strong>
åŸºäºâ€œ<strong>is-a</strong>â€çš„å…³ç³»ï¼Œä½œç”¨äºçˆ¶ç±»çš„ä»»ä½•äº‹æƒ…ä¹Ÿä¸€å®šè¦é€‚ç”¨äºå­ç±»ã€‚</p>
</li>
<li>
<p><strong>å£°æ˜çº¯è™šå‡½æ•°(pure-virtual)çš„ç›®çš„æ˜¯è®©å­ç±»åªç»§æ‰¿å‡½æ•°æ¥å£</strong>
å¯¹äºçº¯è™šå‡½æ•°ï¼Œå­ç±»å¿…é¡»é‡æ–°å®ç°è¯¥æ¥å£ã€‚æ³¨æ„ï¼Œ<code>çˆ¶ç±»å¯ä»¥é€‰æ‹©æ€§ç»™å‡ºçº¯è™šå‡½æ•°çš„å®ç°</code>ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ä¼šç»™ã€‚</p>
</li>
<li>
<p><strong>éšæ‚£ï¼šä»éçº¯è™šå‡½æ•°(impure-virtual)åŒæ—¶ç»§æ‰¿æ¥å£å’Œç¼ºçœå®ç°</strong>
éçº¯è™šå‡½æ•°ï¼Œå¯ä»¥è®©å­ç±»é€‰æ‹©æ˜¯å¦é‡æ–°å®ç°è¯¥æ¥å£ã€‚é‚£ä¹ˆï¼Œå¦‚æœå­ç±»æ˜¯æœ‰å¿…è¦é‡å†™ï¼Œä½†æ˜¯<strong>å¿˜è®°å†™äº†</strong>å´é»˜é»˜ç”¨çˆ¶ç±»ç‰ˆæœ¬ï¼Œä¾¿äº‹ä¸æ„¿è¿äº†ã€‚
ä¸¾ä¾‹ï¼šçˆ¶ç±»Airplaneæœ‰å­ç±»PlaneModelAã€PlaneModelBã€PlaneModelCï¼Œå…¶ä¸­Cå‹é£æœºä¸åŒäºABå‹ï¼Œæ˜¯æ–°å¼é£æœºï¼š</p>
<div class="highlight" id="id-24"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Airport</span> <span class="p">{...};</span><span class="c1">//æœºåœºç±»ï¼Œå®ç°ç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Airplane</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">fly</span><span class="p">(</span><span class="k">const</span> <span class="n">Airport</span><span class="o">&amp;</span> <span class="n">destination</span><span class="p">);</span><span class="c1">//çˆ¶ç±»è¿˜ä¼šç»™å‡ºé»˜è®¤çš„flyå®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PlaneModelA</span><span class="o">:</span> <span class="k">public</span> <span class="n">Airplane</span><span class="p">{</span> <span class="p">...</span> <span class="p">};</span> <span class="c1">// ä¸é‡å†™flyï¼Œç»§æ‰¿çˆ¶ç±»çš„flyå®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">PlaneModelB</span><span class="o">:</span> <span class="k">public</span> <span class="n">Airplane</span><span class="p">{</span> <span class="p">...</span> <span class="p">};</span> <span class="c1">// Bå’ŒAä¸€æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">PlaneModelC</span><span class="o">:</span> <span class="k">public</span> <span class="n">Airplane</span><span class="p">{</span> <span class="p">...</span> <span class="p">};</span> <span class="c1">//æ–°å‹é£æœºï¼Œæœ¬æ¥è¦é‡å†™flyï¼Œç»“æœå¿˜äº†
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆè¿™ä¸ª<code>éšæ‚£è¯¥å¦‚ä½•è§£å†³</code>å‘¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å®ç°Cå‹é£æœºç±»æ—¶åˆ«å¿˜äº†flyæ–¹æ³•ï¼Ÿ
æ ¸å¿ƒæ€æƒ³æ˜¯â€œ<strong>åˆ‡æ–­virtualå‡½æ•°æ¥å£å’Œå…¶é»˜è®¤å®ç°ä¹‹é—´çš„è¿æ¥</strong>â€ã€‚</p>
<ol>
<li>æ–¹æ³•1ï¼šè®¾ç½®flyä¸ºçº¯è™šå‡½æ•°ï¼Œå¹¶æ–°å¢ä¸€ä¸ªdefaultyFlyæ–¹æ³•
æ³¨æ„ç»†èŠ‚ï¼šdefaultFlyæ–¹æ³•è¦è®¾ç½®ä¸ºprotectedå±æ€§çš„non-virtualå‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š
<div class="highlight" id="id-25"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Airplane</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">fly</span><span class="p">(</span><span class="k">const</span> <span class="n">Airport</span><span class="o">&amp;</span> <span class="n">destination</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="c1">// çˆ¶ç±»ä¸ç»™å‡ºå®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">defaultFly</span><span class="p">(</span><span class="k">const</span> <span class="n">Airport</span><span class="o">&amp;</span> <span class="n">destination</span><span class="p">){</span> <span class="p">...</span> <span class="p">}</span><span class="c1">//é»˜è®¤çš„flyå®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PlaneModelA</span><span class="o">:</span> <span class="k">public</span> <span class="n">Airplane</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>   <span class="c1">//çº¯è™šæ¥å£,å­ç±»å¿…é¡»ç»™å‡ºå®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">fly</span><span class="p">(</span><span class="k">const</span> <span class="n">Airport</span><span class="o">&amp;</span> <span class="n">destination</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">defaultFly</span><span class="p">(</span><span class="n">destination</span><span class="p">);</span> <span class="c1">//è°ƒç”¨çˆ¶ç±»çš„ç¼ºçœå®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span><span class="c1">//PlaneModelB å’Œ PlaneModelA ç±»ä¼¼,ç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">PlaneModelC</span><span class="o">:</span> <span class="k">public</span> <span class="n">Airplane</span><span class="p">{</span> <span class="p">...};</span><span class="c1">// é‡å†™flyæ–¹æ³•
</span></span></span></code></pre></td></tr></table>
</div>
</div>è¿™æ ·å†™è¿˜æœ‰ä¸ªå¥½å¤„ï¼šfly()å’ŒdefaultFly()äº«æœ‰ä¸åŒçš„ä¿æŠ¤çº§åˆ«ã€‚</li>
<li>æ–¹æ³•2ï¼š çˆ¶ç±»çš„é»˜è®¤å®ç°å¡åˆ°çº¯è™šæ¥å£flyä¸­
è¿™æ ·å°±ä¸éœ€è¦å®šä¹‰defaultFlyæ–¹æ³•äº†ï¼Œå› ä¸ºå­ç±»å¿…é¡»å®ç°flyæ–¹æ³•ï¼Œå¯¹äºA å‹ã€Bå‹é£æœºï¼Œå­ç±»fly()è½¬å‘ä¸€æ¬¡çˆ¶ç±»çš„fly()å³å¯ï¼ŒCç±»é£æœºå®ç°æ–°å¼çš„fly()ã€‚ç¼ºç‚¹æ˜¯è®©åŸæœ¬åœ¨defaultFlyå†…çš„å®ç°å†…å®¹æš´éœ²åœ¨å¤–äº†(æŒ‡publicå±æ€§)ã€‚
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><pre><code>  ä¸ªäººè®¤ä¸ºï¼Œè¿™æ–¹æ³•2è¿˜æœ‰ä¸ªç¼ºç‚¹ï¼šå®ƒè®©è™šåŸºç±»çš„çº¯è™šæ¥å£æ‰¿è½½äº†æ¥å£å®ç°ï¼Œä¸å¤Ÿçº¯ç²¹(æ¯”å¦‚éœ€è¦è¾“å‡ºç»™åˆ°å®¢æˆ·ï¼Œåº”è¯¥åªç»§æ‰¿æ¥å£)ã€‚
</code></pre>
</div>
    </div>
  </div></li>
</ol>
</li>
<li>
<p><strong>non-virtualå‡½æ•°å…·ä½“æŒ‡å®šæ¥å£ç»§æ‰¿å’Œå¼ºåˆ¶æ€§å®ç°ç»§æ‰¿</strong>
å¦‚æœæˆå‘˜å‡½æ•°æ˜¯non-virtualï¼Œè¡¨ç¤ºå®ƒä¸æ‰“ç®—åœ¨å­ç±»ä¸­æœ‰ä¸åŒçš„è¡Œä¸ºï¼Œæˆ–è€…è¯´ï¼Œä¸å˜æ€§å‡Œé©¾äºç‰¹å¼‚æ€§ã€‚å¯¹åº”åœ°ï¼Œç»ä¸åº”è¯¥åœ¨å­ç±»ä¸­é‡å†™non-virtualå‡½æ•°ã€‚</p>
</li>
</ul>
<h3 id="r35-è€ƒè™‘virtualå‡½æ•°çš„æ›¿ä»£é€‰æ‹©">R35 è€ƒè™‘virtualå‡½æ•°çš„æ›¿ä»£é€‰æ‹©</h3>
<p>å‡è®¾è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šè®¾è®¡ä¸€æ¬¾æ¸¸æˆï¼Œä¸åŒäººç‰©ä»¥ä¸åŒæ–¹å¼è®¡ç®—ç”Ÿå‘½å€¼ï¼Œé‚£ä¹ˆ$\Longrightarrow$ è®¾è®¡ç»§æ‰¿ä½“ç³»ï¼Œå­ç±»å…±åŒç»§æ‰¿çˆ¶ç±»çš„public-virtualæ–¹æ³•healthValue()ï¼Œå­ç±»å„è‡ªé‡æ–°å®ç°healthValue()æ¥å£ã€‚</p>
<p>ğŸ˜„å¾ˆå¥½ï¼Œä¸­è§„ä¸­çŸ©ï¼Œé‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰å…¶ä»–æ–¹å¼å‘¢ï¼Ÿ</p>
<ul>
<li>
<p><strong><code>NVIæ‰‹æ³•(non-virtual interface)å®ç°Template Methodæ¨¡å¼</code></strong>
æ€è·¯å°±æ˜¯çˆ¶ç±»å®šä¹‰ä¸ªnon-virtualçš„publicæ–¹æ³•healthValue()ï¼Œè°ƒç”¨virtualçš„privateæ–¹æ³•healthValueImplã€‚å­ç±»ç›´æ¥é‡å†™healthValueImplï¼Œè¾¾åˆ°ç±»ä¼¼æ¨¡ç‰ˆæ–¹æ³•è®¾è®¡æ¨¡å¼çš„æ•ˆæœã€‚
çˆ¶ç±»<code>GameCharacter</code>è®¾è®¡å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-26"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">GameCharacter</span><span class="p">{</span><span class="c1">//æ„é€ å‡½æ•°å’Œè™šææ„å‡ç•¥å»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">healthValue</span><span class="p">()</span><span class="k">const</span><span class="p">{</span> <span class="c1">//ps:æ–¹ä¾¿å±•ç¤ºï¼Œè€Œå†™åœ¨äº†å¤´æ–‡ä»¶é‡Œï¼Œæˆäº†inline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&#34;Do prepare works...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span><span class="c1">//äº‹å‰ï¼Œå¦‚åŠ é”,å†™log,éªŒè¯æ¡ä»¶ç­‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">int</span> <span class="n">retVal</span> <span class="o">=</span> <span class="n">healthValueImpl</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">Do post works...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span><span class="c1">//äº‹å,å¦‚è§£é”,æ›´æ–°æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">retVal</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="n">healthValueImpl</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">val</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;default caculate process... GetValue:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">val</span><span class="p">;</span><span class="c1">//éšåè¿›è¡Œè®¡ç®—ï¼Œè¿‡ç¨‹ç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å­ç±»<code>GoodGuy</code>å’Œ<code>BadGuy</code>è®¾è®¡å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-27"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">GoodGuy</span><span class="o">:</span><span class="k">public</span> <span class="n">GameCharacter</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="n">healthValueImpl</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;goodGuy caculate ... GetValue: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span><span class="p">;</span><span class="c1">//è¿‡ç¨‹ç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BadGuy</span><span class="o">:</span><span class="k">public</span> <span class="n">GameCharacter</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="n">healthValueImpl</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;badGuy caculate ... GetValue: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span><span class="p">;</span><span class="c1">//è¿‡ç¨‹ç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åº”ç”¨ç«¯ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-28"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">GameCharacter</span><span class="o">&gt;</span> <span class="n">pGood</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">GoodGuy</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">pGood</span><span class="o">-&gt;</span><span class="n">healthValue</span><span class="p">();</span> <span class="c1">//å¾—åˆ°60
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">GameCharacter</span><span class="o">&gt;</span> <span class="n">pBad</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">BadGuy</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">pBad</span><span class="o">-&gt;</span><span class="n">healthValue</span><span class="p">();</span><span class="c1">//å¾—åˆ°80
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong><code>ç”¨å‡½æ•°æŒ‡é’ˆå®ç°Strategyæ¨¡å¼</code></strong>
ä¸»ä½“æ€æƒ³æ˜¯æ·»åŠ ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆä¸ºprivateæˆå‘˜å˜é‡pFuncï¼Œè¿™ä¸ªå‡½æ•°é€šè¿‡å¤–éƒ¨ä¼ å…¥ï¼Œä»è€Œå®ç°ä¸åŒçš„è¡Œä¸ºã€‚</p>
<div class="highlight" id="id-29"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">GameCharacter</span><span class="p">;</span><span class="c1">//forward declaration
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">defaultHealthCalc</span><span class="p">(</span><span class="k">const</span> <span class="n">GameCharacter</span><span class="o">&amp;</span> <span class="n">gc</span><span class="p">);</span><span class="c1">//é»˜è®¤ç®—æ³•å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">GameCharacter</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">HealthCalcFunc</span><span class="p">)(</span><span class="k">const</span> <span class="n">GameCharacter</span><span class="o">&amp;</span> <span class="n">gc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">explicit</span> <span class="nf">GameCharacter</span><span class="p">(</span><span class="n">HealthCalcFunc</span> <span class="n">hcf</span> <span class="o">=</span> <span class="n">defaultHealthCalc</span><span class="p">)</span><span class="o">:</span><span class="n">calcFunc_</span><span class="p">(</span><span class="n">hcf</span><span class="p">){}</span><span class="c1">//ä¼ å…¥å‡½æ•°æŒ‡é’ˆ,è‡ªå®šä¹‰å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="nf">healthValue</span><span class="p">()</span><span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">calcFunc_</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">HealthCalcFunc</span> <span class="n">calcFunc_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªè®¾è®¡æœ‰2ä¸ªæœ‰è¶£çš„<strong>è®¾è®¡å¼¹æ€§</strong>ï¼š</p>
<ol>
<li>å³ä½¿åŒä¸€ä¸ªäººç‰©ç±»å‹çš„ä¸åŒå®ä½“ï¼Œå…è®¸æ‹¥æœ‰ä¸åŒçš„ç”Ÿå‘½å€¼è®¡ç®—æ–¹æ³•ï¼›</li>
<li>æŸä¸ªäººç‰©å¯¹è±¡çš„ç”Ÿå‘½å€¼è®¡ç®—æ–¹æ³•ï¼Œåœ¨å…¶ç”Ÿå‘½æœŸå†…å¯ä»¥ä»»æ„ä¿®æ”¹ï¼Œåªè¦æ·»åŠ ä¸€ä¸ªsetæ–¹æ³•å³å¯ï¼›</li>
</ol>
</li>
<li>
<p><strong><code>ç”¨std::functionå®ç°Strategyæ¨¡å¼</code></strong>
privateæˆå‘˜å˜é‡ç”±ä¸Šæ–‡çš„å‡½æ•°æŒ‡é’ˆæ›¿æ¢æˆstd::functionå¯¹è±¡ï¼Œç›¸å½“äºæ˜¯<code>æŒ‡å‘å‡½æ•°çš„æ³›åŒ–æŒ‡é’ˆ</code>ã€‚å°±<code>æ›´å…·è®¾è®¡å¼¹æ€§</code>äº†ã€‚std::functionå¯ä»¥ä¼ å…¥å‡½æ•°æŒ‡é’ˆã€ä»¿å‡½æ•°ã€std::bindå‡½æ•°å¯¹è±¡ã€‚GameCharacterçš„ç±»å®ç°ä¿®æ”¹ä¸ºï¼š</p>
<div class="highlight" id="id-30"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">GameCharacter</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">int</span> <span class="p">(</span><span class="k">const</span> <span class="n">GameCharacter</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span>  <span class="n">healthCalcFunc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="nf">GameCharacter</span><span class="p">(</span><span class="n">healthCalcFunc</span> <span class="n">hcf</span> <span class="o">=</span> <span class="n">defaultHealthCalc</span><span class="p">)</span><span class="o">:</span><span class="n">healthValueImpl_</span><span class="p">(</span><span class="n">hcf</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">healthValue</span><span class="p">()</span><span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&#34;Do prepare works...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">retVal</span> <span class="o">=</span> <span class="n">healthValueImpl_</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span> <span class="c1">// è¿™é‡Œæ”¹äº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">Do post works...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">retVal</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">healthCalcFunc</span> <span class="n">healthValueImpl_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>ä¼ å…¥å‡½æ•°æŒ‡é’ˆ</li>
</ol>
<div class="highlight" id="id-31"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"> <span class="n">gameChashort</span> <span class="nf">quickHurtHealthCalc</span><span class="p">(</span><span class="k">const</span> <span class="n">GameCharacter2</span><span class="o">&amp;</span> <span class="n">gc</span><span class="p">);</span><span class="c1">//è¿”å›å€¼ä¸æ˜¯int,å¯éšå¼è½¬æ¢;å®ç°ç•¥å»
</span></span></span><span class="line"><span class="cl"><span class="c1">//åº”ç”¨ç«¯ä»£ç å¦‚ä¸‹ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">GameCharacter</span> <span class="nf">quickGuy</span><span class="p">(</span><span class="n">quickHurtHealthCalc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">quickGuy</span><span class="p">.</span><span class="n">healthValue</span><span class="p">();</span><span class="c1">//å†…éƒ¨è°ƒç”¨quickHurtHealthCalc
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>ä¼ å…¥ä»¿å‡½æ•°
ä»¿å‡½æ•°ï¼šå³å‡½æ•°å¯¹è±¡ï¼Œè€Œä¸”é‡è½½äº†operator() ã€‚</li>
</ol>
<div class="highlight" id="id-32"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">HealthCalculator</span><span class="p">{</span><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">GameCharacter2</span><span class="o">&amp;</span> <span class="n">gc</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">180</span><span class="p">;</span><span class="c1">//çœç•¥å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">//åº”ç”¨ç«¯ä»£ç å¦‚ä¸‹ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">GameCharacter</span> <span class="nf">functorGuy</span><span class="p">(</span> <span class="p">(</span><span class="n">HealthCalculator</span><span class="p">())</span> <span class="p">);</span><span class="c1">//ç”¨æ‹¬å·å°†ä»¿å‡½æ•°æ‹¬èµ·æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">functorGuy</span><span class="p">.</span><span class="n">healthValue</span><span class="p">();</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>ä¼ å…¥<code>std::bind</code>å‡½æ•°å¯¹è±¡
std::bindæ˜¯å‡½æ•°å¯¹è±¡æ¨¡æ¿ï¼Œæ¥æ”¶ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆfå’Œè‹¥å¹²å‡½æ•°å…¥å‚å¾—åˆ°fObjï¼Œè°ƒç”¨fObjç­‰åŒäºè°ƒç”¨å¸¦å‚æ•°çš„fã€‚æœ¬ä¾‹ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight" id="id-33"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">GameLevel</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> <span class="c1">//ç”¨ç±»å†…å‡½æ•°ä½œä¸ºå‡½æ•°æŒ‡é’ˆf
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">health</span><span class="p">(</span><span class="k">const</span> <span class="n">GameCharacter</span><span class="o">&amp;</span> <span class="n">gc</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">-</span><span class="mf">20.3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">//åº”ç”¨ç«¯ä»£ç å¦‚ä¸‹ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">GameLevel</span>  <span class="n">curLevel</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">GameCharacter</span> <span class="nf">levelGuy</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GameLevel</span><span class="o">::</span><span class="n">health</span><span class="p">,</span> <span class="n">curLevel</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">levelGuy</span><span class="p">.</span><span class="n">healthValue</span><span class="p">();</span><span class="c1">//å†…éƒ¨è°ƒç”¨ç­‰ä»·äºcurLevel.health(leveGuy);
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><pre><code>å…¶å®è¿™é‡Œä¼ å…¥C++11æ–°å¢çš„Lambdaè¡¨è¾¾å¼ä½œä¸ºstd::functionä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè€Œä¸”æ›´æ–¹ä¾¿ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š
```c++
GameCharacter  lamGuy([&amp;](const GameCharacter&amp; gc){
 std::cout&lt;&lt; &quot;value is &quot; &lt;&lt; 75 &lt;&lt; std::endl;//å…·ä½“è®¡ç®—ç•¥
   return 75;
   });
lamGuy.healthValue();
```
å…³äºStrategyè®¾è®¡æ¨¡å¼æ›´å¤šå‚è€ƒï¼š
  - [Strategyè®¾è®¡æ¨¡å¼-åŸç†è®²è§£](https://refactoringguru.cn/design-patterns/strategy)
  - [Strategyè®¾è®¡æ¨¡å¼-C++ä»£ç å‚è€ƒ](https://refactoringguru.cn/design-patterns/strategy/cpp/example)
</code></pre>
</div>
    </div>
  </div>
</li>
</ul>
<h3 id="r36-ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°">R36 ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°</h3>
<ul>
<li>
<p>ç”±äºåç§°é®æ©ï¼Œä¸è¦é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°
çœ‹ä¸ªåä¾‹ï¼š</p>
<div class="highlight" id="id-34"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">mf</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;B::mf()&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">D</span><span class="o">:</span> <span class="k">public</span> <span class="n">B</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">mf</span><span class="p">(){</span><span class="c1">//é‡æ–°å®šä¹‰mf()ï¼Œè¿åäº†Rule33
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;D::mf()&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆçœ‹è¿™æ ·çš„åº”ç”¨ä»£ç ï¼š</p>
<div class="highlight" id="id-35"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">D</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">D</span><span class="o">*</span> <span class="n">pD</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span><span class="o">*</span> <span class="n">pB</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="p">.</span><span class="n">mf</span><span class="p">();</span>    <span class="c1">// è¾“å‡º D::mf()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pD</span> <span class="o">-&gt;</span> <span class="n">mf</span><span class="p">();</span><span class="c1">// è¾“å‡º D::mf()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pB</span> <span class="o">-&gt;</span> <span class="n">mf</span><span class="p">();</span><span class="c1">// è¾“å‡º B::mf()
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™å°±å¾ˆè¯¡å¼‚äº†ï¼éƒ½é€šè¿‡å¯¹è±¡dè°ƒç”¨æˆå‘˜å‡½æ•°mfï¼Œè°ƒç”¨ç»“æœåº”è¯¥ç›¸åŒã€‚</p>
<p>å¦å¤–ä¸€ç‚¹ï¼Œå‡ºäºpublicç»§æ‰¿çš„â€œ<strong>is-a</strong>â€ç‰¹æ€§ï¼Œè¿™æ ·é‡æ–°å®šä¹‰non-virtualå‡½æ•°ä¹Ÿæ˜¯<strong>å¯¹&quot;is-a&quot;çš„ä¸¥é‡è¿èƒŒ</strong>ã€‚</p>
</li>
</ul>
<h3 id="r37-ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå…¥å‚å€¼">R37 ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå…¥å‚å€¼</h3>
<p>è¿™é‡Œè¯´çš„ç¼ºçœå…¥å‚ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°å…¥å‚çš„é»˜è®¤å€¼ï¼Œåœ¨é‡å†™å¸¦æœ‰ç¼ºçœå…¥å‚çš„virtualå‡½æ•°æ—¶ï¼Œä¸è¦ä¿®æ”¹é‚£ä¸ªé»˜è®¤å‚æ•°çš„é»˜è®¤å€¼ã€‚</p>
<p>åŸå› ï¼švirtualå‡½æ•°ä¸º<code>åŠ¨æ€ç»‘å®š</code>ç‰¹æ€§ï¼Œè€Œç¼ºçœå‚æ•°å€¼æ˜¯<code>é™æ€ç»‘å®š</code>ç‰¹æ€§ã€‚ä¿®æ”¹åä¼šé€ æˆä¸€äº›ä»¤äººè´¹è§£çš„ç°è±¡ã€‚</p>
<p>è¯·çœ‹ä¸‹æ–¹åé¢æ•™æï¼š</p>
<div class="highlight" id="id-36"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">Color</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">RED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">GREEN</span> <span class="p">,</span><span class="n">BLUE</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>  <span class="c1">// ï¼šçˆ¶ç±»é»˜è®¤å…¥å‚æ˜¯RED
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">Color</span> <span class="n">col</span> <span class="o">=</span> <span class="n">Color</span><span class="o">::</span><span class="n">RED</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Shape:col is &#34;</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Rectangle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span><span class="p">{</span> <span class="c1">// ï¼šå­ç±»ç±»ä¿®æ”¹é»˜è®¤å…¥å‚ä¸ºGREEN
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">Color</span> <span class="n">col</span> <span class="o">=</span> <span class="n">Color</span><span class="o">::</span><span class="n">GREEN</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Rectangle:col is &#34;</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆå½“å‡ºç°å…¸å‹åº”ç”¨åœºæ™¯<code>Base* pB=new Derived</code>æ—¶ï¼Œå°±ä¼šé€ æˆâ€œçˆ¶ç±»å­ç±»å„å‡ºä¸€åŠåŠ›â€çš„æƒ…å½¢ï¼š</p>
<div class="highlight" id="id-37"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">Shape</span> <span class="o">*</span><span class="n">pRec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">pRec</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">();</span> <span class="c1">// è¾“å‡ºï¼šRectangle:col is 0  ï¼ˆ0æ˜¯REDï¼‰
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœç¡®å®è°ƒç”¨å­ç±»drawï¼Œä½†æ˜¯é»˜è®¤å…¥å‚å–çš„æ˜¯åŸºç±»çš„ REDï¼Œè€Œéå­ç±»çš„GREENã€‚
é‚£æ€ä¹ˆä¿®æ”¹åˆé€‚å‘¢ï¼Œéƒ½å¸¦é»˜è®¤å‚æ•°ï¼Œä¸”å­ç±»çˆ¶ç±»ç›¸åŒï¼Ÿå¸¦æ¥ä¸€ä¸ª<strong>è€¦åˆé—®é¢˜</strong>ï¼Œå¦‚æœçˆ¶ç±»æ”¹äº†ï¼Œæ‰€æœ‰å­ç±»éƒ½å¾—æ”¹ã€‚
æ­£å¦‚Rule35æåˆ°çš„NVI(non-virtual interface)æ‰‹æ³•ï¼Œæ­¤å¤„ä¾¿æ˜¯ç»ä½³çš„åº”ç”¨åœºæ™¯$\Longrightarrow$ drawæ–¹æ³•æ”¹ä¸ºé»˜è®¤å‚æ•°çš„non-virtualï¼ŒæŠŠvirtualå‡½æ•°æ”¾åˆ°privateé‡Œå»ï¼Œä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-38"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>   <span class="c1">//å­ç±»ç»§æ‰¿è¯¥é»˜è®¤å…¥å‚çš„non-virtualæ¥å£ï¼Œåˆ«é‡å†™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">Color</span> <span class="n">col</span> <span class="o">=</span> <span class="n">Color</span><span class="o">::</span><span class="n">RED</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">drawImpl</span><span class="p">(</span><span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> <span class="c1">//çº¯è™šå‡½æ•°æ˜¯å¼ºåˆ¶å­ç±»é‡å†™ï¼Œçœ‹å…·ä½“æƒ…å†µï¼Œimpure-virtualä¹Ÿè¡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">drawImpl</span><span class="p">(</span><span class="n">Color</span> <span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="c1">//å­ç±»é‡å†™è¿™ä¸ªdrawImpl
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="r38-é€šè¿‡å¤åˆå¡‘é€ å‡ºhas-aæˆ–æ ¹æ®æŸç‰©å®ç°å‡º">R38 é€šè¿‡å¤åˆå¡‘é€ å‡ºhas-aæˆ–&quot;æ ¹æ®æŸç‰©å®ç°å‡ºâ€</h3>
<p>åŸä¹¦æ ‡é¢˜ï¼š<code>Model â€œhas-aâ€ or â€œis-implemented-in-terms-ofâ€ through composition</code>ï¼ŒåŒRule32ï¼Œä¾¯æ·è€å¸ˆç¿»è¯‘ä¸ºâ€œå¡‘æ¨¡â€ã€‚</p>
<p>å¤åˆå…³ç³»ï¼ˆcompositionï¼‰æ˜¯ä¸€ç§å¸¸è§çš„ç±»å…³ç³»ï¼Œå½“æŸç§ç±»å‹çš„å¯¹è±¡å†…å«æœ‰å®ƒç§ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œä¾¿æ˜¯æ­¤ç§å…³ç³»ã€‚</p>
<p>å¤åˆå…³ç³»åˆ†ä¸º2ç§ï¼š<code>&quot;has-a&quot;</code> å’Œ <code>â€œis-implemented-in-terms-of&quot;</code>ã€‚</p>
<ul>
<li>â€œ<code>has-a</code>â€å…³ç³»ï¼š
æŒ‡çš„æ˜¯<strong>åº”ç”¨åŸŸ</strong>éƒ¨åˆ†ï¼Œä¸å‚ä¸å†…çš„å…·ä½“å„é¡¹å®ç°ã€‚æ˜¯ä¸€ç§å•çº¯çš„å®Œå¤‡å¯¹è±¡çš„åŒ…å«å…³ç³»ï¼Œæ¯”å¦‚Personç±»æœ‰Addressã€PhoneNumberã€Jobç­‰ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œåˆæˆ–æ˜¯Imageç±»æœ‰Bufferã€Mutexxã€SearchTreeç­‰ç±»å‹çš„æˆå‘˜ã€‚</li>
<li>â€œ<code>is-implemented-in-terms-of</code>â€œå…³ç³»ï¼š
æŒ‡çš„æ˜¯<strong>å®ç°åŸŸ</strong>éƒ¨åˆ†ï¼Œå‚ä¸ç±»çš„å„ç±»å®ç°ï¼Œæ¯”å¦‚æ•°æ®ç»“æ„çš„è®¾è®¡ä¸­ï¼Œæƒ³ç”¨ç°æœ‰çš„ std::listæ¥å®ç°Setç±»ï¼Œè¿™æ ·å¯èƒ½æ•ˆç‡ä¸é«˜(é€šå¸¸æ›´å…·æ•ˆç‡çš„å®ç°æ˜¯é‡‡ç”¨å¹³è¡¡æŸ¥æ‰¾æ ‘ )ï¼Œä½†æ˜¯å¯è¡Œã€‚
ğŸ“Œï¼šæ­¤å¤„ä¸èƒ½è®©Setä»¥publicç»§æ‰¿äºstd::listï¼Œå› ä¸ºlistå…è®¸é‡å¤å…ƒç´ ï¼Œè€ŒSetä¸è¡Œï¼Œä¸æ»¡è¶³â€œis-aâ€å…³ç³»ã€‚
æ­£ç¡®å®ç°éƒ¨åˆ†ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š
<div class="highlight" id="id-39"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Set</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="kt">bool</span> <span class="n">contains</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">rep_</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">rep_</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">item</span><span class="p">)</span> <span class="o">!=</span> <span class="n">rep_</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">contains</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="n">rep_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">);</span><span class="c1">// å®ç°ç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>  <span class="c1">// å®ç°ç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">rep_</span><span class="p">;</span> <span class="c1">//ç”¨æ¥è¡¨è¿°Setçš„æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="r39-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿">R39 æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿</h3>
<p>â€œæ˜æ™ºè€Œå®¡æ…â€çš„æ„æ€æ˜¯ğŸ‘‰å½“è€ƒè™‘äº†å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”åï¼Œä»ç„¶è§‰å¾—privateç»§æ‰¿æ˜¯æœ€åˆé€‚çš„ï¼Œæ‰ä½¿ç”¨å®ƒã€‚</p>
<p>é¦–å…ˆæ˜ç¡®privateç»§æ‰¿çš„2ä¸ªç‰¹æ€§ï¼š</p>
<ol>
<li>ç¼–è¯‘å™¨ä¸ä¼šè‡ªåŠ¨å°†ä¸€ä¸ªderived-classå¯¹è±¡éšå¼è½¬æ¢ä¸ºbase-classå¯¹è±¡(å‡½æ•°å…¥å‚æ—¶)ï¼›</li>
<li>ç»§æ‰¿è€Œæ¥çš„æˆå‘˜ï¼Œåœ¨derived-classä¸­éƒ½ä¼šå˜æˆprivateå±æ€§ï¼›</li>
</ol>
<p>privateç»§æ‰¿çš„æ„ä¹‰ï¼šæ„å‘³ç€<strong>implemented-in-terms-of</strong>ï¼Œåœ¨ç±»å…³ç³»è®¾è®¡ä¸Šæ²¡æœ‰å¤ªå¤§æ„ä¹‰ï¼Œåªçœ‹é‡è½¯ä»¶å®ç°ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹ä½¿ç”¨privateçš„2ä¸ªåº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>
<p><strong>derived-classæƒ³ç»§æ‰¿base-classçš„æŸpublicæ¥å£å®ç°ï¼Œä½†åˆæƒ³éšè—æ­¤æ¥å£</strong>
è€ƒè™‘å¦‚ä¸‹åº”ç”¨åœºæ™¯ï¼šå¯¹äºä¸€ä¸ªå·²çŸ¥çš„ç±»Widgetï¼Œæƒ³ç”¨å¦ä¸€ä¸ªå·²çŸ¥çš„è®¡æ—¶ç±»Timerè¾…åŠ©æ€§èƒ½åˆ†æï¼Œåœ¨å°½é‡å°æ”¹åŠ¨å·²æœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•å¯ç”¨Timerï¼Ÿ
privateç»§æ‰¿åšæ³•ï¼šè®©Widgetç±»privateç»§æ‰¿äºTimerï¼Œé‡å†™çˆ¶ç±»Timerçš„onTickå‡½æ•°ã€‚
å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-40"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Timer</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">explicit</span> <span class="n">Timer</span><span class="p">(</span><span class="kt">int</span> <span class="n">tickFrequency</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">onTick</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span><span class="c1">//å®šæ—¶å™¨æ»´ç­”ä¸€æ¬¡ï¼Œè‡ªåŠ¨è¢«è°ƒç”¨ä¸€æ¬¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span><span class="o">:</span><span class="k">private</span> <span class="n">Timer</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> <span class="c1">// privateç»§æ‰¿è€Œæ¥çš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯privateå±æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">onTick</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span><span class="c1">//æŸ¥çœ‹å¹¶è®°å½•Widgetæ•°æ®ï¼Œèµ„æºç­‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¥é—®é¢˜é™¤äº†ä¸Šæ–¹çš„privateç»§æ‰¿ï¼Œèƒ½ä¸èƒ½ç”¨å…¶ä»–æ–¹æ¡ˆæ›¿ä»£privateç»§æ‰¿å‘¢ï¼Ÿ
ğŸ‘‰ğŸ‘‰â€œpublicç»§æ‰¿+å¤åˆâ€æ›¿ä»£privateç»§æ‰¿ï¼šåœ¨Widgetå†…éƒ¨åµŒå¥—å®šä¹‰privateå±æ€§çš„æ–°ç±»WidgetTimer:private Timerï¼Œå³å¯åŒæ ·å¯ç”¨Timerä¸”éšè—äº†Timerã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-41"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">WidgetTimer</span><span class="o">:</span><span class="k">public</span> <span class="n">Timer</span><span class="p">{</span><span class="c1">// ç±»å†…åµŒå¥—å®šä¹‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">virtual</span> <span class="kt">void</span> <span class="n">onTick</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">WidgetTimer</span> <span class="n">wTimer_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>â­â­ WidgetTimerä¹Ÿå¯ä»¥ä¸å®šä¹‰åœ¨Widgetç±»å†…,ç±»å†…åªæ”¾WidgetTimer* å’ŒWidgetTimerçš„å‰ç½®å£°æ˜ï¼Œå®Œå…¨è§£è€¦åˆï¼Œ<strong>é™ä½ç¼–è¯‘ä¾èµ–æ€§</strong>ã€‚è€Œè¿™æ ·çš„è®¾è®¡è‡ªç”±åº¦æ˜¯å•çº¯çš„privateç»§æ‰¿ä¸å…·å¤‡çš„ã€‚</p>
</li>
<li>
<p><strong>ç©ºç™½åŸºç±»æœ€ä¼˜åŒ–(EBO,empty base optimization)</strong>
âš¡å€¼å¾—ä¸€æï¼šç©ºç±»(Empty Class)æ˜¯æŒ‡ä¸å«non-staticæ•°æ®æˆå‘˜å’Œvirtual-funcçš„ç±»ã€‚
ç©ºç±»çš„sizeä¼šè¢«C++å¼ºåˆ¶è¦æ±‚è‡³å°‘ä¸º1ï¼Œé€šå¸¸æ˜¯ç”¨1ä¸ªcharå ä½ã€‚å¦‚æœè®©Empty-Classä½œä¸ºæ•°æ®æˆå‘˜ï¼Œå› ä¸ºå†…å­˜å¯¹é½è€Œå¯¼è‡´Derived-Classæµªè´¹å†…å­˜ã€‚
ç¤ºä¾‹ä»£ç  ğŸ‘‡ï¼š</p>
<div class="highlight" id="id-42"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Empty</span> <span class="p">{</span> <span class="c1">// ç©ºç±»ï¼Œ1å­—èŠ‚. ä¸å«non-staticæ•°æ®ï¼Œä¸å«virtual
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="nf">privteFoo</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;private non-virtual.&#34;</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="kt">char</span><span class="o">*</span>  <span class="n">pChar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">typedef</span> <span class="nf">void</span><span class="p">(</span><span class="o">*</span><span class="n">pFuncReadData</span><span class="p">)(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">enum</span> <span class="k">class</span> <span class="nc">clolr</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">red</span><span class="p">,</span><span class="n">green</span><span class="p">,</span><span class="n">blue</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;public non-virtual!&#34;</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="p">;</span><span class="c1">//static æ•°æ®ä¹Ÿä¸å±äºclasså®ä½“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HoldsIntsAndEmpty</span> <span class="p">{</span> <span class="c1">//å†…å­˜å¯¹é½å12å­—èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">x_</span><span class="p">;</span>   <span class="c1">// 4å­—èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Empty</span> <span class="n">e_</span><span class="p">;</span> <span class="c1">// 1å­—èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">y_</span><span class="p">;</span>   <span class="c1">// 4å­—èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HoldsInts</span><span class="o">:</span><span class="k">private</span> <span class="n">Empty</span> <span class="p">{</span><span class="c1">//ä½¿ç”¨EBO,ç±»å¤§å°8å­—èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">x_</span><span class="p">;</span><span class="c1">//4å­—èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">y_</span><span class="p">;</span><span class="c1">//4å­—èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>EBOä¼˜åŒ–å¯ä»¥å‡å°‘Derived-Classçš„å†…å­˜å¤§å°ï¼Œæ³¨æ„EBOåªé€‚ç”¨äºå•ç»§æ‰¿ã€‚</p>
</li>
</ul>
<h3 id="r40-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿">R40 æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿</h3>
<p>å¤šé‡ç»§æ‰¿(multiple inheritance)æ˜¯æŒ‡ç»§æ‰¿ä¸€ä¸ªä»¥ä¸Šçš„çˆ¶ç±»ã€‚ä½†æ˜¯è¿™äº›çˆ¶ç±»åº”è¯¥é¿å…æ‹¥æœ‰å…±åŒçš„ç¥–çˆ¶ç±»ï¼Œä¼šå½¢æˆæ¯”è¾ƒéº»çƒ¦çš„â€œè±å½¢ç»§æ‰¿â€(æˆ–è€…å«é’»çŸ³ç»§æ‰¿)ã€‚</p>
<ul>
<li>
<p><strong>å¤šé‡ç»§æ‰¿çš„æˆæœ¬ä»¥åŠå‰¯ä½œç”¨</strong>
ä¸Šé¢è¯´â€œè±å½¢ç»§æ‰¿â€æ¯”è¾ƒéº»çƒ¦ï¼Œä¸»è¦åŸå› æ˜¯å¦‚æœç¥–çˆ¶ç±»å¦‚æœæ‹¥æœ‰æŸä¸ªæˆå‘˜å˜é‡xï¼Œé‚£ä¹ˆ2ä¸ªçˆ¶ç±»åˆ†åˆ«publicå½¢å¼ç»§æ‰¿äº†xï¼Œåˆ°äº†ç›®æ ‡å­ç±»å°±æœ‰äº†2ä»½xã€‚
è§£å†³é—®é¢˜çš„åŠæ³•æ˜¯<strong>è™šç»§æ‰¿</strong>(virtual inheritance)ï¼Œå¦‚æ­¤ï¼Œä¸Šè¿°å­ç±»åªæœ‰ä¸€ä»½xã€‚ä¸ºä¿è¯è™šç»§æ‰¿çš„æ­£ç¡®æ€§ï¼Œç¼–è¯‘å™¨åœ¨èƒŒåéœ€è¦ä»˜å‡ºæ›´å¤šä»£ä»·ï¼Œå¯èƒ½é€ æˆå­ç±»å†…å­˜æ›´å¤§æˆ–è¿è¡Œé€Ÿåº¦æ›´æ…¢ã€‚
ğŸ‘‰å¦‚æœå­˜åœ¨è±å½¢ç»§æ‰¿ï¼Œé‚£ä¹ˆç¥–çˆ¶ç±»å°½é‡ä¸è¦æŒæœ‰æ•°æ®æˆå‘˜ã€‚
è™šç»§æ‰¿ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-43"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">File</span><span class="p">{...};</span>  <span class="c1">//ç¥–çˆ¶ç±»æœ€å¥½ä¸è¦æŒæœ‰non-staticæ•°æ®æˆå‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">InputFile</span><span class="o">:</span> <span class="k">virtual</span> <span class="k">public</span> <span class="n">File</span><span class="p">{...};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OutputFile</span><span class="o">:</span> <span class="k">virtual</span> <span class="k">public</span> <span class="n">File</span><span class="p">{...};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">IOFile</span><span class="o">:</span><span class="k">public</span> <span class="n">InputFile</span><span class="p">,</span><span class="k">public</span> <span class="n">OutputFile</span><span class="p">{...};</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>åº”ç”¨åœºæ™¯ï¼špublicç»§æ‰¿æ¥å£+privateç»§æ‰¿å®ç°</strong>
æ€è€ƒè¿™æ ·çš„åº”ç”¨åœºæ™¯ï¼ŒPersonBaseç±»æ˜¯è™šåŸºç±»ï¼ŒRealPersonæ˜¯ç›®æ ‡å­ç±»ï¼ˆéœ€è¦ç»§æ‰¿æ¥å£ï¼‰ï¼Œä½†æ˜¯è·å–nameå’ŒbirthDateä¿¡æ¯çš„å‡½æ•°åœ¨å¦ä¸€ä¸ªPersonInfoç±»éƒ½æœ‰äº†ç°æˆçš„å®ç°ï¼ˆåªéœ€è¦ç®€å•ä¿®æ”¹è¯¥å®ç°ï¼‰ã€‚</p>
<p>ä¸¤è€…ç»“åˆåï¼Œå³è®©RealPersonç±»publicç»§æ‰¿äºPersonBaseï¼Œprivateç»§æ‰¿äºPersonInfoã€‚</p>
<div class="highlight" id="id-44"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PersonBase</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">PersonBase</span><span class="p">(){}</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">birthDate</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PersonInfo</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span>  <span class="o">~</span><span class="n">PersonInfo</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="nf">PersonInfo</span><span class="p">(</span><span class="kt">int</span> <span class="n">pID</span><span class="p">)</span><span class="o">:</span><span class="n">id_</span><span class="p">(</span><span class="n">pID</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">theName</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">static</span> <span class="kt">char</span> <span class="n">value</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">exampleName</span> <span class="o">=</span> <span class="s">&#34;Luka&#34;</span><span class="p">;</span><span class="c1">// è®¡ç®—è¿‡ç¨‹ç•¥,ç”¨å›ºå®šå­—ç¬¦ä¸²æ›¿ä»£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">strcpy</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueDelimLeft</span><span class="p">());</span>   <span class="c1">// è·å–å·¦ç•Œå®šç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">strcat</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">exampleName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">strcat</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueDelimRight</span><span class="p">());</span><span class="c1">// è·å–å³ç•Œå®šç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">theBirthDate</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;1990-1-1&#34;</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">valueDelimLeft</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;[&#34;</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">valueDelimRight</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;]&#34;</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">id_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¤šé‡ç»§æ‰¿çš„ä»£ç ä¸ºğŸ‘‡:</p>
<div class="highlight" id="id-45"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RealPerson</span> <span class="o">:</span> <span class="k">public</span> <span class="n">PersonBase</span><span class="p">,</span> <span class="k">private</span> <span class="n">PersonInfo</span> <span class="p">{</span><span class="c1">//å¤šé‡ç»§æ‰¿
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">RealPerson</span><span class="p">(</span><span class="kt">int</span> <span class="n">pID</span><span class="p">)</span> <span class="o">:</span><span class="n">PersonInfo</span><span class="p">(</span><span class="n">pID</span><span class="p">)</span> <span class="p">{}</span> <span class="c1">// å§”æ‰˜æ„é€ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span> <span class="c1">//å®ç°å¿…è¦çš„è™šåŸºç±»Personçš„pure-virtualæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">PersonInfo</span><span class="o">::</span><span class="n">theName</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">birthDate</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">PersonInfo</span><span class="o">::</span><span class="n">theBirthDate</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">valueDelimLeft</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">;</span> <span class="p">};</span><span class="c1">//é‡å†™ç•Œå®šç¬¦å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">valueDelimRight</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€ååº”ç”¨ç«¯ä»£ç ï¼š</p>
<div class="highlight" id="id-46"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">RealPerson</span> <span class="nf">rPerson</span><span class="p">(</span><span class="mi">613</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rPerson</span><span class="p">.</span><span class="n">name</span><span class="p">();</span> <span class="c1">//è¾“å‡ºLuka ,è€Œä¸æ˜¯[Luka]
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ï¼Œå¤šé‡ç»§æ‰¿ä½“ç³»å®Œç¾è§£å†³è¯¥é—®é¢˜ã€‚</p>
</li>
</ul>
<p>å›åˆ°æœ¬èŠ‚å¼€å¤´ï¼Œæ˜æ™ºå’Œå®¡æ…çš„æ„æ€æ˜¯ğŸ‘‰å³ä½¿å¤šé‡ç»§æ‰¿å¯ä»¥ç”¨å•ç»§æ‰¿æ–¹æ¡ˆæ›¿ä»£è§£å†³ï¼Œæ€è€ƒåï¼Œå¦‚æœå¤šé‡ç»§æ‰¿ä¾ç„¶æ˜¯æœ€ç®€æ´ã€æœ€æ˜“ç»´æŠ¤ã€æœ€åˆç†çš„åšæ³•ï¼Œé‚£å°±é€‰æ‹©å®ƒã€‚</p>
<p>ref:</br>
[1]. <a href="https://blog.csdn.net/cltcj/category_12098441.html"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/cltcj/category_12098441.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[2]. <a href="https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/"target="_blank" rel="external nofollow noopener noreferrer">https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></p>]]></description></item><item><title>Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [2]</title><link>https://jianye0428.github.io/posts/parttwo/</link><pubDate>Sun, 30 Jul 2023 17:08:51 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/parttwo/</guid><description><![CDATA[<!-- <div class="details admonition quote">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-quote-right fa-fw" aria-hidden="true"></i>quote<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">note abstract info tip success question warning failure danger bug example quote</div>
    </div>
  </div> -->
<h1 id="å‰è¨€">å‰è¨€</h1>
<blockquote>
<p>Effective-C++æ€»ç»“ç³»åˆ—åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬äºŒéƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬3~4ç« ï¼Œå†…å®¹èŒƒå›´Rule13~25ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule13ç®€å†™ä¸ºR13ã€‚</p>
</blockquote>
<div class="details admonition Note">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Effective-C++ç³»åˆ—List<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partone/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/parttwo/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)</br>
ğŸ’¡ Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)</br></div>
    </div>
  </div>
<p>ç”±äºåŸä¹¦åœ¨C++11ä¹‹å‰å†™æˆï¼Œæœ‰äº›ç°ä»£C++ç‰¹æ€§ä¸ä¼šæåŠï¼Œæ‰€ä»¥ä¼šæ ¹æ®æœ¬äºº<code>å¼€å‘ç»éªŒ</code>æ–°å¢ä¸€äº›ä¸ªäººæ„Ÿæ‚ŸğŸ‘‰<code>By the way</code>ç¯èŠ‚ã€‚</p>
<h2 id="ch3èµ„æºç®¡ç†">CH3.èµ„æºç®¡ç†</h2>
<h3 id="r13-ä»¥å¯¹è±¡ç®¡ç†èµ„æº">R13 ä»¥å¯¹è±¡ç®¡ç†èµ„æº</h3>
<ul>
<li>
<p>ä¸ºé˜²æ­¢èµ„æºæ³„éœ²ï¼Œå°½é‡ä½¿ç”¨<code>RAII</code>å¯¹è±¡(èµ„æºè·å–å³åˆå§‹åŒ–ï¼ŒResource Acquisition Is Initialization)
å¦‚æœç”¨è€å¼çš„new-deleteç»„åˆæ‰‹åŠ¨ç®¡ç†èµ„æºï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼Œå¤„ç†ä»£ç ä¸­æœ‰å¤šå¤„return/breakä¹‹ç±»çš„åˆ†æ”¯è¯­å¥ï¼Œæ¯å¤„éƒ½æ‰‹åŠ¨æ·»åŠ deleteå›æ”¶èµ„æºéš¾å…ä¼šæœ‰é—æ¼é£é™©ã€‚</p>
<ol>
<li>
<p>auto_ptr
æœ¬ä¹¦æåŠçš„æ™ºèƒ½æŒ‡é’ˆå¯¹è±¡<code>std::auto_ptr</code>å¯ä»¥åœ¨èµ„æºAåˆå§‹åŒ–åŒ–æ—¶æ¥ç®¡å¯¹è±¡Aï¼Œå¯¹è±¡è„±ç¦»ä½œç”¨åŸŸï¼Œææ„æ—¶é‡Šæ”¾æ¥ç®¡çš„Aã€‚
ä¸ºé¿å…é‡å¤åˆ é™¤èµ„æºï¼Œ<code>std::auto_ptrç‰¹æ€§:</code> é€šè¿‡copyæ„é€ å‡½æ•°æˆ–copy-assignmentæ“ä½œç¬¦ï¼Œæ“ä½œå®ƒä»¬ï¼Œå®ƒä»¬è‡ªèº«ä¼šå¤±å»èµ„æºæ‰€æœ‰æƒï¼Œå˜æˆNULL ï¼</p>
</li>
<li>
<p>shared_ptr
ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼Œåæ¥æ¨å‡ºäº†å¼•ç”¨è®¡æ•°ç®¡ç†èµ„æºï¼Œå³<code>RCSP(Reference-counting smart poiner)</code>ï¼Œstd::shared_ptr ã€‚(ä¹¦ä¸­å½“æ—¶è¿˜æ˜¯tr1::shared_ptr)ç‰¹ç‚¹æ˜¯shared_ptråœ¨ä½¿ç”¨copyæ„é€ å‡½æ•°æˆ–copy-assignmentæ“ä½œç¬¦æ—¶ï¼Œä¸ä¼šå¤±å»èµ„æºæ‰€æœ‰æƒï¼Œè€Œæ˜¯è‡ªèº«å¼•ç”¨è®¡æ•°åŠ 1ã€‚
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><ul>
<li>
<p>auto_ptrç›®å‰å·²ç»è¢«å¼ƒç”¨ï¼Œè½¬è€Œä½¿ç”¨ std::unique_ptræ¥æŒ‡æ¶‰ç‹¬å èµ„æºçš„æ™ºèƒ½æŒ‡é’ˆï¼Œä¸å¯è¢«å¤åˆ¶å’Œèµ‹å€¼ã€‚</p>
</li>
<li>
<p>shared_ptrå­˜åœ¨çš„é—®é¢˜æ˜¯ç¯å½¢å¾ªç¯åº”ç”¨ï¼Œäº’ç›¸æŒæœ‰å¯¹æ–¹ï¼Œåˆ™æ— æ³•é‡Šæ”¾ï¼Œé’ˆå¯¹è¿™ä¸€é—®é¢˜ï¼Œéœ€è¦å¼•å…¥std::weak_ptræ¥ç ´å±€ã€‚</p>
</li>
<li>
<p>è¿™äº›æ™ºèƒ½æŒ‡é’ˆçš„å¤´æ–‡ä»¶æ”¯æŒï¼š#include <memory></p>
</li>
</ul>
</div>
    </div>
  </div></p>
</li>
</ol>
</li>
<li>
<p>å¸¸ç”¨çš„RAIIæ–¹å¼å­˜åœ¨çš„é—®é¢˜
ä¸Šè¿°çš„shared_ptræ˜¯<strong>ä¸æ”¯æŒæ•°ç»„èµ„æºçš„é‡Šæ”¾</strong>çš„ï¼Œåœ¨ææ„æ—¶é»˜è®¤è°ƒç”¨deleteï¼Œè€Œä¸æ˜¯delete[] ã€‚å¦‚æœè¦èƒ½é‡Šæ”¾ï¼Œéœ€è¦æ‰‹åŠ¨ä¼ å…¥ææ„å‡½æ•°ã€‚</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Investment</span><span class="o">&gt;</span> <span class="n">instSpMan</span><span class="p">(</span><span class="k">new</span> <span class="n">Investment</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="p">[](</span><span class="n">Investment</span><span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span><span class="k">delete</span><span class="p">[]</span> <span class="n">p</span><span class="p">;</span> <span class="p">});</span> <span class="c1">// ä½¿ç”¨lamdaå‡½æ•°ï¼Œè¿˜å¯ä»¥ä¼ å…¥æ™®é€šå‡½æ•°æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Investment</span><span class="p">[]</span><span class="o">&gt;</span> <span class="n">instSp</span><span class="p">(</span><span class="k">new</span> <span class="n">Investment</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span><span class="c1">// shared_ptré‡è½½äº†[]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span> <span class="n">intUp</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span> <span class="c1">// unique_ptré‡è½½äº†[]
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>PS: é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœèƒ½ç”¨vectorä»£æ›¿çš„åœºæ™¯ï¼Œå°±ä¸éœ€è¦è¿™æ ·ä½¿ç”¨å¯¹è±¡æ•°ç»„ã€‚</p>
</li>
</ul>
<h3 id="r14-åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopingè¡Œä¸º">R14 åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopingè¡Œä¸º</h3>
<p>å¹¶éæ‰€æœ‰èµ„æºéƒ½æ˜¯å †ä¸Šç®¡ç†(heap-based)ï¼Œæ‰€ä»¥ä¹Ÿæœ‰æ™ºèƒ½æŒ‡é’ˆä¸é€‚åˆçš„åœºæ™¯ï¼Œè¿™æ—¶éœ€è¦è‡ªå·±å®ç°ä¸€ä¸ªèµ„æºç®¡ç†ç±»ã€‚</p>
<p>æ¯”å¦‚æœ‰ä¸ªç±»CMutex ï¼Œåªæœ‰2ä¸ªå‡½æ•°lockå’Œunlockï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªç®¡ç†ç±»CLockï¼Œæ¥ç®¡ç†Mutexç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CMutex</span> <span class="p">{</span><span class="cm">/*çœç•¥ç±»å®ç°*/</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">lock</span><span class="p">(</span><span class="n">CMutex</span> <span class="o">*</span><span class="n">mtx</span><span class="p">)</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;has lock...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span><span class="cm">/*other operation...*/</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">unlock</span><span class="p">(</span><span class="n">CMutex</span> <span class="o">*</span><span class="n">mtx</span><span class="p">)</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;release lock...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span><span class="cm">/*other operation...*/</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CLock</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">CLock</span><span class="p">(</span><span class="n">CMutex</span> <span class="o">*</span><span class="n">mtx</span><span class="p">)</span> <span class="o">:</span><span class="n">mtx_</span><span class="p">(</span><span class="n">mtx</span><span class="p">)</span> <span class="p">{</span> <span class="n">lock</span><span class="p">(</span><span class="n">mtx_</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">CLock</span><span class="p">()</span> <span class="p">{</span> <span class="n">unlock</span><span class="p">(</span><span class="n">mtx_</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> <span class="n">CMutex</span> <span class="o">*</span><span class="n">mtx_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ¶‰åŠCLockçš„copingç›¸å…³å‡½æ•°ï¼Œé‚£ä¹ˆæœ‰ä»¥ä¸‹å‡ ç§é€‰æ‹©ï¼š</p>
<ul>
<li>ç¦æ­¢å¤åˆ¶
å‚è€ƒæœ¬ä¹¦Part1-Rule06ï¼Œç¦æ­¢copingå‡½æ•°çš„ç”Ÿæˆã€‚</li>
<li>å¯¹åº•å±‚èµ„æºä½¿ç”¨â€œå¼•ç”¨è®¡æ•°æ³•â€
ä»¥shared_ptr<CMutex>ä»£æ›¿è£¸æŒ‡é’ˆï¼Œå¹¶ä¸”ä¼ å…¥unlockå‡½æ•°ä½œä¸ºè¯¥æŒ‡é’ˆçš„â€œåˆ é™¤å™¨â€ã€‚</li>
<li>å¤åˆ¶åº•éƒ¨èµ„æº
å³â€œæ·±åº¦æ‹·è´â€ï¼Œå¤åˆ¶èµ„æºç®¡ç†å¯¹è±¡æ—¶ï¼ŒåŒæ—¶å¤åˆ¶å…¶åŒ…è£¹çš„èµ„æºã€‚</li>
<li>è½¬ç§»åº•éƒ¨èµ„æºæ‰€æœ‰æƒ
å³æµ…å¤åˆ¶ï¼Œä¸æ‹·è´åŒ…è£¹çš„èµ„æºï¼Œè€Œæ˜¯è½¬ç§»æ‰€æœ‰æƒï¼Œå’Œå‰æ–‡æåˆ°çš„auto_ptréå¸¸å¥‘åˆã€‚</li>
</ul>
<h3 id="r15-åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®">R15 åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®</h3>
<p>æ™ºèƒ½æŒ‡é’ˆ<code>auto_ptr</code>, <code>unique_ptr</code>, <code>shared_ptr</code>éƒ½æä¾›äº†æ¥å£è®¿é—®åŸå§‹èµ„æºï¼Œæ–¹æ³•åç§°ä¸º<code>get()</code>ï¼Œå¯¹ç±»Aèµ„æºå¾—åˆ°è£¸æŒ‡é’ˆ<code>A*</code>ã€‚</p>
<p>æ™ºèƒ½æŒ‡é’ˆä¹Ÿé‡è½½äº†æ“ä½œç¬¦<code>operator -&gt;</code> å’Œ <code>operator *</code> ï¼Œè®¿é—®ç±»æˆå‘˜å‡½æ•°éƒ½å¯ä»¥åƒæ™®é€šæŒ‡é’ˆé‚£æ ·ä½¿ç”¨ã€‚</p>
<p>å¦‚æœè‡ªè¡Œè®¾è®¡èµ„æºç®¡ç†ç±»ï¼Œä¹Ÿè¦åƒä¸Šè¿°çš„æ™ºèƒ½æŒ‡é’ˆé‚£æ ·ï¼Œåšåˆ°èƒ½å¤Ÿè½»æ¾è®¿é—®åŸå§‹èµ„æºã€‚</p>
<p>æŸäº›æƒ…å†µï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨getæˆå‘˜å‡½æ•°<strong>æ˜¾å¼è½¬æ¢</strong>ï¼Œè½¬è€Œä½¿ç”¨<strong>éšå¼ç±»å‹è½¬æ¢</strong>ï¼Œæ–¹ä¾¿å®¢æˆ·è°ƒç”¨:</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Font</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// éšå¼è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">operator</span> <span class="n">FontHandle</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span> <span class="k">return</span> <span class="n">f</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// æ˜¾å¼è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">FontHandle</span> <span class="nf">get</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">f</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">FontHandle</span> <span class="n">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="r16-æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡å–ç›¸åŒå½¢å¼">R16 æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡å–ç›¸åŒå½¢å¼</h3>
<p>å…ˆçœ‹ä¸€æ®µé”™è¯¯ä»£ç ï¼š</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">*</span><span class="n">stringArray</span> <span class="o">=</span> <span class="k">new</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">delete</span> <span class="n">stringArray</span><span class="p">;</span><span class="c1">// undefined behavior,æœªå®šä¹‰è¡Œä¸ºï¼›æœ‰å¯èƒ½åªåˆ é™¤äº†ç¬¬ä¸€ä¸ªå…ƒç´ 
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>æ³¨æ„<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><ul>
<li>new å’Œ deleteå¯¹åº”</li>
<li>new[] å’Œ delete[]å¯¹åº”
ä¸å¯é—æ¼æˆ–è€…äº¤å‰é”™é…ï¼</li>
</ul>
</div>
    </div>
  </div>
<p>ç®€å•æ¢ç©¶ <code>delete[]</code>çš„åŸç†ï¼šå®é™…ä¸Šï¼Œåœ¨ç¼–è¯‘å™¨çš„å®ç°ä¸­ï¼Œå¯¹è±¡æ•°ç»„çš„èµ·å§‹å†…å­˜ä¼šå­˜æ”¾â€œæ•°ç»„é•¿åº¦â€è¿™ä¸€å˜é‡ï¼Œä»¥ä¾¿å‘ŠçŸ¥<code>delete[]</code>åº”è¯¥è°ƒç”¨å¤šå°‘æ¬¡ææ„ï¼Œåˆ é™¤å¤šå°‘èµ„æºã€‚</p>
<p>ğŸ‘‰ è°¨æ…å¯¹æ•°ç»„ä½¿ç”¨typedefï¼Œå®¹æ˜“äº§ç”Ÿnew-deleteçš„åŒ¹é…è¯¯è§£ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">AddressLines</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">*</span><span class="n">pal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AddressLines</span><span class="p">;</span><span class="c1">//æ³¨æ„ï¼šè¿™é‡Œå…¶å®å°±æ˜¯ new string[4]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">delete</span> <span class="n">pal</span><span class="p">;</span>     <span class="c1">// è¡Œä¸ºæœªå®šä¹‰ï¼ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">delete</span> <span class="p">[]</span> <span class="n">pal</span><span class="p">;</span>  <span class="c1">// æ­£è§£ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1">// è¿™é‡Œå»ºè®®çš„æ›¿ä»£æ–¹æ³•ï¼švector&lt;string&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="r17-ä»¥ç‹¬ç«‹è¯­å¥å°†newedå¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆ">R17 ä»¥ç‹¬ç«‹è¯­å¥å°†newedå¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆ</h3>
<p><strong>ä¸è¦å°†ç”³è¯·èµ„æºçš„newè¯­å¥ç›´æ¥å½“ä½œå‡½æ•°å…¥å‚</strong>ï¼Œè€Œæ˜¯åº”è¯¥å…ˆä»¥å•ç‹¬è¯­å¥ç”³è¯·åä¼ å…¥ã€‚</p>
<p>è€ƒè™‘ä¸‹è¿°é—®é¢˜ä»£ç ï¼š</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">priority</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">processWidget</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="n">pw</span><span class="p">,</span><span class="kt">int</span> <span class="n">pri</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å‡½æ•°è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">processWidget</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">Widget</span><span class="p">),</span><span class="n">priority</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ä»£ç ç¬¬4è¡Œï¼Œåœ¨processWidgetå‡½æ•°ä½“æ‰§è¡Œä¹‹å‰ï¼Œè‡³å°‘æœ‰3ä¸ªæ­¥éª¤(å¹¶éä¸¥æ ¼æ¬¡åº)ï¼š</p>
<ol>
<li>æ‰§è¡Œ&quot;new Widget&quot;</li>
<li>è°ƒç”¨std::shared_ptrçš„æ„é€ å‡½æ•°</li>
<li>è°ƒç”¨priorityå‡½æ•°</li>
</ol>
<p>C++ç¼–è¯‘å™¨èƒ½ä¿è¯1-&gt;2çš„æ¬¡åº(2éœ€è¦1åšå…¥å‚)ï¼Œä½†æ˜¯æ— æ³•ä¿è¯3çš„æ¬¡åºä¸åœ¨1ï¼Œ2ä¹‹é—´ï¼Œå¦‚æœæ­¥éª¤3æŠ›å‡ºå¼‚å¸¸ï¼Œå°†ä¼šç›´æ¥å¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ­£ç¡®ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span>  <span class="n">pw</span><span class="p">(</span><span class="k">new</span> <span class="n">Widget</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">processWidget</span><span class="p">(</span><span class="n">pw</span><span class="p">,</span><span class="n">priority</span><span class="p">());</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ch4è®¾è®¡ä¸å£°æ˜">CH4.è®¾è®¡ä¸å£°æ˜</h2>
<h3 id="r18-è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨ä¸æ˜“è¢«è¯¯ç”¨">R18 è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨ï¼Œä¸æ˜“è¢«è¯¯ç”¨</h3>
<p>è¦æƒ³è®¾è®¡ä¸€ä¸ªä¸å®¹æ˜“è¯¯ç”¨çš„æ¥å£ï¼Œ<strong>å°±è¦å…ˆè€ƒè™‘ä½¿ç”¨è€…å¯èƒ½çŠ¯ä»€ä¹ˆé”™è¯¯</strong>ã€‚</p>
<ul>
<li><code>é¿å…â€œæ¥å£è¯¯ç”¨â€ï¼Œå¯ä»¥å¯¼å…¥æ–°ç±»å‹è¿›è¡Œé™åˆ¶</code>
æ¯”å¦‚è®¾è®¡ä¸€ä¸ªDateç±»ï¼Œå‚æ•°ä¼ é€’å°±å¯èƒ½å‡ºé”™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Date</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Date</span><span class="p">(</span><span class="kt">int</span> <span class="n">month</span><span class="p">,</span><span class="kt">int</span> <span class="n">day</span><span class="p">,</span><span class="kt">int</span> <span class="n">year</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div>å®é™…ä½¿ç”¨æ—¶ï¼Œä½¿ç”¨è€…å¯èƒ½å†™å‡º<code>Date date(30,4,2021)</code>;è¿™æ ·çš„é”™è¯¯ä»£ç ï¼Œå¦‚ä½•é˜²èŒƒå‘¢ï¼Ÿ
æ–¹æ³•ä¹‹ä¸€ï¼šå°è£…å‡ºMonth,Day,Yearè¿™3ä¸ªStruct/Classï¼Œä½œä¸ºå‚æ•°å…¥å‚ï¼Œå¹¶<strong>æ·»åŠ æœˆä»½é™åˆ¶</strong>ï¼Œä»£ç ï¼š
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Month</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="n">Month</span> <span class="n">Jan</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">Month</span><span class="p">(</span><span class="mi">1</span><span class="p">);}</span> <span class="c1">// ...çœç•¥å…¶ä»–11ä¸ªæœˆä»½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="nf">Month</span><span class="p">(</span><span class="kt">int</span> <span class="n">m</span><span class="p">)</span><span class="o">:</span><span class="n">val</span><span class="p">(</span><span class="n">m</span><span class="p">){}</span> <span class="c1">//å¯è¢«class-staticè°ƒç”¨ï¼Œä¸èƒ½è¢«å¤–éƒ¨è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Day</span> <span class="p">{</span><span class="k">explicit</span> <span class="nf">Day</span><span class="p">(</span><span class="kt">int</span> <span class="n">d</span><span class="p">)</span> <span class="o">:</span><span class="n">day</span><span class="p">(</span><span class="n">d</span><span class="p">){}</span>    <span class="kt">int</span> <span class="n">day</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>  <span class="c1">//çœç•¥ struct Yearå®šä¹‰ï¼Œå’ŒDayç±»ä¼¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Date</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Date</span><span class="p">(</span><span class="k">const</span> <span class="n">Month</span><span class="o">&amp;</span> <span class="n">month</span><span class="p">,</span><span class="k">const</span> <span class="n">Day</span><span class="o">&amp;</span> <span class="n">day</span><span class="p">,</span><span class="k">const</span> <span class="n">Year</span><span class="o">&amp;</span> <span class="n">year</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div>æœ€ç»ˆå®¢æˆ·ä»£ç ä½¿ç”¨çš„æƒ…å†µå¦‚ä¸‹ï¼š
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">Date</span> <span class="nf">date</span><span class="p">(</span><span class="n">Month</span><span class="o">::</span><span class="n">Jan</span><span class="p">(),</span><span class="n">Day</span><span class="p">(</span><span class="mi">13</span><span class="p">),</span><span class="n">Year</span><span class="p">(</span><span class="mi">2022</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><pre><code>  C++11 æ”¯æŒå¯¹æšä¸¾çš„å¼ºåŒ–ï¼Œå³ç±»å‹å®‰å…¨çš„`enum class`ï¼Œå®ƒä¸èƒ½éšå¼åœ°è½¬æ¢ä¸ºæ•´æ•°ï¼›ä¹Ÿæ— æ³•ä¸æ•´æ•°æ•°å€¼åšæ¯”è¾ƒã€‚æ­¤å¤„å¯ä»¥è€ƒè™‘å®šä¹‰ä¸€ä¸ªMonthEmæ¥ä»£æ›¿Monthï¼š
  ```c++
  enum  class MonthEm {
  Jan = 1,
  Feb = 2, //... çœç•¥å…¶å®ƒçš„æœˆä»½å®šä¹‰
  };
  // ä¿®æ”¹Dateçš„æ„é€ å‡½æ•°ï¼ŒMonthEmæ¥ä»£æ›¿Month
  Date(const MonthEm&amp; monthEm, const Day&amp; day, const Year&amp; year) {}
  // æ„é€ å¯¹è±¡
  Date date2(MonthEm::Feb, Day(23), Year(2021));
  ```
</code></pre>
</div>
    </div>
  </div></li>
<li><code>é™åˆ¶ç±»å‹å†…ä»€ä¹ˆäº‹æ˜¯å¯ä¸å¯åšçš„</code>
å¸¸è§æ“ä½œæ˜¯åŠ ä¸Šconsté™åˆ¶ï¼Œæ¯”å¦‚â€œä»¥const ä¿®é¥°operator * çš„è¿”å›ç±»å‹â€å¯ä»¥é˜»æ­¢è¿™ä¸ªé”™è¯¯ï¼š
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//æœ¬æ„æ˜¯æƒ³åšæ¯”è¾ƒï¼Œå†™æˆäº†èµ‹å€¼ï¼Œä½†æ˜¯èµ‹ç»™constï¼ŒæŠ¥é”™ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><code>æ™ºèƒ½æŒ‡é’ˆä¼ å…¥åˆ é™¤å™¨å¯é¿å…&quot;Cross-dll-problem&quot;</code>
std::shared_ptrç®¡ç†èµ„æºæ—¶ï¼Œä¼ å…¥åˆ é™¤å™¨ï¼Œå¯é¿å…åœ¨A-Dllä¸­newï¼Œç»“æœåœ¨å¦ä¸€ä¸ªB-Dllä¸­deleteçš„æƒ…å†µï¼Œè¿™ä¼šå¯¼è‡´Runtime-Errorã€‚</li>
</ul>
<h3 id="r19-è®¾è®¡classçŠ¹å¦‚è®¾è®¡type">R19 è®¾è®¡ClassçŠ¹å¦‚è®¾è®¡Type</h3>
<p>è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„Classå¹¶ä¸å®¹æ˜“ï¼Œå¾ˆå¤šC++ä¹¦ç±éƒ½åƒæœ¬ä¹¦ä¸€æ ·æåˆ°â€œCheck-Tableâ€ï¼Œè®¾è®¡Class/Typeå‰ï¼Œé—®è‡ªå·±ä¸€äº›é‡è¦é—®é¢˜ï¼š</p>
<ul>
<li>æ–°typeçš„å¯¹è±¡åº”è¯¥å¦‚ä½•è¢«åˆ›å»ºå’Œé”€æ¯ï¼Ÿ</li>
<li>å¯¹è±¡çš„åˆå§‹åŒ–å’Œèµ‹å€¼è¯¥æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ</li>
<li>æ–°typeçš„å¯¹è±¡å¦‚æœå€¼ä¼ é€’(pass-by-value)ï¼Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿ
copyæ„é€ å‡½æ•°ç”¨æ¥å®šä¹‰ä¸€ä¸ªtypeçš„å€¼ä¼ é€’å…·ä½“å®ç°ã€‚</li>
<li>ä»€ä¹ˆæ˜¯æ–°typeçš„â€œåˆæ³•å€¼â€ï¼Ÿ
æƒ³æ¸…æ¥šçº¦æŸæ¡ä»¶ï¼Œç‰¹åˆ«æ˜¯æ„é€ å‡½æ•°ã€èµ‹å€¼æ“ä½œç¬¦ä»¥åŠ<strong>setter</strong>å‡½æ•°ï¼Œæ¶‰åŠçš„é”™è¯¯æ£€æŸ¥ä¸éæ³•å€¼æ‹¦æˆªã€‚</li>
<li>æ–°typeéœ€è¦é…åˆæŸä¸ªç»§æ‰¿å›¾è°±å—ï¼Ÿ
å¦‚æœç»§æ‰¿è‡ªæŸBaseç±»ï¼Œé‚£ä¹ˆå°±ä¼šæ”¶åˆ°virtual,non-virtualå‡½æ•°çš„çº¦æŸï¼›å¦‚æœè¦åšåç»­ç±»çš„åŸºç±»ï¼Œåˆ™è¯¥typeå°±è¦æ³¨æ„<strong>è™šææ„</strong>çš„è®¾è®¡ã€‚</li>
<li>æ–°typeæ¶‰åŠä»€ä¹ˆæ ·çš„è½¬æ¢ï¼Ÿ
ä¸å…¶ä»–typeä¹‹é—´å¦‚æœ‰è½¬æ¢éœ€æ±‚ï¼Œåˆ™éœ€è¦è‡ªè¡Œå®ç°ç›¸å…³å‡½æ•°ï¼Œå¯å‚è€ƒ<code>Rule15</code>ã€‚</li>
<li>æ–°typeéœ€è¦æ€æ ·çš„æ“ä½œç¬¦å’Œå‡½æ•°ï¼Ÿ
ç¡®å®šå“ªäº›æ˜¯memberå‡½æ•°ï¼Œå“ªäº›ä¸æ˜¯ã€‚å‚è€ƒ<code>Rule23</code>ï¼Œ<code>Rule24</code>ï¼Œ<code>Rule26</code>ã€‚</li>
<li>æ˜¯å¦æœ‰éœ€è¦ç«‹å³é©³å›çš„æ ‡å‡†å‡½æ•°ï¼Ÿ
æ¯”å¦‚<strong>æ˜¯å¦ç¦æ­¢</strong>copyæ„é€ ï¼Œcopy-assignmentæ“ä½œç¬¦ç­‰å‡½æ•°ï¼Œå¯ä»¥å£°æ˜ä¸ºprivateï¼›æˆ–è€…ä½¿ç”¨C++æ–°ç‰¹æ€§&quot;=delete&quot;ã€‚å‚è€ƒ<code>Rule6</code>ã€‚</li>
<li>æ–°typeæˆå‘˜çš„è®¿é—®å±æ€§æ§åˆ¶ï¼Ÿ
æˆå‘˜å˜é‡éƒ½åº”ä¸ºprivateï¼Œè€ƒè™‘å…¶ä»–memberå‡½æ•°è¯¥ä¸ºprivate/public/protectedã€‚ä»¥åŠå¯ç”¨å‹å…ƒfriendçš„è€ƒè™‘ã€‚</li>
<li>ä»€ä¹ˆæ˜¯æ–°typeçš„â€œæœªå£°æ˜æ¥å£â€?
å‚è€ƒ<code>Rule29</code>ã€‚</li>
<li>æ–°typeæœ‰å¤šä¹ˆä¸€èˆ¬åŒ–ï¼Ÿ
å¦‚æœæ˜¯ä¸€èˆ¬åŒ–çš„é—®é¢˜å¤„ç†ï¼Œè¯¥è€ƒè™‘æ˜¯å¦è¯¥å®šä¹‰Class-Templateã€‚</li>
<li>çœŸçš„éœ€è¦ä¸€ä¸ªæ–°typeå—ï¼Ÿ</li>
</ul>
<h3 id="r20-ä»¥pass-by-reference-to-constä»£æ›¿pass-by-value">R20 ä»¥pass-by-reference-to-constä»£æ›¿pass-by-value</h3>
<ul>
<li>å°½é‡ä»¥pass-by-reference-to-constä»£æ›¿pass-by-value
å‰è€…é€šå¸¸æ›´<strong>é«˜æ•ˆ</strong>ï¼Œå¹¶å¯<strong>é¿å…â€œå¯¹è±¡åˆ‡å‰²â€é—®é¢˜</strong>ã€‚
å¦‚æœå¯¹è±¡å…¥å‚ä»¥å€¼ä¼ é€’ï¼Œå°±ä¼šåœ¨å…¥å‚æ—¶åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œå‡½æ•°å®Œæˆåä¸´æ—¶å¯¹è±¡ææ„ï¼Œæ¶‰åŠæ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„è°ƒç”¨ï¼Œè¿™äº›éƒ½å¯èƒ½æ˜¯ä¸å°çš„å¼€é”€ï¼
<code>å¦‚æœæ˜¯ä»¥const referenceå½¢å¼ï¼Œåˆ™ä¸ä¼šæœ‰ä»»ä½•æ„é€ /ææ„çš„å¼€é”€</code>ã€‚constçš„ä½œç”¨æ˜¯è®©ä½¿ç”¨è€…æ”¾å¿ƒï¼Œä¸ä¼šæ”¹å˜å…¥å‚çš„å€¼ã€‚
â€œå¯¹è±¡åˆ‡å‰²&quot;é—®é¢˜ï¼š
å¦‚æœæ˜¯å€¼ä¼ é€’ï¼ŒDerived-Objä¼ é€’ç»™Base-Paramï¼Œä¼šä¸¢å¤±Derivedç‹¬æœ‰çš„ç‰¹æ€§ï¼Œåªä¿ç•™Baseçš„é‚£éƒ¨åˆ†ã€‚</li>
<li>å¯¹äºC++å†…ç½®ç±»å‹ï¼Œå€¼ä¼ é€’å¾€å¾€æ›´é«˜æ•ˆ
ä»C++ç¼–è¯‘å™¨çš„åº•å±‚å®ç°è§’åº¦æ¥çœ‹ï¼Œreferenceså¼•ç”¨å¾€å¾€æ˜¯ä»¥æŒ‡é’ˆçš„å½¢å¼å®ç°ã€‚æ‰€ä»¥å¦‚æœæ˜¯å†…ç½®æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚intç±»å‹ ï¼Œç›´æ¥å€¼ä¼ é€’åè€Œæ•ˆç‡æ›´é«˜ã€‚
<blockquote>
<p>æ­¤è§„åˆ™è¿˜é€‚ç”¨äºSTLè¿­ä»£å™¨å’Œå‡½æ•°å¯¹è±¡ã€‚</p>
</blockquote>
</li>
</ul>
<h3 id="r21-å¿…é¡»è¿”å›å¯¹è±¡æ—¶ä¸è¦éšæ„è¿”å›reference">R21 å¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œä¸è¦éšæ„è¿”å›reference</h3>
<p><strong>ä¸è¦è¿”å›æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘ä»¥ä¸‹å¯¹è±¡</strong>:</p>
<ul>
<li>å±€éƒ¨æ ˆå¯¹è±¡(local stack)
å‡½æ•°å†…éƒ¨æ–°å»ºçš„æ ˆå˜é‡å¯¹è±¡ï¼Œå‡ºäº†å‡½æ•°å°±é¢ä¸´æ¶ˆäº¡ï¼Œä»æŒæœ‰å®ƒçš„å¼•ç”¨/æŒ‡é’ˆï¼Œæ˜¯å…¸å‹çš„æœªå®šä¹‰è¡Œä¸ºã€‚</li>
<li>å †åˆ†é…å¯¹è±¡(heap allocated)
å†…éƒ¨newï¼Œç„¶åreturnå‡ºå»ä½¿ç”¨ï¼Œä¸€æ¥ä¼šå¢åŠ å¤–éƒ¨deleteçš„è´Ÿæ‹…ï¼ŒäºŒæ¥å¯èƒ½deleteçš„æœºä¼šéƒ½æ²¡æœ‰ã€‚ä»£ç å¦‚ä¸‹ï¼š
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="n">Rational</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rational</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">n</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">n</span><span class="p">,</span><span class="n">lhs</span><span class="p">.</span><span class="n">d</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">d</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¦‚ä¸‹ä½¿ç”¨è¿ä¹˜ï¼Œåˆ™æ²¡æœ‰deleteçš„æœºä¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Rational</span> <span class="n">w</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">w</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span><span class="p">;</span> <span class="c1">// å†…å­˜æ³„æ¼ï¼ï¼ï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div>ä¸Šè¿°ä»£ç è¿”å›çš„æ˜¯å¼•ç”¨ï¼Œè¿”å›æŒ‡é’ˆä¹Ÿæ˜¯ä¸€æ ·çš„è´Ÿä½œç”¨ã€‚</li>
<li>å±€éƒ¨staticå¯¹è±¡(local static)
å‡½æ•°å†…éƒ¨çš„staticå¯¹è±¡ï¼Œåªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¸”åªæœ‰ä¸€ä»½ï¼Œæœ‰è®°å¿†åŠŸèƒ½ï¼Œå¯ä»¥è¢«æ›´æ–°ã€‚é‚£ä¹ˆä¸‹è¿°ä»£ç å°±ä¼šå‡ºç°é—®é¢˜ï¼š
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">static</span> <span class="n">Rational</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span> <span class="o">=</span> <span class="n">Rational</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">n</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">n</span><span class="p">,</span><span class="n">lhs</span><span class="p">.</span><span class="n">d</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">result</span><span class="p">;</span> <span class="c1">//åœ¨è°ƒç”¨è€…çœ‹æ¥ï¼Œå› ä¸ºæ˜¯å¼•ç”¨ï¼Œæ°¸è¿œåªçœ‹åˆ°ç‹¬ä¸€ä»½çš„resultçš„â€œæœ€æ–°å€¼ â€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸‹æ–¹çš„æ¯”è¾ƒæ°¸è¿œéƒ½æ˜¯trueï¼Œæ°¸è¿œèµ°ifåˆ†æ”¯  ï¼ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Rational</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">((</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">d</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//ä¹˜ç§¯ç›¸ç­‰ï¼Œèµ°ifåˆ†æ”¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//ä¹˜ç§¯ä¸ç›¸ç­‰ï¼Œèµ°elseåˆ†æ”¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Tips<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><blockquote>
<p>é‚£æ˜¯ä¸æ˜¯æ°¸è¿œä¸èƒ½ä»¥referenceä½œä¸ºè¿”å›å€¼å‘¢ ï¼Ÿ
å½“ç„¶ä¸æ˜¯ï¼Œ*thiså¯ä»¥è¿”å›å…¶å¼•ç”¨ï¼Œå‚è€ƒRule10ï¼›æˆ–è€…ç±»æˆå‘˜ä½œä¸ºè¿”å›å€¼æ—¶ï¼Œå¯ä»¥è¿”å›å…¶å¼•ç”¨ï¼Œä½†æœ€å¥½æ˜¯constã€‚</p>
</blockquote>
</div>
    </div>
  </div>
<h3 id="r22-å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate">R22 å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate</h3>
<ul>
<li>
<p>æˆå‘˜å˜é‡ä¸ºprivateè·å¾—çš„å¥½å¤„</p>
<ol>
<li>å®¢æˆ·è®¿é—®æ•°æ®çš„ä¸€è‡´æ€§ã€‚éƒ½æ˜¯ç”¨getterå‡½æ•°ï¼ˆéœ€è¦åŠ æ‹¬å·ï¼‰ï¼Œè€Œä¸æ˜¯æ··ç”¨å‡½æ•°è·å–å’Œç›´æ¥è®¿é—®ï¼›</li>
<li>ç»†åŒ–æˆå‘˜å˜é‡çš„è®¿é—®æƒé™ã€‚æ ¹æ®æ˜¯å¦æœ‰getterã€setterå‡½æ•°å¯ä»¥ç²¾å‡†æ§åˆ¶read/write/noneè¿™æ ·çš„ç»†åŒ–ã€‚</li>
<li>ä¿æŒå®ç°å¼¹æ€§ã€‚æ¯”å¦‚è·å–æŸç³»ç»ŸæŒ‡æ ‡ï¼Œå¯ä»¥åœ¨getterå‡½æ•°ä¸­ä¿®æ”¹å„ç§çµæ´»çš„ç­–ç•¥å’Œç®—æ³•ï¼Œè€Œè°ƒç”¨è€…æ„ŸçŸ¥ä¸åˆ°ã€‚</li>
<li>å°è£…æ€§ã€‚å°è£…æ€§æ˜¯æŒ‡â˜ <code>è¶Šå¤šå‡½æ•°å¯ä»¥è®¿é—®è¯¥æ•°æ®ï¼Œå°è£…æ€§è¶Šä½</code>ã€‚
å®¢æˆ·è°ƒç”¨ç«¯æ„ŸçŸ¥ä¸åˆ°classå†…éƒ¨çš„å®ç°ï¼Œè¿™äº›ç¡®å®ä¹Ÿæ˜¯ä¸å¿…æš´éœ²çš„ã€‚å¹¶ä¸”ï¼Œå¦‚æœæ˜¯è¦ä¿®æ”¹æŸä¸ªå˜é‡ï¼Œä½¿ç”¨setterå‡½æ•°ä¹Ÿæ›´æ–¹ä¾¿è°ƒè¯•ï¼Œä¸è‡³äºè¢«éšæ„ä¿®æ”¹ã€‚</li>
</ol>
</li>
<li>
<p>protectedå’Œpublicå·®ä¸å¤šï¼Œéƒ½ä¸å…·å¤‡å°è£…æ€§
å¦‚æœæŸä¸ªpublic/protectedå˜é‡æƒé™è¢«å–æ¶ˆï¼ˆæ¯”å¦‚æ”¹ä¸ºprivateï¼‰ï¼Œå°†ä¼šå¯¼è‡´å¤§é¢ç§¯çš„ç¼–è¯‘é”™è¯¯ï¼Œèƒ½è®¿é—®çš„å˜æˆunaccessibleï¼Œéœ€è¦å¯¹åº”ä¿®æ”¹è®¸å¤šä»£ç ã€‚</p>
</li>
</ul>
<h3 id="r23-å®å¯ç”¨non-membernon-friendä»£æ›¿memberå‡½æ•°">R23 å®å¯ç”¨non-member,non-friendä»£æ›¿memberå‡½æ•°</h3>
<ul>
<li>å®é™…ä¸Šï¼Œnon-member/non-friendå‡½æ•°å…·æœ‰æ›´å¤§çš„å°è£…æ€§
è€ƒè™‘ä¸‹è¿°ä¸€ä¸ªç±»WebBrowserï¼Œmemberå‡½æ•°å’Œnon-memberå‡½æ•°ï¼Œå®é™…ä¸Šï¼Œ<strong>memberå‡½æ•°</strong>WebBrowser::clearEverythingå…·æœ‰å…¶ä»–privateæ•°æ®çš„è®¿é—®æƒé™ï¼Œ<strong>å°è£…æ€§æ˜¯æ›´å·®çš„</strong>ï¼
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WebBrowser</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">clearCache</span><span class="p">()</span> <span class="p">{</span><span class="cm">/*to clear cache*/</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">clearHistory</span><span class="p">()</span> <span class="p">{</span><span class="cm">/*to clear history*/</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">removeCookies</span><span class="p">()</span> <span class="p">{</span><span class="cm">/*to clear cookies*/</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">clearEverything</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">clearCache</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">clearHistory</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">removeCookies</span><span class="p">();}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">clearBrowser</span><span class="p">(</span><span class="n">WebBrowser</span> <span class="o">&amp;</span><span class="n">wb</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">wb</span><span class="p">.</span><span class="n">clearCache</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">wb</span><span class="p">.</span><span class="n">clearHistory</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">wb</span><span class="p">.</span><span class="n">removeCookies</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>å·¥ç¨‹ç»“æ„å®‰æ’
å¯¹äºä¸Šè¿°WebBrowserçš„ä¾‹å­ï¼Œnon-memberå‡½æ•°æ”¾å“ªé‡Œå‘¢ï¼Œé™¤äº†å¯ä»¥æ˜¯å…¶ä»–classçš„memberå‡½æ•°ï¼Œæ›´é€‚ç”¨è‡ªç„¶çš„ç­”æ¡ˆæ˜¯ç”¨<code>namespaceåŒ…è£¹èµ·æ¥</code>ã€‚ä»£ç å¦‚ä¸‹ï¼š
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">WebBrowserStuff</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">WebBrowser</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">clearBrowser</span><span class="p">(</span><span class="n">WebBrowser</span> <span class="o">&amp;</span><span class="n">wb</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>æ³¨æ„ï¼š<code>namespaceå¯ä»¥è·¨è¶Šå¤šä¸ªæºç æ–‡ä»¶ï¼Œè€Œclassä¸èƒ½</code>ã€‚
<strong>é€šå¸¸çš„ç»„ç»‡æ–¹å¼</strong>ï¼šå¤šä¸ª.hå¤´æ–‡ä»¶éƒ½ä½¿ç”¨åŒä¸€ä¸ªnamespaceï¼Œç®¡ç†ä¸åŒçš„åŠŸèƒ½æ¨¡å—ã€‚é™¤äº†è®©æ¨¡å—æ›´æ¸…æ™°ï¼Œè¿˜èƒ½é™ä½ä¸å¿…è¦çš„ç¼–è¯‘ä¾èµ–å…³ç³»ã€‚</li>
<li>å¯¹äºprivateæ•°æ®ï¼Œmemberå’Œfriendå‡½æ•°å…·æœ‰ç›¸åŒçš„è®¿é—®æƒé™
åŸºäºæ­¤ï¼Œè¿™é‡Œè®¨è®ºçš„å°è£…æ€§ä¸åœ¨äºmemberä¸å¦ï¼Œè€Œæ˜¯memberå’Œnon-member ï¼Œnon-friendå‡½æ•°ä¹‹é—´ã€‚</li>
</ul>
<h3 id="r24-è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢è¯·é‡‡ç”¨non-member">R24 è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢ï¼Œè¯·é‡‡ç”¨non-member</h3>
<p>æ ‡é¢˜éœ€æ˜æ™°ï¼šæ‰€æœ‰å‚æ•°ï¼Œæ˜¯æŒ‡<strong>åŒ…å«äº†è¢«thisæŒ‡é’ˆæ‰€æŒ‡å‘çš„é‚£ä¸ªéšå«å‚æ•°</strong>ï¼ˆnon-explicitæ„é€ å‡½æ•°è°ƒç”¨éšå¼ç±»å‹è½¬æ¢æ—¶ï¼‰ã€‚</p>
<p><strong>åº”å¯¹å…·ä½“åœºæ™¯</strong>ï¼šæ„é€ å‡½æ•°å…è®¸éšå¼ç±»å‹è½¬æ¢ï¼Œä¸”éœ€è¦è¿™ä¸ªæ„é€ å¥½çš„å¯¹è±¡ç«‹å³è°ƒç”¨æŸmemberå‡½æ•°foo(æ¯”å¦‚operatorå‡½æ•°)ï¼Œæ­¤æ—¶è¿™ä¸ªfooå‡½æ•°åº”è¯¥æ”¹ä¸ºnon-memberçš„fooå‡½æ•°ã€‚</p>
<p>è€ƒè™‘ä¸€ä¸ªæœ‰ç†æ•°ç±»Rationalï¼Œå…è®¸éšå¼ç±»å‹è½¬æ¢æ„é€ ï¼ˆå³non-explicitï¼‰ï¼Œå¦‚æœ<code>operator*</code>æ˜¯memberå‡½æ•°åˆ™ä¼šå‡ºç°é—®é¢˜ã€‚Rationalç±»å®ç°ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-16"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Rational</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Rational</span><span class="p">(</span><span class="kt">int</span> <span class="n">numerator</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">denominator</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span><span class="n">numerator_</span><span class="p">(</span><span class="n">numerator</span><span class="p">),</span> <span class="n">denominator_</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">Rational</span> <span class="k">operator</span><span class="o">*</span> <span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span><span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nf">Rational</span><span class="p">(</span><span class="n">numerator_</span><span class="o">*</span><span class="n">rhs</span><span class="p">.</span><span class="n">numerator_</span><span class="p">,</span> <span class="n">denominator_</span><span class="o">*</span><span class="n">rhs</span><span class="p">.</span><span class="n">denominator_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">numerator</span><span class="p">()</span><span class="k">const</span>  <span class="p">{</span> <span class="k">return</span> <span class="n">numerator_</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">denominator</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">denominator_</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">numerator_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">denominator_</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ä»£ç å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸èƒ½æ··åˆè¿ç®—ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-17"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">Rational</span> <span class="nf">rat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Rational</span> <span class="n">rat3Tm</span> <span class="o">=</span> <span class="n">rat</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>   <span class="c1">//èƒ½æˆåŠŸè°ƒç”¨member-operator*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Rational</span> <span class="n">rat3Tm2</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">rat</span><span class="p">;</span>  <span class="c1">//ç¼–è¯‘æŠ¥é”™ï¼ï¼ï¼ æœ¬èŠ‚çš„åœºæ™¯å°±åœ¨äºæ­¤.
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè¦è®©è¿™ç§æ··åˆè¿ç®—æ— éšœç¢ï¼ŒæŠŠ<code>operator*</code>å‡½æ•°æ”¹æˆnon-memberå³å¯ï¼Œæ³¨æ„è¦<strong>åˆ æ‰åŸæ¥memberå†…çš„<code>operator*</code></strong>ï¼Œä¸èƒ½åŒæ—¶å­˜åœ¨è¿™2ä¸ªoperator*ã€‚</p>
<div class="highlight" id="id-18"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Rational</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//... æ³¨æ„ï¼Œè¦åˆ é™¤ç±»å†…çš„memberå‡½æ•°operator*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">Rational</span> <span class="k">operator</span><span class="o">*</span> <span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nf">Rational</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">numerator</span><span class="p">()</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">numerator</span><span class="p">(),</span> <span class="n">lhs</span><span class="p">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">denominator</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="r25-è€ƒè™‘å†™ä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„swapå‡½æ•°">R25 è€ƒè™‘å†™ä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„swapå‡½æ•°</h3>
<ul>
<li>å½“ std::swapå¯¹æŸä¸ªç±»å‹æ•ˆç‡ä¸é«˜æ—¶ï¼Œæä¾›ä¸€ä¸ªswapæˆå‘˜å‡½æ•°ï¼Œä¸”è¯¥swapä¸æŠ›å¼‚å¸¸
å…ˆçœ‹ä¸€ä¸‹æ•ˆç‡ä¸é«˜çš„std::swapå®ç°ï¼š
<div class="highlight" id="id-19"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>  <span class="c1">//std::swapçš„å…¸å‹å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//ç½®æ¢ a å’Œ b çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">T</span> <span class="nf">temp</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>   <span class="c1">//è‹¥Tæ˜¯classï¼Œæ­¤å¤„è°ƒç”¨copyæ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>       <span class="c1">//è‹¥Tæ˜¯classï¼Œæ­¤å¤„è°ƒç”¨copy assignmentæ“ä½œç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">b</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>è€ƒè™‘è¿™æ ·çš„ä½¿ç”¨åœºæ™¯ï¼šéœ€è¦swapä¸€ä¸ª&quot;pimplæ‰‹æ³•â€(pointer to implementation)å®ç°çš„ç±»ï¼Œè¿™ç§ä¼ ç»Ÿçš„std::swapå¿…ç„¶æ˜¯æ•ˆç‡ä¸é«˜(æ·±å¤åˆ¶implç±»çš„æ•°æ®è€—æ—¶è¾ƒé•¿)ã€‚
<div class="highlight" id="id-20"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WidgetSwImpl</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span> <span class="c1">//å¾ˆå¤§çš„vector,æ„å‘³ç€å¤åˆ¶æ—¶é—´å¾ˆé•¿
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WidgetSw</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">WidgetSw</span><span class="p">(</span><span class="n">WidgetSwImpl</span><span class="o">*</span> <span class="n">pImpl</span><span class="p">)</span> <span class="o">:</span><span class="n">pImpl_</span><span class="p">(</span><span class="n">pImpl</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">WidgetSw</span><span class="p">(</span><span class="k">const</span> <span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span><span class="cm">/*å…¶ä»–copy&amp;initialæ“ä½œ*/</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="n">pImpl_</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">pImpl_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//public-memberå‡½æ•°swap
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>   <span class="c1">//ä»¤std::swapåœ¨æ­¤å‡½æ•°å¯ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">swap</span><span class="p">(</span><span class="n">pImpl_</span><span class="p">,</span><span class="n">other</span><span class="p">.</span><span class="n">pImpl_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">WidgetSwImpl</span><span class="o">*</span> <span class="n">pImpl_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div>è°ƒç”¨æ—¶ä»£ç å¦‚ä¸‹ï¼š
<div class="highlight" id="id-21"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">WidgetSw</span> <span class="nf">wSw1</span><span class="p">(</span><span class="k">new</span> <span class="n">WidgetSwImpl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">WidgetSw</span> <span class="nf">wSw2</span><span class="p">(</span><span class="k">new</span> <span class="n">WidgetSwImpl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">wSw1</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="n">wSw2</span><span class="p">);</span> <span class="c1">//æˆåŠŸè¿è¡Œ
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>å¦‚æœæä¾›äº†member swapï¼Œéœ€æä¾›ä¸€ä¸ªnon-memberçš„swapè°ƒç”¨å‰è€…
æ³¨æ„ï¼Œå…¶å®ä¸Šè¿°swapæˆå‘˜å‡½æ•°ä½¿ç”¨èµ·æ¥ä¸ç®—ç›´è§‚å’Œç»Ÿä¸€ï¼Œå¯ä»¥å…¨ç‰¹åŒ–std::swapè®©ä½¿ç”¨æ›´ç›´è§‚æ–¹ä¾¿ï¼Œä»£ç å¦‚ä¸‹ï¼š
<div class="highlight" id="id-22"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="o">&lt;&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="n">swap</span><span class="o">&lt;</span><span class="n">WidgetSw</span><span class="o">&gt;</span><span class="p">(</span><span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">WidgetSw</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">a</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å®¢æˆ·ç«¯åº”ç”¨ä»£ç å¯ä»¥å¦‚ä¸‹è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1">// æ³¨æ„ï¼Œä¸åº”è¯¥ï¼Œä¹Ÿæ²¡å¿…è¦åŠ  std::ï¼Œä¼šé™åˆ¶ç¼–è¯‘å™¨åªä½¿ç”¨stdå‘½åç©ºé—´çš„swap
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">swap</span><span class="p">(</span><span class="n">wSw1</span><span class="p">,</span><span class="n">wSw2</span><span class="p">);</span><span class="c1">//ç¼–è¯‘å™¨ä¼šä¼˜å…ˆæŒ‘ä¸­å…¨ç‰¹åŒ–ç‰ˆæœ¬çš„std::swap
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>å¦‚æœæ˜¯Class-Templateï¼Œåˆ™ä¸è¦ç‰¹åŒ–stdå‘½åç©ºé—´çš„swapï¼Œè€Œæ˜¯ç§»åˆ°å…¶å®ƒå‘½åç©ºé—´
<div class="highlight" id="id-23"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">WidgetStuff</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">WidgetSw</span><span class="p">{</span> <span class="cm">/*çœç•¥ç±»å®šä¹‰*/</span><span class="p">}</span> <span class="c1">// ç±»å†…å«æœ‰swapæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">WidgetSw</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">WidgetSw</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Notice<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><ul>
<li>stdå‘½åç©ºé—´çš„å‡½æ•°ä¸è¦å°è¯•é‡è½½ï¼Œä¹Ÿä¸è¦å¢åŠ ä»»ä½•æ–°ä¸œè¥¿</li>
<li>C++åªå…è®¸å¯¹<code>Class-Template</code>ç›´æ¥åç‰¹åŒ–ï¼Œä¸èƒ½å¯¹<code>Function-Template</code>åç‰¹åŒ–(å‡½æ•°æ¨¡æ¿å¯ä»¥é€šè¿‡é‡è½½é—´æ¥å®ç°â€œåç‰¹åŒ–â€çš„ä½œç”¨)</li>
<li><strong>æˆå‘˜ç‰ˆswapç»å¯¹ä¸è¦æŠ›å‡ºå¼‚å¸¸</strong>ï¼Œéæˆå‘˜swapå¯ä»¥(å› ä¸ºæˆå‘˜swapçš„ä¸€ä¸ªæœ€å¥½åº”ç”¨å°±æ˜¯æä¾›å¼‚å¸¸å®‰å…¨æ€§)</li>
</ul>
</div>
    </div>
  </div></li>
</ul>
<p>ref:</br>
[1]. <a href="https://blog.csdn.net/cltcj/category_12098441.html"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/cltcj/category_12098441.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[2]. <a href="https://kissingfire123.github.io/2022/01/11_effective-c-%e4%b9%8b%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93%e4%ba%8c/"target="_blank" rel="external nofollow noopener noreferrer">https://kissingfire123.github.io/2022/01/11_effective-c-%e4%b9%8b%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93%e4%ba%8c/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></p>]]></description></item><item><title>Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [1]</title><link>https://jianye0428.github.io/posts/partone/</link><pubDate>Sat, 29 Jul 2023 18:51:19 +0800</pubDate><author>Jian YE</author><guid>https://jianye0428.github.io/posts/partone/</guid><description><![CDATA[<h1 id="åºè¨€">åºè¨€</h1>
<p>è¿™æœ¬C++çš„ç»å…¸ä¹‹ä½œï¼Œä½œè€…æ˜¯å¤§ä½¬<code>Scott Meyers</code>ğŸ‘‰<a href="https://www.aristeia.com/books.html"target="_blank" rel="external nofollow noopener noreferrer">å¤§ä½¬ä¸»é¡µ<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a>ï¼Œè¿˜å†™è¿‡å…¶ä»–å‡ æœ¬å½±å“æ·±è¿œçš„C++ç»å…¸ï¼Œä¾‹å¦‚<code>ã€ŠEffective STLã€‹</code>,<code>ã€ŠMore Effective C++ã€‹</code>,<code>ã€ŠEffective Mordern C++ã€‹</code>,<code>ã€ŠOverview of the New C++(C++11/14)ã€‹</code>ç­‰ç­‰ã€‚æœ¬äººçœ‹çš„æ˜¯ä¸­æ–‡ç‰ˆï¼Œä¾¯æ·è€å¸ˆç¿»è¯‘çš„ï¼Œç²¾è¯»åˆ†æå¹¶å®è·µæ¨æ•²åï¼Œæ•´ç†æˆåšå®¢è®°å½•ä¸‹æ¥ã€‚</p>
<blockquote>
<p>(Effective-C++æ€»ç»“ç³»åˆ—åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬ä¸€éƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬1~2ç« ï¼Œå†…å®¹èŒƒå›´Rule01~12ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule01ç®€å†™ä¸ºR01)ã€‚</p>
</blockquote>
<div class="details admonition Note">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>Effective-C++ç³»åˆ—List<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ <a href="https://jianye0428.github.io/posts/partone/"target="_blank" rel="external nofollow noopener noreferrer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
ğŸ’¡ Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)</br>
ğŸ’¡ Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)</br>
ğŸ’¡ Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)</br></div>
    </div>
  </div>
<h2 id="ch1è®©è‡ªå·±ä¹ æƒ¯c">CH1.è®©è‡ªå·±ä¹ æƒ¯C++</h2>
<h3 id="r01-è§†cä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦">R01 è§†C++ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦</h3>
<p>å¦‚ä»Šçš„C++å·²ç»æ˜¯ä¸ªå¤šé‡èŒƒå¼(multiparadigm)è¯­è¨€ï¼ŒåŒæ—¶æ”¯æŒé¢å‘è¿‡ç¨‹å½¢å¼ã€é¢å‘å¯¹è±¡å½¢å¼ã€å‡½æ•°å½¢å¼ã€æ³›å‹å½¢å¼ã€å…ƒç¼–ç¨‹å½¢å¼ã€‚ è¦ç†è§£è¿™ä¹ˆå¤šç‰¹æ€§ï¼Œå¯ä»¥ç®€å•çš„å½’ç»“ä¸º<code>å››ç§æ¬¡è¯­è¨€</code>(sublanguage)ç»„æˆï¼š</p>
<ul>
<li><strong>Cè¯­è¨€ï¼š</strong><code>C++ä»ä»¥Cä¸ºåŸºç¡€</code>ã€‚C++æ˜¯Cçš„è¶…é›†ï¼ŒåŒºå— ã€è¯­å¥ã€é¢„å¤„ç†ã€å†…ç½®æ•°æ®ç±»å‹ã€æ•°ç»„ã€æŒ‡é’ˆç­‰å…¨éƒ¨æ¥è‡ªäºCè¯­è¨€ï¼›
<ul>
<li>è¯´åˆ°åº• C++ ä»ç„¶ä»¥ C ä¸ºåŸºç¡€ã€‚åŒºå—ã€è¯­å¥ã€é¢„å¤„ç†å™¨ã€å†…ç½®æ•°æ®ç±»å‹ ã€æ•°ç»„ã€æŒ‡é’ˆç­‰ç»Ÿç»Ÿæ¥è‡ªCï¼Œè®¸å¤šæ—¶å€™C++å¯¹é—®é¢˜çš„è§£å†³å…¶å®ä¸è¿‡å°±æ˜¯è¾ƒé«˜çº§çš„ C è§£æ³•ï¼Œä½†å½“ä½ C++å†…çš„ C æˆåˆ†å·¥ä½œæ—¶ï¼Œé«˜æ•ˆç¼–ç¨‹å®ˆåˆ™æ˜ ç…§å‡º C è¯­è¨€çš„å±€é™ï¼šæ²¡æœ‰æ¨¡æ¿(template) ï¼Œæ²¡æœ‰å¼‚å¸¸(exceptions)ï¼Œæ²¡æœ‰é‡è½½(overloading)â€¦â€¦</li>
</ul>
</li>
<li><strong>Object-Oriented C++:</strong> é¢å‘å¯¹è±¡ç‰¹æ€§ã€‚è¿™éƒ¨åˆ†ä¹Ÿå°±æ˜¯ C with classes æ‰€è¯‰æ±‚çš„ï¼šclasses(åŒ…æ‹¬æ„é€ å‡½æ•°å’Œææ„å‡½æ•°)ï¼Œå°è£…(encapsulation)ã€ç»§æ‰¿(inheritance)ã€å¤šæ€(polymorhpism)ã€virtualå‡½æ•°(åŠ¨æ€ç»‘å®š)â€¦â€¦ç­‰ç­‰ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯é¢å‘å¯¹è±¡è®¾è®¡ä¹‹å¤å…¸å®ˆåˆ™åœ¨C++ ä¸Šçš„ç›´æ¥å®æ–½ã€‚</li>
<li>**Template C++:**C++çš„æ³›å‹(generic)ç¼–ç¨‹çš„éƒ¨åˆ†ï¼Œä¹Ÿå¸¦æ¥äº†é»‘é­”æ³•-æ¨¡æ¿å…ƒç¼–ç¨‹(TMP,Metaprogramming)ï¼›</li>
<li>**STLï¼š**STL(Standard Temlate Library)å³æ ‡å‡†æ¨¡æ¿åº“ï¼Œå®ƒæ˜¯templateç¨‹åºåº“ã€‚å°è£…äº†å„ç±»å®¹å™¨(container)ã€é…ç½®å™¨(allocator)ã€è¿­ä»£å™¨(iterator)ã€ç®—æ³•ä»¥åŠå¸¸ç”¨å¯¹è±¡ã€‚</li>
</ul>
<p><strong>æ€»ç»“:</strong>
C++é«˜æ•ˆç¼–ç¨‹å®ˆåˆ™è§†çŠ¶å†µè€Œå˜åŒ–ï¼Œå–å†³äºä½ ä½¿ç”¨C++çš„å“ªä¸€éƒ¨åˆ†</p>
<h3 id="r02-å°½é‡ä»¥constenuminlineæ›¿æ¢define">R02 å°½é‡ä»¥<code>const</code>,<code>enum</code>,<code>inline</code>æ›¿æ¢<code>#define</code></h3>
<ul>
<li><strong>å¯¹äºå®å®šä¹‰çš„å¸¸é‡ï¼Œå»ºè®®ç”¨constå¸¸é‡æˆ–è€…æšä¸¾enumæ›¿æ¢</strong>
è¿™æ ·åšçš„å¥½å¤„æ˜¯æ–¹ä¾¿è°ƒè¯•ï¼Œå› ä¸ºå®æŠ¥é”™å°±æ˜¯ä¸ªå¸¸æ•°å€¼ï¼Œæ²¡æœ‰ç¬¦å·è¡¨ï¼›å¹¶ä¸”å®ä¸å…·æœ‰å°è£…æ€§(å®çš„ä½œç”¨åŸŸæ˜¯åœ¨ç¼–è¯‘æ—¶æ˜¯å…¶å®šä¹‰ä¹‹äº‹)ã€‚
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// ä¸¾ä¾‹ï¼šMAX_DATA_COUNTåœ¨é¢„å¤„ç†é˜¶æ®µå°±ä¼šè¢«æ›¿æ¢ï¼Œç¼–è¯‘å™¨ä¸ä¼šè§åˆ°å®ƒï¼Œæ‰€ä»¥ä¸€æ—¦æœ‰ç›¸å…³æŠ¥é”™ï¼Œç»™çš„æ˜¯100è¿™ä¸ªå€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define MAX_DATA_COUNT   100
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">const</span>  <span class="kt">int</span> <span class="n">MAX_DATA_COUNT</span> <span class="o">=</span> <span class="mi">100</span> <span class="p">;</span><span class="c1">//å¸¸é‡åªæœ‰ä¸€ä»½ï¼Œå®ä¼šå¯¼è‡´å¤šä»½å¸¸é‡å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Buffer</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span><span class="c1">//...ç±»å…¶ä»–éƒ¨åˆ†çœç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">static</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">factor_</span> <span class="p">;</span><span class="c1">//staticå¸¸é‡,ç±»å†…å£°æ˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span>  <span class="n">times_</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="c1">// intç±»å‹å…è®¸ç±»å†…åˆå§‹åŒ–,è§„èŒƒä¸Šè¿˜æ˜¯å»ºè®®æ‹¿åˆ°ç±»å¤–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="k">const</span>  <span class="kt">int</span> <span class="n">ArrLength</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">arr</span><span class="p">[</span><span class="n">ArrLength</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">double</span> <span class="n">Buffer</span><span class="o">::</span><span class="n">factor_</span>  <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span><span class="c1">//ç±»å¤–åˆå§‹åŒ–,ä¸€èˆ¬å†™åœ¨å®ç°æ–‡ä»¶*.cpp,*.ccä¸­
</span></span></span></code></pre></td></tr></table>
</div>
</div>å¦‚æœç¼–è¯‘å™¨ä¸å…è®¸å£°æ˜æ—¶&quot;in-classåˆå€¼è®¾å®š&quot;,å¦‚æœæ˜¯æ•´å½¢å¸¸é‡ï¼Œå¯ä»¥è®©æšä¸¾å€¼æ¥æ›¿ä»£ï¼Œè€Œä¸”<font color=red><code>æšä¸¾å€¼ä¸èƒ½è¢«å–åœ°å€</code></font>ã€‚</li>
<li><strong>å¯¹äºå®å®šä¹‰çš„å‡½æ•°ï¼Œå»ºè®®ç”¨å†…è”inlineå‡½æ•°æ›¿æ¢</strong>
å®å‡½æ•°æ²¡åŠæ³•å•è¡Œdebugè°ƒè¯•ï¼Œè€Œå†…è”å‡½æ•°å¯ä»¥ï¼›
å®çš„å†™æ³•å³ä½¿å°å¿ƒç¿¼ç¿¼çš„åŠ å¥½äº†æ‹¬å·ï¼Œä¹Ÿå¯èƒ½é€ æˆæ„æƒ³ä¸åˆ°çš„<font color=red><code>å®å‡½æ•°é‡å¤è®¡ç®—</code></font>çš„é—®é¢˜ã€‚
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#define  GET_MAX(a,b)   ((a)&gt;(b) ? (a) :(b))
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">GET_MAX</span><span class="p">(</span><span class="o">++</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>    <span class="c1">// aç´¯åŠ äºŒæ¬¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">GET_MAX</span><span class="p">(</span><span class="o">++</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">+</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// aç´¯åŠ ä¸€æ¬¡
</span></span></span><span class="line"><span class="cl"><span class="c1">// å®šä¹‰ä¸ªinlineå‡½æ•°å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜,(a,b)ä½œä¸ºå‡½æ•°å…¥å‚å°±åªä¼šè®¡ç®—ä¸€æ¬¡
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>ä¸Šè¿°æƒ…å†µï¼Œä»çº¯Cè¯­è¨€è§’åº¦ï¼Œæƒ³é¿å…â€œå®å‡½æ•°é‡å¤è®¡ç®—â€ï¼Œå…¶å®è¿˜æœ‰ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨GNU C æ‰©å±•çš„ typeof æˆ– GCC çš„ <code>__auto_type</code> å…³é”®å­—ï¼Œè¯¦ç»†å¯å‚è€ƒGCCå®˜æ–¹æ–‡æ¡£é¡µé¢ã€‚2è€…éƒ½é€‚ç”¨äºGCCå’ŒClangï¼Œéƒ½ä¸é€‚ç”¨MSVCï¼‰ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-17"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define  GET_MAX_ONCE(a,b) \
</span></span></span><span class="line"><span class="cl"><span class="cp">      ( {typeof(a) _a = (a);   \
</span></span></span><span class="line"><span class="cl"><span class="cp">         typeof(b) _b = (b);   \
</span></span></span><span class="line"><span class="cl"><span class="cp">         (_a) &gt; (_b) ? (_a) : (_b); } )</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight" id="id-18"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="nf">GET_MAX</span><span class="p">(</span><span class="o">++</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">++</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;a = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, b = &#34;</span><span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, c = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="nf">GET_MAX_ONCE</span><span class="p">(</span><span class="o">++</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">++</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;a = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, b = &#34;</span><span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, c = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•ä»£ç è¾“å‡ºï¼š</p>
<div class="highlight" id="id-19"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">a</span> <span class="o">=</span> 11, <span class="nv">b</span> <span class="o">=</span> 22, <span class="nv">c</span> <span class="o">=</span> <span class="m">21</span>
</span></span><span class="line"><span class="cl"><span class="nv">a</span> <span class="o">=</span> 11, <span class="nv">b</span> <span class="o">=</span> 21, <span class="nv">c</span> <span class="o">=</span> <span class="m">20</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ğŸ¤” <code>ä½¿ç”¨ __auto_type</code> æ¥å–ä»£æ—¶è¦èµ‹åˆå€¼ï¼Œå…³é”®çš„ typeof é‚£è¡Œç”¨æ³•æ”¹ä¸º<code>__auto_type _a = (a);</code> ã€‚
__auto_type æ¯” typeof çš„ä¼˜åŠ¿ä¹‹å¤„åœ¨äºé¢å¯¹å˜é•¿æ•°ç»„(VLA)ï¼Œåªè§£æ1æ¬¡ï¼›ä»¥åŠé¢å¯¹åµŒå¥—å®å®šä¹‰æ—¶ä¹Ÿæ˜¯åªä¸¥æ ¼è§£æä¸€æ¬¡ã€‚</p>
</blockquote>
</div>
    </div>
  </div></li>
</ul>
<h3 id="r03-å°½å¯èƒ½ç”¨const">R03 å°½å¯èƒ½ç”¨const</h3>
<p>è¯´èµ·constï¼Œå…ˆå¤ä¹ ä¸ªé¢è¯•é«˜é¢‘é¢˜ğŸ˜</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//ç±»å‹charåœ¨å“ªé‡Œæ²¡å…³ç³»ï¼Œå…³é”®çœ‹constå’Œ*çš„ç›¸å¯¹ä½ç½®ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//conståœ¨*å·¦è¾¹ï¼ŒæŒ‡é’ˆæ‰€æŒ‡ç‰©ä¸ºå¸¸é‡;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//conståœ¨*å³è¾¹ï¼ŒæŒ‡é’ˆä¸ºå¸¸é‡ï¼›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">p</span><span class="p">;</span> <span class="c1">// æŒ‡é’ˆpæ‰€æŒ‡çš„å­—ç¬¦ä¸²ä¸ºå¸¸é‡ï¼Œä½†æ˜¯på¯ä»¥ä¿®æ”¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">char</span><span class="o">*</span> <span class="k">const</span> <span class="n">p</span><span class="p">;</span> <span class="c1">// æŒ‡é’ˆpæ˜¯å¸¸é‡ï¼ŒæŒ‡å‘çš„å­—ç¬¦ä¸²å¯ä¿®æ”¹
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>constä¿®é¥°å‡½æ•°è¿”å›å€¼æ—¶çš„é˜²å¾¡æ€§
constä¿®é¥°å‡½æ•°çš„è¿”å›å€¼ï¼Œå¯ä»¥é¿å…ä¸€äº›é”™è¯¯ï¼Œå¦‚ä¸‹ï¼š
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">const</span> <span class="n">Rational</span> <span class="k">operator</span><span class="o">*</span> <span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å­˜åœ¨Rational a,b,c;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="p">)</span> <span class="c1">//ä¾‹å¦‚æ‰‹è¯¯ &#34;==&#34;æ‰“æˆäº†&#34;=&#34;ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>constæˆå‘˜å‡½æ•°çš„é™åˆ¶
constæˆå‘˜å‡½æ•°æœ‰2ä¸ªå¥½å¤„ï¼š(1). æ˜ç¡®ç†è§£å‡½æ•°æ˜¯å¦ä¿®æ”¹å¯¹è±¡å†…å®¹ï¼›(2). ä½¿â€œæ“ä½œconstå¯¹è±¡â€æˆä¸ºå¯èƒ½ã€‚
å¯ä»¥é€šè¿‡constç‰¹æ€§è®©å¯¹è±¡è‡ªåŠ¨è°ƒç”¨æ­£ç¡®çš„ç‰ˆæœ¬ï¼š
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TextBlock</span><span class="p">{</span><span class="c1">//...ç±»å…¶ä»–éƒ¨åˆ†çœç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">const</span> <span class="kt">char</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span> <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">index</span><span class="p">];}</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">index</span><span class="p">];}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">TextBlock</span><span class="o">&amp;</span> <span class="n">ctb</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ctb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">;</span><span class="c1">//æ ¹æ®constç‰¹æ€§ï¼Œè°ƒç”¨ const TextBlock::operator[]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>æ€è€ƒï¼šconstæˆå‘˜å‡½æ•°ä¸ä¿®æ”¹æˆå‘˜å¯¹è±¡ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæˆå‘˜å¯¹è±¡ä¸ºæŒ‡é’ˆ<code>char *p</code>ï¼Œä»…ä¿®æ”¹<code>p</code>æŒ‡å‘çš„å†…å®¹ï¼Œé‚£å®ƒè¿˜æ˜¯<code>const</code>æˆå‘˜å‡½æ•°å—ï¼Ÿ
å®æµ‹ï¼šconstæˆå‘˜å‡½æ•°æ˜¯å…è®¸<code>p[2]= 'x'</code>è¿™ä¸€æ“ä½œçš„ï¼Œä½†æ˜¯ä¸å…è®¸p++ï¼›
<ul>
<li><code>bitwise-constness</code>(åˆç§°ä¸ºphysical constness)ç†å¿µè®¤ä¸ºä¸æ˜¯ï¼Œä¸èƒ½æ›´æ”¹ä»»ä½•å¯¹è±¡å†…çš„ä»»ä½•ä¸€ä¸ªbitã€‚è¿™ç§è¯´æ³•ä¹Ÿæœ‰çº°æ¼ï¼Œconstå‡½æ•°è¿”å›ä¸€ä¸ªå¼•ç”¨å°±å¤±æ§äº†,å¤–éƒ¨å¯æ”¹ï¼›</li>
<li><code>logical-constness</code>ç†å¿µåˆ™å…è®¸constæˆå‘˜å‡½æ•°ä¿®æ”¹æˆå‘˜å˜é‡çš„bitsï¼Œä½†åªæœ‰åœ¨å®¢æˆ·ç«¯ä¾¦æµ‹ä¸å‡ºçš„æƒ…å†µä¸‹;</li>
<li><code>constæˆå‘˜å‡½æ•°</code>å¦‚æœä¸€å®šè¦ä¿®æ”¹æˆå‘˜å˜é‡ï¼Œæˆå‘˜å˜é‡ä½¿ç”¨ <code>mutable</code> ä¿®é¥°å³å¯.</li>
</ul>
</li>
<li>constä¸non-constçš„æˆå‘˜å‡½æ•°å®ç°å®Œå…¨ç›¸åŒæ—¶
è¿™ç§æƒ…å†µï¼Œå¦‚ä½•å»é™¤ä»£ç å†—ä½™æ˜¯ä¸ªé—®é¢˜ã€‚ä¸è¦å°è£…å‡ºä¸€ä¸ªprivateå‡½æ•°ç„¶åä¸€èµ·è°ƒç”¨ï¼Œå¤šäº†å±‚è°ƒç”¨ã€‚
æ­£ç¡®åšæ³•ğŸ‘‰ <code>ä½¿ç”¨è½¬å‹,è®©non-constè°ƒç”¨constæˆå‘˜å‡½æ•°</code>ï¼Œå¦‚ä¸‹ä¸ºç¤ºä¾‹ï¼š</li>
</ul>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Rawdata</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Rawdata</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span><span class="o">:</span><span class="n">p_</span><span class="p">(</span><span class="n">src</span><span class="p">),</span><span class="n">length_</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">src</span><span class="p">))</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">GetLength</span><span class="p">()</span><span class="k">const</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">p_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span><span class="c1">//ä¸ºæ±‚ç®€ä¾¿,ä¸ä½œæ£€æŸ¥äº†ã€‚p_å†…å®¹ä¿®æ”¹ç¼–è¯‘å™¨æ˜¯å…è®¸çš„.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">length_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">GetLength</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&amp;&gt;</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Rawdata</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)).</span><span class="n">GetLength</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">p_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">length_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="r04-ç¡®å®šå¯¹è±¡ä½¿ç”¨å‰å…ˆåˆå§‹åŒ–">R04 ç¡®å®šå¯¹è±¡ä½¿ç”¨å‰å…ˆåˆå§‹åŒ–</h3>
<p>åˆ†æ¸…&quot;èµ‹å€¼&quot;å’Œ&quot;åˆå§‹åŒ–&quot;ï¼Œåœ¨ç±»çš„æ„é€ å‡½æ•°ä½“å†…ä½¿ç”¨ç­‰å·&quot;=&ldquo;èµ‹å€¼å¹¶é&quot;åˆå§‹åŒ–â€ã€‚æˆå‘˜å˜é‡çš„åˆå§‹åŒ–æ˜¯åœ¨æ„é€ å‡½æ•°çš„<u>æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</u>å®ç°ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p>
<p><code>C++åˆå§‹åŒ–çš„æ¬¡åº:</code></p>
<ol>
<li>Base classæ€»æ˜¯æ—©äºDerived Classè¢«åˆå§‹åŒ–ï¼›</li>
<li>Classå†…çš„æˆå‘˜å˜é‡æ€»æ˜¯ä»¥å£°æ˜æ¬¡åºè¢«åˆå§‹åŒ–ï¼›
ä¸¾ä¾‹: ä¸‹å›¾ä¸­çš„ä»£ç åˆå§‹åŒ–é¡ºåºä¸ºå£°æ˜é¡ºåº&quot;age_$\rightarrow$name_$\rightarrow$gender_ $\rightarrow$isVip_&rdquo;
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"> <span class="k">class</span> <span class="nc">Customer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> <span class="c1">//è¿™é‡Œåªæ˜¯ä¸ºäº†éªŒè¯ï¼Œå¦‚æœæ˜¯å®é™…å·¥ç¨‹ä»£ç ï¼Œå»ºè®®åˆå€¼åˆ—è¡¨å°½é‡å’Œå£°æ˜é¡ºåºä¿æŒä¸€è‡´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="n">Customer</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">gender</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">age</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isVip</span> <span class="o">=</span> <span class="nb">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="o">:</span><span class="n">isVip_</span><span class="p">(</span><span class="n">isVip</span><span class="p">),</span> <span class="n">gender_</span><span class="p">(</span><span class="n">gender</span><span class="p">),</span> <span class="n">name_</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">age_</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">     <span class="kt">uint8_t</span> <span class="n">age_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">gender_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="kt">bool</span> <span class="n">isVip_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><pre><code>ğŸ’¡ï¼šä»»ä½•ä¸€ä¸ªæˆå‘˜å˜é‡açš„åˆå§‹åŒ–æµç¨‹ï¼šç±»å†…å£°æ˜èµ‹åˆå€¼(C++11)-&gt;æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨-&gt;æ„é€ å‡½æ•°ä½“å†…èµ‹å€¼.
</code></pre>
</div>
    </div>
  </div></li>
<li>å‡½æ•°ä½“å¤–staticå˜é‡ç§°ä¸º<code>non-local static</code>å˜é‡ï¼Œè¿™ç§å˜é‡å¯ä»¥åœ¨å„è‡ªçš„ç¼–è¯‘å•å…ƒæ­£å¸¸å·¥ä½œï¼Œä½†C++æ— æ³•ä¿è¯åˆå§‹åŒ–æ¬¡åºï¼Œå½“ç¼–è¯‘å•å…ƒä¹‹é—´éœ€è¦å…±äº«å˜é‡æ—¶ï¼Œè€Œè¯¥å˜é‡ä¾èµ–non-local staticï¼Œå°±å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚
<strong>è§£å†³åŠæ³•</strong>æ˜¯å°†è¿™æ ·çš„å˜é‡æ”¾å›å‡½æ•°ä½“å†…ï¼Œæˆä¸ºlocal staticï¼Œå› ä¸ºC++ç¡®ä¿åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶ä¸€å®šä¼šåˆå§‹åŒ–è¿™ä¸ªstaticå˜é‡ã€‚</li>
</ol>
<h2 id="ch2æ„é€ ææ„èµ‹å€¼è¿ç®—">CH2.æ„é€ /ææ„/èµ‹å€¼è¿ç®—</h2>
<h3 id="r05-äº†è§£cé»˜è®¤ç¼–å†™å¹¶è°ƒç”¨å“ªäº›å‡½æ•°">R05 äº†è§£C++é»˜è®¤ç¼–å†™å¹¶è°ƒç”¨å“ªäº›å‡½æ•°</h3>
<p>ç¼–è¯‘å™¨å¯ä»¥æš—è‡ªä¸ºClassåˆ›å»º<code>defaultæ„é€ å‡½æ•°</code>ï¼Œ<code>copyæ„é€ å‡½æ•°(å¤åˆ¶æ„é€ )</code>ï¼Œ<code>copy assigment(èµ‹å€¼æ„é€ )æ“ä½œç¬¦</code>ï¼Œä»¥åŠ<code>defaultææ„å‡½æ•°</code>ã€‚</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EmptyClass</span><span class="p">{};</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç­‰ä»·äº:</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EmptyClass</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">EmptyClass</span><span class="p">()</span> <span class="p">{}</span>        <span class="c1">// defaultæ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">EmptyClass</span><span class="p">(</span><span class="k">const</span> <span class="n">EmptyClass</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{}</span><span class="c1">//copyæ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">~</span><span class="n">EmptyClass</span><span class="p">()</span> <span class="p">{}</span><span class="c1">//defaultææ„å‡½æ•°ï¼Œæ³¨æ„æ˜¯non-virtual
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">EmptyClass</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">EmptyClass</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{}</span><span class="c1">//copy assignmentæ“ä½œç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å¦‚æœä¸€ä¸ªéç©ºClassè‡ªè¡Œå£°æ˜äº†æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨å°±ä¸å†ä¸ºå®ƒåˆ›å»ºdefaultæ„é€ å‡½æ•°;</p>
</li>
<li>
<p>å¦‚æœä¸€ä¸ªClasså†…æœ‰å¼•ç”¨å˜é‡æˆ–constå˜é‡ï¼Œç¼–è¯‘å™¨ä¸ä¼šä¸ºå…¶ç”Ÿæˆcopy-assignmentå‡½æ•°ï¼Œéœ€è¦è‡ªå·±å®ç°.</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NameObject</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">NameObject</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span> <span class="o">:</span><span class="n">nameValue_</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">objectVal_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">nameValue_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">int</span> <span class="n">objectVal_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span><span class="c1">//è€ƒè™‘ä»¥ä¸‹åº”ç”¨ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">(</span><span class="s">&#34;Mike&#34;</span><span class="p">),</span> <span class="n">name2</span><span class="p">(</span><span class="s">&#34;Nicky&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">NameObject</span> <span class="nf">nObj</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">22</span><span class="p">),</span> <span class="n">nObj2</span><span class="p">(</span><span class="n">name2</span><span class="p">,</span><span class="mi">33</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">nObj2</span> <span class="o">=</span> <span class="n">nObj</span><span class="p">;</span><span class="c1">//è¿™ä¸€å¥ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œå› ä¸ºå¼•ç”¨ä¸èƒ½æŒ‡å‘2ä¸ªå¯¹è±¡ï¼Œä¸”constä¸å¯æ”¹
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="r06-ä¸æƒ³ç¼–è¯‘å™¨çš„è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°æ˜ç¡®æ‹’ç»">R06 ä¸æƒ³ç¼–è¯‘å™¨çš„è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°,æ˜ç¡®æ‹’ç»</h3>
<p>æŸäº›åœºæ™¯ï¼Œç±»å¯¹è±¡æœ¬èº«æ˜¯è®¤ä¸ºç‹¬ä¸€æ— äºŒçš„ï¼Œæ¯”å¦‚æè¿°äººç‰©æ€§æ ¼çš„ç±»Personality(å¯èƒ½ä¸æ°å½“)ï¼Œä¸åŒçš„äººæ€§æ ¼ä¸åŒï¼Œè‚¯å®šæ˜¯ä¸å¸Œæœ›èƒ½å¤åˆ¶/èµ‹å€¼çš„ã€‚
å¦‚æœä¸æƒ³ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆé‚£å‡ ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚ä¸æƒ³è¦å¤åˆ¶æ„é€ æˆ–èµ‹å€¼æ„é€ ï¼Œå°±æ˜ç¡®åœ¨ä»£ç ä¸­ç¦æ­¢ï¼Œä¹Ÿé˜²æ­¢å¤–éƒ¨ç”¨æˆ·ä½¿ç”¨ã€‚</p>
<ul>
<li>æŠ€å·§1ï¼šå¯ä»¥å£°æ˜ä¸ºprivateå‡½æ•°ä½†æ˜¯ä¸ç»™å‡ºå®ç°ï¼Œè®©ç¼–è¯‘å™¨æŠ¥é”™ï¼›</li>
<li>æŠ€å·§2ï¼šå¯ä»¥è®¾ç«‹åŸºç±»Baseï¼Œè®©å¤åˆ¶æ„é€ å’Œèµ‹å€¼æ„é€ éƒ½ä¸ºprivateå‡½æ•°ï¼Œè®©ç›®æ ‡ç±»ç»§æ‰¿äºBaseç±»ã€‚</li>
</ul>
<div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>C++11é’ˆå¯¹æ­¤ç±»æƒ…å†µï¼Œç»™äºˆäº†deleteå…³é”®å­—ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œåœ¨æˆå‘˜å‡½æ•°åé¢æ–°å¢&quot;=delete&quot;ï¼Œå³å¯æ˜¾å¼åœ°æ‹’ç»è¿™ä¸ªå‡½æ•°çš„ç”Ÿæˆå’Œè°ƒç”¨.ä¸¾ä¾‹å¦‚ä¸‹:</p>
<div class="highlight" id="id-20"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">A</span><span class="p">(</span><span class="k">const</span> <span class="n">A</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span> <span class="c1">// æ‹·è´æ„é€ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">A</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">A</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span> <span class="c1">// æ‹·è´èµ‹å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div></div>
    </div>
  </div>
<h3 id="r07-ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°">R07 ä¸ºå¤šæ€åŸºç±»å£°æ˜<code>virtual</code>ææ„å‡½æ•°</h3>
<ul>
<li>é’ˆå¯¹<code>Base* pBase= new DerivedObj()</code>ï¼Œé‡Šæ”¾pBaseæ—¶ï¼Œå¦‚æœBaseåŸºç±»çš„ææ„å‡½æ•°<code>None-Virtual</code>ï¼Œåˆ™ä¼šå¯¼è‡´Derivedçš„ææ„å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ï¼Œé€ æˆ<code>å†…å­˜ä¸å®Œå…¨é‡Šæ”¾</code>ï¼Œå³å†…å­˜æ³„æ¼ï¼›</li>
<li>Non-Virtualçš„Classä¸è¦åšåŸºç±»ï¼›</li>
<li>å¦‚æœä¸åšåŸºç±»ï¼Œå°±ä¸è¦å£°æ˜ææ„å‡½æ•°ä¸ºvirtualå‡½æ•°ï¼Œé¿å…è™šè¡¨ä¸ºå…¶åˆ†é…vptré€ æˆæµªè´¹ï¼›</li>
<li>å¦‚æœæƒ³è¦æŠ½è±¡ç±»ï¼Œåˆæš‚æ—¶æ²¡æœ‰åˆé€‚æ¥å£ï¼Œå¯ä»¥è®©å…ˆè™šææ„æˆä¸ºçº¯è™šå‡½æ•°ï¼Œä¾‹å¦‚
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RawData</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">RawData</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è¿™é‡Œç‰¹æ®Šçš„æ˜¯ï¼Œéœ€è¦ä¸ºè¿™ä¸ªçº¯è™šå‡½æ•°æä¾›å®šä¹‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">~</span><span class="n">RawData</span><span class="o">::</span><span class="n">RawData</span><span class="p">(){}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="r08-åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°">R08 åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°</h3>
<ul>
<li>
<p>ææ„å‡½æ•°æœ€å¥½ä¸è¦åå‡ºå¼‚å¸¸</br>
å¯¹äºæŸä¸ªWidgetç±»ï¼Œå¦‚æœææ„å‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆ<code>vector&lt;widget&gt;</code>ææ„æ—¶å¯èƒ½è¿ç»­æŠ›å‡ºå¤šä¸ªå¼‚å¸¸ä»¥è‡³äºæ— æ³•å¤„ç†ï¼Œç›´æ¥å¯¼è‡´æå‰ç¨‹åºç»“æŸæˆ–è€…æœªå®šä¹‰è¡Œä¸ºã€‚</p>
</li>
<li>
<p>å¦‚æœæœ‰æŸä¸ªå‡½æ•°å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶éœ€è¦å¯¹å¼‚å¸¸åšå‡ºååº”ï¼Œåº”è¯¥æä¾›ä¸€ä¸ªéææ„çš„å‡½æ•°æ¥å¤„ç†</br>
æ³¨æ„ï¼Œåœ¨ææ„ä¸­æŠ›å¼‚å¸¸å¹¶åä¸‹(catchågo-on-execute)ï¼Œä¼šæ©ç›–é”™è¯¯ï¼Œä¹Ÿä¸æ˜¯ä¸ªå¥½åŠæ³•;æŠ›å¼‚å¸¸åcatchä½å¹¶std::abort()åè€Œå¯ä»¥æå‰ç»ˆç»“ã€æœªå®šä¹‰è¡Œä¸ºã€ã€‚</p>
</li>
</ul>
<h3 id="r09-ç»ä¸åœ¨æ„é€ å’Œææ„è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°">R09 ç»ä¸åœ¨æ„é€ å’Œææ„è¿‡ç¨‹ä¸­è°ƒç”¨<code>virtual</code>å‡½æ•°</h3>
<ul>
<li>åœ¨Derived-Classçš„Base-Classæ„é€ æœŸé—´ï¼Œå¯¹è±¡çš„ç±»å‹æ˜¯Base-Classï¼Œè€ŒéDerivedï¼Œå³ä½¿<code>dynamic_cast</code>ä¹Ÿæ˜¯è¿™æ ·è®¤ä¸ºçš„ï¼Œå› ä¸ºæ­¤æ—¶virtualå‡½æ•°ä¸ä¼šä¸‹é™åˆ°Derived-Classçš„é˜¶å±‚ï¼›æ¢å¥è¯è¯´==&gt; â€œ<code>åœ¨Base-Classæ„é€ æœŸé—´ï¼Œvirtualå‡½æ•°ä¸æ˜¯virtualå‡½æ•°</code>â€ï¼›</li>
<li>åœ¨ææ„çš„æ—¶å€™ä¹Ÿæ˜¯ç±»ä¼¼é“ç†ï¼Œä¹Ÿä¸è¦åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨virtualå‡½æ•°ï¼Œé—´æ¥è°ƒç”¨ä¹Ÿä¸è¡Œ(æ¯”å¦‚non-Virtual-&gt;virtual)ï¼›</li>
<li>é‚£ä¹ˆæ›¿ä»£æ–¹æ¡ˆæ˜¯ï¼Ÿ</br>
å¦‚æœæœ‰è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå¸Œæœ›åœ¨å­ç±»æ„é€ æ—¶èƒ½è°ƒç”¨çˆ¶ç±»çš„fooå‡½æ•°(ä¸‹æ–¹logTransactionå‡½æ•°)ï¼Œé‚£ä¹ˆå°†fooæ”¹ä¸ºnon-Virtualå‡½æ•°ï¼Œå¹¶ä¸”å­ç±»æ„é€ æ—¶è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œæœ‰å‚æ•°æ—¶ä¸€å¹¶ä¼ è¿‡å»ï¼›</li>
</ul>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Transaction</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">explict</span> <span class="n">Transaction</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">info</span><span class="p">,</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span><span class="o">:</span><span class="n">id_</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="n">logTransaction</span><span class="p">(</span><span class="n">info</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">logTransaction</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">info</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">info</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span> <span class="p">}</span><span class="c1">//non-Virtualå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">id_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BuyTransaction</span> <span class="o">:</span><span class="k">public</span> <span class="n">Transaction</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>  <span class="c1">//å°†logä¿¡æ¯ä¼ é€’ç»™ åŸºç±»Transactionæ„é€ å‡½æ•°ï¼› å¹¶åˆå§‹åŒ–äº†åŸºç±»æˆå‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">BuyTransaction</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">info</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span><span class="n">Transaction</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition Note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>By the way<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœæœ‰å‡ ä¸ªBaseæ„é€ å‡½æ•°ï¼Œå°±å¾—å†™å‡ ä¸ªDerivedæ„é€ å‡½æ•°ä¼ å‚ã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸€æ­¥éª¤ï¼Œ åœ¨ç°ä»£C++11ï¼Œæ¨å‡ºäº†ç»§æ‰¿æ„é€ å‡½æ•°(Inheriting Constructor)ï¼Œå­ç±»å¯ä»¥ä¸€ä¸ªéƒ½ä¸ç”¨å†™ï¼Œç›´æ¥å†™ä¸€å¥usingå£°æ˜å³å¯ï¼Œä½¿ç”¨<code>using BaseClass::BaseClass</code>çš„å½¢å¼ï¼Œå¦‚ä¸‹ğŸ‘‡</p>
<div class="highlight" id="id-21"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BuyTransaction</span> <span class="o">:</span><span class="k">public</span> <span class="n">Transaction</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="n">Transaction</span><span class="o">::</span><span class="n">Transaction</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//å…¶ä»–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div></div>
    </div>
  </div>
<h3 id="r10-ä»¤operatorè¿”å›ä¸€ä¸ªreference-to-this">R10 ä»¤<code>operator=</code>è¿”å›ä¸€ä¸ªreference to *this</h3>
<ul>
<li>å…³äºèµ‹å€¼æ“ä½œç¬¦<code>operator=</code>ï¼Œä¸»æµåšæ³•æ˜¯:
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Widget</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Widget</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//... do some thing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div>ä¸Šè¿°åšæ³•ä¸å±€é™äºoperator=ï¼Œè¿˜æœ‰<code>operator += ,-=,*=,/=</code>ç­‰å…¶ä»–èµ‹å€¼è¿ç®—ç¬¦ã€‚</br>
è¯¥ä¸»æµåè®®/åšæ³•ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œåªæ˜¯ä¸ªå»ºè®®ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥å…è®¸<strong>è¿ç»­èµ‹å€¼</strong>($x=y=z$çš„å½¢å¼)ã€‚</br>
è¯¥åè®®è¢«å†…ç½®ç±»å‹ï¼Œä»¥åŠSTLçš„ç±»å‹(å¦‚string,vector,complex,shared_ptr)å…±åŒéµå®ˆã€‚</br></li>
</ul>
<h2 id="r11-åœ¨operatorä¸­å¤„ç†è‡ªæˆ‘èµ‹å€¼">R11 åœ¨<code>operator=</code>ä¸­å¤„ç†&quot;è‡ªæˆ‘èµ‹å€¼&quot;</h2>
<p>ä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™è‡ªå·±ï¼Œè¿™ç§çœ‹èµ·æ¥æœ‰ç‚¹å‚»çš„åšæ³•ï¼Œæœ‰æ—¶å€™ä¼šæ¯”è¾ƒéš¾ä»¥å‘è§‰ã€‚æ¯”å¦‚ï¼š<code>a[i] = a[j]</code>ï¼Œå¦‚æœ $i$ å’Œ $j$ ç›¸ç­‰ï¼Œå°±æ˜¯â€œè‡ªæˆ‘èµ‹å€¼â€çš„ç»å…¸åœºæ™¯äº†ã€‚
æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå°½é‡å®Œå¤‡çš„èµ‹å€¼æ“ä½œç¬¦å‡½æ•°ğŸ¤”ã€‚
è€ƒè™‘å¦‚ä¸‹ç±»<code>MapWidget</code>ï¼Œå†…æœ‰æ•°æ®è£¸æŒ‡é’ˆ<code>BitMap *pb_</code>ï¼Œåœ¨èµ‹å€¼æ—¶åŒæ—¶è€ƒè™‘<strong>å¼‚å¸¸å®‰å…¨</strong>å’Œ <strong>â€œè‡ªæˆ‘èµ‹å€¼â€</strong> å®‰å…¨(è®¤åŒæµ‹è¯•ä¿éšœè‡ªæˆ‘èµ‹å€¼å®‰å…¨)ï¼Œæ˜¯ä¸€ä¸ªç›¸å¯¹ä¸é”™çš„å®ç°ã€‚ä½†æ˜¯ï¼Œè®¤åŒæµ‹è¯•ä¼šé™ä½è¿è¡Œæ•ˆç‡ï¼Œæ ¹æ®å®é™…å·¥ç¨‹å®è·µæƒ…å†µ(è‡ªæˆ‘èµ‹å€¼æ¦‚ç‡æä½ )å¯ä»¥é…Œæƒ…å»æ‰ã€‚</p>
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BitMap</span> <span class="p">{</span><span class="cm">/*çœç•¥ç±»å£°æ˜&amp;å®ç°*/</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MapWidget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">BitMap</span> <span class="o">*</span> <span class="n">pb_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">MapWidget</span><span class="p">(</span><span class="n">BitMap</span> <span class="o">*</span><span class="n">pb</span><span class="p">)</span> <span class="o">:</span><span class="n">pb_</span><span class="p">(</span><span class="n">pb</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">MapWidget</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">MapWidget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="c1">//è¿™ä¸€å¥ä¸ºè®¤åŒæµ‹è¯•(identity test)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">BitMap</span> <span class="o">*</span><span class="n">pOrig</span> <span class="o">=</span> <span class="n">pb_</span><span class="p">;</span><span class="c1">//ä¸è¦ä¸€ä¸Šæ¥å°±deleteï¼Œè€Œæ˜¯ä¿å­˜this-&gt;pb_
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">pb_</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BitMap</span><span class="p">(</span><span class="o">*</span><span class="n">rhs</span><span class="p">.</span><span class="n">pb_</span><span class="p">);</span><span class="c1">//å› ä¸ºè¿™ä¸€å¥å¯èƒ½æŠ›å¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">delete</span> <span class="n">pOrig</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Copy and SwapæŠ€æœ¯ ä¸Šæ–‡ä¸­ä¿éšœ<strong>å¼‚å¸¸å®‰å…¨</strong>å’Œ **â€œè‡ªæˆ‘èµ‹å€¼â€**å®‰å…¨çš„æŠ€æœ¯æ‰‹æ®µï¼Œå¦å¤–ä¸€ä¸ªåŠæ³•ï¼Œå°±æ˜¯Copy and SwapæŠ€æœ¯ã€‚è¿™ä¸ªæŠ€æœ¯çš„å…³é”®åœ¨äºâ€œä¿®æ”¹å¯¹è±¡æ•°æ®çš„å‰¯æœ¬ï¼Œç„¶ååœ¨ä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„å‡½æ•°ä¸­å°†ä¿®æ”¹çš„æ•°æ®å’ŒåŸä»¶ç½®æ¢ â€ã€‚
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">MapWidget</span><span class="o">::</span><span class="n">Swap</span><span class="p">(</span><span class="n">MapWidget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">){</span><span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">pb_</span><span class="p">,</span><span class="n">pb_</span><span class="p">);}</span>
</span></span><span class="line"><span class="cl"><span class="n">MapWidget</span><span class="o">&amp;</span> <span class="n">MapWidget</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">MapWidget</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">MapWidget</span> <span class="nf">temp</span><span class="p">(</span><span class="n">rhs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Swap</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="r12-å¤åˆ¶å¯¹è±¡æ—¶åˆ«å¿˜è®°å…¶æ¯ä¸€ä¸ªæˆåˆ†">R12 å¤åˆ¶å¯¹è±¡æ—¶åˆ«å¿˜è®°å…¶æ¯ä¸€ä¸ªæˆåˆ†</h3>
<ul>
<li>
<p>ç¼–å†™ç±»çš„Copyingå‡½æ•°æ—¶éœ€è¦åšåˆ°2ç‚¹
è¿™é‡Œçš„Copyingå‡½æ•°æ˜¯æŒ‡æœ‰copyå±æ€§çš„ç‰¹æ®Šå‡½æ•°==&gt; copyæ„é€ å‡½æ•°å’Œcopyèµ‹å€¼æ“ä½œç¬¦ã€‚</p>
<ol>
<li>å¤åˆ¶æ‰€æœ‰Localæˆå‘˜å˜é‡
å¦‚æœæˆå‘˜å¤åˆ¶çš„æ—¶å€™æœ‰é—æ¼ï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šæœ‰æ€¨è¨€ï¼Œè¿™å°±åŸ‹ä¸‹äº†éšæ‚£ã€‚å¦‚æœæ–°å¢äº†æˆå‘˜ï¼Œè¦å¯¹åº”ä¿®æ”¹Copyingå‡½æ•°ã€‚</li>
<li>è°ƒç”¨æ‰€æœ‰Base-Classå†…éƒ¨çš„é€‚å½“çš„Copyå‡½æ•°
å…·ä½“ä»£ç çš„æ¨èå®ç° å¦‚ä¸‹ğŸ‘‡ï¼š</li>
</ol>
<div class="highlight" id="id-16"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Customer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Customer</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">float</span> <span class="n">money</span><span class="p">)</span><span class="o">:</span><span class="n">name_</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="n">money_</span><span class="p">(</span><span class="n">money</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">money_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">VipCustomer</span> <span class="o">:</span><span class="k">public</span> <span class="n">Customer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>  <span class="c1">//æ³¨æ„ï¼šæ´¾ç”Ÿç±»è¦å¤åˆ¶åŸºç±»é‚£éƒ¨åˆ†çš„æˆå‘˜å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">using</span> <span class="n">Customer</span><span class="o">::</span><span class="n">Customer</span><span class="p">;</span> <span class="c1">//å‚è€ƒR09
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">VipCustomer</span><span class="p">(</span><span class="k">const</span> <span class="n">VipCustomer</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span><span class="n">priority_</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">priority_</span><span class="p">),</span><span class="n">Customer</span><span class="p">(</span><span class="n">rhs</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl">    <span class="n">VipCustomer</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">VipCustomer</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">Customer</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">rhs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">priority_</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">priority_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">setPriority</span><span class="p">(</span><span class="kt">int</span> <span class="n">priority</span><span class="p">)</span> <span class="p">{</span> <span class="n">priority_</span> <span class="o">=</span> <span class="n">priority</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">priority_</span><span class="p">;</span><span class="c1">//å­ç±»ç‹¬æœ‰æˆå‘˜å¯ä»¥å•ç‹¬setå‡½æ•°èµ‹å€¼ï¼Œæˆ–è€…æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨èµ‹å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä¸è¦ç”¨ä¸€ä¸ªCopyingå‡½æ•°å»å®ç°å¦ä¸€ä¸ª
ä»¤copy-assignmentæ“ä½œç¬¦è°ƒç”¨copyæ„é€ å‡½æ•°æ˜¯ä¸åˆç†çš„ï¼›åä¹‹ï¼Œåè€…è°ƒç”¨å‰è€…ä¹Ÿæ˜¯æ— æ„ä¹‰çš„ã€‚ å¦‚æœ2è€…æœ‰å¤§é‡çš„ä»£ç æ˜¯ç›¸åŒçš„ï¼Œå¯ä»¥å‰¥ç¦»ä¸€ä¸ªç±»å†…privateç±»å‹çš„<code>init</code>å‡½æ•°å‡ºæ¥ï¼Œæä¾›ç»™ä¸Šè¿°2è€…è°ƒç”¨ã€‚</p>
</li>
</ul>
<p>ref:</br>
[1]. <a href="https://blog.csdn.net/cltcj/category_12098441.html"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/cltcj/category_12098441.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br>
[2]. <a href="https://kissingfire123.github.io/2021/12/06_effective-c-%e4%b9%8b%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93%e4%b8%80/"target="_blank" rel="external nofollow noopener noreferrer">https://kissingfire123.github.io/2021/12/06_effective-c-%e4%b9%8b%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93%e4%b8%80/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></br></p>]]></description></item></channel></rss>